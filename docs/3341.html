<html>
<head>
<title>Spark, Parallelising the Parallel Jobs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">火花，并行化并行作业</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spark-parallelising-the-parallel-jobs-77b819314d5a?source=collection_archive---------2-----------------------#2021-06-26">https://medium.com/analytics-vidhya/spark-parallelising-the-parallel-jobs-77b819314d5a?source=collection_archive---------2-----------------------#2021-06-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/378244599015f7be88a8e75a08760252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gdr9Ec16WbVQFQKD"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@artisanalphoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">手工摄影</a>拍摄</figcaption></figure><p id="f0cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">“并行化并行作业”到底是什么意思？？</p><p id="9d3a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不深入研究，用外行人的话来说，</p><p id="6b4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Spark根据我们创建RDD、应用转换和动作的顺序创建DAG或沿袭。</p><p id="7843" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它在数据帧或数据集上应用Catalyst优化器来优化您的查询。但是它<strong class="ix hj">没有做的</strong>是，彼此并行地运行你的功能。</p><p id="80ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们总是倾向于认为Spark是一个框架，它将你的工作分成任务和阶段，并且并行运行。在某种程度上，这是100%真实的。但不是以我们下面将要讨论的方式。</p><p id="4958" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设我有10个表，我需要对它们应用相同的函数，例如<strong class="ix hj"> count，计算空值的数量，打印最上面的行，等等。</strong></p><p id="abb4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，在这里，如果我提交10个表的作业，它会并行运行吗，因为这10个表是相互独立的？？？</p><p id="1f4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Spark足够聪明，能够找出依赖关系并并行运行，不是吗？</p><p id="77e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不完全是。</p><p id="788c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">演示时间</strong></p><p id="7b1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤1: </strong>初始化Spark会话</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jt"><img src="../Images/a72ac825816f55755b089340b74c2310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w3Zh7HED-lT_ZZS09QM7Hg.png"/></div></div></figure><p id="6be3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤2: </strong>用样本记录创建虚拟表</p><p id="a294" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个例子，我使用了<strong class="ix hj"> kaggle </strong>数据集并创建了表格</p><p id="4587" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://www.kaggle.com/datasets" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/datasets</a></p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/79a4d5c20eedb12663e85f8e1e69a80d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1WdtVl2r5sRxW7q_h4djQ.png"/></div></div></figure><p id="9ad9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤3: </strong>测试数据和计数的示例命令</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/55c57cd107d8625e9face8362417b344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_XqMcGpeF3HE_jl5nflbKA.png"/></div></div></figure><p id="b5b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤4: </strong>创建一个通用函数，其中包含一些适用于所有给定表的转换</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/4ca5bf96f2fd3d3ef486163507b8c19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4jUXrkOdcT29jeZn6AQGw.png"/></div></div></figure><p id="f711" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">步骤5: </strong>对独立表执行相同的功能</p><p id="12c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，您可以看到作业已经按顺序<strong class="ix hj">触发</strong>，尽管它们之间没有依赖关系。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/26b26e4df61157cd503aac3258aa558c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ReYDGEc_vMvs9PmiT2HUPw.png"/></div></div></figure><p id="2384" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了证实这一点，让我们看看SPARK UI</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/c8153aec9accbf20d0ead7018628f011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2mppnqPF5hzCMJLVuc5qw.png"/></div></div></figure><p id="1918" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以作业是按顺序运行的。</p><p id="9991" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们做同样的练习，但要循环进行</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/80543eca3a2cbd69a99af3aaf2643b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgsvhO0beP0LQbsL18rwhw.png"/></div></div></figure><p id="1736" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如预期的那样，作业按顺序运行。</p><p id="2a9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们如何让Spark知道，按照我们的示例，给定的10个表之间没有依赖关系，并并行运行它们。</p><p id="6821" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在有趣的部分来了</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/525d5ef755cb8d48b47ff717bc7e12c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*00TPEZ0AWykXJ2n8STCzvg.png"/></div></div></figure><p id="c407" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">Scala并发</strong></p><p id="daa2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://docs.scala-lang.org/overviews/scala-book/futures.html" rel="noopener ugc nofollow" target="_blank">https://docs . Scala-lang . org/overviews/Scala-book/futures . html</a></p><p id="a726" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据官方文件，以下是从Scaladoc对<strong class="ix hj">未来</strong>的描述:</p><pre class="ju jv jw jx fd kf kg kh ki aw kj bi"><span id="d1ff" class="kk kl hi kg b fi km kn l ko kp">“A Future represents a value which may or may not currently be available, but will be available at some point, or an exception if that value could not be made available.”</span></pre><p id="fbae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">执行上下文</strong></p><pre class="ju jv jw jx fd kf kg kh ki aw kj bi"><span id="66c2" class="kk kl hi kg b fi km kn l ko kp">An ExecutionContext can execute program logic asynchronously, typically but not necessarily on a thread pool.<br/>A general purpose ExecutionContext must be asynchronous in executing any Runnable that is passed into its execute-method. A special purpose ExecutionContext may be synchronous but must only be passed to code that is explicitly safe to be run using a synchronously executing ExecutionContext.</span></pre><p id="29ec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">等待</strong></p><pre class="ju jv jw jx fd kf kg kh ki aw kj bi"><span id="c23f" class="kk kl hi kg b fi km kn l ko kp">Await is what is used to ensure proper handling of blocking for Awaitable instances.<br/>While occasionally useful, e.g. for testing, it is recommended that you avoid Await when possible in favor of callbacks and combinators like onComplete and use in for comprehensions. Await will block the thread on which it runs, and could cause performance and deadlock issues.</span></pre><p id="94b4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> a. Await.ready </strong></p><pre class="ju jv jw jx fd kf kg kh ki aw kj bi"><span id="c544" class="kk kl hi kg b fi km kn l ko kp">Await the “completed” state of an Awaitable.</span></pre><p id="0a37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b . wait . result</p><pre class="ju jv jw jx fd kf kg kh ki aw kj bi"><span id="a981" class="kk kl hi kg b fi km kn l ko kp">Await and return the result (of type T) of an Awaitable.<br/>Params:<br/>awaitable — the Awaitable to be awaited<br/>atMost — maximum wait time, which may be negative (no waiting is done), <strong class="kg hj">Duration.Inf</strong> for unbounded waiting, or a finite positive duration<br/>Returns:<br/>the result value if awaitable is completed within the specific maximum wait time</span></pre><p id="3215" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们使用Scala并发来尝试spark并行</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/0136d51d45cd5424cf9b85c6467a0b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdnL7xfkmygADYgouoSkKA.png"/></div></div></figure><p id="99cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看我们在代码块中做了什么。</p><ol class=""><li id="721e" class="kr ks hi ix b iy iz jc jd jg kt jk ku jo kv js kw kx ky kz bi translated">[第9行]初始化执行上下文来定义我们的任务需要运行的线程数量。在我们的例子中，它是表的数量。</li><li id="16e7" class="kr ks hi ix b iy la jc lb jg lc jk ld jo le js kw kx ky kz bi translated">[第17行]创建一个未来列表。</li><li id="0a55" class="kr ks hi ix b iy la jc lb jg lc jk ld jo le js kw kx ky kz bi translated">[第18行]并传递表名列表，为每个表定义线程池名并给出应该运行的函数名[第21行]。</li><li id="1532" class="kr ks hi ix b iy la jc lb jg lc jk ld jo le js kw kx ky kz bi translated">[第24行]获取未来列表并运行Await.result，这将触发所有线程，并等待最长时间(Duration.inf)以返回结果。</li><li id="e420" class="kr ks hi ix b iy la jc lb jg lc jk ld jo le js kw kx ky kz bi translated">[第34行]最后关闭执行上下文。</li></ol><p id="dda4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们执行并查看输出。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lf"><img src="../Images/49ea047bf02d9d8eca8da0e642e5661b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ouF4JSMsAXQfchZCCXZjqw.png"/></div></div></figure><p id="080f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">见鬼去吧。！这些作业是彼此并行触发的。</p><p id="c253" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们创建了5个线程池，在每个线程池中运行作业。</p><p id="d015" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">查看同时提交的日志“触发并行作业”</p><p id="97c4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于表的计数不同，作业在不同的时间完成。</p><p id="63bb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们验证SPARK UI</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/43f8da8975ba8b8a69f4950772b472ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uB23j-kOyP-vYxYrjukrWQ.png"/></div></div></figure><p id="af21" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我们可以看到它创建了5个不同的池(0到4)，并彼此并行运行作业。</p><p id="1839" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">查看提交的时间，确保他们同时感到疲劳。</p><p id="b171" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在作业页面中再次确认。</p><p id="dffc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从底部检查，我们可以看到所有的作业同时提交。</p><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/5db0f382e9f4a8bdf082868000edfbf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3UgOu8_aJgbrK30B2GvBA.png"/></div></div></figure><p id="3bff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望你喜欢这个演示和解释。</p><p id="5861" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在我的github repo中找到上面的笔记本(DBC文件)。</p><div class="lh li ez fb lj lk"><a href="https://github.com/ajithshetty/SparkParallelism" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">ajithshetty/spark并行度</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">通过在GitHub上创建一个帐户，为ajithshetty/SparkParallelism开发做出贡献。</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">github.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly io lk"/></div></div></a></div><figure class="ju jv jw jx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/0564afa916f47d189c7aef68aa837e17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiGLGnfnMfJCvTyhLgt5jg.png"/></div></div></figure><p id="5369" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在评论中发表你的反馈。</p><p id="0591" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">阿吉特·库玛尔·谢蒂</p><p id="c39d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大数据工程师—热爱大数据、分析、云和基础设施。</p><p id="5a1b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://ajithshetty28.medium.com/subscribe" rel="noopener">订阅</a> ✉️ || <a class="ae iu" href="https://ajithshetty28.medium.com/" rel="noopener">更多博客</a>📝|| <a class="ae iu" href="https://www.linkedin.com/in/ajshetty28" rel="noopener ugc nofollow" target="_blank">链接于</a>📊|| <a class="ae iu" href="https://ajithshetty.github.io/" rel="noopener ugc nofollow" target="_blank">个人资料页面</a>📚|| <a class="ae iu" href="https://github.com/ajithshetty/" rel="noopener ugc nofollow" target="_blank"> Git回购</a>👓</p><p id="a8f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">订阅我的:</strong> <a class="ae iu" href="https://justenoughdata.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">每周简讯刚好够数据</strong> </a></p></div></div>    
</body>
</html>