<html>
<head>
<title>How to create a percentage plot with ggplot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用ggplot2创建百分比图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-percentage-plot-with-ggplot2-eada0f51f925?source=collection_archive---------5-----------------------#2021-05-04">https://medium.com/analytics-vidhya/how-to-create-a-percentage-plot-with-ggplot2-eada0f51f925?source=collection_archive---------5-----------------------#2021-05-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e003" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每次你需要建立一个百分比图时，事情总不会如你所愿吗？今天，您将学习如何使用ggplot2从头开始绘制完美的百分比图。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/c91a2004b335018f83c57b744f233a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*rAt1jPpKFnf7y_jRQrBzWg.gif"/></div></figure><p id="d8c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先要做的是打开你的R环境，加载一些包比如ggplot2，readxl，plyr。</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="659a" class="jp jq hh jl b be jr js l jt ju">if (!require("readxl")) install.packages("readxl")<br/>if (!require("plyr")) install.packages("plyr")<br/>if (!require("ggplot2")) install.packages("ggplot2")</span></pre><p id="fe7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，使用频率表查看您的数据集，我们对可变年龄感兴趣。</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="2941" class="jp jq hh jl b be jr js l jt ju">table1::table1(~., data = dados)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jv"><img src="../Images/61818ef17aa82782961688b7536b5055.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*zuGXlnCw-Nw1K4W8WN3tJQ.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">由于变量的样本量很小，我们将对其进行重新分类。</figcaption></figure><p id="8427" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们不对变量进行重新分类，我们的图将会像这样，我们不希望这种事情在这里发生。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es ka"><img src="../Images/22443161c0a1b76c69d59884bce4f5c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uKSkeEEUGRtKUbT_zgVXdA.png"/></div></div></figure><p id="561e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们需要对值进行分组，以使我们的样本更具代表性(对于41岁以上的人，只有少数回答)。有了这个代码，我们将把年龄从41岁到71岁以上的人分成一个新的组，称为“41岁以上”。</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="cefb" class="jp jq hh jl b be jr js l jt ju">dados[dados$Idade == "Entre_41_e_50", 2] = "Mais 41"<br/>dados[dados$Idade == "Entre_51_e_60", 2] = "Mais 41"<br/>dados[dados$Idade == "Entre_61_e_70", 2] = "Mais 41"<br/>dados[dados$Idade == "Mais_de_71", 2] = "Mais 41"</span></pre><p id="5b83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们可以用变量x(年龄)和y(关于主题的概念)建立一个数据框架，这些变量只是例子。</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="a59f" class="jp jq hh jl b be jr js l jt ju">idade_conceito &lt;- data.frame(prop.table(table(dados$Idade, <br/>dados$ConceitoEfluente),1))</span></pre><p id="ad79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要忘记，重要的是要把你的变量变成因子，以保留变量和值标签属性。</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="78cb" class="jp jq hh jl b be jr js l jt ju">idade_conceito$Var1&lt;- as.factor(idade_conceito$Var1)<br/>idade_conceito$Var1&lt;- factor(idade_conceito$Var1,<br/> levels = c("Entre_15_e_20", <br/>           "Entre_21_e_25" ,<br/>           "Entre_26_e_30" ,<br/>           "Entre_31_e_40", <br/>           "Mais 41"))</span></pre><p id="48dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们也可以用新的价值来代替原有的价值。</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="04a1" class="jp jq hh jl b be jr js l jt ju">idade_conceito$var1_cat&lt;- revalue(idade_conceito$Var1, <br/>replace = c("Entre_15_e_20" = "15–20", <br/>            "Entre_21_e_25" = "21–25",<br/>             "Entre_26_e_30" = "26–30",<br/>             "Entre_31_e_40" ="31–40", <br/>             "Mais 41" = "+ 41"))<br/><br/>idade_conceito$Var1 &lt;-as.numeric(as.character(idade_conceito$Var1))</span></pre><p id="0850" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，但同样重要的是，使用ggplot2构建您的百分比图:</p><pre class="jd je jf jg fd jk jl jm bn jn jo bi"><span id="4229" class="jp jq hh jl b be jr js l jt ju">ggplot(idade_conceito, aes(x = var1_cat, y=Freq, fill =var2_cat ))+<br/>geom_bar( width = 0.8, position = position_dodge(width = 0.9), stat = "identity")+ <br/>labs(x="Age (years)", y=" ", fill = " ") +<br/>ggtitle("Concept on the subject") +<br/>scale_y_continuous(labels = scales::percent)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es kf"><img src="../Images/18fae1c38cb78158284751153682a337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8lWNJiuI4DvchqocTGwZkg.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">你喜欢吃吗?</figcaption></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kg"><img src="../Images/53f97f195b3c6b1c3510041a872c5ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Yj6nxHcbkz7U0apVCuWq8Q.gif"/></div></figure><p id="39f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在这里查看完整的代码:</p><div class="kh ki ez fb kj kk"><a href="https://github.com/rachderossi/data-analysis-R" rel="noopener  ugc nofollow" target="_blank"><div class="kl ab dw"><div class="km ab kn cl cj ko"><h2 class="bd hi fi z dy kp ea eb kq ed ef hg bi translated">GitHub-rachderossi/data-analysis-R:用R做的项目。</h2><div class="kr l"><h3 class="bd b fi z dy kp ea eb kq ed ef dx translated">该数据集包含约2，240名联系过的客户的社会人口统计和公司地理特征…</h3></div><div class="ks l"><p class="bd b fp z dy kp ea eb kq ed ef dx translated">github.com</p></div></div><div class="kt l"><div class="ku l kv kw kx kt ky ji kk"/></div></div></a></div><p id="10fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再见，伙计们！</p></div></div>    
</body>
</html>