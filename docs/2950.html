<html>
<head>
<title>Collecting Tweets with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python收集推文</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/collecting-tweets-with-python-7804f6c73d39?source=collection_archive---------10-----------------------#2021-05-27">https://medium.com/analytics-vidhya/collecting-tweets-with-python-7804f6c73d39?source=collection_archive---------10-----------------------#2021-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6f26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Tweepy Python模块Grep、处理和存储Twitter数据</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0cac4fb7f6502d66a29b6347684d2d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CsFEdTiZEZGmC3fOx4bIpA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">布雷特·乔丹在<a class="ae jt" href="https://unsplash.com/s/photos/twitter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="e3ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Twitter是一个全球广泛使用的分享思想、观点和经验的渠道。使该网站成为媒体和文本内容的重要来源，这些内容是用于分析和获取见解的有用数据。</p><p id="b648" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，Twitter还有一个功能，可以搜索关于某个主题的推文，跟踪与一些词相关的数据，然后获取关于趋势话题、人物、标签或任何其他主题的信息。</p><p id="cd4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，描述了一种使用编程语言<strong class="ih hj"> Python </strong>通过库<strong class="ih hj"> Tweepy </strong>来使用这个特性的方法。</p><h1 id="f392" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">跟踪</h1><p id="c314" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">为了通过代码访问<strong class="ih hj"> Twitter </strong>数据，需要向<a class="ae jt" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank"> Twitter开发者</a>申请获得自己的API密钥。这个过程需要一点时间，但是必须继续。</p><p id="c0dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要开始编码，请创建一个Python脚本文件，并使用您的键设置下面的变量。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="947a" class="lc jv hi ky b fi ld le l lf lg">CONSUMER_KEY = 'XXXXXXX'<br/>CONSUMER_SECRET = 'XXXXXXX'<br/>ACCESS_TOKEN = 'XXXXXXX'<br/>ACCESS_TOKEN_SECRET = 'XXXXXXX'</span></pre><h2 id="4deb" class="lc jv hi bd jw lh li lj ka lk ll lm ke iq ln lo ki iu lp lq km iy lr ls kq lt bi translated">十二岁</h2><p id="bef8" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">用Python访问Twitter API有很多可能的方法。本文将使用<a class="ae jt" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Tweepy </strong> </a>库。用<strong class="ih hj"> pip </strong>安装这个Python模块。运行:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="4eea" class="lc jv hi ky b fi ld le l lf lg">$ pip install tweepy</span></pre><p id="e9f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，导入Tweepy模块并将您的密钥应用于身份验证，创建一个允许访问的Twitter API对象。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="ecc9" class="lc jv hi ky b fi ld le l lf lg">import tweepy</span><span id="c50f" class="lc jv hi ky b fi lu le l lf lg">auth = tweepy.OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)<br/>auth.set_access_token(ACCESS_TOKEN, ACCESS_TOKEN_SECRET)<br/>api = tweepy.API(auth)</span></pre><h1 id="e0ad" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">流动</h1><p id="2fcd" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">使用Tweepy模块，可以访问和定制推文流功能，这对于获取大量推文数据非常有用，因为它返回实时发布的推文。</p><h2 id="d8b1" class="lc jv hi bd jw lh li lj ka lk ll lm ke iq ln lo ki iu lp lq km iy lr ls kq lt bi translated">设置跟踪行为</h2><p id="7e1a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">为了能够定义每当发布一条推文时程序将做什么，需要创建一个从Tweepy扩展<strong class="ih hj"> StreamListener </strong>的类，并覆盖<strong class="ih hj"> on_status </strong>方法以添加所需的行为。下面是一个打印tweet文本的例子。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="f28a" class="lc jv hi ky b fi ld le l lf lg">class TweetListener(tweepy.StreamListener):<br/>  def on_status(self, tweet):<br/>    print(tweet.text)</span></pre><p id="675b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tweepy提供了一个名为<strong class="ih hj"> Stream </strong>的类，它需要验证和一个要实例化的监听器。因此，创建一个Stream对象，它从前面定义的<strong class="ih hj"> api </strong>变量接收<strong class="ih hj"> auth </strong>属性，并使用上述<strong class="ih hj"> TweetListener </strong>类的一个实例。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="defa" class="lc jv hi ky b fi ld le l lf lg">listener = TweetListener()<br/>stream = tweepy.Stream(auth = api.auth, listener=listener)</span></pre><h2 id="6dc3" class="lc jv hi bd jw lh li lj ka lk ll lm ke iq ln lo ki iu lp lq km iy lr ls kq lt bi translated">开始流</h2><p id="5115" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Tweepy提供了几种流处理。要开始流式传输tweets，您可以通过stream对象的<strong class="ih hj"> filter </strong>方法使用可用的过滤过程。有了它，就有可能跟踪包含一系列单词的推文，或者关注来自多个用户的推文，甚至选择将被考虑的语言。</p><p id="4337" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，下面的代码开始打印用英语写的包含与新冠肺炎有关的单词的推文(“冠状病毒”、“COVID”、“covid19”、“新冠肺炎”)。请注意，这只是一个示例，您可以随意更改过滤器参数。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="b4e1" class="lc jv hi ky b fi ld le l lf lg"># filter parameters<br/>words = ['coronavirus', 'covid', 'covid19', 'covid-19']<br/>languages = ['en']</span><span id="b540" class="lc jv hi ky b fi lu le l lf lg"># streaming...<br/>stream.filter(track=words, languages=languages)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/d933a1a63337f7a42723bfa5a003d599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*PnOXpQAkL4i3gb1YPMmnYQ.gif"/></div></figure><p id="edc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，脚本只是打印tweets。一旦开始，它不会结束，直到被手动停止(按CTRL + C或杀死系统进程)，它不会记录任何信息。因此，为了进一步的分析，有必要对数据进行标记和存储。</p><h2 id="0966" class="lc jv hi bd jw lh li lj ka lk ll lm ke iq ln lo ki iu lp lq km iy lr ls kq lt bi translated">自动取消</h2><p id="17f9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">存档录音特性的一种方法是更新<strong class="ih hj"> TweetListener </strong>类，设置一个由<strong class="ih hj"> on_status </strong>方法填充的列表属性。由于流式传输过程是无限的，因此还需要设置一个阈值，一旦达到该阈值，就会通过在<strong class="ih hj"> on_status </strong>上返回<strong class="ih hj"> False </strong>来自动取消该流。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="11ec" class="lc jv hi ky b fi ld le l lf lg"># set default threshold value <br/>DEFAULT_THRESHOLD = 10</span><span id="eb19" class="lc jv hi ky b fi lu le l lf lg"># older listener with changes<br/>class TweetListener(tweepy.StreamListener) :<br/>  def __init__(self, threshold = DEFAULT_THRESHOLD) :<br/>    super().__init__()<br/>    self.threshold = threshold<br/>    self.tweets = []</span><span id="582d" class="lc jv hi ky b fi lu le l lf lg">  def on_status(self, tweet):<br/>    if len(self.tweets) &lt; self.threshold :<br/>      print(tweet)<br/>      self.tweets.append(tweet)<br/>    else:<br/>      return False</span></pre><h2 id="da14" class="lc jv hi bd jw lh li lj ka lk ll lm ke iq ln lo ki iu lp lq km iy lr ls kq lt bi translated">标签和字段</h2><p id="241d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">一条tweet携带大量数据，例如内容文本、媒体、收藏计数、所有者等等。要了解更多细节，请查看Twitter开发人员文档中关于Tweet对象的页面<a class="ae jt" href="https://developer.twitter.com/en/docs/twitter-api/v1/data-dictionary/object-model/tweet" rel="noopener ugc nofollow" target="_blank">。每个申请案例都需要不同的信息，选择你感兴趣的领域，去掉剩下的。</a></p><p id="3fdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值得一提的是，如果tweet文本超过140个字符，<strong class="ih hj">文本</strong>属性将被截断。在这种情况下，tweet对象将具有<strong class="ih hj"> extended_tweet </strong>属性。因此，要访问全文，请使用<strong class="ih hj">extended _ tweet[' full _ text ']</strong>。</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="a807" class="lc jv hi ky b fi ld le l lf lg"># older listener with changes<br/>class TweetListener(tweepy.StreamListener) :<br/>  def __init__(self, threshold = DEFAULT_THRESHOLD) :<br/>    super().__init__()<br/>    self.threshold = threshold<br/>    self.tweets = []</span><span id="f67a" class="lc jv hi ky b fi lu le l lf lg">  def on_status(self, tweet):<br/>    if len(self.tweets) &lt; self.threshold :<br/>      text = (<br/>        tweet.extended_tweet['full_text']<br/>        if hasattr(tweet, 'extended_tweet')<br/>        else tweet.text<br/>      )<br/>      desired_fields = [tweet.id, text]<br/>      print(desired_fields)<br/>      self.tweets.append(desired_fields)<br/>    else:<br/>      return False</span></pre><h1 id="7f28" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">保管</h1><p id="66d7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">到目前为止，所有跟踪的tweets都存储在内部TweetListener对象的<strong class="ih hj"> tweets </strong>属性中。我们可以使用<strong class="ih hj">熊猫</strong>创建一个数据帧，并将其保存在CSV文件中:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="ca6b" class="lc jv hi ky b fi ld le l lf lg">import pandas as pd</span><span id="ccd0" class="lc jv hi ky b fi lu le l lf lg">columns = ['id', 'text']<br/>output_file = 'tweets.csv'</span><span id="6847" class="lc jv hi ky b fi lu le l lf lg">tweets = pd.DataFrame(listener.tweets, columns=columns])<br/>tweets.to_csv(output_file, index = False)</span></pre></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="95ff" class="ju jv hi bd jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr bi translated">后续步骤</h1><p id="399c" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">尝试应用您存储的文本数据来分析并从中获取信息。例如，研究在推文中向用户提及某个关键主题、常见标签、信息的情感等等。如前所述，Twitter是一个很好的数据来源。你可以在一段时间内掌握大量的信息。</p></div></div>    
</body>
</html>