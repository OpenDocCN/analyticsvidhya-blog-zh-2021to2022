<html>
<head>
<title>Handling imbalanced class in machine learning classifiers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习分类器中不平衡类的处理</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/handling-imbalanced-class-in-machine-learning-classifiers-1b5c528f427f?source=collection_archive---------4-----------------------#2021-03-13">https://medium.com/analytics-vidhya/handling-imbalanced-class-in-machine-learning-classifiers-1b5c528f427f?source=collection_archive---------4-----------------------#2021-03-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4169d30d2d6ec7c7a1246ad7ac9d160d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7NsqXRyyhwuuyi53E3M93w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@acharki95?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿齐兹·阿查基</a>在<a class="ae iu" rel="noopener ugc nofollow" target="_blank" href="/s/photos/balance?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"> Unsplash </a>上拍摄</figcaption></figure><p id="283b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">很多人可能已经了解到，当类别不平衡时，他们需要使用性能指标，如召回率、精确度、f1分数或标准准确度度量的ROC曲线。</p><p id="e41e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我不确定是否只是我，但是我不知道不平衡数据的know训练会影响模型性能。在研究来自<a class="ae iu" href="https://www.youtube.com/watch?v=mUueSPmcOBc" rel="noopener ugc nofollow" target="_blank"> YouTube </a> (@4:10)的深度学习概念时，它告诉我，不平衡的类标签会影响模型的训练方式，最好的方法是对较少的类进行过采样。</p><p id="dbd3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这让我想到“机器学习算法呢？为什么我从来没有尝试平衡阶级标签？”</p><p id="9c15" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">经过一些研究，我发现不平衡的类标签也会影响ML模型，有多种技术可以解决这个问题。今天我将解释和实验，看看在训练时处理不平衡的类标签是否真的改善了我们的ML模型。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="793d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是我们今天要讨论的一些不同的技术:</p><ol class=""><li id="8f4a" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">过采样</li><li id="4a5e" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">欠采样</li><li id="76c6" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">调整类别权重</li></ol></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="6709" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用Kaggle提供的<a class="ae iu" href="https://www.kaggle.com/mlg-ulb/creditcardfraud/home" rel="noopener ugc nofollow" target="_blank">信用卡欺诈检测</a>数据。</p><p id="28c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们加载依赖项和数据，然后将数据分成训练集和测试集。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="fe94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的数据集高度不平衡，包括</p><ul class=""><li id="58d7" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js ku kg kh ki bi translated">284315正常交易(类= 0)</li><li id="ffb6" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ku kg kh ki bi translated">492宗欺诈交易(类别= 1)</li></ul><p id="162f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大约是577:1的比例。</p><p id="c417" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们将创建<code class="du kv kw kx ky b">result_df</code>来存储和跟踪不同技术的性能，稍后将用于比较。</p><p id="201c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还将创建两个函数:</p><ol class=""><li id="c21e" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">使用给定的X_train，y_train训练逻辑回归并在新看到的X_test数据上输出预测标签的函数</li><li id="f017" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">用于过采样、欠采样</li></ol><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="4dd5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用上述函数，我们将使用基线逻辑回归模型，随机过采样数据和随机欠采样数据进行预测。所有的表演都将存储在<code class="du kv kw kx ky b">result_df</code>中。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="7199" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们将随机对数据进行过采样，因此正常交易和欺诈交易的比例为1:1。</p><p id="8584" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">过采样</strong>是指从少数类中随机选择数据进行替换，直到少数类的数量与多数类的数量相同。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="abe0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面，我们可以确认正常交易和欺诈交易确实有相同数量的数据。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/f661d77673823af591815c14e553feea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eWcKACE-HmyyTIyrse6E-A.png"/></div></div></figure><p id="c206" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用上述过采样数据集，我们将使用逻辑回归对交易进行分类，并将其性能存储在<code class="du kv kw kx ky b">result_df</code>中。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="a2d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">欠采样</strong>是指从多数类中随机选取len(minority_class)。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="d4e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以看到比率为1:1，但是这次我们截断了正常交易数据的数量。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/3436c71ce30802afb289e24704444fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2GjD2TAf71NSmBaICLtwQA.png"/></div></div></figure><p id="aea6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用上述欠采样数据集，让我们使用逻辑回归进行预测，并存储其性能。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="4684" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">sklearn为其分类器算法提供了<code class="du kv kw kx ky b">class_weight</code>参数，而不是编写多行代码来进行过采样或欠采样。</p><p id="3c9a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以通过一个字典来显示每一个等级的权重，或者通过使用<code class="du kv kw kx ky b">n_sample / (n_classes * np.bincount(y)</code>来自动调整权重。</p><p id="17e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它的默认值是<code class="du kv kw kx ky b">None</code>，表示每个类的权重为1。在我们的例子中，它假设正常交易和欺诈交易的比例为1:1。</p><p id="1311" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们继续之前，我只想检查一下传入“balanced”是否真的很好地调整了权重。</p><p id="93cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的训练数据集中，正常数据与欺诈数据的比率为231226:379，大约为562.6 : 1。</p><p id="32a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用<code class="du kv kw kx ky b">n_sample/(n_classes*np.bincount(y)</code>我们得到0.5:281，大约是1:563，因此我们现在可以信任sklearn。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/06613c8534777a2143d18564e467c946.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*yiDjqZ1KeoQO3d0Y6vQtFw.png"/></div></figure><p id="8060" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">怀疑够了，让我们将欺诈数据的权重增加20，直到它达到562，这样我们就可以看到当类别不平衡得到调整时性能会发生什么变化。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="abfb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是时候看看我们储存在<code class="du kv kw kx ky b">result_df</code>中的所有东西了。</p><p id="9488" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意<code class="du kv kw kx ky b">baseline = weight_adjusted_1to1</code>和<code class="du kv kw kx ky b">weight_adjusted = weight_adjusted_563to1</code>(在我们的例子中是561，但你得到了要点)。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/042ddbebc27264f96cb4233898160db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x66MuZY4bFxpn9D2Rykh-A.png"/></div></div></figure><p id="1979" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们想象一下，当不平衡的训练数据达到平衡时，逻辑回归模型会发生什么。</p><figure class="ko kp kq kr fd ij"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="aef3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着不平衡的数据变得平衡，我们可以看到以下三种情况:</p><ol class=""><li id="0f72" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated"><strong class="ix hj">召回增加</strong></li><li id="bd68" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><strong class="ix hj">精度下降</strong></li><li id="5758" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated"><strong class="ix hj">精度下降</strong></li></ol><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/0fcd20904241e89f5827cf4ac1201a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctzIGNh6q8G5mZUoe1Rg8g.png"/></div></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="d7a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总之，在训练前调整不平衡似乎不是所有问题的最终答案，但是通过查看我们的结果，我们可以看到，如果我们的目标是提高<strong class="ix hj">回忆，平衡不平衡的数据将是有益的。</strong></p><p id="3d48" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">理解为什么调整不平衡的数据会提高召回率但降低精确度是很重要的，我需要做更多的研究并在我写之前自己测试它，我很快就会写了(希望如此)。现在你可以看看这里的<a class="ae iu" href="https://datascience.stackexchange.com/questions/90659/adjusting-imbalance-in-classification-problem-reduce-precision-accuracy-but-inc/90666#90666" rel="noopener ugc nofollow" target="_blank"/>，这是一个高层次的解释。</p><p id="c14b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">还有其他调整不平衡数据集的技术，一种非常流行的技术是<strong class="ix hj"> SMOTE(合成少数过采样技术)</strong>，这是一种过采样技术，但是它通过从少数类创建新的、看不见的数据来进行过采样。</p><p id="f0af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢阅读，如有误传，请评论:)</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="6aa6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参考资料:</p><ul class=""><li id="30c5" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js ku kg kh ki bi translated">https://www.youtube.com/watch?v=mUueSPmcOBc@ 4:10<a class="ae iu" href="https://www.youtube.com/watch?v=mUueSPmcOBc" rel="noopener ugc nofollow" target="_blank"/></li><li id="14bf" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ku kg kh ki bi translated"><a class="ae iu" href="https://arxiv.org/abs/1710.05381" rel="noopener ugc nofollow" target="_blank">卷积神经网络中类不平衡问题的系统研究</a></li><li id="1407" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ku kg kh ki bi translated"><a class="ae iu" href="https://www.kdnuggets.com/2017/06/7-techniques-handle-imbalanced-data.html" rel="noopener ugc nofollow" target="_blank">机器学习中处理不平衡数据的技术</a></li><li id="75f5" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ku kg kh ki bi translated"><a class="ae iu" href="https://towardsdatascience.com/methods-for-dealing-with-imbalanced-data-5b761be45a18" rel="noopener" target="_blank">https://towards data science . com/methods-for-handling-unbalanced-data-5b 761 be 45 a 18</a></li><li id="f743" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ku kg kh ki bi translated"><a class="ae iu" href="https://machinelearningmastery.com/smote-oversampling-for-imbalanced-classification/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/smote-over sampling-for-unbalanced-class ification/</a></li><li id="9767" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js ku kg kh ki bi translated"><a class="ae iu" href="https://datascience.stackexchange.com/questions/90659/adjusting-imbalance-in-classification-problem-reduce-precision-accuracy-but-inc/90666#90666" rel="noopener ugc nofollow" target="_blank">https://data science . stack exchange . com/questions/90659/adjusting-unbalancy-in-class ification-problem-reduce-precision-accuracy-but-Inc/90666 # 90666</a></li></ul></div></div>    
</body>
</html>