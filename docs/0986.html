<html>
<head>
<title>Dynamic Data Visualization in Angular with Plotly.js Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly.js事件实现Angular中的动态数据可视化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/dynamic-data-visualization-in-angular-with-plotly-js-events-22b524e2e097?source=collection_archive---------3-----------------------#2021-02-09">https://medium.com/analytics-vidhya/dynamic-data-visualization-in-angular-with-plotly-js-events-22b524e2e097?source=collection_archive---------3-----------------------#2021-02-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1520" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">向数据可视化添加交互性有助于更好地理解数据。我最喜欢的交互之一是使用悬停事件来突出显示另一个图中的数据。<a class="ae jc" href="https://plotly.com/javascript/" rel="noopener ugc nofollow" target="_blank"> Plotly.js </a>提供了使这种交互成为可能的事件，并且它们的<a class="ae jc" href="https://github.com/plotly/angular-plotly.js" rel="noopener ugc nofollow" target="_blank"> Angular库</a>使得添加到你的下一个单页应用程序变得容易。</p><p id="c54d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的目标:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">将鼠标悬停在图表1上以突出显示图表2</figcaption></figure><p id="eea6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你愿意，可以直接跳到<a class="ae jc" href="https://github.com/matteson/dynamic-plotly-visualization" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a>。</p><h2 id="df85" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">入门指南</h2><p id="e420" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">如果你已经熟悉了Angular中的Plotly，你可以跳到下一节。第一步，像往常一样，启动一个Angular项目并获取一些依赖项。</p><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="4609" class="jo jp hh kp b fi kt ku l kv kw">&gt;&gt; ng new<br/>&gt;&gt; npm install --save angular-plotly.js plotly.js</span></pre><p id="d700" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们配置模块并将其添加到<code class="du kx ky kz kp b">app.module.ts.</code></p><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="8c96" class="jo jp hh kp b fi kt ku l kv kw">import { CommonModule } from '@angular/common';<br/>import * as PlotlyJS from 'plotly.js/dist/plotly.js';<br/>import { PlotlyModule } from 'angular-plotly.js';</span><span id="f646" class="jo jp hh kp b fi la ku l kv kw">// We have to supply the plotly.js module to the Angular<br/>// library.<br/>PlotlyModule.<em class="lb">plotlyjs </em>= PlotlyJS;<br/><br/>import { AppComponent } from './app.component';<br/><br/>@NgModule({<br/>  ...<br/>  imports: [<br/>    BrowserModule,<br/>    CommonModule,<br/>    PlotlyModule,<br/>    ...<br/>  ],<br/>  ...<br/>})<br/>export class AppModule { }</span></pre><p id="b9a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这足以让我们使用<code class="du kx ky kz kp b">angular-plotly</code>进行基本的绘图。Plotly支持开箱即用的大量图表<a class="ae jc" href="https://plotly.com/javascript/#basic-charts" rel="noopener ugc nofollow" target="_blank">。</a>各种图表有大量的文档，但出于演示目的，我们将设置一个简单的条形图和折线图。</p><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="5db2" class="jo jp hh kp b fi kt ku l kv kw">...<br/>export class AppComponent {<br/>  title = 'dynamic-plots';</span><span id="2121" class="jo jp hh kp b fi la ku l kv kw">  // Bar Chart<br/>  graph1 = {<br/>    data: [<br/>      { x: [1, 2, 3], y: [2, 3, 4], type: 'bar' },<br/>    ],<br/>    layout: {title: 'Some Data to Hover Over'}<br/>  };</span><span id="13fb" class="jo jp hh kp b fi la ku l kv kw">  // Line chart<br/>  graph2 = {<br/>    data: [<br/>      { x: [1, 2, 3, 4, 5], y: [1, 4, 9, 4, 1], type: 'scatter' },<br/>      { x: [1, 2, 3, 4, 5], y: [1, 3, 6, 9, 6], type: 'scatter' },<br/>      { x: [1, 2, 3, 4, 5], y: [1, 2, 4, 5, 6], type: 'scatter' },<br/>    ],<br/>    layout: {title: 'Some Data to Highlight'}<br/>  };<br/>}</span></pre><p id="6c33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将一些基本数据作为属性<code class="du kx ky kz kp b">graph1</code>和<code class="du kx ky kz kp b">graph2</code>放入应用程序组件。为了渲染，我们需要像这样将数据和布局绑定到plotly组件。</p><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="7bfb" class="jo jp hh kp b fi kt ku l kv kw">&lt;plotly-plot<br/>  [data]="graph1.data"<br/>  [layout]="graph1.layout"<br/>  [useResizeHandler]="true"&gt;&lt;/plotly-plot&gt;<br/><br/>&lt;plotly-plot<br/>  [data]="graph2.data"<br/>  [layout]="graph2.layout"<br/>  [useResizeHandler]="true"&gt;&lt;/plotly-plot&gt;<br/></span></pre><p id="a694" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果一切都连接正确，应用程序将在加载时呈现两个图。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/094de819762c0de5122d3b71590ed508.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNISwmekq86zn4rlbpRlcQ.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">基本情节——我们将在下一节制作动画。</figcaption></figure><h2 id="4775" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">用plotly事件和RXJS制作动画</h2><p id="0289" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">我们的目标是当用户将鼠标悬停在条形图上时，动画显示折线图。作为一个简单的动画，当用户悬停在第n个条形上时，我们将只使用第n条线重新绘制折线图。当用户不悬停时，我们将显示所有的线。</p><p id="a3e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从根本上说，我们需要折线图来订阅绘图数据流。这是<a class="ae jc" href="https://www.learnrxjs.io/learn-rxjs/subjects/behaviorsubject" rel="noopener ugc nofollow" target="_blank">RXJS</a>T4的一大用处。在RXJS中，主体既是可观察的，也是事件的发出者。在我们的应用程序中，绘图必须观察数据流，我们需要发出数据流来响应悬停事件。我们使用<code class="du kx ky kz kp b">BehaviorSubject</code>是因为它允许我们设置初始值。</p><p id="4fa3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用程序组件:</p><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="0dee" class="jo jp hh kp b fi kt ku l kv kw">...<br/>export class AppComponent {</span><span id="b481" class="jo jp hh kp b fi la ku l kv kw">...</span><span id="d45f" class="jo jp hh kp b fi la ku l kv kw">// Initialize a behavior subject to return the line chart data<br/>interactivePlotSubject$: Subject&lt;any&gt; = new BehaviorSubject&lt;any&gt;(this.graph2.data);</span><span id="3d29" class="jo jp hh kp b fi la ku l kv kw">// We'll bind the hover event from plotly<br/>hover(event: any): void {<br/>  // The hover event has a lot of information about cursor location.<br/>  // The bar the user is hovering over is in "pointIndex"</span><span id="5bdc" class="jo jp hh kp b fi la ku l kv kw">  this.interactivePlotSubject$.next(<br/>    [this.graph2.data[event.points[0]].pointIndex]]<br/>  );<br/>}</span><span id="3230" class="jo jp hh kp b fi la ku l kv kw">// Reset to default when hovering stops<br/>mouseLeave(event): void {<br/>  this.interactivePlotSubject$.next(this.graph2.data);<br/>}</span></pre><p id="a39c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">plotly Angular库导出完整的plotly事件集。我们对其中的两个<code class="du kx ky kz kp b">(hover)</code>和<code class="du kx ky kz kp b">(mouseleave)</code>感兴趣。我们修改前面的模板来绑定我们的方法:</p><pre class="jd je jf jg fd ko kp kq kr aw ks bi"><span id="b2db" class="jo jp hh kp b fi kt ku l kv kw">    &lt;plotly-plot<br/>       [data]="graph1.data"<br/>       [layout]="graph1.layout"<br/>       [useResizeHandler]="true"<br/>       (hover)="hover(<strong class="kp hi"><em class="lb">$event</em></strong>)"<br/>       (mouseleave)="mouseLeave(<strong class="kp hi"><em class="lb">$event</em></strong>)"&gt;&lt;/plotly-plot&gt;<br/><br/>    &lt;plotly-plot<br/>       [data]="(interactivePlotSubject$ | async)"<br/>       [layout]="graph2.layout"<br/>       [useResizeHandler]="true"&gt;&lt;/plotly-plot&gt;</span></pre><p id="8663" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就是hover工作的全部内容:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">将鼠标悬停在图表1上以突出显示图表2</figcaption></figure><h2 id="f54f" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">结论</h2><p id="70d8" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">在我的许多数据可视化工作中，我使用悬停事件来绑定多个图。Plotly公开了大量的事件类型，这些事件类型支持丰富的数据可视化体验。将它们集成到仪表板中是UX的一大胜利。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lj"><img src="../Images/5e69a90be254258e84a66717cf87a1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-kZZEYkei6bHyCIQcOnfg.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">一场伟大的比赛</figcaption></figure></div></div>    
</body>
</html>