<html>
<head>
<title>LAUNCHING INFRASTRUCTURE USING TERRAFORM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TERRAFORM启动基础设施</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/launching-infrastructure-using-terraform-75ab95fdc9dd?source=collection_archive---------22-----------------------#2021-01-15">https://medium.com/analytics-vidhya/launching-infrastructure-using-terraform-75ab95fdc9dd?source=collection_archive---------22-----------------------#2021-01-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/8d9b3c8b4c9ac63936ef457c762fc09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*eg-WhO0sQIcuoM0PIQwnHA.png"/></div></figure><p id="2312" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是我关于Terraform的第一篇文章，在这篇文章中，我将讲述Terraform的概述和使用Terraform创建EC2实例。</p><p id="ced1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">所以，首先想到的问题是！什么是Terraform？</p><p id="dbb8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">嗯，terraform是一个IAC(Infrastructure as a Code)工具，用于构建、更改和版本控制基础设施，它支持许多流行的云提供商，包括亚马逊AWS。</p><p id="ee69" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">本指南将带您了解使用简单的配置文件和Terraform provider配置单个实例的基本知识。</p><p id="97e8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在我们开始之前，有几个额外条件:</p><p id="8dba" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> </strong>配置您的AWS凭证。</p><p id="5d7a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> </strong>熟悉命令行(PowerShell)。</p><p id="e257" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">前往<a class="ae jj" href="https://www.terraform.io/downloads.html" rel="noopener ugc nofollow" target="_blank"> Terraform下载页面</a>，获取你的操作系统的最新版本。</p><p id="1141" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要检查是否安装了terraform，请打开CMD并运行以下命令:</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/97cf63a9edf9bac82b4ec03757f0b257.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*_HsyP1Wq0Yzr0LFxc7zS5Q.png"/></div></figure><p id="3e99" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如您所见，<strong class="in hi"> terraform版本</strong>告诉我们您的系统中安装了哪个版本，从而确认terraform已成功配置。</p><p id="68e5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">首先，创建一个terraform目录，并使用该目录存储所有的terraform模板。请记住，您的terraform文件的名称将始终以<em class="jp">结尾。tf </em>延伸。</p><p id="b9d5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用命令，<strong class="in hi">记事本【文件名】。tf </strong></p><p id="aa95" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这将创建一个新文件，我们将用它来创建地形模板。在这个演示中，我使用记事本作为创建terraform模板的文本编辑器，但是您也可以选择自己喜欢的文本编辑器。</p><p id="c44a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用Terraform的第一步通常是配置要使用的提供者。创建一个名为<em class="jp"> ec2.tf </em>的文件，并将以下代码放入其中:</p><blockquote class="jq jr js"><p id="1eb1" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh">供应商“AWS”{</em></p><p id="2127" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh"> region = "us-west-1" </em></p><p id="9a35" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh"> } </em></p></blockquote><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jw"><img src="../Images/60949ec427c59af89d6beb0a84cab7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*WSMbLAi79J8MxupDrmVgYQ.png"/></div></figure><p id="c95c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这告诉Terraform，您将使用AWS提供商，并且您希望在us-east-1地区部署您的基础架构(AWS在世界各地都有数据中心，分为不同的区域和可用性区域，us-east-1是位于N. Virginia的数据中心的名称)</p><p id="fb87" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你使用的是联邦账户(比如educate)，那么你可以使用上面的代码，只需更新<em class="jp">。aws/credentials </em>文件，如果您是IAM用户，那么您必须遵循</p><blockquote class="jq jr js"><p id="b806" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh">供应商“AWS”{</em></p><p id="ed2a" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh"> region = "us-west-1" </em></p><p id="aafc" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh">ACCESS _ KEY = " YOUR _ ACCESS _ KEY "</em></p><p id="9fb4" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh">秘密密钥= "你的秘密密钥"</em></p><p id="4aa9" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh"> } </em></p></blockquote><p id="4c3b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">此模板用于配置IAM身份证明，以便与AWS一起使用。</p><p id="7b92" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">接下来，您将指定想要使用的资源。Terraform资源的一般语法是:</p><blockquote class="jq jr js"><p id="97dd" class="il im jp in b io ip iq ir is it iu iv jt ix iy iz ju jb jc jd jv jf jg jh ji ha bi translated"><em class="hh">资源"&lt;提供者&gt; _ &lt;类型&gt; " " &lt;名称&gt; " { <br/>【配置…】<br/>}</em></p></blockquote><p id="e8bf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">其中<em class="jp"> PROVIDER </em>是提供者的名称(例如aws)，<em class="jp"> TYPE </em>是在该提供者中创建的资源类型(例如实例)，<em class="jp"> NAME </em>是一个标识符，您可以在整个Terraform代码中使用它来引用该资源(例如terra-ec2)，而<em class="jp"> CONFIG </em>由一个或多个特定于该资源的<em class="jp">参数</em>组成。</p><p id="536e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于这个演示，我们只是启动一个ec2实例，因此模板也相应地进行了设置。</p><p id="df7d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于aws_instance资源，有许多不同的参数，您可以在<a class="ae jj" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/instance" rel="noopener ugc nofollow" target="_blank"> terraform文档</a>中查看它们。</p><p id="fefc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当第一次开始使用Terraform时，您需要运行<strong class="in hi"> terraform init </strong>来告诉terraform扫描代码，找出您正在使用的提供者，并为他们下载代码。</p><p id="58f3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">默认情况下，提供者代码将被下载到<em class="jp">中。terraform </em>文件夹，是terraform的暂存目录。每当您开始新的Terraform代码时，您都需要运行init，并且多次运行init是安全的(该命令是幂等的)。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jx"><img src="../Images/fbaff9a38e0e8f02543946b75dbbf19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*IKRjLOs3U1YsAlP6bwsCcw.png"/></div></figure><p id="ba15" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在您已经下载了提供者代码，运行<strong class="in hi"> terraform plan </strong>命令。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jw"><img src="../Images/fa135ff2d9937f4fb98d5ebf6320bc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*SAK_ZPAnCJGXiqe0IcGIbQ.png"/></div></figure><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jw"><img src="../Images/a676cff4592a88b1bb13dd48dc8dc424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*NRcgT0RQVdxhMIXsjl2Yxw.png"/></div></figure><p id="b313" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Terraform生成一个<strong class="in hi">执行计划，</strong>描述它将做什么来达到期望的状态，然后执行它来构建所描述的基础设施。</p><p id="13fa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">带有加号(+)的资源将被创建，带有减号(-)的资源将被删除，带有波浪号(~)的资源将被就地修改。在上面的输出中，您可以看到Terraform计划创建一个EC2实例，这正是我们想要的。</p><p id="7e7f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">出现提示时，输入<em class="jp">是</em>。</p><p id="fbb4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用命令<strong class="in hi"> terraform apply </strong>开始将配置部署到您的基础架构。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jy"><img src="../Images/cc7f3de20f742b7d58c37ca169a53b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*mm5MNOi-G3uf3YWjb2Kwgw.png"/></div></figure><p id="af13" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">加载配置后，将要求您确认计划的操作。出现提示时，输入<em class="jp">是</em>。</p><p id="7293" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，您已经使用Terraform在AWS帐户中部署了一个EC2实例。让我们检查它是否被创建。打开AWS控制台并转到EC2。请注意您的终端上显示的实例ID和EC2仪表板上显示的实例ID。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jx"><img src="../Images/df1c8e805c0df8a838188d6309b8bf38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Q4azrCVS5gtfYFW9phbJjw.png"/></div></figure><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jw"><img src="../Images/efdf050b6e68cfc985cea4b238acf08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*y7dOwe-0y9OYtsiu_t7Xcg.png"/></div><figcaption class="jz ka et er es kb kc bd b be z dx translated">EC2仪表板</figcaption></figure><p id="6177" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="jp">祝贺您，您刚刚从代码中部署了基础设施！</em></p><p id="5910" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要删除实例，使用<strong class="in hi"> terraform destroy </strong>命令。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jw"><img src="../Images/489680b5ab1b9f3ac9646c8940a58b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*jTx6liMxYoJZDRtVOWj2Zw.png"/></div></figure><p id="9707" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Terraform将要求确认删除。键入<em class="jp"> yes </em>并按回车键。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es kd"><img src="../Images/ed0029d87b1344833b9c71c10eaad117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*w7j43t5wNA56MZJcG6zb-A.png"/></div></figure><p id="1c4e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">转到您的EC2仪表板，检查实例状态。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jw"><img src="../Images/e4c87973af6811093b25cedf74422de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*vCbMf34A4hwxMwOWJK20gA.png"/></div></figure><p id="590d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是对Terraform的基本介绍&amp;我们已经部署了第一个EC2实例，并使用Terraform删除了它。</p><p id="b65a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你觉得这篇文章有帮助，请鼓掌。</p><p id="1822" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="jp">谢谢！！</em></p></div></div>    
</body>
</html>