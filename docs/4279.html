<html>
<head>
<title>What is RFM Analysis? An Applied Example in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是RFM分析？Python中的一个应用实例</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/what-is-rfm-analysis-an-applied-example-in-python-1979b9853f0b?source=collection_archive---------1-----------------------#2021-09-16">https://medium.com/analytics-vidhya/what-is-rfm-analysis-an-applied-example-in-python-1979b9853f0b?source=collection_archive---------1-----------------------#2021-09-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d4c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大家好。在这个故事中，我们将介绍什么是RFM分析，并且我们将看到Python中的一个应用示例。我会在这里解释代码的含义，我也会在Kaggle中分享代码。你可以从<a class="ae jc" href="https://www.kaggle.com/enesbaysan/rfm-analysis-in-python" rel="noopener ugc nofollow" target="_blank">这里</a>访问Kaggle笔记本。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/6cf40e1bf7659afc21fa6401d4559a54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pv2AJGKWmqbFC9NjAWXuCg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jc" href="https://unsplash.com/@isaacmsmith?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">艾萨克·史密斯</a>在<a class="ae jc" href="https://unsplash.com/s/photos/customer-analysis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="d06f" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是RFM？</h1><p id="d5d2" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">RFM是使用RFM指标对客户进行细分的过程。我们将RFM指标标准化，从而得到细分市场。创建细分后，我们通过使用这些细分来采取行动。RFM非常适合销售数据。</p><p id="b210" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">RFM分析可以应用于不同的钟表，以便我们可以比较他们的结果。我们可以根据这些结果来衡量和评估所采取的措施和成本。</p><p id="cb8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">RFM有两个基本术语:度量和分数。</p><h2 id="de57" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">RFM度量</h2><p id="2ca2" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">实际上，RFM是基于这三个指标而产生的。</p><ul class=""><li id="22af" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated">紧急情况</li><li id="821d" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><strong class="ig hi"> F </strong>频率</li><li id="f17e" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">一元钱</li></ul><p id="7f70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近时间表示客户最后一次购买是在多少天前。</p><p id="f9ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">频率表示客户购买的总次数。</p><p id="bb88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">货币表示客户购买的总付款。</p><h2 id="1261" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">RFM得分</h2><p id="8375" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们通过标准化1到5之间的RFM指标来获得RFM分数。</p><h2 id="a11c" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">RFM分析步骤</h2><ul class=""><li id="e4e9" class="lk ll hh ig b ih kr il ks ip ly it lz ix ma jb lp lq lr ls bi translated">RFM度量标准在1到5之间</li><li id="be65" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">通过使用标准化的RFM指标获得RFM分数</li><li id="95af" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">连接分数(例如:325)</li><li id="9ac7" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">使用串联分数创建细分市场</li><li id="ccf4" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">我们可以通过使用分段来采取行动</li></ul><h2 id="9c0c" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">RFM电网</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mb"><img src="../Images/0dfcb9d0f30a0c81b8ab7de42c02f43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*oUKMc3gk53hccFX4YNeu1g.png"/></div></figure><p id="ec02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以假设</p><ul class=""><li id="09e3" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated">当R值上升时，客户刚刚进行了购买</li><li id="b308" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">随着F值的上升，顾客会购买更多的东西</li><li id="c2bc" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">随着M值的上升，我们从客户那里赚得更多</li></ul><p id="9262" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们不应该忘记，当我们计算这些分数时，我们是将所有客户一起计算的。</p><h1 id="a806" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Python中RFM分析的应用实例</h1><p id="3a09" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">在本节中，我们将使用<a class="ae jc" href="https://www.kaggle.com/nathaniel/uci-online-retail-ii-data-set" rel="noopener ugc nofollow" target="_blank">这个</a>数据集。还有，你可以从<a class="ae jc" href="https://archive.ics.uci.edu/ml/datasets/Online+Retail+II" rel="noopener ugc nofollow" target="_blank">这里</a>得到。</p><h2 id="8651" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">加载数据</h2><p id="d2da" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我准备在笔记本里导入<code class="du mc md me mf b">pandas</code>和<code class="du mc md me mf b">datetime</code>。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="d854" class="kw ju hh mf b fi mk ml l mm mn">import pandas as pd<br/>from datetime import datetime</span></pre><p id="7e4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将使用<code class="du mc md me mf b">datetime</code>来创建<code class="du mc md me mf b">today_date</code>变量。因为数据集包含2009年到2011年的数据，我们将在2010年到2011年间使用它。所以我们需要在2010年和2011年之间创建一个日期。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="0531" class="kw ju hh mf b fi mk ml l mm mn">raw_data = pd.read_excel('../input/uci-online-retail-ii-data-set/online_retail_II.xlsx',sheet_name='Year 2010-2011')</span><span id="d837" class="kw ju hh mf b fi mo ml l mm mn">df = raw_data.copy()</span><span id="f345" class="kw ju hh mf b fi mo ml l mm mn">df.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/e39c39b2a14562e583e7b294197991df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yanost1KKvx-PYBS2kAJ7A.png"/></div></div></figure><p id="753b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我想停止编码一点来解释变量的含义。</p><ul class=""><li id="26e3" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated">发票:发票编号。如果这个号码以“C”开头，就意味着这个交易取消了。</li><li id="a925" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">库存代码:产品代码</li><li id="c2ce" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">描述:产品名称</li><li id="69cd" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">数量:产品数量</li><li id="c6f0" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">发票日期:交易日期</li><li id="2395" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">价格:单个产品价格</li><li id="572c" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">CustomerID:唯一的客户号</li><li id="c981" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">国家:客户的国家名称</li></ul><p id="8e73" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以向数据集提出一些问题，并获得一些见解，就像我们在之前做的<a class="ae jc" rel="noopener" href="/@mebaysan/rule-based-customer-segmentation-without-ml-6d194648813d">一样，但我不会这样做。因为我现在想专注于主题。</a></p><h2 id="136c" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">删除空值</h2><p id="f05f" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我将删除所有空值。在这种情况下，我不想和他们争。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="7ea3" class="kw ju hh mf b fi mk ml l mm mn">df.dropna(inplace=True)</span></pre><h2 id="549e" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">筛选已取消的交易记录</h2><p id="3d54" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们知道，如果发票变量以“C”开头，它的意思是取消交易。因此，我想把它们从数据集中过滤掉。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="6e2f" class="kw ju hh mf b fi mk ml l mm mn">df = df[~df['Invoice'].str.contains('C', na=False)]</span></pre><h2 id="0549" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">应用RFM</h2><p id="66b2" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">如上所述，我需要创建一个旧日期。为此，我将使用<code class="du mc md me mf b">datetime</code>。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="a0c3" class="kw ju hh mf b fi mk ml l mm mn">today_date = datetime(2011, 12, 11)</span></pre><p id="7a8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我正在计算每个客户的RFM指标。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="0753" class="kw ju hh mf b fi mk ml l mm mn">rfm = df.groupby('Customer ID').agg({<br/>    'InvoiceDate': lambda x: (today_date - x.max()).days,<br/>    'Invoice': lambda x: x.nunique(),<br/>    'TotalPrice': lambda x: x.sum()<br/>})</span><span id="d2ae" class="kw ju hh mf b fi mo ml l mm mn">rfm.columns = ['recency', 'frequency', 'monetary']</span><span id="22a6" class="kw ju hh mf b fi mo ml l mm mn">rfm = rfm[rfm['monetary'] &gt; 0]</span></pre><p id="4607" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第一段代码中，我们已经为每个客户计算了RFM指标。</p><ul class=""><li id="e014" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated">在第一个汇总过程中，我们计算了R值。我们从<code class="du mc md me mf b">today_date</code>变量中为每个客户挖掘最后一次购买。</li><li id="036f" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">在第二个汇总过程中，我们计算了F值。我们统计了每个客户的独特交易。</li><li id="4c56" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">在第三个聚合过程中，我们计算了M值。我们合计了每个客户的交易金额。</li></ul><p id="8821" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第二部分中，我们重命名了<code class="du mc md me mf b">rfm</code>数据集的列。</p><p id="8d7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这一部分的最后，我们筛选了客户，选择了那些货币价值大于0的客户。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="5c69" class="kw ju hh mf b fi mk ml l mm mn">rfm.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mq"><img src="../Images/f8ccc11cf3e556fecc7dd4b433e56851.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*faX2g6AG8ZRkJoJSDKM55Q.png"/></div></figure><h2 id="4332" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated"><strong class="ak">对RFM指标评分</strong></h2><p id="f3b6" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">现在我们需要对指标进行评分。为此，我将使用<code class="du mc md me mf b">pandas</code>中的<code class="du mc md me mf b">qcut</code>函数。该函数对数据集列进行升序排序，并将其除以四分位数，然后使用<code class="du mc md me mf b">labels</code> arg标记这些值。你可以从<a class="ae jc" href="https://towardsdatascience.com/all-pandas-qcut-you-should-know-for-binning-numerical-data-based-on-sample-quantiles-c8b13a8ed844" rel="noopener" target="_blank">这里</a>获得更多关于<code class="du mc md me mf b">qcut</code>功能的信息。</p><p id="62a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我获得了下面的<code class="du mc md me mf b">recency</code>指标。在这里你可能会问，如果<code class="du mc md me mf b">qcut</code>按升序排序，为什么我要把标签从大到小设置呢？我的答案是:因为如果最近度越小，分数就越大。所以，如果最近值在第一个四分位数，我应该给它打5分。因为最近值越小，表示日期越近，这就是我们的目标。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="2735" class="kw ju hh mf b fi mk ml l mm mn">rfm.loc[:, 'recency_score'] = pd.qcut(rfm['recency'], 5, [5, 4, 3, 2, 1])</span></pre><p id="850d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我需要对<code class="du mc md me mf b">frequency</code>指标进行评分。我会用同样的技术得分，但有一点很重要；我们将使用<code class="du mc md me mf b">rank</code>方法。如果你不知道排名法是什么，我准备掉几篇文章学习一下。</p><ul class=""><li id="d842" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated"><a class="ae jc" href="https://www.w3resource.com/pandas/dataframe/dataframe-rank.php" rel="noopener ugc nofollow" target="_blank">熊猫DataFrame: rank()函数</a></li><li id="b1c1" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><a class="ae jc" href="https://www.geeksforgeeks.org/python-pandas-dataframe-rank/" rel="noopener ugc nofollow" target="_blank">Python | Pandas data frame . rank()</a></li><li id="e2a5" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><a class="ae jc" href="https://www.dataindependent.com/pandas/pandas-rank/" rel="noopener ugc nofollow" target="_blank">熊猫排名—给你的数据排名— pd.df.rank() </a></li></ul><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="5cc5" class="kw ju hh mf b fi mk ml l mm mn">rfm.loc[:, 'frequency_score'] = pd.qcut( rfm["frequency"].rank(method="first"), 5, labels=[1, 2, 3, 4, 5])</span></pre><p id="2464" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了完成这一部分，我们需要连接RFM分数。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="874e" class="kw ju hh mf b fi mk ml l mm mn">rfm.loc[:, 'RFM_SCORE'] = rfm['recency_score'].astype(<br/>    str) + rfm['frequency_score'].astype(str)</span><span id="26d4" class="kw ju hh mf b fi mo ml l mm mn">rfm.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mr"><img src="../Images/daa25e2b46966fba48b31f00e2ae54dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*sYlJW6PCtS6jhm1J9s51lQ.png"/></div></figure><h2 id="4b55" class="kw ju hh bd jv kx ky kz jz la lb lc kd ip ld le kh it lf lg kl ix lh li kp lj bi translated">标记RFM分数</h2><p id="0947" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">在这一节中，我们将标记<code class="du mc md me mf b">rfm</code>数据集中的<code class="du mc md me mf b">RFM_SCORE</code>列。我已经使用regex创建了一个标记分数的字典。</p><pre class="je jf jg jh fd mg mf mh mi aw mj bi"><span id="f55a" class="kw ju hh mf b fi mk ml l mm mn">seg_map = {<br/>    r'[1-2][1-2]': 'hibernating',<br/>    r'[1-2][3-4]': 'at_Risk',<br/>    r'[1-2]5': 'cant_loose',<br/>    r'3[1-2]': 'about_to_sleep',<br/>    r'33': 'need_attention',<br/>    r'[3-4][4-5]': 'loyal_customers',<br/>    r'41': 'promising',<br/>    r'51': 'new_customers',<br/>    r'[4-5][2-3]': 'potential_loyalists',<br/>    r'5[4-5]': 'champions'<br/>}</span><span id="21b1" class="kw ju hh mf b fi mo ml l mm mn">rfm['segment'] = rfm['RFM_SCORE'].replace(seg_map, regex=True)</span><span id="c44b" class="kw ju hh mf b fi mo ml l mm mn">rfm.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/9d14fa46589a2db9784c95a13d519f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uw7Gbwcjz26yhch3-bA6KQ.png"/></div></div></figure><p id="8828" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">是的，我们和RFM结束了。希望它是有帮助的和清楚的。</p><p id="805c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">亲切的问候。</p></div></div>    
</body>
</html>