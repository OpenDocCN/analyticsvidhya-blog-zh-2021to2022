<html>
<head>
<title>Integrating TensorFlow Lite with Flutter for Computer Vision</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将TensorFlow Lite与Flutter集成用于计算机视觉</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/integrating-tensorflowlite-with-flutter-for-computer-vision-6c82d1e5bccd?source=collection_archive---------7-----------------------#2021-02-22">https://medium.com/analytics-vidhya/integrating-tensorflowlite-with-flutter-for-computer-vision-6c82d1e5bccd?source=collection_archive---------7-----------------------#2021-02-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/3c192f076ebfb7026bd6e8212632636e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*fIkkHAkFftuLHSpr_Gr7nA.png"/></div></figure><p id="71a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你有没有想过制作一个使用人工智能在旅途中进行预测的移动应用程序？你并不孤单。作为我在学校项目的一部分，我必须制作一个使用人工智能对植物疾病进行分类的移动应用程序。你们中的一些人可能已经猜到我使用了CNN(卷积神经网络)。我用TensorFlow对人工智能进行了编码和训练。但最困难的部分出现在我需要将人工智能放入应用程序的时候。</p><p id="3d14" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我试着用传统的方法制作一个android应用程序，并且真的成功了。但是它被组装得很糟糕，这时候Flutter出现了。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/c558ddc4888432e114a354d59ff6d460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dnH9jqNuMJeeo1NXTI7eXw.jpeg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">图片来自<a class="ae jx" href="https://flutter.dev" rel="noopener ugc nofollow" target="_blank"> https://flutter.dev </a></figcaption></figure><p id="8738" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Flutter是谷歌的UI工具包，用于从单一代码库为<a class="ae jx" href="https://flutter.dev/docs" rel="noopener ugc nofollow" target="_blank">移动</a>、<a class="ae jx" href="https://flutter.dev/web" rel="noopener ugc nofollow" target="_blank">网络</a>和<a class="ae jx" href="https://flutter.dev/desktop" rel="noopener ugc nofollow" target="_blank">桌面</a>构建漂亮的本地编译应用。</p><p id="a11e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">尽管设置TensorFlow Lite来使用Flutter比我第一次尝试要容易，但这仍然是一场噩梦。我在这里让你尝试制作比我更容易使用人工智能的Flutter应用程序。</p><p id="abc8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本教程不谈论编码的人工智能，只是TensorFlow建兴文件与Flutter的集成。如果你想了解更多关于人工智能编码的知识，我有一个3部分组成的博客。敬请关注！</p><p id="5570" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这篇博客中，我将向你展示如何使用计算机视觉制作一个Flutter应用程序。不过，我会假设你有一些颤振方面的经验。</p><p id="817c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，您需要一个模型的TensorFlow Lite文件。然后创建一个新的颤振项目。我将在我的桌面上做这个项目，你可以在任何你想做的地方做。在终端/命令提示符下键入:</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="4b54" class="kd ke hi jz b fi kf kg l kh ki">cd desktop<br/>flutter create tutapp</span></pre><p id="8d6b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在您让Flutter创建一个项目文件之后，您可以在编辑器中打开它。本教程我将使用Android Studio，但是您可以使用任何编辑器。</p><p id="844a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先删除“test”文件夹，因为这会给我们带来问题。</p><p id="b33a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在真实设备中运行您的应用程序，因为我们需要使用摄像头的实时反馈。</p><p id="303f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你刚刚开始使用Flutter，你看到的大部分只是一个“入门”代码。可以放心删除，开始做自己的app。我将使用我在<strong class="io hj">我的</strong>应用中使用的人工智能模型。</p><p id="7acc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在lib文件夹中，创建另一个名为“屏幕”的文件夹。在screens文件夹中创建两个名为home.dart和camerascreen.dart的dart文件，然后在主目录中创建一个名为“assets”的文件夹。这个文件夹将有TensorFlow Lite模型和一个. txt文件用于我们的标签。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/13db5fa56548a7f8ac103cd122d6f4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*fPNspoVBlo70gUz5KKZzbg.png"/></div></figure><p id="6e03" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，在您的pubspec.yaml文件中，您需要添加2个依赖项。这是我们运行应用程序所需的两件事。</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="288f" class="kd ke hi jz b fi kf kg l kh ki">camera: 0.5.8+5<br/>tflite:</span></pre><p id="84c0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">之后，您需要向下滚动并更改以下内容:</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="5b0e" class="kd ke hi jz b fi kf kg l kh ki">// assets:<br/>//  - assets/....           (&lt;- Something over here)</span></pre><p id="ed61" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对此:</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="c6b4" class="kd ke hi jz b fi kf kg l kh ki">assets:<br/>  - assets/</span></pre><p id="3159" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将向Flutter声明我们拥有资产(我们的。tflite文件和我们的标签文件),这些资源位于assets文件夹中。</p><p id="a2d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将制作一个非常基本的应用程序，因为我只想向您展示如何集成TensorFlow Lite。在main.dart文件中键入以下代码:</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="c424" class="kd ke hi jz b fi kf kg l kh ki">import 'package:flutter/material.dart';<br/>import 'package:tutapp/screens/home.dart';<br/>import 'package:camera/camera.dart';<br/><br/>List&lt;CameraDescription&gt; cameras;<br/>Future&lt;void&gt; main() async {<br/>  WidgetsFlutterBinding.<em class="kk">ensureInitialized</em>();<br/>  cameras = await availableCameras();<br/>  runApp(MaterialApp(<br/>    debugShowCheckedModeBanner: false,<br/>    home: MyHomePage(<br/>      cameras,<br/>    ),<br/>  ));<br/>}</span></pre><p id="2348" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这段代码只是从设备中获取所有相机的列表，并把它们放在一个列表中，这样我们就可以使用任何我们想要的相机。然后，我们设置我们的应用程序的主页。</p><p id="1a9e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在home.dart文件中，键入以下代码:</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="df5c" class="kd ke hi jz b fi kf kg l kh ki">import 'package:flutter/material.dart';<br/>import 'package:camera/camera.dart';<br/>import 'package:tflite/tflite.dart';<br/>import 'camerascreen.dart';<br/><br/>class MyHomePage extends StatefulWidget {<br/>  final List&lt;CameraDescription&gt; cameras;<br/><br/>  MyHomePage(this.cameras);<br/>  @override<br/>  _MyHomePageState createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  String predOne = '';<br/><br/>  @override<br/>  void initState() {<br/>    super.initState();<br/>    loadTfliteModel();<br/>  }<br/><br/>  loadTfliteModel() async {<br/>    String res;<br/>    res = await Tflite.<em class="kk">loadModel</em>(<br/>        model: "assets/converted_model_mobnet.tflite",<br/>        labels: "assets/Labels.txt");<br/>    print(res);<br/>  }<br/><br/>  setRecognitions(outputs) {<br/>    setState(() {<br/>      predOne = outputs[0]['label'];<br/>    });<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      backgroundColor: Colors.<em class="kk">blueGrey</em>,<br/>      appBar: AppBar(<br/>        centerTitle: true,<br/>        title: Text(<br/>          "TensorFlow Lite App",<br/>        ),<br/>        backgroundColor: Colors.<em class="kk">teal</em>,<br/>      ),<br/>      body: Stack(<br/>        children: [<br/>          Camera(widget.cameras, setRecognitions),<br/>          Align(<br/>            alignment: Alignment.<em class="kk">bottomCenter</em>,<br/>            child: Container(<br/>              height: 100.0,<br/>              decoration: BoxDecoration(<br/>                  color: Colors.<em class="kk">blueGrey</em>,<br/>                  boxShadow: [BoxShadow(color: Colors.<em class="kk">black</em>, blurRadius: 20.0)],<br/>                  borderRadius: BorderRadius.only(<br/>                      topLeft: Radius.circular(50.0),<br/>                      topRight: Radius.circular(50.0))),<br/>              child: Column(<br/>                crossAxisAlignment: CrossAxisAlignment.stretch,<br/>                children: [<br/>                  SizedBox(<br/>                    height: 30.0,<br/>                  ),<br/>                  Text(<br/>                    "$predOne",<br/>                    textAlign: TextAlign.center,<br/>                    style: TextStyle(<br/>                        color: Colors.<em class="kk">tealAccent</em>,<br/>                        fontWeight: FontWeight.<em class="kk">bold</em>,<br/>                        fontSize: 20.0),<br/>                  ),<br/>                ],<br/>              ),<br/>            ),<br/>          )<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="963d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我已经设计了我的应用程序，有一个简单的应用程序栏和一个显示预测的底部栏，在下面我会显示直播摄像头。</p><p id="6eb4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此时，您会看到一些错误。那是因为我们还没有声明一个叫“相机”的小部件。我们现在就去做。在camerascreen.dart文件中键入以下代码:</p><pre class="jl jm jn jo fd jy jz ka kb aw kc bi"><span id="e283" class="kd ke hi jz b fi kf kg l kh ki">import 'package:flutter/material.dart';<br/>import 'package:camera/camera.dart';<br/>import 'package:tflite/tflite.dart';<br/><br/>typedef void Callback(List&lt;dynamic&gt; list);<br/><br/>class Camera extends StatefulWidget {<br/>  final List&lt;CameraDescription&gt; cameras;<br/>  final Callback setRecognitions;<br/><br/>  Camera(this.cameras, this.setRecognitions);<br/>  @override<br/>  _CameraState createState() =&gt; _CameraState();<br/>}<br/><br/>class _CameraState extends State&lt;Camera&gt; {<br/>  CameraController cameraController;<br/>  bool isDetecting = false;<br/><br/>  @override<br/>  void initState() {<br/>    super.initState();<br/>    cameraController =<br/>        CameraController(widget.cameras.first, ResolutionPreset.high);<br/>    cameraController.initialize().then((value) {<br/>      if (!mounted) {<br/>        return;<br/>      }<br/>      setState(() {});<br/><br/>      cameraController.startImageStream((image) {<br/>        if (!isDetecting) {<br/>          isDetecting = true;<br/>          Tflite.<em class="kk">runModelOnFrame</em>(<br/>            bytesList: image.planes.map((plane) {<br/>              return plane.bytes;<br/>            }).toList(),<br/>            imageHeight: image.height,<br/>            imageWidth: image.width,<br/>            numResults: 1,<br/>          ).then((value) {<br/>            if (value.isNotEmpty) {<br/>              widget.setRecognitions(value);<br/>              isDetecting = false;<br/>            }<br/>          });<br/>        }<br/>      });<br/>    });<br/>  }<br/><br/>  @override<br/>  void dispose() {<br/>    cameraController?.dispose();<br/>    super.dispose();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    if (!cameraController.value.isInitialized) {<br/>      return Container();<br/>    }<br/><br/>    return Transform.scale(<br/>      scale: 1 / cameraController.value.aspectRatio,<br/>      child: Center(<br/>        child: AspectRatio(<br/>          aspectRatio: cameraController.value.aspectRatio,<br/>          child: CameraPreview(cameraController),<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="ca3b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们希望检测每一帧，因此我们称之为“Tflite”。<em class="kk"> runModelOnFrame </em>"每次微件(相机)重建时。我们通过将必要的代码放入“initState”中来实现这一点。因为这个任务是一个异步任务，我们让Flutter知道(使用布尔isDetecting)现在我们希望我们的应用程序进行预测，而现在我们没有。AspectRatio是显示摄像头馈送所必需的，Transform小部件只是将视频馈送缩放到设备的屏幕大小，以便摄像头馈送和屏幕边缘之间没有任何难看的间隙。我们将“setRecognitions”回调传递给这个小部件，这是我们在home.dart中定义的，因为我们希望将输出传递给主页，在主页上我们将标签分配给一个变量，然后将该变量显示为预测。</p><p id="8abd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就是这样！您可以修改代码来显示预测的可信度，甚至可以从“Tflite”中获得2或3个顶级标签。<em class="kk"> runModelOnFrame </em>方法。为了显示这些变量，你可能需要进行空间调整，而Flutter很容易做到这一点。但除此之外，我们准备好了！</p><p id="f405" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">需要记住的几件事是:您需要确保Labels.txt文件的条目数与TensorFlow模型的训练类数相同。此外，当你第一次尝试打开应用程序时，它可能无法工作，因为你需要给它访问手机摄像头的权限。只需重启应用程序，你就可以了。</p><p id="cc15" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以这就是你如何用计算机视觉制作一个Flutter应用程序。如果你想了解<strong class="io hj">如何</strong>制作这些模型，请继续关注，因为接下来的三篇博客将会是关于这些的。如果你喜欢这个博客，分享它并在Medium上关注我。</p><p id="21f9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>