<html>
<head>
<title>NumPy - The BIG picture and WORTHY insights</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NumPy -大图和有价值的见解</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/numpy-the-big-picture-and-worthy-insights-ae33ef0dbcc4?source=collection_archive---------24-----------------------#2021-01-06">https://medium.com/analytics-vidhya/numpy-the-big-picture-and-worthy-insights-ae33ef0dbcc4?source=collection_archive---------24-----------------------#2021-01-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/6aba46d93b52a07e34d51727dabe511b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*htL9RL4Z9EG2YbrSyuYNrw.jpeg"/></div></figure><p id="b396" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">NumPy使得在PYTHON中进行计算变得简单而快速。NumPy是Python编程语言的一个库，增加了对大型多维数组和矩阵的支持，以及对这些数组进行操作的大量高级数学函数。</p><p id="1edf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">根据NumPy官方文档:NumPy将C和Fortran等语言的计算能力引入Python，这是一种更容易学习和使用的语言。伴随这种能力而来的是简单性:NumPy中的解决方案通常是清晰而优雅的。</p><p id="6cfc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将参观NumPy的一些特殊区域，以充分了解和欣赏它的伟大之处。</p><h1 id="4d2b" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">首先，让我们看看为什么Python中的循环比C语言慢</strong></h1><p id="daee" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">一个聪明的C编译器可能会通过识别到最后，<code class="du km kn ko kp b">a</code>将总是1来优化你的循环。Python做不到这一点，因为在迭代<code class="du km kn ko kp b">xrange</code>时，它需要在<code class="du km kn ko kp b">xrange</code>对象上调用<code class="du km kn ko kp b">__next__</code>，直到它引发<code class="du km kn ko kp b">StopIteration</code>。python直到调用它才能知道<code class="du km kn ko kp b">__next__</code>是否会有副作用，所以没有办法优化掉循环。从这一段中得到的启示是，优化python“编译器”比优化C编译器要困难得多，因为Python是一种动态语言，需要编译器知道对象在特定环境下的行为。在C中，这要容易得多，因为C提前知道每个对象的确切类型。</p><p id="0c2f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当然，除了编译器，python还需要做更多的工作。在<code class="du km kn ko kp b">C</code>中，你使用<strong class="in hi">硬件指令</strong>中支持的操作来处理基本类型。在python中，解释器在<strong class="in hi">软件</strong>中一次解释一行字节码。显然，这将比机器指令花费更长的时间。数据模型(例如一遍又一遍地调用<code class="du km kn ko kp b">__next__</code>也可能导致大量C不需要做的函数调用。当然，python做这些事情是为了让它比编译语言更加灵活。</p><h1 id="5623" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">以NumPy(NumPy . ndarray . stamps)为单位的大步数</strong></h1><p id="f5dc" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">数组的<strong class="in hi">步幅</strong>告诉我们要沿着某个轴移动到下一个位置，我们必须在内存中跳过多少字节。例如，我们必须跳过4个字节(1个值)来移动到下一列，但是需要20个字节(5个值)才能到达下一行的相同位置。</p><pre class="kq kr ks kt fd ku kp kv kw aw kx bi"><span id="23b9" class="ky jk hh kp b fi kz la l lb lc">In [1]: import numpy as np<br/>In [2]: <!-- -->a=np.arange(1,13,1)<br/>In [3]: <!-- -->a=a.reshape(3,4)<br/>In [4]: <!-- -->print(a.dtype)<br/>In [4]: <!-- -->print(a.strides)<br/>Out[3]: <!-- -->int32<br/>(16, 4)</span><span id="3fdc" class="ky jk hh kp b fi ld la l lb lc">abytes = a.ravel().view(dtype = np.uint8)<br/>print(abytes[:24])<br/>&gt;&gt;[1 0 0 0 2 0 0 0 3 0 0 0 4 0 0 0 5 0 0 0 6 0 0 0]</span><span id="a5c5" class="ky jk hh kp b fi ld la l lb lc">abytes[1]=2<br/>a.ravel()[0]<br/># 256^1 * 2 + 256^0 * 1<br/>&gt;&gt;513</span></pre><h1 id="1398" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">矢量化</strong></h1><p id="4392" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated"><strong class="in hi">技巧1: </strong>我们可以使用整数索引的1D矩阵任意索引2D矩阵的任何一行。</p><figure class="kq kr ks kt fd ii er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/99e2a58bae722c6202e2897cb4d6909e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9haFUzsfACxr1FEKTSV2KA.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">10×3矩阵x的一维行索引。</figcaption></figure><p id="4589" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">技巧2: 我们可以使用整数索引的2D矩阵来索引2D矩阵的行的任何2D子矩阵</p><figure class="kq kr ks kt fd ii er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/7606df030d137c098edb53e26c9fd085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQPGo82jFKk6g_qOpIzS0w.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">矩阵x的二维行索引。</figcaption></figure><h1 id="ee4e" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">高级索引</strong></h1><p id="c6ab" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">我们也可以做整数列表和布尔索引！！我们可以使用index作为一个N维数组，类型为boolean或integer或tuple序列。假设我们有一个一维NumPy数组A，假设A=[1，2，3，4，5，6，7，8，9]。现在从A中提取3，5和6，我们可以列出需要显示的索引。我们使index=[2，4，5]。</p><p id="9dc9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">神奇的是:一个[index]给了我们array(3，5，6)。</p><p id="5b3d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们只能在一次操作中多次访问一个索引。</p><p id="bbf8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们也可以给出一个布尔条件作为索引！</p><pre class="kq kr ks kt fd ku kp kv kw aw kx bi"><span id="9553" class="ky jk hh kp b fi kz la l lb lc">In [1]: import numpy as np<br/>In [2]: arr = np.array([1, -3, 2, -4, 5])<br/>In [3]: arr[arr&lt;0]<br/>Out[3]: array([-3, -4])</span></pre><h1 id="94fc" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">广播</strong></h1><p id="34cb" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">术语广播描述了numpy在算术运算中如何处理不同形状的数组。在某些约束条件下，较小的阵列在较大的阵列中“广播”,以便它们具有兼容的形状。广播提供了一种向量化数组操作的方法，因此循环在C而不是Python中发生。这样做不会产生不必要的数据副本，并且通常会导致高效的算法实现。然而，在有些情况下，广播并不是一个好主意，因为它会导致内存使用效率低下，从而降低计算速度。</p><p id="be82" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Brodcasting允许我们对两个不同大小的数组进行操作，但它有一定的规则要遵循。</p><figure class="kq kr ks kt fd ii er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ln"><img src="../Images/67d8a2fd03b9837127508fa58d0fd064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqEqbY167CtHFXUWMzZPdA.png"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">广播规则</figcaption></figure><p id="847d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">广播提供了一种获取两个数组的外积(或任何其他外运算)的便捷方法。以下示例显示了两个一维数组的外部加法运算:</p><pre class="kq kr ks kt fd ku kp kv kw aw kx bi"><span id="ed88" class="ky jk hh kp b fi kz la l lb lc">&gt;&gt;&gt; a = np.array([0.0, 10.0, 20.0, 30.0])<br/>&gt;&gt;&gt; b = np.array([1.0, 2.0, 3.0])<br/>&gt;&gt;&gt; a[:, np.newaxis] + b<br/>array([[  1.,   2.,   3.],<br/>       [ 11.,  12.,  13.],<br/>       [ 21.,  22.,  23.],<br/>       [ 31.,  32.,  33.]])</span></pre><p id="0c41" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最后，我们来看看StackOverflow上提到的NumPy上的一些著名问题:</p><blockquote class="lo lp lq"><p id="5f54" class="il im lr in b io ip iq ir is it iu iv ls ix iy iz lt jb jc jd lu jf jg jh ji ha bi translated">如何在不截断的情况下打印完整的NumPy数组？</p></blockquote><pre class="kq kr ks kt fd ku kp kv kw aw kx bi"><span id="5c91" class="ky jk hh kp b fi kz la l lb lc">import sys<br/>import numpy<br/>numpy.set_printoptions(threshold=sys.maxsize)</span></pre><blockquote class="lo lp lq"><p id="f5f9" class="il im lr in b io ip iq ir is it iu iv ls ix iy iz lt jb jc jd lu jf jg jh ji ha bi translated">将NumPy数组转储到csv文件中</p></blockquote><pre class="kq kr ks kt fd ku kp kv kw aw kx bi"><span id="89df" class="ky jk hh kp b fi kz la l lb lc">import numpy<br/>a = numpy.asarray([ [1,2,3], [4,5,6], [7,8,9] ])<br/>numpy.savetxt("foo.csv", a, delimiter=",")</span></pre><blockquote class="lo lp lq"><p id="f1be" class="il im lr in b io ip iq ir is it iu iv ls ix iy iz lt jb jc jd lu jf jg jh ji ha bi translated">如何获得NumPy数组中N个最大值的索引？</p></blockquote><pre class="kq kr ks kt fd ku kp kv kw aw kx bi"><span id="2069" class="ky jk hh kp b fi kz la l lb lc">In [1]: import numpy as np<br/>In [2]: arr = np.array([1, 3, 2, 4, 5])<br/>In [3]: arr.argsort()[-3:][::-1]<br/>Out[3]: array([4, 3, 1])</span></pre></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><h1 id="8f49" class="jj jk hh bd jl jm md jo jp jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg bi translated">参考</h1><div class="mi mj ez fb mk ml"><a href="https://numpy.org/doc/stable/user/basics.broadcasting.html" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab dw"><div class="mn ab mo cl cj mp"><h2 class="bd hi fi z dy mq ea eb mr ed ef hg bi translated">广播-NumPy 1.19版手册</h2><div class="ms l"><h3 class="bd b fi z dy mq ea eb mr ed ef dx translated">注请参阅本文中有关广播概念的插图。广播这个术语描述了numpy如何对待…</h3></div><div class="mt l"><p class="bd b fp z dy mq ea eb mr ed ef dx translated">numpy.org</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz ij ml"/></div></div></a></div><p id="e03c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">高级数字|科学日本2019</p><p id="9343" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">StackOverflow/NumPy</p></div></div>    
</body>
</html>