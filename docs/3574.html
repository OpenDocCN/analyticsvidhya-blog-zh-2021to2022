<html>
<head>
<title>Top Scorer — Network Analysis via Networks and Graph theory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最佳得分者-通过网络和图论进行网络分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/top-scorer-network-analysis-via-networks-and-graph-theory-40731c20dca0?source=collection_archive---------7-----------------------#2021-07-10">https://medium.com/analytics-vidhya/top-scorer-network-analysis-via-networks-and-graph-theory-40731c20dca0?source=collection_archive---------7-----------------------#2021-07-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/440c2f8ecc70fc65f447474d1183c561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cfwp2VqjBiLE3FwUokke3g.png"/></div></div></figure><p id="43d7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是我的团队(我自己&amp; <a class="jn jo ge" href="https://medium.com/u/9b1a784c0058?source=post_page-----40731c20dca0--------------------------------" rel="noopener" target="_blank">林俊·高</a>)为应对Shopee Code League 2021的竞争而精心设计的解决方案——多渠道联系。</p><p id="e70d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">总结:</strong>我们使用网络和图论来了解提交的每张票之间的关系。这样，我们就可以通过电话号码、电子邮件地址或订单id 100%地找到没有关联的客户。</p><blockquote class="jp jq jr"><p id="6fba" class="ip iq js ir b is it iu iv iw ix iy iz jt jb jc jd ju jf jg jh jv jj jk jl jm ha bi translated"><strong class="ir hi">问题陈述:<br/> </strong>客户可以通过livechat功能、填写某些表格或打电话求助等多种渠道联系客服。每次客户用新的联系方式联系我们时，都会自动生成一张新的票据。当同一个客户使用不同的电话号码或电子邮件地址联系我们，导致同一问题的多个标签时，情况就变得复杂了。因此，我们在这里面临的挑战是确定如何将相关票据合并在一起，以创建客户问题的完整画面，并最终确定RCR</p></blockquote><p id="9c6f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">数据集:<br/> </strong>你可以从<a class="ae jw" href="https://www.kaggle.com/c/scl-2021-da/data" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/c/scl-2021-da/data</a>下载数据集</p><p id="9ff7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">解决方案:<br/> </strong>该解决方案简单而温馨，只需进行少量清理，并使用基本网络来规划每张票之间的关系，我们设法制定了解决方案，并在时限内100%规划出客户网络。</p></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><h1 id="b42f" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">首先，我们加载数据集</h1><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b6e5" class="ll kf hh lh b fi lm ln l lo lp">import pandas as pd<br/>import networkx as nx</span><span id="5476" class="ll kf hh lh b fi lq ln l lo lp">df = pd.read_json('dataset/contacts.json')<br/>df</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lr"><img src="../Images/3db1351e0e098e1620ef14c076635edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*txTchhgUwZAYC_0wwnkyZA.png"/></div></figure><ul class=""><li id="6360" class="ls lt hh ir b is it iw ix ja lu je lv ji lw jm lx ly lz ma bi translated">每个<strong class="ir hi">订单ID </strong>代表Shopee中的一笔交易。</li><li id="c120" class="ls lt hh ir b is mb iw mc ja md je me ji mf jm lx ly lz ma bi translated">每个<strong class="ir hi"> Id </strong>代表向Shopee客户服务制作的票证Id。</li><li id="11ab" class="ls lt hh ir b is mb iw mc ja md je me ji mf jm lx ly lz ma bi translated">所有<strong class="ir hi">电话号码</strong>在存储时没有国家代码，国家代码可以忽略。</li><li id="62af" class="ls lt hh ir b is mb iw mc ja md je me ji mf jm lx ly lz ma bi translated"><strong class="ir hi">联系人</strong>代表用户在特定票证中联系我们的次数(电子邮件、电话、实时聊天等)。)</li><li id="7d23" class="ls lt hh ir b is mb iw mc ja md je me ji mf jm lx ly lz ma bi translated">如果<strong class="ir hi">值为NA </strong>表示系统或代理没有该值的记录。</li></ul><h1 id="3e57" class="ke kf hh bd kg kh mg kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb bi translated">数据清理</h1><p id="25fb" class="pw-post-body-paragraph ip iq hh ir b is ml iu iv iw mm iy iz ja mn jc jd je mo jg jh ji mp jk jl jm ha bi translated">数据清理是任何建模之前的强制性步骤。我们附加了“Email_”、“Phone_”和“OrderId_”来帮助我们稍后识别数据类型。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="7928" class="ll kf hh lh b fi lm ln l lo lp">df.Email = df.Email.apply(lambda x: "Email_"+x if x !='' else '')</span><span id="8e09" class="ll kf hh lh b fi lq ln l lo lp">df.Phone = df.Phone.apply(lambda x: "Phone_"+x if x !='' else '')</span><span id="00af" class="ll kf hh lh b fi lq ln l lo lp">df.OrderId = df.OrderId.apply(lambda x: "OrderId_"+x if x !='' else '')</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mq"><img src="../Images/b59cc098a2b30faaf3ddff913bef2c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kMZNkxrapGoxWlYCggMaAQ.png"/></div></div></figure><h1 id="8887" class="ke kf hh bd kg kh mg kj kk kl mh kn ko kp mi kr ks kt mj kv kw kx mk kz la lb bi translated">创建图形网络</h1><ol class=""><li id="30a7" class="ls lt hh ir b is ml iw mm ja mr je ms ji mt jm mu ly lz ma bi translated">创建Id为、属性为联系人的节点</li></ol><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="c6a6" class="ll kf hh lh b fi lm ln l lo lp"><strong class="lh hi"># Create the nodes with Id and with attributes as Contacts</strong></span><span id="afa4" class="ll kf hh lh b fi lq ln l lo lp">nodes = []</span><span id="7536" class="ll kf hh lh b fi lq ln l lo lp">for _,Id,_,_,Contacts,_ in df.itertuples():<br/>    nodes.append((Id,{"Contacts": Contacts}))<br/>    <br/><strong class="lh hi"># Add the nodes into the new graph G</strong></span><span id="4034" class="ll kf hh lh b fi lq ln l lo lp">G = nx.Graph()<br/>G.add_nodes_from(nodes)</span><span id="c6d1" class="ll kf hh lh b fi lq ln l lo lp"><strong class="lh hi"># Now that we have 500000 nodes, 0 edges<br/></strong>G.number_of_nodes(), G.number_of_edges()</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es mv"><img src="../Images/a028046317338f37da3dea8d130c75a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*YMQlq6laGdnVxqVAs0C7Ow.png"/></div></figure><p id="6d30" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.创建边缘间:<em class="js">id</em><strong class="ir hi"><em class="js">↔</em></strong><em class="js">邮箱，id</em><strong class="ir hi"><em class="js">↔</em></strong><em class="js">电话，id</em><strong class="ir hi"><em class="js">↔</em></strong><em class="js">订单Id </em></p><p id="3c85" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并且Email、Phone &amp; OrderId节点是在这个过程中自动创建的。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="5728" class="ll kf hh lh b fi lm ln l lo lp"><strong class="lh hi"># Create the edges between: Id ↔ Email, Id ↔ Phone, Id ↔ OrderId</strong></span><span id="11df" class="ll kf hh lh b fi lq ln l lo lp">G.add_edges_from(df[df.Email != ''][['Id', 'Email']].to_records(index=False))</span><span id="0f7a" class="ll kf hh lh b fi lq ln l lo lp">G.add_edges_from(df[df.Phone != ''][['Id', 'Phone']].to_records(index=False))</span><span id="a98f" class="ll kf hh lh b fi lq ln l lo lp">G.add_edges_from(df[df.OrderId != ''][['Id', 'OrderId']].to_records(index=False))</span><span id="bacf" class="ll kf hh lh b fi lq ln l lo lp"><strong class="lh hi"># Now that we have 1129135 nodes, 837231 edges<br/></strong>G.number_of_nodes(), G.number_of_edges()</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es mw"><img src="../Images/f99244d56f58b1310ea2e686f9771a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*OAdS2AxVcsjbs28uKhsmhQ.png"/></div></figure><p id="3367" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3.列出连接的组件。每个列表包含1个连通分量</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="4e0f" class="ll kf hh lh b fi lm ln l lo lp"><strong class="lh hi"># List down the connected component</strong></span><span id="46fa" class="ll kf hh lh b fi lq ln l lo lp">conn_comp = list(nx.connected_components(G))<br/>conn_comp</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es mx"><img src="../Images/e18e989076113ada8fd109f462ee0ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*Q0R8RnWoX3I-5_en3XdtHg.png"/></div></figure></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><h1 id="1435" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">提取图形网络</h1><p id="4594" class="pw-post-body-paragraph ip iq hh ir b is ml iu iv iw mm iy iz ja mn jc jd je mo jg jh ji mp jk jl jm ha bi translated">这个想法是一个ticket_id一行，与他们连接的ticket id连接，联系点的数量进行汇总。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es my"><img src="../Images/e757a615d0d14f8165ab80ad7c35fab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*1YjdFpx2irHAUBjQ3Ghiww.png"/></div></div></figure><p id="38c8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">对于每个连接的组件</strong> t，也就是每个列表，我们<strong class="ir hi">将其中的ticket_id </strong>连接起来，<strong class="ir hi">汇总出联系方式</strong>(之前存储在节点属性下)</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="373c" class="ll kf hh lh b fi lm ln l lo lp">output = []</span><span id="35f0" class="ll kf hh lh b fi lq ln l lo lp"><strong class="lh hi"># for each connected component, i.e. each list, we apended the ticket_id within (to concat in the later part)</strong></span><span id="3f4d" class="ll kf hh lh b fi lq ln l lo lp">for each_connected_component in conn_comp:<br/>    <br/>    id_list = []</span><span id="5dc2" class="ll kf hh lh b fi lq ln l lo lp">for each_node in each_connected_component:<br/>        <br/><strong class="lh hi">        # check if the node is a number, append to the id_list<br/></strong>        <br/>        if str(each_node).isnumeric():</span><span id="da5f" class="ll kf hh lh b fi lq ln l lo lp">id_list.append(each_node)</span><span id="ca79" class="ll kf hh lh b fi lq ln l lo lp">sum_of_contacts = 0<br/>    <br/>    for order_id in id_list:<br/>        <br/><strong class="lh hi">        # summed up the attributes ie. contact made that belongs to the node</strong><br/>        <br/>        sum_of_contacts += G.nodes[order_id]['Contacts']</span><span id="5693" class="ll kf hh lh b fi lq ln l lo lp">output_str = '-'.join([str(each_node) for each_node in sorted(id_list)]) + ', '  + str(sum_of_contacts)<br/>    for order_id in id_list:</span><span id="651d" class="ll kf hh lh b fi lq ln l lo lp">output.append([order_id, output_str])</span></pre><p id="d2e7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将输出转换为数据帧，并根据比赛要求进行排序，导出为csv文件。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="aa82" class="ll kf hh lh b fi lm ln l lo lp">output_final = pd.DataFrame(output)</span><span id="ef7d" class="ll kf hh lh b fi lq ln l lo lp">output_final= output_final.rename(columns={0:'ticket_id', 1:'ticket_trace/contact'})</span><span id="3bf6" class="ll kf hh lh b fi lq ln l lo lp">output_final.sort_values('ticket_id').to_csv('output.csv', index=False)</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es mz"><img src="../Images/ae2c0d2948d944e84f615b5822a94bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*KHY0VzahJc8N0WFZsPuIQg.png"/></div></figure><p id="b7db" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">瞧，我们完成了！希望你喜欢我写的文章/教程。</p><p id="6f63" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你有任何问题，或者喜欢这篇文章，请留下你的评论。</p><p id="8cfd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Github知识库:<a class="ae jw" href="https://github.com/angelawongsw/Top-Scorer---Network-Analysis-Networks-and-Graph-theory" rel="noopener ugc nofollow" target="_blank">https://github.com/angelawongsw/Top-Scorer网络分析网络图论</a></p><p id="12b0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">完整代码:</p><figure class="lc ld le lf fd ii"><div class="bz dy l di"><div class="na nb l"/></div></figure></div></div>    
</body>
</html>