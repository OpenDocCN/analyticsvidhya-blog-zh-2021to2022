<html>
<head>
<title>DOCKER SWARM — Creating &amp; Deploying services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DOCKER SWARM —创建和部署服务</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/docker-swarm-creating-deploying-services-a0da071339d3?source=collection_archive---------18-----------------------#2021-01-18">https://medium.com/analytics-vidhya/docker-swarm-creating-deploying-services-a0da071339d3?source=collection_archive---------18-----------------------#2021-01-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/52eb3b78e170c9b5b606e234fc31d3de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*IUT-e_xTv5KlqJRuy1NiLg.png"/></div></figure><p id="a8f9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你使用过Docker容器，你就会明白它们有多强大。但是你知道吗，你可以通过创建一个Docker主机集群，称为Docker swarm，来成倍地提升Docker的能力。信不信由你，这个过程真的很简单。您所需要的只是一台机器作为Docker群管理器，以及一些Docker主机作为工作者节点加入群。</p><p id="b0eb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="jj">我们开始吧！</em>T3】</strong></p><p id="b48c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">从AWS控制台，导航到EC2。</p><p id="565d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于这个演示，我将创建3个实例，1个经理和另外2个工人。</p><p id="d26e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">确保您的实例位于同一区域，并记住在设置安全组时，允许所有流量从任何地方通过您的实例</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/178e7a5e07663b83fae83107a11b94c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*N5aB0R70sOqPR9lMtswqfg.png"/></div></figure><p id="dec4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">点击<strong class="in hi">查看并启动</strong>。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/c372ae61bff886b0d1bfd8717b055804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*1N-_JSuJh2ALHBD7lrWjbw.png"/></div></figure><p id="286c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">点击<strong class="in hi">发射</strong>。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/bd826a20f7a71d87c9eaf7151cb1391b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*e7UBGx2Hgp8CWC-gR8gSnA.png"/></div></figure><p id="3aed" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在我们已经有了3个实例。适当的命名约定可以帮助您确定哪个实例将成为经理和工人。</p><p id="3e72" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">接下来，让我们连接到这些实例，并在每个实例上安装docker。</p><p id="3773" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">首先让SSH进入我们的<em class="jj">管理器</em>并安装docker。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jp"><img src="../Images/b0999578807417bab3afa28ccfccb38b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*fS9pJVm-3GjU6M_sjYG6jg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">在管理器上安装docker</figcaption></figure><p id="aa1c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">安装过程有据可查<a class="ae ju" href="https://get.docker.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">此处</strong> </a>。按照说明安装最新版本的docker引擎。</p><p id="13ce" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">安装docker后，您可以使用以下命令检查安装的版本</p><blockquote class="jv jw jx"><p id="6aa1" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated"><strong class="in hi">docker--版本</strong></p></blockquote><p id="4ddc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最好每个节点都有正确的名称，以便于识别。要更改名称，需要以root用户身份登录并运行命令:</p><blockquote class="jv jw jx"><p id="2e50" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">vim /etc/hostname</p></blockquote><p id="77c1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="jj"> /ect/hostname </em>是存储节点名称的目录。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es kb"><img src="../Images/33e3db97e3c31050c66cee649df1da06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*otxa5WAgV-0uPQs-kkpsCw.png"/></div></figure><p id="b67b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一旦更改了名称，就需要重新启动实例。</p><p id="ef8e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用上述步骤在每台机器上安装docker之后，使用三个不同的终端将SSH安装到实例中。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/66e233b01c7a74fc6e68a4cec704ba82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Oz40RZcyh9xC8LM4khXBcQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">1名经理2名工人终端</figcaption></figure><p id="9b47" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在所有终端上，以<strong class="in hi"> root用户身份登录。</strong></p><p id="72ed" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">到目前为止，我们只把这些机器命名为经理和工人。</p><p id="97f4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在管理器计算机上运行以下命令:</p><blockquote class="jv jw jx"><p id="ea44" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">停靠站群初始化-广告-地址<manager_ip/></p></blockquote><p id="3a25" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一旦发出并完成，您的管理器实例现在实际上已经成为了群集的<strong class="in hi">管理器，您的屏幕上应该会出现以下输出:</strong></p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/9dcbf583f16ea99720923f1ed7be6048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*NtoETIU8biZjxDBPBMEYGg.png"/></div></figure><p id="c9e9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对<strong class="in hi">添加其他机器作为工人节点</strong>，盲目复制命令</p><blockquote class="jv jw jx"><p id="8b3d" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">码头工人蜂拥加入。</p></blockquote><p id="b3cc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">到工人机器上。</p><p id="6a9f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">完成后，您的屏幕将如下所示</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/213e5fd4e06965a4fadb54032fac471b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*RqgTXrBWrc6EWw9fl2Z1Lw.png"/></div></figure><p id="d6f1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">快速回顾一下，您可以看到您的工作机显示了一条消息，</p><blockquote class="jv jw jx"><p id="116f" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">这个节点作为工作者加入了一个群。</p></blockquote><p id="7f11" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们看看您在第一个集群中创建的所有内容。从管理机器上运行命令<strong class="in hi"> docker node ls </strong>来查看你的群的连接节点。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/436d0d4aab52ed69be08c65d44497379.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*TsNdfDk1JvWdAnptH5dzSw.png"/></div></figure><p id="8f92" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">你可以看到我们现在有1名经理和2名工人。</p><p id="e431" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">接下来，让我们<strong class="in hi">在这个集群中部署一个API服务</strong>。</p><p id="5d49" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">随着我们的Swarm的启动和运行，让我们将一个服务部署到<em class="jj">，看看调度是如何工作的</em>。要在Swarm上启动服务，请返回管理器计算机。</p><p id="9c38" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">运行命令:</p><blockquote class="jv jw jx"><p id="f753" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">docker服务创建—副本1 —名称hello world alpine ping docker.com</p></blockquote><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es kb"><img src="../Images/17791390c49472499607a90b8695ab34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*GhdTzarZiIDSpQFrNj2PMg.png"/></div></figure><p id="2338" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">参数Alpine ping docker.com将服务定义为执行命令ping docker.com的Alpine Linux容器。</p><p id="f259" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要查看正在运行的服务列表，请使用命令</p><blockquote class="jv jw jx"><p id="1105" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">码头服务</p></blockquote><figure class="jl jm jn jo fd ii er es paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="er es kc"><img src="../Images/a35ff8cce79d03d0382d89ed640d2b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*aGq7fbbxprxDGXKh-Yhp7g.png"/></div></div></figure><p id="9e68" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在您已经向swarm部署了一个服务，您可以查看该服务的详细信息:</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es kh"><img src="../Images/270ae30f9f8938b02c4bceac0f883217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*TzfzaueQ0Nu-s__uuveipg.png"/></div></figure><p id="0ac9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为了以可读的格式查看细节，我们使用了<strong class="in hi">--漂亮的</strong>标志。</p><p id="fd6d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要查看哪些节点正在运行服务，请运行</p><blockquote class="jv jw jx"><p id="6b49" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">码头服务ps <service-id/></p></blockquote><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es ki"><img src="../Images/185591fdca1a2d72edac6a49d1cd26a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*5pBahrOOaVGXqAkfTDtTYg.png"/></div></figure><p id="e2a3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在这种情况下，helloworld服务的一个实例正在Manager节点上运行。默认情况下，群中的管理者节点可以像工作者节点一样执行任务。</p><p id="d7f9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们扩展我们的服务，然后检查哪些节点正在运行这些服务。为了扩展，我们将使用:</p><blockquote class="jv jw jx"><p id="ab2b" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">码头工人服务量表<service-id> = <number-of-tasks/></service-id></p></blockquote><p id="c66f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在服务中运行的容器被称为任务。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es ki"><img src="../Images/788be4a6cce0b2d9a1f15b848a4273ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*MbNxIHqvErt77nHGvRG9qA.png"/></div></figure><p id="516b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在检查哪些节点正在运行服务</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es ki"><img src="../Images/e914f690e370386fe8b847d58fd060bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*wLG7Q6tdwutTtEN12TI1Mw.png"/></div></figure><p id="c3f6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">你可以看到swarm已经创建了2个新任务来扩展到总共3个运行的Alpine Linux实例。这些任务在群体的节点之间分配。</p><p id="e6f4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们通过SSH进入一个worker节点，查看在您所连接的节点上运行的容器。使用:</p><blockquote class="jv jw jx"><p id="887a" class="il im jj in b io ip iq ir is it iu iv jy ix iy iz jz jb jc jd ka jf jg jh ji ha bi translated">docker ps</p></blockquote><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es ki"><img src="../Images/4b763aaa573271a1b5927683a3a1ac9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*6NbX5CixYBzmEaxzQWE__A.png"/></div></figure><p id="67c6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">太棒了！！您已经见证了经理安排哪些容器在哪里运行。</p><p id="2a23" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你觉得有趣，请鼓掌！</p><p id="fcaa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="jj">谢谢！！</em></p></div></div>    
</body>
</html>