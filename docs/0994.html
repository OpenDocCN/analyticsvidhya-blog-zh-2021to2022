<html>
<head>
<title>Deploy Machine Learning Model using Flask to Heroku — Beginners(Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向Heroku初学者部署使用Flask的机器学习模型(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-machine-learning-model-using-flask-to-heroku-beginners-part-2-6db424211e3d?source=collection_archive---------11-----------------------#2021-02-09">https://medium.com/analytics-vidhya/deploy-machine-learning-model-using-flask-to-heroku-beginners-part-2-6db424211e3d?source=collection_archive---------11-----------------------#2021-02-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8d44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是关于如何使用Flask在Heroku上创建和部署机器学习模型的教程的第二部分。<a class="ae jc" href="https://ngugijoan.medium.com/deploy-machine-learning-model-using-flask-to-heroku-beginners-part-1-451b117a4c7e" rel="noopener">第一部分</a>是关于数据预处理和使用JupyterNotebook创建逻辑回归模型。</p><p id="d1e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第2部分将指导如何构建你的flask应用程序，如何在其中嵌入你的机器学习模型，以及如何将应用程序上传到<a class="ae jc" href="https://github.com/Jnjerry/diabetespredictor" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p><p id="0c85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">构建烧瓶应用</strong></p><p id="ffce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我用PyCharm作为我的IDE。确保您已经安装了我们在模型中使用的包，以及flask、numpy和Gunicorn。Gunicorn将允许我们在Heroku上运行我们的flask应用程序。</p><ul class=""><li id="ff72" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">瓶</li><li id="121c" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">熊猫</li><li id="96b0" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">Numpy</li><li id="94ae" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">sci kit-学习</li><li id="c3c2" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">格尼科恩</li><li id="e523" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">泡菜</li></ul><figure class="js jt ju jv fd jw er es paragraph-image"><div class="er es jr"><img src="../Images/59c5e682029b13cfacf06a34f8c4f9fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*i6JU6IFloduLgQdFylvIEg.png"/></div></figure><p id="3a44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的flask应用程序的高层结构有以下文件:<strong class="ig hi"> model.py </strong>包含我们的机器学习模型。我们的<strong class="ig hi"> app.py </strong>包含我们的逻辑，它是我们导入pickle模型和flask模块的地方。<strong class="ig hi"> model.pkl </strong>文件封装了我们的机器学习模型。我们的index.html输出我们的网页，Procfile允许我们将我们的应用程序部署到Heroku，我们的requirements.txt包含我们所有导入的库。</p><p id="7749" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们把结构分解成几个步骤:</p><p id="3cab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第一步:Model.py </strong></p><p id="52d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用之前创建的JupyterNotebook中的模型。只是这次我们不需要包括数据探索和机器学习模型验证步骤。我们删除了这些部分，因为我们已经测试了我们的模型，因此我们只需要导入我们的数据集，指定我们的X和y特征，分割我们的训练和测试集，并使它们适合我们的逻辑模型。</p><p id="de38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我这里的附加行是<strong class="ig hi"> pickle.dump(logreg，open('model.pkl '，' wb '))。</strong>我们实际上是使用我们的pickle库将我们训练好的模型<em class="jz"> (logreg) </em>保存到磁盘上。当您运行<strong class="ig hi"> python model.py </strong>时，您的model.pkl文件被保存。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="7231" class="kf kg hh kb b fi kh ki l kj kk">import pandas as pd<br/><br/>df=pd.read_csv('diabetes.csv')<br/><br/><br/>## Import ML libraries<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.linear_model import LogisticRegression<br/><br/>import pickle<br/><br/><br/># Define our X and y features and split into training/test sets<br/>X = df.drop(['Outcome'], axis=1)<br/>y = df['Outcome']<br/><br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=109)<br/><br/><br/>X_train.head()<br/><br/><br/>logreg = LogisticRegression(max_iter=1000)<br/>logreg.fit(X_train,y_train)<br/><br/>print(logreg.predict([[1,103,30,38,83,43.3,0.183,33]]))<br/><br/><br/># Saving model to disk<br/># Pickle serializes objects so they can be saved to a file, and loaded in a program again later on.<br/>pickle.dump(logreg, open('model.pkl','wb'))</span></pre><p id="f5a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保运行以下命令来输出您的pickle文件</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="7992" class="kf kg hh kb b fi kh ki l kj kk">python model.py</span></pre><p id="efcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二步:app.py </p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="2145" class="kf kg hh kb b fi kh ki l kj kk">import numpy as np<br/>from flask import Flask, request, render_template<br/>import pickle<br/><br/>app = Flask(__name__)</span><span id="e51e" class="kf kg hh kb b fi kl ki l kj kk"># read our pickle file and label our logisticmodel as model<br/>model = pickle.load(open('model.pkl', 'rb'))<br/><br/>@app.route('/')<br/>def home():<br/>    return render_template('index.html')<br/><br/>@app.route('/predict',methods=['POST','GET'])<br/>def predict():<br/><br/>    int_features = [float(x) for x in request.form.values()]<br/>    final_features = [np.array(int_features)]<br/>    prediction = model.predict(final_features)<br/><br/>    <br/>    if prediction==0:<br/>        return render_template('index.html',<br/>                               prediction_text='Low chances of patient having diabetes'.format(prediction),<br/>                               )<br/>    else:<br/>        return render_template('index.html',<br/>                               prediction_text='High chances of patient having diabetes'.format(prediction),<br/>                              )<br/><br/><br/><br/>if __name__ == "__main__":<br/>    app.run(debug=True)</span></pre><p id="65d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个文件中我们有两个方法:<strong class="ig hi"> home() </strong>和<strong class="ig hi"> predict()。home方法呈现了我们的index.html页面，并给出了下面的主页界面。</strong></p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es km"><img src="../Images/a10dd6e0732dc1ceb414643ecdfbee0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O81MkK3LP2IqwZT8DS5OEw.png"/></div></div></figure><p id="4b77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当你点击上面的预测按钮以得到你的预测结果时，预测方法被调用，你得到如下的结果界面</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kr"><img src="../Images/a40a6212e426a82fbe9cce8dad9b9d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3YO2gj-xyUb2hSs4.png"/></div></div></figure><p id="fc5f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还从pickle文件中导入了我们的模型，然后在predict方法中，我们获取用户在index.html文件的表单中输入的值，然后使用pickle文件中的模型继续预测这些值。用户输入的值本质上是来自model.py中的机器学习模型的X特征。</p><p id="44b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">需要注意的一点是，为了更好的用户体验，我用一个字符串文本替换了结果0和1，因此如果结果等于0，则显示为<strong class="ig hi"> <em class="jz">患者患糖尿病的几率低</em> </strong>，如果结果等于1，则显示为<strong class="ig hi"> <em class="jz">患者患糖尿病的几率高</em>。</strong></p><p id="764d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第三步:Index.html</strong></p><p id="5fec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的index.html很简单。它包含一个表单，我们将在其中输入我们的<strong class="ig hi"> X特性:</strong>葡萄糖、身体质量指数等。如果形状特征不等于模型中X特征的数量，将会出现错误。第<strong class="ig hi"> {{ prediction_text }} </strong>行是我们最终输出应该是<strong class="ig hi">的地方。</strong>在<strong class="ig hi">app . py</strong><strong class="ig hi">{ { prediction _ text } }</strong>等同于我们的<strong class="ig hi">结果</strong>特征。</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="42e6" class="kf kg hh kb b fi kh ki l kj kk">&lt;!DOCTYPE html&gt;<br/>&lt;html &gt;<br/><br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;COVID-19 Predictor&lt;/title&gt;<br/> &lt;!-- Latest compiled and minified CSS --&gt;<br/>&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"&gt;<br/><br/>&lt;!-- jQuery library --&gt;<br/>&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"&gt;&lt;/script&gt;<br/><br/>&lt;!-- Popper JS --&gt;<br/>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"&gt;&lt;/script&gt;<br/><br/>&lt;!-- Latest compiled JavaScript --&gt;<br/>&lt;script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"&gt;&lt;/script&gt;<br/><br/>&lt;/head&gt;<br/><br/>&lt;body&gt;<br/>&lt;nav class="navbar navbar-expand-sm bg-primary navbar-light"&gt;<br/>  &lt;ul class="navbar-nav"&gt;<br/>    &lt;li class="nav-item active"&gt;<br/>      &lt;a class="nav-link" href="index.html"&gt;Diabetes Predictor&lt;/a&gt;<br/>    &lt;/li&gt;<br/><br/>  &lt;/ul&gt;<br/>&lt;/nav&gt;<br/><br/><br/>  &lt;br&gt;<br/>   &lt;br&gt;<br/><br/>   &lt;form action="{{ url_for('predict')}}"method="post"&gt;<br/>       &lt;input type="text" name='Pregnancies' placeholder="Pregnancies" required="required" /&gt;<br/>        &lt;input type="text" name="Glucose" placeholder="Glucose" required="required" /&gt;<br/>      &lt;input type="text" name="BloodPressure" placeholder="BloodPressure" required="required" /&gt;<br/>        &lt;input type="text" name="SkinThickness" placeholder="kinThickness" required="required" /&gt;<br/>        &lt;input type="text" name="Insulin" placeholder="Insulin" required="required" /&gt;<br/>      &lt;input type="text" name="BMI" placeholder="BMI" required="required" /&gt;<br/><br/>        &lt;input type="text" name="DiabetesPedigreeFunction" placeholder="DiabetesPedigreeFunction" required="required" /&gt;<br/>      &lt;input type="text" name="Age" placeholder="Age" required="required" /&gt;<br/>&lt;br&gt;<br/>       &lt;br&gt;<br/>      &lt;button type="submit" class="btn btn-success btn-block btn-large"&gt;Predict&lt;/button&gt;<br/><br/>   &lt;/form&gt;<br/>       &lt;br&gt;<br/>   &lt;br&gt;<br/>   {{ prediction_text }}<br/><br/>&lt;/div&gt;<br/><br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="f2d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第四步:过程文件</strong></p><p id="31d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的Procfile是一个包含以下指令的单行文件:</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="ca74" class="kf kg hh kb b fi kh ki l kj kk">web: gunicorn app:app</span></pre><p id="41d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您想要部署web应用程序时，这是一个必需的文件。应该准确的命名为<strong class="ig hi"> Procfile，</strong>类似<strong class="ig hi"> Procfile.txt的东西就不行了！这个文件描述了你想要如何运行你的网络应用程序。每种语言和框架都包含一种编写该文件的标准方式。左边的部分是流程类型；右边的部分是启动该进程所运行的命令。</strong></p><p id="ce34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第五步:requirements.txt </strong></p><p id="bd90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的终端中运行以下命令:</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="7d2f" class="kf kg hh kb b fi kh ki l kj kk">pip freeze &gt; requirements.txt</span></pre><p id="7877" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是为我们提供requirements.txt文件的命令。这是一个非常重要的文件，它不仅指导其他开发人员使用您在应用程序中使用的python包的版本，而且也是Heroku在部署期间用来运行您的应用程序的文件。您的需求文件应该类似于下图。您的软件包和版本列表。Heroku可能会在部署期间带来版本错误，您可以随时降级您的软件包版本。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ks"><img src="../Images/b01dd28c0d0725ce84d578801ab23cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHiX8WQAN8vguk0aSj4O1g.png"/></div></div></figure><p id="a654" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以通过在终端中运行以下命令来测试和运行您的应用程序</p><pre class="js jt ju jv fd ka kb kc kd aw ke bi"><span id="61b9" class="kf kg hh kb b fi kh ki l kj kk">python app.py</span></pre><p id="84d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您在终端中得到以下响应，您就成功了</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kt"><img src="../Images/577e2cabe81805c5f03f8e1fe809c46a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oxNPMUytdi0pR_ig-VRz_Q.png"/></div></div></figure><p id="dc47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击提供的链接，你应该有你的应用程序在你的本地机器上运行</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ku"><img src="../Images/f50624f4dc4e99c7aef4eed1b67866c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQT8vu_n6cjELlvCX_pZIQ.png"/></div></div></figure><p id="ece2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后一部分将会把你的代码推送到GitHub。因为这不是一个GitHub教程，而且对你来说也可能是新的，在GitHub中拥有你的代码的最简单的方法就是像你在网上上传任何其他文件一样上传文件。</p><p id="5932" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的GitHub repositories部分，选择new来创建您的新存储库(将包含您的代码的文件夹)。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kv"><img src="../Images/aeced70b9b10de24d51119a43625031c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nhntxI60E_swXNpoZRcMyQ.png"/></div></div></figure><p id="04d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">给你的repo命名，你也可以勾选<strong class="ig hi"> README </strong>文件，点击<strong class="ig hi"> Create repository </strong>。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kw"><img src="../Images/e5a898cef068e944145851edc3bd4c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KR6r35kh9dscIATpsMzWow.png"/></div></div></figure><p id="ae5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在新创建的存储库中，单击添加文件&gt;上传文件。然后，您可以通过简单地在界面上拖动来添加flask应用程序文件。单击提交更改上传您的文件。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kx"><img src="../Images/3480b62f879c8a98df6ca9f3df42a7af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJkxStKFdsCY17pxpaOqQQ.png"/></div></div></figure><p id="c1b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您的最终输出应该包含以下文件。<em class="jz">糖尿病日志</em>文件不在其中。这是我们在第1部分中用来创建和评估模型的笔记本文件。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es ky"><img src="../Images/381a41840baae4f09b895f5334d56745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2fuXl7FwjxI3lwlUBbnPg.png"/></div></div></figure><p id="5228" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">太好了！这是我们教程的第二部分。最后一部分<a class="ae jc" href="https://ngugijoan.medium.com/deploy-machine-learning-model-using-flask-to-heroku-beginners-part-3-849c2458c363" rel="noopener">第3部分</a>，是最简单的，它是一个关于如何将我们的应用从GitHub部署到Heroku的教程。</p></div></div>    
</body>
</html>