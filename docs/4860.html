<html>
<head>
<title>Oozie — What, Why and When!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">oozie——什么，为什么，什么时候！</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/oozie-what-why-and-when-58aa9fc14dd2?source=collection_archive---------0-----------------------#2022-05-09">https://medium.com/analytics-vidhya/oozie-what-why-and-when-58aa9fc14dd2?source=collection_archive---------0-----------------------#2022-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ad3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">理解Oozie的概念并在GCP dataproc集群中实现。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/54fa57b1a38c5b70299293661190bcf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CFpHLwqQ6ELTyYsb"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">马库斯·斯皮斯克在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="ff86" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">让我们从什么是oozie开始？</h1><ul class=""><li id="abd9" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated"><strong class="ih hj"> Oozie </strong>是一个工作流调度系统，用于管理Apache Hadoop作业。Oozie 工作流作业是动作的有向无环图(Dag)。</li><li id="2c97" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><strong class="ih hj">工作流</strong>、<strong class="ih hj">协调器</strong>、<strong class="ih hj">捆绑包</strong>一起组成了Oozie的构建模块。</li><li id="46c8" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">Oozie允许编排和控制这种复杂的多阶段Hadoop作业。</li><li id="c8f4" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">然后，多阶段Hadoop作业可以作为单个Oozie作业运行——oo zie作业是您唯一需要管理的东西</li></ul><h2 id="70ad" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">什么是工作流？</h2><ul class=""><li id="d991" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">工作流指定了一组操作以及执行这些操作的顺序和条件。</li><li id="66ef" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">这些操作可以是任何操作，如MapReduce作业、Hive查询、Shell脚本、Pig查询、Java程序</li><li id="2831" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">您可能希望在特定的时间和频率运行这些工作流(假设输入数据可用)，因此我们需要<strong class="ih hj">协调员</strong>。</li></ul><h2 id="1042" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">那么什么是协调者呢？</h2><ul class=""><li id="a80b" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated"><strong class="ih hj">协调器</strong>在指定时间和/或指定频率以及数据可用性的情况下安排工作流的执行</li><li id="c84a" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">如果输入数据不可用，则工作流会延迟，直到数据可用。</li><li id="cdd0" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">如果不需要输入数据，则工作流纯粹在指定的时间或频率运行。</li></ul><h2 id="85ed" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">让我们理解捆绑包的概念:</h2><ul class=""><li id="737e" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">可以一起启动、停止和修改的<strong class="ih hj">协调器作业</strong>的集合称为Bundle。</li><li id="8b73" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">管理工作流的一个协调器作业的输出可以是另一个协调器作业的输入。</li><li id="a108" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">管理工作流的一个协调器作业的输出可以是另一个协调器作业的输入，这个过程被称为<strong class="ih hj">数据管道</strong></li></ul><p id="22cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Oozie架构</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/f472d862bbfd63e07f8191b61a7a102d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*REWCcHgSl6ptgdoJQh7rRQ.png"/></div></div></figure><p id="80d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Oozie服务器:管理作业调度和执行。</p><p id="dff4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Oozie客户端:与服务器交互的CLI接口</p><p id="0676" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库:所有与作业相关的信息都存储在数据库中。Oozie默认支持Derby。</p><p id="a887" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Hadoop集群:Oozie作业在这个集群上运行</p><h2 id="19a1" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">Oozie应用是什么？</h2><ul class=""><li id="71ab" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">其中有一个用XML定义的文件，它描述了名为<strong class="ih hj"> workflow.xml </strong>的应用程序</li><li id="c435" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">它引用并包含执行这些操作的其他配置文件、jar和脚本。</li><li id="e977" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">该应用程序可以是手动运行的工作流、单个协调器或形成捆绑包的多个协调器。</li><li id="cf36" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">Oozie希望在运行之前所有文件都在HDFS。</li><li id="eb55" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">这些XML文件以及Oozie应用程序所需的其他文件在作业运行之前被复制到HDFS。</li></ul><p id="7579" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">工作流程:</strong></p><ul class=""><li id="504b" class="ks kt hi ih b ii ij im in iq lx iu ly iy lz jc kz la lb lc bi translated">这是Oozie的核心构件</li><li id="1f5c" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">工作流将不同的操作集合在一起。</li><li id="0486" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">动作是组成工作流的单个工作单元。动作在工作流中执行实际的处理。</li><li id="9920" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">动作是乔布斯先生，蜂巢作业，猪作业，Java程序。</li></ul><h2 id="90e6" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">工作流由以下节点组成:</h2><p id="a548" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq ma is it iu mb iw ix iy mc ja jb jc hb bi translated"><strong class="ih hj"> 1。控制节点</strong></p><p id="fd8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。行动节点</strong></p><p id="6841" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。全局配置</strong></p><p id="a1fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">控制节点</strong> —控制工作流的开始、结束和基本执行</p><p id="117b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:<start>、<end>、<kill>、<ok>、<error/></ok></kill></end></start></p><p id="9a46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">动作节点</strong> —动作节点是指定执行单元的节点</p><p id="7efa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:<map-reduce>、<pig>、<hive>、<shell>、<fs>、<email/></fs></shell></hive></pig></map-reduce></p><p id="c6bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">全局配置</strong> —这些可以在全局参数中定义，而不是为每个动作定义一次。</p><p id="94ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是job.properties文件？该文件包含发送给oozie的作业配置，以调用oozie工作流应用程序的工作流和参数。Jobs.properties位于本地文件系统上，而不是HDFS上。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/16ef9a66a77d83f199d1e1e2271a742b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxfSUGmaTw2hovByaEacdg.png"/></div></div></figure><p id="9afe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上图解释了每个元素的含义。在这里，应用程序路径是存储在HDFS中的workflow.xml的路径。</p><p id="e701" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在特定触发条件下运行工作流，例如在一天中的特定时间或运行作业的特定频率，或者当数据可用时。因此，要在这个触发器上运行作业，您需要协调器。最后我们会检查代码。</p><p id="ac4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来理解捆绑包的概念。包是数据管道的抽象，它使得管理大量工作流变得简单方便。指定包的路径，这将自动在此位置查找bundle.xml文件。</p><p id="f5dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该包指定了<strong class="ih hj">参数，控制</strong>和<strong class="ih hj">协调器</strong>是必需的，而其余两个是可选的</p><h2 id="6b69" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">在GCP Dataproc集群中运行一个简单的MapReduce作业</h2><ul class=""><li id="c25b" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">初始化安装了oozie的dataproc集群。我们可以运行这个命令，为集群提供oozie。您可以根据需要更改其他参数。我在试用帐户上工作，所以没有足够的CPU配额，所以选择机器类型。</li></ul><pre class="je jf jg jh fd me mf mg mh aw mi bi"><span id="847f" class="li jv hi mf b fi mj mk l ml mm">gcloud dataproc clusters create &lt;cluster_name&gt; --region us-east1 --master-machine-type n1-standard-2 --master-boot-disk-size 70 --num-workers 2 --worker-machine-type n1-standard-2 --worker-boot-disk-size 50 --image-version 2.0.27-debian10 --project &lt;project_id&gt; --initialization-actions="gs://goog-dataproc-initialization-actions-us-east1/oozie/oozie.sh"</span></pre><ul class=""><li id="f124" class="ks kt hi ih b ii ij im in iq lx iu ly iy lz jc kz la lb lc bi translated">您可以通过运行Oozie附带的<code class="du mn mo mp mf b">oozie-examples</code>来测试这个Oozie安装。要打开集群的CMD，请单击配置中出现的主节点的SSH</li></ul><p id="f8ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将示例移动到虚拟机的本地目录:<br/> <code class="du mn mo mp mf b">cp /usr/share/doc/oozie/oozie-examples.tar.gz ~</code></p><p id="917f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解压存档:<br/> <code class="du mn mo mp mf b">tar -xzf oozie-examples.tar.gz</code></p><p id="f1b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑出现在<code class="du mn mo mp mf b">~/examples/apps/map-reduce/job.properties</code>的MapReduce job.properties以及集群的详细信息:<br/> <code class="du mn mo mp mf b">nameNode=hdfs://&lt;cluster-name-m&gt;:8020<br/>jobTracker=&lt;cluster-name-m&gt;:8032</code></p><p id="4cfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">把Oozie的例子搬到HDFS: <br/> <code class="du mn mo mp mf b">hadoop fs -put ~/examples/ /user/&lt;username&gt;/</code></p><p id="cd3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在命令行上使用以下命令运行示例:</p><p id="383f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du mn mo mp mf b">oozie job -oozie http://0.0.0.0:11000/oozie -config ~/examples/apps/map-reduce/job.properties -run</code></p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h1 id="ea7f" class="ju jv hi bd jw jx mx jz ka kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr bi translated">终于！</h1><p id="9f01" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq ma is it iu mb iw ix iy mc ja jb jc hb bi translated"><em class="nc">感谢阅读！</em></p><p id="24d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这个，请投我一票，也建议一些更多的主题。</p><p id="5ebe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请随时通过<a class="ae jt" href="https://www.linkedin.com/in/ajinkya-mishrikotkar-a6594a144/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> LinkedIn </strong> </a>联系我</p><p id="738a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欢迎在下面发表评论，并提出你认为我错过了什么。谢谢！</p></div></div>    
</body>
</html>