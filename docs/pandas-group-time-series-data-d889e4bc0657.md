# 熊猫:分组时间序列数据

> 原文：<https://medium.com/analytics-vidhya/pandas-group-time-series-data-d889e4bc0657?source=collection_archive---------4----------------------->

![](img/4b45a244505f0a2faf9d19b03a1006a4.png)

马库斯·温克勒在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

在本文中，我们将尝试对一个庞大的时间序列数据进行宏观分析。股票市场数据就是这种数据的一个很好的例子，这种数据每秒钟收集一次，可能长达几十年。

为了更好地理解时间序列数据，最好绘制它，这就是我将在本文中讨论的代码中使用的应用程序。

如果你想了解股票在过去一年的表现，就不需要查看每小时收集的数据。可能不是每一分钟，也肯定不是每一秒钟。每天一个数据点将帮助我们了解一年中的高点和低点。

为了从每秒收集的数据集中获取每天的数据点，我们需要使用 min、max 或 average 操作将一天收集的数据点分组到一个数据集中。

python 中的 Pandas 包提供了这样一种功能，只使用一个名为频率的参数对时间序列数据进行分组。这就是我们将在本文中探讨的内容。

在这里，我们将使用为特斯拉股票收集的数据，这些数据已经存在了大约 10 年。下面是显示我如何下载数据的代码。

下载历史股票数据的 Python 代码

使用的包装是`yfinance`你可以在这里找到详细的[。](https://aroussi.com/post/python-yahoo-finance)

[](https://aroussi.com/post/python-yahoo-finance) [## 可靠地从雅虎下载历史市场数据！用 Python 融资

### 自从雅虎！财务部门停止使用他们的历史数据 API，Python 开发人员寻找可靠的解决方法…

aroussi.com](https://aroussi.com/post/python-yahoo-finance) 

我将使用这些数据创建类似于我们在网站上看到的显示股票市场趋势的图表。这些图将针对过去 1 天、5 天、1 个月、6 个月、年初至今、1 年、5 年的数据以及可用的最大数据。

 [## 熊猫。石斑鱼-熊猫 1.2.3 文档

### Grouper 允许用户为对象指定 groupby 指令。本规范将通过…选择一个列

pandas.pydata.org](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Grouper.html) 

首先让我们看看我将在本文中使用的来自 Pandas 的`Grouper`类。你可以在这里找到这个类[的完整文档，但是，我们将把重点放在名为`freq`(频率)的参数上，该参数将帮助使用指定的频率对类型为`Datetime`的列进行分组，也称为](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Grouper.html)[偏移别名](https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases)。

```
output = input.groupby(pd.Grouper(key='', freq='')).mean()
```

`groupby`函数取类`Grouper`的一个实例，该实例又取列名`key`作为分组依据和分组频率。`freq`参数的范围可以从纳秒到一年。下表列出了我们将在本文中使用的频率子集。

数据汇总

作为分组依据的列成为索引。frequency 参数可以只取定义频率的字符，或者在它前面加上一个数量来缩放它。示例:要按天分组，您可以使用`D`或`1D`。它们两者是等价的。要按周或 7 天分组，您可以使用`W`或`1W`或`7D`。

`subsetLastNDays`下面的函数是一个帮助函数，用来创建分组后的子集。

在下面的代码中，我遵循了 4 个简单的步骤。读取原始输入数据
2。分组和平均
3。根据需要对数据进行子集划分
4。保存输出数据

在本文的下一部分中，您将看到使用 [Datawrapper](https://www.datawrapper.de/) 根据表中提到的频率对输入数据进行分组的代码，以及从输出数据生成的图表。

**一天一分钟**

下载的原始数据包含每分钟的数据。这里我只收集了前一天的数据。

一天，一分钟

一天，一分钟

**五天三十分钟**

在这种情况下，我使用`T`参数按分钟分组，使用`30T`将 30 分钟的数据分组到一个数据点。

五天三十分钟

五天三十分钟

**一个月零一天**

这里我们从每 30 分钟收集一次数据开始。为了按天分组，我使用了`D`值。不需要指定`1`按单位频率分组。

一个月，一天

一个月，一天

**六个月零一天**

这里每 1 小时收集一次数据，但是不需要任何代码更改就可以对一天的数据进行分组。

六个月零一天

六个月零一天

**年初至今，某一天**

你也可以用 24 小时完成一天的分组。以下是方法。

年初至今，一天

年初至今，一天

**一年零一天**

仅仅是为了启动另一个使用`B`的一天分组，工作日默认为周一到周五。

一年，一天

如果你碰巧位于阿联酋，那里的典型商业周是从周日到周四。您可能希望使用`CB`自定义工作日选项，可以设置为:

```
pd.offsets.CustomBusinessDay(weekmask='Sun Mon Tue Wed Thu')
```

一年，一天

**五年零一周**

使用`1W`选项可以完成一周分组。

五年零一周

五年零一周

**最多一个月**

最后，对于一个月的组，使用选项`M`，将分组数据设置为该月的最后一天。将组合数据设置为一个月的最后一天来表示一个月中所有日子的平均值是有意义的。

要将组合数据设置为每月的第一天，您可以使用`MS`偏移别名。

最多一个月

最多一个月

还有很多其他的抵消，我没有在这里讨论。我希望这篇文章能使其他频率的工作变得更容易。