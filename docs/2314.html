<html>
<head>
<title>Do You Really Understand Try &amp; Finally in Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你真的理解Python中的Try &amp; Finally吗？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/do-you-really-understand-try-finally-in-python-110cee4c1a8?source=collection_archive---------8-----------------------#2021-04-18">https://medium.com/analytics-vidhya/do-you-really-understand-try-finally-in-python-110cee4c1a8?source=collection_archive---------8-----------------------#2021-04-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3f80" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在python中，<code class="du ix iy iz ja b">try</code>和<code class="du ix iy iz ja b">except</code>块经常被程序员用来处理任何异常或不愉快的场景。T2条款被低估了，可以更好的利用。让我们看看<em class="jb">终端模块</em>是如何工作的。</h2></div><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/ae0a107d40f400c36da84587df43ea39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*UvbqhJ61omj3NqgtvvjPUQ.jpeg"/></div></figure><h1 id="db42" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated"><strong class="ak">深潜</strong></h1><blockquote class="kc kd ke"><p id="9451" class="kf kg kh ki b kj kk ij kl km kn im ko kp kq kr ks kt ku kv kw kx ky kz la lb hb bi translated">不管之前发生了什么，一旦代码块完成并且处理了任何引发的异常，就执行最后一个代码块。即使异常处理程序或else块中出现错误，并且引发了新的异常，final块中的代码仍然会运行。</p></blockquote><p id="1b79" class="pw-post-body-paragraph kf kg hi ki b kj kk ij kl km kn im ko lc kq kr ks ld ku kv kw le ky kz la lb hb bi translated">这段引用自python <a class="ae lf" href="https://docs.python.org/2.5/whatsnew/pep-341.html" rel="noopener ugc nofollow" target="_blank">文档</a>的话绝对正确，但是当<code class="du ix iy iz ja b">try</code>和<code class="du ix iy iz ja b">finally</code>块被封装在一个有<code class="du ix iy iz ja b">return</code>语句的函数中时，执行行为就有点棘手了。我来举例说明一下。看看您能否猜出以下函数的输出。</p><h1 id="901a" class="jk jl hi bd jm jn jo jp jq jr js jt ju io jv ip jw ir jx is jy iu jz iv ka kb bi translated">示例1:</h1><pre class="jd je jf jg fd lg ja lh li aw lj bi"><span id="fc85" class="lk jl hi ja b fi ll lm l ln lo"><em class="kh"># Both the try &amp; final blocks have print statements and function returns value from final-block</em><br/><strong class="ja hj">def</strong> example_1():<br/>    <strong class="ja hj">try</strong>:<br/>        val = 1<br/>        print(f"Print: Try Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>")<br/>    <strong class="ja hj">finally</strong>:<br/>        val = val + 1<br/>        print(f"Print: Finally Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>")<br/>        <strong class="ja hj">return</strong> f"Return: Finally Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>"<br/>    <br/>example_1()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/df66a97ff564e52e4d17451c09faa5c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IT65Lt1_FIKBxRuzXnXgnA.png"/></div></div></figure><p id="847e" class="pw-post-body-paragraph kf kg hi ki b kj kk ij kl km kn im ko lc kq kr ks ld ku kv kw le ky kz la lb hb bi translated">功能<code class="du ix iy iz ja b">example_1</code>简单直接，首先执行<em class="kh">试块</em>，然后执行<em class="kh">终块</em>。变量<code class="du ix iy iz ja b">val</code>在<em class="kh">试块</em>中的值为<strong class="ki hj"> 1 </strong>，并在<em class="kh">终块</em>中更新为<strong class="ki hj"> 2 </strong>。</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="79e3" class="jk jl hi bd jm jn mb jp jq jr mc jt ju io md ip jw ir me is jy iu mf iv ka kb bi translated">示例2:</h1><pre class="jd je jf jg fd lg ja lh li aw lj bi"><span id="08e5" class="lk jl hi ja b fi ll lm l ln lo"><em class="kh"># The try block has return statement &amp; final block has only print statement</em><br/><strong class="ja hj">def</strong> example_2():<br/>    <strong class="ja hj">try</strong>:<br/>        val = 1<br/>        print(f"Print: Try Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>")<br/>        <strong class="ja hj">return</strong> f"Return: Try Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>"<br/>    <strong class="ja hj">finally</strong>:<br/>        val = val + 1<br/>        print(f"Print: Finally Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>")<br/>        <br/>example_2()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mg"><img src="../Images/46dfd135f2da54db4d067197353b1115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbi8YhzY3cIbC3g6-YMaBg.png"/></div></div></figure><p id="4b4e" class="pw-post-body-paragraph kf kg hi ki b kj kk ij kl km kn im ko lc kq kr ks ld ku kv kw le ky kz la lb hb bi translated">函数<code class="du ix iy iz ja b">example_2</code>是事情变得有点棘手的地方，在<em class="kh">最终程序块</em>之后执行<em class="kh">尝试程序块</em>中的<code class="du ix iy iz ja b">return</code>语句，但是返回的变量<code class="du ix iy iz ja b">val</code>的值不受<em class="kh">最终程序块</em>中所做更改的影响。</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="dd65" class="jk jl hi bd jm jn mb jp jq jr mc jt ju io md ip jw ir me is jy iu mf iv ka kb bi translated">示例3:</h1><pre class="jd je jf jg fd lg ja lh li aw lj bi"><span id="0ed3" class="lk jl hi ja b fi ll lm l ln lo"><em class="kh"># Both the try &amp; final blocks have return statements</em><br/><strong class="ja hj">def</strong> example_3():<br/>    <strong class="ja hj">try</strong>:<br/>        val = 1<br/>        print(f"Print: Try Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>")<br/>        <strong class="ja hj">return</strong> f"Return: Try Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>"<br/>    <strong class="ja hj">finally</strong>:<br/>        val = val + 1<br/>        print(f"Print: Finally Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>")<br/>        <strong class="ja hj">return</strong> f"Return: Finally Block - <strong class="ja hj">{</strong>val<strong class="ja hj">}</strong>"<br/>    <br/>example_3()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/df66a97ff564e52e4d17451c09faa5c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IT65Lt1_FIKBxRuzXnXgnA.png"/></div></div></figure><p id="8369" class="pw-post-body-paragraph kf kg hi ki b kj kk ij kl km kn im ko lc kq kr ks ld ku kv kw le ky kz la lb hb bi translated">函数<code class="du ix iy iz ja b">example_3</code>的输出很容易猜测。当<em class="kh">最终程序块</em>中的<code class="du ix iy iz ja b">return</code>语句被执行时，该功能退出，因此<em class="kh">试运行程序块</em>中的<code class="du ix iy iz ja b">return</code>语句永远不会被执行。</p></div><div class="ab cl lu lv gp lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hb hc hd he hf"><h1 id="805b" class="jk jl hi bd jm jn mb jp jq jr mc jt ju io md ip jw ir me is jy iu mf iv ka kb bi translated">拿走</h1><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mh"><img src="../Images/7a6752d822de87cbe2424a1df8dfc1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T76_KalEnpWcITKquwzKpQ.png"/></div></div></figure><p id="52ea" class="pw-post-body-paragraph kf kg hi ki b kj kk ij kl km kn im ko lc kq kr ks ld ku kv kw le ky kz la lb hb bi translated"><code class="du ix iy iz ja b">try</code> &amp; <code class="du ix iy iz ja b">finally</code>块并不像人们想象的那样简单，尤其是当它们从一个函数返回值的时候。想了解更多这样有趣的趣闻，请通过Twitter关注我。这篇文章的要点是:</p><ol class=""><li id="30f4" class="mi mj hi ki b kj kk km kn lc mk ld ml le mm lb mn mo mp mq bi translated">您将<code class="du ix iy iz ja b">return</code>语句放在哪里将会有所不同。</li><li id="fe97" class="mi mj hi ki b kj mr km ms lc mt ld mu le mv lb mn mo mp mq bi translated">即使来自<em class="kh">试块</em>的<code class="du ix iy iz ja b">return</code>语句在<em class="kh">终块</em>之后执行，返回的变量值也不会受到<em class="kh">终块中所做修改的影响。</em></li></ol></div></div>    
</body>
</html>