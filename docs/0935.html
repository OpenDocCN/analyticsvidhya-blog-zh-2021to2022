<html>
<head>
<title>Classification Performance Metric with Python Sklearn</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python Sklearn的分类性能度量</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/classification-performance-metric-with-python-sklearn-d8342ac25898?source=collection_archive---------5-----------------------#2021-02-07">https://medium.com/analytics-vidhya/classification-performance-metric-with-python-sklearn-d8342ac25898?source=collection_archive---------5-----------------------#2021-02-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/ae5e9d94cffdf159967b7a8f1545f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kewz0xLvwocuc8INzphzmA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">艾米丽·莫特在<a class="ae it" href="https://unsplash.com/s/photos/confusion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d5a5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">今天，我们将浏览来自Sklearn的乳腺癌数据集，以了解分类问题的不同类型的性能指标，以及为什么有时一种比另一种更受青睐。</p><p id="2cdc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">尽管这是一个简单的话题，但当有人问“什么是精度/召回率？”时，答案不会立即出现通过看这些例子，我希望每个人，包括我自己，都能牢牢把握这个话题。</p><p id="415a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">大多数人只是在分类问题中使用“准确性”作为性能指标，尽管这是可以的(有时)，但在处理不平衡数据集的情况下应该避免。</p><blockquote class="js jt ju"><p id="b318" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr ha bi translated">度量是我们用来比较不同模型的，因此我们可以选择最适合我们问题的模型</p></blockquote><p id="8eff" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，使用不适当的度量会导致选择非最优模型。不平衡数据集是指具有不平衡的类标签。</p><p id="c240" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是我们今天要讨论的主要话题:</p><ul class=""><li id="faf0" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">混淆矩阵</li><li id="9a7c" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">精确度、召回率、F1分数</li><li id="946f" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">ROC曲线</li></ul></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><p id="2fc2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，让我们导入breast_cancer数据集以及依赖项。此外，我们将从数据集中排除一些“恶性”患者，以代表现实世界中罕见的“恶性”患者。</p><p id="abaf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们已经将从sklearn加载的数据转换为pandas dataframe，并排除了除30名恶性肿瘤患者之外的所有患者。仔细检查我们分组的每个标签的数量，并计算目标值。</p><figure class="ku kv kw kx fd ii"><div class="bz dy l di"><div class="ky kz l"/></div></figure><figure class="ku kv kw kx fd ii er es paragraph-image"><div class="er es la"><img src="../Images/fe2e8692e67317041858dd362d40f5f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:244/format:webp/1*x8W4RT9y3rlSNwF9v26_QA.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">目标计数</figcaption></figure><p id="58d9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以看到，在387名患者中，30名为恶性，357名为良性。通常的惯例是，我们想要分类的被称为“阳性/1”类，因为我们想要分类“恶性”患者，我们最初应该给它加上阳性/1标签，然而在这种情况下，它是相反的。</p><p id="09f6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们创建两个模型，并使用<strong class="iw hi">精确度</strong>比较它们的性能。</p><p id="6a42" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">模型1(基础分类器):简单地将每个患者分类为“良性”。这是强化学习中的常见情况，模型会找到最快/最简单的方法来提高性能。当模型发现将所有患者分类为“良性”实际上会导致良好的性能(当使用准确性时)时，它可能会停留在那里。</p><p id="6b50" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">模型2 (rf_clf):随机森林分类器，因为我们不想缩放X变量…</p><p id="9af6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Accuracy_score是被正确分类为恶性或良性的患者的比例。</p><p id="5b83" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以看到，即使使用我们的基本分类器(所有患者都是良性的)，我们也可以获得相当高的准确性，因此我们可能会被说服选择这个模型来对乳腺癌进行分类。然而，由于基本分类器将所有患者分类为良性，所以他们中的一些实际上将是恶性的，这会导致有害的后果。在这种情况下，我们应该更加重视尝试正确识别癌症，即使我们将一些良性患者归类为恶性，因为知道自己患有癌症，而实际上没有比不知道自己患有癌症更好。</p><figure class="ku kv kw kx fd ii"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="3b9a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这就是<strong class="iw hi">混淆矩阵</strong>发挥作用的地方。混淆矩阵中的每一行代表预测类，每一列代表实际类。因此，在我们的示例中，第一行预测所有患者患有癌症，根据实际类别，如果正确，则指定为真，否则为假。</p><p id="9b6b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我经常使用的一个技巧是首先查看预测的标签负/正，然后查看预测是否为真/假。</p><p id="7dd2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是混淆矩阵中的一些关键词:</p><ul class=""><li id="60af" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated"><strong class="iw hi">真阴性</strong>:预测恶性，实际恶性</li><li id="031c" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><strong class="iw hi">真阳性</strong>:预测良性，实际良性</li><li id="136e" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><strong class="iw hi">假阴性</strong>:预测恶性，实际良性</li><li id="3994" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><strong class="iw hi">假阳性</strong>:预测良性，实际恶性</li></ul><figure class="ku kv kw kx fd ii er es paragraph-image"><div class="er es lb"><img src="../Images/2e12d641ffe13ab14966486bc79a2a96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*wpReE5h4LSRQhDKuZsIKDg.png"/></div></figure><p id="0028" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">混淆矩阵也是sklearn提供的，只需将actual_y和predicted_y传入混淆矩阵()方法即可。</p><p id="fa64" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面显示了我们创建的两个模型的混淆矩阵。我们的基本模型导致有害的后果，因为它不能识别恶性患者，而即使随机森林模型识别一个不太良性的患者，它也减少了未识别恶性患者的数量，因此它将是我们的问题的优选模型。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div class="er es lc"><img src="../Images/de161b55db852507b6ad1f5dd694b736.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*C0zSY8s3sMZ3HQcZAgZzAw.png"/></div></figure><p id="da7e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">混淆矩阵是比较模型的有用方法，然而，假设我们以自动化的方式比较多个模型，则很难绘制多个混淆矩阵并对它们进行比较。因此，我们必须使用定量测量，这就是<strong class="iw hi">精度</strong>和<strong class="iw hi">召回</strong>的用武之地。</p></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><p id="7378" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">精度</strong>:在所有的正面预测中，有多少是正确的？在所有良性预测中，有多少是真正良性的？</p><ul class=""><li id="e770" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">精度= TP/(TP + FP)</li></ul><p id="6e42" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">回想一下</strong>:在所有实际阳性中，有多少被预测为阳性？在所有良性患者中，有多少被预测为良性？</p><ul class=""><li id="39fa" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">召回= TP/(TP + FN)</li></ul><p id="2b21" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">很容易混淆，区别在于它们的分母。<strong class="iw hi">精确预测是分母，召回是分母。</strong></p><p id="3d72" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在sklearn中，精确分数和召回分数都是作为方法提供的。我们可以通过使用混淆矩阵中的值来计算精度和召回率，从而进行双重检查。</p><p id="4659" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请注意，根据问题的不同，有时您需要高精度(识别癌症)，而有时您需要高召回率(识别商店扒手)。完美的模型将具有良好的精确度和召回率，然而在现实生活中存在可以通过改变阈值来调整的折衷。例如，如果我们将阈值从0.5降低到0.4，0.4~0.5中的更多值现在被分类为“1”，这增加了召回率并降低了精确度。</p><p id="7b08" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如:Precision _ base _ model = 106/(106+11)= 0.906</p><figure class="ku kv kw kx fd ii"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="76a6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这里，我们需要比较两个指标，尽管这比使用混淆矩阵更容易，但我们可以通过结合两者来简化它，<strong class="iw hi"> F1-score </strong>。</p><ul class=""><li id="6dd6" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated">分数的范围从[0，1]开始，它是精确度和召回率的<em class="jv">调和</em>平均值，也就是说，较低的值被赋予更多的权重。</li><li id="6961" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated">偏好具有相似精度和召回分数的分类器，这是它也被称为“平衡F分数”的原因。</li></ul><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ld"><img src="../Images/072f47985e39d6b70e7f5226c0f1a1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuTwhvJzIBdGWxb4uW3vBA.png"/></div></div></figure><p id="59f0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就像所有其他指标一样，f1_score作为sklearn方法提供。</p></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><p id="676a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之前，我们已经讨论过调整阈值来获得特定于我们问题的精确度和召回率。为了做到这一点，我们必须汇总每个阈值产生的所有混淆矩阵，这就是<strong class="iw hi"> ROC曲线</strong>的用途。</p><p id="1c19" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于我们想要比较的每个阈值<strong class="iw hi">，接收器工作特性(ROC)曲线绘制<strong class="iw hi">真阳性率(精度)对假阳性率(1-TNR) </strong>。</strong></p><p id="143c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们绘制每个分类器的ROC曲线，以比较我们应该选择的阈值，然后通过使用AUC(用于比较ROC曲线的ROC曲线下面积)分数，我们将比较两个分类器的ROC曲线。</p><figure class="ku kv kw kx fd ii"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="5fe2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">代表TPR = FPR的黑色斜线被我们的基本分类器覆盖，这意味着正确分类的良性<strong class="iw hi">患者的比例与错误分类的恶性<strong class="iw hi">患者的比例相同。</strong></strong></p><p id="52b5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们使用3个阈值[2，1，0]分别绘制了点[(0，0)，(0.2，1)，(1，1)]，从图中我们可以看到，阈值1产生了精度和FPR的组合，因此它是最优选的阈值。</p><p id="b78c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我们可以看到我们的随机森林分类器具有高得多的AUC分数，因此我们可以说随机森林分类器比基本分类器具有更好的性能。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/08dc386a2aaaa0780bcba21b79ff85cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klcUkX-S40CFTqHeS3BvwQ.png"/></div></div></figure></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><p id="658b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">总之，拥有正确的性能指标与拥有下降模型一样重要，因为使用不正确的指标可能会将您引向错误的方向。尽管我们只讨论了二元分类器，但是这些度量也扩展到了多类分类问题。希望这个博客是有帮助的，也希望每个人都为他们的模型选择合适的度量标准！</p></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><p id="b9be" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">参考资料:</p><ul class=""><li id="c69e" class="jz ka hh iw b ix iy jb jc jf kb jj kc jn kd jr ke kf kg kh bi translated"><a class="ae it" href="https://www.amazon.com/Hands-Machine-Learning-Scikit-Learn-TensorFlow/dp/1492032646" rel="noopener ugc nofollow" target="_blank">使用Scikit-Learn进行机器实践学习&amp; Tensorflow </a>第3章</li><li id="f1ca" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><a class="ae it" href="https://towardsdatascience.com/confusion-matrix-for-your-multi-class-machine-learning-model-ff9aa3bf7826" rel="noopener" target="_blank">多类分类器的混淆矩阵</a></li><li id="fe05" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><a class="ae it" href="https://www.mathsisfun.com/numbers/harmonic-mean.html" rel="noopener ugc nofollow" target="_blank">谐音的意思是</a></li><li id="ba64" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><a class="ae it" href="https://www.youtube.com/watch?v=2osIZ-dSPGE&amp;ab_channel=codebasics" rel="noopener ugc nofollow" target="_blank">精准，召回，F1-得分</a></li><li id="8050" class="jz ka hh iw b ix ki jb kj jf kk jj kl jn km jr ke kf kg kh bi translated"><a class="ae it" href="https://www.youtube.com/watch?v=4jRBRDbJemM&amp;ab_channel=StatQuestwithJoshStarmer" rel="noopener ugc nofollow" target="_blank">stat quest的ROC和AUC</a></li></ul></div></div>    
</body>
</html>