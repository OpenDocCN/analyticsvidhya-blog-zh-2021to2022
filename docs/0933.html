<html>
<head>
<title>On Vectorization of Convolution Layer in Convolution Neural Networks (CNNs)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卷积神经网络中卷积层的向量化研究</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/on-vectorization-of-convolution-layer-in-convolution-neural-networks-cnns-1775cb4d30e6?source=collection_archive---------3-----------------------#2021-02-07">https://medium.com/analytics-vidhya/on-vectorization-of-convolution-layer-in-convolution-neural-networks-cnns-1775cb4d30e6?source=collection_archive---------3-----------------------#2021-02-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6c67" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">拆箱！</strong></p><p id="4ee2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在深度学习中，<strong class="ig hi">卷积神经网络</strong> ( <strong class="ig hi"> CNN </strong>，或<strong class="ig hi"> ConvNet </strong>)是深度神经网络的一类。CNN在许多应用中表现出卓越的技术性能，例如图像和视频识别、推荐系统、图像分类、图像分割、医学图像分析和自然语言处理。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/41c885ac6ff440fbdde6ee8af2f2fbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OUonEDfZwCfR4Y-G-h1fw.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图1:卷积神经网络。</strong></figcaption></figure><p id="f75a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在本文中，我将只关注单个卷积层的矢量化，而不是整个卷积神经网络。</strong></p><h1 id="b335" class="jt ju hh bd js jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">卷积运算</strong></h1><p id="9ecc" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">在图像处理中，核、卷积矩阵或掩模是一个小矩阵。它用于模糊、锐化、浮雕、边缘检测等。这是通过在内核和图像之间进行卷积来实现的。</p><p id="bea0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">卷积是一种矩阵运算，由一个核(一个小的权重矩阵)组成，它在输入数据上滑动，与输入数据所在的部分执行逐元素乘法，然后将结果相加得到一个输出。</p><p id="4a0a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在数学(特别是泛函分析)中，<strong class="ig hi">卷积</strong>是对两个函数(<em class="kv"> f </em>和<em class="kv"> g </em>)的数学运算，产生第三个函数(f * g ),表示一个函数的形状如何被另一个函数修改。矩阵卷积的一般形式由下式给出:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kw"><img src="../Images/126e4211915b2aa7e986a0f4c3427816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIEB-CraOh2Rl-mr0bNurA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图二:矩阵卷积【1】。</strong></figcaption></figure><p id="8c3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">直观地说，卷积允许权重共享(减少有效参数的数量)和图像平移(允许在输入空间的不同部分检测到相同的特征)。</p><p id="fa82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">卷积运算的3D可视化可以如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kx"><img src="../Images/458a467af28d696ad4e7d94948c2e4da.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*_4QUitzCqzEqMhz5eK_Lzg.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图3:卷积运算的三维可视化。</strong></figcaption></figure><p id="cfb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据核的类型，可以从输入图像中提取不同的特征。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ky"><img src="../Images/af2787d57f0c3bbfeed10d70f3c75eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*ol3n2FaVPoxVgXbEgBtEvA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图4:常用滤镜【1】。</strong></figcaption></figure><p id="0224" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">卷积运算的输出通常被称为<strong class="ig hi">“特征图”</strong>。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kz"><img src="../Images/06dfed88783eb0ac82a82ee917a1e390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/1*wvwT9LlHcDfexIiv7fWWxA.gif"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图5:卷积特征。</strong></figcaption></figure><p id="77f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种卷积运算是卷积神经网络的主干。</p><h1 id="0492" class="jt ju hh bd js jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">让我们进行代码卷积运算</strong></h1><p id="e7ce" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">针对单个输入图像的简单卷积运算的Python代码如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es la"><img src="../Images/27c3431e584d1346102b098eb85edd1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SuPvzC2Ol0UrjItlXGlx5A.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图6:用于单个输入图像的卷积操作的代码。</strong></figcaption></figure><p id="88ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述操作将给出以下结果，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lb"><img src="../Images/0a7c518a73294dde55e9de528ed70ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJ7BATm-1UO1lchdXOOFJQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图7:原始图像(左)和高斯模糊(右)。</strong></figcaption></figure><p id="a5b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是上述实施将仅对一个输入图像执行卷积，<strong class="ig hi">如果我们将多个图像输入到网络中(例如小批量)</strong>会怎样？显然，我们想到的最简单的方法就是简单地在整个迷你批处理中循环上面的操作。假设2D背景和白色图像，与具有3个通道(RGB)(例如(28，28，3))的彩色图像相比，它具有1个通道(例如(28，28，1))。因此，上述设置的代码看起来会像这样，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/a7b34fe0078812770b1a57501842422e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SsRxBxDPU8ewWOQFiNQqQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图8:多个输入图像的卷积运算代码。</strong></figcaption></figure><p id="ea70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们将此应用于手写数字——MNIST数据集。MNIST数据集由60，000张28 x 28的训练图像组成。输入大小将是(60000，28，28，1)。在应用具有3 x 3 x 1的内核大小和32个过滤器(输出通道)的卷积层之后，该层的输出将是(60000，26，26，32)。</p><p id="8d82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">具有32个不同过滤器的卷积层的输出看起来像这样，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ld"><img src="../Images/26aa4ac0ee23b9ec23d3d1d319bcffa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mzhBgABeMq2rHdRqPDGm9Q.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图9:带有32个滤镜的卷积层的输出。</strong></figcaption></figure><p id="cbc1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是考虑到数据集中所有输入图像(MNIST的60000张图像)的循环，上述实现方法将会非常慢。因此，上述方法并不是最突出的方法，为了更好地理解和便于并行实现，<strong class="ig hi">矢量化方法是关键</strong>。训练和测试深度细胞神经网络的关键步骤被抽象为矩阵和向量算子，在此基础上可以很容易地实现并行。</p><p id="de38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">考虑到5000个图像的<strong class="ig hi">小批量</strong>，上述实现花费<strong class="ig hi"> 658.169秒。</strong>随着输入图像数量的增加，运行时间也呈指数增长。</p><h1 id="80f1" class="jt ju hh bd js jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">向量化卷积的策略</h1><p id="4aec" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">矢量化是指将原始数据结构转换为矢量表示的过程，以便标量运算符可以转换为矢量实现。</p><p id="5446" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">考虑具有3个不同的2×2滤波器的3×3的输入图像，在卷积运算期间，每个滤波器将在相同的输入图像上运行，并将产生2×2的输出特征图。因此，3个不同的过滤器将产生3个“特征图”。有一种方法可以将这个操作矢量化。</p><p id="41bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">向量化上述操作的步骤包括，</p><ol class=""><li id="6c98" class="le lf hh ig b ih ii il im ip lg it lh ix li jb lj lk ll lm bi translated">将所有内核/过滤器转换为行，并获得一个内核矩阵。</li><li id="5f50" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">将你的输入(图像)分割成切片进行卷积，然后转换成列，得到一个输入矩阵。您可以附加其他输入(图像)以形成小批量</li><li id="b345" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">将输入矩阵与核矩阵相乘。在结果矩阵中，每一行都是一个特征图。</li></ol><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ls"><img src="../Images/78c96fbc901fc79d9b66bfd759fd555c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*99_1GwFpT5TVvK8RlVPmKA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图10:向量化卷积的策略。说明了用三个2x2内核卷积一个3×3输入图像并生成三个2x2特征图的方法[2]。</strong></figcaption></figure><p id="1871" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">类似的策略被用于实现，并且用于32个不同滤波器的输入大小(5000，28，28，1)的代码将看起来像这样，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lt"><img src="../Images/9fb18cacbcf6f2dbc3298757d992fed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bAQpbkbadDUYhqoI2daihQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图11:展平输入图像</strong></figcaption></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lu"><img src="../Images/5ea240e0eaa91f4b4aac5d8bc585872e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3E9f7-7MASyjmGlOhFlVKw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图12:对多个输入图像的卷积操作进行矢量化的代码。</strong></figcaption></figure><p id="4fea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的实现产生了类似的输出，但是现在实现运行时间减少到只有<strong class="ig hi"> 1.511秒</strong>，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lv"><img src="../Images/ac677c151f132d7dc3eba1f4582f61b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCbLBX43HnloPgfD9RH5lA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><strong class="bd js">图13:带有32个过滤器的矢量化卷积层的输出。</strong></figcaption></figure><p id="db34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要了解更多细节，我建议读者看看Jimmy SJ的论文<strong class="ig hi">“关于视觉任务的深度卷积神经网络的矢量化”。和许。</strong></p><h1 id="7ca8" class="jt ju hh bd js jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">总结</strong></h1><p id="64a3" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">在本文中，我阐述了深度卷积神经网络(CNN)中卷积层的矢量化是如何工作的。矢量化是减少总运行时间的关键。</p><h1 id="a478" class="jt ju hh bd js jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">参考文献</strong></h1><p id="8869" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">[1]https://en . Wikipedia . org/wiki/Kernel _(image _ processing)</p><p id="9e2a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae lw" href="https://en.wikipedia.org/wiki/Convolutional_neural_network" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Convolutional_neural_network</a></p><p id="c760" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[3] <a class="ae lw" href="http://lxu.me/mypapers/vcnn_aaai15.pdf" rel="noopener ugc nofollow" target="_blank">吉米SJ。许。用于视觉任务的深度卷积神经网络的向量化。</a></p></div></div>    
</body>
</html>