<html>
<head>
<title>Consuming Slack Events with Event Subscription API and Slack App in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的事件订阅API和Slack应用程序消费Slack事件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/consuming-slack-events-with-event-subscription-api-and-slack-app-in-python-681cab354571?source=collection_archive---------7-----------------------#2021-07-26">https://medium.com/analytics-vidhya/consuming-slack-events-with-event-subscription-api-and-slack-app-in-python-681cab354571?source=collection_archive---------7-----------------------#2021-07-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7499" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Slack是一个通用的平台，每个组织都使用它在员工之间进行交流。</p><p id="1dae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">等等，slack只用于员工之间的交流吗？</strong></p><p id="7ed0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">答案，在我看来是否定的，因为slack提供了各种API、入局webHooks、Bots创建等。这使得它有多种用途。我们可以将任何其他服务绑定到Slack。不仅如此，Slack还可以用作服务间通信的缓冲区。</p><p id="92e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您希望构建一个事件驱动的服务，每当Slack通道中发生变化时运行您的业务逻辑。变化可以是任何事情，比如收到新消息，对消息的任何反应，比如表情符号，或者任何事情。这只是我在<strong class="ig hi"> SAP Labs India，</strong>的实习生项目的一部分，在那里我的微服务需要处理Slack。听起来很有趣，对吧？那么，如何用Slack绑定你的云服务呢？有什么办法吗？在轮询中不浪费网络调用的情况下，我们能得到松弛信道的更新吗？</p><p id="162e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">答案是肯定的，这一切都可以借助Slack Events API和Slack App/bot在Slack中完成。</p><p id="ef27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">* <em class="jc">注Slack bot也是一款Slack应用，旨在与用户互动。所以不要搞混我在哪里写了slack App/bot。为了便于理解，您可以假设两者相同。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/1046ae13518403bed70b6cbbe0a1d163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBaC5Hu4g7dLRQDVZ0A4Cw.png"/></div></div></figure><p id="e2c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我带你看一下使用Slack Events API和Slack App/bot创建的过程。我们将分两步进行，如下所示:</p><p id="3e4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 1。创建Slack应用程序/机器人并订阅事件。</strong></p><p id="1c11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2。从我们的python服务中消费这些事件。</strong></p><blockquote class="jp jq jr"><p id="44db" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated"><strong class="ig hi">步骤1:创建Slack App/bot并订阅事件:</strong></p></blockquote><p id="16ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们希望我们的服务在我们的Slack工作空间发生任何变化时都能得到通知。对吗？我们也必须把这一切告诉斯莱克。但是我们如何做到这一点呢？Slack App/bot就是这样做的。所以让我们创造一个yoooo…..</p><ol class=""><li id="8287" class="jv jw hh ig b ih ii il im ip jx it jy ix jz jb ka kb kc kd bi translated"><a class="ae ke" href="https://api.slack.com/" rel="noopener ugc nofollow" target="_blank">https://api.slack.com/</a>在右上方你会看到<strong class="ig hi">你的应用</strong>选项</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/169d7da307df85234032df05f1114e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*IE7mECrJAh5Fv9TNQH1Snw.png"/></div></figure><p id="0270" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.点击你的应用程序，你可以看到你创建的所有应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kg"><img src="../Images/bd2d9b0df4576884941c592cfddbabec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*aUsNRGERpanypZ4b_ETRaQ.png"/></div></figure><p id="c180" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.点击创建应用程序选项。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kh"><img src="../Images/21731caf1627087bdbdb144432ca90f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*BidG_ApdH5GoRvL00ZT17Q.png"/></div></figure><p id="5321" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.点击从头开始，给你的应用程序命名，并选择工作区。点击创建应用程序。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ki"><img src="../Images/62cb5198a859e75326543a07bb5d3ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*ef_QkBRpBSzXeD4ftNnM5w.png"/></div></figure><p id="ccda" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.现在，您的应用程序已经创建，就像我们已经雇用了一个人，但我们需要给他分配一份工作。所以让我们来分配它。你一定会看到和下图一样的屏幕。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kj"><img src="../Images/67ea86374e4bb9ad6b1e2aea55221351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*HYYYWJ0RmsMWxjWvZ5J8WA.png"/></div></figure><p id="a951" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在最左栏的顶部，你会看到你的应用程序名称，在我的例子中是<strong class="ig hi"> For-article-demo。</strong></p><p id="878b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.从“功能”下最左侧的列中选择事件订阅。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kk"><img src="../Images/2da2e8f64e7c857786836973aec15137.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*HIm-hcbf-N9Gbakct5919A.png"/></div></figure><p id="5975" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">7.为您的slack应用程序激活活动订阅</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kl"><img src="../Images/7079109f1c275feac2f10bbe39fbc6d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*OLK_zfTnSo928BecKOMXuw.png"/></div></figure><p id="c870" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在请求URL中，我们需要给出我们的服务的URL，它应该在web上。Slack将通过向这个URL发送POST请求来验证这个端点。我们的服务应该返回质询参数作为响应或松弛验证令牌(您可以在基本信息中找到)。一旦这被验证，Slack应用程序将只在这个端点上发送所有未来的事件。</p><p id="0997" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">* <em class="jc">注意，如果您的服务不在web上，您可以使用ngrok工具，将流量从ngrok转发到您的本地端口。</em></p><p id="afc8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">经过验证应该是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es km"><img src="../Images/c126b892775ad4e1237dbf4aaffa26eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*b_ci__9fJXfsN5AL1lIK4g.png"/></div></figure><p id="8c9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以到目前为止，我们已经雇了一个人，告诉他们通过给我们的地址在我们的办公室更新我们。</p><p id="1ea0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们给他分配一些工作，意味着为我们的Slack应用程序订阅一些事件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kn"><img src="../Images/abdcbc5282545b7dc81704f9aef0f1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*bsbd8WYCwg4i9Xym8mrAZQ.png"/></div></figure><p id="59bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择bot事件后，单击保存更改。</p><p id="d6d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">验证终点的代码。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="1dbe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">8.单击OAuth &amp; Permission，将应用程序安装到您的工作区。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kq"><img src="../Images/38bbce72e43621f381272b35d3e80394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*cjOOkgwjuDMrneokzKwfLw.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kr"><img src="../Images/856997cb1e6826108edc18632abcf0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*k7WJ-ntNik3gRYiRRtuvgg.png"/></div></figure><p id="7b23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦你把我们的应用程序安装到你的工作区，就会生成一个<strong class="ig hi">机器人用户OAuth令牌</strong>，用于API验证。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ks"><img src="../Images/2a58d96813919f174416fdd3ad267446.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*RqpTB_6FuDaQnfOQRzCYIg.png"/></div></figure><p id="6031" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">9.现在，让我们将我们的应用程序添加到slack通道中，以获取消息作为事件。</p><p id="3821" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.在聊天框中键入@app_name，然后按回车键</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kt"><img src="../Images/9c4f306d82c7610b18985ab147d95881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*pAxggtEbkm8_QXyfZ6ROHQ.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kt"><img src="../Images/9c4f306d82c7610b18985ab147d95881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*pAxggtEbkm8_QXyfZ6ROHQ.png"/></div></figure><p id="a94a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.这里<strong class="ig hi">为文章演示</strong>是一个应用名称</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ku"><img src="../Images/fa079556305bcd49e5bc8d7feaf79eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*p4J4Ow96X-H5ywDXIs4qfg.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kv"><img src="../Images/8b6f32d8f7dd72ed0eb26990cab8967a.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*a9EZdXnVUh7t2crqWRMoJg.png"/></div></figure><blockquote class="jp jq jr"><p id="f72f" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated"><strong class="ig hi">步骤2:现在让我们从python服务中消费这些事件</strong>:</p></blockquote><p id="366b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们在空闲时发送消息。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/def0487e295b152de6842647d74c6e0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1330/format:webp/1*iU-BLOngogsHEq06hT30vg.png"/></div></figure><p id="d0bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将在python服务中获得名为message的事件。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="df4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有效负载将如下所示:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="5afc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">*注意:我已经用xxxxxxxxx替换了其他详细信息</p><p id="367d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您将收到您的应用程序订阅的所有slack事件。最后，全部完成🤩。</p><p id="be25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">😵这个过程有点长，有点混乱，但是这个特性非常有趣。</p><p id="69e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望你喜欢它！！！</p><blockquote class="jp jq jr"><p id="b02d" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">参考资料:</p><p id="c4a6" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated"><a class="ae ke" href="https://api.slack.com/apis/connections/events-api" rel="noopener ugc nofollow" target="_blank">https://api.slack.com/apis/connections/events-api</a>，<a class="ae ke" href="https://www.youtube.com/watch?v=6gHvqXrfjuo" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=6gHvqXrfjuo</a></p></blockquote></div></div>    
</body>
</html>