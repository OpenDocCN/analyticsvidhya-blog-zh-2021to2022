<html>
<head>
<title>Spice up your Excel FX report with Python 1/2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python 1/2为您的Excel FX报表增添趣味</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spice-up-your-excel-fx-report-with-python-1-2-183be5386a4e?source=collection_archive---------15-----------------------#2021-01-19">https://medium.com/analytics-vidhya/spice-up-your-excel-fx-report-with-python-1-2-183be5386a4e?source=collection_archive---------15-----------------------#2021-01-19</a></blockquote><div><div class="dt gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6a09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个简单的方法来自动化你的汇率P&amp;L影响。第一步:与你的会计团队沟通。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et jd"><img src="../Images/f4904210c6b465f512ac68db5346261d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*d5mefkW2S-qrzdav"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy translated"><a class="ae jt" href="https://unsplash.com/@ninjason?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">梁杰森</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="5a0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">汇率管理是自动化有意义的话题之一。我们正在讨论一个具有高度波动性的问题，如果你管理一家进出口公司，那么汇率可能是你P&amp;L业绩的一个重要组成部分。</p><p id="f690" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本教程中，我将向你展示一个简单的方法来获得购买过程中每一步的最新汇率。在第一部分中，我将向您展示如何向您的会计团队发送与在世界各地购买的产品的购买成本相关的过账，并以正确的汇率转换付款。</p><p id="f241" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了避免过多的信息，我将在另一篇文章中介绍符合IAS标准的财务报表(以及对您当地gaap的一些建议)，以及如何使用这些数据来执行一些财务分析并在您的财务报告中绘制它们。</p><h2 id="8762" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">项目介绍:</h2><p id="90dc" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我们有一个excel报表，其中有一个简单的150笔采购的列表，包括供应商名称、采购金额和运营货币；购买日期和付款日期。如果你想用的话，我的github上有这个文件。</p><div class="ku kv fa fc kw kx"><a href="https://github.com/Aymen-lng/IAS_21/blob/main/IAS21_part1.xlsx" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dx"><div class="kz ab la cl cj lb"><h2 class="bd hj fj z dz lc eb ec ld ee eg hh bi translated">阿曼-液化天然气/IAS_21</h2><div class="le l"><h3 class="bd b fj z dz lc eb ec ld ee eg dy translated">在GitHub上创建一个帐户，为Aymen-lng/IAS_21的开发做出贡献。</h3></div><div class="lf l"><p class="bd b fq z dz lc eb ec ld ee eg dy translated">github.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll jn kx"/></div></div></a></div><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et lm"><img src="../Images/6ae632502a37e8d866fdeb89216e038f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPG95GDy4awdNpXDku4sLw.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy translated">图片来自作者</figcaption></figure><p id="67aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将构建一个python脚本，该脚本将分析每一笔采购，必须完成的会计过账(用正确的汇率转换的借贷)，计算每次付款时实现的外汇损益，并最终将会计过账写回到excel报告中，准备发送给您的会计团队。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et ln"><img src="../Images/819bfeb7795807760e8b191509637491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sHrKYvm5oRT4NyMKkR8olA.png"/></div></div></figure><h2 id="d5eb" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">标准框架:IAS 21(编码前的几个业务解释)</h2><p id="5a18" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在开始编写代码之前，让我们解释一下购买的每一步我们将使用哪个比率。我们将使用的框架是IASB(国际会计准则委员会)标准。这是适用于世界上大多数国家的标准，取决于公司的规模或您工作的市场(<a class="ae jt" href="https://www.ifrs.org/use-around-the-world/use-of-ifrs-standards-by-jurisdiction/" rel="noopener ugc nofollow" target="_blank">https://www . IFRS . org/use-around-the-world/use-of-IFRS-standards-by-jurisdiction/</a>)</p><p id="8ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用的具体标准是IAS 21。如果你想了解更多细节，我在下面放了IASB文章的链接:</p><div class="ku kv fa fc kw kx"><a href="https://www.ifrs.org/issued-standards/list-of-standards/ias-21-the-effects-of-changes-in-foreign-exchange-rates/#about" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dx"><div class="kz ab la cl cj lb"><h2 class="bd hj fj z dz lc eb ec ld ee eg hh bi translated">国际财务报告准则（InternationalFinancialReportingStandards）</h2><div class="le l"><h3 class="bd b fj z dz lc eb ec ld ee eg dy translated">国际财务报告准则基金会是一家在美国注册的非营利公司</h3></div><div class="lf l"><p class="bd b fq z dz lc eb ec ld ee eg dy translated">www.ifrs.org</p></div></div></div></a></div><p id="fc77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里使用的标准的要点是:</p><ol class=""><li id="8ec6" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc lt lu lv lw bi translated">购买材料时，我们使用购买日期来转换损益表中的成本和资产负债表中的供应商负债。</li><li id="b4f6" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">当支付材料时，我们将使用支付日期的汇率在资产负债表上记录现金支出，使用“历史汇率”(购买日期的汇率)来结清负债，两者的差额就是损益</li><li id="7d01" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">在期末，当提交财务报表时，我们将保持历史汇率的非货币要素(如存货)和以实际汇率(报表日的汇率)记账的货币要素(如负债)分开。</li></ol><p id="d7bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要担心它仍然有点混乱，现在我们将一步一步地构建项目:</p><h2 id="4a21" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤1:设置python脚本并导入数据</h2><p id="f3c9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">让我们从脚本中使用的库开始:</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="5487" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么我们这里有什么:</p><p id="2e48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> OS </strong>:用于导航进入你的电脑，找到你的excel报表的路径，其中有采购清单。<br/> <strong class="ih hj">熊猫</strong>:著名的用来玩数据的图书馆。<br/> <strong class="ih hj"> Datetime </strong>:操作我们将用于这个项目的所有日期。<br/> <strong class="ih hj"> Itertools </strong>:如果你已经对循环很有信心，但还不知道Itertools，你会发现一个很好的工具，它可以为代码后面使用的循环增添趣味。<br/> <strong class="ih hj">请求</strong>和<strong class="ih hj"> bs4 </strong>:用于废弃特定网站的汇率。<br/> <strong class="ih hj"> Xlwings </strong>:最适合我玩Excel的库。</p><p id="da88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们使用“os”找到报告，并创建一个变量“Data_Base”。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="b1e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过打印数据框来看看结果:</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et me"><img src="../Images/0810c27f5168a86f404796ed7ffedc42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0YASLEbmjnH8FLLwWRG4A.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy translated">图片来自作者</figcaption></figure><p id="e706" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我建议创建列表变量来存储数据框的元素，我们将在这些数据框上循环获取汇率并进行所需的计算。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><h2 id="3014" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤2:采购成本和负债过帐</h2><p id="de14" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在这个项目中，我们将根据购买日期和/或付款日期对购买进行多次循环，以检查不同的汇率。我将在此介绍如何完成物料采购的会计过账循环。</p><p id="f391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从购买日期的汇率开始。我们将删除来自x-rates.com的日期，以便获得汇率，我们只需将1种外币转换成欧元，然后删除结果。在URL中，我们只需用一个变量更改货币，用第二个变量更改日期，用另一个变量更改金额:</p><pre class="je jf jg jh fe mf mg mh mi aw mj bi"><span id="3916" class="ju jv hi mg b fj mk ml l mm mn"><a class="ae jt" href="https://www.x-rates.com/historical/?from='+x+'&amp;amount=1&amp;date='+y" rel="noopener ugc nofollow" target="_blank">‘https://www.x-rates.com/historical/?from='+<strong class="mg hj">x(first variable)</strong>+'&amp;amount'=<strong class="mg hj">z(third variable)</strong>+'&amp;date='+</a><strong class="mg hj">y(second variable)</strong></span></pre><div class="ku kv fa fc kw kx"><a href="https://www.x-rates.com/historical/?from=USD&amp;amount=1&amp;date=2020-12-12" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dx"><div class="kz ab la cl cj lb"><h2 class="bd hj fj z dz lc eb ec ld ee eg hh bi translated">美元历史汇率(美元)— X汇率</h2><div class="le l"><h3 class="bd b fj z dz lc eb ec ld ee eg dy translated">获取过去美元国外费用的历史汇率。选择您的货币和日期获得历史…</h3></div><div class="lf l"><p class="bd b fq z dz lc eb ec ld ee eg dy translated">www.x-rates.com</p></div></div></div></a></div><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="0144" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我首先创建一个空的“H_price”列表，其中存储了截至购买日期的所有历史转换价格。然后我使用Zip for循环来同时循环三个列表(currency、P_date和P_amount)。基本上，我要求同时获得货币、购买日期和购买金额，存储在变量x、y和z中。<br/>然后我将日期y转换为URL所需格式的字符串，金额也转换为字符串，并使用URL创建一个漂亮的组请求，其中x表示货币，y表示日期，z表示金额。</p><p id="26c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经写了一篇文章，详细介绍了BeautifulSoup请求以及准备HTML以定位所需信息的方法:</p><div class="ku kv fa fc kw kx"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/web-price-survey-currency-conversion-and-whatsapp-notification-1-2-27ff0d9a3db7"><div class="ky ab dx"><div class="kz ab la cl cj lb"><h2 class="bd hj fj z dz lc eb ec ld ee eg hh bi translated">带有网络抓取和whatsapp通知的亚马逊价格调查</h2><div class="le l"><h3 class="bd b fj z dz lc eb ec ld ee eg dy translated">一个让网络成为你的数据库的美汤的实际案例。</h3></div><div class="lf l"><p class="bd b fq z dz lc eb ec ld ee eg dy translated">medium.com</p></div></div><div class="lg l"><div class="mo l li lj lk lg ll jn kx"/></div></div></a></div><p id="76ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提醒一下，在变量“page”中，我将请求和URL存储在一起。在变量“soup”中，我指定我将在变量“page”中读取HTML。在变量“price_box”中，我存储了支票的特定HTML行，以便确定汇率。我将结果存储在变量“price”中，并将其放入最初创建的列表(“H_price”)。</p><p id="aaf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们有了正确的购买转换价格，我们可以将其添加到我们的数据框中，并转换为浮动金额。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="0b27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将采购的会计过账放在一个单独的数据框中。为此，我创建了一个字典“purch_post”如下:<br/>发布日期:列表P_date的值。<br/>过账描述:列表供应商的值与“_采购”连接。<br/>借记账户:“材料采购”。<br/>借方金额:在列表H_price中刮取的值。<br/>贷方账户:列表供应商的值与“_负债”连接。<br/>贷方金额:H_price的值。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><h2 id="aa26" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤3:付款过账</h2><p id="4e86" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">对于付款，我们将使用与购买完全相同的基础，除了我们将使用付款日期循环。但是如果我们就此止步，我们将面临不平衡的排名。</p><p id="a6e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">唯一的区别是，如果您使用完全相同的循环，您将转换所有带有付款日期的发票。但是如果付款日期在未来呢？可以肯定的是，在你检查这个项目的时候，所有的付款日期都将成为过去。但是我将在这里提供一个代码，可能对您的日常监控有用。因此，我将创建一个变量“Today ”,它将存储今天的日期，如果付款日期小于或等于今天，我将转换金额，如果不是，我们将只存储0到列表中。</p><p id="5cd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PS:我在这里放了下面2行代码，但是你只能选择一行。如果你想练习把一个随机的日期放在2020年12月，如果你想要一个对你有用的代码，使用today datetime函数。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="4553" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将它添加到第一个数据帧中，以浮点形式转换:</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="2ea8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在我们有了历史汇率的负债，存储在列表“Pay_price”中的提款是以实际汇率进行的。我们如何处理这种差异？轻松点。我们将创建一个简单的函数，如果付款金额低于负债金额，该函数将向列表“gain”追加差额的绝对值，并在相反的情况下追加列表“loss”:</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="1310" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建的最后一个列表。要结清的负债清单。非常简单。如果付款日期低于或等于今天，我们采用历史价格，如果不是，我们将设置为0(我们不想关闭负债)。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="d015" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们创建数据框发布。所以我们从如下字典开始:</p><p id="fc50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">过账日期:列表D_date的值。<br/>过账描述:列表供应商的值与“_付款”连接。<br/>借记账户:我们借记供应商负债以取消它们。<br/>借方金额:列表close_pay中的值。<br/>借方账户2:“损失变化”+货币<br/>借方金额2:如果需要，我们将损失计入汇率。<br/>贷方账户:“银行”<br/>贷方金额:支付值_价格。<br/>贷方账户2:“收益变动”+币种。信用额度2:如果需要的话，我们将收益计入汇率</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><h2 id="d9d2" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤4:在Excel中进行会计过账</h2><p id="53af" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这一步是最简单的一步。首先，让我们将创建的两个过帐数据框架合并成一个名为“Accounting_posting”的数据框架。我添加了一个“填写na”选项，以在借方和贷方2中提及采购过账行的“无过账”。</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><p id="d301" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们创建两个变量，一个用于我们将发布的工作簿，另一个用于工作表。我们用数据框设置该工作表的单元格“A1”的值:</p><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mc md l"/></div></figure><h2 id="daa2" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">结论:</h2><p id="e16c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我希望你喜欢这篇结合了金融和编码技能的文章。在下一篇文章中，我们将重点介绍外汇变化的报告过账和财务分析，包括数据可视化。</p><h2 id="b71c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">完整代码:</h2><figure class="je jf jg jh fe ji"><div class="bz dz l di"><div class="mp md l"/></div></figure></div></div>    
</body>
</html>