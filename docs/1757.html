<html>
<head>
<title>Stock Price Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">股票价格预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/stock-price-prediction-ade10ac8ce08?source=collection_archive---------7-----------------------#2021-03-16">https://medium.com/analytics-vidhya/stock-price-prediction-ade10ac8ce08?source=collection_archive---------7-----------------------#2021-03-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/9adc581be340fa3e4975da86db5f14c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oWZiknkZ2GzGBkIJ"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">马克西姆·霍普曼在<a class="ae hu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="7127" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">基于公司基本面而非技术指标预测股价的机器学习。</h2></div></div><div class="ab cl jm jn go jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="ha hb hc hd he"><h1 id="8fad" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jd ke je kf jg kg jh kh jj ki jk kj kk bi translated">介绍</h1><p id="4218" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">股票市场是一个疯狂的地方，一千可以变成一百万，几百万可以化为乌有。没有人能预测明天市场会怎样。社交媒体兴起后，这种情况尤其不稳定。最近的一个例子是Gamestop股票，这只<em class="lh">【meme】</em>股票在15天内上涨超过1600%。另一个例子是一家名为<em class="lh">的公司股价暴涨1100%，标志着股价上涨</em>。当埃隆·马斯克(Elon Musk)在twitter上敦促他的追随者<em class="lh"/>“使用消息应用软件Signal”时，散户投资者开始购买一家不相关的Signal Advance的股票。没有人对公司的利润、股本回报率或股息支付感兴趣(有些人甚至不关心公司做什么)。现在，一切都是关于行情、技术指标和社交媒体趋势。</p><blockquote class="li lj lk"><p id="91e1" class="kl km lh kn b ko ll iy kq kr lm jb kt ln lo kw kx lp lq la lb lr ls le lf lg ha bi translated">当你在投机的时候，千万不要自欺欺人地认为你是在投资- 本杰明·格拉哈姆</p></blockquote><p id="4426" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">我见过很多机器学习模型做同样的事情，推测。推测市场是在上涨，还是在下一刻下跌。在这篇文章中，我们将讨论一个基于公司基本面，使用XGBoost算法预测股票价格的模型。因此，根据预测，我们可以决定股票是被低估还是被高估。</p></div><div class="ab cl jm jn go jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="ha hb hc hd he"><h1 id="ad3d" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jd ke je kf jg kg jh kh jj ki jk kj kk bi translated">数据如何？</h1><p id="e57f" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">我们将使用的数据是Nifty 500的基本面，即在NSE交易的前500家公司。我使用web scrapping收集了这些数据，其范围不在本博客中。我可能会写一个单独的帖子。你可以点击<a class="ae hu" href="https://www.kaggle.com/sawantvishwajeet729/nifty-500-stock-fundamentals" rel="noopener ugc nofollow" target="_blank">这里</a>从Kaggle下载数据。</p><p id="5668" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">该数据有482行(482个不同的公司)和70列(70个特征)。我知道我说的是Nifty500，但是我还是设法收集了482的数据(不错！).数据中的特征包括市场资本、ROE、ROCE、季度结果、利润/损失、股票价格CAGR、资产负债表(过去3年)等。有些功能具有过去3个时间间隔收集的数据，如季度结果。过去3个季度的结果收集在此数据集中。如下图所示。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es lt"><img src="../Images/732a55ef9d99eadf01d016531d2bfc94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*kiJMpza8B4xl570yHvWkuw.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">数据集的片段</figcaption></figure><p id="00dc" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">也可以点击<a class="ae hu" href="https://www.kaggle.com/sawantvishwajeet729/stock-price-prediction" rel="noopener ugc nofollow" target="_blank">这里</a>看代码。通过这种方式，您可以看到本博客中描述的代码。</p><h1 id="fadc" class="jt ju hx bd jv jw ly jy jz ka lz kc kd jd ma je kf jg mb jh kh jj mc jk kj kk bi translated">数据清理和特征工程</h1><p id="657b" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">收集的数据是干净的(除了18家公司，这就是为什么数据有482个唯一的行)。数据集中没有缺失值。我们要预测的目标变量是股票的当前价格。如下图所示，目标变量高度倾斜。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es md"><img src="../Images/58482f0d2e2d9a646a5b9be96e13a497.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*lBumKmNCHtiErgcWA1Lkjg.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">当前股价分布</figcaption></figure><p id="c898" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">虽然我们使用基于树的XGBoost算法来训练模型，但我们将转换目标变量，使其均匀分布。我对两个数据集都进行了尝试，结果表明，对于均匀分布的数据集，该模型提供了更好的准确性。记录目标变量的日志就可以了，正如你在下面看到的，它确实起作用了。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es me"><img src="../Images/a179b974ccacb4f5a2ee0f6b09a5b87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*Bw6rDiaxGCXnZpx7aL7mLQ.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">当前价格分布(对数变换后)</figcaption></figure><p id="6614" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">由于所有的特征都是连续的，我们将查看相关图，以移除彼此高度相关的特征。因为它是一个70X70的桌子，我没有在这里展示，但是你可以通过点击<a class="ae hu" href="https://www.kaggle.com/sawantvishwajeet729/stock-price-prediction" rel="noopener ugc nofollow" target="_blank">这里</a>在kaggle上看到完整的桌子。我还从数据集中删除了52周的高价和低价，因为它与目标变量高度相关，预测将偏向于这些特征，而不是从其他基本面中学习。这就是我们需要的所有数据清理和特征工程，尽管如果它能提高准确性，您还可以探索更多。</p><h1 id="3caf" class="jt ju hx bd jv jw ly jy jz ka lz kc kd jd ma je kf jg mb jh kh jj mc jk kj kk bi translated">基线预测</h1><p id="b3fa" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">我们将需要一个基线预测来衡量我们的模型的性能。通常，平均值或中值用作基线预测。但是我们有一个更好的选择，我们将使用股票的账面价值作为基线预测。股票的账面价值是指如果公司出售所有资产并偿还所有债务，投资者将得到的金额。因此，如果股东决定清算公司，账面价值大致等于他们将得到的金额。</p><p id="b85b" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">在将原始数据集划分为训练数据集和测试数据集之后，我们将计算测试数据集相对于基线预测的平均绝对误差。结果见下图。我们的目标是提高这些分数。MAE也是我们将用于训练模型的指标。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es mf"><img src="../Images/530b1dd42665a806037d6e8471fe9a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*mDW1rOKwC-84vJbWI8Dizw.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">基线预测的度量分数</figcaption></figure><h1 id="175c" class="jt ju hx bd jv jw ly jy jz ka lz kc kd jd ma je kf jg mb jh kh jj mc jk kj kk bi translated">XGBoost模型训练</h1><p id="2070" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">我们将使用XGBoost算法，因为它是kaggle上任何数据科学家的首选。现在我已经调好了XGBoost的hyper参数，它给了我最好的结果。但是如果你想的话，你可以自己试一试。</p><p id="2fe5" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">在训练之后，该模型在1285轮助推时在测试数据集上具有大约0.337的平均绝对误差。这与我们在基线预测中达到的1.31相比是一个显著的进步。完整的结果可以在下面看到。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es mg"><img src="../Images/22ce06bc9e4ba8a7e6407f7c58875c7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*g7Zfo7YfFHwjBUyYQGbqLg.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">XGBoost模型预测的度量分数</figcaption></figure><p id="9b13" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">我们可以检查这些特征的分数，看看哪些特征在决定股票价格方面贡献更大。可见，账面价值和市值在决定股价时是非常重要的。fscore的结果非常直观，这可以作为选择投资股票(而不是投机)的决定因素。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es mh"><img src="../Images/b278c9b7595e9953478877b3e5c0c7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*2VwweuDuq9izLOHiDBOlGw.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">前20大功能的Fscores</figcaption></figure><p id="915a" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">我们还可以将预测结果与实际股价进行比较，找出哪些股票被高估或低估。但这也意味着我们应该有所有股票正确估值的完美数据(这从来都不是真的)。股票市场是不稳定的，几乎不可能预测，这个博客只是试图抓住表面。</p><p id="f466" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">让我们在测试数据集上看看模型的一些预测。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div class="er es mi"><img src="../Images/f2fc31a5cd18161b9adad8b5174cbb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*YMG9iKulJn8kR5gnNL8NQg.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">预测与实际股价</figcaption></figure></div><div class="ab cl jm jn go jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="ha hb hc hd he"><h1 id="c9a4" class="jt ju hx bd jv jw jx jy jz ka kb kc kd jd ke je kf jg kg jh kh jj ki jk kj kk bi translated">放弃</h1><p id="62de" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">我希望你喜欢读这篇文章。炒股有风险。写这篇博客只是为了提供信息，我建议不要在实际的股票交易中使用这段代码的结果。</p></div><div class="ab cl jm jn go jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="ha hb hc hd he"><figure class="lu lv lw lx fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mj"><img src="../Images/f9727507a22811ffdeb6d654f5c0b344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ffMOlLfUL1lGKAOT"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">马库斯·温克勒在<a class="ae hu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="2bf5" class="jt ju hx bd jv jw ly jy jz ka lz kc kd jd ma je kf jg mb jh kh jj mc jk kj kk bi translated">更新于2021年7月19日</h1><p id="6c91" class="pw-post-body-paragraph kl km hx kn b ko kp iy kq kr ks jb kt ku kv kw kx ky kz la lb lc ld le lf lg ha bi translated">你好。我在2021年3月16日发表了这篇博客。本财年的第一季度已经结束，所以让我们检查一下我们的模型工作得有多好。我们将只考虑股票有上涨潜力的机会，即目前股票被低估。我提取了Nifty 500指数中所有股票的当前价格，并与我们的预测进行了比较。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mk"><img src="../Images/69624aad2aa9e2c3880f38a784168bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AQVF_XoUJUhyJTas5BzyJA.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">当前股价与预测值的比较。</figcaption></figure><p id="de9a" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">如果我买了所有我的模型显示股价被低估的股票，会发生什么？假设在2021年3月16日，我买入了模型显示买入信号的所有公司的1股股票，然后我在2021年7月19日卖出了同样的股票。我已经把数据填入了Excel表格，你可以从<a class="ae hu" href="https://www.kaggle.com/sawantvishwajeet729/predictions-on-1972021/download" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><figure class="lu lv lw lx fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ml"><img src="../Images/effd882c0e061cf8dfac6c46e865c02c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H0XdS2wGV1mcysAFo2Y9lg.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx translated">购买、销售和利润率</figcaption></figure><p id="0945" class="pw-post-body-paragraph kl km hx kn b ko ll iy kq kr lm jb kt ku lo kw kx ky lq la lb lc ls le lf lg ha bi translated">综上所述，所需资本总额为<strong class="kn hy"> <em class="lh"> 193080.5印度卢比</em> </strong>。我将不得不购买excel文件中显示的212家公司的212股股票。在2021年7月19日，我会以<strong class="kn hy">223937.9印度卢比的价格卖掉它们。 </strong>我早就获得了<strong class="kn hy"> <em class="lh"> 30857.4印度卢比</em> </strong>的利润，几乎是<strong class="kn hy"><em class="lh"/></strong>16%的收益！太棒了，不是吗？</p></div></div>    
</body>
</html>