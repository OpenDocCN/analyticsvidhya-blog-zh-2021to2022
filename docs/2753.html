<html>
<head>
<title>Using Python to extract district-wise COVID data from epid.gov.lk (from multiple PDF files)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python从epid.gov.lk提取分区COVID数据(从多个PDF文件中)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-python-to-extract-district-wise-covid-data-from-epid-gov-lk-from-pdf-files-2c611a1a32fa?source=collection_archive---------19-----------------------#2021-05-15">https://medium.com/analytics-vidhya/using-python-to-extract-district-wise-covid-data-from-epid-gov-lk-from-pdf-files-2c611a1a32fa?source=collection_archive---------19-----------------------#2021-05-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7a3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我获取斯里兰卡新冠肺炎病例的地区级新冠肺炎数据的主要动机，是为了了解新冠肺炎教在这些地区内是如何演变的，并找出数据中的模式，如地区间的流动、国家/宗教节日、政治集会等。但是由于政府在一个单独的PDF文件中发布每天的COVID数据(所有地区),这是python程序聚合这些数据的工作。</p><p id="7aae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">从单个PDF文件中聚合COVID数据的过程可以分为4个独立的任务:在主网站上搜索PDF COVID报告的链接，裁剪出相应的感兴趣的表格，读取感兴趣的表格并聚合数据。</strong></p><h1 id="5bd4" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">在epid.gov.lk中搜索各个PDF文件的下载链接。</h1><p id="3ffd" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">这是最简单的过程之一，感谢像BeautifulSoup这样的python libraires，它允许用户创建简单的html元素查询，列出所有相同类型的元素，并将它们存储在一个列表中。</p><p id="6635" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我们将要下载PDF文件的网站的样子:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kf"><img src="../Images/a2a6c8f5c6294142d8940a24a37c289c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fqtFjNiRc9iSyejwaGxoxg.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">资料来源:epid.gov.lk</figcaption></figure><p id="b7ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上图中可以看出，PDF文件的链接以表格的形式呈现，有英文和僧伽罗文两种版本。</p><p id="9406" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">拥有两种不同语言的PDF文件增加了查找的复杂性，<strong class="ig hi">只有</strong>，英语<strong class="ig hi">版本的文件。然而，幸运的是，有一个简单的区分方法。以下面的两个链接为例:</strong></p><p id="b542" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">web/images/pdf/corona _ virus _ report/sitrep-<strong class="ig hi"><em class="kv">sl-sin</em></strong>-14–05 _ 10 _ 21 . pdf(僧伽罗文版)</p><p id="c07e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">web/images/pdf/corona _ virus _ report/sitrep-<strong class="ig hi"><em class="kv">sl-en</em></strong>-14–05 _ 10 _ 21 . pdf(英文版)</p><p id="0236" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的例子中，你可以看到使用关键字<strong class="ig hi"> sl-en </strong>意味着你可以过滤英文版的PDF文件。</p><p id="4d2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是提取PDF文件链接的代码片段。下面的代码将在图像后解释。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kw"><img src="../Images/f4d923992502ca5a89c56ee863810a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFvbhfq0nIkK6o1RWf5P_A.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段1</figcaption></figure><p id="46f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码的第一步是遍历表中的每一行。第二步是提取表格中的所有超链接，其中包含一个PDF文件。最后一步是提取PDF文件的所有英文版本。</p><h1 id="9d84" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">裁剪出相应的表格。</h1><p id="78e9" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">用于Python的Camelot库是一个很好的工具，可以将PDF文件中的表格提取到一个<strong class="ig hi"> Pandas Dataframe对象中，</strong>这使得表格操作更加容易。为了使这个过程更容易，更不容易出错，我们的python程序从各个表中读取日期，更容易将表裁剪到一个单独的PDF文件中，只包含单个表。</p><p id="6cf4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是我们希望提取的表格:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kx"><img src="../Images/4e934c07f86c999b7596e5e5a54b2e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEK6pZR9C2X_tvsHOizXcw.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">表1 资料来源:epid.gov.lk</figcaption></figure><p id="1f41" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们知道表格边界的像素值，那么就很容易提取这个表格。但是，由于表格在每个PDF文件中的位置可能略有不同，因此通过增加裁剪区域来考虑这些变化也很重要。</p><h2 id="250c" class="ky jd hh bd je kz la lb ji lc ld le jm ip lf lg jq it lh li ju ix lj lk jy ll bi translated">获取要裁剪的像素坐标</h2><p id="47d7" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">可悲的现实是，没有轻松的方法来获得PDF文件的裁剪像素坐标。然而，经过大量研究后，我发现将PDF文件转换成JPEG格式，然后使用光标获取作物坐标更容易。</p><p id="4faa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以获得准确的作物坐标；由于像素值可以是相对的，所以我使用PyPDF2的mediabox函数来获取PDF文件的原始宽度和高度。下图显示了如何做到这一点:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lm"><img src="../Images/323131001450a095ca5e72e96310b058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aPiGV1Ys68uqlLLrBVTQIg.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段2</figcaption></figure><p id="cce1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦获得这些坐标。然后，PDF文件被转换为JPEG图像，并在Ms Paint中打开。然后图像被<strong class="ig hi">调整</strong>到PDF文件的原始<strong class="ig hi">宽度和高度</strong>。然后使用光标获取我想要提取的表格的像素坐标。</p><h2 id="9292" class="ky jd hh bd je kz la lb ji lc ld le jm ip lf lg jq it lh li ju ix lj lk jy ll bi translated">将元数据传输到新的PDF文件中。</h2><p id="0802" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">由于表中没有提供与表相关的日期，因此无法按日期追踪表。然而，幸运的是，PDF文件的创建日期与该表的相关日期一致。但是，当创建PDF文件的新裁剪版本时，元数据不会自动复制。然而，这个过程非常简单，只需要几行代码。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es ln"><img src="../Images/645b50e0c7d1ca199b79457983c6a3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*7zKwH7_Q0yNEY4-zyxDbJQ.png"/></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段3</figcaption></figure><p id="2ae5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下函数显示了如何在python代码中完成裁剪:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lo"><img src="../Images/fde93941f901cf7c0d3226490e8d1df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3hhq6LkFK-cQQNVtx3jqcA.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段4</figcaption></figure><h1 id="44d1" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">从表中读取和操作数据</h1><p id="e655" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">一旦裁剪出感兴趣的表并移植了元数据，从表中读取数据的过程就变得轻而易举了。Camelot库能够将表数据转换为Pandas Dataframe对象，我随后将该对象转换为Python list对象，然后我可以删除与我试图收集的数据不相关的行。从<strong class="ig hi">表1 </strong>可以看到，第一行和最后一行都可以删除。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es lp"><img src="../Images/f20de20e284d5b8e458399ee91696af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*AqTHfV9tIliPXRV5HUNfJQ.png"/></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段5</figcaption></figure><h1 id="c84c" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">汇总特定用户选择的地区的数据。</h1><p id="8b04" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为用户选择的特定地区聚集数据:接受用户输入，并完成区分大小写的字符串查找；根据地区汇总数据。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es lq"><img src="../Images/9ea507f61106c008d17c60b32789b9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*SKH-YcypS5hiherzZIi_iw.png"/></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段6</figcaption></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es lr"><img src="../Images/ccaea5541accb408d51ccb077d63126d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*AR6xD_XmuvNECjYPYyudtg.png"/></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">Python代码片段7</figcaption></figure><h1 id="b563" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结果</h1><p id="81a1" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">下表显示了斯里兰卡三个地区的COVID感染率。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ls"><img src="../Images/324c5da0296dae54faf3e9a0da57516c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ooOhjxtNyCD3BGn7QxEXVQ.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">图表1</figcaption></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lt"><img src="../Images/325717eeef85d34bde5ce6dbb12cf13e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ootVk1-8eelyGgsRmSPdQ.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">图表2</figcaption></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ls"><img src="../Images/d71a19d362f80f78d9b8033546225be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cwqX8qMHV-kIu5BKlGTiFg.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">图表3</figcaption></figure><h1 id="56cf" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="4fa9" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">作为一名对数据科学感兴趣的机器人工程师，但我还没有接受过该领域的正式培训，我对这第一步感到非常自豪，因为所涉及的工作非常复杂。我使用三个独立的Python脚本成功完成了这项任务。我下一步的努力是利用获得的数据进行一些实际的数据分析，并发现一些有趣的相关性。</p></div></div>    
</body>
</html>