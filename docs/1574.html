<html>
<head>
<title>How to connect Snowflake with Airflow on Docker in order to build a data extraction pipeline for free</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Docker上连接雪花和气流，以便免费搭建数据提取管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-connect-snowflake-with-airflow-on-docker-in-order-to-build-a-data-extraction-pipeline-for-e65591f011d6?source=collection_archive---------3-----------------------#2021-03-08">https://medium.com/analytics-vidhya/how-to-connect-snowflake-with-airflow-on-docker-in-order-to-build-a-data-extraction-pipeline-for-e65591f011d6?source=collection_archive---------3-----------------------#2021-03-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie"><p id="54b6" class="if ig hh bd ih ii ij ik il im in io dx translated">从多个足球联赛中提取数据</p></blockquote><figure class="iq ir is it iu iv er es paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="er es ip"><img src="../Images/b57c52a17b8e4783a7e9613d74359a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-58JaVoax4Vh699g1DvG7Q.jpeg"/></div></div></figure><h1 id="aeb3" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">简介</strong></h1><p id="8514" class="pw-post-body-paragraph ka kb hh kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw io ha bi translated">Apache airflow是一个编排工作流和数据处理管道的伟大工具，可以在几个云提供商中使用，如<strong class="kc hi"><em class="kx">【GCP】</em></strong><em class="kx"/><strong class="kc hi"><em class="kx">AWS</em>、</strong>和<strong class="kc hi"> <em class="kx"> Azure </em> </strong>等等，但此时我们将关注如何在Docker上简单快速地部署它。</p><h1 id="27ed" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">我们如何做到这一点？</h1><p id="916e" class="pw-post-body-paragraph ka kb hh kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw io ha bi translated">我尝试按照以下方式处理研究案例:</p><ol class=""><li id="0b89" class="ky kz hh kc b kd la kh lb kl lc kp ld kt le io lf lg lh li bi translated">我们应该获取<a class="ae lj" href="https://airflow.apache.org/docs/apache-airflow/stable/docker-compose.yaml" rel="noopener ugc nofollow" target="_blank"><em class="kx">docker-compose . YAML</em></a>文件。</li><li id="9d86" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">初始化气流环境。</li><li id="3af7" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">流动气流。</li><li id="b5ba" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">安装额外的python依赖项。</li><li id="b29f" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">我们创建一个审判<strong class="kc hi"> <em class="kx">雪花</em> </strong> <em class="kx">账户</em>。</li><li id="b746" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">添加Airflow Web UI中所需的环境变量。</li><li id="a993" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">运行我们的<strong class="kc hi"> <em class="kx"> DAG </em> </strong>。</li><li id="4f4d" class="ky kz hh kc b kd lk kh ll kl lm kp ln kt lo io lf lg lh li bi translated">我们准备在<strong class="kc hi"> <em class="kx">雪花</em> </strong>中查询你喜欢的足球联赛数据。</li></ol><h2 id="1ceb" class="lp jd hh bd je lq lr ls ji lt lu lv jm kl lw lx jq kp ly lz ju kt ma mb jy mc bi translated">我们开始吧！！</h2><p id="3755" class="pw-post-body-paragraph ka kb hh kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw io ha bi translated">第一步是获取<em class="kx"> docker-compose.yaml </em>，为此，我们将在终端上运行以下命令:</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="983b" class="lp jd hh mi b fi mm mn l mo mp"><em class="kx">curl -LfO ‘</em><a class="ae lj" href="https://airflow.apache.org/docs/apache-airflow/2.0.1/docker-compose.yaml'" rel="noopener ugc nofollow" target="_blank"><em class="kx">https://airflow.apache.org/docs/apache-airflow/2.0.1/docker-compose.yaml'</em></a></span></pre><p id="6625" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">如果你想查看包含这个文件的内容你可以去这个<a class="ae lj" href="https://airflow.apache.org/docs/apache-airflow/stable/start/docker.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hi"> <em class="kx">链接</em> </strong> </a>，你必须记住Dag的文件夹包含我们的Python脚本(DAGS) <br/>和packages文件夹包含<strong class="kc hi"><em class="kx">requirements . txt</em></strong>文件与Python的依赖项一起安装，现在我们需要准备我们的环境，为此，你将创建一些文件夹，如:</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="f8e0" class="lp jd hh mi b fi mm mn l mo mp"><em class="kx">mkdir ./dags ./logs ./plugins ./packages<br/>echo -e "AIRFLOW_UID=$(id -u)\nAIRFLOW_GID=0" &gt; .env</em></span></pre><p id="0f84" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">在<strong class="kc hi">所有操作系统</strong>上，您需要运行数据库迁移并创建第一个用户帐户。要做到这一点，运行。</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="3e0a" class="lp jd hh mi b fi mm mn l mo mp"><em class="kx">docker-compose up airflow-init</em></span></pre><p id="fd18" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">运行Airflow之前，您必须编辑<strong class="kc hi"><em class="kx">docker-compose . YAML</em></strong>以创建之前添加的卷:</p><figure class="md me mf mg fd iv er es paragraph-image"><div class="er es mt"><img src="../Images/2c8ad9702f3c55513e807c2f75ea186b.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*n-PGxCOFcjmbbQA7_K9KZQ.png"/></div></figure><p id="9fab" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">现在，您可以启动所有服务:</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="8eb1" class="lp jd hh mi b fi mm mn l mo mp"><em class="kx">docker-compose up</em></span></pre><p id="14b1" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">在新的终端中，您可以看到活动的容器:</p><figure class="md me mf mg fd iv er es paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="er es mu"><img src="../Images/1c4be813c0670528c9b41292cbfc042c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AemqnCWtTFJHe8l3Msoj7g.png"/></div></div></figure><p id="0061" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">我们准备安装Python依赖项，为此，我们需要输入除<strong class="kc hi"> <em class="kx"> Postgres </em> </strong>和<strong class="kc hi"> <em class="kx"> Redis </em> </strong>之外的每个容器，如下所示:</p><pre class="md me mf mg fd mh mi mj mk aw ml bi"><span id="6335" class="lp jd hh mi b fi mm mn l mo mp">docker exec --user="root" -ti <strong class="mi hi">CONTAINER_ID</strong> /bin/bash<br/>cd ./packages/ &amp;&amp; pip install -r requirements.txt</span></pre><figure class="md me mf mg fd iv er es paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="er es mv"><img src="../Images/60d144d8c2434d71c9e883f46103face.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*euTYoIp6qvo3unNzup3x2g.png"/></div></div></figure><p id="2e5a" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">此时，您必须有一个<strong class="kc hi"> <em class="kx">数据仓库、数据库、表</em> </strong>和<strong class="kc hi"> <em class="kx">阶段</em> </strong>处于活动状态的试用雪花帐户，以便与Airflow连接。</p><h2 id="5132" class="lp jd hh bd je lq lr ls ji lt lu lv jm kl lw lx jq kp ly lz ju kt ma mb jy mc bi translated">访问web界面</h2><p id="9605" class="pw-post-body-paragraph ka kb hh kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw io ha bi translated">一旦集群启动，您就可以登录到web界面并尝试运行一些任务。</p><p id="2cf7" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">web服务器位于:<code class="du mw mx my mi b"><strong class="kc hi">http://localhost:8080</strong></code>。默认账户有登录名<code class="du mw mx my mi b">airflow</code>和密码<code class="du mw mx my mi b">airflow</code></p><p id="5738" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">在运行我们的DAG之前，我们必须在Airflow Web UI中添加所需的环境变量</p><figure class="md me mf mg fd iv er es paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="er es mz"><img src="../Images/e684b6fcd45798f086667b3972821ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noQnaGX1-zwXHT3g67UmtA.png"/></div></div></figure><h2 id="a297" class="lp jd hh bd je lq lr ls ji lt lu lv jm kl lw lx jq kp ly lz ju kt ma mb jy mc bi translated">让我们开始吧！！</h2><figure class="md me mf mg fd iv er es paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="er es na"><img src="../Images/aaf518781e35b759fd4096a7bc212b7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eFJvNB1itKN2OmhYQXR0_A.png"/></div></div></figure><h2 id="7b54" class="lp jd hh bd je lq lr ls ji lt lu lv jm kl lw lx jq kp ly lz ju kt ma mb jy mc bi translated">2020–2021赛季哪些球队积分最多？</h2><figure class="md me mf mg fd iv er es paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="er es nb"><img src="../Images/455322a61703a48f2312c45166ff7234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UM62XL53z_Gl4AQIosYmUA.png"/></div></div></figure><h1 id="e284" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">摘要</h1><p id="18fc" class="pw-post-body-paragraph ka kb hh kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw io ha bi translated">Docker上的气流是一种免费的自动化过程的简单方法，但我们需要记住，我们必须有8GB或更多的内存。</p><p id="408a" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">另一方面，您可以随意查看用于本示例的代码，并且您可以<a class="ae lj" href="https://github.com/alexbonella/AIRFLOW_DOCKER_SNOWFLAKE/blob/master/dags/leagues.py" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hi">转到代码Github </strong> </a>。</p></div><div class="ab cl nc nd go ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ha hb hc hd he"><p id="db8b" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">谢谢你读到这里。如果你觉得这篇文章有用，喜欢并分享这篇文章。有人也会觉得它很有用，为什么不邀请我喝杯咖啡呢？</p><figure class="md me mf mg fd iv er es paragraph-image"><a href="https://www.paypal.com/donate/?hosted_button_id=GBVXVLXMETRHE"><div class="er es nj"><img src="../Images/7b4a8b0ba9a8213d41096ed8ed319752.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*Bgbvd0vgdvwObB736NF8eg.png"/></div></a><figcaption class="nk nl et er es nm nn bd b be z dx translated"><strong class="bd je">用PayPal捐款</strong>👆</figcaption></figure><p id="0a48" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">跟我来👉<a class="ae lj" href="https://www.linkedin.com/in/alexanderbolano/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hi"> LinkedIn </strong> </a></p><p id="0435" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">跟我来👉<a class="ae lj" href="https://twitter.com/Alex_bonella" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hi">推特</strong> </a></p><p id="f3e9" class="pw-post-body-paragraph ka kb hh kc b kd la kf kg kh lb kj kk kl mq kn ko kp mr kr ks kt ms kv kw io ha bi translated">联系人:alexbonella2806@gmail.com</p></div></div>    
</body>
</html>