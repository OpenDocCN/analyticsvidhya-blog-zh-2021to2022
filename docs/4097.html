<html>
<head>
<title>SQLAlchemy: merging two of the greatest tools for data science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQLAlchemy:融合数据科学的两大工具</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sqlalchemy-merging-two-of-the-greatest-tools-for-data-science-bd75137a3bf9?source=collection_archive---------7-----------------------#2021-08-26">https://medium.com/analytics-vidhya/sqlalchemy-merging-two-of-the-greatest-tools-for-data-science-bd75137a3bf9?source=collection_archive---------7-----------------------#2021-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="71c4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何正确使用SQL和Python！</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/f1b4dd162f3ab34ba242bfdaf1c5e5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*LSSVBCCgxlhQ81F19IQesA.png"/></div></figure><p id="517c" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">到目前为止，我越来越多地研究如何使用一些工具来获得数据科学入门工作，我发现，将大量技术堆积到课程中最重要的事情是学习如何协同使用它们。换句话说，如果你知道很多Python和很多SQL，你如何一起使用这两种技术来使你的想法更好地流动。</p><p id="fa39" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">考虑到这一点，我开始学习更多关于SQL的知识，并最终得到了一个非常重要和有用的工具包，将简历上的这两个必备工具结合起来，SQLAlchemy。在这篇文章中，您将学习如何设置运行它的环境，它是如何工作的，以及为什么这是最佳选择。</p><h1 id="78a3" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">对象关系映射</h1><p id="e5d1" class="pw-post-body-paragraph jf jg hi jh b ji kt ij jk jl ku im jn jo kv jq jr js kw ju jv jw kx jy jz ka hb bi translated">首先，我们需要更多地了解SQLAlchemy的本质，对象关系映射(ORM)是一种基于面向对象编程的技术，可以在两个系统之间转换数据。这对于数据科学来说很有趣，因为您必须在不基于您想要进行处理的语言的地方挑选一些数据，就像在本例中，从基于SQL的数据库到Python处理。</p><p id="0e98" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个目标是通过使用对象来实现的，对象可以是变量、函数，或者在这个例子中是数据结构，因为，我希望你已经猜到了，这就是你在SQL数据库中的内容。通过这种方式，SQLAlchemy可以在Python环境中进行翻译并使其可用。</p><h1 id="c450" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">很好，那我该怎么开始？</h1><p id="f241" class="pw-post-body-paragraph jf jg hi jh b ji kt ij jk jl ku im jn jo kv jq jr js kw ju jv jw kx jy jz ka hb bi translated">因此，我将基于PostgreSQL服务器制作本教程，但它也可用于其他SQL程序，如MySQL、Microsoft SQL Server以及任何基于SQL构建的存储数据的程序。</p><p id="cdb4" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这是可能的，因为SQLAlchemy是一个后端不可知的系统，这意味着它不依赖于单个系统工作，只要您正确设置系统并知道如何访问它。这肯定是真的，因为当您开始使用SQL处理特定的数据库时，您需要知道如何访问它。</p><h1 id="f5cc" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">右脚并线</h1><p id="0d84" class="pw-post-body-paragraph jf jg hi jh b ji kt ij jk jl ku im jn jo kv jq jr js kw ju jv jw kx jy jz ka hb bi translated">首先，你需要创建一个对象来设置服务器的路径，这个对象就是你要进行操作的对象，因为它是一个路径，所以你必须能够在服务器中找到你所有的数据结构，就像这样:</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="ddc7" class="ld kc hi kz b fi le lf l lg lh">from sqlalchemy import create_engine</span><span id="2fa9" class="ld kc hi kz b fi li lf l lg lh">engine = create_engine('dialect+driver://username:password@host:port/database')</span></pre><p id="5434" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">好吧，这不是你现在脑子里想的信息，对吧？你能在哪里找到它？在Postgres中，只需在pgAdmin软件中右键单击服务器，进入属性，您必须在“连接”选项卡下立即找到这些信息。</p><h1 id="c578" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">现在，让我们运行一些操作</h1><p id="31c6" class="pw-post-body-paragraph jf jg hi jh b ji kt ij jk jl ku im jn jo kv jq jr js kw ju jv jw kx jy jz ka hb bi translated">所以现在您可能渴望通过您的代码在SQL server上运行一些查询，对吗？所以让我们再多了解一点关于方法<code class="du lj lk ll kz b">execute()</code>的知识。</p><p id="74a8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">因此，在开始一个新表之前(或者如果您第一次搞砸了)，您可能希望在这里和那里删除一个表，因此您可能会请求:</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="b265" class="ld kc hi kz b fi le lf l lg lh">engine.execute('DROP TABLE IF EXISTS public.teachers_add')</span></pre><p id="10e5" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这里重要的一点是，你必须参考你的模式，否则引擎将无法正常工作。这类工作值得注意的是，你的主要对象是一条<em class="lm">路径</em>，所以你从事的任何操作都必须有一条思维路径。</p><p id="a4a6" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">但是，那不是你唯一想做的事，对吗？您希望由经过仔细考虑的请求组成的表成为Python代码的工作结构。因此，事情真正成为一体的部分来了，与熊猫一起工作，产生可行的变量，它可以像这样简单:</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="0668" class="ld kc hi kz b fi le lf l lg lh">import pandas as pd</span><span id="e69b" class="ld kc hi kz b fi li lf l lg lh">sql = 'SELECT * FROM public.subjects_add'<br/>data_db1 = pd.read_sql_query((sql), engine)<br/>data_db1</span></pre><p id="3288" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">瞧！现在你在数据库中请求的是一个漂亮的熊猫数据框，你可以像这样使用它。使用SQLAlchemy中的请求的另一种方法是将其放在NumPy数组中，但是如果您马上需要它，一种快速解决方法是将其转换为DataFrame，然后转换为NumPy数组，这种快速解决方法是一种两步解决方案，无论如何您最终都会这样做，另一种方法是使用list comprehension创建一个列表，然后将其转换为NumPy数组，如您所愿。</p><p id="720b" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">所以你在你的分析上努力工作，并且在一天结束的时候你想在服务器上发布你的结果或修改，但是它是你代码中的一个数据帧，你也可以通过Python把它上传到服务器上！片段是这样的:</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="e7b1" class="ld kc hi kz b fi le lf l lg lh">data_db1.to_sql('subjects_add', engine)</span></pre><p id="e3f2" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这个方法有一个非常有用的参数，如果您已经有一个名为“subjects_add”的表，那么您可以选择如何处理“if_exists”参数，它接受值['fail '，' replace '，' append']，后两个是不言自明的，但是如果服务器上已经有一个相等的表，第一个将会引发一个错误，并且如果您忘记了这个值，默认为' fail '，所以它将引发一个值错误。</p><p id="1db1" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">虽然这很容易使用，但这里还有最后一个危险信号要处理，而且可能会很麻烦，比如说你想把它追加到一个现有的表中，很好，你打算怎么追加呢？你不想在你公司的桌子上结束一个弗兰肯斯坦的怪物，它可以与数据工程师的人变得真实。因此，您可能希望使用“method”参数，如果您不传递任何值，它将使用公共的insert子句逐行写入，它接受值“multi”，每次将多个条目插入到一个INSERT子句中。但是，你的条目是棘手的，当然，因为你生活在现实世界中，所以你可以调用一个签名方法，一个根据你自己的条件附加的函数。</p><h1 id="aa43" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">psycopg2呢？</h1><p id="33ea" class="pw-post-body-paragraph jf jg hi jh b ji kt ij jk jl ku im jn jo kv jq jr js kw ju jv jw kx jy jz ka hb bi translated">这是一个很好的问题，实际上SQLAlchemy通过psycop 2与PostgreSQL接口，如果您要做一个自定义方法来在数据库内的表上追加信息，您将需要psycop 2方面的知识。</p><p id="1c2f" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">但是我可以做一个关于如何使用psycopg2的完整教程，对吗？是的，这就是想法，为一个教程做两个工具，因为它们是互补的，但是，我一直在阅读，有时psycopg2在某些环境中行为不端，你需要对工具有深入的理解来解决其中的一些问题，即使据我所知有些没有任何解决方案。</p><h1 id="bb29" class="kb kc hi bd kd ke kf kg kh ki kj kk kl io km ip kn ir ko is kp iu kq iv kr ks bi translated">就是这样，男孩女孩们</h1><p id="29b7" class="pw-post-body-paragraph jf jg hi jh b ji kt ij jk jl ku im jn jo kv jq jr js kw ju jv jw kx jy jz ka hb bi translated">我发现这些信息真的很有用，而且在互联网上不是很容易获得，这就是为什么我决定做这个小教程来帮助你，所以如果你想留下评论，你觉得哪个SQLAlchemy或psycopg2更好，或者如果你觉得这个教程有用，我会很感激。</p><p id="3421" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">当然，这只是为了确保您将从正确的方面开始，如果您需要关于该工具的更深入的信息，请查看<a class="ae ln" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank">文档</a>以了解更多信息。</p><p id="3aa8" class="pw-post-body-paragraph jf jg hi jh b ji jj ij jk jl jm im jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">谢谢，保重！</p></div></div>    
</body>
</html>