<html>
<head>
<title>Implementing Social Login in Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Django实现社交登录</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/implementing-social-login-in-django-3ba8f59ec6f2?source=collection_archive---------0-----------------------#2021-11-13">https://medium.com/analytics-vidhya/implementing-social-login-in-django-3ba8f59ec6f2?source=collection_archive---------0-----------------------#2021-11-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f5a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用social-auth-app-django库</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/1d93ba196997b96716fa81715de37d1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3txd6gta_0uWxgBb"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">诺德伍德主题公司在<a class="ae ka" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="437a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我将指导你如何在Django中实现社交登录。基本上，我将涵盖谷歌和Github认证，你可以用同样的方式做Twitter和脸书认证。</p><p id="bdca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保您已经创建了Django项目。下一步是你需要安装<a class="ae ka" href="https://python-social-auth.readthedocs.io/en/latest/configuration/django.html" rel="noopener ugc nofollow" target="_blank"><em class="kb">social-auth-app-django</em></a>包。</p><h1 id="787a" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">装置</h1><p id="c9fc" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">我们将通过pip安装它。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="64d5" class="lk kd hi lg b fi ll lm l ln lo">pip install social-auth-app-django</span></pre><h1 id="fea4" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">配置</h1><p id="86f9" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">将<em class="kb"> social_django </em>添加到settings.py中的<strong class="ih hj"> INSTALLED_APPS </strong>中，然后迁移数据库。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="60ad" class="lk kd hi lg b fi ll lm l ln lo">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'polls',<br/>    'social_django',<br/> <br/>]</span><span id="3e69" class="lk kd hi lg b fi lp lm l ln lo">python manage.py migrate  <br/>Operations to perform:   <br/>Apply all migrations: admin, auth, contenttypes, sessions, social_django Running migrations:   Applying social_django.0001_initial... OK   Applying social_django.0002_add_related_name... OK   Applying social_django.0003_alter_email_max_length... OK   Applying social_django.0004_auto_20160423_0400... OK   Applying social_django.0005_auto_20160727_2333... OK   Applying social_django.0006_partial... OK</span></pre><p id="e406" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要更新中间件，在最后添加SocialAuthExceptionMiddleware。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="fd05" class="lk kd hi lg b fi ll lm l ln lo">MIDDLEWARE = [<br/>    'django.middleware.security.SecurityMiddleware',<br/>    'django.contrib.sessions.middleware.SessionMiddleware',<br/>    'django.middleware.common.CommonMiddleware',<br/>    'django.middleware.csrf.CsrfViewMiddleware',<br/>    'django.contrib.auth.middleware.AuthenticationMiddleware',<br/>    'django.contrib.messages.middleware.MessageMiddleware',<br/>    'django.middleware.clickjacking.XFrameOptionsMiddleware',<br/>    'social_django.middleware.SocialAuthExceptionMiddleware',  # &lt;--<br/>]</span></pre><p id="a1e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是更新<strong class="ih hj">上下文处理器</strong>的时候了</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="9ce8" class="lk kd hi lg b fi ll lm l ln lo">TEMPLATES = [<br/>    {<br/>        'BACKEND': 'django.template.backends.django.DjangoTemplates',<br/>        'DIRS': [os.path.join(BASE_DIR, 'templates')],<br/>        'APP_DIRS': True,<br/>        'OPTIONS': {<br/>            'context_processors': [<br/>                'django.template.context_processors.debug',<br/>                'django.template.context_processors.request',<br/>                'django.contrib.auth.context_processors.auth',<br/>                'django.contrib.messages.context_processors.messages',<br/>                'social_django.context_processors.backends',  # &lt;--<br/>                'social_django.context_processors.login_redirect', # &lt;--<br/>            ],<br/>        },<br/>    },<br/>]</span></pre><p id="be09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是添加社会认证后端。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="34fe" class="lk kd hi lg b fi ll lm l ln lo">AUTHENTICATION_BACKENDS = (<br/>    'social_core.backends.github.GithubOAuth2', # github &lt;----<br/>    'social_core.backends.twitter.TwitterOAuth', # twitter &lt;----<br/>    'social_core.backends.facebook.FacebookOAuth2', # facebook &lt;----<br/>    'social_core.backends.google.GoogleOAuth2',  # google &lt;----<br/>    'django.contrib.auth.backends.ModelBackend',<br/>)</span></pre><p id="3b5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我为GitHub，Twitter，脸书，谷歌添加了后端，但正如我所说，我将向你展示Github和谷歌认证。现在在你的urls.py中添加<strong class="ih hj">social-auth-app-django</strong>URL。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="4d4b" class="lk kd hi lg b fi ll lm l ln lo">from django.contrib import admin<br/>from django.urls import path,include<br/>from django.conf import settings<br/>from django.conf.urls.static import static<br/><br/>urlpatterns = [<br/>    path('admin/', admin.site.urls),<br/>    path('',include('polls.urls')),<br/>    <strong class="lg hj">path('oauth/', include('social_django.urls'namespace='social'))</strong> <br/>] + static(settings.STATIC_URL, document_root=settings.STATIC_ROOT) + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</span></pre><p id="55be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加您的视图和模板来处理登录。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="d17a" class="lk kd hi lg b fi ll lm l ln lo"># In views.py</span><span id="311f" class="lk kd hi lg b fi lp lm l ln lo">def social_login(request):<br/>    <br/>    return render(request,'social_login.html')</span><span id="070f" class="lk kd hi lg b fi lp lm l ln lo"># Inside template </span><span id="ceba" class="lk kd hi lg b fi lp lm l ln lo">{%extends 'base.html'%}<br/>{%load static%}<br/>{% load crispy_forms_tags %}<br/>{%block home%}<br/>&lt;div class="container mt-4 bg-white p-3"&gt;<br/>   &lt;a class="btn btn-primary" href="{% url 'social:begin' 'github' %}"&gt;&lt;i class="fab fa-github"&gt;&lt;/i&gt;&amp;nbsp;Login&lt;/a&gt;<br/>      &lt;a class="btn btn-primary" href="{% url 'social:begin' 'google-oauth2' %}"&gt; &lt;i class="fab fa-google"&gt;&lt;/i&gt;&amp;nbsp;Login&lt;/a&gt;<br/>&lt;/div&gt;<br/>{%endblock%}</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lq"><img src="../Images/b7fe59a937c0b44bd621603a5a268026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZygDHytV6RMMwKdURLNxGQ.png"/></div></div></figure><p id="9188" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我将从GitHub认证开始。</p><h1 id="3825" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">GitHub认证</h1><p id="3fb5" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">登录你的<strong class="ih hj"> GitHub </strong>账号，进入<strong class="ih hj">设置</strong>。在左侧栏中，有<strong class="ih hj">开发者设置</strong>选项。点击<strong class="ih hj"> OAuth应用</strong>并点击新建OAuth应用。将出现一个表格，填写相关信息并提交。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lr"><img src="../Images/b89e76bd1f141bb31457a06aed123c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17Q-i59kJozgO-gyBVcKeA.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">GitHub OAuth表单</figcaption></figure><p id="f197" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面截图中的信息只是用于测试目的，它将在本地服务器上工作。提交表格后，您将获得客户ID和客户密码。您需要复制这两个键，并将其粘贴到setting.py文件中。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="0af3" class="lk kd hi lg b fi ll lm l ln lo">SOCIAL_AUTH_GITHUB_KEY = '072fdd566d6e054wfe346f'<br/>SOCIAL_AUTH_GITHUB_SECRET = 'e89072f86d42f3f44b4d9d67997b326bc0'</span></pre><p id="0733" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们登录GitHub所需的全部内容。现在尝试用GitHub登录。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ls"><img src="../Images/1258b1e31467b8fe71f0bf03d4e23845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nR_CbLR-A6riS9MHABWwyQ.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">GitHub登录成功</figcaption></figure><h1 id="43f9" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">谷歌认证</h1><p id="a107" class="pw-post-body-paragraph if ig hi ih b ii la ik il im lb io ip iq lc is it iu ld iw ix iy le ja jb jc hb bi translated">对于谷歌认证，我们再次需要谷歌客户端ID和客户端机密。进入<a class="ae ka" href="https://console.cloud.google.com/apis/dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="kb">谷歌开发者控制台</em> </strong> </a> <strong class="ih hj"> <em class="kb">和</em> </strong>点击<strong class="ih hj">新建项目，</strong>我已经创建了一个名为Social Auth的项目。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lt"><img src="../Images/c09d3bce74097598ce65632fe18a16b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z5CKdInkj_a73yTsS-ENkQ.png"/></div></div></figure><p id="c9c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在点击<strong class="ih hj">+创建凭证</strong>并选择<strong class="ih hj"> OAuth客户端ID </strong>一个表单将打开，填写相关信息。在此之前，您需要配置同意屏幕。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lu"><img src="../Images/95d71f374c6522d5838a6dc43972b0ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVZrIdZNhxWzhcMeY1V_5A.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">OAuth客户端ID</figcaption></figure><p id="d15c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">配置同意屏幕</strong>按钮，配置完成后，点击下面的创建凭证，选择web应用程序作为选项，表单将打开。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lv"><img src="../Images/9869f8c63fdd24b6ad1d6536a34bd0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lz4wmYT4TUT72vA3VhszoA.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">OAuth客户端ID</figcaption></figure><p id="73fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击创建按钮，您将获得您的客户ID和客户机密。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lw"><img src="../Images/42e4cff7e65b57d208c2b038303320b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*GAaIvawR5ywJyDaR0FY2CQ.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">客户端ID</figcaption></figure><p id="e795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们想要的。现在复制客户端ID和客户端密码，并将它们粘贴到settings.py文件中。</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="5e77" class="lk kd hi lg b fi ll lm l ln lo">SOCIAL_AUTH_GITHUB_KEY = '072fdd56598626f'<br/>SOCIAL_AUTH_GITHUB_SECRET = 'e89072f86d42f3f4997b326bc0'<br/>SOCIAL_AUTH_GOOGLE_OAUTH2_KEY = '6390808614-qjduvv0eu1ehdf6pr1aqesc.apps.googleusercontent.com'<br/>SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET = 'zY5rWkqetCWnnQ'</span></pre><p id="dd5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在试着用谷歌登录。选择你的谷歌帐户，你想验证这就是全部。恭喜你！！</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lx"><img src="../Images/01a2be15b3f95bc7cae6e55015560d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*_U5kkIIRChH5LbcygrRd-g.png"/></div></figure><blockquote class="ly lz ma"><p id="88a1" class="if ig kb ih b ii ij ik il im in io ip mb ir is it mc iv iw ix md iz ja jb jc hb bi translated">现在的情况是，我想只允许某些谷歌电子邮件认证。假设在一个组织中，所有员工都有基于组织的google帐户域，我们希望通过基于组织的帐户授权，而不是个人帐户，为此我们可以做一些调整。</p></blockquote><p id="95a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设该组织的名称是XYZ，员工的电子邮件以@xyz.com结尾。在您的<strong class="ih hj">设置中</strong></p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="d34a" class="lk kd hi lg b fi ll lm l ln lo"># domain white list<br/>SOCIAL_AUTH_GOOGLE_OAUTH2_WHITELISTED_DOMAINS = ['xyz.com']</span></pre><p id="7e1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这些吗？上面这段代码可以正常工作，但是用户将无法知道为什么个人Gmail帐户的身份验证被拒绝。为了传达一些信息，我们可以添加管道。创建一个文件<strong class="ih hj"> <em class="kb"> piplines.py </em> </strong></p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="b522" class="lk kd hi lg b fi ll lm l ln lo">from django.shortcuts import redirect<br/>from django.contrib import messages<br/>from django.contrib.auth.models import User<br/><br/><br/>def auth_allowed(backend, details, response,request, *args, **kwargs):<br/>    if not backend.auth_allowed(response, details):<br/>        messages.error(request, 'Please Login with the Organization Account')<br/>        return redirect('login')<br/>    </span></pre><p id="61b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将此管道添加到settings.py文件中</p><pre class="jl jm jn jo fd lf lg lh li aw lj bi"><span id="e180" class="lk kd hi lg b fi ll lm l ln lo"># Social Auth pipeline<br/>SOCIAL_AUTH_PIPELINE = (<br/>    'social_core.pipeline.social_auth.social_details',<br/>    'social_core.pipeline.social_auth.social_uid',<br/>    'social_core.pipeline.social_auth.social_user',<br/>    <strong class="lg hj">'webapp.pipeline.auth_allowed',    # &lt;------</strong><br/>    'social_core.pipeline.user.get_username',<br/>    'social_core.pipeline.social_auth.associate_by_email',<br/>    'social_core.pipeline.user.create_user',<br/>    'social_core.pipeline.social_auth.associate_user',<br/>    'social_core.pipeline.social_auth.load_extra_data',<br/>    'social_core.pipeline.user.user_details',<br/><br/>)</span></pre><p id="2b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以只认证有限的基于域的Gmail帐户。</p><p id="f07c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">祝贺你！</strong>您已经在Django成功完成Google和GitHub认证。</p><p id="f015" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更多详情可以访问<a class="ae ka" href="https://python-social-auth.readthedocs.io/en/latest/configuration/django.html" rel="noopener ugc nofollow" target="_blank"> Django Social Auth Doc </a>。</p><p id="a601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关注我更多即将发布的帖子，如果我的帖子对你有帮助，谢谢！！</p></div></div>    
</body>
</html>