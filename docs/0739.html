<html>
<head>
<title>Manage your machine learning life cycle with MLflow in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的MLflow管理您的机器学习生命周期</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/manage-your-machine-learning-lifecycle-with-mlflow-in-python-d678d5f3c682?source=collection_archive---------2-----------------------#2021-01-29">https://medium.com/analytics-vidhya/manage-your-machine-learning-lifecycle-with-mlflow-in-python-d678d5f3c682?source=collection_archive---------2-----------------------#2021-01-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/364033f0c6eab80669273214b7d45cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhKrMpcUPeZxNsZpKNv4BA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">MLflow主要组件。图片由Databricks提供。</figcaption></figure><p id="0b52" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，我们将介绍MLflow的核心内容，这是一个管理机器学习模型生命周期的开源平台。</p><p id="2b1d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将涵盖:</p><ul class=""><li id="160e" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">mlflow的基本设置</li><li id="c4b0" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">实验</li><li id="e758" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">记录度量和参数</li><li id="6e17" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">定制工件</li><li id="ba2c" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">模型注册表</li><li id="c5c9" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">模型预测</li></ul></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="af92" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">MLOps是一种支持数据科学家之间协作的方法；它有助于获得对不同模型版本、同一问题中的多个实验以及模型管理和部署的控制。有几种开源和商业解决方案可以解决这个问题；我们将看看MLflow。</p><p id="c006" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">根据MLflow的网站:</p><blockquote class="kn ko kp"><p id="54dd" class="iu iv kq iw b ix iy iz ja jb jc jd je kr jg jh ji ks jk jl jm kt jo jp jq jr hb bi translated">MLflow是一个简化机器学习开发的平台，包括跟踪实验，将代码打包成可重复运行的代码，以及共享和部署模型。MLflow提供了一组轻量级API，可用于任何现有的机器学习应用程序或库(TensorFlow、PyTorch、XGBoost等)，无论您当前在哪里运行ML代码(例如，在笔记本、独立应用程序或云中)。</p></blockquote><h1 id="4276" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">设置:</strong></h1><p id="a8e3" class="pw-post-body-paragraph iu iv hi iw b ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">首先，我们从安装mlflow开始；建议使用虚拟环境。</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="44e1" class="mg kv hi mc b fi mh mi l mj mk">pip install mlflow</span></pre><p id="10bd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要运行MLflow，您需要:</p><ul class=""><li id="e727" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">跟踪服务器将允许我们看到模型生命周期的用户界面。</li><li id="719c" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">后端存储，我们将在这里记录我们的指标、参数和其他元数据。</li><li id="e8eb" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">一个工件根来存储我们选择的模型和定制对象。</li></ul><p id="a59a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">出于演示目的，我们将使用本地存储和一台个人计算机作为跟踪服务器。</p><p id="1896" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">警告:</strong>在生产环境中，你应该使用后端存储，比如Postgres或者MySQL数据库。</p><p id="7776" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以使用像亚马逊S3、Azure Blob Storage或GCP云存储这样的桶式系统来存储工件。</p><p id="45f5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于跟踪服务器，您可以使用Kubernetes、VM或任何您可以公开的计算引擎系统。</p><p id="bb38" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要在本地启动服务器，请运行:</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="14b3" class="mg kv hi mc b fi mh mi l mj mk">mlflow server --backend-store-uri mlflow_db \<br/>              --default-artifact-root ./mlflowruns \<br/>              --host 0.0.0.0 \<br/>              --port 5000</span></pre><p id="7262" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您应该看到创建了一个名为mlflow_db的文件夹，并在控制台中显示一条类似这样的消息。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/828cf75dafba71a4125a6c95dd1c35c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*jdFxcyzbQCi7zQiBrNGCEQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">跟踪服务器日志。图片由作者提供。</figcaption></figure><p id="df8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，转到<a class="ae mm" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>，您应该会看到mlflow的UI。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/711ce6bd1f02f09cf2bbff51ef9eae05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yOjXK9T2D7YMmGC9g89kig.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">MLflow UI。图片由作者提供。</figcaption></figure><p id="add2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们有几个选项要考虑:</p><p id="04dd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在左边的面板，我们将看到我们的实验，这将帮助我们对相同问题的运行进行分组；有一个实验叫做“默认”，让我们编辑一下，把它重命名为“葡萄酒回归”，我们可以创建另一个实验，叫做Iris。</p><h1 id="4ec1" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">培训和记录:</strong></h1><p id="4a92" class="pw-post-body-paragraph iu iv hi iw b ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">现在，创建一个名为train.py的文件，并放入以下代码，这是mlflow教程的修改版本:</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="7e14" class="mg kv hi mc b fi mh mi l mj mk">import warnings<br/>import sys<br/>import pandas as pd<br/>import numpy as np<br/>from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.linear_model import ElasticNet<br/>import mlflow.sklearn<br/><br/>import logging<br/><br/>logging.basicConfig(level=logging.WARN)<br/>logger = logging.getLogger(__name__)<br/><br/>mlflow.set_tracking_uri('http://localhost:5000')<br/>mlflow.set_experiment(experiment_name='Wine Regression')<br/><br/>tags = {"team": "Analytics Principal",<br/>        "dataset": "Wine",<br/>        "release.version": "2.2.2"}<br/><br/><br/>def eval_metrics(actual, pred):<br/>    rmse = np.sqrt(mean_squared_error(actual, pred))<br/>    mae = mean_absolute_error(actual, pred)<br/>    r2 = r2_score(actual, pred)<br/>    return rmse, mae, r2<br/><br/><br/>if __name__ == "__main__":<br/>    warnings.filterwarnings("ignore")<br/><br/>    # Read the wine-quality csv file from the URL<br/>    csv_url = (<br/>        "http://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv"<br/>    )<br/>    try:<br/>        data = pd.read_csv(csv_url, sep=";")<br/>    except Exception as e:<br/>        logger.exception(<br/>            "Unable to download training &amp; test CSV, check your internet connection. Error: %s", e<br/>        )<br/><br/>    # Split the data into training and test sets. (0.75, 0.25) split.<br/>    train, test = train_test_split(data)<br/><br/>    # The predicted column is "quality" which is a scalar from [3, 9]<br/>    train_x = train.drop(["quality"], axis=1)<br/>    test_x = test.drop(["quality"], axis=1)<br/>    train_y = train[["quality"]]<br/>    test_y = test[["quality"]]<br/><br/>    alpha = float(sys.argv[1]) if len(sys.argv) &gt; 1 else 0.5<br/>    l1_ratio = float(sys.argv[2]) if len(sys.argv) &gt; 2 else 0.5<br/><br/>    with mlflow.start_run(run_name='Sk_Elasticnet'):<br/><br/>        mlflow.set_tags(tags)<br/><br/>        lr = ElasticNet(alpha=alpha, l1_ratio=l1_ratio, random_state=42)<br/>        lr.fit(train_x, train_y)<br/><br/>        predicted_qualities = lr.predict(test_x)<br/><br/>        (rmse, mae, r2) = eval_metrics(test_y, predicted_qualities)<br/><br/>        print("Elasticnet model (alpha=%f, l1_ratio=%f):" % (alpha, l1_ratio))<br/>        print("  RMSE: %s" % rmse)<br/>        print("  MAE: %s" % mae)<br/>        print("  R2: %s" % r2)<br/><br/>        mlflow.log_param("alpha", alpha)<br/>        mlflow.log_param("l1_ratio", l1_ratio)<br/>        mlflow.log_metric("rmse", rmse)<br/>        mlflow.log_metric("r2", r2)<br/>        mlflow.log_metric("mae", mae)<br/><br/>        mlflow.sklearn.log_model(lr, "model")<br/>        mlflow.log_artifact(local_path='./train.py', artifact_path='code')</span></pre><p id="0202" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我会假设你已经熟悉机器学习和sklearn，所以我只解释MLflow相关代码；首先，您会看到这几行代码:</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="2c1b" class="mg kv hi mc b fi mh mi l mj mk">mlflow.set_tracking_uri('http://localhost:5000')<br/>mlflow.set_experiment(experiment_name='Wine Regression')<br/>tags = {"team": "Analytics Principal",<br/>        "dataset": "Wine",<br/>        "release.version": "2.2.2"}</span></pre><p id="013d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们告诉mlflow，启动并运行的服务器位于我们的本地主机和端口5000上，我们希望使用一个名为Wine Regression的实验空间。我们还有一个tags dict，它将作为额外的元数据，我们希望与实验运行相关联。</p><p id="a79e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，我们作为一个上下文管理器开始运行，这样当运行处于活动状态时，我们可以在内部使用几个方法；我们将把它命名为Sk_Elasticnet，这样我们就可以记住我们在运行什么:</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="29b8" class="mg kv hi mc b fi mh mi l mj mk">with mlflow.start_run(run_name='Sk_Elasticnet'):<br/><br/>        mlflow.set_tags(tags)<br/>        #.....</span><span id="c5dc" class="mg kv hi mc b fi mo mi l mj mk">        mlflow.log_param("alpha", alpha)<br/>        mlflow.log_param("l1_ratio", l1_ratio)<br/>        mlflow.log_metric("rmse", rmse)<br/>        mlflow.log_metric("r2", r2)<br/>        mlflow.log_metric("mae", mae)<br/><br/>        mlflow.sklearn.log_model(lr, "model")<br/>        mlflow.log_artifact(local_path='./train.py',    <br/>                            artifact_path='code')</span></pre><p id="f5dc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">与。set_tags方法，我们将当前运行链接到我们定义的标签；使用。log_params，我们可以传递当前参数元组(名称，值)，类似于。模型度量结果的log_metric。</p><p id="084b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们还想保存训练好的模型，以便以后使用；为此，我们使用。log_model，mlflow会围绕它创建一些元数据，导出为cloudpickle文件(或者只是。泡菜)。</p><p id="ed84" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我最喜欢mlflow的一点是，我们可以使用。log _ artifact我们可以使用它来存储与训练阶段相关的图像、外部资源、数据集，甚至是用于生成这次运行的代码副本。我们将在最后一个用例中使用它。</p><p id="7068" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当我们运行代码并刷新mlflow UI时，您应该会看到类似这样的内容。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/89cbcd4f9f3eb8a961ec81348f724130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AloO7FWmnIr7agsWK4XxEQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Elasticnet运行日志。图片由作者提供。</figcaption></figure><p id="3091" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">UI让我们看到我们设置的指标、参数和标签，它还自动包括其他特性，例如运行代码的用户、当地时间的开始时间、使用的模型类型以及代码下的git提交(如果您有git repo设置)。</p><p id="7177" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我们点击模型，我们可以看到额外的信息，比如保存的模型和我们的定制工件，在我们的例子中，是我们使用的代码。它也有这些对象的预览，你可以在本地下载它们。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/177ee171b62883bdeb08b1920a89639c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqMG-MB0YyKOexI_yN7f6Q.png"/></div></div></figure><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/53678cd6136a0579643db2b4be81a4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdrwl2DBrs-65KrGdRFPvA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">MLflow伪影。图片由作者提供。</figcaption></figure><h1 id="7cc6" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">车型注册:</strong></h1><p id="0869" class="pw-post-body-paragraph iu iv hi iw b ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">正如您所看到的，有一个按钮，我们可以在这里注册模型，这样我们就可以将它作为一个API如果您尝试这样做，您可以为您的模型创建一个名称，但您可能会看到一个错误，说明不支持模型注册表数据存储的URI，这是因为您必须使用一些支持的数据库来设置您的mlflow后端，这些数据库包括PostgreSQL、MySQL、MS-SQL和SQLite，如果您有其中的一个，您只需在启动命令中更改SQLAlchemy数据库URI的选项。</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="d1b3" class="mg kv hi mc b fi mh mi l mj mk">export DB_URI = &lt;dialect&gt;+&lt;driver&gt;://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database&gt;</span><span id="d57b" class="mg kv hi mc b fi mo mi l mj mk">mlflow server --backend-store-uri $DB_URI \<br/>              --default-artifact-root ./mlflowruns \<br/>              --host 0.0.0.0 \<br/>              --port 5000</span></pre><p id="5536" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，我将向您展示一旦您更改了这个设置，它会是什么样子(在最后会有更多的介绍)。</p><p id="a879" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们重命名它之后，我们单击模型的URL并将其阶段设置为生产，因此当我们使用预测API时，我们确保我们请求的是当前的生产模型，而不是随机的模型运行；默认情况下，它将是模型的版本1，看起来应该是这样的:</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/ea95bd2dc5a77f6e50015af3cf253584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ou6bIv_HgGIjN1eb6oHsDQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型注册表，图片由作者提供。</figcaption></figure><p id="ed9b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，我将转到我们创建的train.py文件，并使用一些不同的超参数重新运行它，以获得同一问题的不同模型版本；运行它们之后，葡萄酒回归实验应该是这样的。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/a8d02842a99146b38942f9fbaf027ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0JZkzsgSvIn_l033xCHiDA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">同一个实验下的几次运行。图片由作者提供。</figcaption></figure><h1 id="0544" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">车型对比:</strong></h1><p id="95a7" class="pw-post-body-paragraph iu iv hi iw b ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">我们可能希望使用记录的指标和我们保存为工件的自定义图像来查看最近的运行是否有更好的模型性能。</p><p id="7579" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">MLflow附带了一个比较选项，在撰写本文时，该选项仍然有点空白，但可以为我们提供一些简单的比较，让我们通过左侧的复选框选择所有模型，然后单击compare。</p><p id="6e37" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们应该看到的第一个图是一个散点图；我们可以选择想要绘制和比较的指标和参数。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/79b4dba153a15e6a2f43d0cac7f086bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLO-HdgAsbyGk_zsEY7-Ag.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">指标散点图。图片由作者提供。</figcaption></figure><p id="5c07" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您仔细查看每个点，我会向您展示运行名称以及与该运行相关的参数/指标。</p><p id="06c3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您还可以看到一个等值线图，以了解在不同的参数对组合下指标是如何变化的。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/b7d40a8311db13a54c0ab00c80e8d642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjfgLkX8WyxMZ4ok8eQklw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">参数等值线图。作者图片</figcaption></figure><p id="1e2f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，我们有一个平行坐标图，可以在其中放置所有指标和参数。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/9c57c2c29cf18fd3b050098c8897ddb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WnJonbCpoZYh35c4NgUIHQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">平行坐标图。图片由作者提供。</figcaption></figure><p id="f7d9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在通过UI比较了不同的模型之后，我们可以选择将哪个模型投入生产。然后，转到“实验”选项卡，并在确切的模型名称下注册您决定的模型，让我们将其移动到阶段步骤。</p><p id="ad15" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">注意</strong>:如果你愿意，你可以用MLflow API自动获取所有这些元数据，或者/和进行更好的比较过程。</p><p id="2972" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在“模型”选项卡上，它应该是这样的:</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/63f5140b244e2a230529b2cfbcec9284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uu6q2zQuf-c9WuDqv0dwjw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">具有阶段的模型注册表。图片由作者提供。</figcaption></figure><p id="9226" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您点击了版本2，我可以将其转移到生产环境，并将版本1设置为存档。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/0981cc79b9fd478991a015d52dc5f05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxMFd6AWKRRzqe_Dj65zcA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">型号升级。图片由作者提供。</figcaption></figure><h1 id="5f51" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">做预测:</strong></h1><p id="1fa8" class="pw-post-body-paragraph iu iv hi iw b ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">作为我们的最后一步，我们想做一些预测；为此，MLflow已经为我们提供了一个API来进行请求；如果您转到模型注册表，您应该已经注意到有一个运行id，您可以使用它向我们运行的特定模型发出请求。尽管如此，由于我们想要使用我们的生产模型，而不需要经常检查运行id是否会改变，我们可以使用带有模型名称和阶段的mlflow语法；代码如下所示:</p><pre class="lx ly lz ma fd mb mc md me aw mf bi"><span id="a71c" class="mg kv hi mc b fi mh mi l mj mk">import mlflow<br/>import pandas as pd<br/>logged_model = 'models:/Wine_Elasticnet_Sklearn_Regressor/Production'<br/><br/>data = pd.read_csv('winequality-red.csv')<br/><br/># Load model as a PyFuncModel.<br/>loaded_model = mlflow.pyfunc.load_model(logged_model)<br/><br/><br/>print(loaded_model.predict(data))</span></pre><p id="7d8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">酒质-red.csv有两行预测；运行之后，我们得到一个包含每个预测的数组。</p><figure class="lx ly lz ma fd ij er es paragraph-image"><div class="er es mz"><img src="../Images/9608bdd3489e08219196c16998832bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*l9RHBbbpaJOlehz4b81uxg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">MLflow预测响应。图片由作者提供。</figcaption></figure><p id="9d41" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您还可以创建一个新的服务器，使用mlflow的CLI将模型部署为API，并发出HTTP请求，更多信息请参见:<a class="ae mm" href="https://www.mlflow.org/docs/latest/cli.html" rel="noopener ugc nofollow" target="_blank">https://www.mlflow.org/docs/latest/cli.html</a></p><p id="b42f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">结论:</strong>如你所见，MLflow有几个易于使用的功能来管理机器学习模型的整个生命周期；有几个主题我们在这篇文章中没有涉及，例如使用数据库系统、远程存储和外部服务器部署mlflow，以及其他高级API用例和选项来自动化UI中的步骤。</p><p id="4321" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我还必须指出，即使MLflow是一个伟大的开源项目，它仍然有一些你必须注意的缺点；我想提几个:</p><ul class=""><li id="edff" class="js jt hi iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">没有内置的身份验证机制，尽管您可以使用basic auth或OAuth 2.0设置Nginx代理。</li><li id="ad2f" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">没有集成的基于角色的用户管理，所以每个人对模型都有相同的权限。</li><li id="2a60" class="js jt hi iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">一旦设置了基于云的部署，就必须在服务器端和客户端保存与存储提供者相关联的连接秘密，这同样会有一些安全问题。</li></ul><p id="c649" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Databricks提供的MLflow的商业版本可以解决这些问题。</p><p id="ddeb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你想知道如何在云环境中使用Docker设置MLflow，比如Azure或Amazon或更高级的用例，请在评论中告诉我。</p><p id="6c41" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">全部代码都在我的Github里:【https://github.com/rodrigo-arenas/mlflow-basics T2】</p><h1 id="85db" class="ku kv hi bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">参考文献:</strong></h1><p id="194b" class="pw-post-body-paragraph iu iv hi iw b ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn lw jp jq jr hb bi translated">[1] Databricks对MLflow的介绍:<a class="ae mm" href="https://databricks.com/blog/2018/06/05/introducing-mlflow-an-open-source-machine-learning-platform.html" rel="noopener ugc nofollow" target="_blank">https://data bricks . com/blog/2018/06/05/Introducing-ml flow-an-open-source-machine-learning-platform . html</a></p><p id="05fe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[2]ml flow Github:<a class="ae mm" href="https://github.com/mlflow/mlflow" rel="noopener ugc nofollow" target="_blank">https://github.com/mlflow/mlflow</a></p><p id="d237" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[3]MLflow教程:<a class="ae mm" href="https://www.mlflow.org/docs/latest/tutorials-and-examples/tutorial.html" rel="noopener ugc nofollow" target="_blank">https://www . ml flow . org/docs/latest/tutorials-and-examples/tutorial . html</a></p></div></div>    
</body>
</html>