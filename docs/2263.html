<html>
<head>
<title>Running Go code from Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä»Pythonè¿è¡ŒGoä»£ç </h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/running-go-code-from-python-a65b3ae34a2d?source=collection_archive---------0-----------------------#2021-04-15">https://medium.com/analytics-vidhya/running-go-code-from-python-a65b3ae34a2d?source=collection_archive---------0-----------------------#2021-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="35d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pythonæ˜¯ä¸€ç§ä¼Ÿå¤§çš„è¯­è¨€ï¼Œå¯ä»¥è¢«æ–°å¼€å‘äººå‘˜è½»æ¾æŒæ¡ï¼Œå¹¶åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å˜å¾—å¯Œæœ‰æˆæ•ˆï¼Œå®ƒçš„è®¾è®¡æ˜¯å¹²å‡€çš„ä»£ç ï¼Œå®ƒæœ‰ä¸€ç™¾ä¸‡ä¸ªå¯ç”¨çš„åº“ï¼Œå¯æ‚²çš„æ˜¯ï¼Œæ‰€æœ‰è¿™äº›å¥½å¤„éƒ½æ˜¯ä»¥æ‰€è°“çš„â€œé€Ÿåº¦â€ä¸ºä»£ä»·çš„ï¼Œpythonå¾ˆæ…¢ï¼Œéå¸¸æ…¢ï¼›pypyæˆ–stacklessæœ‰æ—¶æœ‰åŠ©äºæé«˜æ€§èƒ½ï¼Œä½†æœ‰æ—¶å®ƒä»¬ä¼šç ´åå…¶ä»–ä¸å…¼å®¹çš„åº“ï¼Œæˆ–è€…åœ¨æˆ‘ä»¬çš„ç‰¹å®šç”¨ä¾‹ä¸­æ²¡æœ‰ä»»ä½•æ”¹è¿›ã€‚</p><p id="1385" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨æ€»æ˜¯å¯ä»¥é€‰æ‹©ç”¨Cè¯­è¨€æ„å»ºä¸€ä¸ªåº“å¹¶å¯¼å…¥å®ƒï¼Œä½†æ˜¯å¯¹äºæŸäº›äººæ¥è¯´ï¼ŒCè¯­è¨€æœ€ç»ˆå¯èƒ½ä¼šæˆä¸ºä¸€ç§éå¸¸å¤æ‚çš„è¯­è¨€ï¼Œæˆ–è€…ç”¨Cè¯­è¨€æ„å»ºæŸäº›ä¸œè¥¿æ‰€éœ€çš„æ—¶é—´å¯èƒ½ä¼šæŠµæ¶ˆç§»æ¤ä»£ç çš„å¥½å¤„ã€‚</p><p id="35e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªä¸­é—´åœ°å¸¦æˆ‘ä»¬å¯ä»¥ä½¿ç”¨:Goï¼Œæ¯”Cæ›´å®¹æ˜“(å¦‚æœä½ åšå¹¶è¡Œçš„è¯ä¼šæ›´å¥½)ä½†æ¯”Pythonæ›´å¿«ï¼Œå®ƒä¹Ÿæœ‰å¾ˆå¤šå¯ç”¨çš„åº“ï¼Œè¿™äº›åº“å°†ä¸ºæˆ‘ä»¬æä¾›å¾ˆå¤šCä¸­å¯èƒ½æ²¡æœ‰çš„ç‰¹æ€§ã€‚</p><p id="4722" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GOæœ‰ä¸€ä¸ªåä¸ºCGO(<a class="ae jd" href="https://golang.org/cmd/cgo/" rel="noopener ugc nofollow" target="_blank">https://golang.org/cmd/cgo/</a>)çš„åŒ…ï¼Œå®ƒå…è®¸æˆ‘ä»¬è¿æ¥Goå’ŒCè¯­è¨€ï¼Œåä¹‹äº¦ç„¶ï¼Œå› ä¸ºPythonå¯ä»¥å¯¼å…¥Cè¯­è¨€çš„åº“ï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å‡ºæŸäº›Goå‡½æ•°ä¾›Pythonä½¿ç”¨ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯Cè¯­è¨€çš„åº“ä¸€æ ·ã€‚</p><p id="37d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ª<em class="je">åº“. go </em>æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="5ad3" class="jo jp hi jk b fi jq jr l js jt">package main<br/><br/>import (<br/>   "C"<br/>   "log"<br/>)<br/><br/>//<strong class="jk hj"><em class="je">export </em></strong>helloWorld<br/>func helloWorld(){<br/>   log.Println("Hello World")<br/>}<br/><br/>func main(){<br/><br/>}</span></pre><p id="14e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CGOæ·»åŠ äº†â€œCâ€å¯¼å…¥ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›æŸäº›å®ç”¨å‡½æ•°ï¼Œå®ƒå°†ä½¿ç¼–è¯‘å™¨å°†æŸäº›æ³¨é‡Šè§†ä¸ºç‰¹æ®Šæ“ä½œï¼Œç¬¬ä¸€ä¸ªæ˜¯â€œå¯¼å‡ºâ€æ³¨é‡Šï¼Œå®ƒå°†å‘Šè¯‰ç¼–è¯‘å™¨å“ªäº›å‡½æ•°å°†è¢«å¯¼å‡ºä»¥ä»Pythonè°ƒç”¨ï¼Œç„¶åæˆ‘ä»¬åƒå¾€å¸¸ä¸€æ ·åˆ›å»ºæˆ‘ä»¬çš„å‡½æ•°ï¼Œç„¶åä¸ºäº†èƒ½å¤Ÿç¼–è¯‘ï¼Œæˆ‘ä»¬å°†åœ¨æœ€åæ·»åŠ ä¸€ä¸ªç©ºçš„mainå‡½æ•°ã€‚</p><p id="ce79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç»™<strong class="ih hj">é¢å¤–çš„</strong>æ³¨æ„<em class="je">å¯¼å‡º</em>å°±åœ¨æ³¨é‡Šçš„æ—è¾¹ï¼Œå¦‚æœä½ åœ¨ä¸­é—´æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œå®ƒä¸ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¯¼å‡ºçš„ç¬¦å·ï¼Œpythonä¹Ÿä¸ä¼šæ‰¾åˆ°å®ƒã€‚</p><p id="5a79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨CLIä¸Šï¼Œæˆ‘ä»¬ç°åœ¨å°†é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ‰§è¡Œç¼–è¯‘:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="57d3" class="jo jp hi jk b fi jq jr l js jt">go build -buildmode=c-shared -o library.so library.go</span></pre><p id="830c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™é‡Œè¦æ³¨æ„çš„å…³é”®æ˜¯æ„å»ºæ¨¡å¼ï¼Œæˆ‘ä»¬å°†æŒ‡å®šå®ƒæ˜¯ä¸€ä¸ªCå…±äº«å¯¹è±¡ï¼Œç„¶åè¾“å‡ºæ‰©å±•å°†æ˜¯ä¸€ä¸ªåº“ã€‚so =æˆ‘çš„å…±äº«å¯¹è±¡ï¼Œå› ä¸ºæˆ‘æ­£åœ¨ä½¿ç”¨Linux)ï¼Œä¸€æ—¦æˆ‘ä»¬ç¼–è¯‘äº†åº“ï¼Œæˆ‘ä»¬å°†ç»§ç»­ç”¨pythonæ„å»ºå®¢æˆ·ç«¯ï¼Œä¸ºæ­¤æˆ‘åˆ›å»ºäº†ä¸€ä¸ªâ€œapp.py â€,å¦‚ä¸‹æ‰€ç¤º:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="6e1c" class="jo jp hi jk b fi jq jr l js jt">import ctypes<br/>library = ctypes.cdll.LoadLibrary('./library.so')<br/>hello_world = library.helloWorld<br/>hello_world()</span></pre><p id="519b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å¯¼å…¥<em class="je"> ctypes </em>æ¨¡å—ï¼Œç„¶ååœ¨æˆ‘ä»¬ç¼–è¯‘çš„åº“ä¸Šæ‰§è¡Œ<em class="je"> LoadLibrary </em>ï¼Œç¬¬ä¸‰è¡Œå°†æœ‰ä¸€ä¸ª<em class="je"> hello_world </em>ï¼Œå®ƒæ˜¯pythonå¯¹è±¡ï¼Œå°†å¼•ç”¨åº“çš„<em class="je"> helloWorld </em>å‡½æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‘½åçº¦å®šå°†æç¤ºæˆ‘ä»¬å“ªä¸ªæ˜¯Goç‰ˆæœ¬ï¼Œå“ªä¸ªæ˜¯Pythonçš„ï¼Œæœ€ååœ¨ç¬¬4è¡Œï¼Œæˆ‘ä»¬å°†è°ƒç”¨è¯¥å‡½æ•°å¹¶æ¥æ”¶ç±»ä¼¼äºä»¥ä¸‹çš„è¾“å‡º:</p><figure class="jf jg jh ji fd jv er es paragraph-image"><div class="er es ju"><img src="../Images/66c3eafbeddfe908b8a1e0ca985d3f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*IgXuJ0ADd38jUuUe9S2PCg.png"/></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">Goçš„æ—¥å¿—æ ¼å¼ç”¨æ¥æ‰“æ‹›å‘¼</figcaption></figure><p id="6bda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæˆ‘ä»¬æƒ³ä»Pythonå‘é€ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›è°ƒæ•´ï¼Œä¸ºæ­¤æˆ‘ä»¬å°†åœ¨library.goæ–‡ä»¶ä¸Šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="b8ec" class="jo jp hi jk b fi jq jr l js jt">//<strong class="jk hj"><em class="je">export </em></strong>hello<br/>func hello(namePtr *C.char){<br/>   name := C.GoString(namePtr)<br/>   log.Println("Hello", name)<br/>}</span></pre><p id="0fe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ ä¼šæ³¨æ„åˆ°çš„ç¬¬ä¸€ä»¶äº‹æ˜¯å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘Cå­—ç¬¦çš„æŒ‡é’ˆï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å°†æ¥æ”¶ä¸€ä¸ªâ€œå­—ç¬¦ä¸²â€ä½œä¸ºå‚æ•°ï¼Œå› ä¸ºCå¤„ç†å­—ç¬¦ä¸²(å­—ç¬¦æ•°ç»„)çš„æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸ªå¾®å°çš„è°ƒæ•´ï¼Œç„¶åæ‰èƒ½åœ¨æˆ‘ä»¬æœŸæœ›çš„æ—¶å€™ä½¿ç”¨å®ƒï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•å«C.GoStringï¼Œå®ƒå°†æ¥æ”¶æŒ‡å‘C.charçš„æŒ‡é’ˆå¹¶è¿”å›å­—ç¬¦ä¸²çš„å€¼ã€‚</p><p id="732d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€æ—¦æˆ‘ä»¬æœ‰äº†è¿™äº›ï¼Œæˆ‘ä»¬å°†åˆ‡æ¢åˆ°pythonå¹¶ä¸ºæ­¤å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç¬¦å·:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="4037" class="jo jp hi jk b fi jq jr l js jt">hello = library.hello<br/>hello.argtypes = [ctypes.c_char_p]<br/>hello("everyone".encode('utf-8'))</span></pre><p id="8d77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç¬¬ä¸€è¡Œå°†åªæ˜¯å¯¹Goå‡½æ•°çš„å¼•ç”¨ï¼Œç„¶åæˆ‘ä»¬å°†æŒ‡å®šæˆ‘ä»¬å°†å‘é€çš„â€œå‚æ•°â€çš„ç±»å‹ï¼Œåœ¨æœ¬ä¾‹ä¸­:cå­—ç¬¦æŒ‡é’ˆçš„åˆ—è¡¨ï¼Œæœ€åæˆ‘ä»¬å°†å‘é€ä¸€ä¸ªç¼–ç ä¸ºutf-8çš„å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿ç±»å‹åŒ¹é…ã€‚</p><figure class="jf jg jh ji fd jv er es paragraph-image"><div class="er es kc"><img src="../Images/aa8346a6632a198bf339cc80e625adfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*1OGG5_Rse3m01O8HQOEnaQ.png"/></div></figure><p id="69ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»Pythonè¿›è¡Œè°ƒç”¨å¹¶ä»Pythonå‘é€æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä»¶é¢å¤–çš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯å°†æ•°æ®ä»Goå‘é€å›Pythonã€‚</p><p id="777c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„Goå‡½æ•°:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="da77" class="jo jp hi jk b fi jq jr l js jt">//<strong class="jk hj"><em class="je">export </em></strong>farewell<br/>func farewell() *C.char{<br/>   return C.CString("Bye!")<br/>}</span></pre><p id="3d39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™æ¬¡æˆ‘ä»¬å°†è¿”å›ä¸€ä¸ªæŒ‡å‘C.charçš„æŒ‡é’ˆï¼Œå­—ç¬¦ä¸²éœ€è¦é€šè¿‡CåŒ…ä»stringè½¬æ¢æˆCStringã€‚</p><p id="43d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä»pythonçš„è§’åº¦çœ‹:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="9e70" class="jo jp hi jk b fi jq jr l js jt">farewell = library.farewell<br/>farewell.restype = ctypes.c_void_p<br/><br/># this is a pointer to our string<br/>farewell_output = farewell()<br/><br/># we dereference the pointer to a byte array<br/>farewell_bytes = ctypes.string_at(farewell_output)<br/><br/># convert our byte array to a string<br/>farewell_string = farewell_bytes.decode('utf-8')  <br/><br/>print(farewell_output, farewell_bytes, farewell_string)</span></pre><p id="8d2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™å°†ç»™æˆ‘ä»¬å¸¦æ¥è¿™æ ·çš„ä¸œè¥¿:</p><figure class="jf jg jh ji fd jv er es paragraph-image"><div class="er es kd"><img src="../Images/1a7cff18ffe56ee3d76c188cb88dda38.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*4dYQndUBAlINyMJZAz_2qA.png"/></div><figcaption class="jy jz et er es ka kb bd b be z dx translated">å‰ä¸¤è¡Œæ˜¯é€šè¿‡Goï¼Œæœ€åä¸€è¡Œæ˜¯é€šè¿‡Python</figcaption></figure><p id="16ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶åæˆ‘ä»¬å¯ä»¥æ‰©å±•åˆ°æ›´å¤æ‚çš„ä¸œè¥¿ï¼Œä½¿ç”¨JSONä½œä¸ºæˆ‘ä»¬åœ¨ä¸¤ä¸ªä¸–ç•Œä¹‹é—´å‘é€æ•°æ®çš„æ–¹å¼ï¼Œåœ¨library.goä¸Šæˆ‘ä»¬æ·»åŠ äº†å¦ä¸€ä¸ªå‡½æ•°:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="c7d7" class="jo jp hi jk b fi jq jr l js jt">//<strong class="jk hj"><em class="je">export </em></strong>fromJSON<br/>func fromJSON(documentPtr *C.char){<br/>   documentString := C.GoString(documentPtr)<br/>   var jsonDocument map[string]interface{}<br/>   err := json.Unmarshal([]byte(documentString), &amp;jsonDocument)<br/>   if err != nil{<br/>      log.Fatal(err)<br/>   }<br/>   log.Println(jsonDocument)<br/>}</span></pre><p id="1afa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™ä¸€ä¸ªå°†ä»¥å’Œä»¥å‰ä¸€æ ·çš„æ–¹å¼æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬å°†æŠŠå®ƒå½“ä½œä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒåŠ è½½åˆ°ä¸€ä¸ªstring-interfaceçš„æ˜ å°„ä¸­(å®é™…ä¸Šå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿â€¦â€¦)ã€‚</p><p id="73c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç„¶ååœ¨pythonä¸Š:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="6acc" class="jo jp hi jk b fi jq jr l js jt">import json<br/>from_json = library.fromJSON<br/>from_json.argtypes = [ctypes.c_char_p]<br/>document = {<br/>    "name": "john",<br/>    "last_name": "smith"<br/>}<br/>from_json(json.dumps(document).encode('utf-8'))</span></pre><p id="7aa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†ä¸€ä¸ªå­—å…¸è½¬å‚¨åˆ°ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å‘é€ç»™æˆ‘ä»¬çš„æ–°å‡½æ•°ï¼Œå…¶è¾“å‡ºå°†æ˜¯:</p><figure class="jf jg jh ji fd jv er es paragraph-image"><div class="er es ke"><img src="../Images/e88e99d06d57cc38f2cee567b46e468c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*A5fXJ66thuFBruZpqF6j3A.png"/></div></figure><p id="de2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œæ‚¨å¯ä»¥å¼€å§‹ä»Pythonç§»æ¤æ‚¨çš„ç¼“æ…¢/ç“¶é¢ˆä»£ç ï¼Œä»¥è·å¾—ä¸¤ä¸ªä¸–ç•Œçš„æœ€ä½³æ•ˆæœï¼Œå¹¶è·å¾—Pythonical Gopheristaçš„ç§°å·ã€‚</p><p id="4ba1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœåœ¨å¤åˆ¶/ç²˜è´´ç¤ºä¾‹çš„è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ä¸€äº›ä¸œè¥¿ï¼Œå®Œæ•´çš„library.goæ–‡ä»¶:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="61c9" class="jo jp hi jk b fi jq jr l js jt">package main<br/><br/>import (<br/>   "C"<br/>   "encoding/json"<br/>   "log"<br/>)<br/><br/>//<strong class="jk hj"><em class="je">export </em></strong>helloWorld<br/>func helloWorld(){<br/>   log.Println("Hello World")<br/>}<br/><br/>//<strong class="jk hj"><em class="je">export </em></strong>hello<br/>func hello(namePtr *C.char){<br/>   name := C.GoString(namePtr)<br/>   log.Println("Hello", name)<br/>}<br/><br/>//<strong class="jk hj"><em class="je">export </em></strong>farewell<br/>func farewell() *C.char{<br/>   return C.CString("Bye!")<br/>}<br/><br/>//<strong class="jk hj"><em class="je">export </em></strong>fromJSON<br/>func fromJSON(documentPtr *C.char){<br/>   documentString := C.GoString(documentPtr)<br/>   var jsonDocument map[string]interface{}<br/>   err := json.Unmarshal([]byte(documentString), &amp;jsonDocument)<br/>   if err != nil{<br/>      log.Fatal(err)<br/>   }<br/>   log.Println(jsonDocument)<br/>}<br/><br/>func main(){<br/><br/>}</span></pre><p id="27de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">app.pyæ–‡ä»¶:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="a8bb" class="jo jp hi jk b fi jq jr l js jt">import ctypes<br/>library = ctypes.cdll.LoadLibrary('./library.so')<br/>hello_world = library.helloWorld<br/>hello_world()<br/><br/>hello = library.hello<br/>hello.argtypes = [ctypes.c_char_p]<br/>hello("everyone".encode('utf-8'))<br/><br/>farewell = library.farewell<br/>farewell.restype = ctypes.c_void_p<br/><br/># this is a pointer to our string<br/>farewell_output = farewell()<br/><br/># we dereference the pointer to a byte array<br/>farewell_bytes = ctypes.string_at(farewell_output)<br/><br/># convert our byte array to a string<br/>farewell_string = farewell_bytes.decode('utf-8')<br/>print(farewell_output, farewell_bytes, farewell_string)<br/><br/><br/>import json<br/>from_json = library.fromJSON<br/>from_json.argtypes = [ctypes.c_char_p]<br/>document = {<br/>    "name": "john",<br/>    "last_name": "smith"<br/>}<br/>from_json(json.dumps(document).encode('utf-8'))</span></pre><p id="c0c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å’Œæˆ‘çš„Makefile:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="8b75" class="jo jp hi jk b fi jq jr l js jt">build:<br/>   go build -buildmode=c-shared -o library.so library.go</span></pre><p id="7aaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">ğŸ¸</p></div></div>    
</body>
</html>