<html>
<head>
<title>Migrating EC2 Managed MySQL to Amazon Aurora MySQL using AWS Database Migration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS数据库迁移将EC2托管的MySQL迁移到Amazon Aurora MySQL</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/migrating-ec2-managed-mysql-to-amazon-aurora-mysql-using-aws-database-migration-84a8cdfd59d7?source=collection_archive---------3-----------------------#2021-01-28">https://medium.com/analytics-vidhya/migrating-ec2-managed-mysql-to-amazon-aurora-mysql-using-aws-database-migration-84a8cdfd59d7?source=collection_archive---------3-----------------------#2021-01-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d9d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在EC2实例上为我们的应用程序运行MySQL数据库，这在我们开始时是一个很好的选择，但在我们的应用程序开始增长并开始接收更多数据后，我们管理MySQL服务器变得更加困难，因此我们决定将所有数据从自我管理的MySQL(EC2上的MySQL)迁移到AWS Aurora MySQL。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/450fe0a6f5d9318804f1db34815ce392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N6TKrgvF2Nv2UISKxlQc9g.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">AWS数据库迁移服务</figcaption></figure><h1 id="20eb" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">使用Aurora MySQL的优势:</h1><ol class=""><li id="7763" class="kq kr hh ig b ih ks il kt ip ku it kv ix kw jb kx ky kz la bi translated">可用且耐用</li><li id="da57" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">更高的安全性</li><li id="0230" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">高可扩展性和高性能</li><li id="a413" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">与MySQL兼容</li><li id="e17b" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">全面管理</li></ol><p id="0d35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Amazon Aurora具有分布式、容错、自我修复的存储系统。它通过多达15个低延迟读取副本、时间点恢复、到亚马逊S3的连续备份以及跨三个可用性区域(AZs)的复制，提供了高性能和高可用性。</p><p id="4803" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用AWS数据库迁移服务(DMS)来迁移我们的数据库。在这篇博文中，我将讨论我们如何使用AWS DMS将我们的生产数据库迁移到Aurora MySQL。</p><p id="abb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong> <strong class="ig hi"> — </strong>我强烈建议您首先在开发或试运行环境中尝试这些步骤，然后在生产环境中尝试。我所执行的所有步骤对您来说也没有必要完全相同。AWS DMS只是将数据从源数据库迁移到目标数据库的一个工具，还有其他工具。我和<a class="lg lh ge" href="https://medium.com/u/867fa51fc0f3?source=post_page-----84a8cdfd59d7--------------------------------" rel="noopener" target="_blank"> Shatrujeet Kumar Sah </a>已经探索了这个工具，它在我们的用例中运行得非常好。</p><h1 id="3daa" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">关于我们EC2 MySQL的一些要点</h1><ol class=""><li id="6ae8" class="kq kr hh ig b ih ks il kt ip ku it kv ix kw jb kx ky kz la bi translated">带有使用2个EC2实例的编写器和副本的MySQL</li><li id="7e20" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">大约350多张桌子</li><li id="28b9" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">数据库大小约为400GB，并且是实时生产数据库，因此数据库的大小不断增加。</li><li id="40ef" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">表之间的多个外键关系</li><li id="744a" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">表上的多个索引</li></ol><h1 id="f6d2" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">AWS数据库迁移服务</h1><p id="8a6e" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">AWS数据库迁移服务帮助您快速安全地将数据库迁移到AWS。在迁移过程中，源数据库保持完全正常运行，最大限度地减少了依赖该数据库的应用程序的停机时间。</p><p id="1807" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">AWS DMS有两个选项来迁移您的数据:</p><ol class=""><li id="03cb" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb kx ky kz la bi translated"><strong class="ig hi">迁移现有数据(满载)</strong> —执行从源端点到目标端点的一次性迁移。在这种方法中，您停止向数据库写入数据(停机几个小时)，然后使用DMS迁移到目标数据库。一旦完成，您可以在配置文件中更改端点，然后开始使用新的数据库。</li><li id="bba1" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><strong class="ig hi">迁移现有数据并复制正在进行的更改(满载+ CDC) </strong> —执行从源到目标的一次性迁移，然后继续将数据更改从源复制到目标。在这种方法中，您继续写入源数据库，让DMS迁移您的数据，然后在某个时间点停止写入源数据库，停机几分钟，然后更改配置文件中的端点并开始使用新数据库。</li></ol><p id="9611" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这完全取决于您应该采取哪种方法的用例。在我们的案例中，我们使用了第二个选项，因为它是我们的生产数据库，我们无法承受几个小时的停机时间。</p><p id="0175" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我将讨论我们采取了哪些步骤来使用第二种方法有效地将我们的数据库迁移到Aurora MySQL。</p><h1 id="6555" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">执行迁移前的先决条件</h1><p id="cdb2" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">要将DMS与Full load + CDC一起使用，需要在源数据库的MySQL配置文件中进行一些配置更改/验证。确保您的MySQL配置文件中有以下键值对。</p><ul class=""><li id="a6ca" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb lo ky kz la bi translated">server_id —将该参数设置为1或更大的值。</li><li id="042a" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">log-bin —设置二进制日志文件的路径(不包括文件扩展名。)</li><li id="b4e1" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">binlog_format —将该参数设置为<code class="du lp lq lr ls b">ROW</code></li><li id="3ade" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">expire_logs_days —将此参数设置为1或更大的值。为了防止过度使用磁盘空间，我们建议您不要使用默认值0。</li><li id="9e15" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">binlog_checksum —将该参数设置为<code class="du lp lq lr ls b">NONE</code></li><li id="274e" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">binlog_row_image —将该参数设置为<code class="du lp lq lr ls b">FULL</code></li><li id="38d1" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">log_slave_updates —如果使用MySQL或MariaDB读取副本作为源，则将此参数设置为<code class="du lp lq lr ls b">TRUE</code></li></ul><p id="293c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上K/V直接来自<a class="ae lt" href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.MySQL.html#CHAP_Source.MySQL.CustomerManaged" rel="noopener ugc nofollow" target="_blank"> AWS DMS文档</a>。在我们的例子中，我们没有配置第7个参数，因为我们的源不是读取副本。</p><blockquote class="lu lv lw"><p id="e166" class="ie if lx ig b ih ii ij ik il im in io ly iq ir is lz iu iv iw ma iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>如果您在MySQL配置文件中做了任何更改，请确保重新启动MySQL服务。这可能需要您的应用程序停机几分钟，因此请做好相应的计划。</p></blockquote><h1 id="1799" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">创建DMS源端点</strong></h1><ul class=""><li id="92a2" class="kq kr hh ig b ih ks il kt ip ku it kv ix kw jb lo ky kz la bi translated">转到端点并单击创建端点</li><li id="705e" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">选择端点类型为“源端点”</li><li id="5cad" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">在端点配置—端点标识符(源端点的唯一名称)、源引擎(选择MySQL)中，选择手动提供访问信息(服务器名称-&gt; EC2 MySQL的私有IP，根据您的数据库输入端口、用户名和密码)</li><li id="2cca" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">点击创建端点</li></ul><h1 id="688f" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">创建DMS目标端点</strong></h1><ul class=""><li id="6943" class="kq kr hh ig b ih ks il kt ip ku it kv ix kw jb lo ky kz la bi translated">转到端点并单击创建端点</li><li id="1dda" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">选择端点类型为“目标端点”</li><li id="584e" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">点击“选择RDS数据库实例”复选框—选择您的目标Aurora MySql RDS数据库。</li><li id="2089" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">填写所有必填字段，然后单击“创建端点”</li></ul><h1 id="1e60" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">创建DMS复制实例</strong></h1><ul class=""><li id="f5f5" class="kq kr hh ig b ih ks il kt ip ku it kv ix kw jb lo ky kz la bi translated">转到复制实例，然后单击创建复制实例</li><li id="9696" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">输入复制实例的名称和描述</li><li id="3f5a" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">在实例类中，选择所需的实例类(对于生产数据库迁移，建议选择较高的实例类，因为我们的迁移任务在此实例上运行，如果选择较小的实例类，可能会影响性能，并且可能需要较长的时间来完成迁移)</li><li id="2055" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">在分配的存储(GiB)中，我也建议分配大量的存储容量，因为AWS DMS在复制任务进行过程中使用此存储来存储日志文件和缓存事务。</li><li id="3c64" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">选择您的VPC(确保源数据库、复制实例和目标数据库位于同一个VPC)</li><li id="8c9a" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">建议为生产迁移启用多AZ，因为如果您的迁移任务需要很长时间才能完成，并且如果复制实例出现问题，它将自动进行故障切换</li><li id="4e7c" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">根据您的要求选择是否应该公开访问。</li><li id="82e7" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">点击创建</li></ul><h1 id="e864" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">测试电路</h1><p id="805b" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">创建复制实例后，转到端点并测试源端点和目标端点的连接。该测试将确保您的复制实例能够连接到源数据库和目标数据库。</p><p id="38a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="lx">恭喜你！！</em> </strong>你已经成功完成第一阶段</p></div><div class="ab cl mb mc go md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ha hb hc hd he"><p id="193e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们几乎完成了DMS的配置，并且我们已经测试了我们的DMS可以连接到我们的源数据库和目标数据库，只剩下一项工作，即在DMS中创建迁移任务。</p><p id="b663" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用AWS DMS任务，您可以指定要迁移的模式和迁移类型。您定义要迁移哪些表，迁移到哪里，以及如何迁移。</p><p id="82dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在创建迁移任务之前，我们将执行一些手动步骤。</p><p id="0ca6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:——</strong>我在博客中提到的方法并不一定要你遵循同样的步骤。没有必要执行手动步骤，如果需要，您可以直接创建并运行迁移任务。我们之所以执行这些步骤，是因为我们有多个外键约束，源数据库和DMS上的默认值在执行迁移之前不会在表之间创建这些关系。它会尝试并行迁移所有表，因此您可能会从MySQL的目标数据库中获得外键约束违规的错误。</p><h1 id="9a85" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">从源数据库导出模式并删除外键约束</h1><p id="5aee" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">我们将只从转储文件中的源数据库导出模式，然后从转储文件中删除外键约束，最后将模式应用到目标数据库</p><p id="b217" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要导出模式，请运行以下命令:</p><pre class="jd je jf jg fd mi ls mj mk aw ml bi"><span id="a684" class="mm jt hh ls b fi mn mo l mp mq">mysqldump -u [your_user] -h [your_host] --no-data -p [your_database] &gt; database.sql<!-- --> </span></pre><p id="7700" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦运行上述命令，它将只包括您在命令中指定的数据库的模式，如果您有多个数据库，通过更改<strong class="ig hi"> &lt; your_database &gt; </strong>运行上述命令，并导出每个数据库的模式。</p><p id="e3f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">导出模式后，删除外键约束、删除操作等并保存文件。</p><p id="3c01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong> <strong class="ig hi"> — </strong>我建议不要修改原始模式文件，创建它的副本，然后删除约束。</p><p id="0efc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，既然我们已经准备好了数据库模式，我们将把它应用到我们的目标数据库。使用以下命令将模式应用到目标数据库。</p><pre class="jd je jf jg fd mi ls mj mk aw ml bi"><span id="a8db" class="mm jt hh ls b fi mn mo l mp mq">mysql -u [your_user] -h [your_host]<!-- --> <!-- -->-p [your_database] &lt; database_without_constraint.sql<!-- --> </span></pre><p id="5740" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">验证源和目标MySQL中的表的数量。在源数据库和目标数据库中运行以下查询。</p><pre class="jd je jf jg fd mi ls mj mk aw ml bi"><span id="95dd" class="mm jt hh ls b fi mn mo l mp mq">SELECT count(*) AS TOTALNUMBEROFTABLES FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = '&lt;your_database&gt;';</span></pre><p id="407c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦DMS任务完成了我们的<strong class="ig hi">满负荷</strong>，我们将改变目标数据库上的表，并将外键约束应用于我们的表。</p><p id="bb3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">牛逼！！</strong>我们已经成功创建了目标数据库的模式，并验证了表的数量，现在是创建DMS迁移任务的时候了。</p></div><div class="ab cl mb mc go md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ha hb hc hd he"><h1 id="7d15" class="js jt hh bd ju jv mr jx jy jz ms kb kc kd mt kf kg kh mu kj kk kl mv kn ko kp bi translated">创建AWS DMS任务</h1><p id="3fee" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">单击数据库迁移任务，然后单击创建任务按钮。</p><ul class=""><li id="0cae" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb lo ky kz la bi translated"><strong class="ig hi">任务配置</strong></li></ul><p id="cde5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">a.任务标识-&gt;输入任务名称</p><p id="be72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">b.复制实例-&gt;选择您的复制实例</p><p id="45f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">c.源数据库端点-&gt;选择您的源数据库端点</p><p id="378f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">d.目标数据库端点-&gt;选择您的目标数据库端点</p><p id="0f83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">e.迁移类型-&gt;选择<strong class="ig hi">迁移现有数据并复制正在进行的更改</strong></p><ul class=""><li id="f98e" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb lo ky kz la bi translated"><strong class="ig hi">任务设置</strong></li></ul><p id="4c8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">a.目标表准备模式-&gt; Select<strong class="ig hi">Truncate</strong>(AWS DMS保留表及其元数据，但删除其中的数据。)您可以根据您的使用案例进行选择。</p><p id="1c9a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">b.满载完成后停止任务-&gt;选择<strong class="ig hi">应用缓存更改后停止</strong>(应用缓存更改后停止任务。这将允许您添加外键、触发器等)。一旦全部加载完成，我们将自动停止我们的任务，然后我们将应用alter table命令在目标数据库中的表上创建外键，然后我们将启动CDC(复制正在进行的更改)。)</p><p id="fe18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">c.在复制中包含LOB列-&gt;选择<strong class="ig hi">完全LOB模式</strong>(如果在源数据库中有LOB对象)</p><p id="994d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">d.点击启用CloudWatch日志复选框-&gt;这将有助于您在出现问题时调试问题。</p><ul class=""><li id="c4cd" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb lo ky kz la bi translated"><strong class="ig hi">表格映射</strong></li></ul><p id="c1a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">表映射告诉AWS DMS任务应该将哪些表从源迁移到目标。DMS不会迁移MySQL创建的某些<strong class="ig hi">系统模式</strong>，如果您尝试迁移它，它会给出错误。所以我们要做的是创建<strong class="ig hi">表映射</strong>，并通过指定<strong class="ig hi">包含规则</strong>告诉DMS任务只迁移<strong class="ig hi">我们的模式</strong>和我们模式表中的数据。指定表名时，可以使用<strong class="ig hi">" "</strong>作为通配符值。</p><ul class=""><li id="cf6d" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb lo ky kz la bi translated">模式名-&gt;输入您的数据库名</li><li id="43e2" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">表名-&gt;输入<strong class="ig hi">" " "</strong>(该模式中的所有表)</li><li id="9017" class="kq kr hh ig b ih lb il lc ip ld it le ix lf jb lo ky kz la bi translated">操作-&gt;选择包括</li></ul><p id="6156" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您有多个数据库，请添加多个规则。</p><ul class=""><li id="4950" class="kq kr hh ig b ih ii il im ip ll it lm ix ln jb lo ky kz la bi translated"><strong class="ig hi">迁移任务启动配置</strong></li></ul><p id="0b62" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以决定何时开始迁移任务，可以在创建后自动开始，也可以手动开始。</p><p id="25ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击<strong class="ig hi">创建任务</strong>按钮。</p><p id="2d63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">恭喜你！！！🥳 </strong>您已经成功创建了DMS迁移任务，现在根据您的启动配置，它将开始执行从源数据库到目标数据库的<strong class="ig hi">满负荷</strong>，并且一旦根据我们的配置完成，它将<strong class="ig hi">自动停止</strong>。</p><p id="6a2f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">深呼吸，放松，直到完成全部负荷。</strong></p></div><div class="ab cl mb mc go md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ha hb hc hd he"><p id="73c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦完全加载完成，DMS任务将自动停止，不要担心，当DMS任务处于停止状态时，您不会丢失数据，DMS知道它何时开始任务，何时停止，以及直到什么点数据被迁移。</p><p id="8334" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们将修改目标数据库上的表，以添加外键约束。</p><p id="a378" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要运行以下命令，请确保使用MySQL客户端CLI连接到目标数据库。如果你有<strong class="ig hi">删除</strong>约束，确保你也添加了它。</p><p id="1caa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong> <strong class="ig hi"> — </strong>您可以查看您的原始模式文件，并从中创建ALTER TABLE命令来添加外键常量</p><pre class="jd je jf jg fd mi ls mj mk aw ml bi"><span id="71e4" class="mm jt hh ls b fi mn mo l mp mq"># make sure you select your database first</span><span id="3545" class="mm jt hh ls b fi mw mo l mp mq">ALTER TABLE &lt;table1_name&gt; ADD CONSTRAINT &lt;constraint_name&gt; FOREIGN KEY (column_name) REFERENCES table2_name(column_name);</span></pre><p id="fc40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您有多个带有外键的表，那么您可以在SQL文件中编写所有的alter查询，然后运行以下命令。如果您有多个数据库，您可以使用相关的alter命令创建多个文件</p><pre class="jd je jf jg fd mi ls mj mk aw ml bi"><span id="2f7b" class="mm jt hh ls b fi mn mo l mp mq">mysql -u [your_user] -h [your_host]<!-- --> <!-- -->-p [your_database] &lt; database1_alter_table.sql<!-- --> </span></pre><p id="bb9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦执行了所有的变更查询，转到DMS任务页面，单击您的任务定义和<strong class="ig hi">“Resume”</strong>您的任务<strong class="ig hi">(从它停止的地方开始)。</strong>恢复AWS DMS任务后，它将执行<strong class="ig hi"> CDC操作</strong>。<strong class="ig hi"> </strong>任务状态将类似于<strong class="ig hi">“复制正在进行的变更”</strong>。</p><p id="4045" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，它已经开始将正在进行的更改从我们的源数据库复制到目标数据库，您可以想运行多久就运行多久(几个小时或几天)。</p><h1 id="7498" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">切换数据库连接端点</h1><p id="a434" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">现在问题来了，我们什么时候真正切换数据库连接，以便我们的应用程序可以将数据写入我们的新数据库？</p><p id="e156" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以通过查看<strong class="ig hi">CDC latency source(latency source)</strong>和<strong class="ig hi">CDC latency target(latency target)</strong>指标来观察任务的总延迟或副本延迟。</p><p id="682f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在某些时候，你必须<strong class="ig hi">做出决定</strong>，当你想要<strong class="ig hi">停止</strong>时，你<strong class="ig hi">停止将</strong>写入你的<strong class="ig hi">源数据库</strong>。一旦停止对源数据库的写操作，度量值<strong class="ig hi"> CDCLatencySource </strong>和<strong class="ig hi"> CDCLatencyTarget </strong>将变为<strong class="ig hi"> 0(零)</strong>。</p><p id="c988" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦上述指标的值达到0，我们就可以说，现在源数据库和目标数据库之间没有复制延迟，所有数据都已迁移到新的目标数据库。现在您<strong class="ig hi">停止您的AWS DMS任务</strong>，在您的配置文件中更改端点，以便您的应用程序可以指向新的AWS RDS MySQL数据库，并且它将开始使用您的新数据库。</p></div></div>    
</body>
</html>