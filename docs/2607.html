<html>
<head>
<title>Bert Fine Tune for Question Answering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伯特微调问题回答</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/bert-fine-tune-for-question-answering-75718d94f8b3?source=collection_archive---------7-----------------------#2021-05-07">https://medium.com/analytics-vidhya/bert-fine-tune-for-question-answering-75718d94f8b3?source=collection_archive---------7-----------------------#2021-05-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5f97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上一篇文章中，我展示了Bert在回答问题时的基本用法。现在，我将尝试展示我们如何针对QA对Bert进行微调。</p><p id="596e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码在github : <a class="ae jc" href="https://github.com/mcelikkaya/medium_articles2/blob/main/bert_qa_tune.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a> <br/>可以在nbviewer查看:<a class="ae jc" href="https://nbviewer.jupyter.org/github/mcelikkaya/medium_articles2/blob/main/bert_qa_tune.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a></p><p id="742e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我发现了一个用于生成数据的开放健康集。生成数据集的代码变得有点复杂。我的意图是将疾病描述、症状和预防措施结合到一个上下文中，并为所有疾病生成问题。最后，数据集生成部分变得如此漫长。你不必担心去理解那部分。只需检查代码中的问题和答案。</p><p id="57d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是“真菌感染”的一个例子。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="c018" class="jm jn hh ji b fi jo jp l jq jr">In humans, fungal infections occur when an invading fungus takes over an area of the body and is too much for the immune system to handle. Fungi can live in the air, soil, water, and plants. There are also some fungi that live naturally in the human body. Like many microbes, there are helpful fungi and harmful fungi.The name of disease is Fungal infection is an illness when you have itching  skin_rash  nodal_skin_eruptions  dischromic _patches . You must bath twice use detol or neem in bathing water keep infected area dry use clean cloths .</span></pre><p id="389b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们生成一个如下的问题映射。文本是问题的答案，答案的开始和结束标志着答案的部分。检查代码，看看我是如何生成这些的。459–544是序列开始和结束时字符串的indexof char的跨度。(非令牌索引)</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="9e30" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi">Context</strong>: What is Fungal infection<br/>{'text': 'In humans, fungal infections occur when an invading fungus takes over an area of the body and is too much for the immune system to handle. Fungi can live in the air, soil, water, and plants. There are also some fungi that live naturally in the human body. Like many microbes, there are helpful fungi and harmful fungi.The name of disease is Fungal infection is an illness when you have itching  skin_rash  nodal_skin_eruptions  dischromic _patches . You must bath twice use detol or neem in bathing water keep infected area dry use clean cloths', <br/><strong class="ji hi">Question </strong>: What is treatment for Fungal infection<br/><strong class="ji hi">Answer :<br/></strong>{'<strong class="ji hi">text</strong>': 'bath twice use detol or neem in bathing water keep infected area dry use clean cloths', '<strong class="ji hi">answer_start</strong>': 459, '<strong class="ji hi">answer_end</strong>': 544}</span></pre><p id="2013" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其他一些示例问题如下:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="0c39" class="jm jn hh ji b fi jo jp l jq jr"><strong class="ji hi">What </strong>must I do for GERD ? <br/><strong class="ji hi">What </strong>is treatment for GERD ? <br/><strong class="ji hi">What </strong>is problem if,I have itching  vomiting  yellowish_skin  nausea  loss_of_appetite  abdominal_pain  yellowing_of_eyes ? <br/><strong class="ji hi">What </strong>happens if,I feel itching  vomiting  yellowish_skin  nausea  loss_of_appetite  abdominal_pain  yellowing_of_eyes ? <br/><strong class="ji hi">What </strong>must I do for Chronic cholestasis ? <br/><strong class="ji hi">What </strong>is treatment for Chronic cholestasis ?</span></pre><p id="00d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从这种背景下，我试着提出以下三种问题。(我对第三种问题类型进行了评论，因为它适用于很长的答案。如果愿意，您可以启用并尝试。这样就变得更简单了)<br/>我用1，2个问题生成培训问题，用3，4个问题生成验证问题。我试着使用相似的语义，这样一旦训练完毕，我们的模型就能理解对方。我的意思是，在训练时，我带着“我必须做什么”、“治疗是什么”的问题进行训练，同时确认“我能做什么”、“你有什么建议”。我希望model能够捕捉到这些句子之间的一些语义相似性，并捕捉到答案。虽然我改变了问题的词汇，但我希望Bert QA能够理解。</p><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es js"><img src="../Images/b43d35cf308053406ad0ce4acab424e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNWeFInJCkYlTM7LAnVf4w.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated"><strong class="bd ke">问题模板</strong></figcaption></figure><p id="17ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个数据集设计得不是很好。但是演示如何微调已经足够好了。在下面，我放了一个熊猫问答的数据框。在行中，您可以看到针对训练集和验证集的相同问题。</p><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es kf"><img src="../Images/94b4eef50c1dd1e1fc4e1c9e86efb0e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71aiDQwfxMNeecKEyivKgw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated"><strong class="bd ke">样本训练和配对验证对</strong></figcaption></figure><p id="6b71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们有了数据集，我们将像训练其他Pytorch网络一样训练它。下面是我们模型的火车模型代码。正如您从第9行看到的，我们从trainloader获得[ <strong class="ig hi">输入_ ids，注意_屏蔽，开始_位置，结束_位置</strong> ]。我们将这些参数提供给模型，并接收输出。</p><figure class="jd je jf jg fd jt"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="b0ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第14行上面，你可以看到我们直接从模型中得到输出损失。事实上，它返回所有必要的东西，所以我们不需要定义一个损失函数和计算损失。[ <strong class="ig hi"> 'loss '，' start_logits '，' end_logits' </strong> ] <br/>只需向后做损耗和优化器步骤就够了。(第15行和第16行)</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="7eb8" class="jm jn hh ji b fi jo jp l jq jr"><br/>QuestionAnsweringModelOutput([<br/>('<strong class="ji hi">loss</strong>',tensor(1.0271, device='cuda:0', grad_fn=&lt;DivBackward0&gt;)),<br/>('<strong class="ji hi">start_logits</strong>',tensor([[-3.5199,  3.2519, -1.5817,  ..., -4.4916, -4.5127, -4.6273],...[-3.3697,  3.4824, -0.0218,  ..., -4.3845, -4.6916, -4.6110]],device='cuda:0', grad_fn=&lt;SqueezeBackward1&gt;)),<br/>('<strong class="ji hi">end_logits</strong>',tensor([[-3.3699,  0.0322, -1.5576,  ..., -4.3366, -4.2556, -4.5339],[-2.7250,  0.7888,  3.1131,  ..., -3.8722, -4.4364, -3.5741]], device='cuda:0', grad_fn=&lt;SqueezeBackward1&gt;))])</span></pre><p id="0508" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你也可以检查eval_loader方法，我们在那里计算精度。在下面的第15行，你可以看到我们用与train相同的参数调用这个模型。我们正在检查答案是否与我们的验证答案相同。此外，如果您想知道在早期阶段学习了哪些问题，您可以使用dump_equal True调用方法，并查看以何种顺序学习了哪些验证问题。</p><figure class="jd je jf jg fd jt"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="09cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还要记住，这些包不做分词。他们正在削减一些后修复和附加一些特殊字符。我们这里使用的记号赋予器有如下定义。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="6b39" class="jm jn hh ji b fi jo jp l jq jr">PreTrainedTokenizerFast(name_or_path='distilbert-base-uncased', vocab_size=30522, model_max_len=512, is_fast=True, padding_side='right', special_tokens={'unk_token': '[UNK]', 'sep_token': '[SEP]', 'pad_token': '[PAD]', 'cls_token': '[CLS]', 'mask_token': '[MASK]'})</span></pre><p id="af39" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面显示了一个示例问题上下文对编码。</p><p id="7766" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">“你对真菌感染有什么建议”<br/> </strong>令牌如下，如你所见<br/>【CLS】+question+[SEP]+context</p><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ki"><img src="../Images/2086494dc9329455505da9b3e74cab96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNtSy6IDGHphaRaUfcBDNA.png"/></div></div></figure><p id="9417" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">经过5个时期，我可以看到模型达到了%89的精确度。虽然数据集不太好，但Bert QA学会了与我的数据集保持一致。在下一篇文章中，我将可视化微调过程。</p></div></div>    
</body>
</html>