<html>
<head>
<title>Ansible PlayBook for Configure the Webserver on Docker Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于在Docker容器上配置web服务器的可行行动手册</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ansible-playbook-for-configure-the-webserver-on-docker-container-3269506c35e7?source=collection_archive---------20-----------------------#2021-01-15">https://medium.com/analytics-vidhya/ansible-playbook-for-configure-the-webserver-on-docker-container-3269506c35e7?source=collection_archive---------20-----------------------#2021-01-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e8f81a9acd960ff56e4f3de523d7f8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*wFGeCNZcg3cDOhIMz4uCig.png"/></div></div></figure><h2 id="0373" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">配置Docker</h2><h2 id="12ab" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">👉启动并启用Docker服务<br/>👉从Docker Hub <br/>获取httpd服务器镜像👉运行docker容器并将其公开<br/>👉复制/var/www/html目录<br/>中的html代码，启动web服务器</h2><h2 id="9eac" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">1 &gt;为Docker安装配置软件包</h2><p id="fc09" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">首先，为了安装docker软件，我们必须创建一个存储库。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="bdda" class="ip iq hh kn b fi kr ks l kt ku">- name: "Creating  An yum repo for docker..... "<br/>    yum_repository:<br/>            name: "docker"<br/>            description: "repo for DOcker"<br/>            baseurl: "<a class="ae kv" href="https://download.docker.com/linux/centos/7/x86_64/stable/" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/centos/7/x86_64/stable/</a>"<br/>            gpgcheck: no</span></pre><h2 id="130d" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">2 &gt;安装Docker软件</h2><p id="1fc5" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">现在，我们有两个安装docker软件的选项。</p><p id="4f1e" class="pw-post-body-paragraph jn jo hh jp b jq kw js jt ju kx jw jx ja ky jz ka je kz kc kd ji la kf kg kh ha bi translated">第一个选项我们可以直接使用ansible的package模块，但是在这个过程之后会出现错误。这不能帮助我们安装一个完美的docker软件版本。正如我们所知，docker软件的安装也可以通过帮助命令模块来完成，但在这里，在这种情况下，我们可以使用shell模块而不是命令模块，因为在命令模块中，我们不能使用shell模块中的shell关键字，但我们可以这样做(for–no best)。</p><p id="70a5" class="pw-post-body-paragraph jn jo hh jp b jq kw js jt ju kx jw jx ja ky jz ka je kz kc kd ji la kf kg kh ha bi translated">第二种选择是，我们可以安装docker软件，并查看已安装的docker版本。现在，我们可以复制这个相同的版本，我们将运行相同版本的包模块，这将下载完美的docker软件。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="3fd2" class="ip iq hh kn b fi kr ks l kt ku">- name: "Installing Docker ....."<br/>    package:<br/>       name: "docker-ce-18.09.1-3.el7.x86_64"<br/>       state: present</span></pre><h2 id="db87" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">3 &gt;启动Docker服务</h2><p id="7931" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">现在让我们借助ansible模块启动docker服务。现在我们要拉httpd的图像。因此，我们将使用一个模块，在docker image的帮助下提取docker的图像，但我们将面临一个问题，因为它需要一个名为“docker-py”的python模块。为了安装这个python模块，我们需要一个由ansible提供的pip模块。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="dbf7" class="ip iq hh kn b fi kr ks l kt ku">- name: "docker_image module need an python module i.e. docker-py ..."<br/>    pip:<br/>      name: docker-py</span><span id="5fed" class="ip iq hh kn b fi lb ks l kt ku">- name: "Pulling Image httpd ....."<br/>    docker_image:<br/>            name: httpd<br/>            source: pull</span></pre><h2 id="2e9b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">4 &gt;现在复制(。html)代码到完美的地方！！</h2><p id="39f4" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">我们将创建一个. html页面，并在复制模块的帮助下传输该文件。我们必须确保我们已经在一个安全的地方复制了这个文件。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="273b" class="ip iq hh kn b fi kr ks l kt ku">- name: "Copying the html file (page) ...."<br/>    copy:<br/>        dest: "~/index.html"<br/>        content: "Hii This page is Hosted From the HTTPD docker image !!"</span></pre><h2 id="88c1" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">5 &gt;午餐Docker容器并将其暴露！！</h2><p id="1aa1" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">现在，我们将在映像HTTPD的帮助下启动docker容器，但当此映像启动时，我们将在一个端口公开此映像，启动时，我们将向此映像附加一个目的地。html文件的位置。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="1829" class="ip iq hh kn b fi kr ks l kt ku">- name: "Lunching the docker image i.e. httpd ...."<br/>    community.general.docker_container:<br/>            name: webOS<br/>            image: httpd<br/>            ports:<br/>                 - "888:80"<br/>            state: started</span></pre><h2 id="7304" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">6 &gt;允许防火墙通过我们暴露该容器的端口</h2><p id="cdd5" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">现在我们必须允许docker图像暴露的端口。</p><pre class="ki kj kk kl fd km kn ko kp aw kq bi"><span id="9de7" class="ip iq hh kn b fi kr ks l kt ku">- name: "lets allow firewall for the port which we have routed for to the docker webserver !!"<br/>    firewalld:<br/>            port: "888/tcp"<br/>            state: enabled<br/>            permanent: yes<br/>            immediate: yes</span></pre><p id="9133" class="pw-post-body-paragraph jn jo hh jp b jq kw js jt ju kx jw jx ja ky jz ka je kz kc kd ji la kf kg kh ha bi translated">完整脚本→<a class="ae kv" href="https://github.com/Shashwatsingh22/Ansible/tree/main/play_for_docker" rel="noopener ugc nofollow" target="_blank">https://github . com/shashwatsingh 22/ansi ble/tree/main/play _ for _ docker</a></p><p id="1a38" class="pw-post-body-paragraph jn jo hh jp b jq kw js jt ju kx jw jx ja ky jz ka je kz kc kd ji la kf kg kh ha bi translated">谢谢大家！！</p></div></div>    
</body>
</html>