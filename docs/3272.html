<html>
<head>
<title>Mapping Indonesia’s Village Border with Plotly: Transforming Long Lat Coordinates to Shapefile Format</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Plotly绘制印度尼西亚的村庄边界:将经度坐标转换为Shapefile格式</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mapping-indonesias-village-border-with-plotly-from-long-lat-coordinates-to-wkt-strings-975fd002326e?source=collection_archive---------4-----------------------#2021-06-22">https://medium.com/analytics-vidhya/mapping-indonesias-village-border-with-plotly-from-long-lat-coordinates-to-wkt-strings-975fd002326e?source=collection_archive---------4-----------------------#2021-06-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="1e43" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">探索和想象(几乎)印度尼西亚的任何地方</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/9ecd781347dcc6e75e3fa545cb66b53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-qKCnZlWKGS5MYluLAufw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">DKI雅加达地图(图片由作者提供)</figcaption></figure><p id="d573" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">绘制非美国位置的地理空间信息带来了许多挑战，从数据可用性到数据预处理的繁重工作。例如，并不总是能保证矢量的格式美观，即使如此，粒度也可能不够。</p><p id="a7c8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">对于像印度尼西亚这样幅员辽阔的国家来说，能够进行大规模的空间分析对学术和专业工作都有巨大的好处。所以，当我碰到这个<a class="ae ki" href="https://github.com/pararawendy/border-desa-indonesia-geojson" rel="noopener ugc nofollow" target="_blank"> GitHub </a>村级GeoJSON粒度的回购(取自<a class="ae ki" href="https://gis.dukcapil.kemendagri.go.id/arcgis/home/" rel="noopener ugc nofollow" target="_blank"> Duscapil </a>)时，我的第一反应是<a class="ae ki" href="https://github.com/taufiqbashori/border-desa-indonesia-geojson" rel="noopener ugc nofollow" target="_blank">叉一下。</a></p><p id="7527" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我的目标很简单:努力使<strong class="jo hi">为绘图和空间分析做好准备，供任何人使用</strong>。寻找可靠的印度尼西亚空间数据参考用于分析对我来说是一个挑战，我相信你们中的一些人可能也有类似的困扰。</p><p id="afad" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">话虽如此，本文主要关注Geopandas和<a class="ae ki" href="https://github.com/plotly/plotly.py" rel="noopener ugc nofollow" target="_blank"> Plotly </a>库，并且方法论受到Kerry Halupka 的这篇<a class="ae ki" href="https://towardsdatascience.com/how-to-create-maps-in-plotly-with-non-us-locations-ca974c3bc997" rel="noopener" target="_blank"> TDS文章的极大启发。</a></p><h1 id="fd30" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">步骤Google Colab中的数据提取、加载和转换</h1><p id="c925" class="pw-post-body-paragraph jm jn hh jo b jp lb ii jr js lc il ju jv ld jx jy jz le kb kc kd lf kf kg kh ha bi translated"><strong class="jo hi">首先:从Github Repo中检索数据帧</strong></p><p id="0145" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这一步应该相当简单。对于原始数据集，在Github repo中，所有者已经给出了相当简单的解析方法(参见这里的<a class="ae ki" href="https://github.com/pararawendy/border-desa-indonesia-geojson" rel="noopener ugc nofollow" target="_blank"/>)。考虑到文件大小，如果你想重新创建这个过程，我建议你在本地笔记本上创建。以这种方式提取数据也很方便，因为这允许我们在本地将其转换为csv，然后可以上传到数据库，如BigQuery。</p><p id="9c20" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">原始数据框的预览如下:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lg"><img src="../Images/e06b7fe9ecc9d5373bbdda6faf4de030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBlWEPdVfG7-pMg1MVBBHg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">作者图片(来自Github Repo)</figcaption></figure><p id="e3ff" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">一旦我们有了数据框架，就该把它转换成<a class="ae ki" href="https://developer.here.com/blog/what-is-a-wkt-file-and-how-to-create-one" rel="noopener ugc nofollow" target="_blank"> WKT弦</a>几何图形了。尽管我们可以在本地完成这个过程，但Google Colab在可移植性方面做得更好(并且更便于分发)，所以为了设置它，我将当时转换成csv格式的数据帧文件上传到google drive，并将其加载到Colab环境中。下面是需要的一些过程。</p><p id="6d76" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">在Google Colab中导入必要的库</strong></p><p id="9417" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">下面列出了我们将使用的库。首先导入它们以正确设置colab环境。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="94c2" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">从Google Drive加载数据帧</strong></p><p id="c7d0" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">由于我已经将数据框放在Google Drive中，下一步是将源文件挂载到Drive并指定路径。在这种情况下，我的数据框的csv文件位于<em class="lj">border-DESA-Indonesia-geo JSON</em>文件夹内的<em class="lj"> extract-geojson </em>文件夹中(在<em class="lj"> Github May 21 </em>文件夹内<em class="lj"> MyDrive </em>内)。在我们指定路径之后，我们可以使用Panda的<em class="lj"> read_csv </em>来读取文件并将其命名为df。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="1fe7" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">然后，我将df数据帧复制到dfx中，指定我需要的列。用<em class="lj"> dfx.head() </em>，如果你得到以下结果，恭喜你！您已成功将数据框加载到google colab中。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lk"><img src="../Images/028502c724b5776fcf09625e6d60f3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXF1OEO3eRO3QU2YZno7Vw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">作者图片</figcaption></figure><p id="b43b" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意:另一种方法是将你的文件存储在github中，并将你的驱动器连接到github文件夹，但这不在本文讨论范围之内。</p><p id="2631" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">将长Lat的边框变换成匀称的WKT </strong></p><p id="55e8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们将向数据框添加一个名为“geometry”的列，并使用border列上的信息创建一个多边形或多多边形，该多边形可作为几何转换为wkt字符串。</p><p id="31bd" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">第一步是创建一个字典，然后存储来自变换后的边界列的更新后的面/多面值。您可以从数据集中选择任何列，但是在本例中，我使用border column作为初始字典。枚举的使用确保了我们拥有与数据帧索引相似的值。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="19b6" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">第二步是迭代边界坐标列表值，并以类似于WKT字符串多边形或多重多边形格式的方式对其进行变换。请注意，多重多边形通常是一组多边形，可以通过边界坐标开头的三重括号“[[”来标识。您可能希望研究这些数据，找出更多细微的差异。</p><p id="0a21" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">经过几次迭代后，以下语法可以识别多边形和多重多边形，同时替换每个“border”列中的不规则字符(如多余的逗号或括号)。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="f5cf" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">第三步是通过根据最新更新的border_dict字典映射数据框索引来创建列“geometry”。不要忘记检查Multipolygon，以确认for循环if逻辑是否按预期工作。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="c8a4" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果结果如下，那么恭喜你！您已经加载了WKT字符串，离拥有覆盖(几乎)整个印度尼西亚的shapely空间数据参考又近了一步。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ll"><img src="../Images/7240b1d35dc93dee198937b0dad0aaff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5u3Ovtk0lT02429zluR24A.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">作者图片</figcaption></figure><p id="986f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">错误处理:如何知道你的几何图形是有效的</strong></p><p id="0988" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">因此，您已经生成了几何值，并希望将数据存储在某个地方，可能在您的BigQuery数据集中。但是你怎么知道所有的几何都是有效的呢？</p><p id="5163" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">为了避免需要返回数据预处理的麻烦，我们可以遍历几何图形并检查是否出现了任何错误。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="ce4c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果上面的代码没有产生任何错误信息，那么你可以肯定几何图形的工作！</p><p id="9f34" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意:您还可以将None更改为任何值或字符串，以便更方便地搜索错误值(如果有)。</p><p id="d2b3" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">可选:下载您更新的数据框</strong></p><p id="1884" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">此可选步骤适用于希望下载数据框的用户。由于我们使用的是colab，这可以通过<em class="lj">文件下载</em>来完成。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><h1 id="06b9" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">第二步:可视化地图！</h1><p id="77f7" class="pw-post-body-paragraph jm jn hh jo b jp lb ii jr js lc il ju jv ld jx jy jz le kb kc kd lf kf kg kh ha bi translated"><strong class="jo hi">选择想要的区域</strong></p><p id="8ec6" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">首先，让我们选择在印度尼西亚的哪个地区，我们想突出更多。例如，假设我们想要突出显示印度尼西亚首都DKI雅加达。您可以看到下面的代码示例。</p><p id="93cd" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在这里，我还生成了一个随机整数，只是为了说明用例(它们可以用于颜色代码)。在实际情况中，随机整数可以用你感兴趣的值/指标来代替，例如人口、家庭、收入等。此外，不要忘记预先将<em class="lj">几何列</em>转换为<em class="lj"> WKT几何序列</em>，以便列数据类型被识别为<em class="lj">几何列</em>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="ae3e" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">下面是将pop添加为列后它是如何转换的:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lm"><img src="../Images/d69719aee533840f0fe6253cd335d5ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKM3GhQinLGO3thyQhRTuQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">作者图片</figcaption></figure><p id="4639" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意:如果你想可视化印度尼西亚的所有村庄，应该没问题，但由于其规模，你可能无法在google colab上做到这一点。</p><p id="edb7" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">可选:在GeoPandas中将其可视化</strong></p><p id="a5aa" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在GeoPandas中将其可视化比在Plotly中简单得多。这个可选步骤是快速检查您尝试可视化的地图。使用pop随机数作为颜色代码，您可以运行以下代码:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="3726" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果您正在运行代码，并且结果如下所示，那么您已经成功地创建了GeoPandas地图！</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es ln"><img src="../Images/db7ae46996accc0cc3ed9466ada53d9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*c2zKqyrJXF9gSnFAWFU3uQ.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">DKI雅加达地图(图片由作者提供)</figcaption></figure><p id="26b2" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意:注意在DKI雅加达的中北部有一个轻微的白色矢量缺失。这可能表明原始数据集实际上不包含该区域的地理信息。修复白色区域超出了本文的范围，但是考虑到它的小尺寸，这应该不是什么大问题。</p><p id="a63e" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">将它形象化</p><p id="17b1" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最后，这是在Plotly中可视化它的步骤。请注意，在继续之前，您将需要访问令牌。只需注册(免费)Mapbox帐户，并在那里生成您的密钥。这里还有一个简短的教程<a class="ae ki" rel="noopener" href="/technology-hits/working-with-maps-in-python-with-mapbox-and-plotly-6f454522ccdd"/>。</p><p id="c681" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">一旦你有了钥匙，复制粘贴到MAPBOX_ACCESSTOKEN，不要忘记指定你的中心开始坐标。同样，由于Plotly将输入作为geoJSON，您应该从您的数据框中创建一个，在本例中，我将其命名为<em class="lj"> x_json </em>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="2425" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最后，一旦你运行代码，你应该得到一个漂亮的地图，就像这样。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/9ecd781347dcc6e75e3fa545cb66b53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-qKCnZlWKGS5MYluLAufw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">DKI雅加达地图(图片由作者提供)</figcaption></figure><p id="d47d" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">现在，您只需更改您的位置过滤器，就可以使用您的地图探索印度尼西亚了！例如，这里有一个给三宝垄的。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lo"><img src="../Images/1061a2ce13ffdd977062fb8e42bf9205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IdnJCWRx-Z7Jh7JcQI90hA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">三宝垄via Plotly(图片由作者提供)</figcaption></figure><p id="8afd" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">探索愉快！但是，请注意，并非所有区域都已正确绘制，例如，对于玛琅和泗水，我仍然可以找到一些缺失区域和不正确定义的经度坐标，因此请谨慎操作:)</p></div><div class="ab cl lp lq go lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ha hb hc hd he"><p id="fc65" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">那么你觉得数据集怎么样？你能想到地图的真实使用案例吗？请随意分享你的想法。</p><p id="f7b8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注:笔记本完整版可以在<a class="ae ki" href="https://github.com/taufiqbashori/plotly_indonesia_village" rel="noopener ugc nofollow" target="_blank">这里</a>下载。此外，添加的数据框(带几何图形)的csv文件也可从<a class="ae ki" href="https://drive.google.com/drive/u/1/folders/1NDcU0_yY-ZH-IGcJqqwsvI3z6Ia7bhMN" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p></div></div>    
</body>
</html>