<html>
<head>
<title>Building Data with bricks: Microsoft Azure Databricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用砖块构建数据:微软Azure数据砖块</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-data-with-bricks-microsoft-azure-databricks-e4ed685b63c8?source=collection_archive---------14-----------------------#2021-02-11">https://medium.com/analytics-vidhya/building-data-with-bricks-microsoft-azure-databricks-e4ed685b63c8?source=collection_archive---------14-----------------------#2021-02-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9082" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">从Synapse Analytics迁移到Databricks</h2></div><p id="8ce1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们与Azure Synapse的爱情突然走到了尽头。今天我们将学习微软提供的另一项伟大的服务。<a class="ae jt" href="https://docs.microsoft.com/en-us/azure/databricks/scenarios/what-is-azure-databricks" rel="noopener ugc nofollow" target="_blank"> Databricks </a>有它的优势。因为它处理存储在诸如Azure Blob存储、Azure数据湖存储、数据仓库和数据库之类的存储库中的数据。它还支持数据流。</p><p id="d43e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从Synapse过渡到Databricks应该没什么大不了的。它提供了类似的基本功能，如接收数据、转换数据和导出完成的数据。在本文中，我们将像在<a class="ae jt" href="https://asantechild.medium.com/building-an-etl-using-azure-synapse-analytics-and-sql-pool-1-2-63da6fcf07d4" rel="noopener"> Synapse </a>中一样，在Databricks中完成一个基本的ETL过程。</p><p id="8306" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Databricks中，我们使用笔记本。Databricks在Quickstart笔记本下提供教程，为您提供应用程序的入门课程。你可以使用不同的编程语言；r，Python，Scala，Java，Spark SQL，在一个笔记本里但是在不同的单元格里。你可以通过使用<a class="ae jt" href="https://towardsdatascience.com/top-8-magic-commands-in-jupyter-notebook-c1582e813560" rel="noopener" target="_blank">魔法命令</a>在这些语言之间变戏法。</p><p id="90c9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要开始Databricks中的任务，您需要在创建新笔记本后将笔记本连接到集群。要使用的集群类型取决于您的任务要求有多高。用于机器学习的<a class="ae jt" href="https://docs.databricks.com/runtime/mlruntime.html#mlruntime" rel="noopener ugc nofollow" target="_blank"> Databricks运行时</a> (DBR 7.4ML)是一个用于为机器学习任务创建GPU集群的环境。24核168.00 GB的集群适合大数据集上的机器学习任务。其他<a class="ae jt" href="https://docs.databricks.com/runtime/index.html" rel="noopener ugc nofollow" target="_blank">选项</a>适用于不同类型的作业。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/e48a2446308b784ee272f4755b6875fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JYTR2LtcOzedVqlB"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">马特·W·纽曼在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5473" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要开始处理数据，您需要从数据源获取数据。这是<a class="ae jt" href="https://asantechild.medium.com/building-an-etl-using-azure-synapse-analytics-and-sql-pool-1-2-63da6fcf07d4#39c0" rel="noopener"> ETL过程</a>的第一部分——抽取。</p><p id="6ea5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将使用JDBC驱动程序查询数据库。JDBC的全称是Java数据库连接，Java API允许我们连接到数据库并发出查询。另一种选择是基于C的OBDC(开放式数据库连接)API。</p><p id="9e30" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要进行查询，请使用适当的凭据定义以下内容:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="9097" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的数据存储在数据库中。尤其涉及一种blob存储器。因此，要访问这个数据库，请登录到您的Azure门户，并从您的资源中找到您的Synapse工作区。在Overview选项卡中，找到您的专用SQL端点，并将其复制为您的jdbcHostname。其余的字段应该非常简单。</p><p id="ff4d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，您需要指定访问您的数据湖存储帐户的访问密钥。将箭头启用设置为真。默认情况下是禁用的。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="2271" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在笔记本中运行上述程序后，您的数据将作为Spark数据帧导入到Databricks中。阅读它的不同选项如下:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="b46f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将“Spark_dataframe”替换为要读取的Spark表的名称。</p><p id="9925" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从blob存储中加载表的另一种方法是:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="5692" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此方法显示您可以从中选择的可用文件列表。</p><blockquote class="km kn ko"><p id="a473" class="ix iy kp iz b ja jb ij jc jd je im jf kq jh ji jj kr jl jm jn ks jp jq jr js hb bi translated">不要与数据帧和表格这两个术语混淆。它们可以互换使用。然而，数据帧通常与熊猫联系在一起。</p></blockquote></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="b092" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据的转换将使用Python来完成。因此，有必要将你的Spark数据框架转换成Pandas数据框架。注意我们是如何用不同的语言操作数据的。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="e884" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从这里开始，在转换之后，你可以自由地使用Pandas来操作你的数据，以产生你想要的结果。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><p id="eebf" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过转换，任何派生表都可以保存为CSV文件。我们现在开始装货。我知道两种方法。我带你去看。</p><p id="9d43" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">1.</p><p id="4a50" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们需要将我们的熊猫数据帧转换成pyspark数据帧。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="3b87" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中，desired_csv是要转换为csv的熊猫数据帧。这将显示该表和一个用于下载所有行的导出按钮。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es la"><img src="../Images/5a4a817b6abc95d2db80a51923bdc931.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*9TPdUm8oOq6CX2DM1eC22A.png"/></div></figure><p id="635d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi">2.</p><p id="11e4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">替代方案:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="b116" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这种方法，获取csv文件需要比前者多几个步骤。要检索文件，请选择浏览窗口左侧的数据选项卡。在打开窗口的右上角，单击创建表格。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lb"><img src="../Images/e953860058adc180d4a26bfe8900604d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*Hs9J42JQ9lHAjR4HVebFZA.png"/></div></div></figure><p id="4667" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在数据源部分，选择DBFS选项。选择“文件存储”，然后选择“df”，选择您生成的csv文件，然后单击第四个“零件…”文件，如下图所示。注意，我们指定的保存文件的路径向我们展示了在数据块中定位文件的位置。".save(" dbfs:/file store/df/Name _ to _ be _ savedas . CSV ")"。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lc"><img src="../Images/2151eb71d1b27b50ab4447a301db504f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z9mOsdjAY-iwOu-aiPjDcg.png"/></div></div></figure><p id="800b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">点击您的文件后，从页面底部复制文件的路径名。</p><p id="bae5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">棘手的部分来了。振作起来。</p><p id="d3d3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将复制文本中的“/FileStore”替换为“/files”。复制新文本，并将其粘贴在浏览器搜索栏中的反斜杠之后。按回车键，你的文件会自动下载。维奥拉。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ld"><img src="../Images/9427239a580a92b01256035ec46ba7e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*yw3VltYzXyJtS5KzcdgGuA.png"/></div></div></figure><p id="4e2f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要删除csv文件，请在笔记本单元格中键入以下内容:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="05fa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所需的输出应该是“True”，表示文件已被成功删除。如果您收到一个“假”输出，这意味着该文件没有被删除。交叉检查要删除的文件的拼写，确保它存在，然后重试。在加载到blob存储时，不要保存以数值开头的表名。</p><p id="bfab" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇<a class="ae jt" href="https://towardsdatascience.com/databricks-how-to-save-files-in-csv-on-your-local-computer-3d0c70e6a9ab" rel="noopener" target="_blank">文章</a>帮助我学会了如何保存和删除csv文件。去看看另一个新鲜的视角。</p></div><div class="ab cl kt ku gp kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hb hc hd he hf"><h2 id="ddd6" class="le lf hi bd lg lh li lj lk ll lm ln lo jg lp lq lr jk ls lt lu jo lv lw lx ly bi translated">数据块的不好之处在于:</h2><ul class=""><li id="eb16" class="lz ma hi iz b ja mb jd mc jg md jk me jo mf js mg mh mi mj bi translated">在Synapse Analytics中，您可以在一个Synapse浏览器选项卡中打开多个笔记本选项卡。然而，在Databricks中，要同时打开多个笔记本，你必须在浏览窗口中打开多个浏览器标签。</li><li id="ef33" class="lz ma hi iz b ja mk jd ml jg mm jk mn jo mo js mg mh mi mj bi translated">如上所述，根据所使用的方法，在Databricks中下载csv文件可能会很繁琐。</li><li id="9206" class="lz ma hi iz b ja mk jd ml jg mm jk mn jo mo js mg mh mi mj bi translated">Databricks对笔记本中运行的单元数量有限制。超过100个电池会影响笔记本电脑的性能。</li><li id="927a" class="lz ma hi iz b ja mk jd ml jg mm jk mn jo mo js mg mh mi mj bi translated">没有互联网接入，数据块就无法运行。</li></ul><p id="c752" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你看到我是如何直接从我的<a class="ae jt" href="https://github.com/OtemaY" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中整合代码的了吗，我最近学会了怎么做。我学会了如何<a class="ae jt" rel="noopener" href="/@aryamurali/embed-code-in-medium-e95b839cfdda">嵌入代码</a>。我还学会了如何跳转到一个网页的特定部分。耶我！</p></div></div>    
</body>
</html>