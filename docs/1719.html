<html>
<head>
<title>March Madness 2021: Simulating a Bracket, Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2021年疯狂三月:模拟支架，第3部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/march-madness-2021-simulating-a-bracket-part-3-354e2285419c?source=collection_archive---------22-----------------------#2021-03-14">https://medium.com/analytics-vidhya/march-madness-2021-simulating-a-bracket-part-3-354e2285419c?source=collection_archive---------22-----------------------#2021-03-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5d86d170201ec94181e815791436ebbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CroJx4_8UwFulbuMi_TSA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">办公室里的括号来自最近的三月疯狂(2019)。</figcaption></figure><p id="4344" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">欢迎学习第3部分！如果你错过了第1部分和第2部分，你可以从这里开始:</p><div class="jr js ez fb jt ju"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/march-madness-2021-simulating-a-bracket-part-1-7aa1cad69a65"><div class="jv ab dw"><div class="jw ab jx cl cj jy"><h2 class="bd hi fi z dy jz ea eb ka ed ef hg bi translated">2021年疯狂三月:模拟支架，第1部分</h2><div class="kb l"><h3 class="bd b fi z dy jz ea eb ka ed ef dx translated">在实际工作和这个项目工作之间的最后几周，我一直很安静…我很兴奋终于…</h3></div><div class="kc l"><p class="bd b fp z dy jz ea eb ka ed ef dx translated">medium.com</p></div></div><div class="kd l"><div class="ke l kf kg kh kd ki in ju"/></div></div></a></div><p id="0e98" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在本系列的最后一集，我将介绍我在MongoDB免费层中遇到的存储限制，以及我实现的小技巧，以便最终用户仍然可以看到他们模拟范围内每场游戏的完整模拟分数。</p><h1 id="d7c7" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">如何存储超过2，000，000个篮球比赛模拟</h1><p id="52fb" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">在第1部分中，我提到我们需要做一点2M模拟，为68支球队参加的NCAA篮球锦标赛中的每一场比赛进行1000次测试。可以想象这会占用很多空间！这个项目的原始条件之一是使用我已经在工作的网站API，位于api.tarpey.dev，它使用了一个512MB存储空间的免费层MongoDB。</p><p id="faa9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我有一个雄心勃勃的想法，为每个模拟保存每个玩家的个人数据，这样最终用户可以按需查看。但毫无疑问，这最终将我置于需要10GB以上存储的世界中MongoDB Atlas自由层仅允许512MB！看起来我不得不放弃个人球员统计的梦想…直到我想出了另一种方法。</p><figure class="lo lp lq lr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/cccf0dc5259c4d12ac53e71540ab6808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXs_snkpD8GBRGf1hNB6Vw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">今年三月疯狂模式首页截图。</figcaption></figure><p id="b821" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">最终用户可以从四种“口味”的支架中进行选择，从<strong class="iv hi">香草</strong>(将在每1000个模拟的中间值附近建立一个游戏支架)到<strong class="iv hi"> MAX SPICE </strong>(可以在支架的任何节点选择1000个模拟中的任何一个)。我们可以这样做，而不是为每场比赛保存1000个模拟的整个池:</p><ul class=""><li id="f727" class="ls lt hh iv b iw ix ja jb je lu ji lv jm lw jq lx ly lz ma bi translated">将足够的模拟保存到数据库中(大约20个)，这样我们在每个分位数中至少有一些不同的盒子分数可供选择。</li><li id="fa3f" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">在扔掉其他980模拟之前，用它们来建立一个发行信息的补充文档。这个文档可以查看1000个模拟，并说“如果用户选择轻度，X队有35%的机会获胜，Y队有65%。”对每种口味和比赛重复以上步骤。</li><li id="14d3" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">这些补充文档还可以保存有资格为每种口味选择的分数范围(例如，如果用户希望看到两个势均力敌的球队X对Y的温和方框分数，也许我们应该返回一个模拟，其中最终的胜利差额在-3到+3分之间……但是如果用户希望看到X对Y的辛辣方框分数，我们可以使用一个模拟，其中胜利差额在-40到+40分之间的任何地方！)</li></ul><p id="f1fc" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">以下是其中一个“补充文档”的示例:</p><figure class="lo lp lq lr fd ii"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="2dbd" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">保存所有这些信息后，我们可以:</p><ul class=""><li id="0675" class="ls lt hh iv b iw ix ja jb je lu ji lv jm lw jq lx ly lz ma bi translated">使用“home_win_chance”字段(基于所有1，000次模拟)来决定当用户请求一个支架时哪个队在运行时赢得每场比赛</li><li id="ad15" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">使用“margin_top”和“margin_bottom”字段来查询数据库，并为括号中的67场比赛中的每场比赛确定有效的盒子分数</li><li id="a5cb" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">扔掉其他980模拟，省一堆空间！(虽然我很想对全部1，000个…或更多…进行更多分析，但我们会把这些留到明年！)</li></ul><p id="cf7b" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">构建一个只接触数据库一次的查询来检索67场不同比赛的比分是非常复杂的，但是我不能推荐足够的<a class="ae lm" href="https://art049.github.io/odmantic/" rel="noopener ugc nofollow" target="_blank"> ODMantic </a>包来在异步、ODM的基础上使用MongoDB它使事情变得容易得多！<a class="ae lm" href="https://miketarpey.medium.com/multiple-filter-search-functionality-using-odmantic-fastapi-and-list-unpacking-2f56245233fe" rel="noopener">我在之前的文章</a>中提到过这样做，我使用了类似的方法来查询用户分类中的所有框分数。完整的代码可以在<a class="ae lm" href="https://github.com/AnnuityDew/api-tarpeydev/blob/master/src/api/autobracket.py" rel="noopener ugc nofollow" target="_blank">我的GitHub repo </a>中找到。</p><h1 id="02ce" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">最终模型</h1><p id="baf2" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">最后，相对于我们在第1部分中的目标，下面是今年的模型是如何结束的:</p><ul class=""><li id="0976" class="ls lt hh iv b iw ix ja jb je lu ji lv jm lw jq lx ly lz ma bi translated"><strong class="iv hi">我想用Python写代码，这样我就可以在我目前位于</strong><a class="ae lm" href="https://tarpey.dev/autobracket" rel="noopener ugc nofollow" target="_blank"><strong class="iv hi">tarpey.dev/autobracket</strong></a><strong class="iv hi">的网站上轻松实现这个新模型。</strong>最终，我将网站的前端和后端分离开来，创造了一个更好的界面。驱动模型的所有Python现在都在<a class="ae lm" href="https://api.tarpey.dev" rel="noopener ugc nofollow" target="_blank"> api.tarpey.dev </a>中，而<a class="ae lm" href="https://tarpey.dev" rel="noopener ugc nofollow" target="_blank"> tarpey.dev </a>中的前端现在正在用React和<a class="ae lm" href="https://nextjs.org" rel="noopener ugc nofollow" target="_blank"> Next.js </a>进行重建(到目前为止我真的很喜欢它！).</li><li id="f208" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">我想创建一个足够真实的模型，足以模拟真实的篮球比赛。你可以对此作出判断，但我真的很喜欢目前为止我从括号中得到的结果！它们是预期结果和可能发生的意外的完美结合，所以我认为我们已经很好地把握了三月的魔力。</li><li id="a658" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">我想在额外的复杂性可能不会对结果产生真正影响的地方做出简化的假设。任务完成(我们留下了明年改进的空间)。</li><li id="11a0" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated">我想让现实的盒子分数从模型中“掉出来”。这里唯一让我犹豫的是，一些异常值比我希望的要少一些……明年模型的后续工作将是稍微“缩小”结果的分布。一般来说，我认为“中等”风格(使用分布中中间80%的模拟)是您使用模型的最佳时机！</li><li id="1ea4" class="ls lt hh iv b iw mb ja mc je md ji me jm mf jq lx ly lz ma bi translated"><strong class="iv hi">我需要能够运行一系列模拟。</strong>任务完成，注意！尽管实现并行运行模拟的NumPy数组带来了惊人的性能提升，但我认为我传递数据的方式本可以更高效。(我还没有提到这一点，但我使用Google Cloud Tasks对今年所有的模拟进行了排队，并将其发送到Google Cloud Run的API进行处理……这可能是未来帖子的一个好主题！)</li></ul><h1 id="9f17" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">那么，我现在可以做一个支架吗？</h1><p id="1d9b" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">从3月15日开始(选择日之后的星期一早上)，您将能够根据我的模型生成有效的支架！只需访问下面的链接，并尽可能多的括号。如果你遇到任何错误或问题，请随时联系我。</p><div class="jr js ez fb jt ju"><a href="https://tarpey.dev/autobracket" rel="noopener  ugc nofollow" target="_blank"><div class="jv ab dw"><div class="jw ab jx cl cj jy"><h2 class="bd hi fi z dy jz ea eb ka ed ef hg bi translated">汽车球拍</h2><div class="kb l"><h3 class="bd b fi z dy jz ea eb ka ed ef dx translated">2021年疯狂三月自动支架发电机。要了解有关此应用程序的更多信息，请单击下面的部分。方法…</h3></div><div class="kc l"><p class="bd b fp z dy jz ea eb ka ed ef dx translated">tarpey.dev</p></div></div></div></a></div><p id="560c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我将收集每个支架的数据，一旦今年的三月疯狂尘埃落定，我希望做一些分析，看看模型的表现如何。敬请关注…</p><p id="f8f7" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">感谢阅读(并检查了我的模型)！一如既往，请随意分享您的想法、问题和建议。</p></div></div>    
</body>
</html>