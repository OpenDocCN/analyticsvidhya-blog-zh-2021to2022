<html>
<head>
<title>Master InfluxDB: Querying Influx Data as Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Master InfluxDB:以Excel形式查询流入数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/master-influxdb-querying-influx-data-as-excel-80a0ccb427b8?source=collection_archive---------7-----------------------#2021-03-29">https://medium.com/analytics-vidhya/master-influxdb-querying-influx-data-as-excel-80a0ccb427b8?source=collection_archive---------7-----------------------#2021-03-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="if ig ez fb ih ii"><a href="https://levelup.gitconnected.com/master-influxdb-setting-up-a-plugin-dfb58adcbd15" rel="noopener  ugc nofollow" target="_blank"><div class="ij ab dw"><div class="ik ab il cl cj im"><h2 class="bd hj fi z dy in ea eb io ed ef hh bi translated">主InfluxDB:设置插件</h2><div class="ip l"><h3 class="bd b fi z dy in ea eb io ed ef dx translated">如果你还没有看过我介绍时间序列和InfluxDB的博客，这里是为了让你更好地了解…</h3></div><div class="iq l"><p class="bd b fp z dy in ea eb io ed ef dx translated">levelup.gitconnected.com</p></div></div><div class="ir l"><div class="is l it iu iv ir iw ix ii"/></div></div></a></div><blockquote class="iy iz ja"><p id="c087" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">难度:中等</p><p id="bc8d" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">工具:Node.js，JavaScript，InfluxDB，Grafana，Telegraf</p></blockquote><p id="d81b" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">这是我掌握InfluxDB和时序数据库系列的第三篇文章。如果你还没有，你可以通过上面链接到我以前的文章来查看它们。</p><p id="5222" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">在处理流入数据时，如果只需点击一下就可以将数据下载为excel格式，那就太方便了。如果你很想创建一个web服务器，在那里你可以输入你的流量查询，并通过输入一个流量查询创建一个excel表格，那就留下来吧！我们将只使用InfluxDB和Telegram来收集和发送数据。如果您想从仪表板重定向用户，Grafana是可选的。Node.js将帮助我们创建web服务器，这非常重要。让我们开始吧。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es kd"><img src="../Images/270aa33e93da11da5f5b0e003405333a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LymrPAE3Ow5dBgmsgMpiAQ.gif"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated">资料来源:Fathima Maha</figcaption></figure></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="108b" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">我介绍了TICK Stack，即tele graf-influx db-chrono graf-kapa citor。但是在这个实用程序中，我们将考虑用Grafana替换Chronograf。Grafana像Chronograf一样是一个可视化应用程序，可以从InfluxDB接收数据，并在查看数据时给我们更多的自由。在仪表板上嵌入链接就是其中之一，而且由于这是一个web服务器，它对我们来说是一个非常有用的工具。</p><p id="9899" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">要安装Grafana，前往<a class="ae kz" href="https://grafana.com/docs/grafana/latest/" rel="noopener ugc nofollow" target="_blank">https://grafana.com/docs/grafana/latest/</a>。将它安装在您的系统上，并转到<a class="ae kz" href="https://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>或https://&lt;IP address&gt;:3000/，选择源作为InfluxDB，并使用具有所有访问权限的API令牌连接到您的InfluxDB服务器。通过输入您想要查看的仪表盘的flux查询(您也可以从Chronograf复制),您将能够在Grafana上看到您的仪表盘。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="0d7a" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">现在我们已经完成了Grafana，让我们设置节点环境。</p><ol class=""><li id="3238" class="la lb hi je b jf jg jj jk ka lc kb ld kc le jz lf lg lh li bi translated">在计算机上安装Node.js。</li></ol><p id="63e7" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">2.为你的工作建立一个新的目录。</p><p id="46db" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">3.通过目录中的命令初始化项目:<code class="du lj lk ll lm b">npm init</code></p><p id="544e" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">这将创建一个package.json文件，在该文件中我们可以看到项目的依赖项。</p><p id="3193" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">4.为我们的项目安装依赖项:</p><blockquote class="iy iz ja"><p id="1cf1" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">influxdb-client:用于从influxdb中检索数据</p><p id="7988" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">exceljs:创建excel工作簿并添加数据</p><p id="1e84" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">express:node . js后端web应用程序框架</p><p id="975f" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">ejs:node . js和express的模板引擎，呈现HTML，并使之有可能处理从服务器返回的条件和访问变量</p><p id="b622" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hb bi translated">body-parser:从web服务器检索post请求数据</p></blockquote><p id="09cf" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated"><strong class="je hj">行话:</strong></p><ol class=""><li id="6c31" class="la lb hi je b jf jg jj jk ka lc kb ld kc le jz lf lg lh li bi translated">post请求是web服务器从用户那里得到的东西，在我们的例子中，我们将在我们的网站上输入一个查询，服务器将检索它。</li><li id="b867" class="la lb hi je b jf ln jj lo ka lp kb lq kc lr jz lf lg lh li bi translated">一个web框架只是一个开发网站的平台，在我们的例子中，我们将使用服务器作为你自己的笔记本电脑来托管网站。要注意的一点是，这个网站只能在你的电脑上访问，任何人都可以访问，它必须托管在云平台上。</li></ol><p id="26e6" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">要安装这些依赖项，请在工作目录中逐一运行这些命令:</p><pre class="ke kf kg kh fd ls lm lt lu aw lv bi"><span id="7524" class="lw lx hi lm b fi ly lz l ma mb">npm install --save @influxdata/influxdb-client<br/>npm install exceljs<br/>npm install express --save<br/>npm install ejs<br/>npm install body-parser</span></pre><p id="ff6e" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">5.为了您的方便，您刚刚创建的目录中应该包含的文件和代码在我的Github上。</p><p id="64d0" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">将<em class="jd"> main_dir </em>中的文件下载到您位于https://github.com/fathimamaha/InfluxtoExcel<a class="ae kz" href="https://github.com/fathimamaha/InfluxtoExcel" rel="noopener ugc nofollow" target="_blank">的目录下</a></p><p id="7ac0" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">由于这是一个快速教程，我将跳过文件的逻辑和代码。</p><p id="8ef9" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">我为熟悉Node.js和JavaScript的人附上index.js文件:</p><figure class="ke kf kg kh fd ki"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="ko kp et er es kq kr bd b be z dx translated">index.js文件</figcaption></figure><p id="1478" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">您的目录现在应该如下所示:</p><pre class="ke kf kg kh fd ls lm lt lu aw lv bi"><span id="7a24" class="lw lx hi lm b fi ly lz l ma mb">↓ main_dir</span><span id="5f61" class="lw lx hi lm b fi me lz l ma mb">|_package.json</span><span id="81cc" class="lw lx hi lm b fi me lz l ma mb">|_package-lock.json</span><span id="1a4a" class="lw lx hi lm b fi me lz l ma mb">|_env.js</span><span id="6319" class="lw lx hi lm b fi me lz l ma mb">|_index.js</span><span id="7c64" class="lw lx hi lm b fi me lz l ma mb">|_↓ views</span><span id="714c" class="lw lx hi lm b fi me lz l ma mb">   |_index.ejs</span><span id="aa02" class="lw lx hi lm b fi me lz l ma mb">|_&gt;node_modules</span></pre><p id="f1cc" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">6.将env.js中的变量更改为InfluxDB变量。</p><p id="e3fc" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">7.最后，在您的终端上，打开工作目录并键入，</p><pre class="ke kf kg kh fd ls lm lt lu aw lv bi"><span id="3123" class="lw lx hi lm b fi ly lz l ma mb">node index.js</span></pre><p id="9961" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">web服务器将运行在<a class="ae kz" href="http://localhost:4000/download" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/download</a>或https:&lt;IP address&gt;:4000/download。在我们工作时保持它运行，如果有任何错误，控制台将记录它。</p><p id="8d40" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">唷！我们快到了。</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div class="er es mf"><img src="../Images/f17ed4ba636d02508376d3243d04c0c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*iMMYpQ5J-lt8rGCm.gif"/></div></figure><p id="14c0" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">8.前往您的Grafana仪表板。</p><p id="381e" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">转到仪表板设置&gt;链接&gt;新建。</p><p id="0b77" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">放入类型: '链接'，标题:<name of="" your="" choice="" for="" the="" link="">(如:' Excel ')，图标:<icon of="" your="" choice="" for="" the="" link="">(如:' doc ')，Url:'<a class="ae kz" href="http://localhost:4000/download" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/download</a>或https:&lt;IP address&gt;:4000/download '。将“在选项卡中打开”选项切换到“开”。</icon></name></p><p id="3eb2" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">保存仪表板后，您将能够看到一个带有您的标题的小图标，点击它会将您重定向到我们的web服务器。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><p id="52bc" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">最后，我们有了它，gif展示了你如何快速得到一个excel工作簿来处理你所有的flux查询！</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es mg"><img src="../Images/bf281956cd23d430e4d5179a22e2fa7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Pg1Gk3mfF9xuA-RTBFeXFg.gif"/></div></div><figcaption class="ko kp et er es kq kr bd b be z dx translated">资料来源:Fathima Maha</figcaption></figure><p id="1d05" class="pw-post-body-paragraph jb jc hi je b jf jg jh ji jj jk jl jm ka jo jp jq kb js jt ju kc jw jx jy jz hb bi translated">如果你遇到任何错误，请发表评论。再见👾</p></div></div>    
</body>
</html>