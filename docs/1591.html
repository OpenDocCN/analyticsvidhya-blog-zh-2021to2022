<html>
<head>
<title>Top 3 tips to debug your code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试代码的三大技巧</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/top-3-tips-to-debug-your-code-179448cb9661?source=collection_archive---------20-----------------------#2021-03-08">https://medium.com/analytics-vidhya/top-3-tips-to-debug-your-code-179448cb9661?source=collection_archive---------20-----------------------#2021-03-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div class="er es hf"><img src="../Images/5854f8943fa6b52d7bfc7846492a80dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*ePYqdT_0GPDwXKvx.jpg"/></div></figure><div class=""/><p id="6509" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">你好，你好，我的工程师同事们！</p><p id="03e9" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我最近花了很多时间做这件事，所以今天我想谈谈我用来帮助我调试的一些工具。</p><p id="04e7" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们都经历过，我们写了一些代码，我们认为我们已经用单元测试和集成测试覆盖了每一个用例，每一个边缘用例。但不幸的是，一只虫子溜了进来。</p><p id="3a49" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hp"> <em class="jj">有趣的事实:</em></strong>“Bug”和“debugging”这两个术语是格蕾丝·赫柏上将在哈佛大学研究马克2号计算机时创造的，当时她在一个继电器中发现了一只飞蛾。他们说他们正在“调试”系统。</p><p id="d399" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，在你把你的错误追溯粘贴到谷歌之前，让我们花点时间来看一下我的第一个提示，最常见的错误…</p><h2 id="2e84" class="jk jl ho bd jm jn jo jp jq jr js jt ju iw jv jw jx ja jy jz ka je kb kc kd ke bi translated">打字稿</h2><p id="121f" class="pw-post-body-paragraph il im ho in b io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je kj jg jh ji ha bi translated">如果你没有因为打字错误而出错，你就是一个谜，你应该同时运行亚马逊、谷歌、脸书和网飞。</p><p id="4769" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这似乎微不足道，你可能会想“亚历克斯，这是显而易见的…”</p><p id="1d88" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我无法告诉你有多少次因为一个打字错误，我的头撞到了墙上。但是，唉，这是我们作为软件工程师在调试时经常忽略的第一件事。所以在变成爱丽丝和跳进兔子洞之前，帮你自己一个忙…检查一下拼写错误。</p><p id="8fbd" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">下一个顶部提示…</p><h2 id="faf8" class="jk jl ho bd jm jn jo jp jq jr js jt ju iw jv jw jx ja jy jz ka je kb kc kd ke bi translated">断点</h2><p id="fa0f" class="pw-post-body-paragraph il im ho in b io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je kj jg jh ji ha bi translated">在出现错误的地方设置断点可能是最常见的调试方式。这可能非常强大，因为您可以在导致错误的环境中使用系统执行代码。</p><p id="b63a" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">大多数IDE都有调试功能。我每天都用PyCharm编码。在PyCharm中你只需点击你想要设置红色断点的代码行，然后你就可以在调试模式下运行程序，见下图:</p><figure class="kl km kn ko fd hj er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es kk"><img src="../Images/bd184905bcc48b4b4b45d81e2749cf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6sgX08ZgosPhEN_09_CVw.png"/></div></div></figure><p id="df81" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Python 3.7有一个叫<code class="du kt ku kv kw b">breakpoint()</code>的内置，可以使用。只需在代码中您想要暂停程序执行的那一行设置该值，并再次以调试模式运行代码:</p><figure class="kl km kn ko fd hj er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es kx"><img src="../Images/6bbb06cd05804f57dfc00f64a68d34dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tbms4Hzwp15-97O8eD0uVA.png"/></div></div></figure><p id="9a51" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">PyCharm甚至突出显示了断点时当前设置的变量值。</p><p id="7c3e" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后，您可以通过高亮显示行并右键单击来计算表达式，从而执行代码，如下所示:</p><figure class="kl km kn ko fd hj er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ky"><img src="../Images/a97b9077a8370e9e17a3c8e47c5a1038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWbSItnrZ19PcnyHvrYBKQ.png"/></div></div></figure><p id="1a9a" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在这里，您可以执行突出显示的行，或者您喜欢的任何其他代码:</p><figure class="kl km kn ko fd hj er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es kz"><img src="../Images/9f60b67d6de9612ca922a375c48f09c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3M19OofMsBD4g-XgpZe1aQ.png"/></div></div></figure><p id="2269" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这样我们就可以解决这个问题了。</p><h2 id="8690" class="jk jl ho bd jm jn jo jp jq jr js jt ju iw jv jw jx ja jy jz ka je kb kc kd ke bi translated">记录</h2><p id="8510" class="pw-post-body-paragraph il im ho in b io kf iq ir is kg iu iv iw kh iy iz ja ki jc jd je kj jg jh ji ha bi translated">可能是最重要的提示…</p><p id="2e56" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你还在使用<code class="du kt ku kv kw b">print()</code>进行调试，你需要照照镜子，给自己一个耳光。</p><p id="b2e4" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">日志记录是软件开发的重要部分。如果你对它不熟悉，可以把它想象成你的代码的故事讲述设备。一步一步地，你应该记录下关于代码进度的重要信息。</p><p id="7c0c" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当您的代码运行一个函数、存储一些数据、向队列系统添加一条消息时，应该会写入一个日志。</p><p id="f625" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们通过一个例子来讨论这个问题。</p><p id="f817" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">假设我们有一个包含4个功能的系统。函数A、函数B、函数C和函数D。A、B和C都在系统中运行不同的进程，函数D是将它们链接在一起的主要函数，如下所示(用Python编写，但可以是任何代码):</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="0a59" class="jk jl ho kw b fi le lf l lg lh"><em class="jj">"""Example program"""</em></span><span id="b9dc" class="jk jl ho kw b fi li lf l lg lh">from typing import List</span><span id="3941" class="jk jl ho kw b fi li lf l lg lh">LIST_ITEMS = [1, 2, 3, "a", 1, 2]<br/><br/>LIST_TO_INDEX = [1, 2, 3, 4, 5, 6]<br/><br/><br/>def function_a(index_a: int) -&gt; int:<br/>    <em class="jj">"""Do something"""<br/>    </em>return LIST_TO_INDEX[index_a]<br/><br/><br/>def function_b(input_b: int) -&gt; int:<br/>    <em class="jj">"""Do something"""<br/>    </em>return input_b + 2<br/><br/><br/>def function_c(input_c: int) -&gt; int:<br/>    <em class="jj">"""Do something"""<br/>    </em>return input_c + 3<br/><br/><br/>def function_d() -&gt; List:<br/>    results = []<br/>    for i in LIST_ITEMS:<br/>        input_d = function_a(index_a=i)<br/>        input_d = function_b(input_b=input_d)<br/>        input_d = function_c(input_c=input_d)<br/>        results.append(input_d)    <br/>    return results<br/><br/><br/>output = function_d()</span></pre><p id="0cea" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">上面的脚本运行了一个索引列表，并使用它们对函数a中的不同列表进行索引。然后，结果被传递给函数B，并为其加2，结果被传递给函数C，并为其加3。</p><p id="3a16" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果您运行以上脚本，您将获得以下输出:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="d834" class="jk jl ho kw b fi le lf l lg lh">Traceback (most recent call last):<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 35, in &lt;module&gt;<br/>    output = function_d(input_d=2)<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 29, in function_d<br/>    input_d = function_a(index_a=i)<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 14, in function_a<br/>    return LIST_TO_INDEX[index_a]<br/>TypeError: list indices must be integers or slices, not str</span><span id="5ffb" class="jk jl ho kw b fi li lf l lg lh">Process finished with exit code 1</span></pre><p id="7a60" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在这个非常简单的例子中，我们可以看到列表中的<code class="du kt ku kv kw b">a</code>导致了错误。但是让我们想象这个列表有几百万个数据点长，函数和程序要复杂得多。你已经可以看到这可能有点难以确定。</p><p id="4308" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">日志可以帮助我们隔离我们正在搜索的区域，就像一个过滤器，这样我们就可以看到代码在错误发生之前运行到了哪里。</p><p id="cdd5" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于一些适当放置的日志，我们得到以下代码:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="4558" class="jk jl ho kw b fi le lf l lg lh"><em class="jj">"""Example program"""<br/><br/></em>import logging<br/>from typing import List<br/><br/>logging.basicConfig(level="INFO")<br/>LOGGER = logging.getLogger(__name__)<br/><br/><br/>LIST_ITEMS = [<br/>    1, 2, 3, "a", 1, 2,<br/>]<br/><br/>LIST_TO_INDEX = [<br/>    1, 2, 3, 4, 5, 6,<br/>]<br/><br/><br/>def function_a(index_a: int) -&gt; int:<br/>    <em class="jj">"""Do something"""<br/>    </em>return LIST_TO_INDEX[index_a]<br/><br/><br/>def function_b(input_b: int) -&gt; int:<br/>    <em class="jj">"""Do something"""<br/>    </em>return input_b + 2<br/><br/><br/>def function_c(input_c: int) -&gt; int:<br/>    <em class="jj">"""Do something"""<br/>    </em>return input_c + 3<br/><br/><br/>def function_d() -&gt; List:<br/>    <em class="jj">"""Chain functions"""<br/>    </em>LOGGER.info("Starting Program...")<br/><br/>    results = []<br/>    for i in LIST_ITEMS:<br/>        LOGGER.info(f"Index to be processed: {i}")<br/><br/>        LOGGER.info("Running Function A")<br/>        input_d = function_a(index_a=i)<br/><br/>        LOGGER.info(f"Running Function B with input: {input_d}")<br/>        input_d = function_b(input_b=input_d)<br/><br/>        LOGGER.info(f"Running Function C with input: {input_d}")<br/>        input_d = function_c(input_c=input_d)<br/><br/>        results.append(input_d)<br/><br/>    LOGGER.info(f"Program finished, results: {results}")<br/><br/>    return results<br/><br/><br/>output = function_d()</span></pre><p id="2184" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果我们运行这段代码，控制台会得到以下输出:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="08f6" class="jk jl ho kw b fi le lf l lg lh">INFO:__main__:Starting Program...<br/>INFO:__main__:Index to be processed: 1<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 2<br/>INFO:__main__:Running Function C with input: 4<br/>INFO:__main__:Index to be processed: 2<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 3<br/>INFO:__main__:Running Function C with input: 5<br/>INFO:__main__:Index to be processed: 3<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 4<br/>INFO:__main__:Running Function C with input: 6<br/>INFO:__main__:Index to be processed: a<br/>INFO:__main__:Running Function A<br/>Traceback (most recent call last):<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 58, in &lt;module&gt;<br/>    output = function_d()<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 43, in function_d<br/>    input_d = function_a(index_a=i)<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 21, in function_a<br/>    return LIST_TO_INDEX[index_a]<br/>TypeError: list indices must be integers or slices, not str</span><span id="e326" class="jk jl ho kw b fi li lf l lg lh">Process finished with exit code 1</span></pre><p id="02f9" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这里我们注销程序启动，当函数A、B和C运行时，我们可以看到索引<code class="du kt ku kv kw b">1</code>、<code class="du kt ku kv kw b">2</code>和<code class="du kt ku kv kw b">3</code>运行正常。那么当<code class="du kt ku kv kw b">a</code>是要处理的指标时。我们得到一个失败，所以我们可以看到这是错误的直接原因。</p><p id="5cf0" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">有时，您可能在测试环境中一切都运行得非常好，但是生产环境是不同的动物。对于大量的实际数据，可能会出现意外错误，有时您可能希望记录与原因相关的数据。然而，我们不想无限期地这样做。这是您可以利用日志记录级别的地方。</p><p id="da61" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果我们改变下面一行:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="02b7" class="jk jl ho kw b fi le lf l lg lh">LOGGER.info(f"Index to be processed: {i}")</span></pre><p id="8282" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">收件人:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="7855" class="jk jl ho kw b fi le lf l lg lh">LOGGER.debug(f"Index to be processed: {i}")</span></pre><p id="cad9" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后再次运行该程序，您将得到输出:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="3318" class="jk jl ho kw b fi le lf l lg lh">INFO:__main__:Starting Program...<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 2<br/>INFO:__main__:Running Function C with input: 4<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 3<br/>INFO:__main__:Running Function C with input: 5<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 4<br/>INFO:__main__:Running Function C with input: 6<br/>INFO:__main__:Running Function A<br/>Traceback (most recent call last):<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 58, in &lt;module&gt;<br/>    output = function_d()<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 43, in function_d<br/>    input_d = function_a(index_a=i)<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 21, in function_a<br/>    return LIST_TO_INDEX[index_a]<br/>TypeError: list indices must be integers or slices, not str</span></pre><p id="c33a" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这将删除日志中正在处理的索引值。实际上，这可能是您不希望无限输出的真实数据。但是，您可以将日志级别设置为<code class="du kt ku kv kw b">DEBUG</code>来输出它们。</p><p id="b937" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">更改以下行:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="73be" class="jk jl ho kw b fi le lf l lg lh">logging.basicConfig(level="INFO")</span></pre><p id="0964" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">收件人:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="1f72" class="jk jl ho kw b fi le lf l lg lh">logging.basicConfig(level="DEBUG")</span></pre><p id="be06" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后再次运行该程序，您将得到以下输出:</p><pre class="kl km kn ko fd la kw lb lc aw ld bi"><span id="b180" class="jk jl ho kw b fi le lf l lg lh">INFO:__main__:Starting Program...<br/>DEBUG:__main__:Index to be processed: 1<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 2<br/>INFO:__main__:Running Function C with input: 4<br/>DEBUG:__main__:Index to be processed: 2<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 3<br/>INFO:__main__:Running Function C with input: 5<br/>DEBUG:__main__:Index to be processed: 3<br/>INFO:__main__:Running Function A<br/>INFO:__main__:Running Function B with input: 4<br/>INFO:__main__:Running Function C with input: 6<br/>DEBUG:__main__:Index to be processed: a<br/>INFO:__main__:Running Function A<br/>Traceback (most recent call last):<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 58, in &lt;module&gt;<br/>    output = function_d()<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 43, in function_d<br/>    input_d = function_a(index_a=i)<br/>  File "/Users/alex/PycharmProjects/bug_tips/example_program.py", line 21, in function_a<br/>    return LIST_TO_INDEX[index_a]<br/>TypeError: list indices must be integers or slices, not str</span><span id="5725" class="jk jl ho kw b fi li lf l lg lh">Process finished with exit code 1</span></pre><p id="e5c7" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">注意，包含索引(要处理的数据)的行现在是一个<code class="du kt ku kv kw b">DEBUG</code>日志。如果您想关注代码的不稳定版本，这是很有帮助的。当您需要查看数据时，您可以将日志级别设置为<code class="du kt ku kv kw b">DEBUG</code>，然后在您对日志进行分析后，将其改回<code class="du kt ku kv kw b">INFO</code>。好的、放置得当的日志是软件开发中最有用的工具之一。</p><p id="d4ad" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我希望这些建议对你有用，任何问题都可以留下评论！</p></div></div>    
</body>
</html>