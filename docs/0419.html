<html>
<head>
<title>Solution to TensorFlow 2 not using GPU</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow 2不使用GPU的解决方案</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/solution-to-tensorflow-2-not-using-gpu-119fb3e04daa?source=collection_archive---------0-----------------------#2021-01-16">https://medium.com/analytics-vidhya/solution-to-tensorflow-2-not-using-gpu-119fb3e04daa?source=collection_archive---------0-----------------------#2021-01-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0354" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">让TensorFlow 2代码或Keras代码在GPU上运行</h2></div><p id="6cc0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文通过解决<em class="jt">原因</em>和<em class="jt">调试/求解过程</em>来解决tensorflow 2 (tf2)不使用GPU的问题。可能有其他的解决方法，但是我现在公布的是对我一直有效的解决方法。所以让我们开始吧。</p><p id="ca97" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可能已经运行了以下命令，并希望它下载所有的依赖项，以便在GPU上运行。问题是，它没有，因此我们面临的GPU兼容性问题。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es ju"><img src="../Images/b3dbac3001e717e5639b217bba1a0fbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*ERZJE-M2oc-HMHtJPEDmDA.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated"><a class="ae kg" href="https://www.tensorflow.org/install" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><h1 id="5c6d" class="kh ki hi bd kj kk kl km kn ko kp kq kr io ks ip kt ir ku is kv iu kw iv kx ky bi translated">解决此问题的主要步骤:</h1><blockquote class="kz la lb"><p id="bbfe" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">I .确定张量流是否能够看到GPU</p><p id="caac" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">二。查看您的环境中是否安装了cudnn和cudatoolkit</p><p id="4ea9" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">三。验证是否安装了正确版本的cudnn和cudatoolkit</p><p id="d5b1" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">四。在安装tensorflow之前，请安装正确版本的cudnn和cudatoolkit</p><p id="6c6b" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">动词 （verb的缩写）使用命令“pip install tensorflow-gpu”而不是“pip install tensorflow”</p><p id="8bab" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">不及物动词验证新安装的tensorflow是否在检测GPU</p></blockquote><blockquote class="lf"><p id="0858" class="lg lh hi bd li lj lk ll lm ln lo js dx translated">重要提示:安装顺序很重要。</p><p id="7c96" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">假设:</p><p id="7899" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">1.你用的是nvidia-gpu</p><p id="cdd1" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">2.您正在使用conda环境(Anaconda)</p></blockquote><h1 id="3d27" class="kh ki hi bd kj kk kl km kn ko kp kq kr io lu ip kt ir lv is kv iu lw iv kx ky bi translated"><strong class="ak">第一步:</strong>确定张量流是否能够看到GPU</h1><p id="ad3f" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">命令:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mc"><img src="../Images/39b6801964410b558d92bfd22d5a31eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*5fQVqmsm91hKqByLsoYb9w.png"/></div></figure><p id="3945" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es md"><img src="../Images/c53dbf7a75347a54b56a7bdeb2fca527.png" data-original-src="https://miro.medium.com/v2/resize:fit:108/format:webp/1*eSH7FL7RCQb9gOY-Piy4Qg.png"/></div></figure><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es me"><img src="../Images/422fc5121b0decbe5737eabf6c802784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*JWPBqTa4eSh28LfcP7QrCg.png"/></div></figure><p id="1aa9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">如果tensorflow没有检测到GPU，您将只能看到CPU信息。</em></p><h1 id="3d55" class="kh ki hi bd kj kk kl km kn ko kp kq kr io ks ip kt ir ku is kv iu kw iv kx ky bi translated"><strong class="ak">第二步:cudnn和cudatoolkit </strong></h1><p id="2374" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">命令:</p><blockquote class="lf"><p id="eebb" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">$ conda列表</p></blockquote><p id="a1c6" class="pw-post-body-paragraph ix iy hi iz b ja mf ij jc jd mg im jf jg mh ji jj jk mi jm jn jo mj jq jr js hb bi translated">这个命令列出了当前conda环境中安装的软件包。<strong class="iz hj">如果您没有看到</strong><em class="jt">【cud nn】</em>或<em class="jt">【cuda toolkit】</em>软件包已安装，那么您需要安装它们。</p><p id="bdd0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你看到它们，它们需要是<em class="jt">正确版本</em>。在下一步中，我们将看到如何做到这一点，为什么需要这些。</p><h1 id="1d9f" class="kh ki hi bd kj kk kl km kn ko kp kq kr io ks ip kt ir ku is kv iu kw iv kx ky bi translated"><strong class="ak">第三步:</strong></h1><p id="04cc" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated">那么这些依赖是什么，我们为什么需要它们？</p><p id="783b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">依赖关系:</em></p><blockquote class="kz la lb"><p id="e3f0" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">要在gpu上运行tensorflow 2，必须安装cudnn和cudatoolkit。此外，cudnn和cudatoolkit <strong class="iz hj">的版本必须与您正在使用的gpu </strong>的驱动程序兼容。</p></blockquote><p id="f0d8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">cud nn(cud nn)是什么？</strong></p><blockquote class="lf"><p id="e195" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">Tensorflow核心是用C++和cuDNN库写的</p><p id="b312" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">cuDNN库是一个深度学习GPU加速库</p><p id="ac88" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">cuDNN库是使用CUDA构建的</p></blockquote><p id="bde7" class="pw-post-body-paragraph ix iy hi iz b ja mf ij jc jd mg im jf jg mh ji jj jk mi jm jn jo mj jq jr js hb bi translated"><strong class="iz hj">什么是CUDA？</strong></p><p id="88f0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="jt"> CUDA不是语言，也不是API </em> </strong>。不仅仅如此。CUDA是一个并行计算平台和编程模型，使得使用GPU进行通用计算变得简单而优雅。<a class="ae kg" href="https://blogs.nvidia.com/blog/2012/09/10/what-is-cuda-2/" rel="noopener ugc nofollow" target="_blank">链接</a></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mk"><img src="../Images/3b54308065606a9164dd671f1c5fe0b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*3ytTnwqGe0VoOs0wj6CbKQ.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">来自英伟达官网:<a class="ae kg" href="https://blogs.nvidia.com/blog/2012/09/10/what-is-cuda-2/" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><p id="0de3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以现在我们明白了为什么我们需要cuDNN (cudnn)。</p><p id="fb11" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">我们为什么需要cudatoolkit？</strong></p><p id="92aa" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="jt">帮助执行cuDNN/CUDA </em> </strong> <em class="jt">。当我们在兼容gpu驱动版本的coda环境中安装<em class="jt"> cudatoolkit </em>时，我们不需要安装完整的官方cudatoolkit。<a class="ae kg" href="https://www.programmersought.com/article/57794836777/" rel="noopener ugc nofollow" target="_blank">链接</a></em></p><p id="51c3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">我们如何知道兼容的版本？</strong></p><p id="429a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在终端中运行以下命令:</p><blockquote class="lf"><p id="d183" class="lg lh hi bd li lj lp lq lr ls lt js dx translated">$ nvcc -V</p></blockquote><figure class="mm mn mo mp mq jz er es paragraph-image"><div class="er es ml"><img src="../Images/6ae03fde148fbe7d47e35ce0bbcb4d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*jPXcd5Ppr4ZUU9Bq65chJw.png"/></div></figure><p id="f9c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"><em class="jt">【10.1版】</em> </strong>帮你搞清楚兼容的<em class="jt"> cudnn </em>版本。现在我们知道我们需要与<strong class="iz hj"> 10.1 </strong>版本兼容的<em class="jt"> cudnn </em></p><h1 id="cd64" class="kh ki hi bd kj kk kl km kn ko kp kq kr io ks ip kt ir ku is kv iu kw iv kx ky bi translated">第四步:</h1><p id="09dd" class="pw-post-body-paragraph ix iy hi iz b ja lx ij jc jd ly im jf jg lz ji jj jk ma jm jn jo mb jq jr js hb bi translated"><strong class="iz hj">如何安装特定版本的<em class="jt"> cudnn </em>和<em class="jt"> cudatoolkit </em>？</strong></p><blockquote class="kz la lb"><p id="994e" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">首先通过运行以下命令找出可安装的版本:</p></blockquote><blockquote class="lf"><p id="8698" class="lg lh hi bd li lj lk ll lm ln lo js dx translated">$ conda搜索cudnn</p></blockquote><figure class="mm mn mo mp mq jz er es paragraph-image"><div class="er es mr"><img src="../Images/68a92cb7f12ee54c2dbf9bae023b3f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*bwRVtIYa9RN3SnGeihL6-g.png"/></div></figure><blockquote class="kz la lb"><p id="f704" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">使用此<strong class="iz hj">，通过在终端</strong>中运行以下命令来安装特定版本:</p></blockquote><blockquote class="lf"><p id="ce5d" class="lg lh hi bd li lj lk ll lm ln lo js dx translated">$ conda install cud nn = 7 . 6 . 5 = cuda 10.1 _ 0</p></blockquote><p id="6ef3" class="pw-post-body-paragraph ix iy hi iz b ja mf ij jc jd mg im jf jg mh ji jj jk mi jm jn jo mj jq jr js hb bi translated"><strong class="iz hj">该命令格式为:</strong>conda install cud nn =<strong class="iz hj"><em class="jt">【版本】</em> </strong> = <strong class="iz hj"> <em class="jt">【构建】</em> </strong>。“版本”是第二列中的数字，而“版本”是第三列中的数字，来自前面的命令输出。</p><p id="aede" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="jt">“构建”应该与我们运行“nvcc -V”命令得到的版本相匹配</em> </strong></p><blockquote class="kz la lb"><p id="6589" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated"><strong class="iz hj"> <em class="hi">上面的命令也会安装兼容版本的cudatoolkit </em> </strong></p></blockquote><h1 id="27df" class="kh ki hi bd kj kk kl km kn ko kp kq kr io ks ip kt ir ku is kv iu kw iv kx ky bi translated">步骤五:</h1><blockquote class="kz la lb"><p id="1a38" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">最后，使用这个命令安装gpu兼容的tensorflow。</p></blockquote><blockquote class="lf"><p id="76bb" class="lg lh hi bd li lj lk ll lm ln lo js dx translated">$ conda安装tensorflow-gpu</p></blockquote><blockquote class="kz la lb"><p id="b824" class="ix iy jt iz b ja mf ij jc jd mg im jf lc mh ji jj ld mi jm jn le mj jq jr js hb bi translated">注意这里我们有“tensorflow-gpu”而不是“tensorflow”</p></blockquote><blockquote class="lf"><p id="b495" class="lg lh hi bd li lj lk ll lm ln lo js dx translated">当我们运行这个命令时，它会找到与我们之前安装的cudnn和cudatoolkit兼容的tensorflow版本，并安装tensorflow-gpu。</p></blockquote><p id="5d90" class="pw-post-body-paragraph ix iy hi iz b ja mf ij jc jd mg im jf jg mh ji jj jk mi jm jn jo mj jq jr js hb bi translated"><strong class="iz hj">注:</strong><strong class="iz hj">tensor flow的最新版本是2.4 </strong>(截止到撰写本文时)，是我们运行<em class="jt">‘pip install tensor flow’</em>时直接安装的，可能对GPU有效，也可能无效。但是当我们运行上面的命令时它安装了<strong class="iz hj"><em class="jt">tensor flow-GPU 2.2</em></strong><em class="jt"/>版本。这个版本允许tensorflow检测GPU并使用它。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es ms"><img src="../Images/0c3f8267aa2bec35a27502dcc00bf040.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*ztkbu-5BI88VHnCB4ZTOjA.png"/></div></figure><h1 id="e438" class="kh ki hi bd kj kk kl km kn ko kp kq kr io ks ip kt ir ku is kv iu kw iv kx ky bi translated">第六步:</h1><blockquote class="kz la lb"><p id="4db1" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated"><strong class="iz hj">我们现在如何知道当前版本是否能够检测到GPU并在其上运行？</strong></p></blockquote><p id="7c89" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在脚本或终端中运行以下命令:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mc"><img src="../Images/39b6801964410b558d92bfd22d5a31eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*5fQVqmsm91hKqByLsoYb9w.png"/></div></figure><p id="577c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="er es mt"><img src="../Images/e9a475c9870aee31ca3c1a1b92be7e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xjIxUMRKFQZDRAwT3hwZJw.png"/></div></div></figure><blockquote class="kz la lb"><p id="23be" class="ix iy jt iz b ja jb ij jc jd je im jf lc jh ji jj ld jl jm jn le jp jq jr js hb bi translated">所以现在正如你在输出中看到的，<strong class="iz hj"> GPU被检测到。</strong></p></blockquote><p id="7e7f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这有助于您解决TensorFlow 2与nvidia-GPU的兼容性问题。</p><p id="a5ef" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参考资料:</p><div class="my mz ez fb na nb"><a href="https://www.tensorflow.org/install" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">安装TensorFlow 2</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">用Python的pip包管理器安装TensorFlow。TensorFlow 2软件包要求pip版本大于19.0。官方…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">www.tensorflow.org</p></div></div><div class="nk l"><div class="nl l nm nn no nk np ka nb"/></div></div></a></div><div class="my mz ez fb na nb"><a href="https://www.tensorflow.org/guide/gpu" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">使用GPU | TensorFlow内核</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">TensorFlow代码和模型将透明地在单个GPU上运行，无需更改代码。使用注释…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">www.tensorflow.org</p></div></div><div class="nk l"><div class="nq l nm nn no nk np ka nb"/></div></div></a></div><div class="my mz ez fb na nb"><a href="https://github.com/tensorflow/tensorflow/issues/34485" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">Tensorflow 2.0不使用GPU，而Tensorflow 1.15确实发出#34485 tensorflow/tensorflow</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">系统信息我是否编写了自定义代码(而不是使用TensorFlow中提供的股票示例脚本):否…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nr l nm nn no nk np ka nb"/></div></div></a></div><div class="my mz ez fb na nb"><a href="https://yann-leguilly.gitlab.io/post/2019-10-08-tensorflow-and-cuda/" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">为您的GPU安装TensorFlow和Anaconda</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">在不使用Docker的情况下，我在GPU上使用TensorFlow 2.0时遇到了一些问题。有时我的cuda版本不兼容…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">yann-leguilly.gitlab.io</p></div></div><div class="nk l"><div class="ns l nm nn no nk np ka nb"/></div></div></a></div><div class="my mz ez fb na nb"><a href="https://www.programmersought.com/article/57794836777/" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">CUDA、CUDNN、CUDA驱动程序、CUDA工具包和NCVV有什么区别？-程序员…</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">我的主题是深度学习。我需要在GPU上运行程序。但是，题目的概念有点模糊…</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">www.programmersought.com</p></div></div><div class="nk l"><div class="nt l nm nn no nk np ka nb"/></div></div></a></div></div></div>    
</body>
</html>