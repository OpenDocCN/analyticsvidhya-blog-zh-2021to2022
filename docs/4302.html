<html>
<head>
<title>Rule-Based Customer Segmentation Without ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于规则的无ML客户细分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/rule-based-customer-segmentation-without-ml-6d194648813d?source=collection_archive---------3-----------------------#2021-09-20">https://medium.com/analytics-vidhya/rule-based-customer-segmentation-without-ml-6d194648813d?source=collection_archive---------3-----------------------#2021-09-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="242d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你好。如今我很兴奋。我加入了一个超级数据科学和机器学习<a class="ae jc" href="https://bootcamp.veribilimiokulu.com/egitim/veri-bilimci-yetistirme-programi/" rel="noopener ugc nofollow" target="_blank">训练营</a>，学到了很多新技术。我想和你分享我学到的东西。老实说，我们将在这个故事中涉及的例子不是我自己的，但我想向你解释“我们如何能没有ml ”,因为我们知道下面的规则。</p><blockquote class="jd je jf"><p id="e645" class="ie if jg ig b ih ii ij ik il im in io jh iq ir is ji iu iv iw jj iy iz ja jb ha bi translated">如果你想掌握某样东西，那就去教它。一个很好的学习方法是教书。</p><p id="e20a" class="ie if jg ig b ih ii ij ik il im in io jh iq ir is ji iu iv iw jj iy iz ja jb ha bi translated">——理查德·费曼。</p></blockquote><p id="6f8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个故事中，我将尝试解释我们如何在不使用任何机器学习技术的情况下进行客户细分。那么，我们该怎么做呢？我们将为每个客户群创建一个角色。创建他们的角色后，我们将预测目标角色的平均预期利润。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/d36718475ada61f9270add78c1c68d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rXejhcKLorK7JiXnQH-tg.jpeg"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated"><a class="ae jc" href="https://unsplash.com/@homajob?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">斯科特·格雷厄姆</a>在<a class="ae jc" href="https://unsplash.com/s/photos/data-analysis?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><h1 id="60d1" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">介绍</h1><p id="a76c" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">在这个故事中，我们将使用<a class="ae jc" href="https://www.kaggle.com/merate/persona-data" rel="noopener ugc nofollow" target="_blank">这个</a>数据集。我已经为这个故事创建了一个Kaggle笔记本，但我没有在笔记本上解释我们做了什么。因为我更喜欢在媒体上解释我们做了什么。你可以从<a class="ae jc" href="https://www.kaggle.com/enesbaysan/rule-based-customer-segmentation-without-ml" rel="noopener ugc nofollow" target="_blank">这里</a>进入笔记本。</p><h1 id="1b2e" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">让我们从探索数据开始</h1><p id="171f" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">在Kaggle中，我已经加载了数据集。我在下面编写并执行了将数据加载到变量的代码。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="3350" class="li kb hh le b fi lj lk l ll lm">import pandas as pd</span><span id="bc00" class="li kb hh le b fi ln lk l ll lm">df = pd.read_csv('../input/persona-data/persona.csv')</span><span id="d276" class="li kb hh le b fi ln lk l ll lm">df.head()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es lo"><img src="../Images/0a1c116569cfb64715ba049be95508a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*WWIpT18FaLOKdL1nxSBN8w.png"/></div></figure><p id="ed91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我将在<code class="du lp lq lr le b">df</code>数据帧上使用<code class="du lp lq lr le b">info</code>方法。它将返回数据框的列类型和条目数。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="9404" class="li kb hh le b fi lj lk l ll lm">df.info()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ls"><img src="../Images/aeb7e37ea535277a50bbf7c1cc0bd226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*DgREOuztDzP2iFVH2s6A6A.png"/></div></figure><p id="2506" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此时，我们需要了解什么是列。它们的含义是什么？</p><ul class=""><li id="623a" class="lt lu hh ig b ih ii il im ip lv it lw ix lx jb ly lz ma mb bi translated">价格=客户支付的金额</li><li id="b5ea" class="lt lu hh ig b ih mc il md ip me it mf ix mg jb ly lz ma mb bi translated">来源=客户设备类型</li><li id="c4a5" class="lt lu hh ig b ih mc il md ip me it mf ix mg jb ly lz ma mb bi translated">性别=客户性别</li><li id="2288" class="lt lu hh ig b ih mc il md ip me it mf ix mg jb ly lz ma mb bi translated">国家=客户国家</li><li id="8220" class="lt lu hh ig b ih mc il md ip me it mf ix mg jb ly lz ma mb bi translated">年龄=客户年龄</li></ul><p id="7052" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们进行细分之前，我将回答一些问题，以便进行分析思考。为此，我将定义一个函数来帮助我描述列。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="7225" class="li kb hh le b fi lj lk l ll lm">def get_col_summary(df, col):<br/>    print(f"Total count of unique values: <strong class="le hi">{</strong>df[col].nunique()<strong class="le hi">}</strong>")<br/>    print(f"Total value counts for each value<strong class="le hi">\n{</strong>df[col].value_counts()<strong class="le hi">}</strong>")</span></pre><p id="25e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的函数将给出该列唯一值的总计数，以及每个唯一值的计数。</p><p id="709c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里是第一个问题，<em class="jg">有多少个唯一价格，每个唯一价格有多少笔交易？</em></p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="b485" class="li kb hh le b fi lj lk l ll lm">get_col_summary(df,'PRICE')</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ls"><img src="../Images/10a13f041eb04efd454c03d7140cf5ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*7K4DXHu22cTy-RuHdqQpbQ.png"/></div></figure><p id="b8c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jg">有多少个唯一来源及其唯一交易计数？</em></p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="00a0" class="li kb hh le b fi lj lk l ll lm">get_col_summary(df,'SOURCE')</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ls"><img src="../Images/ccbd478f075ae257e170e040c673d808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*dTzb33uFqE9XVBV0k1FNvw.png"/></div></figure><p id="8dea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jg">有多少个唯一的国家及其唯一的交易计数？</em></p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="bc79" class="li kb hh le b fi lj lk l ll lm">get_col_summary(df,'COUNTRY')</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ls"><img src="../Images/969a1a1dd277a2f29d7411d8d6f70495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*geg3IzwmAXZ18BzjONcQYw.png"/></div></div></figure><p id="1b78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jg">每个国家总交易的平均价格是多少？</em></p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="bc95" class="li kb hh le b fi lj lk l ll lm">df.groupby('COUNTRY').agg({'PRICE':[('mean per country','mean')]})</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mh"><img src="../Images/930ee1e728396dd06ffa9d58eb216188.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*oxtXJmWXWG-gFmIPoFNqVg.png"/></div></figure><p id="9fb3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们愿意，我们可以加强问题。我想现在够了。</p><h1 id="958d" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">逐步创建人物角色</h1><p id="8dcd" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我将根据客户的所有特征对他们进行分组，并将他们分配给<code class="du lp lq lr le b">agg_df</code>变量。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="ebd4" class="li kb hh le b fi lj lk l ll lm">agg_df = df.groupby(['COUNTRY', 'SOURCE', 'SEX', 'AGE'],as_index=False).agg({'PRICE':'mean'}).sort_values('PRICE', ascending=False)</span><span id="be57" class="li kb hh le b fi ln lk l ll lm">agg_df.head()</span></pre><p id="c121" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种情况下，我得到了每个类别的平均利润。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mi"><img src="../Images/209e4a64150b0657997e8588cd0d2a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*BLwuqAFZNlc1T5eaEPaOyQ.png"/></div></figure><h1 id="f8f1" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">创建年龄类别</h1><p id="38cb" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我们将创建年龄类别作为细分的第一步。我会把顾客分成不同的年龄段。为此，我将使用<code class="du lp lq lr le b">cut</code>函数。你可以从<a class="ae jc" href="https://www.geeksforgeeks.org/pandas-cut-method-in-python/#:~:text=Pandas%20cut()%20function%20is,statistical%20analysis%20on%20scalar%20data.&amp;text=Parameters%3A,input%20array%20to%20be%20binned." rel="noopener ugc nofollow" target="_blank">这里</a>获得更多关于使用该功能的信息。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="157f" class="li kb hh le b fi lj lk l ll lm">agg_df.loc[:, 'AGE_CAT'] = pd.cut(agg_df['AGE'], [0, 18, 23, 30, 41, 70], labels=['0_18', '19_23', '24_30', '31_40', '41_70'])</span><span id="3368" class="li kb hh le b fi ln lk l ll lm">agg_df.head()</span></pre><p id="91a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在上面为每个顾客设置了年龄类别。为此，我使用了0-18岁、19-23岁等年龄范围。有一点很重要。正如我们在第167索引上看到的，<code class="du lp lq lr le b">cut</code>函数包括左极限但不包括右极限。例如，24介于23和30之间，但类别从24开始，最大值为29。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mj"><img src="../Images/bfeabfe932c7dbf65c1574ac8409c183.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*lshKWvKHvNgrwsLtmrIASg.png"/></div></figure><h1 id="09e2" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">创建人物角色</h1><p id="49a3" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">现在，我们将为每个用户创建角色。为此，我们将使用来自<code class="du lp lq lr le b">agg_df</code>的所有分类特征。我们将以下所有分类特征串联起来。为此我使用了<code class="du lp lq lr le b">apply</code>函数。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="aaa9" class="li kb hh le b fi lj lk l ll lm">agg_df.loc[:, 'customers_level_based'] = agg_df.apply(<br/>    lambda x: f"<strong class="le hi">{</strong>x['COUNTRY'].upper()<strong class="le hi">}</strong>_<strong class="le hi">{</strong>x['SOURCE'].upper()<strong class="le hi">}</strong>_<strong class="le hi">{</strong>x['SEX'].upper()<strong class="le hi">}</strong>_<strong class="le hi">{</strong>x['AGE_CAT'].upper()<strong class="le hi">}</strong>", axis=1)</span><span id="9d49" class="li kb hh le b fi ln lk l ll lm">agg_df.head()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mk"><img src="../Images/7c223e4bdd6058d5ddcf84fd12273e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*1bVr2WKGVmOlS2zxvrFfRQ.png"/></div></figure><p id="3799" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我需要计算每个角色的平均利润。因为我们可能有重复的角色。比如说；33岁的巴西男性android用户客户和38岁的巴西男性android用户客户将拥有相同的角色。在这种情况下，我们需要计算<code class="du lp lq lr le b">BRA_ANDROID_MALE_31_40</code>人物角色的平均利润。</p><p id="eecf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我使用<code class="du lp lq lr le b">customers_level_based</code>特征对数据帧进行分组并计算平均值，我可以得到我们想要的。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="bc0b" class="li kb hh le b fi lj lk l ll lm">level_df = agg_df[['customers_level_based', 'PRICE']].groupby('customers_level_based',as_index=False).mean()</span></pre><p id="71bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我计算了新的数据帧，并将其赋给了<code class="du lp lq lr le b">level_df</code>变量。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="acdc" class="li kb hh le b fi lj lk l ll lm">level_df.head()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ml"><img src="../Images/b248bb0e546425507f346de3cee28912.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*qufwGhFYnH3x1pD7yN7Amg.png"/></div></figure><h1 id="a8c6" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">为人物角色创建细分市场</h1><p id="5da4" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">现在，我将为每个角色创建细分市场。为此，我将使用<code class="du lp lq lr le b">qcut</code>功能。你可以从<a class="ae jc" href="https://www.geeksforgeeks.org/how-to-use-pandas-cut-and-qcut/" rel="noopener ugc nofollow" target="_blank">这里</a>获得关于该功能的更多信息。作为一个简单的解释，它对数据进行排序，然后通过使用<code class="du lp lq lr le b">q</code> arg计算分位数，并在<code class="du lp lq lr le b">labels</code> arg之后给出标签。还有很重要的一点。我们应该按降序排列标签。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="4c60" class="li kb hh le b fi lj lk l ll lm">level_df.loc[:, 'SEGMENT'] = pd.qcut(level_df['PRICE'], 4, labels=['D', 'C', 'B', 'A'])</span><span id="25eb" class="li kb hh le b fi ln lk l ll lm">level_df.head()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mm"><img src="../Images/b3035388809594334b1d0c1ff2cd9aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*wURYm0AzPIxYbSk02C9X0g.png"/></div></figure><p id="d419" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们为每个客户角色设定了细分市场。</p><h1 id="fbba" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">通过使用人物角色，新用户的预期利润</h1><p id="aa0d" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我将创建两个新角色。在这种情况下，我没有创造一个真正的新角色。我想象我有两个新客户，他们的角色是这样的。</p><pre class="jl jm jn jo fd ld le lf lg aw lh bi"><span id="953e" class="li kb hh le b fi lj lk l ll lm">new_user = 'TUR_ANDROID_FEMALE_31_40'</span><span id="484f" class="li kb hh le b fi ln lk l ll lm">new_user2 = 'FRA_IOS_FEMALE_31_40'</span></pre><p id="cfba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我使用带有这些变量的<code class="du lp lq lr le b">customers_level_based</code>列来过滤数据框架，我可以得到它们的预期利润。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mn"><img src="../Images/686a6f452852f70686478e298a06114e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*izp8oaBgRMtckXj0mHw5CQ.png"/></div></div></figure><p id="1a0b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以访问下面的笔记本。</p><div class="mo mp ez fb mq mr"><a href="https://www.kaggle.com/enesbaysan/rule-based-customer-segmentation-without-ml" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hi fi z dy mw ea eb mx ed ef hg bi translated">基于规则的无ML客户细分</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">使用Kaggle笔记本探索和运行机器学习代码|使用来自角色数据的数据</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">www.kaggle.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf ju mr"/></div></div></a></div><p id="88fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望你喜欢这个。</p><p id="8300" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">亲切的问候。</p></div></div>    
</body>
</html>