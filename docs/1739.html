<html>
<head>
<title>Solving Regression Problems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决回归问题</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/solving-regression-problems-9cbd516a51a?source=collection_archive---------14-----------------------#2021-03-15">https://medium.com/analytics-vidhya/solving-regression-problems-9cbd516a51a?source=collection_archive---------14-----------------------#2021-03-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/a3c12037d484432767f29a4918ef3ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2QAIT4qLd0955jkH"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">由<a class="ae it" href="https://unsplash.com/@hikendal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">肯德尔</a>在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="b6e7" class="jd je hh iz b fi jf jg l jh ji">Dataset Used: <a class="ae it" href="https://www.kaggle.com/mirichoi0218/insurance" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/mirichoi0218/insurance</a><br/>My Noteboo<a class="ae it" href="https://www.kaggle.com/tanishsawant2002/regression-85-score" rel="noopener ugc nofollow" target="_blank">k: https://www.kaggle.com/tanishsawant2002/regression-85-score</a></span></pre><p id="8cf5" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">数据集描述:(摘自Kaggle)</p><h1 id="68d8" class="kh je hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">语境</h1><p id="3ff0" class="pw-post-body-paragraph jj jk hh jl b jm le jo jp jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg ha bi translated">Brett Lantz的Machine Learning with R是一本介绍使用R进行机器学习的书，据我所知，Packt Publishing不会在网上提供其数据集，除非你购买这本书并创建一个用户帐户，如果你从图书馆借阅这本书或从朋友那里借书，这可能会是一个问题。所有这些数据集都在公共领域，但只需要一些清理和重新编码，以符合书中的格式。</p><h1 id="1466" class="kh je hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">内容</h1><p id="7fde" class="pw-post-body-paragraph jj jk hh jl b jm le jo jp jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg ha bi translated">列</p><ul class=""><li id="5b20" class="lj lk hh jl b jm jn jq jr ju ll jy lm kc ln kg lo lp lq lr bi translated">年龄:主要受益人的年龄</li><li id="e0dd" class="lj lk hh jl b jm ls jq lt ju lu jy lv kc lw kg lo lp lq lr bi translated">性别:保险承包商性别，女，男</li><li id="849c" class="lj lk hh jl b jm ls jq lt ju lu jy lv kc lw kg lo lp lq lr bi translated">bmi:身体质量指数，提供对身体的了解，体重相对于身高相对较高或较低，<br/>体重的客观指数(kg / m ^ 2)使用身高与体重的比率，理想值为18.5至24.9</li><li id="053d" class="lj lk hh jl b jm ls jq lt ju lu jy lv kc lw kg lo lp lq lr bi translated">儿童:健康保险覆盖的儿童人数/受抚养人人数</li><li id="b902" class="lj lk hh jl b jm ls jq lt ju lu jy lv kc lw kg lo lp lq lr bi translated">吸烟者:吸烟</li><li id="889d" class="lj lk hh jl b jm ls jq lt ju lu jy lv kc lw kg lo lp lq lr bi translated">地区:受益人在美国的居住区，东北，东南，西南，西北。</li><li id="5bf6" class="lj lk hh jl b jm ls jq lt ju lu jy lv kc lw kg lo lp lq lr bi translated">费用:由健康保险支付的个人医疗费用</li></ul><h1 id="fd8b" class="kh je hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">承认</h1><p id="b03b" class="pw-post-body-paragraph jj jk hh jl b jm le jo jp jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg ha bi translated">数据集可在GitHub <a class="ae it" href="https://github.com/stedy/Machine-Learning-with-R-datasets" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><h1 id="d000" class="kh je hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">灵感</h1><p id="c4f7" class="pw-post-body-paragraph jj jk hh jl b jm le jo jp jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg ha bi translated">你能准确预测保险费用吗？</p></div><div class="ab cl lx ly go lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ha hb hc hd he"><p id="d39f" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">好了，关于数据集已经说得够多了，现在让我们开始研究熊猫吧。</p><p id="5372" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">让我们将数据作为熊猫数据框架导入</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="7c57" class="jd je hh iz b fi jf jg l jh ji">df = pd.read_csv("/kaggle/input/insurance/insurance.csv")<br/>df.head(10)<br/></span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div class="er es me"><img src="../Images/e7bd1339f20f52389d55f78cc556fa2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*Tfi8XQxTleXQsAFNYBqRUg.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">输出</figcaption></figure><p id="990a" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">我通常喜欢将列名存储为列表。(因为某些功能将来可能会改变)。</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="25b1" class="jd je hh iz b fi jf jg l jh ji">cols = list(df.columns)</span></pre><p id="418f" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">描述数字特征</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="7b33" class="jd je hh iz b fi jf jg l jh ji">df.describe().T</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/fc1bf6c2812ce31b7159c494b325d0d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52QyYClCua2iI51Mjo8p-A.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">输出</figcaption></figure><p id="ab97" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">检查缺少的值</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="12af" class="jd je hh iz b fi jf jg l jh ji">df.isna().sum()</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div class="er es mg"><img src="../Images/756bb2c8cefe2f36efa7dd855cb2ca02.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*aW9QjIqNOou8I660nbMMew.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">输出</figcaption></figure><p id="30c4" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">dataset🥳🥳中没有缺失值</p><p id="1107" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">通过使用<a class="ae it" href="https://seaborn.pydata.org/" rel="noopener ugc nofollow" target="_blank"> seaborn的</a> pairplot函数，我们可以快速查看每个特性之间的关系。</p><p id="9a2f" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">(Seaborn是基于<a class="ae it" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>的Python数据可视化库。它提供了一个高层次的界面来绘制有吸引力的和信息丰富的统计图形。)</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="4f29" class="jd je hh iz b fi jf jg l jh ji">import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="00b6" class="jd je hh iz b fi mh jg l jh ji">sns.pairplot(df)<br/>plt.show()</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/6de86f202474f9b1ff39b8f741c9cc3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PF0UWd2HxHhChOPNyFiA-g.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">配对图</figcaption></figure><p id="2760" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">通过观察数据集，可以清楚地看到“性别”、“地区”和“吸烟者”是字符串数据类型列，可以进行热编码。</p><p id="2720" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">Panda的get_dummies()方法可以用于此目的。</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="2659" class="jd je hh iz b fi jf jg l jh ji">df["sex"] = pd.get_dummies(df["sex"])<br/>df["smoker"] = pd.get_dummies(df["smoker"])<br/>df["region"] = pd.get_dummies(df["region"])<br/>df.head()</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div class="er es mj"><img src="../Images/5610843533f20791f2d35a563171f490.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*nwvlAiDO_QNrbalRIDgQ2g.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">现在数据被很好地编码了。</figcaption></figure></div><div class="ab cl lx ly go lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ha hb hc hd he"><p id="745a" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">我们已经完成了预处理，准备开始构建模型。</p><p id="3f96" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">但是等等，还有一个更关键的步骤。(分割数据集)</p><p id="ae87" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">除了“费用”之外的所有列都可以添加到功能表中。</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="66b0" class="jd je hh iz b fi jf jg l jh ji">X = df[set(cols)-set(["charges"])]<br/>y = df["charges"]</span></pre><p id="c3e8" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">将数据分为训练和测试:</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="0611" class="jd je hh iz b fi jf jg l jh ji">from sklearn.model_selection import train_test_split<br/><br/>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.33)</span></pre></div><div class="ab cl lx ly go lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ha hb hc hd he"><p id="48cd" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">建筑模型:</p><p id="fea7" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">在这里，我将许多模型添加到阵列中，以便于比较性能。一般来说，回归得分用<a class="ae it" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.r2_score.html" rel="noopener ugc nofollow" target="_blank"> r2_score </a>或误差平方来衡量。</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="fb00" class="jd je hh iz b fi jf jg l jh ji">from sklearn import linear_model<br/><br/>reg = linear_model.LinearRegression()<br/>elas = linear_model.ElasticNet()<br/>lasso = linear_model.Lasso()<br/>huber = linear_model.HuberRegressor()<br/><br/>models = [reg, elas, lasso, huber]<br/><br/>print(reg)</span><span id="1458" class="jd je hh iz b fi mh jg l jh ji">for model <strong class="iz hi">in</strong> models:<br/>    print(model)<br/>    model.fit(X_train, y_train)<br/>    print(model.score(X_test, y_test))</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div class="er es mk"><img src="../Images/787d54d9b0199c2b32c0458f78f12093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*MLg8bL6gcb2ej7PzMok-6A.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">模型名称:分数</figcaption></figure><p id="95e7" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated"><strong class="jl hi">使用RandomForestRegressor: </strong></p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="0d35" class="jd je hh iz b fi jf jg l jh ji">from sklearn.ensemble import RandomForestRegressor<br/><br/>rr = RandomForestRegressor(n_estimators=200, n_jobs = 6, verbose = True)<br/>rr.fit(X_train, y_train)<br/>rr.score(X_test, y_test)</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/b6e15f34b0c3cddd689fc44cc3e83048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3HJnKO8tjwUhQLTfJ8VYQ.png"/></div></div></figure><p id="3658" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated"><strong class="jl hi">使用XGBRegressor: </strong></p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="f989" class="jd je hh iz b fi jf jg l jh ji">xgb = XGBRegressor()<br/>xgb.fit(X_train, y_train)<br/>xgb.score(X_test, y_test)</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div class="er es ml"><img src="../Images/e0f405dac06714994adcefb670d7db42.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*Mmxlu8Xwc5AM2i6P20kxYA.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">得分</figcaption></figure><p id="e825" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated"><strong class="jl hi">xbgrf回归器:</strong></p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="e66d" class="jd je hh iz b fi jf jg l jh ji"><br/>from xgboost import XGBRFRegressor<br/><br/>xgbrf = XGBRFRegressor()<br/>xgbrf.fit(X_train, y_train)<br/>xgbrf.score(X_test, y_test)</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mm"><img src="../Images/4bac16df918b5d36e68a5c5093ca7665.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*9FgOmqUobX-gtqqXVsTrAQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">得分</figcaption></figure><p id="1e39" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">检查r2_score:</p><p id="a5d2" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">r(决定系数)回归得分函数。</p><p id="1110" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">最佳得分可能是1.0，也可能是负数(因为模型可能会任意恶化)。忽略输入特征，始终预测y的期望值的常数模型的R值为0.0。</p><pre class="iu iv iw ix fd iy iz ja jb aw jc bi"><span id="944c" class="jd je hh iz b fi jf jg l jh ji">from sklearn.metrics import r2_score</span><span id="3ec7" class="jd je hh iz b fi mh jg l jh ji">for model in models:<br/>    print("-----------------------------------")<br/>    print(r2_score(y_test, model.predict(X_test)))</span></pre><figure class="iu iv iw ix fd ii er es paragraph-image"><div class="er es mn"><img src="../Images/912215f55bbd83507be3e47e5ce41322.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*E30bh7VfhvHH3NIIL9wQqw.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">输出</figcaption></figure><p id="a5cb" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">结论:</p><p id="2d32" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated"><strong class="jl hi"> XBGRFRegressor给出了最好的r2_score。</strong></p><p id="e001" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">这就是我们需要做的一切😃。</p><p id="1851" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">恭喜你！我们已经成功地建立了一个预测医疗费用的模型。🎉🎊</p></div></div>    
</body>
</html>