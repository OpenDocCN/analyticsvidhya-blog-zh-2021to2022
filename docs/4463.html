<html>
<head>
<title>Integrate MLflow Model Logging to Scikit-Learn Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将MLflow模型日志记录集成到Scikit-Learn管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/integrate-mlflow-model-logging-to-scikit-learn-pipeline-6f74e5c601c3?source=collection_archive---------1-----------------------#2021-10-20">https://medium.com/analytics-vidhya/integrate-mlflow-model-logging-to-scikit-learn-pipeline-6f74e5c601c3?source=collection_archive---------1-----------------------#2021-10-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ee92965eb4b0843a33549ffc83b477fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iiy93TznZOIrrNY14_j63w.jpeg"/></div></div></figure><h1 id="8248" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">MLflow简介</h1><p id="f3f1" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">MLflow是一个开源工具，具有模型跟踪、日志记录和注册等功能。它可以用于在数据科学团队内部轻松访问机器学习模型，还可以通过记录用于训练特定模型的参数来轻松重现实验。</p><p id="d9f5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">MLflow还可以很好地集成到CI/CD管道中，并且在MLOps期间，数据科学家和ML工程师可以与部署工程师合作开发和部署ML模型的新版本，并监控其性能。</p><p id="6f86" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">以下是MLflow的功能-</p><p id="fa1b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> MLflow Tracking </strong> —帮助记录和跟踪每个ML实验，以及比较每次运行的结果。</p><p id="7b49" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> MLflow项目</strong> —让您的ML代码可重用，并打包您的代码与其他数据科学家共享。</p><p id="e3c1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> MLflow Models </strong> —将您的ML模型与其他模型工件一起以串行格式存储，这使得部署模型进行推理更加容易。</p><p id="ce9f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> MLflow Model Registry </strong> —通过模型版本化协作管理您的ML模型，并将其从活动状态过渡到试运行状态，然后过渡到生产状态。</p><p id="e468" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">注:</strong>这不是MLflow教程。只有MLflow登录到管道的实现。如果您对MLflow不熟悉，我建议您在继续之前通读<a class="ae kr" href="https://mlflow.org/docs/latest/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="87af" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是Scikit-Learn管道？</h1><p id="9e4a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">训练ML模型是一个迭代过程。该模型需要根据用例以及收集的新数据量以设定的频率重新训练。需要有一种机制将数据接收到训练管道中，执行特征工程，训练模型并保存新模型。</p><p id="2653" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae kr" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn Pipeline </a>由多个步骤组成，从用于缩放数字特征和编码分类特征的转换器开始，到基于转换数据进行学习的估计器结束。</p><h1 id="7723" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">培训模型管道</h1><p id="59fa" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">该应用程序的最终目标是部署一个模型训练服务，并公开一个REST端点，我们可以通过该端点发送数据和模型参数。</p><p id="9255" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦端点被调用，数据将被分割以训练和测试，并被摄取到训练管道中以训练模型。在成功的训练之后，我们将使用测试数据来记录使用MLflow的模型的不同度量，并且还将模型/工件记录到MLflow。</p><p id="af63" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们将在此演示中使用的数据集是糖尿病预测数据集，它有8个特征，目标列是结果，由二进制值0表示糖尿病阴性病例，1表示糖尿病阳性病例。数据集链接这里是<a class="ae kr" href="https://www.kaggle.com/uciml/pima-indians-diabetes-database" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="a2a5" class="lb ir hi kx b fi lc ld l le lf"># read data<br/>dia_df = pd.read_csv('../data/diabetes.csv')</span><span id="4bdc" class="lb ir hi kx b fi lg ld l le lf"># split data into train/test<br/>X_train, X_test, y_train, y_test = train_test_split(dia_df.drop('Outcome', axis=1), dia_df['Outcome'], test_size=0.3, random_state=123)</span><span id="7f7d" class="lb ir hi kx b fi lg ld l le lf">#creating a pipeline<br/>model_pipeline = Pipeline(steps=[('scaler', MinMaxScaler()), ('model', LogisticRegression())])</span><span id="47b6" class="lb ir hi kx b fi lg ld l le lf"># fit model<br/>model_pipeline.fit(X_train, y_train)</span></pre><p id="b448" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">上面提供的代码是scikit-learn管道的基本实现。接下来，我们将看到如何使用MLflow记录模型的指标。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="0907" class="lb ir hi kx b fi lc ld l le lf"># compare various metrics of model<br/>def get_metrics(y_true, y_pred, y_pred_prob):<br/>    acc = accuracy_score(y_true, y_pred)<br/>    prec = precision_score(y_true, y_pred)<br/>    recall = recall_score(y_true, y_pred)<br/>    entropy = log_loss(y_true, y_pred_prob)<br/>    return {'accuracy': round(acc, 2), 'precision': round(prec, 2), 'recall': round(recall, 2), 'entropy': round(entropy, 2)}</span><span id="ed2c" class="lb ir hi kx b fi lg ld l le lf"># log model metrics with MLflow<br/>def log_model(experiment_name, run_name, run_metrics, run_params=None):<br/>    mlflow.set_experiment(experiment_name)<br/>    with mlflow.start_run(run_name=run_name):<br/>        if not run_params == None:<br/>            for name in run_params:<br/>                mlflow.log_param(run_params[name])<br/>        for name in run_metrics:<br/>            mlflow.log_metric(name, run_metrics[name])<br/>        <br/>    print('Run - %s is logged to Experiment - %s' %(run_name, experiment_name))</span></pre><h1 id="a6c5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建定制培训渠道</h1><p id="3e21" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">自定义训练管道继承自Scikit-Learn管道类，因此所有功能(如fit、transform和predict)都已经存在。我们唯一要做的是将模型日志添加到我们的定制培训管道类中。下面是代码。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="23c6" class="lb ir hi kx b fi lc ld l le lf">class TrainingPipeline(Pipeline):</span><span id="1cd5" class="lb ir hi kx b fi lg ld l le lf">'''</span><span id="d00c" class="lb ir hi kx b fi lg ld l le lf">Class -&gt; TrainingPipeline, ParentClass -&gt; Sklearn-Pipeline</span><span id="878d" class="lb ir hi kx b fi lg ld l le lf">Extends from Scikit-Learn Pipeline class. Additional functionality to track model metrics and log model artifacts with mlflow</span><span id="5366" class="lb ir hi kx b fi lg ld l le lf">params:</span><span id="8d61" class="lb ir hi kx b fi lg ld l le lf">steps: list of tuple (similar to Scikit-Learn Pipeline class)</span><span id="ffe7" class="lb ir hi kx b fi lg ld l le lf">'''</span><span id="a1a6" class="lb ir hi kx b fi lg ld l le lf">def __init__(self, steps):</span><span id="0e86" class="lb ir hi kx b fi lg ld l le lf">super().__init__(steps)</span><span id="661c" class="lb ir hi kx b fi lg ld l le lf">def fit(self, X_train, y_train):</span><span id="75e4" class="lb ir hi kx b fi lg ld l le lf">self.__pipeline = super().fit(X_train, y_train)</span><span id="6646" class="lb ir hi kx b fi lg ld l le lf">return self.__pipeline</span><span id="83e6" class="lb ir hi kx b fi lg ld l le lf">def get_metrics(self, y_true, y_pred, y_pred_prob):</span><span id="6923" class="lb ir hi kx b fi lg ld l le lf">acc = accuracy_score(y_true, y_pred)</span><span id="b0e1" class="lb ir hi kx b fi lg ld l le lf">prec = precision_score(y_true, y_pred)</span><span id="43cb" class="lb ir hi kx b fi lg ld l le lf">recall = recall_score(y_true, y_pred)</span><span id="cf62" class="lb ir hi kx b fi lg ld l le lf">entropy = log_loss(y_true, y_pred_prob)</span><span id="c0cd" class="lb ir hi kx b fi lg ld l le lf">return {'accuracy': round(acc, 2), 'precision': round(prec, 2), 'recall': round(recall, 2), 'entropy': round(entropy, 2)}</span><span id="5553" class="lb ir hi kx b fi lg ld l le lf">def make_model_name(self, experiment_name, run_name):</span><span id="4e9b" class="lb ir hi kx b fi lg ld l le lf">clock_time = time.ctime().replace(' ', '-')</span><span id="8649" class="lb ir hi kx b fi lg ld l le lf">return experiment_name + '_' + run_name + '_' + clock_time</span><span id="7d99" class="lb ir hi kx b fi lg ld l le lf">def log_model(self, model_key, X_test, y_test, experiment_name, run_name, run_params=None):</span><span id="64f8" class="lb ir hi kx b fi lg ld l le lf">model = self.__pipeline.get_params()[model_key]</span><span id="fb7e" class="lb ir hi kx b fi lg ld l le lf">y_pred = self.__pipeline.predict(X_test)</span><span id="4c32" class="lb ir hi kx b fi lg ld l le lf">y_pred_prob = self.__pipeline.predict_proba(X_test)</span><span id="0806" class="lb ir hi kx b fi lg ld l le lf">run_metrics = self.get_metrics(y_test, y_pred, y_pred_prob)</span><span id="574c" class="lb ir hi kx b fi lg ld l le lf">mlflow.set_experiment(experiment_name)</span><span id="1459" class="lb ir hi kx b fi lg ld l le lf">mlflow.set_tracking_uri('http://localhost:5000')</span><span id="4f10" class="lb ir hi kx b fi lg ld l le lf">with mlflow.start_run(run_name=run_name):</span><span id="15f5" class="lb ir hi kx b fi lg ld l le lf">if not run_params == None:</span><span id="462b" class="lb ir hi kx b fi lg ld l le lf">for name in run_params:</span><span id="7fbb" class="lb ir hi kx b fi lg ld l le lf">mlflow.log_param(name, run_params[name])</span><span id="fe54" class="lb ir hi kx b fi lg ld l le lf">for name in run_metrics:</span><span id="2b65" class="lb ir hi kx b fi lg ld l le lf">mlflow.log_metric(name, run_metrics[name])</span><span id="8c8a" class="lb ir hi kx b fi lg ld l le lf">model_name = self.make_model_name(experiment_name, run_name)</span><span id="5477" class="lb ir hi kx b fi lg ld l le lf">mlflow.sklearn.log_model(sk_model=self.__pipeline, artifact_path='diabetes-model', registered_model_name=model_name)</span><span id="0864" class="lb ir hi kx b fi lg ld l le lf">print('Run - %s is logged to Experiment - %s' %(run_name, experiment_name))</span><span id="2a94" class="lb ir hi kx b fi lg ld l le lf">return run_metrics</span></pre><h1 id="dd8c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">训练模型的REST API</h1><p id="593b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们使用flask来公开用于训练模型的REST API。这是一个接受表单数据的POST请求。请求有效负载由一个用于训练和模型参数的csv文件组成。在示例中，我们使用糖尿病数据集进行训练，因此最终模型是逻辑回归。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="02ea" class="lb ir hi kx b fi lc ld l le lf">def run_train_pipeline(dia_df, tol, iterations, experiment_name, run_name):</span><span id="0cd7" class="lb ir hi kx b fi lg ld l le lf">'''</span><span id="b797" class="lb ir hi kx b fi lg ld l le lf">method which executes the training pipeline</span><span id="0bb2" class="lb ir hi kx b fi lg ld l le lf">params:</span><span id="024f" class="lb ir hi kx b fi lg ld l le lf">dia_df : diabetes dataframe</span><span id="2f3f" class="lb ir hi kx b fi lg ld l le lf">tol : C (tolerance) value for regularization</span><span id="da96" class="lb ir hi kx b fi lg ld l le lf">iterations : maximum iterations for training Logistic Regression model</span><span id="24f6" class="lb ir hi kx b fi lg ld l le lf">experiment_name : MLflow experiment name</span><span id="03e9" class="lb ir hi kx b fi lg ld l le lf">run_name : Set run name inside each experiment</span><span id="bd24" class="lb ir hi kx b fi lg ld l le lf">'''</span><span id="da8c" class="lb ir hi kx b fi lg ld l le lf">X_train, X_test, y_train, y_test = train_test_split(dia_df.drop('Outcome', axis=1), dia_df['Outcome'], test_size=0.3, random_state=123)</span><span id="530b" class="lb ir hi kx b fi lg ld l le lf">train_pipeline = TrainingPipeline(steps=[('scaler', MinMaxScaler()), ('model', LogisticRegression(C=tol, max_iter=iterations))])</span><span id="27a1" class="lb ir hi kx b fi lg ld l le lf">run_params = {'C': tol, 'max_iter': iterations}</span><span id="ad95" class="lb ir hi kx b fi lg ld l le lf">train_pipeline.fit(X_train, y_train)</span><span id="1b2a" class="lb ir hi kx b fi lg ld l le lf">return train_pipeline.log_model('model', X_test, y_test, experiment_name, run_name, run_params=run_params)</span></pre><p id="c8e8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">当触发训练API时，执行run_train_pipeline方法。该方法的目的是将数据分为训练集和测试集，初始化训练管道类，拟合模型并记录模型度量和工件。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="1caa" class="lb ir hi kx b fi lc ld l le lf">@app.route('/train', methods=['POST'])</span><span id="25bf" class="lb ir hi kx b fi lg ld l le lf">def train():</span><span id="9195" class="lb ir hi kx b fi lg ld l le lf">if request.method == 'POST':</span><span id="cba5" class="lb ir hi kx b fi lg ld l le lf">csv_file = request.files['train_file']</span><span id="f61a" class="lb ir hi kx b fi lg ld l le lf">if csv_file == None:</span><span id="1794" class="lb ir hi kx b fi lg ld l le lf">raise ValueError('Train File is not provided.')</span><span id="8472" class="lb ir hi kx b fi lg ld l le lf">file_name = csv_file.filename</span><span id="995a" class="lb ir hi kx b fi lg ld l le lf">if file_name.split('.')[1] == 'csv':</span><span id="614a" class="lb ir hi kx b fi lg ld l le lf">clock_time = time.ctime().replace(' ', '-')</span><span id="7497" class="lb ir hi kx b fi lg ld l le lf">save_file = './temp/' + file_name.split('.')[0] + '_' + clock_time + '.csv'</span><span id="e380" class="lb ir hi kx b fi lg ld l le lf">csv_file.save(save_file)</span><span id="5d62" class="lb ir hi kx b fi lg ld l le lf">tol = float(request.form['tol'])</span><span id="ecf4" class="lb ir hi kx b fi lg ld l le lf">iterations = int(request.form['iterations'])</span><span id="83ff" class="lb ir hi kx b fi lg ld l le lf">experiment_name = request.form['exp_name']</span><span id="21fd" class="lb ir hi kx b fi lg ld l le lf">run_name = 'Train-Run-' + clock_time</span><span id="aee9" class="lb ir hi kx b fi lg ld l le lf">dia_df = pd.read_csv(save_file)</span><span id="e75c" class="lb ir hi kx b fi lg ld l le lf">metrics = run_train_pipeline(dia_df, tol, iterations, experiment_name, run_name)</span><span id="a301" class="lb ir hi kx b fi lg ld l le lf">return jsonify(metrics)</span><span id="380e" class="lb ir hi kx b fi lg ld l le lf">else:</span><span id="6885" class="lb ir hi kx b fi lg ld l le lf">raise TypeError('Invalid file type. App only accepts csv files.')</span></pre><p id="f1e5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里，我们公开了一个/train端点，可以调用它来发送数据和训练模型。整个管道将负责模型训练和记录。</p><h1 id="206c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结果</h1><p id="86b7" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">让我们讨论一下调用/train API后MLflow中生成的一些结果。我们从调用API开始，在请求体中发送文件、模型参数和实验名称。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/d4c3694044350fe588d3360f220174e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cjXa7rZOTC34iLwzA6-lQ.png"/></div></div></figure><p id="949d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">API会将指标作为响应返回给我们。但是培训管道已经在MLflow的后端记录了这些指标。以便我们可以比较模型性能的结果。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/434c0160b796c9d1b33cf4667680ce07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEDSNFByI8c9XHR75xDsFQ.png"/></div></div></figure><p id="dbfb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于这个例子，我尝试了不同的公差值，并相应地记录了度量标准。这是MLflow日志。</p><p id="64a0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里，MLflow仪表板显示了糖尿病训练实验下的各种运行。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/3e9682587c361995a9a73121c4c8cb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sOcwnSP7vWZEbQmFfkWQpA.png"/></div></div></figure><p id="6c73" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们甚至可以比较这些运行和可视化图形，并了解哪个模型表现更好。模型参数和指标都记录在MLflow中。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/6bda36138530712be50c8eb8c2ca622b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PkDC8gnZOCsA_z8Elge_2A.png"/></div></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/f2e433109acff84ae8bc11bd18b297fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36KAgIFMOa-NjcxMIqEGXQ.png"/></div></div></figure><p id="c878" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，回到实验，选择最佳模型。我们还可以在artifacts部分看到保存到MLflow中的模型，并为推断做好准备。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/a62ae90a95250ffe89198b0ccfdd346a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZtvEkQA54-g6a0hIXNK0jQ.png"/></div></div></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/ee0659b70e3b8b26246ff23a404db9bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3h1CDF0gOO9MmBmBPkVofQ.png"/></div></div></figure><p id="acbd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下面是用熊猫数据框架对模型进行评分的代码片段。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6cea" class="lb ir hi kx b fi lc ld l le lf">import mlflow </span><span id="6f4f" class="lb ir hi kx b fi lg ld l le lf">logged_model = 'runs:/7d75b57c996a4e788d9f9a4d492ee88a/diabetes-model'  </span><span id="1f4b" class="lb ir hi kx b fi lg ld l le lf"># Load model as a PyFuncModel. <br/>loaded_model = mlflow.pyfunc.load_model(logged_model)<br/>  <br/># Predict on a Pandas DataFrame. <br/>import pandas as pd <br/>loaded_model.predict(pd.DataFrame(data))</span></pre><h1 id="2b77" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="291a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">MLflow是维护ML模型和创建可重复实验的强大工具。本文通过一个小例子来说明如何在Scikit-Learn管道中实现MLflow。然而，MLflow的使用并不局限于Scikit-Learn，它也可以用于其他框架。</p><p id="9d5d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您喜欢这篇文章，并且您想自己尝试代码。这里是<a class="ae kr" href="https://github.com/iamrajatroy/Data-Science-Lab/blob/main/mlflow/train.py" rel="noopener ugc nofollow" target="_blank"> github链接</a>。</p></div></div>    
</body>
</html>