<html>
<head>
<title>Practical Issues in Data Science Part 2: Distribution Shift (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学中的实际问题第2部分:分布转移(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/practical-issues-in-data-science-part-2-distribution-shift-part-1-416754c01905?source=collection_archive---------3-----------------------#2021-04-09">https://medium.com/analytics-vidhya/practical-issues-in-data-science-part-2-distribution-shift-part-1-416754c01905?source=collection_archive---------3-----------------------#2021-04-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e3ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">众所周知，机器学习模型的性能在很大程度上依赖于自变量和目标变量之间的潜在关系。因此，如果底层数据分布存在偏移/漂移，它们的性能将会严重下降。这个实际问题通常被称为分配转移。</p><p id="54e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章作为这个主题的一个非常简短的介绍，主要集中在协变量转移和先验概率转移。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="8758" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">分配班次介绍</strong></h1><p id="89f6" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated"><strong class="ig hi">1.1<em class="km">。导致数据分布偏移的一些原因有:</em> </strong></p><ul class=""><li id="40f5" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">客户习惯的改变。</li><li id="ebc7" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">技术突破。</li><li id="90bb" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">政治或社会经济政策的变化。</li><li id="d8b3" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">样本选择偏差，其中训练数据不包括所有可能的数据分布(例如问卷和统计调查)。</li><li id="52ba" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">当发现数据随着时间的流逝而变化时。例如:对抗性分类问题(如电子邮件过滤或网络入侵检测)。</li></ul><p id="3cea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="km"> 1.2。三种类型的分配班次:</em> </strong></p><ul class=""><li id="fd37" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated"><strong class="ig hi">协变量移位:</strong>自变量的移位。</li><li id="89b3" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated"><strong class="ig hi">先验概率偏移:</strong>目标变量的偏移。</li><li id="e219" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated"><strong class="ig hi">观念转变:</strong></li></ul><p id="bd3d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">自变量和目标变量之间关系的变化。当独立变量和目标变量之间的未知或隐藏关系没有被模型包括或学习时，就会发生这种情况。</p><p id="73bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">示例:客户购买行为随时间的变化可能会受到数据中未明确说明的全球经济的影响。概念转变在时间序列数据中更为常见。</p><h1 id="4af0" class="jj jk hh bd jl jm lb jo jp jq lc js jt ju ld jw jx jy le ka kb kc lf ke kf kg bi translated"><strong class="ak">协变量移位简介</strong></h1><p id="f5d5" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated"><strong class="ig hi">2.1<em class="km">。</em>检测道反变</strong></p><ul class=""><li id="ddd6" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">可视化每个独立变量在训练集和测试集之间的分布。</li><li id="fb7a" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">用单向ANOVA检验进行统计检验。</li><li id="f8fa" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">利用机器学习模型进行对抗性验证。</li></ul><p id="64fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于前两种方法非常简单，因此下面只解释第三种方法。</p><p id="7706" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="km"> 2.1.1。利用机器学习模型进行对抗验证</em></p><p id="ef6d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一般来说，我们可以构建一个分类器，尝试用每个独立变量来区分训练集和测试集。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><p id="2b95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">流程的伪代码有:</strong></p><p id="05a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤1:创建一个名为“is_train”的新变量，其值在训练集中为1，在测试test中为零。</p><p id="9153" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二步:将训练集和测试集结合起来，随机洗牌。</p><p id="7989" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤3:将数据分成新的训练测试集。</p><p id="6652" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第四步:对于每个独立变量:</p><ul class=""><li id="d4c8" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">训练一个简单的机器学习模型(例如决策树)来预测“is_train”变量。</li><li id="c2c2" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">计算AUC。</li><li id="5368" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">通过设定AUC阈值，判断自变量是否受到协变量偏移的影响。</li></ul></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><p id="46f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="km"> 2.2。</em>应对方式反变</strong></p><p id="0c6e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些方法是:</p><ul class=""><li id="14d3" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">删除不重要的协变量移位自变量。</li><li id="6f35" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">进行密度比估计，以估计训练数据中每个实例的相对重要性(即密度)。</li></ul><h1 id="704e" class="jj jk hh bd jl jm lb jo jp jq lc js jt ju ld jw jx jy le ka kb kc lf ke kf kg bi translated"><strong class="ak">先验概率转移简介</strong></h1><p id="4a53" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated"><strong class="ig hi"> <em class="km"> 3.1。检测先验概率转移的方式</em> </strong></p><ul class=""><li id="9fff" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">可视化因变量在训练集和测试集之间的分布。</li><li id="199e" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">用t检验或单向ANOVA检验进行统计检验。</li></ul><p id="e4ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="km">额外:t检验和单向方差分析检验的差异</em> </strong></p><p id="ceea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="km">相似性:两者都侧重于组间均值和方差的差异。</em></p><p id="59bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="km">差异:t检验可用于确定两个群体在统计上的差异；而ANOVA可用于确定三个或更多的群体在统计上是不同的。</em></p><p id="cdfd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">3.2<em class="km">。应对先验概率转移的方法</em> </strong></p><ul class=""><li id="7e20" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">收集更多最近的数据，假设最近的数据具有相似的分布。</li><li id="2acd" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">只有相同分布数据的训练模型。</li></ul><h1 id="3854" class="jj jk hh bd jl jm lb jo jp jq lc js jt ju ld jw jx jy le ka kb kc lf ke kf kg bi translated">进行的实验简介</h1><p id="ac0a" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">图1显示了为了测试去除协变量和先验概率变化的效果而进行的各种实验。这里的实验范围是用这个<a class="ae lg" href="https://www.kaggle.com/nishiodens/japan-real-estate-transaction-prices" rel="noopener ugc nofollow" target="_blank">数据集</a>估计日本房地产价格(一个回归问题)。</p><p id="95ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个实验设置定义如下:</p><ul class=""><li id="9f48" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">基线:取测试数据的平均值，并假定为预测值。</li><li id="9127" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">all_features_all_years:包括所有训练数据。</li><li id="e888" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">dropped_all_years:删除移位的自变量(即处理协变量移位)并用所有年份的数据进行训练。</li><li id="92f1" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">dropped_2017:去除移位的自变量，只使用2017年的数据进行训练，因为它与测试数据具有相同的分布(即处理协变量和先验概率移位)。</li><li id="039f" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">dropped_2018:去掉移位的自变量，只用2018年的数据训练。这是要和dropped_2017对比的。</li></ul><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lh"><img src="../Images/17bcf8f49e5a32bf43b853db83ba1319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvRMo_04MdI0PZcFPFAMtQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">图1: dropped_2017是仅使用相同的分布来训练的模型，以测试数据以及移除偏移特征之后的特征。dropped_2017最小MAE。</figcaption></figure><p id="6f8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如我们从图1中看到的，解决协变量和先验概率转移的MAE最小。换句话说，重要的是部署的系统或程序能够检测到分布变化的存在，并采取行动进行反映。</p><p id="4175" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于完整的实现，请查看下面的Github链接获取源代码。</p><h1 id="7011" class="jj jk hh bd jl jm lb jo jp jq lc js jt ju ld jw jx jy le ka kb kc lf ke kf kg bi translated">源代码示例:</h1><p id="a7ad" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated"><a class="ae lg" href="https://github.com/JaniceKhor/distribution-shifts.git" rel="noopener ugc nofollow" target="_blank">https://github.com/JaniceKhor/distribution-shifts.git</a></p><p id="d2c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="km">参考文献</em> </strong></p><ol class=""><li id="0c1a" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb lx kt ku kv bi translated"><a class="ae lg" href="https://gsarantitis.wordpress.com/2020/04/16/data-shift-in-machine-learning-what-is-it-and-how-to-detect-it/" rel="noopener ugc nofollow" target="_blank">https://gsarantitis . WordPress . com/2020/04/16/data-shift-in-machine-learning-what-it-and-how-to-detect-it/</a></li><li id="eb40" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb lx kt ku kv bi translated"><a class="ae lg" href="https://www.section.io/engineering-education/correcting-data-shift/" rel="noopener ugc nofollow" target="_blank">https://www . section . io/engineering-education/correcting-data-shift/</a></li><li id="3f98" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb lx kt ku kv bi translated"><a class="ae lg" href="https://www.analyticsvidhya.com/blog/2017/07/covariate-shift-the-hidden-problem-of-real-world-data-science/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2017/07/co variate-shift-the-hidden-problem-of-real-world-data-science/</a></li><li id="0dbb" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb lx kt ku kv bi translated"><a class="ae lg" rel="noopener" href="/capital-one-tech/domain-adaptation-5955edf0277b">https://medium . com/capital-one-tech/domain-adaptation-5955 EDF 0277 b</a></li></ol></div></div>    
</body>
</html>