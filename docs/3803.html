<html>
<head>
<title>Chicago Crime Rate Forecasting using FbProphet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用FbProphet预测芝加哥犯罪率</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/chicago-crime-rate-forecasting-using-fbprophet-17757f45e9bb?source=collection_archive---------6-----------------------#2021-07-27">https://medium.com/analytics-vidhya/chicago-crime-rate-forecasting-using-fbprophet-17757f45e9bb?source=collection_archive---------6-----------------------#2021-07-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e949fb5ea02f40f754aa527559c3634e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_YiWnMSQ6pZ-jVXUmxkK2g.png"/></div></div></figure><p id="3fad" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇博文重点分析了2001年至2016年芝加哥的犯罪率，并根据历史趋势预测了2017年的犯罪率统计数据。芝加哥是美国最大的城市之一，该市的整体犯罪率，尤其是暴力犯罪率，<strong class="ir hi"> </strong>高于美国平均水平。数据集已从芝加哥警察局的CLEAR(公民执法分析和报告)系统获得，可在此<a class="ae jn" href="https://www.kaggle.com/currie32/crimes-in-chicago" rel="noopener ugc nofollow" target="_blank">下载</a>。该数据集包含16年的7，941，282个条目。数据集包含以下列:</p><ol class=""><li id="af8c" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated"><strong class="ir hi"> ID: </strong>犯罪事件的唯一标识符。</li><li id="0741" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">案例号:</strong>记录分配给事件的部门号。</li><li id="256a" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">日期:</strong>事件发生的日期。</li><li id="75e8" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">块:</strong>块事件的地址。</li><li id="c6aa" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> IUCR: </strong>伊利诺伊州统一犯罪举报代码。</li><li id="d6ec" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">主要类型:</strong>根据IUCR法典对犯罪的主要描述。</li><li id="c896" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">描述:</strong>事件的二级描述。</li><li id="8b8a" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">地点描述:</strong>事件发生地点的描述。</li><li id="016d" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">逮捕:</strong>判断正误罪犯是否被逮捕。</li><li id="c3ce" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">国内:</strong>判断事件是否与国内相关。</li><li id="9f58" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">巡逻区:</strong>一个巡逻区是最小的警务地理区域——每个巡逻区都有专门的警务巡逻车。</li><li id="56c3" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">地区:</strong>事件发生的地区。</li><li id="9e4f" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">选区:</strong>事件发生地的市议会区。</li><li id="221c" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">社区区:</strong>芝加哥有77个社区区。</li><li id="3d07" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">联邦调查局代码:</strong>根据联邦调查局国家事故报告系统(NIBRS)进行的犯罪分类。</li><li id="a641" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> X坐标:</strong>事件的X坐标。</li><li id="a9c3" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> Y坐标:</strong>事件的Y坐标。</li><li id="9823" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">年份:</strong>事件发生的年份。</li><li id="a2ed" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">更新日期:</strong>记录上次更新的日期和时间。</li><li id="a92d" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">纬度:</strong>事发的纬度。</li><li id="1ee7" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">经度:</strong>事发地点的经度。</li><li id="190d" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">地点:</strong>事发地点</li></ol><p id="efcf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意:这项研究严格意义上是出于教育目的，旨在帮助个人分析数据。由于这个原因，我使用了2001年至2016年的数据，而不是更近的数据。</p><h1 id="89b1" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">FB先知</h1><p id="6301" class="pw-post-body-paragraph ip iq hh ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm ha bi translated">脸书先知是一个时间序列预测模型，其核心是一个加性回归模型。它适用于具有强烈季节性影响的数据和几个季节的历史数据。Prophet对异常值、缺失数据和时间序列的剧烈变化也很稳健。与其他预测模型相比，Prophet提供了两个主要优势，<strong class="ir hi"> Prophet使创建合理、准确的预测变得更加简单</strong>和<strong class="ir hi"> Prophet预测可以以非专家直观的方式定制。</strong>FB prophet的四个主要组件包括:</p><ul class=""><li id="9bc5" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm lf ju jv jw bi translated">分段线性或逻辑增长曲线趋势。Prophet通过从数据中选择变化点来自动检测趋势的变化。</li><li id="6178" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm lf ju jv jw bi translated">使用傅立叶级数模拟的年度季节分量。</li><li id="3091" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm lf ju jv jw bi translated">使用虚拟变量的每周季节性成分。</li><li id="1a42" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm lf ju jv jw bi translated">用户提供的重要节假日列表。</li></ul><h1 id="e316" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">数据分析</h1><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es lg"><img src="../Images/11e99f991ff6f467c0c564aa9ca8cafe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*8p1bUWr10MUUa8SNzLvIbg.png"/></div></figure><p id="3746" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从上图可以看出，犯罪数量从2006年开始急剧上升，然后在2011年开始下降。自2011年以来，我们可以看到犯罪数量呈下降趋势。在这一点上，我提出一个假设，芝加哥的<strong class="ir hi">犯罪将在2017-2018年继续减少。</strong></p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/212e2491a86088ef285dba235aa2ff16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfnkAz46OiFrkeDSs4GgWg.png"/></div></div></figure><p id="bc2e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">芝加哥警察局成功地减少了犯罪总数。蓝色条显示没有导致逮捕的犯罪，橙色条显示导致逮捕的犯罪。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/464b850678e8b6e6ce728447015fef67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FHD2up0dCR1VOm3EbUv4-w.png"/></div></div></figure><p id="2d62" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">第8区的犯罪率最高，第20区的犯罪率最低。(第13、21、23和31区的犯罪率为零，这可能是因为数据不完整)</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/f74267feeb2c91fda05d37c74f286f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gchKUqTAWMNVLOx3JxTp0A.png"/></div></div></figure><p id="a84f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">图表显示，芝加哥的街道是最不安全的，街道上的犯罪数量是人行道上犯罪数量的两倍多。</p><p id="19bf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在下图中，你可以看到盗窃是芝加哥最常见的犯罪，只有10%的盗窃案导致逮捕，其余的仍未破案。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/1aa292d30cd71b3fb914e165aa511e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*laoY7pQT89o7nPuDBhxuVQ.png"/></div></div></figure><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/3a3ca0b72598356b621acde7b3880454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2G1gRF0AhbyjP56hUtUoXA.png"/></div></div></figure><p id="b873" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">橙色标记表示导致逮捕的罪行，蓝色标记表示不会导致逮捕的罪行。只有在一小部分犯罪中，罪犯被逮捕。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/8f40bdb10bb3d66f7612ff5909d16741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hC4wF_o-RxWn9ZqPnX3b8Q.png"/></div></div></figure><p id="f9c1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该图显示犯罪是否是家庭犯罪，橙色标记显示与家庭相关的犯罪，蓝色标记显示非家庭犯罪。</p><h1 id="43df" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">模型拟合</strong></h1><p id="919f" class="pw-post-body-paragraph ip iq hh ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm ha bi translated">按照以下步骤下载FbProphet:</p><pre class="lh li lj lk fd lr ls lt lu aw lv bi"><span id="9e24" class="lw kd hh ls b fi lx ly l lz ma">1. conda create -n fbp python=3.8.8</span><span id="63dc" class="lw kd hh ls b fi mb ly l lz ma">2. conda activate fbp</span><span id="4eef" class="lw kd hh ls b fi mb ly l lz ma">4. conda install numpy cython -c conda-forge<br/><br/>5. conda install matplotlib scipy pandas -c conda-forge</span><span id="c38c" class="lw kd hh ls b fi mb ly l lz ma">6. conda install pystan -c conda-forge</span><span id="266f" class="lw kd hh ls b fi mb ly l lz ma">7. conda install -c conda-forge fbprophet</span></pre><p id="f002" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将模型拟合到包含特定日期的犯罪日期和数量的数据框架中。使用以下命令重命名数据帧:</p><pre class="lh li lj lk fd lr ls lt lu aw lv bi"><span id="549d" class="lw kd hh ls b fi lx ly l lz ma">df = df_prophet.rename(columns={'Date':'ds', 'Crime_count': 'y'})</span></pre><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es mc"><img src="../Images/3cc9673e8463bfabe7b34e7d0630b703.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*dd7uzJ2rBv1k7kL2wjLT4g.png"/></div></figure><pre class="lh li lj lk fd lr ls lt lu aw lv bi"><span id="a38c" class="lw kd hh ls b fi lx ly l lz ma"><strong class="ls hi">from</strong> <strong class="ls hi">fbprophet</strong> <strong class="ls hi">import</strong> Prophet</span><span id="a268" class="lw kd hh ls b fi mb ly l lz ma">prophet = Prophet()<br/>prophet.fit(df)</span><span id="fa6c" class="lw kd hh ls b fi mb ly l lz ma">forecast = prophet.predict(<br/>prophet.make_future_dataframe(periods=365))</span><span id="8e65" class="lw kd hh ls b fi mb ly l lz ma">figure = prophet.plot(forecast, xlabel='Years', ylabel='Crime Rate')</span></pre><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/e79756762b264639e556eae1c79f3ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHFe_qemk20sHFhLS97Zcw.png"/></div></div></figure><h1 id="6bce" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结果</h1><p id="0b0c" class="pw-post-body-paragraph ip iq hh ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm ha bi translated">该图显示了2017-18年的负面趋势，这符合我们最初的假设，即芝加哥正日益成为一个越来越安全的城市。</p><p id="0aa8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，使用FbProphet，我们还可以分析以下图表:</p><pre class="lh li lj lk fd lr ls lt lu aw lv bi"><span id="8ccf" class="lw kd hh ls b fi lx ly l lz ma">figure = prophet.plot_components(forecast)</span></pre><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/f37456e29435c1e415e9f09da17d6baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dq2QUvMCWvZua2BWVJiR4Q.png"/></div></div></figure><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/08f8d89591df2a39cde3e9fb40c31e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0IRqwBvNIOcVaH16JrcrA.png"/></div></div></figure><p id="7a75" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该图显示了3月1日至5月1日的最高犯罪率和11月1日至3月1日的最低犯罪率。</p></div></div>    
</body>
</html>