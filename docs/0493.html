<html>
<head>
<title>Google BigQuery Machine Learning (BQML) on Covid-19 Data set</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">新冠肺炎数据集上的Google BigQuery机器学习</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/google-bigquery-machine-learning-bqml-on-covid-19-data-set-3685f8887275?source=collection_archive---------15-----------------------#2021-01-18">https://medium.com/analytics-vidhya/google-bigquery-machine-learning-bqml-on-covid-19-data-set-3685f8887275?source=collection_archive---------15-----------------------#2021-01-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="67a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编写ML算法是一项单调乏味的工作，需要你了解很多东西，包括Python、R、Ruby等强大的编程能力。但是，如果我们可以使用每个人都喜欢的简单易用的SQL语句来实现复杂的ML算法，那会怎么样呢？一些新时代的云数据仓库应用程序正在提供SQL模式ML。毫无疑问，Bigquery在这个列表中名列前茅。</p><p id="c304" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">BigQuery机器学习(BQML)使用户能够使用SQL查询在BigQuery中创建和执行机器学习模型。BQML的好处是</p><ol class=""><li id="f606" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">用简单的SQL语句训练和部署ML模型</li><li id="b660" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">不需要从Bigquery移动数据</li><li id="2c6f" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">自动化ML任务</li></ol><p id="3be7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">BigQuery在回归、分类、聚类、推荐/个性化、时间序列和深度学习方面提供了ML模型</p><p id="31fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jq">线性回归<br/>逻辑回归<br/>多类逻辑回归<br/> K均值聚类<br/>矩阵分解<br/>时间序列<br/>提升树(XGBoost) <br/>深度神经网络<br/> Auto ML <br/> TensorFlow模型</em></p><h1 id="a3bc" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">分析新冠肺炎数据集</strong></h1><p id="868e" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">从ka ggle(<a class="ae ku" href="https://www.kaggle.com/arashnic/covid19-case-surveillance-public-use-dataset" rel="noopener ugc nofollow" target="_blank"><em class="jq">https://www . ka ggle . com/arashnic/covid 19-case-supervision-public-use-dataset</em></a>)获取了10 GB大小的新冠肺炎数据集，我们正试图根据年龄、种族和民族、医院条件找出死亡率。</p><p id="1e58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们先看一下数据集</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/c6d510069e9f3f3452937a01cb4445f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DwoPXr5ho9qRfD-K0oI5Yg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">新冠肺炎数据集峰值</figcaption></figure><p id="55c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据上述数据，目的是预测性别、种族、年龄、医院状况、ICU状况和医疗条件如何影响死亡率(death_yn)</p><p id="7743" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">特征集</strong>:【性别、年龄、年龄组、种族和伦理、当前状态、医院、重症监护室、医疗条件】</p><p id="8c67" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">标签</strong>:死亡_yn</p><p id="7355" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">模型</strong>:逻辑回归</p><h1 id="0f5b" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">步伐</h1><ol class=""><li id="bfb9" class="jc jd hh ig b ih kp il kq ip ll it lm ix ln jb jh ji jj jk bi translated">将数据加载到Bigquery</li><li id="82bf" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">设置培训数据</li><li id="914c" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">创建模型</li><li id="1545" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">评估模型</li><li id="c43b" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">预测模型</li></ol><p id="ecbf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">加载数据:第一步是将数据集摄取到Google Cloud中。由于是10 GB的文件，所以无法通过UI将文件直接上传到Bigquery。另一种方法是将文件上传到Google云存储中，然后在云存储上的Bigquery中创建外部表，或者将其从GCS加载到Bigquery中作为原生表</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lo"><img src="../Images/d531ff3c39f8ce7085ae2795d951a30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQfRR9kEo-D6UGV4pdyY3A.png"/></div></div></figure><p id="04e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">设置训练/测试数据:一旦数据以表的形式进入Bigquery，我们就可以使用BQML了。为了避免每次SQL扫描的额外数据成本，让我们在表的顶部创建一个具有有限列(如功能、标签)的视图，并将数据集分为训练、评估和预测(测试)数据。您可以看到，80%的数据用于培训，10%用于评估和预测。你可以用更好的方法来分割数据。但这只是给你如何分割它的一般概念。视图创建不需要任何数据扫描。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lp"><img src="../Images/7d950416c343e24e2635a6feffac3542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ltd0Nf-PunCqIj8s1gQD3w.png"/></div></div></figure><p id="4163" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建模型:让我们创建一个模型，我们已经有了特征和标签以及它的分类问题，所以让我们用BQML定义逻辑回归模型</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lq"><img src="../Images/81589e2fec3b6fd7f0f22ed953e9de3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IU5W-vs7RwaKRk9GdH_MDg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">BQML逻辑回归</figcaption></figure><p id="066c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，创建7.5 GB数据的模型花费了7分钟。BQML在hood下生成张量流代码，进行数据预处理和模型训练。您还可以通过在SQL中指定附加参数来进行功能工程和超参数调整BQML。一旦生成了模型，就可以在Bigquery数据集中对其进行检查。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lr"><img src="../Images/ba635c3420989116eebbb53605cbb445.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TfYbiSqT7tyXN-K0x_q2XA.png"/></div></div></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ls"><img src="../Images/07963ba7aa0e1f7082534c6ff64ee570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M7B8GMpCjOkAypEXHRAl9w.png"/></div></div></figure><p id="9c1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">理解模型效率的关键指标是准确性和混淆矩阵。这个模型的准确性看起来不错74%。我确信这可以通过ML调优机制得到改善，这是一个不同的主题，也是一个相当大的主题，我现在正在研究这个主题</p><p id="ce93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">评估模型:<code class="du lt lu lv lw b">ML.EVALUATE</code>函数接受由<code class="du lt lu lv lw b">SELECT</code>子查询训练的模型和返回的评估数据。该函数返回关于模型的单行统计信息。该查询使用来自<em class="jq"> covid-data-view </em>的数据作为评估数据。<code class="du lt lu lv lw b">WHERE</code>子句过滤输入数据，以便子查询只包含<code class="du lt lu lv lw b">evaluation</code>数据帧中的行</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lx"><img src="../Images/b5e9fda39d71c67db7c88f82b6649e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sIT7Rs0T2ZzzdsgeqaSApw.png"/></div></div></figure><p id="2ab3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">预测模型:一旦模型被训练和评估，接下来的事情就是评估模型，看它如何看待新数据。ML模型的整体思想是泛化。</p><p id="49bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lt lu lv lw b"><a class="ae ku" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-predict" rel="noopener ugc nofollow" target="_blank">ML.PREDICT</a></code>函数使用您的模型和covid-data-view中的数据来预测结果，这些数据经过过滤后只包含“预测”数据框架中的行。最顶层的<code class="du lt lu lv lw b">SELECT</code>语句检索<code class="du lt lu lv lw b">ML.PREDICT</code>函数的输出</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ly"><img src="../Images/01a86e29f95c93ac19c2127ca1a89c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTLk0znFWnBW3WU44gDgCQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">预言；预测；预告</figcaption></figure><p id="5003" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">前两列描述了预测值和每个可能值的概率。模型将最高可能值作为预测值。</p><p id="7404" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望它给你一些使用简单的SQL语句开发ML模型的感觉。这么简单不是吗？</p><p id="7759" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">目前就这些。</p></div></div>    
</body>
</html>