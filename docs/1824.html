<html>
<head>
<title>Using Sentiment Analysis to Predict the Stock Market</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用情绪分析预测股票市场</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-sentiment-analysis-to-predict-the-stock-market-77100295d753?source=collection_archive---------5-----------------------#2021-03-21">https://medium.com/analytics-vidhya/using-sentiment-analysis-to-predict-the-stock-market-77100295d753?source=collection_archive---------5-----------------------#2021-03-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6f24" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">财经新闻标题的情绪分析(使用Python)对股市走势有预测力吗？</h2></div><p id="65df" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我之前的<a class="ae jt" href="https://python.plainenglish.io/access-historical-financial-news-headlines-with-python-be1b8faaea9f" rel="noopener ugc nofollow" target="_blank">文章</a>中，我解释了如何<strong class="iz hj">用Python免费获取历史财经新闻头条</strong>。现在我们有了这些数据，我们可以验证新闻标题是否可以预测股市运动。</p><p id="432c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这篇文章和其他许多相同主题的文章的不同之处在于，由于我们获取数据的方式不同，我们可以进行长达1年的测试。正如我在之前的<a class="ae jt" href="https://python.plainenglish.io/access-historical-financial-news-headlines-with-python-be1b8faaea9f" rel="noopener ugc nofollow" target="_blank">文章</a>中所讨论的，许多来源或API很少或根本没有历史新闻标题。此外，一般来说，我们每天有超过30个标题，这是许多来源或API所不允许的。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/36d010997eff0daca427d8faacf7527f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GIquC6Igxh5JdR5TjumkrA.jpeg"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">由<a class="ae jt" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>上的<a class="ae jt" href="https://pixabay.com/users/pexels-2286921/" rel="noopener ugc nofollow" target="_blank">像素</a>拍摄</figcaption></figure><h1 id="83d7" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">1-获取历史每日收盘股票价格</h1><p id="f120" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">第一步是获得历史每日收盘数据，以计算我们要进行测试的股票的每日回报率。</p><p id="26ee" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如那句话所说:</p><blockquote class="lh li lj"><p id="e284" class="ix iy lk iz b ja jb ij jc jd je im jf ll jh ji jj lm jl jm jn ln jp jq jr js hb bi translated">垃圾进，垃圾出</p></blockquote><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lo"><img src="../Images/a0d99d104d3a9acb00b4fd7f0de1fc82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fl2478fzHTXIDXNHEMuu3Q.jpeg"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/@hngstrm" rel="noopener ugc nofollow" target="_blank">亨利&amp;公司</a>在<a class="ae jt" href="https://unsplash.com/photos/cZpvuwwQQg0" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="fefd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出于这个原因，拥有一个好的数据集是数据分析的一个基本部分，如果不是最关键的部分的话。</p><p id="9751" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是为什么从Alpha Vantage API中提取每日历史股票价格的原因。Finnhub API中没有指定每日收盘是否根据股票分割和股息进行调整。</p><p id="d82d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要调用Alpha Vantage的API，您需要您的唯一密钥，您可以在这里获得<a class="ae jt" href="https://www.alphavantage.co/support/#api-key" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="0a9e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用API键的一个好的实践是<strong class="iz hj">将它存储为一个环境变量</strong>(关于如何做的好文章<a class="ae jt" href="https://able.bio/rhett/how-to-set-and-get-environment-variables-in-python--274rgt5" rel="noopener ugc nofollow" target="_blank">在这里</a>)。代码中的关键变量名作为环境变量存储在<code class="du lp lq lr ls b">.env</code>文件中，如下所示:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="491d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以导入所需的模块，从Alpha Vantage API中获取每日历史股票价格。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="8071" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我们可以构建一个类来初始化Alpha Vantage API所需的属性。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="ecc5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后我们可以创建一个从Alpha Vantage API获取数据并计算每日回报的类(接下来两个要点)</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h1 id="a05d" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">2-运行情感分析并计算分数</h1><p id="6faf" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">我们用VADER情绪分析器(nltk . perspective . Vader)对财经新闻标题进行情绪分析。</p><p id="430b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于每个标题，复合得分返回一个介于-1(最极端的负面标题)和1(最极端的正面标题)之间的标准化值。然后，我们通过对当天获得的单个标题的所有得分进行平均来创建每日得分。</p><p id="45b7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了尽可能准确，脚本分析了从9:30(美国东部时间)到9:29(美国东部时间)的新闻标题，正好在常规交易开始之前(北美市场)。</p><p id="6329" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们导入所需的模块:</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="6105" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，我们为VADER情感分析器创建一个类。我们要做的第一件事是初始化属性和参数。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="d74e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们现在可以使用VADER对新闻标题进行情感分析。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="2b02" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意，在这个方法中，我们有两个装饰器<code class="du lp lq lr ls b">@init_sql</code>，用于打开、保存和关闭数据库，还有<code class="du lp lq lr ls b">@iterate_day</code>，用于对期望时间段内的新闻标题进行情感分析。</p><p id="6af9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">方法<code class="du lp lq lr ls b">check_size()</code>确保我们有足够的标题来运行情感分析，使其具有统计学意义(默认的最小大小是30)</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h1 id="bf0d" class="kk kl hi bd km kn ko kp kq kr ks kt ku io kv ip kw ir kx is ky iu kz iv la lb bi translated">3-将滞后指数与每日收盘回报相关联</h1><p id="fec4" class="pw-post-body-paragraph ix iy hi iz b ja lc ij jc jd ld im jf jg le ji jj jk lf jm jn jo lg jq jr js hb bi translated">这是最后一步。注意，如前所述，这篇文章是在这篇<a class="ae jt" href="https://python.plainenglish.io/access-historical-financial-news-headlines-with-python-be1b8faaea9f" rel="noopener ugc nofollow" target="_blank">文章</a>之后，在这篇文章中我们获得了历史金融新闻标题。当前代码是使用上一篇文章中的目录和数据库(SQL)编写的。如果你决定使用不同的来源来获取财经新闻标题，一定要注意这一点。</p><p id="0807" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们需要导入所需的模块。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="dd75" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们创建一个类来初始化项目所需的“全局”值。</p><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="0165" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们对照前一天亚马逊上的金融新闻标题的情绪分析，绘制股票的每日回报(在这种情况下是亚马逊):</p><pre class="jv jw jx jy fd lv ls lw lx aw ly bi"><span id="568b" class="lz kl hi ls b fi ma mb l mc md">init_.pd_data.plot(x =init_.sentiment_name,y=init_.daily_return,style = "o")</span></pre><p id="53a4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还计算这两者之间的相关性:</p><pre class="jv jw jx jy fd lv ls lw lx aw ly bi"><span id="1fa3" class="lz kl hi ls b fi ma mb l mc md">print(init_.pd_data[init_.daily_return].corr(init_.pd_data[init_.sentiment_name]))</span></pre><figure class="jv jw jx jy fd jz"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="b848" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我们得到的图表，显示每日回报率和新闻标题的情绪得分之间的相关性很小甚至没有。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es me"><img src="../Images/5a85ee59e50549061f890802f2832fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Qgzde2Q2dSm_gJiayfyo9w.png"/></div></figure><p id="3a8d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如下所示的相关性接近于0，表明几乎没有相关性。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mf"><img src="../Images/7d37853d295cf8f8c5d17e4151e4505c.png" data-original-src="https://miro.medium.com/v2/resize:fit:364/format:webp/1*JHKE3UNRdElqfNzG3A8YrA.png"/></div></figure></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="044d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这对你有所帮助。如果您有任何意见、反馈和想法，请留下。我会很感激的。</p><p id="683f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">项目回购的链接是<a class="ae jt" href="https://github.com/philippe-ostiguy/sentiment_analysis" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><p id="8744" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<a class="ae jt" href="https://www.linkedin.com/in/philippe-ostiguy/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上或通过ostiguyphilippe@gmail.com<a class="ae jt" href="mailto:ostiguyphilippe@gmail.com" rel="noopener ugc nofollow" target="_blank">与我进一步讨论</a>！</p></div></div>    
</body>
</html>