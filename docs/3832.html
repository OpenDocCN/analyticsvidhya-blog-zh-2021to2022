<html>
<head>
<title>Forecasting my beloved Arsenal performance for EPL 2021/22 season using Prophet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Prophet预测我心爱的阿森纳在EPL 2021/22赛季的表现</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/forecasting-my-beloved-arsenal-performance-for-epl-2021-22-season-using-prophet-ea6167825b11?source=collection_archive---------9-----------------------#2021-07-30">https://medium.com/analytics-vidhya/forecasting-my-beloved-arsenal-performance-for-epl-2021-22-season-using-prophet-ea6167825b11?source=collection_archive---------9-----------------------#2021-07-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5c3ac168112e15dfb8f5874daae3910d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mucrz3c5mZfcXSIZ8fJ1nA.png"/></div></div></figure><p id="01d5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我是一个超级阿森纳球迷，老实说，我有点痴迷于他们。我的大部分空闲时间都用来观看阿森纳过去踢过的精彩比赛。尽管我说他们做得不好，但这对整个足球世界来说是一个令人担忧的迹象，因为在我看来，阿森纳踢了过去十年中最有趣的足球，仅次于巴塞罗那的年轻一代。由于我喜欢机器学习，我有这个想法来预测阿森纳在即将到来的2021/22赛季英超联赛中会获得多少分。所以我想建立一个预测解决方案的模型，并在这里尝试预测阿森纳在接下来的赛季中会得到的结果和积分。因此，让我们马上着手解决这个问题。</p><p id="9eca" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">数据准备:</strong></p><p id="72c1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了创建任何模型，我们至少需要最少量的数据，所以在这里我使用了一个web scraper包<a class="ae jn" href="https://pypi.org/project/html-table-parser-python3/" rel="noopener ugc nofollow" target="_blank">html-table-parser-python 3</a>，它从我们搜索的网站上抓取表格。请跟随这个来自<a class="ae jn" href="https://www.geeksforgeeks.org/scrape-tables-from-any-website-using-python/" rel="noopener ugc nofollow" target="_blank">极客帮极客</a>的例子来了解更多。在我们的例子中，我只刮到了阿森纳过去三个赛季(即2018-2021)的EPL成绩。因此，当你浏览网站时，你会看到网站上有很多表格。举例来说，当我刮阿森纳的一个赛季时，我碰巧看到了下面的表格。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es jo"><img src="../Images/a2fef4ffdd05801ee353dfbaf9c94f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*lx4Hb1SAzeypaGdyUcpeUA.png"/></div></figure><p id="6b8b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，表以列表的形式出现，这些列表必须转换成数据框才能进一步处理。在检索这些表之后，我们需要做一些基本的处理，将它们转换成模型可消费的方式。请找到我使用的处理步骤，你可以添加更多的功能，如果希望进一步</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jt ju l"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">代码片段</figcaption></figure><p id="103c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上面的代码片段将添加一些功能，如裁判、球队是否有主场优势、比分等。我们可以添加其他功能，如温度，天气，每支球队的护身符球员，节日效果和所有这些功能也将有助于建模很多。因此，我们最终的数据帧将如下所示。我又创造了一个变量<strong class="ir hi"><em class="jz">【PI】</em></strong>，它告诉我们阿森纳赢得那场比赛的相对概率。该特性的推导在下面的<a class="ae jn" href="https://www.kaggle.com/vishnunkumar/data-preparation" rel="noopener ugc nofollow" target="_blank">笔记本</a>中完成。基本上，它根据每个对手在前几个赛季相对于阿森纳的积分得出一个数值。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="542b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">基础EDA: </strong></p><p id="5e4e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于我们已经完成了数据的预处理，让我们在数据集上做一个简单的EDA，以了解阿森纳在特定条件下的表现。</p><ul class=""><li id="768b" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated"><strong class="ir hi">主场优势:</strong></li></ul><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="kj ju l"/></div></figure><p id="303c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如任何球队在任何运动中所期望的那样，阿森纳在主场比赛时也获得了更多的分数。</p><ul class=""><li id="7256" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated"><strong class="ir hi">裁判影响:</strong></li></ul><p id="1d6e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由裁判为阿森纳执法的比赛</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="kj ju l"/></div></figure><p id="052a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因为大多数比赛都是由这六位裁判执法的:迈克尔·奥利弗、阿特金森、安东尼·泰勒、j .莫斯、M .迪恩和p .蒂尔尼。在比赛如何进行的问题上，每个队肯定都有很多发言权。</p><p id="9dc5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当比赛由不同的裁判执法时得到的分数</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="kj ju l"/></div></figure><p id="7939" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">考虑到阿森纳的历史，在过去的三个赛季中，当麦克·迪恩执法时，阿森纳获得了更多的积分，这是一个奇怪的事实。近年来形势已经发生了变化，也许麦克·迪恩真的不喜欢温格。</p><p id="eec5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">造型</strong></p><p id="bb89" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因为我把这当成一个预测问题，所以让我们试试来自脸书的开源库，为时间序列<a class="ae jn" href="https://facebook.github.io/prophet/" rel="noopener ugc nofollow" target="_blank"> fbprophet </a>建模。那么我们先简单了解一下什么是时间序列，简单来说任何依赖于时间为变量的序列都是时间序列。基本上，时间序列由三部分组成</p><ul class=""><li id="ee35" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated">趋势:它是时间序列随时间移动的方式，即它如何变化(不系统变化的长期成分)</li><li id="87e4" class="ka kb hh ir b is kk iw kl ja km je kn ji ko jm kf kg kh ki bi translated">季节性:该部分表示时间序列的循环性质，即时间序列的重复程度——每周、每月、每年等。(具有循环或周期性波动的短时间成分)</li><li id="7a5d" class="ka kb hh ir b is kk iw kl ja km je kn ji ko jm kf kg kh ki bi translated">残差:非理想时间序列的剩余部分。如果我们计算时间序列的季节性和趋势部分，我们将得到时间序列的理想情景，但残差是使它们区别于理想情景的因素。(不规则的波动)</li></ul><p id="5a61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">时间序列通常具有两种性质:加法和乘法。如果你的季节性成分加入到你的趋势中，那么它是相加的，如果你的季节性随着你的趋势快速变化，那么它基本上是一个相乘的时间序列。</p><p id="1afe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于Prophet期望输入数据是某种格式的，所以我们必须按要求处理数据。因为数据只有每场比赛的分数，所以让我们分别得到每个赛季的累计分数。最后，训练数据如下所示。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kp"><img src="../Images/acb45eaa26783531ff648e57227b1c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlYg1VmTBSVsFPJmfe3vYA.png"/></div></div></figure><p id="30b9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如我们所见，该序列具有倍增的季节性，因为季节性项会发生变化，或者高度依赖于趋势。因为prophet只需要日期和值列，所以我们只能使用这两个列，除非我们想使用一些回归变量。</p><p id="d36c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Prophet接受两个变量作为输入，一个是日期列，另一个是要训练和预测的值，我们可以修改参数，如季节性、回归变量、如何拟合季节性和趋势项的约束。</p><ul class=""><li id="84a9" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated">让我们尝试在没有任何回归变量的情况下，仅使用每个季节的累积点作为因变量来对数据进行建模。因此，训练数据如下所示，拟合模型后，我们得到以下结果</li></ul><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kq"><img src="../Images/21a931b93cd5ead2ae7db12aafb5b41c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*Vdnvfcp_tQBqBalfLfk8sQ.png"/></div></figure><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jt ju l"/></div></figure><ul class=""><li id="7865" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated">使用关于游戏是在家玩还是在外玩的信息。</li></ul><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kr"><img src="../Images/7e8f5005fce96f29990eef6816eae576.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*T-eW-c4gnAwmorXG6YE05w.png"/></div></figure><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jt ju l"/></div></figure><ul class=""><li id="9950" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated">添加关于裁判和主场优势的信息</li></ul><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kq"><img src="../Images/60d3a179019aec414aa17d106cfcaad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*E63RdkIlSCVILBcsaGLeWg.png"/></div></figure><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="b91f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从上面的图和预测中我们可以看出，回归变量对训练有很大的影响，有了更多的回归变量，我们可以更好地训练模型并提高其效率。在第一种情况下，没有任何回归变量，模型似乎只适合之前看到的系列值，而在第三种情况下，我选择了过去三个赛季中为阿森纳执法最多比赛的前五名裁判，以及他们在哪里参加这些比赛的信息。另一种改进时间序列预测的方法是尝试建模的滚动方法，我们用数据窗口训练模型，因为这种方法只考虑最近的历史数据，而忽略了过去的历史数据，你可以查看我在下面的另一篇文章</p><div class="ks kt ez fb ku kv"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/time-series-forecasting-in-a-simple-way-29b363e5be06"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hi fi z dy la ea eb lb ed ef hg bi translated">用简单的方法进行时间序列预测</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">你听过预言这个词吗？如果不是，让我用简单的方式告诉你。如果有人告诉你，你是我的唯一…</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">medium.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj in kv"/></div></div></a></div><p id="9652" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了说明滚动法预测如何改善Prophet等自回归模型的结果，我在整个数据集的前两个季度拟合了模型，并在第三个季度进行了预测，您可以看到如下结果:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/fc7d64e625017d0b9a83e4bcf4d3a2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*abQ0MTNv_s75r9-0bZtB0w.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">一次性预测</figcaption></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/09386de2675d9f35a69fc030f43f211e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAlu0SiIqN_v_R5uzANhug.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">窗口7滚动预测—即一周内的培训</figcaption></figure><p id="e71e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在第一幅图中，我拟合了前两个赛季的模型，并对整个第三个赛季进行了预测，而在第二幅图中，我通过向训练数据集添加7天进行了增量训练，并对随后的7天进行了预测。你可以在我提到的文章中找到更多关于这个逻辑的内容。这里的问题是，当你减小窗口大小时，结果会改善，但如果我们使用自回归模型，这并不总是你的理想情况。理想情况下，所需的数据量与预测范围成正比。</p><p id="8575" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后但同样重要的是，我预测了阿森纳在2021-22赛季将获得的积分，输入变量是日期，主客场比赛，PI值。结果如下:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/41f9732455944cea2e610eb35d626d91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A0FcDziYIDd0K7T-bcx9Hw.png"/></div></div></figure><p id="e6c2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">看起来阿森纳可能在最后一个比赛日得到65分，这可能非常接近或远离实际值，但如果我们包括更多的特征，如谁打了更多的比赛，天气条件，比赛时间等，我们可以取得更好的结果。我将致力于此，并尝试改进模型，看看我能否预测到2022年5月的实际值。现在我的预测是他们最终会得到65分。</p><p id="bb2b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以从这里找到相关的笔记本:</p><ul class=""><li id="8ba1" class="ka kb hh ir b is it iw ix ja kc je kd ji ke jm kf kg kh ki bi translated"><a class="ae jn" href="https://github.com/Vishnunkumar/football_analytics/blob/main/Forecasting_time-series/prophet-forecasting.ipynb" rel="noopener ugc nofollow" target="_blank">预测-笔记本</a></li><li id="b15e" class="ka kb hh ir b is kk iw kl ja km je kn ji ko jm kf kg kh ki bi translated"><a class="ae jn" href="https://github.com/Vishnunkumar/football_analytics/blob/main/Forecasting_time-series/Table_parsers.ipynb" rel="noopener ugc nofollow" target="_blank">预处理-笔记本</a></li></ul><p id="ec86" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">伙计们，我非常感谢你们在这期间给我的时间和支持。注意安全，保重。下次再见。</p></div></div>    
</body>
</html>