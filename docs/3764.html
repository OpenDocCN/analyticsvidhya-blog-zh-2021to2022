<html>
<head>
<title>How to create a simple and effective Discord Bot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个简单有效的不和谐机器人</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-simple-and-effective-discord-bot-4af3128454cf?source=collection_archive---------3-----------------------#2021-07-24">https://medium.com/analytics-vidhya/how-to-create-a-simple-and-effective-discord-bot-4af3128454cf?source=collection_archive---------3-----------------------#2021-07-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/589e4c28e9a35fc5dfdfbd722a9d4c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkDHFao9Y4pL8JnKbJQxOA.jpeg"/></div></div></figure><h1 id="88ec" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">背景</h1><p id="9b00" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我决定创建一个Discord bot来试验discord.py库，并在此过程中享受一些乐趣。如果你不知道什么是Discord，这是一个主要由游戏玩家使用的消息应用程序，可以用来与人交谈和发短信。我每天都使用Discord，因为它使与朋友的互动变得快速而简单。然而，有些时候，我想在不说话的情况下进行社交。当我父母很忙或者我没有心情说话的时候，我不喜欢制造太多的噪音。这就是为什么我创建了一个机器人，允许你输入一些文本，机器人会在语音通话中向其他用户朗读出来。我将向您展示我是如何做到这一点的。</p><h1 id="3fa8" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">创建机器人</h1><p id="f761" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在创建机器人之前，你必须创建一个不一致的帐户。导航到<a class="ae kl" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank">https://discord.com/developers/applications</a>，你会被提示创建一个。只需输入一个电子邮件地址和所需的密码就可以继续了。您应该会在页面的右上角看到一个新的应用程序按钮。这标志着你的新不和谐机器人的诞生，所以给它一个你选择的名字，然后点击创建。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/6a11b9e03b550042a30bba568b607064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpsN3YXvzgUBNdaUuOuLBg.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">右上角的新应用程序按钮</figcaption></figure><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/272ef44ef53370a5b6e582a7d12929f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gSQDKClcXYtUSv5Oq0paJw.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">命名和创建你的不和谐机器人</figcaption></figure><p id="b4e4" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">你创造了一个不和谐机器人！然而，在我们真正开始对文本到语音的特性进行编码之前，还有一些进一步的设置。在左侧，您想要导航到Bot面板。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/a518312f0e0b903c191392eef2ef27ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2oFpKnR0AkWLAC4rNAXiMw.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">你从一般信息开始，所以只需点击下面的机器人面板</figcaption></figure><p id="24c9" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">下一步，点击添加机器人和定制你喜欢的东西。如果您愿意，您可以更改您的机器人的个人资料图片和名称。然后，导航到上面的OAuth2面板并向下滚动。为了方便起见，选择bot和Administrator。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/86928e5b3cfd6889dd64419db55e1aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKsnJyMGxNaxUBlRVUk8rg.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">选择范围后，Bot权限选项将可用</figcaption></figure><p id="1137" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">我们几乎完成了机器人的设置。让这个页面保持原样，打开一个新标签，输入https://discord.com/channels/@me<a class="ae kl" href="https://discord.com/channels/@me" rel="noopener ugc nofollow" target="_blank"/>。为你的机器人做一个测试服务器是个好主意，因为它就像一个允许你犯错的游乐场。当你还在工作的时候邀请你的机器人进入一个已经存在的服务器是一个糟糕的主意，因为它可以执行你不希望它执行的动作。转到右侧，单击加号添加服务器。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/2ad78a0af7d14c76cde5e7ca0d779811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mfBFpIdT3LdR9zcAHbr8lg.png"/></div></div></figure><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es la"><img src="../Images/742336849493acb476e80f06553eff0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTExD8wS04oA-wylR2NQsQ.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">您可以为以下问题列出任何内容，因为它们不会影响任何内容</figcaption></figure><p id="44b8" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">创建好服务器后，您就可以邀请您的机器人了。要邀请它，请返回到Discord开发者页面并复制OAuth2面板中的链接。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/24629af928f16e9da8a19418c45ce8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLqkgmx1O6-wbe6enfB4uA.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">单击复制</figcaption></figure><p id="e6f8" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">在新选项卡中输入此链接，并选择您刚刚创建的服务器。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es km"><img src="../Images/473f4c7eac44a31579e6528538eea783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kNJULTV_y48e86viMavaEw.png"/></div></div></figure><p id="0a75" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">单击继续，然后授权并完成验证码，最后邀请您的机器人到您的服务器。这就完成了bot设置。</p><h1 id="ec7b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">编写机器人代码</h1><p id="614c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">目前，您的机器人无法执行任何操作。我们得先把它和不和谐联系起来。安装discord.py库，并从discord开发者页面复制您的bot令牌。您需要确保您的bot令牌是保密的。</p><pre class="kn ko kp kq fd lb lc ld le aw lf bi"><span id="8eaf" class="lg iq hh lc b fi lh li l lj lk">pip install -U discord.py</span></pre><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/9601f1b66cff952c884b44ee90a270e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQEeV--91-bFeiFOjYUUqA.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx translated">保持你的机器人令牌私有</figcaption></figure><p id="5239" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">现在，你可以进入你的Python IDE，最终将你的bot连接到discord。</p><pre class="kn ko kp kq fd lb lc ld le aw lf bi"><span id="0eb0" class="lg iq hh lc b fi lh li l lj lk">import discord<br/>from discord.ext import commands</span><span id="ae76" class="lg iq hh lc b fi lm li l lj lk">client = commands.Bot(command_prefix='$')</span><span id="d605" class="lg iq hh lc b fi lm li l lj lk">@client.event<br/>async def on_ready():<br/>    print('READY')</span><span id="4329" class="lg iq hh lc b fi lm li l lj lk">client.run('TOKEN')</span></pre><p id="7248" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">首先，导入bot所需的库。然后创建bot客户机，它处理事件和bot在连接到Discord时执行的其他动作。命令前缀是运行命令时机器人将识别的字符或短语。例如，机器人将响应$talk，因为它包含命令前缀。我们还告诉我们的bot在第一次初始化时打印“READY”。最后，我们通过粘贴前面的令牌来运行客户端。运行这段代码将使我们的机器人在线。</p><p id="5bc7" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">我们正处于文本到语音转换机器人的最后阶段。你需要安装FFMpeg和gTTS，这样机器人就可以输入文本和输出音频。</p><pre class="kn ko kp kq fd lb lc ld le aw lf bi"><span id="04a3" class="lg iq hh lc b fi lh li l lj lk">pip install gTTS</span><span id="c70f" class="lg iq hh lc b fi lm li l lj lk">git clone https://git.ffmpeg.org/ffmpeg.git ffmpeg</span></pre><p id="4c9e" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">为了让你的机器人首先输出音频，它必须加入语音通话。我们可以创建一个名为join的命令，它将在语音呼叫中加入键入该命令的用户。它检查消息的作者是否在语音呼叫中，并将加入或发送不一致的消息。</p><pre class="kn ko kp kq fd lb lc ld le aw lf bi"><span id="75c6" class="lg iq hh lc b fi lh li l lj lk">import discord<br/>from discord.ext import commands</span><span id="7089" class="lg iq hh lc b fi lm li l lj lk">client = commands.Bot(command_prefix='$')</span><span id="8cef" class="lg iq hh lc b fi lm li l lj lk">@client.event<br/>async def on_ready():<br/>    print('READY')</span><span id="36d7" class="lg iq hh lc b fi lm li l lj lk">@client.command<br/>async def join(ctx):<br/>    connected = ctx.author.voice<br/>    if connected:<br/>        await connected.channel.connect()<br/>    else:<br/>        await ctx.send('Please join a voice channel before using this command')</span><span id="bbe0" class="lg iq hh lc b fi lm li l lj lk">client.run('TOKEN')</span></pre><p id="c282" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">我们还希望我们的机器人在必要时离开语音通话。我们可以创建一个leave命令来做到这一点。</p><pre class="kn ko kp kq fd lb lc ld le aw lf bi"><span id="0da4" class="lg iq hh lc b fi lh li l lj lk">import discord<br/>from discord.ext import commands</span><span id="41d6" class="lg iq hh lc b fi lm li l lj lk">client = commands.Bot(command_prefix='$')</span><span id="8e0c" class="lg iq hh lc b fi lm li l lj lk">@client.event<br/>async def on_ready():<br/>    print('READY')</span><span id="023f" class="lg iq hh lc b fi lm li l lj lk">@client.command<br/>async def join(ctx):<br/>    connected = ctx.author.voice<br/>    if connected:<br/>        await connected.channel.connect()<br/>    else:<br/>        await ctx.send('Please join a voice channel before using this command')</span><span id="0a56" class="lg iq hh lc b fi lm li l lj lk">@client.command<br/>async def leave(ctx):<br/>    voice = discord.utils.get(client.voice_clients, guild=ctx.guild)<br/>    if voice.is_connected()<br/>    await voice.disconnect()</span><span id="c903" class="lg iq hh lc b fi lm li l lj lk">client.run('TOKEN')</span></pre><p id="5fe5" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">我们的leave命令检查我们的机器人是否断开连接。如果是的话，这个机器人就和它所在的语音通道断开了。否则，什么都不会发生。</p><p id="c352" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">为了完成我们的机器人，我们需要添加对话命令。您将需要导入我们之前安装的gTTS库和操作系统。</p><pre class="kn ko kp kq fd lb lc ld le aw lf bi"><span id="6e4b" class="lg iq hh lc b fi lh li l lj lk">import discord<br/>from discord.ext import commands<br/>import os<br/>from gtts import gTTS</span><span id="2221" class="lg iq hh lc b fi lm li l lj lk">client = commands.Bot(command_prefix='$')</span><span id="46fc" class="lg iq hh lc b fi lm li l lj lk">@client.event<br/>async def on_ready():<br/>    print('READY')</span><span id="e850" class="lg iq hh lc b fi lm li l lj lk">@client.command<br/>async def join(ctx):<br/>    connected = ctx.author.voice<br/>    if connected:<br/>        await connected.channel.connect()<br/>    else:<br/>        await ctx.send('Please join a voice channel before using this command')</span><span id="1495" class="lg iq hh lc b fi lm li l lj lk">@client.command<br/>async def leave(ctx):<br/>    voice = discord.utils.get(client.voice_clients, guild=ctx.guild)<br/>    if voice.is_connected()<br/>    await voice.disconnect()</span><span id="626d" class="lg iq hh lc b fi lm li l lj lk">@client.command<br/>async def talking(ctx, *, phrase):<br/>    phrase_there = os.path.isfile('phrase.mp3')<br/>    if phrase_there:<br/>        os.remove('phrase.mp3')</span><span id="0829" class="lg iq hh lc b fi lm li l lj lk">    voice = discord.utils.get(client.voice_clients, guild=ctx.guild)<br/>    speech = gTTS(text=phrase, lang='en', slow=False)<br/>    speech.save('phrase.mp3')<br/>    voice.play(discord.FFmpegPCMAudio('phrase.mp3'))</span><span id="be0b" class="lg iq hh lc b fi lm li l lj lk">client.run('TOKEN')</span></pre><p id="ded1" class="pw-post-body-paragraph jn jo hh jp b jq kv js jt ju kw jw jx jy kx ka kb kc ky ke kf kg kz ki kj kk ha bi translated">上面的代码就是完成的bot。talking命令首先检查我们的路径中是否有音频文件。这将是我们的机器人说话时播放的文件。因为我们不想制作这个文件的很多副本，所以如果它在我们的路径中，我们就删除它。接下来，我们声明我们的机器人的语音客户端，并将输入的短语转换成音频。我们将音频保存到mp3文件中，并使用机器人的语音客户端和FFmpeg播放。</p><h1 id="6db7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结束</h1><p id="9852" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">经过大量的设置和编码，我们终于创建了一个文本到语音不和谐机器人的工作。这在你不能大声说话或者只是瞎折腾的时候很有用。我希望你学到了新的东西，感谢你的阅读。</p><h1 id="f1f8" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">来源</h1><p id="4194" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">FFmpeg Download: <a class="ae kl" href="https://ffmpeg.org/download.html" rel="noopener ugc nofollow" target="_blank"> https://ffmpeg.org/download.html </a> <br/> Discord.py Docs: <a class="ae kl" href="https://discordpy.readthedocs.io/en/stable/api.html" rel="noopener ugc nofollow" target="_blank"> https://discordpy.readthedocs.io/en/stable/api.html </a> <br/> GTTS Docs: <a class="ae kl" href="https://gtts.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> https://gtts.readthedocs.io/en/latest/ </a> <br/> Discord.py 教程: <a class="ae kl" href="https://www.youtube.com/watch?v=nW8c7vT6Hl4&amp;list=PLW3GfRiBCHOhfVoiDZpSz8SM_HybXRPzZ" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=nW8c7vT6Hl4 &amp; list=PLW3GfRiBCHOhfVoiDZp Sz8SM_HybXRPzZ </a></p></div></div>    
</body>
</html>