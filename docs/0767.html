<html>
<head>
<title>Image Processing and Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像处理和机器学习</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/image-processing-and-machine-learning-492c0b2f9153?source=collection_archive---------10-----------------------#2021-01-30">https://medium.com/analytics-vidhya/image-processing-and-machine-learning-492c0b2f9153?source=collection_archive---------10-----------------------#2021-01-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5189" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用图像处理技术创建机器学习数据集</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/67212b24664654330101981d3847bf50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C55ecRbb-FrrmDsIhtecKw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">(图片由作者提供)</figcaption></figure><p id="b07f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图像处理已被应用于许多领域，从计算机视觉到文本检测、对象检测等等。</p><p id="59f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它的一个应用是，你利用你的图像处理技术为你的机器学习算法创建一个样本数据集。</p><p id="26de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将展示如何使用简单的图像处理技术作为机器学习模型的管道。</p><p id="7694" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设你有一个随机图像，其中有一个你想要预测的对象，我们如何提取必要的特征和信息，以用作我们机器学习模型的训练数据？</p><p id="dce0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了展示这一点，让我们加载一些简单的用户生成的图像。</p><p id="312e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于本文，我使用了以下库:</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="ee0f" class="jx jy hh jt b fi jz ka l kb kc">import matplotlib.pyplot as plt<br/>import numpy as np<br/>import pandas as pd<br/>from skimage.io import imread, imshow<br/>from skimage.color import rgb2gray<br/>from skimage.measure import label, regionprops<br/>from skimage.filters import threshold_otsu<br/>import warnings <br/>warnings.filterwarnings('ignore')</span></pre><h2 id="9697" class="jx jy hh bd kd ke kf kg kh ki kj kk kl ip km kn ko it kp kq kr ix ks kt ku kv bi translated">图像处理部分</h2><p id="3f09" class="pw-post-body-paragraph ie if hh ig b ih kw ij ik il kx in io ip ky ir is it kz iv iw ix la iz ja jb ha bi translated">我们加载样本图像:</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="1d83" class="jx jy hh jt b fi jz ka l kb kc">#read image<br/>sample1 = imread('number2.png')<br/>sample2 = imread('number3.png')<br/>#convert to gray scale<br/>sample1_g = rgb2gray(sample1)<br/>sample2_g = rgb2gray(sample2)</span><span id="31f0" class="jx jy hh jt b fi lb ka l kb kc">fig, ax = plt.subplots(1, 2, figsize=(15,15))<br/>ax[0].imshow(sample1_g, cmap='gray')<br/>ax[0].set_title('Sample 1',fontsize=15)<br/>ax[1].imshow(sample2_g, cmap='gray')<br/>ax[1].set_title('Sample 2',fontsize=15)<br/>plt.show()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/fec829e4825d3873b3aeb93e357565a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrqWuySMe2B2En1uwgogKw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">图1:示例图片(图片由作者提供)</figcaption></figure><p id="d142" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图1显示了我们的示例图像，这是一个用户定义的手写图像，包含数字2和数字3。我们将尝试分割这些数字，并提取不同的参数，以便输入到机器学习模型中。</p><p id="8cef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了开始我们的流水线，为了容易地从图像中提取特征，我们应该将整个图像二值化。我们可以用Otsu的方法，</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="cdba" class="jx jy hh jt b fi jz ka l kb kc">#binarizing using otsu<br/>thresh1 = threshold_otsu(sample1_g)<br/>sample1_b = sample1_g &lt; thresh</span><span id="2290" class="jx jy hh jt b fi lb ka l kb kc">thresh2 = threshold_otsu(sample2_g)<br/>sample2_b = sample2_g &lt; thresh2</span><span id="d395" class="jx jy hh jt b fi lb ka l kb kc">fig, ax = plt.subplots(1, 2, figsize=(15,5))<br/>ax[0].imshow(sample1_b,cmap='gray')<br/>ax[0].set_title('Binarized Image of Sample 1',fontsize=15)<br/>ax[1].imshow(sample2_b, cmap='gray')<br/>ax[1].set_title('Binarized Image of Sample 2',fontsize=15)<br/>plt.show()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/cba6bea04333b96aa21fbb9c1bc7f6a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hk8xTcPEn-DxxZVX7byjAA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">图2:二值化图像(作者提供的图像)</figcaption></figure><p id="168d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，我们能够通过衰减图像中的数字来完美地二值化图像。</p><p id="832d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步我们将标记这些白色物体。对于这个步骤，我们可以使用不同的斑点检测。为了使它更容易，我们可以使用一个连接的组件函数来隔离每个数字。为此，我们可以使用scikit-image中的预定义标记函数。</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="20ae" class="jx jy hh jt b fi jz ka l kb kc">#using label to isolate each image<br/>sample1_la = label(sample1_b)<br/>sample2_la = label(sample2_b)</span><span id="2191" class="jx jy hh jt b fi lb ka l kb kc">fig, ax = plt.subplots(1, 2, figsize=(15,5))<br/>ax[0].imshow(sample1_la)<br/>ax[0].set_title('Labelled Image of Sample 1',fontsize=15)<br/>ax[1].imshow(sample2_la)<br/>ax[1].set_title('Labelled Image of Sample 2',fontsize=15)<br/>plt.show()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/4b337a24c3d6d431848d06eca707aa41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aQZWeUPzQmVdZ7qNfnreqQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">图3:带标签的图片(作者提供的图片)</figcaption></figure><p id="2da9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，在图3中，我们能够标记和检测图像中的每个连接组件。不断变化的颜色意味着它能够检测到每个独特的数字。</p><p id="3a08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了检查这一点，我们可以简单地使用region props函数来确定所看到的图像总数。视觉上，我们应该能够得到每个样本30个数字。</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="b84f" class="jx jy hh jt b fi jz ka l kb kc">sample1_r=regionprops(sample1_la)<br/>sample2_r=regionprops(sample2_la)</span><span id="11f5" class="jx jy hh jt b fi lb ka l kb kc">print('Number of Data in Sample 1: ',len(sample1_r))<br/>print('Number of Data in Sample 2: ',len(sample2_r))</span></pre><p id="b71a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">样本1中的数据数量:30</p><p id="f8ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">样本2中的数据数量:30</p><p id="4998" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确实！我们成功地检测到了每个样本图像中的每个样本数。</p><p id="399d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还可以直观地展示我们是如何检测和分离它们的。一些有用的代码如下:</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="0936" class="jx jy hh jt b fi jz ka l kb kc">fig, ax = plt.subplots(1, 4, figsize=(15,10))<br/>ax[0].imshow(sample1_la,cmap='gray')<br/>ax[0].set_title('Labeled Images',fontsize=15)<br/>for x,y in enumerate(sample1_r[:3]):<br/>    ax[x+1].imshow(y.image,cmap='gray')<br/>    ax[x+1].set_title('Sample 1_'+ str(x+1),fontsize=15)<br/>plt.show()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/9c24a2336dee303e7179cb6bcec177bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQuExDsrgw2cx3RxLW489w.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">图4:从样本1中提取的样本(图片由作者提供)</figcaption></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ld"><img src="../Images/f7c36f1df4eda60bf3994ef8c419373a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9Zzxz3wy33mKErhclDalA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">图5:从样本2中提取的样本(图片由作者提供)</figcaption></figure><p id="2caa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图4和图5显示，我们可以完美地检测和分离每个编号的样品，而不会相互重叠。</p><p id="ed27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">既然我们能够分割对象/数字，现在是提取特征的时候了！</p><p id="72f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用区域属性函数的不同参数从图像中提取不同的测量值。我们可以从每个分割图像中提取面积、周长和其他可能的测量值，并将其放入熊猫数据框中。代码示例如下:</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="cdd4" class="jx jy hh jt b fi jz ka l kb kc">properties = ['area','convex_area','bbox_area','major_axis_length', <br/>               'minor_axis_length', 'perimeter', 'equivalent_diameter', 'solidity', 'eccentricity','target']</span><span id="3507" class="jx jy hh jt b fi lb ka l kb kc">df1 = pd.DataFrame(columns=properties)<br/>count=0<br/>proper = []<br/>proper = []</span><span id="1003" class="jx jy hh jt b fi lb ka l kb kc">y= int(0)<br/>for x in sample1_r:<br/>    proper.append([x.area,x.convex_area,x.bbox_area,x.major_axis_length,<br/>                  x.minor_axis_length,x.perimeter,x.equivalent_diameter,x.solidity,x.eccentricity,y])<br/>    df1.loc[count] = proper[0]<br/>    count +=1<br/>    proper = []<br/>    <br/>y= int(1)<br/>for x in sample2_r:<br/>    proper.append([x.area,x.convex_area,x.bbox_area,x.major_axis_length,<br/>                  x.minor_axis_length,x.perimeter,x.equivalent_diameter,x.solidity,x.eccentricity,y])<br/>    df1.loc[count] = proper[0]<br/>    count +=1<br/>    proper = []<br/>    <br/>df1.head(5)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es le"><img src="../Images/fb020a568688dc0f45d0bfd47169c620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q42eWL9NWxJrPlH5vvpIbQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">图Dataframe的样本头(图片由作者提供)</figcaption></figure><p id="818a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以在图6中的样品头上看到，我们能够提取每张图像的数值测量值。这些测量基于像素值和从区域属性中导出的边界框。我们还输入了一个目标，0代表数字2，1代表数字3。</p><h2 id="1cb5" class="jx jy hh bd kd ke kf kg kh ki kj kk kl ip km kn ko it kp kq kr ix ks kt ku kv bi translated">机器学习部分</h2><p id="8608" class="pw-post-body-paragraph ie if hh ig b ih kw ij ik il kx in io ip ky ir is it kz iv iw ix la iz ja jb ha bi translated">现在，我们能够创建一个简单的数据框，包含每个图像和目标的测量值。我们已经可以用它作为我们机器学习模型的数据集。一个机器学习代码如下:</p><p id="2113" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将数据和目标设置为变量:</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="83fd" class="jx jy hh jt b fi jz ka l kb kc">X = df1.drop('target', axis=1)<br/>y = df1['target'].astype(int)</span></pre><p id="3cad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们看到来自区域道具的图像测量对于每个参数都有很大的不同，所以我们应该将它通过一个缩放器函数，为此，我们可以使用标准缩放器作为缩放器函数。</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="c5a2" class="jx jy hh jt b fi jz ka l kb kc">from sklearn.preprocessing import StandardScaler<br/>ssscaler = StandardScaler()<br/>X_scaled = ssscaler.fit_transform(X)</span></pre><p id="16e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">缩放后，我们应该将数据分成训练和测试，以查看模型是否可以使用参数很好地概括。</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="60ee" class="jx jy hh jt b fi jz ka l kb kc">from sklearn.model_selection import train_test_split <br/>X_train, X_test, y_train, y_test = train_test_split(X, y,stratify=y)</span></pre><p id="7b00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">分割后，我们将其输入机器学习模型。对于本文，我们将使用最大深度为15、估计值为500的随机森林分类器。</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="e5cf" class="jx jy hh jt b fi jz ka l kb kc">RF = RandomForestClassifier(max_depth=15,n_estimators=500) <br/>RF.fit(X_train,y_train)</span></pre><p id="c5ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在将训练集拟合到模型之后，我们应该得到我们的分类器模型的准确性。</p><pre class="jd je jf jg fd js jt ju jv aw jw bi"><span id="1e83" class="jx jy hh jt b fi jz ka l kb kc">acc_train = RF.score(X_train,y_train)<br/>acc_test = RF.score(X_test,y_test)</span><span id="57ba" class="jx jy hh jt b fi lb ka l kb kc">print('Train Accuracy at ',acc_train)<br/>print('Test Accuracy at ',acc_test)</span></pre><p id="97ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果显示了80% 的<strong class="ig hi">测试准确性，考虑到我们的机会标准仅为62.5%左右，这已经很好了。</strong></p><h1 id="55e3" class="lf jy hh bd kd lg lh li kh lj lk ll kl lm ln lo ko lp lq lr kr ls lt lu ku lv bi translated">摘要</h1><p id="e4b6" class="pw-post-body-paragraph ie if hh ig b ih kw ij ik il kx in io ip ky ir is it kz iv iw ix la iz ja jb ha bi translated">作为本文的结论，我们能够使用不同的图像处理技术为我们的机器学习模型创建一个样本数据集。我们能够使用分段和标记功能来创建可用于简单分类器模型的不同参数。由此可见，图像处理技术可以作为一种从图像中提取不同参数的方法。</p><p id="ff71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">敬请关注更多文章！</p></div></div>    
</body>
</html>