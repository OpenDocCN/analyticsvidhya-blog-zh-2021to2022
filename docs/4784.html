<html>
<head>
<title>yield — Python (Part I)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">yield — Python(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/yield-python-part-i-4dbfe914ad2d?source=collection_archive---------2-----------------------#2022-02-13">https://medium.com/analytics-vidhya/yield-python-part-i-4dbfe914ad2d?source=collection_archive---------2-----------------------#2022-02-13</a></blockquote><div><div class="es gl gm gn go gp"/><div class="gq gr gs gt gu"><div class=""/><figure class="ec ee hv hw hx hy dy dz paragraph-image"><div class="dy dz hu"><img src="../Images/71fb076dda8d4c8e290c1862300c7832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*UmjkFL6B4U24rOd7MVin5g.jpeg"/></div><figcaption class="ib ic ea dy dz id ie bd b be z ft translated">照片由<a class="ae if" href="https://unsplash.com/@aliyilmazz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ali ylmaz</a>在<a class="ae if" href="https://unsplash.com/s/photos/corn-and-insect?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="838c" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">偶尔遇到的关键字看起来很神秘。在这里，我们通过查看生成器如何使用<code class="eu je jf jg jh b">yield</code>来获取值或将控制权返回给调用者，来解开<code class="eu je jf jg jh b">yield</code>做了什么。我们也在看发电机的不同状态。让我们开始吧。</p><p id="27e7" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated"><strong class="ii gy">发电机功能</strong>:</p><p id="c354" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">使用<code class="eu je jf jg jh b">yield</code>语句的函数称为生成器函数。</p><figure class="ji jj jk jl ek hy"><div class="bz jm l di"><div class="jn jo l"/></div><figcaption class="ib ic ea dy dz id ie bd b be z ft translated">发电机示例1</figcaption></figure><p id="802b" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">输出如下所示:</p><pre class="ji jj jk jl ek jp jh jq jr aw js bi"><span id="1418" class="jt ju gx jh b ev jv jw l jx jy">Happy Birthday to you</span></pre><p id="83e8" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">当函数<code class="eu je jf jg jh b">happy_birthday_song</code>被调用时，生成器被创建，如第7行所示。通过调用<code class="eu je jf jg jh b">next()</code>执行生成的生成器。</p><p id="556a" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">我们只得到第一个<code class="eu je jf jg jh b">yield</code>的输出，因为我们只调用了<code class="eu je jf jg jh b">next()</code>一次。第一次执行后，发生器处于<strong class="ii gy">暂停</strong>状态。当另一个<code class="eu je jf jg jh b">next()</code>被调用时，生成器恢复执行并返回第二个<code class="eu je jf jg jh b">yield</code>的值。当遇到<code class="eu je jf jg jh b">StopIteration</code>时，生成器被耗尽，就像任何<a class="ae if" rel="noopener" href="/analytics-vidhya/iterable-vs-iterator-python-d14aedaa0197">迭代器</a>一样。下面的代码打印了整首生日歌。</p><figure class="ji jj jk jl ek hy"><div class="bz jm l di"><div class="jn jo l"/></div><figcaption class="ib ic ea dy dz id ie bd b be z ft translated">发电机示例2</figcaption></figure><p id="a003" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated"><strong class="ii gy">作为协程的生成器:</strong></p><figure class="ji jj jk jl ek hy dy dz paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="dy dz jz"><img src="../Images/0d1c4a7f5a65b9a7d53cb5f56dc4123e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhXcj4RqWe4utYJ084FGlQ.png"/></div></div><figcaption class="ib ic ea dy dz id ie bd b be z ft translated">并发性与并行性</figcaption></figure><p id="4375" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">简而言之，并发是同时运行多个计算的任务，而并行是同时运行多个计算的任务。</p><figure class="ji jj jk jl ek hy dy dz paragraph-image"><div class="dy dz ke"><img src="../Images/8490e4feefd41aad2d3f57ed8c2321e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*Z6ZGdx0ItfIQpACSBN8rlw.png"/></div><figcaption class="ib ic ea dy dz id ie bd b be z ft translated">合作与抢占式多任务处理</figcaption></figure><p id="ba62" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">合作多任务完全由开发者控制。协同程序(<strong class="ii gy">Co</strong>operative<strong class="ii gy">routine</strong>)是协作多任务处理的一个例子。</p><p id="b1d0" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">抢占式多任务处理不受开发人员的控制，并且包含某种调度程序。</p><p id="5be4" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">在Python中创建协程的方法之一是<strong class="ii gy">生成器</strong>。</p><p id="6a7f" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">让我们看看这个运行平均代码:</p><figure class="ji jj jk jl ek hy"><div class="bz jm l di"><div class="jn jo l"/></div></figure><p id="b67f" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">输出如下所示:</p><pre class="ji jj jk jl ek jp jh jq jr aw js bi"><span id="d426" class="jt ju gx jh b ev jv jw l jx jy">1.0<br/>1.5<br/>2.0<br/>2.5<br/>3.0</span></pre><p id="5e2e" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">当我们遍历列表时，我们使用<code class="eu je jf jg jh b">average()</code>来计算列表中元素的平均值。程序控制流如下所示:</p><figure class="ji jj jk jl ek hy dy dz paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="dy dz kf"><img src="../Images/7af1cc40f25d3daa8b77f12590ea8f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrzVykGDsGtxpA6pRMIygA.png"/></div></div></figure><p id="e526" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">让我们使用子例程实现生产者/消费者模式:</p><figure class="ji jj jk jl ek hy"><div class="bz jm l di"><div class="jn jo l"/></div></figure><p id="d2d5" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">输出如下所示:</p><pre class="ji jj jk jl ek jp jh jq jr aw js bi"><span id="40a9" class="jt ju gx jh b ev jv jw l jx jy">next producer...</span><span id="ac76" class="jt ju gx jh b ev kg jw l jx jy">In producer ...</span><span id="6c73" class="jt ju gx jh b ev kg jw l jx jy">appended 0<br/>appended 1<br/>next consumer...</span><span id="0d9a" class="jt ju gx jh b ev kg jw l jx jy">In consumer...</span><span id="55b4" class="jt ju gx jh b ev kg jw l jx jy">popped 0<br/>popped 1<br/>next producer...<br/>appended 2<br/>appended 3<br/>next consumer...<br/>popped 2<br/>popped 3<br/>next producer...<br/>appended 4<br/>next consumer...<br/>popped 4</span></pre><p id="be52" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">发生什么事了？嗯，下面的事情正在发生:</p><p id="2d57" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">0.创建一个有限的尺寸<code class="eu je jf jg jh b">deque</code>，这里尺寸为2</p><ol class=""><li id="b84d" class="kh ki gx ii b ij ik in io ir kj iv kk iz kl jd km kn ko kp bi translated"><code class="eu je jf jg jh b">coordinator</code>创建producer generator的一个实例，并说明它想要生成多少个元素</li><li id="d1b6" class="kh ki gx ii b ij kq in kr ir ks iv kt iz ku jd km kn ko kp bi translated"><code class="eu je jf jg jh b">coordinator</code>创建消费者生成器的实例</li><li id="1b3e" class="kh ki gx ii b ij kq in kr ir ks iv kt iz ku jd km kn ko kp bi translated">生产者运行，直到<code class="eu je jf jg jh b">deque</code>被填满<strong class="ii gy">并且</strong>将控制权交还给调用者</li><li id="9ad9" class="kh ki gx ii b ij kq in kr ir ks iv kt iz ku jd km kn ko kp bi translated">消费者运行直到<code class="eu je jf jg jh b">deque</code>为空<strong class="ii gy">并且</strong>将控制权交还给调用者</li></ol><p id="b5a0" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">重复步骤3和4，直到<strong class="ii gy">生产者想要生产的所有</strong>元素完成。由于我们能够控制控制流的状态，消费者和生产者的这种协调是可能的。</p><p id="3585" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">这就把我们带到了下一个话题:发电机的状态是什么？</p><figure class="ji jj jk jl ek hy"><div class="bz jm l di"><div class="jn jo l"/></div><figcaption class="ib ic ea dy dz id ie bd b be z ft translated">发电机的状态</figcaption></figure><p id="1066" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">输出如下所示:</p><pre class="ji jj jk jl ek jp jh jq jr aw js bi"><span id="0d66" class="jt ju gx jh b ev jv jw l jx jy">After generator creation: GEN_CREATED<br/>getting 1st flower<br/>Inside loop: GEN_RUNNING<br/>{'azalea'}<br/>After getting first flower: GEN_SUSPENDED</span><span id="8a74" class="jt ju gx jh b ev kg jw l jx jy">Inside loop: GEN_RUNNING<br/>Inside loop: GEN_RUNNING<br/>Get rest of the flowers: ['Forsythia', 'Violas']</span><span id="f880" class="jt ju gx jh b ev kg jw l jx jy">After getting all flowers: GEN_CLOSED</span></pre><p id="fb81" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">我们有一个来自<code class="eu je jf jg jh b">inspect</code>模块的便捷的<code class="eu je jf jg jh b">getgeneratorstate</code>方法，它给出了发电机的状态。从输出中，我们看到有四种不同的状态:</p><p id="f43f" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">0.GEN _已创建</p><ol class=""><li id="fd5f" class="kh ki gx ii b ij ik in io ir kj iv kk iz kl jd km kn ko kp bi translated">GEN_RUNNING</li><li id="ff76" class="kh ki gx ii b ij kq in kr ir ks iv kt iz ku jd km kn ko kp bi translated">GEN _已暂停</li><li id="c0a4" class="kh ki gx ii b ij kq in kr ir ks iv kt iz ku jd km kn ko kp bi translated">GEN _已关闭</li></ol><p id="f45a" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">GEN_CREATED是我们实例化一个生成器时的状态。发电机运行是发电机产生价值时的一种状态。GEN_SUSPENDED是发生器产生值时的状态。发电机关闭是发电机耗尽时的一种状态。</p><p id="0c1f" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">总之，<code class="eu je jf jg jh b">yield</code>被生成器用来产生值或把控制权还给调用者，生成器有4种状态。</p><p id="16a2" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">本文到此为止。我的下一篇文章将是向生成器发送值！</p><p id="d1cd" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">希望对你有帮助。感谢您的阅读。</p><p id="8605" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">灵感:</p><ul class=""><li id="5212" class="kh ki gx ii b ij ik in io ir kj iv kk iz kl jd kv kn ko kp bi translated"><a class="ae if" href="https://www.udemy.com/course/python-3-deep-dive-part-2/" rel="noopener ugc nofollow" target="_blank">蟒蛇深潜</a></li></ul></div><div class="ab cl kw kx ge ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="gq gr gs gt gu"><p id="461c" class="pw-post-body-paragraph ig ih gx ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd gq bi translated">你可以在<a class="ae if" href="http://patreon.com/dkhambu" rel="noopener ugc nofollow" target="_blank"> Patreon </a>上支持我！</p></div></div>    
</body>
</html>