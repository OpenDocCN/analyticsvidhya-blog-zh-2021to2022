<html>
<head>
<title>Image Segmentation using K-means Clustering from Scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从头开始使用K-均值聚类的图像分割</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/image-segmentation-using-k-means-clustering-from-scratch-1545c896e38e?source=collection_archive---------3-----------------------#2021-01-16">https://medium.com/analytics-vidhya/image-segmentation-using-k-means-clustering-from-scratch-1545c896e38e?source=collection_archive---------3-----------------------#2021-01-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> <em class="jd">数字图像处理中</em></strong><strong class="ih hj"><em class="jd">计算机视觉</em></strong><strong class="ih hj"><em class="jd">图像分割</em> </strong>是将一幅数字图像分割成多个片段的过程。分割的目标是简化和/或改变图像的表示，使其更有意义、更易于分析。</p><p id="aee6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">今天，我们将通过K-means聚类和OpenCV从零开始实现</em> <strong class="ih hj"> <em class="jd">图像分割</em> </strong> <em class="jd">！我很确定它会像听起来一样令人着迷！</em></p><blockquote class="je jf jg"><p id="c8cf" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">有关K-均值聚类的概念概述，请参考— <a class="ae jk" href="https://tp6145.medium.com/everything-you-need-to-know-about-k-means-clustering-88ad4058cce0" rel="noopener"> <strong class="ih hj">关于K-均值聚类您需要知道的一切</strong> </a></p></blockquote><p id="0ed7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我们现在将从头开始执行K-means聚类算法的代码演练:</em></p><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="c185" class="ju jv hi jq b fi jw jx l jy jz">import <strong class="jq hj">numpy</strong> as np<br/>import <strong class="jq hj">matplotlib.pyplot</strong> as plt</span><span id="21df" class="ju jv hi jq b fi ka jx l jy jz">np.random.seed(42)</span><span id="70cc" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">def euclidean_distance</strong>(x1, x2):<br/>    return np.sqrt(np.sum((x1 - x2)**2))</span><span id="fccb" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">class KMeans():</strong></span><span id="20b8" class="ju jv hi jq b fi ka jx l jy jz">   <strong class="jq hj"> def __init__</strong>(self, K=5, max_iters=100, plot_steps=False):<br/>        self.K = K<br/>        self.max_iters = max_iters<br/>        self.plot_steps = plot_steps</span><span id="6fd8" class="ju jv hi jq b fi ka jx l jy jz">        <em class="jd"># list of sample indices for each cluster</em><br/>        self.clusters = [[] for _ in range(self.K)]<br/>        <em class="jd"># the centers (mean feature vector) for each cluster</em><br/>        self.centroids = []</span><span id="f03c" class="ju jv hi jq b fi ka jx l jy jz">    <strong class="jq hj">def predict</strong>(self, X):<br/>        self.X = X<br/>        self.n_samples, self.n_features = X.shape<br/>        <br/>        <em class="jd"># initialize </em><br/>        random_sample_idxs = np.random.choice(self.n_samples, self.K, replace=False)<br/>        self.centroids = [self.X[idx] for idx in random_sample_idxs]</span><span id="07a5" class="ju jv hi jq b fi ka jx l jy jz">        <em class="jd"># Optimize clusters</em><br/>        for _ in range(self.max_iters):<br/>            <em class="jd"># Assign samples to closest centroids (create clusters)</em><br/>            self.clusters = self._create_clusters(self.centroids)<br/>            if self.plot_steps:<br/>                self.plot()</span><span id="6a05" class="ju jv hi jq b fi ka jx l jy jz">            <em class="jd"># Calculate new centroids from the clusters</em><br/>            centroids_old = self.centroids<br/>            self.centroids = self._get_centroids(self.clusters)<br/>            <br/>            <em class="jd"># check if clusters have changed</em><br/>            if self._is_converged(centroids_old, self.centroids):<br/>                break</span><span id="885e" class="ju jv hi jq b fi ka jx l jy jz">            if self.plot_steps:<br/>                self.plot()</span><span id="88f6" class="ju jv hi jq b fi ka jx l jy jz">        <em class="jd"># Classify samples as the index of their clusters</em><br/>        return self._get_cluster_labels(self.clusters)<br/></span><span id="41f0" class="ju jv hi jq b fi ka jx l jy jz">    <strong class="jq hj">def _get_cluster_labels</strong>(self, clusters):<br/>        <em class="jd"># each sample will get the label of the cluster it was assigned to</em><br/>        labels = np.empty(self.n_samples)</span><span id="98a2" class="ju jv hi jq b fi ka jx l jy jz">        for cluster_idx, cluster in enumerate(clusters):<br/>            for sample_index in cluster:<br/>                labels[sample_index] = cluster_idx<br/>        return labels</span><span id="d3f5" class="ju jv hi jq b fi ka jx l jy jz">   <strong class="jq hj"> def _create_clusters</strong>(self, centroids):<br/>        <em class="jd"># Assign the samples to the closest centroids to create clusters</em><br/>        clusters = [[] for _ in range(self.K)]<br/>        for idx, sample in enumerate(self.X):<br/>            centroid_idx = self._closest_centroid(sample, centroids)<br/>            clusters[centroid_idx].append(idx)<br/>        return clusters</span><span id="cbec" class="ju jv hi jq b fi ka jx l jy jz">   <strong class="jq hj"> def _closest_centroid</strong>(self, sample, centroids):<br/>        <em class="jd"># distance of the current sample to each centroid</em><br/>        distances = [euclidean_distance(sample, point) for point in centroids]<br/>        closest_index = np.argmin(distances)<br/>        return closest_index</span><span id="4907" class="ju jv hi jq b fi ka jx l jy jz">    <strong class="jq hj">def _get_centroids</strong>(self, clusters):<br/>        <em class="jd"># assign mean value of clusters to centroids</em><br/>        centroids = np.zeros((self.K, self.n_features))<br/>        for cluster_idx, cluster in enumerate(clusters):<br/>            cluster_mean = np.mean(self.X[cluster], axis=0)<br/>            centroids[cluster_idx] = cluster_mean<br/>        return centroids</span><span id="5d12" class="ju jv hi jq b fi ka jx l jy jz">    <strong class="jq hj">def _is_converged</strong>(self, centroids_old, centroids):<br/>        <em class="jd"># distances between each old and new centroids, fol all centroids</em><br/>        distances = [euclidean_distance(centroids_old[i], centroids[i]) for i in range(self.K)]<br/>        return sum(distances) == 0</span><span id="46b1" class="ju jv hi jq b fi ka jx l jy jz">    <strong class="jq hj">def plot</strong>(self):<br/>        fig, ax = plt.subplots(figsize=(12, 8))</span><span id="b262" class="ju jv hi jq b fi ka jx l jy jz">        for i, index in enumerate(self.clusters):<br/>            point = self.X[index].T<br/>            ax.scatter(*point)</span><span id="828c" class="ju jv hi jq b fi ka jx l jy jz">        for point in self.centroids:<br/>            ax.scatter(*point, marker="x", color='black', linewidth=2)</span><span id="e020" class="ju jv hi jq b fi ka jx l jy jz">        plt.show()<br/>   <strong class="jq hj"> def cent</strong>(self):<br/>        return self.centroids</span><span id="6496" class="ju jv hi jq b fi ka jx l jy jz">import <strong class="jq hj">cv2<br/></strong>from <strong class="jq hj">google.colab.patches</strong> import <strong class="jq hj">cv2_imshow</strong></span><span id="8040" class="ju jv hi jq b fi ka jx l jy jz">image = cv2.imread("demo_image.png")<strong class="jq hj"><br/></strong>plt.figure(figsize=(6, 6))<br/>plt.imshow(image)</span><span id="f189" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>&lt;matplotlib.image.AxesImage at 0x7ff5d3fb5b00&gt;</span></pre><figure class="jl jm jn jo fd kc er es paragraph-image"><div class="er es kb"><img src="../Images/6859cb6a506e44047deeaaed3408e700.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*5jlf8oyrtg-8K9ezjT90cw.png"/></div></figure><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="c7cb" class="ju jv hi jq b fi jw jx l jy jz">image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)<br/>plt.figure(figsize=(6, 6)) <br/>plt.imshow(image)</span><span id="6e4a" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>&lt;matplotlib.image.AxesImage at 0x7ff5d3f21780&gt;</span></pre><figure class="jl jm jn jo fd kc er es paragraph-image"><div class="er es kf"><img src="../Images/0ce99ae3ba877698988c54624b6780e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*Jodmsm7IKKj801LYFitXzA.png"/></div></figure><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="3972" class="ju jv hi jq b fi jw jx l jy jz">pixel_values = image.reshape((-1, 3))<br/>pixel_values = np.float32(pixel_values)<br/>print(pixel_values.shape)</span><span id="1624" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:</strong><br/>(336592, 3)</span><span id="3d7b" class="ju jv hi jq b fi ka jx l jy jz">k = <strong class="jq hj">KMeans</strong>(K=3, max_iters=100)  <br/>y_pred = k<strong class="jq hj">.predict</strong>(pixel_values) <br/>k<strong class="jq hj">.cent</strong>()</span><span id="3daf" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([[ 52.33562851,  87.11623383,  30.71857262],<br/>       [ 13.03598499, 134.39547729, 185.26257324],<br/>       [153.30374146, 160.25224304, 128.49607849]])</span><span id="eeec" class="ju jv hi jq b fi ka jx l jy jz">centers = np.uint8(k.cent())<br/>centers</span><span id="dc71" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([[ 52,  87,  30],<br/>       [ 13, 134, 185],<br/>       [153, 160, 128]], dtype=uint8)</span><span id="2690" class="ju jv hi jq b fi ka jx l jy jz">y_pred</span><span id="fefe" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([0., 0., 0., ..., 0., 0., 0.])</span><span id="a53a" class="ju jv hi jq b fi ka jx l jy jz">y_pred = y_pred.astype(int)<br/>np.unique(y_pred)</span><span id="520e" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([0, 1, 2])</span><span id="fa14" class="ju jv hi jq b fi ka jx l jy jz">labels = y_pred.flatten()<br/>segmented_image = centers[labels.flatten()]<br/>segmented_image = segmented_image.reshape(image.shape)</span><span id="228a" class="ju jv hi jq b fi ka jx l jy jz">plt.imshow(segmented_image)<br/>plt.show()</span></pre><figure class="jl jm jn jo fd kc er es paragraph-image"><div class="er es kg"><img src="../Images/9c7e84839a3bba6dfa841ac7aacf8505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*qZ0ojBODkF2ZMI7aHki8kw.png"/></div></figure><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="6164" class="ju jv hi jq b fi jw jx l jy jz">masked_image = np.copy(image)<br/>masked_image = masked_image.reshape((-1, 3))</span><span id="30e9" class="ju jv hi jq b fi ka jx l jy jz">cluster = 2<br/>masked_image[labels == cluster] = [0, 0, 0]</span><span id="8bbf" class="ju jv hi jq b fi ka jx l jy jz">masked_image = masked_image.reshape(image.shape)<br/>plt.imshow(masked_image)<br/>plt.show()</span></pre><figure class="jl jm jn jo fd kc er es paragraph-image"><div class="er es kh"><img src="../Images/1c4d6e3d60d09ad580da491e3d1d0799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*uH5ainc1ARWW1ZUVKLzJXg.png"/></div></figure><blockquote class="je jf jg"><p id="3393" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">希望你喜欢并充分利用这篇文章！敬请关注我即将发布的博客！如果你觉得我的内容有帮助/有帮助，请确保<strong class="ih hj">鼓掌</strong>和<strong class="ih hj">跟随</strong>！</p></blockquote><p id="91a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">完整代码实现:</em> </strong></p><div class="ki kj ez fb kk kl"><a href="https://github.com/tanvipenumudy/Winter-Internship-Internity/blob/main/Day%2011/Day-11%20Notebook-2%20%28Image%20Segmentation%29.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="km ab dw"><div class="kn ab ko cl cj kp"><h2 class="bd hj fi z dy kq ea eb kr ed ef hh bi translated">tanvipenumudy/Winter-实习-实习</h2><div class="ks l"><h3 class="bd b fi z dy kq ea eb kr ed ef dx translated">存储库跟踪每天分配的工作-tanvipenumudy/Winter-实习-实习</h3></div><div class="kt l"><p class="bd b fp z dy kq ea eb kr ed ef dx translated">github.com</p></div></div><div class="ku l"><div class="kv l kw kx ky ku kz kd kl"/></div></div></a></div></div></div>    
</body>
</html>