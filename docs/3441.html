<html>
<head>
<title>Meet Vicci — Very Intelligent Covid Chat Interface — 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">认识Vicci —非常智能的Covid聊天界面— 2</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/meet-vicci-very-intelligent-covid-chat-interface-2-6ef26754b702?source=collection_archive---------29-----------------------#2021-06-30">https://medium.com/analytics-vidhya/meet-vicci-very-intelligent-covid-chat-interface-2-6ef26754b702?source=collection_archive---------29-----------------------#2021-06-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="7e86" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用Python和经典ML设计一个COVID聊天机器人</h2></div><p id="e566" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在<a class="ae js" rel="noopener" href="/@nphard12/vicci-very-intelligent-covid-chat-interface-70b9eaeea1ae">之前的文章</a>中，我们创建了训练数据和主要意图分类模型，它们将作为我们聊天机器人的驱动模型。在本文中，我们将设计bot引擎，并将bot部署为flask应用程序。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/f6784a263699259ea5f349978d82157f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BisTFLbPoEy04I_PKul1g.png"/></div></div></figure><h1 id="558a" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">给Vicci增加肌肉</h1><p id="3bee" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">我们的意图分类器将足以服务于基本意图(询问信息)。一旦我们从分类器中获得了意图类型，我们只需从映射到该意图的答案池中进行回复(参考训练数据)。简单来说，这就是基于<strong class="iy hi">检索的</strong>机器人所做的事情。</p><p id="afa9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是请记住，我们还增加了几个意图，使我们的机器人更加<strong class="iy hi">面向行动。</strong></p><p id="0fac" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lc"> covid_numbers </em> —这将显示来自印度政府官方<a class="ae js" href="https://www.mygov.in/covid-19#statewise-data" rel="noopener ugc nofollow" target="_blank">仪表板</a>的特定邦的最新活跃病例、出院患者、死亡人数和接种人数。</p><p id="46c5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lc">疫苗接种_时段</em> —这将有助于根据用户的区域密码和首选日期为用户找到疫苗接种时段</p><p id="55b7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以当bot识别出这些意图时，我们就要提取出这些意图对应的相关实体，然后进一步处理。这在聊天机器人术语中称为<strong class="iy hi">实体提取</strong>。RASA等高级聊天机器人框架使用DIETClassifier或Spacy实体识别器，但我们将尝试一些更简单的步骤。</p><h1 id="9585" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">实体提取</h1><p id="622a" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">给定一个查询— <em class="lc">“显示来自</em> <strong class="iy hi"> <em class="lc">西孟加拉邦</em></strong><em class="lc">”</em><strong class="iy hi"><em class="lc">，</em> </strong>我们必须从这个查询中提取<strong class="iy hi"> <em class="lc">西孟加拉邦</em> </strong>(州名)。因为我们已经知道印度所有州的名称，所以很容易简单地检查问题中是否存在任何州的名称。然而，我们不能进行简单的字符串匹配，因为有时拼写上的一个小错误会导致失败。更多的人可能会把同一个州简称为孟加拉。所以我们必须寻找模糊匹配。</p><p id="0d97" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为此，我们使用了<a class="ae js" href="https://pypi.org/project/fuzzywuzzy/" rel="noopener ugc nofollow" target="_blank"> fuzzywuzzy </a>包。我们还尝试了<a class="ae js" href="https://en.wikipedia.org/wiki/Levenshtein_distance" rel="noopener ugc nofollow" target="_blank"> Levenshtein Distance </a>和一些其他方法，但我们最终选择了基于令牌集比率分数的最佳匹配。如果找不到州名或者可信度低于60(最大值为100)，我们将显示印度的信息。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">从查询中提取州名</figcaption></figure><p id="f13a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">第二个意图稍微复杂一些。我们有两个实体—日期和区号。此外，在使用聊天机器人时，不希望用户以任何特定的格式输入日期。用户可以说像“T0”、“明天”、“下周五”和“7月10日”这样的短语，所以我们也必须包括这些方面。为此，我们使用一个名为<a class="ae js" href="https://pypi.org/project/parsedatetime/" rel="noopener ugc nofollow" target="_blank"> parsedatetime </a>的库，它可以以人类可读的格式解析日期。它并不完美，在复杂的相对日期上失败了，比如“下周五”和“下周五”，但是它在标准日期格式和短语上做得很好。</p><p id="9b78" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">pin码提取相当简单，因为它必须有6个数字，其中第一个数字不能是0，所以我们简单地使用regex。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="8ca6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为此，如果一个或两个实体缺失，我们不能做出任何随机假设。我们必须涵盖以下场景—</p><p id="0e5a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">“<em class="lc">我在找明天</em><strong class="iy hi"><em class="lc"/></strong><em class="lc">的接种槽。我的地区是</em><strong class="iy hi"><em class="lc">700084</em></strong><em class="lc">。”</em> <br/> —检测并提取实体，并提供给用户。</p><p id="a89b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lc">我在找</em> <strong class="iy hi"> <em class="lc">明天</em> </strong> <em class="lc">的接种槽。请大家帮帮忙。”</em> <br/> —检测到的日期实体。机器人应该要求一个区号。</p><p id="e66f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于第二种情况，典型的查询-响应设置是不行的。我们需要一种上下文管理的方式和一种查询-响应-反馈循环机制，直到用户得到服务。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lj"><img src="../Images/6f03c342c17fd42d55a376968977d6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*yimmVWCkBEFoeI_-13uRlw.png"/></div></figure><h1 id="26b3" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">对话流和上下文管理</h1><p id="53ce" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated"><strong class="iy hi">对话流</strong>——简单来说——是用户和机器人之间自然的查询和响应交流。</p><p id="ed48" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在对话流中的每一点，机器人都有一些信息(如检测到的实体、检测到的意图、到某个时间点之前提供的意图，以及基于业务或域逻辑的某些意图-实体关系规则)，这些信息有助于机器人决定继续进行哪些选项。这统称为<strong class="iy hi">上下文</strong>。</p><p id="91be" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">除了我们在上一节提到的场景，我们的机器人还必须涵盖这些——</p><p id="4548" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">"<em class="lc">我在找疫苗接种槽。请大家帮帮忙。”</em> <br/> —未检测到实体。机器人会询问密码和喜欢的日期。<br/> <em class="lc">“我如何保护自己免受Covid的侵害？”<br/></em>—机器人应该知道用户已经删除了之前的上下文，并做出相应的响应。</p><p id="1aa6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这一切都关系到我们为<em class="lc">接种疫苗_槽</em>的意图服务。检测到<em class="lc">疫苗接种_槽</em>意图后，将其保存在上下文历史中。之后，当我们得到一个新的查询时，我们按照下面的流程图中定义的步骤进行。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lk"><img src="../Images/45634c96218df5dcd61be0afb120157c.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*poBmZgtoUrBpha6RcopByg.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">检测到疫苗接种_插槽后会发生什么</figcaption></figure><p id="e192" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">bot引擎的其余部分遵循简单的规则。如果意图被分类为置信度小于0.3(我们不是预测标签而是概率)，机器人简单地回答它不理解查询。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div></figure><h1 id="0332" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">后端操作</h1><p id="e782" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">好的。说够了。让我们看看后端会发生什么。我们是怎么得到这些信息的？为了获得Covid号，我们解析官方仪表板以获得相关数据。我们检查了robots.txt，确保我们遵守了规则集。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="4478" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了获得与疫苗接种相关的信息，我们使用印度政府共享的<a class="ae js" href="https://apisetu.gov.in/public/marketplace/api/cowin" rel="noopener ugc nofollow" target="_blank">开放API</a>。我们小心翼翼地遵循上述指南，并鼓励其他人以同样的方式使用这些服务。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ll"><img src="../Images/132e5fd39226658bbab85a27911c2081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Yb5Ez8ESdGS_gIz8bMA2g.jpeg"/></div></div></figure><h1 id="d048" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">将Vicci投入使用—部署</h1><p id="6dcd" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">对于前端，我们使用python flask，由简单的HTML/CSS和一些JQuery支持。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="7625" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">bot以字符串列表的形式返回响应，我们只需将它们作为新的段落元素添加到HTML容器中。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="ld le l"/></div></figure><h1 id="5940" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">试运转</h1><p id="f8f6" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">让我们带着我们的机器人去试运行吧</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lm"><img src="../Images/06925020adedc271dc049ff69b718b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xilE6-VogLPQaEIS4UyrPw.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ln"><img src="../Images/d03b43a3b4c8d352dd3f3c7daca39320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ATYuiCBSqeMriNljEI-J2A.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lo"><img src="../Images/99270b67c27f43db78b9d769536ba275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yo0G3FIZ-7h6P3dM90O8AQ.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lp"><img src="../Images/b04282960d727bda56b568ace97edbd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GztYEKFzETgxFyi48_c1eA.png"/></div></div></figure><h1 id="934a" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">改进领域</h1><p id="04a8" class="pw-post-body-paragraph iw ix hh iy b iz kx ii jb jc ky il je jf kz jh ji jj la jl jm jn lb jp jq jr ha bi translated">我们可以设计一个更好的上下文处理机制，它可以适应更长的历史，而不仅仅是以前的历史。请在下面的评论中告诉我你的想法和主意。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lq"><img src="../Images/ba529c408719e13d460c34926644ee12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZ_SJcV7ok5sU4TOgiYuQA.png"/></div></div></figure><p id="402a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，我们的数据集中没有训练数据来使机器人识别一般情况或与Covid无关的查询。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lr"><img src="../Images/accb84a2e5cd8ce4c6d182910373e291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*aDbs7JkC48XmI0URwcAbSg.png"/></div></figure><p id="db39" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这里，因为天花从来不是训练数据的一部分，所以聊天机器人将已知的特征(或单词)——症状——与它从训练中知道的联系起来，从而做出相应的反应。</p><p id="1cc7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们还可以尝试其他模型，如神经网络或LSTMs，看看它们的表现如何。你可以在这里查看我们的一些探索<a class="ae js" href="https://github.com/kr-prince/VICCI-Python-Chatbot/blob/main/experiments/model_training_tfModels.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ls lt go lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ha hb hc hd he"><p id="d747" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，我们使用基本python和经典ML技术开发聊天机器人的故事到此结束。</p><p id="0b91" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请在Github上查看并关注<a class="ae js" href="https://github.com/kr-prince/VICCI-Python-Chatbot" rel="noopener ugc nofollow" target="_blank">这个项目</a>。我们喜欢拉式请求。！请在评论中告诉我们你对此的想法。</p></div></div>    
</body>
</html>