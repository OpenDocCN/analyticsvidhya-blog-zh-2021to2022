<html>
<head>
<title>What’s inside DELTA LAKE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三角洲湖里面有什么</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/whats-inside-delta-lake-35952a6c033f?source=collection_archive---------1-----------------------#2021-07-31">https://medium.com/analytics-vidhya/whats-inside-delta-lake-35952a6c033f?source=collection_archive---------1-----------------------#2021-07-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/8fe03ba593495f585561b45ca3fad81b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tiQ8c68uzuZmgkSL"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">弗兰基·查马基在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c3ea" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">三角洲湖这个词你可能在上百个博客中听说过或者读到过，或者你可能在你的项目中使用过。</p><p id="d256" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个博客的目的不仅仅是谈论三角洲湖和它的概念，而是让你熟悉它是如何在引擎盖下工作的。</p><p id="f4a6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我们深入之前，让我们先打好基础。</p><h1 id="71b5" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">三角洲湖是什么？</h1><p id="cb2e" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">Delta Lake是一个开放式存储层，可为您的数据湖提供可靠性、安全性和性能，适用于流和批处理操作。通过用结构化、半结构化和非结构化数据的单一平台取代数据孤岛，Delta Lake成为经济高效、高度可扩展的lakehouse的基础。</p><p id="3932" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">来源:https://databricks.com/product/delta-lake-on-databricks<a class="ae it" href="https://databricks.com/product/delta-lake-on-databricks" rel="noopener ugc nofollow" target="_blank"/></p><p id="916c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">三角洲湖泊的特征</strong></p><blockquote class="kv kw kx"><p id="990c" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">耐酸性</p><p id="a55f" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">架构实施</p><p id="e060" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">支持流数据</p><p id="a561" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">时间旅行</p><p id="7c18" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">向上插入和删除兼容</p></blockquote><p id="4a9e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://delta.io/" rel="noopener ugc nofollow" target="_blank">https://delta.io/</a></p></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><h1 id="6276" class="js jt hh bd ju jv lj jx jy jz lk kb kc kd ll kf kg kh lm kj kk kl ln kn ko kp bi translated">三角洲湖的组成</h1><ol class=""><li id="e50c" class="lo lp hh iw b ix kq jb kr jf lq jj lr jn ls jr lt lu lv lw bi translated"><strong class="iw hi">三角洲湖泊储层</strong></li></ol><p id="d39f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们使用delta lake存储数据，使用Spark访问数据。这种方法提供了性能提升和数据的一致性。</p><p id="e2d3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 2。增量表</strong></p><p id="0bde" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="ky">拼花文件</em> </strong> <em class="ky"> : </em>增量表以拼花文件格式存储数据。</p><p id="f93a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="ky">交易日志:</em> </strong>它的每一笔交易都已经在这个表中有序的录入过了</p><p id="ad0a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在delta表的顶部触发任何查询时，spark检查事务日志，查看哪些新事务已经被提交到表中。并用新的更改更新表格。</p><p id="79b5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这确保了用户表总是与最新的变化同步</p><p id="0632" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="ky"> metastore: </em> </strong>存储模式和元数据。</p><p id="a701" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 3。德尔塔发动机</strong></p><p id="a78d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Delta Engine是一个高性能的Apache Spark兼容查询引擎，它提供了一种有效的方法来处理数据湖中的数据，包括存储在开源Delta Lake中的数据。Delta Engine可加速数据湖操作，支持从大规模ETL处理到即席交互式查询的各种工作负载。许多这样的优化是自动进行的；您只需为您的数据湖使用数据块，就可以获得这些Delta引擎功能的好处。</p><p id="f72b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">来源:https://docs.databricks.com/delta/optimizations/index.html<a class="ae it" href="https://docs.databricks.com/delta/optimizations/index.html" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><h1 id="da4a" class="js jt hh bd ju jv lj jx jy jz lk kb kc kd ll kf kg kh lm kj kk kl ln kn ko kp bi translated">让我们进入增量表</h1><p id="b320" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">当我们谈到Delta表时，它与普通表有什么不同？</p><p id="b255" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Delta表主要由以下两部分组成。</p><p id="5331" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">拼花文件:</strong>存储文件/数据的文件格式。</p><p id="fd86" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">事务日志:</strong>是增量表上发生的事务的有序记录。将此视为真实的来源，delta引擎将使用它来保证原子性。</p><p id="cde3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">显示增量表路径:</strong></p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/5b315692ebd7441113c12caa499a28cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXr1TpBLohjscfzafN4ZnQ.png"/></div></div></figure><p id="343b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们深入了解_delta_log文件夹。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/56304f9c9661878147660cf0e51d9a75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1V4XJjjdFFt-1UaQmekkcg.png"/></div></div></figure><p id="2e3a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> delta_log </strong>文件夹包含JSON文件，用于跟踪给定表中发生的所有事务。</p><p id="dcab" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">很快将有演示，并会谈论它更多。</p></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><h1 id="2281" class="js jt hh bd ju jv lj jx jy jz lk kb kc kd ll kf kg kh lm kj kk kl ln kn ko kp bi translated">三角洲湖时间旅行</h1><p id="a4de" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">使用三角洲湖时间旅行，我们可以参考以前版本的数据。</p><p id="5377" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">增量表，跟踪每个事务，在给定的时间点，它可以灵活地引用任何以前的快照。</p><p id="7aec" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">时间旅行会有所帮助</p><p id="19d0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">将数据的先前版本与当前版本进行比较</p><p id="3a73" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在数据损坏的情况下，我们可以返回到以前的快照。</p></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><h1 id="3278" class="js jt hh bd ju jv lj jx jy jz lk kb kc kd ll kf kg kh lm kj kk kl ln kn ko kp bi translated"><strong class="ak">演示</strong></h1><p id="4a11" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">让我们使用CSV文件创建一个简单的数据帧。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/2a5a155e68d0278f8a1426ef9e7e1d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tegEHJ9RTfc0caZG7dFKig.png"/></div></div></figure><p id="47f7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们通过将格式指定为“Delta”来将数据转换为<strong class="iw hi"> Delta </strong></p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/536a98b123703b222f5be0c21b32011e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OgGjdMv7_fxACCC8gKY0tw.png"/></div></div></figure><p id="4482" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们还可以在metastore中创建表。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/3ddca3f59261ebd9ac74f5a042b10750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8EPKoIxl5YvCykJqi-i-w.png"/></div></div></figure><p id="ca2d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Delta支持数据的分区。所以让我们用Year作为我们的分区列。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/d6a4f03e60f1a81886a16185eecd5281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xOAKns9QfxgoJ2NJsZ7xyQ.png"/></div></div></figure><p id="d416" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看看增量路径下有什么:</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/a0aca6c6035459c02abbc87f7321612d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYZkHscbSKiiP-wfDebEEA.png"/></div></div></figure><p id="e36a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第6，7，8，9行:</strong>是我们第一次向表中插入数据时创建的parquet文件。</p><p id="de07" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">行1，2，3，4: </strong>是当我们将数据插入相同的增量路径时创建的分区文件夹，但是是分区的。</p><p id="151e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第5行:_delta_log: </strong>包含事务日志</p><p id="e02c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们来挖掘delta_log:</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/96eb70304d730a5ab69c5cb58a3f750a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3ibawq3A-3NqH7vX18z4w.png"/></div></div></figure><p id="58c0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第5，6行:</strong>是事务日志，它保存了表中发生的事务</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/2062c6e5ed9817209ad92b97bade5aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IR-B03F4m61UNzeZzdF3vQ.png"/></div></div></figure><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/a1e877cddc49e80d0c2fb10744d46243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AXfvRotLqYzuIpbX1EVshg.png"/></div></div></figure><p id="bdc7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://docs.databricks.com/delta/delta-utility.html" rel="noopener ugc nofollow" target="_blank">四列</a>每一列代表对增量表的第一次提交的不同部分，创建该表。</p><ul class=""><li id="7053" class="lo lp hh iw b ix iy jb jc jf mk jj ml jn mm jr mn lu lv lw bi translated"><code class="du mo mp mq mr b">add:</code>包含关于各个列的信息。</li><li id="98e4" class="lo lp hh iw b ix ms jb mt jf mu jj mv jn mw jr mn lu lv lw bi translated"><code class="du mo mp mq mr b">commitInfo:</code>包含有关读或写操作类型的详细信息。加上时间戳和用户。</li><li id="6661" class="lo lp hh iw b ix ms jb mt jf mu jj mv jn mw jr mn lu lv lw bi translated"><code class="du mo mp mq mr b">metaData:</code>包含了模式信息。</li><li id="ac0a" class="lo lp hh iw b ix ms jb mt jf mu jj mv jn mw jr mn lu lv lw bi translated"><code class="du mo mp mq mr b">protocol:</code>包含增量版本。</li></ul><p id="d0ec" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为我们已经应用了2个写函数。</p><ol class=""><li id="216c" class="lo lp hh iw b ix iy jb jc jf mk jj ml jn mm jr lt lu lv lw bi translated">通过读取CSV &gt;版本0进行初始写入</li><li id="fbeb" class="lo lp hh iw b ix ms jb mt jf mu jj mv jn mw jr lt lu lv lw bi translated">在分区列上写入&gt;版本1</li></ol><p id="96fb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以查看版本1文件，并确认它捕获了变更。</p><p id="da3f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">PartitionValue包含我们进行分区所依据的列。</p><p id="b23e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在下面的截图中确认这一点。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mx"><img src="../Images/50ec0ea2f849c63aaa32639ad4aa2637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zDpJ6_HFxnd_0enhclbEAg.png"/></div></div></figure><p id="13a2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们编写版本3，对相同的数据进行过滤，并将其写回到相同的增量路径。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es my"><img src="../Images/9c0cd4e1f0f8440a630e9d311124aefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJ3iJE84rbRVIhEVPM3GJw.png"/></div></div></figure><p id="8292" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，即使在我们进行了覆盖之后，我们仍然可以看到与以前的提交相关的数据仍然存在。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/aecd0e67c59d74d1af1ce121e88a292e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cbp49xAiik-_kWt-Bl1pXA.png"/></div></div></figure></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><h1 id="6a48" class="js jt hh bd ju jv lj jx jy jz lk kb kc kd ll kf kg kh lm kj kk kl ln kn ko kp bi translated">使用时间旅行访问表的先前版本</h1><p id="f46b" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">到目前为止，我们已经执行了3次写入:</p><ol class=""><li id="45fd" class="lo lp hh iw b ix iy jb jc jf mk jj ml jn mm jr lt lu lv lw bi translated">读取初始CSV文件并写入增量路径</li><li id="81a6" class="lo lp hh iw b ix ms jb mt jf mu jj mv jn mw jr lt lu lv lw bi translated">已写入于年分区的csv文件</li><li id="a9ec" class="lo lp hh iw b ix ms jb mt jf mu jj mv jn mw jr lt lu lv lw bi translated">对基本工资列应用筛选器并写入差值路径</li></ol><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/846e3f38f8c93dae8ddeb3e9c7ddbeeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBO_WDxqcn_DJkvrla4J8Q.png"/></div></div></figure><p id="b984" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，根据我们的3次写入，我们在表中有3个不同的版本。</p><p id="1d00" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以回到指定的时间或版本。</p><p id="76b9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要访问特定版本，我们可以传递带有版本号的“versionAsOf”。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nb"><img src="../Images/a7b3fd638523fdb2511dfcb6933b9bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sYBs6TNnsaqEzbeGL5VfA.png"/></div></div></figure><p id="2134" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了回到特定的时间戳时间，我们可以传递带有时间戳值的“<strong class="iw hi"> timestampAsOf </strong>”。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nb"><img src="../Images/1c50c5ff2debcf695a2ea9f7d29cbbb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfYqEk0EGPqfxL8PKF1CYw.png"/></div></div></figure></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><h1 id="957c" class="js jt hh bd ju jv lj jx jy jz lk kb kc kd ll kf kg kh lm kj kk kl ln kn ko kp bi translated">真空</h1><p id="ea86" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">Vaccum是一个命令，可以用来清理我们的目录并删除任何以前版本的数据。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nc"><img src="../Images/be3799fe037fd50768b4c2315ae7cd32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FM3g8xqNX3A9tUtBMLwsPQ.png"/></div></div></figure><p id="1919" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当我们试图删除以前的版本时，我们得到了错误。这是为了防止意外删除。</p><p id="ce3b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以通过将“spark . data bricksδretentiondurationcheck . enabled”设置为<strong class="iw hi"> false </strong>来绕过默认的保持期检查。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nc"><img src="../Images/4b9a34a1f8826072db155d92ef13ff48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HesxVh7RUggFz5hFUfg4Bg.png"/></div></div></figure><p id="56f5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了确认版本0已被删除，让我们尝试运行版本0的read命令。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/0a00c523ec78381be465f338141b5c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPzl4t1DJYm-JDH_ivvQdQ.png"/></div></div></figure><p id="682e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，由于我们删除了版本0，我们仍然应该看到版本1，它是一个分区写入。</p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ne"><img src="../Images/4b442275081068e60e171374649800a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bU3T2a-ouGCLpYjjiSZumg.png"/></div></div></figure><p id="9813" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">递归清空与Spark表相关的目录，并删除超过保留阈值的未提交文件。默认阈值是7天。数据块在数据写入时自动触发<code class="du mo mp mq mr b">VACUUM</code>操作。</p><pre class="ly lz ma mb fd nf mr ng nh aw ni bi"><span id="8456" class="nj jt hh mr b fi nk nl l nm nn">VACUUM [ table_identifier | path] [RETAIN num HOURS]</span></pre><p id="1e19" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要清理Spark作业留下的未提交文件，使用<code class="du mo mp mq mr b">VACUUM</code>命令删除它们。通常<code class="du mo mp mq mr b">VACUUM</code>会在Spark任务完成后自动发生，但是如果任务中止，您也可以手动运行它。</p><p id="c3be" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，<code class="du mo mp mq mr b">VACUUM ... RETAIN 1 HOUR</code>删除超过一小时的未提交文件。</p><pre class="ly lz ma mb fd nf mr ng nh aw ni bi"><span id="d7ea" class="nj jt hh mr b fi nk nl l nm nn">// recursively vacuum an output path<br/>spark.sql("VACUUM '/path/to/output/directory' [RETAIN &lt;N&gt; HOURS]")<br/><br/>// vacuum all partitions of a catalog table<br/>spark.sql("VACUUM tableName [RETAIN &lt;N&gt; HOURS]")</span></pre><div class="no np ez fb nq nr"><a href="https://docs.databricks.com/sql/language-manual/delta-vacuum.html" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">真空(数据块SQL)</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">了解如何在Databricks SQL中使用SQL语言的真空语法。</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">docs.databricks.com</p></div></div></div></a></div><p id="1149" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在我的github repo中找到上面的代码:</p><div class="no np ez fb nq nr"><a href="https://github.com/ajithshetty/DeltaLakeDemo" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">GitHub-ajithshetty/DeltaLakeDemo</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">通过在GitHub上创建一个帐户，为ajithshetty/DeltaLakeDemo开发做出贡献。</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of in nr"/></div></div></a></div></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><p id="a793" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">参考:</strong></p><div class="no np ez fb nq nr"><a href="https://databricks.com/product/delta-lake-on-databricks" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">达布里克斯的三角洲湖-达布里克斯</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">Delta Lake是一个开放格式的存储层，可为您的数据湖提供可靠性、安全性和性能——</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">databricks.com</p></div></div><div class="oa l"><div class="og l oc od oe oa of in nr"/></div></div></a></div><div class="no np ez fb nq nr"><a href="https://delta.io/" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">三角洲湖-可靠的大规模数据湖</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">大数据中的可扩展元数据处理，甚至元数据本身也可以是“大数据”三角洲湖对待元数据只是…</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">delta.io</p></div></div><div class="oa l"><div class="oh l oc od oe oa of in nr"/></div></div></a></div><div class="no np ez fb nq nr"><a href="https://docs.databricks.com/spark/latest/spark-sql/language-manual/delta-vacuum.html" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">真空</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">了解如何在Databricks中使用SQL语言的VACUUM语法用于Spark和Delta表。</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">docs.databricks.com</p></div></div></div></a></div><div class="no np ez fb nq nr"><a href="https://databricks.com/blog/2020/08/21/top-5-reasons-to-convert-your-cloud-data-lake-to-a-delta-lake.html" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab dw"><div class="nt ab nu cl cj nv"><h2 class="bd hi fi z dy nw ea eb nx ed ef hg bi translated">将您的云数据湖转换为三角洲湖的五大理由</h2><div class="ny l"><h3 class="bd b fi z dy nw ea eb nx ed ef dx translated">如果你检查一下过去五年中任何一次星火峰会的议程，你会注意到没有…</h3></div><div class="nz l"><p class="bd b fp z dy nw ea eb nx ed ef dx translated">databricks.com</p></div></div><div class="oa l"><div class="oi l oc od oe oa of in nr"/></div></div></a></div><p id="16d7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://docs.delta.io/latest/quick-start.html" rel="noopener ugc nofollow" target="_blank">https://docs.delta.io/latest/quick-start.html</a></p><p id="e146" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">https://docs.microsoft.com/en-us/azure/databricks/delta/<a class="ae it" href="https://docs.microsoft.com/en-us/azure/databricks/delta/" rel="noopener ugc nofollow" target="_blank"/></p><figure class="ly lz ma mb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es oj"><img src="../Images/dd77fc9bbbfaf3a145434bdcfe7eede1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-VHig9whdJZ8dv3U.png"/></div></div></figure><p id="2dcf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">阿吉特·库玛尔·谢蒂</strong></p><p id="fa09" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">大数据工程师—热爱大数据、分析、云和基础设施。</p><p id="8ec0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://ajithshetty28.medium.com/subscribe" rel="noopener">订阅</a> ✉️ || <a class="ae it" href="https://ajithshetty28.medium.com/" rel="noopener">更多博客</a>📝|| <a class="ae it" href="https://www.linkedin.com/in/ajshetty28" rel="noopener ugc nofollow" target="_blank">链接于</a>📊|| <a class="ae it" href="https://ajithshetty.github.io/" rel="noopener ugc nofollow" target="_blank">个人资料页面</a>📚|| <a class="ae it" href="https://github.com/ajithshetty/" rel="noopener ugc nofollow" target="_blank"> Git回购</a>👓</p><p id="f548" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">订阅我的:</strong> <a class="ae it" href="https://justenoughdata.substack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">每周简讯刚刚够数据</strong> </a></p></div></div>    
</body>
</html>