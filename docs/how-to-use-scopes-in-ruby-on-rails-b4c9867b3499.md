# 如何在 Ruby on Rails 中使用作用域

> 原文：<https://medium.com/analytics-vidhya/how-to-use-scopes-in-ruby-on-rails-b4c9867b3499?source=collection_archive---------5----------------------->

**什么是范围？**

![](img/18fd7135848d351525335391257ffd8e.png)

首先，这张图片与我们的主题无关。只想要一个华而不实的入口:)

好吧，让我们回到我们的主题:

> **范围**是您用**范围**方法在 **Rails** 模型中定义的定制查询。

**每个作用域都有两个参数:**

一个名称，您用它在代码中调用这个**范围**。

实现查询的 lambda。

***示例:作用域:active_users，->{ where(active:true)}***

![](img/e4ddacbee9fe9b64570c20cf8071cef1.png)

您将获得一个`ActiveRecord::Relation`对象作为每个作用域的输出。

**组合多个范围:**

***例:user . active _ users . with _ account . first(3)***

**什么时候使用？**

如果您想在其他地方使用相同的查询，您将有重复的代码。

这个场景非常适合使用范围。

# 如何使用带有参数的 Rails 作用域

您可能希望在作用域中引入一个变量，这样可以使它更加灵活。

> **类用户**
> 
> **范围:冗长 _ 用户，- >(长度){ where("长度(标题)>？"，长度)}**
> 
> **结束**

# 范围与类方法

范围与类方法相同。事实上，它们可以实现相同的功能。

> 类别用户
> 
> 定义自我活动 _ 用户
> 
> 其中(活动:真)
> 
> 结束
> 
> 结束

唯一的区别是作用域保证一个`ActiveRecord::Relation`，而类方法不保证，这有助于你在作用域不返回任何东西时避免错误。

# 不要使用默认范围

![](img/b2e4aafe7aeb281c4f70832b431fddad.png)

是啊！

默认范围是如此吸引人。

但是它们通常是错误的选择，因为您可能会忘记已经定义了它们，遇到奇怪的错误，浪费宝贵的调试时间。

如果你必须使用默认的作用域，你可能需要使用`**unscoped**`方法来禁用所有当前应用的作用域。

感谢阅读……祝你有一个伟大的编码。