<html>
<head>
<title>Data cleaning fundamentals for any Machine Learning project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">任何机器学习项目的数据清理基础</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/data-cleaning-fundamentals-for-any-machine-learning-project-7db745a42d95?source=collection_archive---------8-----------------------#2021-07-06">https://medium.com/analytics-vidhya/data-cleaning-fundamentals-for-any-machine-learning-project-7db745a42d95?source=collection_archive---------8-----------------------#2021-07-06</a></blockquote><div><div class="dt gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="eef3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大家好！在本文中，我将讨论数据科学家在任何项目中最喜欢的任务…清理数据。开玩笑，几乎没有人喜欢这个任务。正如你在这篇<a class="ae jd" href="forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/?sh=2cb7333a6f63" rel="noopener ugc nofollow" target="_blank">福布斯文章</a>中读到的，76%的数据科学家发现数据清理是他们工作中最耗时、最不愉快的任务。然而，这可以说是任何机器或深度学习项目中最重要的一个阶段，因此对数据清理艺术的基础的良好理解对您的项目的成功至关重要。在这篇文章中，我将讨论两个主要类别:</p><ol class=""><li id="b394" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><strong class="ih hj">处理结构化数据</strong></li></ol><ul class=""><li id="fe71" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jn jk jl jm bi translated">它是什么，从哪里得到它。</li><li id="5858" class="je jf hi ih b ii jo im jp iq jq iu jr iy js jc jn jk jl jm bi translated">清理数据帧的基本技术。</li></ul><p id="273c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<strong class="ih hj">处理非结构化数据</strong></p><ul class=""><li id="5031" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jn jk jl jm bi translated">它是什么，如何得到它。</li><li id="dc79" class="je jf hi ih b ii jo im jp iq jq iu jr iy js jc jn jk jl jm bi translated">一个从web中提取数据的web scraper示例。</li></ul><blockquote class="jt"><p id="fcfd" class="ju jv hi bd jw jx jy jz ka kb kc jc dy translated">这并不是数据清理的全面指南。相反，我的目标是帮助你们理解数据清理的主要概念，以及数据科学家试图通过这样做来实现什么。清理数据没有固定的方法，在某些方面，它更像是一门艺术而不是科学，所以保持开放的心态，尝试不同的事情。此外，有许多复杂的算法和技术可以用来清理更复杂的数据集，我将在以后的文章中介绍。我希望你觉得它有用，是一个很好的初学者练习。</p></blockquote><h1 id="409d" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结构数据</h1><p id="246a" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">结构化数据是指那些组织有序、定义明确且易于访问的数据集。酷，这是什么意思？这意味着数据分析师可以轻松地分析这种类型的数据。因为它被清楚地标记和有效地组织，它还简化了机器学习工程师开发训练/验证集以训练他们的模型的任务。结构化数据的一些例子是excel电子表格、SQL数据库或医疗记录。总的来说，它只是让处理大量数据变得更加容易。</p><p id="5145" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你如何获得这些数据集？嗯，有很多可能性，你可以从<a class="ae jd" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载一个，自己开发一个电子表格或者利用你公司的数据库。查看<a class="ae jd" href="https://pub.towardsai.net/best-datasets-for-machine-learning-data-science-computer-vision-nlp-ai-c9541058cf4f" rel="noopener ugc nofollow" target="_blank">这篇文章</a>，了解从哪里获取数据集的更详细的研究。今天，我们将从Kaggle下载一个包含金砖四国经济数据的数据集，并执行基本的探索性数据分析(EDA)和数据清理技术。金砖国家是世界上最大的新兴国家类别，代表巴西、俄罗斯、印度、中国和南非。</p><p id="51ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以从<a class="ae jd" href="https://www.kaggle.com/docstein/brics-world-bank-indicators" rel="noopener ugc nofollow" target="_blank">这里</a>下载数据。</p><p id="1835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你还没有一个Kaggle帐户，这是一个很好的时机。Kaggle提供了大量不同的数据集和比赛，可以为你的个人项目提供数据，并提供机会在比赛中展示你的技能，这些比赛通常提供工作，实习或非常丰厚的奖品。</p><p id="d112" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，让我们把手弄脏。我将包含经济数据的csv文件存储在我的电脑上，并使用pandas在jupyter笔记本上阅读它(你可以在本文底部找到链接)。</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="87d4" class="lp ke hi ll b fj lq lr l ls lt">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>%matplotlib inline</span><span id="3951" class="lp ke hi ll b fj lu lr l ls lt">economicData = pd.read_csv('C:\\Users\\Bonoc\\Documents\\Medium\\BRICS\\archive\\BRICS Development Indicators\\Economy_Data.csv', sep=';')</span></pre><p id="c6ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们可以开始研究数据集的一些细节。首先，我们将打印出前10行，以检查它是如何组织的。</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="71e0" class="lp ke hi ll b fj lq lr l ls lt">economicData.head(10)</span></pre><figure class="lg lh li lj fe lw es et paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="es et lv"><img src="../Images/a517c7742f0423b9e114afc67ac2d10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMbC-VLBGxrvEx9w5c5krg.png"/></div></div></figure><p id="47ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好，我们观察到数据集有一个<a class="ae jd" href="https://www.theanalysisfactor.com/wide-and-long-data/" rel="noopener ugc nofollow" target="_blank">长格式</a>，并且似乎有几个NaN值。让我们检查每一列的数据类型。</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="d026" class="lp ke hi ll b fj lq lr l ls lt">economicData.info()</span></pre><figure class="lg lh li lj fe lw es et paragraph-image"><div class="es et md"><img src="../Images/f6118714955d8ad6f47fbe8320bc2891.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*RBuPPHdHnJz7dtrUrEZKeA.png"/></div></figure><p id="0ae2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当看到这个描述时，我首先想到的是，我们可以将“Year”的数据类型改为更简单的类型。我们可以将其更改为datetime，但是因为我们只提供了年份(不是完整的日期),所以我们应该将它们规范化为int64。当您想快速浏览数据集包含的所有内容时，info()方法非常有用。或者，您可以使用以下命令分别分析每个部分:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="4b9c" class="lp ke hi ll b fj lq lr l ls lt"># returns a tuple (num of rows, num of columns)<br/>economicData.shape</span><span id="eade" class="lp ke hi ll b fj lu lr l ls lt"># Returns the data type of each column<br/>economicData.dtypes</span><span id="6a73" class="lp ke hi ll b fj lu lr l ls lt"># Returns the name of the columns in your dataset<br/>economicData.columns</span></pre><p id="493c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来我们应该检查的是空值。我们可以用很多方法来检查这一点，但我发现最具描述性的方法是空值相对于记录数的百分比。</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="1e23" class="lp ke hi ll b fj lq lr l ls lt">for col in economicData.columns:<br/>    pct_missing = np.mean(economicData[col].isnull())<br/>    print('{} - {}%'.format(col, round(pct_missing*100)))</span></pre><figure class="lg lh li lj fe lw es et paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="es et me"><img src="../Images/243dd2fdb603210bfbe6e1d75472abe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*8sDG7T9tt-d_Ii1SY1I5bQ.png"/></div></div></figure><p id="c60d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们面临着一个棘手的决定。我们注意到有30%的值丢失了。好吧，我们该拿他们怎么办？我们可以删除这些行，用平均值或中值(或分类数据的模式)等统计测量值填充空值，或者我们可以为其分配一个特殊值，如超大值或小值(即-99999或12345678)，以便区分它们。现在决定权在你手中，如果你认为这些值不会给你的分析增加大量的信息，那就删除它们。如果您想开发一个预测模型，也许您可以尝试用数据集中所有值的平均值或中值来替换它们。因为在这篇文章中，我们并不特别试图开发一个特定的模型，所以我决定删除那些缺少值的行，以减少这个数据集的大小和复杂性。我们通过利用熊猫dropna方法实现了这一目标:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="762e" class="lp ke hi ll b fj lq lr l ls lt">economicData.dropna(subset=['Value'], inplace=True)</span></pre><p id="d2a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，inplace=True会将更改直接应用到数据集，inplace=False会输出数据集外观的预览，但不会应用这些更改。此外，我想删除一些似乎没有添加重要信息的列:“SeriesCode”和“CountryName”。你可能会问，为什么是“国家名称”而不是“国家代码”？答案是国家代码是国家的统一表示，它不会随着数据集而改变，而名称可以缩写或使用不同的语言。如果在某个时候您决定将另一个数据集与这些国家的其他数据进行聚合，这将非常有用，如果您保留国家代码，您可以基于这些代码连接或合并这些数据集(因为<a class="ae jd" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.join.html" rel="noopener ugc nofollow" target="_blank">连接</a>和<a class="ae jd" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html" rel="noopener ugc nofollow" target="_blank">合并</a>要求单元格值相同)。</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="c669" class="lp ke hi ll b fj lq lr l ls lt">economicData.drop(['SeriesCode', 'CountryName'], axis=1, inplace=True)</span></pre><p id="c187" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">厉害！我们的数据集看起来已经整洁多了。如果我们再次打印数据集，我们会注意到索引已经被修改，因为我们删除了行而没有更新索引。这是一个可选步骤，但通常很有用。现在我们已经清理了大部分数据集，让我们重新设置索引:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="51e6" class="lp ke hi ll b fj lq lr l ls lt">economicData.reset_index(drop=True, inplace=True)</span></pre><p id="a878" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以选择特定的指标来进一步缩减数据集的规模，只关注那些我们真正感兴趣的分析内容。我挑选了8个指标，并修改了现有的economicData数据框架，使其只包含关于这些指标的数据，由于我们已经处理了空值，因此我们可以确定每一行都包含值。然后，我最后一次重置索引，并将“Year”列的数据类型更改为int64。</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="0de9" class="lp ke hi ll b fj lq lr l ls lt">economicData = economicData.loc[economicData['SeriesName'].isin(labels)]</span><span id="f2af" class="lp ke hi ll b fj lu lr l ls lt">economicData.reset_index(drop=True, inplace=True)</span><span id="1679" class="lp ke hi ll b fj lu lr l ls lt">economicData.loc[:,'Year'] = pd.to_datetime(economicData['Year'], format='%Y').dt.year</span><span id="2581" class="lp ke hi ll b fj lu lr l ls lt">economicData</span></pre><figure class="lg lh li lj fe lw es et paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="es et mf"><img src="../Images/ec71be73286527c89ee20fe392eff305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fCv4OeHF9JyLB7EcPcSEWA.png"/></div></div></figure><p id="4b99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太神奇了！现在，我们只剩下原始数据集的一个更小的子集，没有空值和具有首选数据类型的列。从这里开始，世界就是你的了，你可以创建单独的数据框架，只包含特定国家的数据或每个国家一个数据，如下所示:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="2d38" class="lp ke hi ll b fj lq lr l ls lt">brazil = economicData[economicData['CountryCode'] == 'BRA']</span><span id="0084" class="lp ke hi ll b fj lu lr l ls lt">china = economicData[economicData['CountryCode'] == 'CHN']</span><span id="42a6" class="lp ke hi ll b fj lu lr l ls lt">southAfrica = economicData[economicData['CountryCode'] == 'ZAF']</span><span id="4929" class="lp ke hi ll b fj lu lr l ls lt">russia = economicData[economicData['CountryCode'] == 'RUS']</span><span id="37ff" class="lp ke hi ll b fj lu lr l ls lt">india = economicData[economicData['CountryCode'] == 'IND']</span></pre><p id="6af5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者你可以绘制一个特定指标随时间的演变。例如，我们可以将每个国家每年的GDP增长可视化。原谅我的代码不够整洁，我还在掌握python中的可视化:)</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="be8a" class="lp ke hi ll b fj lq lr l ls lt">plt.plot(brazil.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Year'],<br/>         brazil.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Value']/1000000000)</span><span id="d5e8" class="lp ke hi ll b fj lu lr l ls lt">plt.plot(russia.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Year'],<br/>         russia.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Value']/1000000000)</span><span id="e43c" class="lp ke hi ll b fj lu lr l ls lt">plt.plot(southAfrica.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Year'],<br/>         southAfrica.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Value']/1000000000)</span><span id="7ad7" class="lp ke hi ll b fj lu lr l ls lt">plt.plot(india.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Year'],<br/>         india.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Value']/1000000000)</span><span id="0d2d" class="lp ke hi ll b fj lu lr l ls lt">plt.plot(china.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Year'],<br/>         china.loc[economicData['SeriesName'].isin(['GDP (current US$)'])]['Value']/1000000000)</span><span id="2246" class="lp ke hi ll b fj lu lr l ls lt">plt.title('BRICS GPD (current US$) growth in billions')<br/>plt.xlabel('Year')<br/>plt.ylabel('GPD (current US$) in billions')</span><span id="a513" class="lp ke hi ll b fj lu lr l ls lt">plt.show()</span></pre><figure class="lg lh li lj fe lw es et paragraph-image"><div class="es et mg"><img src="../Images/ac274728b8521b96bba3a680e35135cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*7cwh12Hby2dqc3sfg4p55A.png"/></div></figure><h1 id="f5ad" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko mh kq kr ks mi ku kv kw mj ky kz la bi translated"><strong class="ak">非结构化数据</strong></h1><p id="f6f7" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">与结构化数据不同，这些数据集没有特定的格式，也没有有效的组织方式。这并不意味着他们更好或更差，他们只是不同。结构化和非结构化数据通常互为补充，因为它们有非常不同的用途。非结构化数据的一些例子是pdf、tweets、自然语言和从网络上搜集的数据。非结构化数据通常更慢，处理起来更具挑战性，但它为我们提供了执行各种酷实验的机会，如情感分析、图像分类、自动化金融分析以及许多其他任务。另外，谁不喜欢好的挑战呢？</p><p id="50cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们将刮下伯克希尔·哈撒韦公司的投资组合，清理干净，并将其存储在熊猫的数据框架中。请注意，这篇文章的重点是数据清理，因此没有太多的重点放在解释网络抓取的概念。然而，如果你对此感兴趣，请在评论中告诉我，我会写一篇文章详细解释网络抓取的艺术:)</p><p id="21fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始吧…</p><p id="2992" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将使用<a class="ae jd" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank">美汤</a>和<a class="ae jd" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank">请求</a>来编写我们的web scraper。下面是如何做到这一点:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="9294" class="lp ke hi ll b fj lq lr l ls lt">import pandas as pd<br/>import bs4 as soup<br/>import requests<br/>import numpy as np</span><span id="4bd3" class="lp ke hi ll b fj lu lr l ls lt">## link where we will get our data from<br/>url = '<a class="ae jd" href="https://finance.yahoo.com/u/yahoo-finance/watchlists/the-berkshire-hathaway-portfolio?.tsrc=fin-srch'" rel="noopener ugc nofollow" target="_blank">https://finance.yahoo.com/u/yahoo-finance/watchlists/the-berkshire-hathaway-portfolio?.tsrc=fin-srch'</a></span><span id="c7d5" class="lp ke hi ll b fj lu lr l ls lt">## download webpage HTML code<br/>info = requests.get(url) <br/>data = soup.BeautifulSoup(info.text, 'lxml')</span></pre><p id="1729" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，web scraper是一个程序，它提取给定网页的HTML代码，并让您与它交互以提取信息。它是用于各种数据挖掘任务的非常常见的工具。</p><p id="8992" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了HTML，我们需要检查它并找到与我们的项目相关的信息。在我们的例子中，我们将提取包含伯克希尔·哈撒韦公司投资组合中所有持股的表，以及它们各自的信息(价格、交易量、股票代码……)。为此，我们可以右键单击包含此类信息的表格，然后选择“inspect”。如果这是你第一次看HTML代码，它可能会有点令人生畏，采取深度广度和放松，它看起来简单得多。将鼠标悬停在不同的代码行上，你会看到网页浏览器突出显示了与代码行相关的网页部分。标签<tbody>似乎包含了表中的所有数据。如果您点击</tbody><tbody>标签，将会出现其他几个标签。同样，将鼠标悬停在它们上面，注意到<tr>标签包含表格行，而<td>标签包含每个单元格的信息。很直观吧？很好，因为我们需要表格中每个单元格的信息，所以我们将遍历这个HTML上的所有</td><td>标签，并将数据存储在一个python列表中:</td></tr></tbody></p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="cc96" class="lp ke hi ll b fj lq lr l ls lt">## we leverage bs4 to inspect the HTML we just downloaded<br/>## once we find the location of the data we are interested in we store it on a list</span><span id="5413" class="lp ke hi ll b fj lu lr l ls lt">stocks = []</span><span id="ef71" class="lp ke hi ll b fj lu lr l ls lt">for i in data.findAll('td'):<br/>    stocks.append(i.text)</span></pre><p id="85e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我鼓励你打印出原始数据并进行分析。稍微摆弄一下。实验是任何研究项目的一个关键方面。这样做时，我们可以观察到，例如，<td>返回了网页中所有表格的单个单元格的数据，在本例中是两个。所以，我想去掉第一张表中的信息，它包含了整个投资组合的表现数据。</td></p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="57a1" class="lp ke hi ll b fj lq lr l ls lt">## extra code to eliminate the first ten data points about the overall portfolio<br/>parsedStocks = stocks[10:]</span></pre><p id="be41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！我们已经走了一半了。我们必须做的下一件事是重新组织我们的数据，以便能够创建一个熊猫数据框架。为此，我认为创建一个嵌套列表会有所帮助，在一个单独的列表中包含每只股票的信息。每只股票提供了九个数据点，所以如果我们将我们的<em class="mk">股票</em>列表分成每九个元素，我们很可能会得到我们想要的。让我们试一试:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="3cfe" class="lp ke hi ll b fj lq lr l ls lt">## Let's create a a list per stock. <br/>## This way it will be easier to create a dataframe with each row representing a ticker and all its info</span><span id="3cb9" class="lp ke hi ll b fj lu lr l ls lt">x=0<br/>y=len(parsedStocks)</span><span id="fb47" class="lp ke hi ll b fj lu lr l ls lt">listStocks = []<br/>for i in range(x,y,9):<br/>    x=i<br/>    listStocks.append(parsedStocks[x:x+9])</span></pre><p id="3811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们循环遍历我们的<em class="mk"> parsedStocks </em>列表，范围从0到列表的长度(但不包括在内),并且每9个元素遍历一次。然后，我们将这些列表添加到一个名为<em class="mk"> listStocks </em>的新列表中(我知道这不是很有创意)，瞧！我们已经清理了嵌套列表，其中包含关于BHportfolio 持股的信息。让我们现在就创建我们心爱的熊猫数据框架:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="3ae4" class="lp ke hi ll b fj lq lr l ls lt">## The column names for our dataframe<br/>headers = ['Ticker', 'Company', 'Last Price', 'Change US$', 'Change %',<br/>            'Time', 'Volume', 'Avg Volume (3 months)', 'Market Cap']</span><span id="e678" class="lp ke hi ll b fj lu lr l ls lt">## Create dataframe<br/>BHportfolio = pd.DataFrame(columns=headers)</span><span id="4377" class="lp ke hi ll b fj lu lr l ls lt">## Finally populate the dataframe with out stock data<br/>for row in listStocks:<br/>    length = len(BHportfolio)<br/>    BHportfolio.loc[length] = row<br/>    <br/>BHportfolio</span></pre><figure class="lg lh li lj fe lw es et paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="es et ml"><img src="../Images/2425ba781d279a921009f483ebc71494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6x5pt-1SCBGmL3l2NB7QXA.png"/></div></div></figure><p id="e4dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">难以置信！从这里，我们可以继续利用我们在清理BRICS数据集时试验过的任何上述技术。查看BHportfolio.info()并检查dtypes和列/行数。检查您是否可以删除任何内容以使其更加简洁(例如，我决定删除时间列，因为我对它没有用处)，检查是否有任何空值。</p><p id="d6ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，您可以用新的数据框架非常容易地开发一个SQL数据库。只需复制以下代码:</p><pre class="lg lh li lj fe lk ll lm ln aw lo bi"><span id="6ad2" class="lp ke hi ll b fj lq lr l ls lt">import sqlite3</span><span id="f803" class="lp ke hi ll b fj lu lr l ls lt">database = sqlite3.connect('CursoDB2.db') # Any name you want<br/>c = database.cursor()</span><span id="2539" class="lp ke hi ll b fj lu lr l ls lt"># I create a table called "STOCKS" <br/># Note we are now using SQL syntax, but in Python! Pretty cool...</span><span id="d457" class="lp ke hi ll b fj lu lr l ls lt">c.execute("CREATE TABLE STOCKS (Ticker, Company, LastPrice, ChangeDollar, ChangePerc, Volume, AvgVolume, MarketCap)")</span><span id="468b" class="lp ke hi ll b fj lu lr l ls lt">database.commit()</span><span id="0f7c" class="lp ke hi ll b fj lu lr l ls lt">BHportfolio.to_sql('STOCKS', database, if_exists = 'replace', index=False)</span><span id="0e4b" class="lp ke hi ll b fj lu lr l ls lt"># Now we can access our new SQL database and perform queries</span><span id="a837" class="lp ke hi ll b fj lu lr l ls lt">c.execute('''<br/>SELECT * FROM STOCKS<br/>          ''')</span><span id="6d01" class="lp ke hi ll b fj lu lr l ls lt">for row in c.fetchall():<br/>    print(row)</span></pre><p id="402b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哇，对于各种项目来说，python确实是一个了不起的工具。从这里开始，你只能被你的想象所束缚。比如我用这个程序创建了一个<a class="ae jd" href="https://www.lifewire.com/bat-file-2619796" rel="noopener ugc nofollow" target="_blank">。bat每天在开市前后自动从yahoo finance获取股票，然后我可以开发一个交易机器人，使用更新数据进行交易或发出警报。可能性是无限的！</a></p><h1 id="10e6" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko mh kq kr ks mi ku kv kw mj ky kz la bi translated"><strong class="ak">结论</strong></h1><p id="a42b" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">我希望这篇文章对你有所帮助和启发。主要目标是为读者提供一种简单的方法来下载、分析和清理结构化和非结构化格式的数据集，并解释两者之间的主要差异(特别是为什么一个不应该被认为比另一个“更好”)。理解数据清理和分析的基本概念不仅对机器或深度学习项目至关重要，而且对未来的任何项目都至关重要，因为大数据的最新趋势，对每个学科都有某种编程技能的员工/实习生的需求，以及对更加数字化和数据驱动的社会的普遍推动。</p><h2 id="78e7" class="lp ke hi bd kf mm mn mo kj mp mq mr kn iq ms mt kr iu mu mv kv iy mw mx kz my bi translated">非常感谢您的阅读！</h2></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><p id="8cc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里是完整的笔记本和一些额外的内容，以满足最好奇的读者的想法:</p><div class="ng nh fa fc ni nj"><a href="https://github.com/Bonorinoa/medium/tree/main/dataCleaning" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dx"><div class="nl ab nm cl cj nn"><h2 class="bd hj fj z dz no eb ec np ee eg hh bi translated">bono rinoa/培养基</h2><div class="nq l"><h3 class="bd b fj z dz no eb ec np ee eg dy translated">我用来补充我的媒体文章的笔记本和脚本的集合。- Bonorinoa/medium</h3></div><div class="nr l"><p class="bd b fq z dz no eb ec np ee eg dy translated">github.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx mb nj"/></div></div></a></div><div class="ng nh fa fc ni nj"><a href="https://www.scrapingbee.com/blog/web-scraping-101-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dx"><div class="nl ab nm cl cj nn"><h2 class="bd hj fj z dz no eb ec np ee eg hh bi translated">Python网络抓取:你需要知道的一切(2021)</h2><div class="nq l"><h3 class="bd b fj z dz no eb ec np ee eg dy translated">在这篇文章中，我们将介绍…</h3></div><div class="nr l"><p class="bd b fq z dz no eb ec np ee eg dy translated">www.scrapingbee.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx mb nj"/></div></div></a></div><div class="ng nh fa fc ni nj"><a href="https://handsoffinvesting.com/automating-your-stock-analysis-with-python/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dx"><div class="nl ab nm cl cj nn"><h2 class="bd hj fj z dz no eb ec np ee eg hh bi translated">使用Python自动化您的股票分析——放手投资</h2><div class="nq l"><h3 class="bd b fj z dz no eb ec np ee eg dy translated">沃伦·巴菲特曾建议投资者“在别人贪婪时恐惧，在别人恐惧时贪婪”。今天…</h3></div><div class="nr l"><p class="bd b fq z dz no eb ec np ee eg dy translated">handsoffinvesting.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx mb nj"/></div></div></a></div><div class="ng nh fa fc ni nj"><a href="https://www.auedbaki.com/article/how-to-schedule-batch-files-to-run-automatically-in-windows-10-1609865374401#" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dx"><div class="nl ab nm cl cj nn"><h2 class="bd hj fj z dz no eb ec np ee eg hh bi translated">如何安排批处理文件在Windows 10中自动运行</h2><div class="nq l"><h3 class="bd b fj z dz no eb ec np ee eg dy translated">批处理文件通常用于自动化Windows计算机中的重复性任务，并且能够安排这些任务…</h3></div><div class="nr l"><p class="bd b fq z dz no eb ec np ee eg dy translated">www.auedbaki.com</p></div></div><div class="ns l"><div class="oa l nu nv nw ns nx mb nj"/></div></div></a></div></div></div>    
</body>
</html>