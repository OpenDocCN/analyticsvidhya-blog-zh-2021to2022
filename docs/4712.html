<html>
<head>
<title>Azure Synapse Analytics invoke Azure ML Batch Endpoint using HTTP/Web activity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Synapse Analytics使用HTTP/Web活动调用Azure ML批处理端点</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-synapse-analytics-invoke-azure-ml-batch-endpoint-using-http-web-activity-4b4e139b8325?source=collection_archive---------0-----------------------#2022-01-15">https://medium.com/analytics-vidhya/azure-synapse-analytics-invoke-azure-ml-batch-endpoint-using-http-web-activity-4b4e139b8325?source=collection_archive---------0-----------------------#2022-01-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="f5d5" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">如何使用Synapse Integrate中的HTTP/Web活动调用Azure ML批处理端点</h1><h1 id="d52e" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="f33e" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="718f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储</li><li id="18f1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure机器学习服务</li><li id="4ead" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">根据文档创建批处理端点</li><li id="6c96" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">本文没有展示如何部署batch endpoint。</li><li id="3cdc" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated"><a class="ae jz" href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-use-batch-endpoint" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/machine-learning/how-to-use-batch-endpoint</a></li><li id="dc0f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">上述链接中提供了批处理端点的代码</li><li id="6592" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建Azure synapse分析工作区</li><li id="965e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建Azure密钥库</li><li id="4124" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将客户端id、密码和租户存储在Azure Keyvault中</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="e00a" class="kj if hh kf b fi kk kl l km kn">Note: to show how we can do ETL/ELT and then invoke batch endpoint to score ML model.</span></pre><h1 id="020c" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">架构/流程</h1><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ko"><img src="../Images/1be682ee4d1ac5510333ab92790e6653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qLSB0bB9He43BWAr.jpg"/></div></div></figure><h1 id="b052" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">流程步骤/活动</h1><ul class=""><li id="58ff" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">带来网络活动</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kw"><img src="../Images/06a8026e7b4220114f05ddc2ed7f78c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pWMilBxuX_x3DM90.jpg"/></div></div></figure><ul class=""><li id="61f2" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">为存储在Azure Keyvault中的客户端id配置机密URL</li><li id="d599" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于URL</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ee8d" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://keyvaultname.vault.azure.net/secrets/secretname/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?api-version=7.0" rel="noopener ugc nofollow" target="_blank">https://keyvaultname.vault.azure.net/secrets/secretname/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?api-version=7.0</a></span></pre><ul class=""><li id="b484" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">选择获取</li><li id="479f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于资源</li><li id="73f8" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于安全性，选择受管理的身份</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="d124" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://vault.azure.net" rel="noopener ugc nofollow" target="_blank">https://vault.azure.net</a></span></pre><ul class=""><li id="65d1" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">创建变量</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lc"><img src="../Images/e40124ef138ab05945597307ba935ab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DVl77RmTTlOWrg2J.jpg"/></div></div></figure><ul class=""><li id="a62a" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在设置变量</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ld"><img src="../Images/d8e6953ffb99ade27483e516588f1cc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rjWQqSUgEYMf9pMk.jpg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="f712" class="kj if hh kf b fi kk kl l km kn">@activity('clientid').output.value</span></pre><ul class=""><li id="698b" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在让我们再次拖动网络活动的秘密</li><li id="cb8b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于URL</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es le"><img src="../Images/83718d97d13779064c000dbc31262bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*THum3_pHmwpQg48G.jpg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="0c8c" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://keyvaultname.vault.azure.net/secrets/secretname/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?api-version=7.0" rel="noopener ugc nofollow" target="_blank">https://keyvaultname.vault.azure.net/secrets/secretname/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx?api-version=7.0</a></span></pre><ul class=""><li id="0ed2" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">选择获取</li><li id="22ae" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于资源</li><li id="fe3b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于安全性，选择受管理的身份</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="202a" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://vault.azure.net" rel="noopener ugc nofollow" target="_blank">https://vault.azure.net</a></span></pre><ul class=""><li id="3480" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">接下来设置变量</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lf"><img src="../Images/78aa5f8dcf21ce068d8af8b37598d6b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aY82jO61eMpPAjMT.jpg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="32eb" class="kj if hh kf b fi kk kl l km kn">@activity('clientsecret').output.value</span></pre><ul class=""><li id="2c0e" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在让我们获取授权令牌</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lg"><img src="../Images/6b14399def8f1d6c87e66eb0c354a084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R-iheCBVX3EPUJPu.jpg"/></div></div></figure><ul class=""><li id="00fa" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">对于URL</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="51f7" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://login.microsoftonline.com/tenantid/oauth2/token" rel="noopener ugc nofollow" target="_blank">https://login.microsoftonline.com/tenantid/oauth2/token</a></span></pre><ul class=""><li id="8e70" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">对于身体</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="cf6b" class="kj if hh kf b fi kk kl l km kn">@concat('grant_type=client_credentials&amp;client_id=',variables('clientid'),'&amp;resource=https://management.core.windows.net/&amp;client_secret=',variables('clienttoken'))</span></pre><ul class=""><li id="09ed" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在将令牌保存在变量中</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="3074" class="kj if hh kf b fi kk kl l km kn">@activity('Getbearertoken').output.access_token</span></pre><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lh"><img src="../Images/32f4af5271bf5936d1b2323fa98dbe67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xFVzDViebBHZeLLO.jpg"/></div></div></figure><ul class=""><li id="ce3f" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在让我们为批处理端点获取一个计分令牌</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es li"><img src="../Images/8f1c70ae2747273d72445302d8ead4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5N218NgoZCEH0SkA.jpg"/></div></div></figure><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="99eb" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://login.microsoftonline.com/tenantid/oauth2/token" rel="noopener ugc nofollow" target="_blank">https://login.microsoftonline.com/tenantid/oauth2/token</a></span><span id="712f" class="kj if hh kf b fi lj kl l km kn">@concat('grant_type=client_credentials&amp;client_id=',variables('clientid'),'&amp;resource=https://ml.azure.com/&amp;client_secret=',variables('clienttoken'))</span></pre><ul class=""><li id="bb38" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">将计分令牌保存在变量中</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="7c30" class="kj if hh kf b fi kk kl l km kn">@activity('scoring_token').output.access_token</span></pre><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lk"><img src="../Images/c1c98ed437915596a5b64a0804f35da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DcTafHkxixbUwyEB.jpg"/></div></div></figure><ul class=""><li id="32fc" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在检索数据集id</li><li id="ab62" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">对于URL</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="b372" class="kj if hh kf b fi kk kl l km kn">https://centralus.experiments.azureml.net/dataset/v1.0/subscriptions/&lt;subid&gt;/resourceGroups/&lt;rgname&gt;/providers/Microsoft.MachineLearningServices/workspaces/&lt;workspacename&gt;/saveddatasets/from-data-path</span></pre><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ll"><img src="../Images/ce22f1861e7f5cfa35b82e6416cdaced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X3PoyMO7fufswjeP.jpg"/></div></div></figure><ul class=""><li id="10fb" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">添加授权标题</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="9e06" class="kj if hh kf b fi kk kl l km kn">@concat('Bearer ',variables('tokenml'))</span></pre><ul class=""><li id="2cf7" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">身体</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="aac6" class="kj if hh kf b fi kk kl l km kn">{"DatastoreName":"taxibatch2files","RelativePath":"/example-data/taxibatch.csv"}</span></pre><ul class=""><li id="dc25" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在调用批处理端点</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lm"><img src="../Images/cc4424f116ff43104e7f4b3c4df045a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FJRhtmyYxnWKSo8v.jpg"/></div></div></figure><ul class=""><li id="4b93" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">现在使用Azure ML服务中的批处理端点</li><li id="24ab" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在Azure ML中，转到端点-&gt;批处理端点-&gt;选择批处理端点-&gt;单击详细信息</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="a385" class="kj if hh kf b fi kk kl l km kn"><a class="ae jz" href="https://endpointname.centralus.inference.ml.azure.com/jobs" rel="noopener ugc nofollow" target="_blank">https://endpointname.centralus.inference.ml.azure.com/jobs</a></span></pre><ul class=""><li id="feef" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">为授权和内容类型设置标题</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2c6e" class="kj if hh kf b fi kk kl l km kn">Authorization: @concat('Bearer ',variables('tokenml'))</span><span id="777d" class="kj if hh kf b fi lj kl l km kn">Content-Type: application/json</span></pre><ul class=""><li id="ac66" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">对于身体变化到</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="72a3" class="kj if hh kf b fi kk kl l km kn">{<br/>  "properties": {<br/>    "dataset": {<br/>      "dataInputType": "DatasetVersion",<br/>      "datasetName": "taxibatch2files",<br/>      "datasetVersion": "1"<br/>    }<br/>  }<br/>}</span></pre><ul class=""><li id="c0a3" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">提交更改</li><li id="bd0a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">单击调试</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ko"><img src="../Images/20fffd9071795a355b3eff8876243d63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rhKUyuGnzYitM47h.jpg"/></div></div></figure><ul class=""><li id="0e10" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">等待流程完成</li></ul><figure class="ka kb kc kd fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ln"><img src="../Images/a761d1d303bfb2a64e79fd5b1f76ca8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OOoTODg22XzKOO4-.jpg"/></div></div></figure><ul class=""><li id="889a" class="jc jd hh je b jf kx jh ky jj kz jl la jn lb jp jq jr js jt bi translated">完成的</li></ul><p id="c798" class="pw-post-body-paragraph lo lp hh je b jf kx lq lr jh ky ls lt jj lu lv lw jl lx ly lz jn ma mb mc jp ha bi translated"><em class="md">最初发表于</em><a class="ae jz" href="https://github.com/balakreshnan/Samples2022/blob/main/SynapseIntegrate/batchendpointhttp.md" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="md">。</em></p></div></div>    
</body>
</html>