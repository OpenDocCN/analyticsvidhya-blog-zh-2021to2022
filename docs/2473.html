<html>
<head>
<title>Training a spaCy NER Pipeline with Prodigy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用神童训练空间NER管道</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/training-a-spacy-ner-pipeline-with-prodigy-ca58350cb868?source=collection_archive---------5-----------------------#2021-04-26">https://medium.com/analytics-vidhya/training-a-spacy-ner-pipeline-with-prodigy-ca58350cb868?source=collection_archive---------5-----------------------#2021-04-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7fe0d00fc0313fe64ed2358f151ac64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cLSmoec7lW4PKnRW"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">布鲁诺·马丁斯在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="91d3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">自定义命名实体识别(NER)模型的成功取决于传递给它的数据的质量。然而，为模型提供足够的训练数据示例通常是一个耗时且费力的过程。使用Prodigy，为构建空间模型的自定义NER管道而标记数据的任务变得更快更简单。</p><p id="8b06" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">据官方<a class="ae it" href="https://prodi.gy/docs" rel="noopener ugc nofollow" target="_blank">神童网站</a>:</p><blockquote class="js jt ju"><p id="e560" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr ha bi translated">Prodigy是一款现代注释工具，用于为机器学习模型创建训练和评估数据。您还可以使用Prodigy来帮助您检查和清理数据，进行错误分析，并开发基于规则的系统来与您的统计模型结合使用。</p></blockquote><p id="c5da" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Prodigy可以轻松标记您的数据，以便在模型训练中使用。对于这个概述，我们将使用一个数据集，其中包含从19世纪40年代开始的海鲜菜单项。我们将介绍如何使用全新的实体标签向空白空间模型添加定制的NER管道，包括:</p><p id="32a4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">海鲜</strong>:与海鲜相关的菜肴，如大比目鱼、鳕鱼或蛤蜊杂烩。</p><p id="69d7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">面</strong>:不是海鲜的菜，帮助我们理解人们通常如何搭配他们选择的海鲜。</p><p id="bca9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">方法</strong>:一道菜的准备方式，如烤、烘或烤。</p><p id="d4a2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">位置</strong>:海鲜的来源，帮助我们确定采购模式。</p><p id="4053" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为我们正在训练一个全新的NER管道，我们必须手工注释几百个例子。我们可以使用<code class="du jz ka kb kc b">ner.manual</code>菜谱<em class="jv">(菜谱是指各种可用的方法)</em>来做到这一点。</p><figure class="kd ke kf kg fd ii"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">初始标记的终端命令</figcaption></figure><figure class="kd ke kf kg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kj"><img src="../Images/e51a71cd9dab04840c6b2f82c68f2cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PAOFUB4oEH7dZzkTgKZKLA.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">在Prodigy中手动标记实体</figcaption></figure><p id="d059" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在<code class="du jz ka kb kc b">ner.manual</code>命令中几乎没有要解包的项目。该命令和后续命令都是通过命令行运行的。</p><ul class=""><li id="94e2" class="kk kl hh iw b ix iy jb jc jf km jj kn jn ko jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">prodigy</code>:激活在终端中使用的工具。</li><li id="bccb" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">ner.manual</code>:我们要用的配方。</li><li id="88d4" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_ents</code>:我们要保存注释的数据集的名称(第一次运行时为空)。这也被称为黄金集，可以被视为主要或基本事实注释集。</li><li id="f2a6" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">blank:en</code>:用作基线模型的空间模型。在这种情况下，我们将使用空白模型进行标记化。</li><li id="4ad1" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">data/translated_items.txt</code>:用于批注的文档。</li><li id="a29f" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">--label SEAFOOD,SIDE,METHOD,LOCATION</code>:标签标志启动所需标签的标注过程。</li></ul><p id="a2f3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦我们有了几百个工作实例，我们就可以进行一个初始的训练周期，并定义一个新的模型。这一过程有助于我们未来的标记任务，因为在训练之后，我们的模型将帮助我们注释新的示例。</p><figure class="kd ke kf kg fd ii"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">初始模型训练的终端命令</figcaption></figure><ul class=""><li id="1e78" class="kk kl hh iw b ix iy jb jc jf km jj kn jn ko jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">train</code>:我们要用的配方。</li><li id="d747" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">ner</code>:我们要训练的管道组件。</li><li id="6556" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_ents</code>:在<code class="du jz ka kb kc b">ner.manual</code>后创建的黄金套注解。</li><li id="c83a" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">blank:en</code>:标记化的相同基线模型。请注意，如果您想要添加或改进当前空间模型，也可以使用预训练模型。</li><li id="9920" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">--output seafood_model</code>:输出标志将模型保存在当前目录下。在这种情况下，我们将保存一个名为<code class="du jz ka kb kc b">seafood_model</code>的新模型。</li></ul><p id="d2d6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">训练并保存初始模型后，我们可以使用<code class="du jz ka kb kc b">ner.teach </code>命令加快贴标过程。<code class="du jz ka kb kc b">ner.teach</code>的好处是标记过程变得二元，意味着我们只需要确认或否认模型的标记预测。</p><figure class="kd ke kf kg fd ii"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">为单个标签执行辅助注释的脚本</figcaption></figure><figure class="kd ke kf kg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ky"><img src="../Images/01606e7e75de472c18d38b58bcede288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*iA96IXHyn1mnY6Y3h7uypQ.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">在新模型的帮助下进行二进制标记</figcaption></figure><ul class=""><li id="f3b8" class="kk kl hh iw b ix iy jb jc jf km jj kn jn ko jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">ner.teach</code>:我们要用于二进制注释的配方(是或否)。</li><li id="d59c" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_ents_binary</code>:二进制标注的新数据集。</li><li id="3950" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_model</code>:使用<code class="du jz ka kb kc b">prodigy train</code>训练的新模型。</li><li id="2da4" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">data/translated_items.txt</code>:用于标注更多标签的文档。</li><li id="affb" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">--label SEAFOOD</code>:我们要标注的标签。在这一步中，您可以创建多个标签，但是，一次创建一个标签比一次创建多个标签更有效。这意味着您应该为每个标签运行这个脚本，以最大限度地减少人为错误。</li></ul><p id="d2c0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在重新训练我们的模型之前，我们必须将二进制数据集转换为黄金数据集。Prodigy有两种类型的数据集，白银和黄金。银色数据集类型指的是二进制标签集，而金色数据集指的是完整的基础数据集。让我们使用<code class="du jz ka kb kc b">ner.silver-to-gold</code>将我们创建的银数据集与我们在手动标记过程中创建的金数据集合并。</p><figure class="kd ke kf kg fd ii"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">将白银数据转换为黄金数据的脚本</figcaption></figure><figure class="kd ke kf kg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kz"><img src="../Images/f5116d4a0883db52b072d64817fb6a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RmFbsgHL14_2sR7OyZdd7w.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">确认和修复模型预测</figcaption></figure><ul class=""><li id="1eee" class="kk kl hh iw b ix iy jb jc jf km jj kn jn ko jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">ner.silver-to-gold</code>:我们想要用来合并白银和黄金数据的配方。</li><li id="9150" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_ents</code>:用<code class="du jz ka kb kc b">ner.manual</code>创建的黄金数据集。</li><li id="7083" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_ents_binary</code>:使用<code class="du jz ka kb kc b">ner.teach</code>进行二进制标记时产生的银色数据集。</li><li id="a76a" class="kk kl hh iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated"><code class="du jz ka kb kc b">seafood_model</code>:用<code class="du jz ka kb kc b">prodigy train</code>训练的初始定制模型。</li></ul><p id="bc2f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用<code class="du jz ka kb kc b">ner.silver-to-gold</code>，Prodigy界面与<code class="du jz ka kb kc b">ner.manual</code>步骤相同。此步骤将手动标注与自动标注相结合，以确认和修复模型的预测。</p><p id="f5a6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们现在可以用黄金组重新训练我们的模型，以改进我们的结果并进一步简化标记。</p><figure class="kd ke kf kg fd ii"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">使用更多注释进行再培训</figcaption></figure><p id="dadd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">再培训脚本与之前的参考<code class="du jz ka kb kc b">prodigy train</code>脚本几乎相同。不同之处在于，我们将使用在第一次训练迭代中创建的<code class="du jz ka kb kc b">seafood_model</code>，而不是引用<code class="du jz ka kb kc b">blank:en</code>。</p><p id="2091" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">训练定制管道的过程是迭代的，并且永远不会完成。在整个过程中，我们可以观察到，随着为摄取准备更多的训练数据，模型变得更加准确。</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><p id="c0c2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">模型结果</strong></p><p id="5807" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是一个自定义NER组件如何执行的示例，大约有1，800个带标签的示例。经过10次训练迭代后，模型的F值为77.329。</p><figure class="kd ke kf kg fd ii"><div class="bz dy l di"><div class="kh ki l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">单个标签结果</figcaption></figure><p id="ffe9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">简要说明</strong>:F分数，也称为F1分数，是模型对数据集预测能力的一种度量。它评估二进制分类系统，将例子分为“正面”或“负面”这个指标类似于准确度，或者正确标记的例子与错误标记的例子。F分数对等级不平衡更加稳健，这超出了本概述的范围。(来源:<a class="ae it" href="https://deepai.org/machine-learning-glossary-and-terms/f-score" rel="noopener ugc nofollow" target="_blank"> DeepAI </a>)</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><p id="d168" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">非常感谢您阅读这篇关于在您的自然语言处理项目中使用Prodigy的概述。Prodigy文档<a class="ae it" href="https://prodi.gy/docs" rel="noopener ugc nofollow" target="_blank">为您的模型提供了其他用例，我希望提供各种可用方法的额外概述。</a></p></div></div>    
</body>
</html>