<html>
<head>
<title>Make a translate app with HuggingFace Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用拥抱脸变形金刚做个翻译应用</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/make-a-translate-app-with-huggingface-transformers-ce9203f84c79?source=collection_archive---------0-----------------------#2021-11-11">https://medium.com/analytics-vidhya/make-a-translate-app-with-huggingface-transformers-ce9203f84c79?source=collection_archive---------0-----------------------#2021-11-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3130cfae2cc82b1b9d762b968b4665de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLjiiOFJFmai50NS-SGBVQ.png"/></div></div></figure><h1 id="fa6b" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="be0a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们依靠谷歌翻译服务来帮助我们将文本从一种语言翻译成另一种语言，我一直想开发一个这样的应用程序，并知道翻译如何在后端工作。</p><p id="9c77" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们列出翻译应用程序中将包含的组件。</p><p id="318f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这些是那些组件-</p><ol class=""><li id="02bb" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">多语言翻译模型。</li><li id="5946" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">接受所有必要参数的API服务将这些参数发送给模型，并将翻译后的文本作为响应返回。</li><li id="48b7" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">一个前端应用程序，为用户提供一个图形用户界面进行交互。</li></ol><p id="5fb0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">理想的流程应该是用户在输入文本中键入文本，选择所需的目标语言，然后单击翻译按钮。单击按钮后，我们获取请求数据并将其发送给API服务，API服务最终将数据传递给模型，并将结果作为响应返回。然后，响应会显示在UI中。</p><h1 id="fba4" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">巨大的挑战</h1><p id="83cd" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">ML模型将成为我们翻译应用背后的大脑。为了从头开始训练一个最先进的模型，我们需要以下东西-</p><ol class=""><li id="6ad2" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">包含一种语言的文本及其在另一种语言中的翻译的大量训练数据。</li><li id="954c" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">创建一个包含超过一百万个参数的神经网络模型。</li><li id="51d4" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">基于高端多GPU环境来训练该模型。</li><li id="bbe5" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">时间。</li></ol><p id="8668" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">但我在这里的目标是开发一个MVP或小型POC，它可以帮助我理解和演示制作翻译应用程序的过程，并能够在一个周末内完成。</p><h1 id="1099" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">拥抱拯救之脸</h1><p id="7ddd" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">解决方案是，我们可以使用一个预训练模型，该模型针对翻译任务进行训练，并且可以支持多种语言。</p><p id="d4d0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae lf" href="https://huggingface.co" rel="noopener ugc nofollow" target="_blank"> <em class="lg"> HuggingFace </em> </a>由各种变形金刚/预先训练好的模型组成。其中一个翻译模型是脸书AI研究团队在2020年提出的MBart——<a class="ae lf" href="https://arxiv.org/abs/2001.08210" rel="noopener ugc nofollow" target="_blank"><em class="lg">神经机器翻译的多语种去噪预训练</em> </a> <em class="lg">。</em></p><p id="f0d0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><em class="lg">太好了！！</em>现在我们已经有了一个预先训练好的模型。是时候把拼图放到正确的地方了。</p><h1 id="bcc0" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">后端</h1><p id="3445" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们来看一下后端代码。</p><p id="c3e9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我定义了一个Translator类，它包含一个助手函数来执行翻译任务。</p><p id="e2b9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在初始化时，MBart预训练模型和标记化器对象被初始化。translate方法将输入文本、源语言和目标语言作为参数。</p><figure class="lh li lj lk fd ij"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">翻译者. py</figcaption></figure><p id="3b8a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我使用了flask，这是一个用于创建API端点的python库。在运行时，它实例化Translator类，并使用run_translation函数生成文本翻译。我还使用了flasgger，它是Swagger的flask包装器，用于测试API端点。</p><figure class="lh li lj lk fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h1 id="10b3" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">经营隧道服务</h1><p id="e8a8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">API服务可以部署到Heroku或AWS EC2实例，以使端点可以通过web访问。另一种选择是我们可以在本地运行服务，并使用名为<a class="ae lf" href="https://ngrok.com" rel="noopener ugc nofollow" target="_blank"> <em class="lg"> ngrok </em> </a>的隧道服务。因此，前端会将所有请求发送到该隧道，该隧道的唯一工作是将所有请求路由到我们的系统。这可以通过暴露一个特定的端口来实现，在我们的例子中，这个端口是flask服务的默认端口号5000。</p><p id="12f3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，我们需要在ngrok网站注册为用户，并获得auth key。然后，下载二进制文件并运行以下命令。</p><pre class="lh li lj lk fd lr ls lt lu aw lv bi"><span id="6582" class="lw ir hi ls b fi lx ly l lz ma">ngrok auth &lt;YOUR_AUTH_KEY&gt;</span></pre><p id="c534" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这将为ngrok服务身份验证创建一个配置，并且只需执行一次。接下来，我们运行另一个命令。</p><pre class="lh li lj lk fd lr ls lt lu aw lv bi"><span id="868a" class="lw ir hi ls b fi lx ly l lz ma">ngrok http &lt;PORT_NUMBER&gt;</span></pre><p id="78dc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这将创建一个可以路由所有请求隧道，如前所述。</p><h1 id="ea5a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">前端</h1><p id="2105" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果你知道html，css，js或者如果你知道Angular或者React，你可以写一个代码来创建一个包含以下组件的表单。</p><ol class=""><li id="fdcc" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">输入文本框</li><li id="7786" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">下拉菜单选择源语言</li><li id="3d17" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">下拉菜单选择目标语言</li><li id="9a10" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">显示响应的文本标签</li><li id="7dd5" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">清除并提交按钮</li></ol><p id="5434" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">单击submit，您可以通过API调用将它绑定到端点url，并获得翻译后的文本作为响应。</p><p id="805f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我用了<a class="ae lf" href="https://www.appsmith.com" rel="noopener ugc nofollow" target="_blank">T5】app SmithT7】来开发前端。它是一个低代码/无代码平台，用于设计前端web应用程序。此外，它还内置了将数据保存到数据库中的支持，并使用自定义API来与前端集成。</a></p><p id="f9bd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦你在AppSmith中创建了一个应用程序，你就会得到一个画布，在这里你可以从小部件中拖放不同的元素，添加一个新的页面并连接到一个数据源。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/df09f25b57de7304ce6ab2eb68df4cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPlbCLaUs-8x3H4ZTP8i5w.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">AppSmith画布</figcaption></figure><p id="3202" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将API配置到AppSmith。转到datasource部分并添加一个API，下面的postman窗口将会出现。添加您的API端点url，并将请求方法类型称为POST。在正文中，我从表单中的HTML小部件获取输入文本、源语言和目标语言。这是通过使用<a class="ae lf" href="https://mustache.github.io" rel="noopener ugc nofollow" target="_blank"> <em class="lg">小胡子模板</em> </a>完成的。(参考下面截图)</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/5b2158cdf2d946144853727a7470e9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kpj6DDVBiOBEZZvoJPn7kg.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">AppSmith API</figcaption></figure><p id="2231" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，最后一步是用提交按钮上的onClick方法绑定这个API。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/f173d993c1dc30885cccd3e506a965d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzbsuHZCzPfOZPBY4IMxFg.png"/></div></div></figure><p id="3df8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">再添加一个文本标签来显示结果。一旦API调用成功，绑定到该标签的响应将自动在此显示翻译后的文本。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/a26d41ba13ad5b66d648965ec3db90cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iyVo7_tt9vlvLEcm83Ln4Q.png"/></div></div></figure><p id="6894" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦一切就绪，点击顶部的部署按钮，应用程序就可以使用了。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/428e0172b1d9b19a97fb18da2d08aef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1c-W4c9B7_EQzfOWWRLKKg.gif"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">翻译演示</figcaption></figure><h1 id="a6ee" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="1a16" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">这就完成了我们翻译应用程序的开发。如果您对重用这些代码感兴趣。你可以在我的Github <a class="ae lf" href="https://github.com/iamrajatroy/IN-translate-app" rel="noopener ugc nofollow" target="_blank"> <em class="lg">这里</em> </a>找到这个。</p><p id="e2f1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">感谢你阅读这篇博客。</p></div></div>    
</body>
</html>