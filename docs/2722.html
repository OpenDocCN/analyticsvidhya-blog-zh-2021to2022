<html>
<head>
<title>Installing Harbor using VM Operator on vSphere</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在vSphere上使用VM Operator安装Harbor</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/installing-harbor-using-vm-operator-on-vsphere-7bf69036f67c?source=collection_archive---------19-----------------------#2021-05-14">https://medium.com/analytics-vidhya/installing-harbor-using-vm-operator-on-vsphere-7bf69036f67c?source=collection_archive---------19-----------------------#2021-05-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/efc43db43a4e08dd775ed969846e5c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CeXW9voEl9rhCAOYiYn_5Q.png"/></div></div></figure><h1 id="e5bf" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="57a1" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">vSphere with Tanzu的最新更新(v 7.0u2a)引入了一些使用Kubernetes管理虚拟机生命周期的激动人心的功能。这为现有工作负载的现代化创造了大量机会。作者在关于同一技术的另一篇文章中已经介绍了其中的一些模式。今天，我们将深入另一个使用VM操作符将容器注册中心部署为VM的例子。<a class="ae kl" href="https://goharbor.io/" rel="noopener ugc nofollow" target="_blank">港</a>是这里的必然选择，因为它是VMware提供的Tanzu的一部分，也是CNCF最强大的集装箱注册中心之一。<br/>我们不会深入讨论如何消费VM操作符的细节，在其他各种博客中已经详细讨论过了。我们将直接研究如何为DevOps角色生成所需的清单，以便在vSphere环境中交付和使用稳定的注册表。</p><h2 id="f9c5" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">要求</h2><p id="78cb" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">这里的要求是部署一个企业级高可用性Harbor registry，启用TLS，并为其数据存储分配额外的磁盘存储。基本映像是CentOS Stream 8 OS。</p><h1 id="21b5" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">方法</h1><p id="d844" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">有两个感兴趣的清单文件。第一个是在虚拟机部署的云初始化阶段需要的云初始化YAML文件。第二个文件是实际的虚拟机部署YAML文件，它使用上述云初始化YAML文件，并在vSphere上使用虚拟机操作员技术部署虚拟机。这个博客的所有相关文件都可以在<a class="ae kl" href="https://github.com/papivot/Harbor-using-VMOperator-" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><h2 id="cdd8" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated"><strong class="ak"> cloud-init.yaml </strong></h2><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="114d" class="km iq hh lm b fi lq lr l ls lt">#cloud-config</span><span id="6cf8" class="km iq hh lm b fi lu lr l ls lt">########## SECTION 1 #########<br/>chpasswd:<br/>    list: |<br/>      centos:VMware1!<br/>    expire: false<br/>groups:<br/>  - docker<br/>users:<br/>  - default<br/>  - name: centos<br/>    ssh-authorized-keys:<br/>      - ssh-rsa AAAAB3....Tbfqzc8BRA3Z0YiLo+I/LIc0= nverma@bastion0<br/>    sudo: ALL=(ALL) NOPASSWD:ALL<br/>    groups: sudo, docker<br/>    shell: /bin/bash</span><span id="7d6e" class="km iq hh lm b fi lu lr l ls lt">########## SECTION 2 #########<br/>network:<br/>  version: 2<br/>  ethernets:<br/>      ens192:<br/>          dhcp4: true<br/>mounts:<br/>  - [ /dev/sdb1, /data, "xfs", "defaults", "0", "2" ]</span><span id="e94d" class="km iq hh lm b fi lu lr l ls lt">########## SECTION 3 #########<br/>package_update: true<br/>yum_repos:<br/>  docker-ce-stable:<br/>    name: Docker CE Stable - $basearch<br/>    baseurl: <a class="ae kl" href="https://download.docker.com/linux/centos/$releasever/$basearch/stable" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/centos/$releasever/$basearch/stable</a><br/>    enabled: true<br/>    gpgcheck: true<br/>    gpgkey: <a class="ae kl" href="https://download.docker.com/linux/centos/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/centos/gpg</a><br/>packages:<br/>  - docker-ce<br/>  - docker-ce-cli<br/>  - containerd.io<br/>  - net-tools<br/>  - wget</span><span id="6f63" class="km iq hh lm b fi lu lr l ls lt">########## SECTION 4 #########<br/>write_files:</span><span id="0e22" class="km iq hh lm b fi lu lr l ls lt">  - path: /harbor/tls.pem<br/>    content: |<br/>      -----BEGIN CERTIFICATE-----<br/>      MIIFNTCCBB2gAwIBAgISBOwj5VrGCSqGSIb3DQEBCwUA<br/>      EwJSMzAeFw0yMTA0MjcwMTE0MzlaFw0E0MzlaMBQxEjA<br/>      CW5hdmxhYi5pbzCCASIwDQYJKoZIhvEPADCCAQoCggEB<br/>      rkRX0/k03UNmjXfpWAlxrV4ZkdjLfNeX4fr5jOOJ+wHo<br/>      ...     <br/>      -----END CERTIFICATE-----<br/>    owner: 'root:root'<br/>    permissions: '0444'</span><span id="0b0e" class="km iq hh lm b fi lu lr l ls lt">  - path: /harbor/tls.key<br/>    content: |<br/>      -----BEGIN PRIVATE KEY-----<br/>      MIIEwAIBADANBgkqhkiG9w0BAQEFAASCQDgzn3P265EV<br/>      NN1DZo136VgJca1eGZHYy3zXl+H6+fc2sB6FQChXgAes<br/>      kqY3X5Bmpub3VCbxh+Zy+169BhARt4i4Lz2jqlfQ2ZxZ<br/>      ...<br/>      -----END PRIVATE KEY-----<br/>    owner: 'root:root'<br/>    permissions: '0444'</span><span id="60b5" class="km iq hh lm b fi lu lr l ls lt">  - path: /harbor/install-harbor.sh<br/>    content: |<br/>      #!/bin/bash<br/>      cd /harbor<br/>      /harbor/install.sh --with-trivy --with-notary<br/>      if [ $? -ne 0 ]<br/>      then<br/>        echo "Failed. Trying again"<br/>        /harbor/install.sh --with-trivy --with-notary<br/>      fi<br/>    owner: 'root:root'<br/>    permissions: '0755'</span><span id="b91d" class="km iq hh lm b fi lu lr l ls lt">  - path: /harbor/harbor.yml<br/>    content: |<br/>      hostname: harbor-centos.navlab.io<br/>      #http:<br/>      #  port: 80<br/>      https:<br/>        port: 443<br/>        certificate: /harbor/tls.pem<br/>        private_key: /harbor/tls.key<br/>      # external_url: <a class="ae kl" href="https://reg.mydomain.com:8433" rel="noopener ugc nofollow" target="_blank">https://reg.mydomain.com:8433</a><br/>      harbor_admin_password: VMware1!<br/>      database:<br/>        password: root123<br/>        max_idle_conns: 50<br/>        max_open_conns: 1000<br/>      data_volume: /data<br/>      trivy:<br/>        ignore_unfixed: false<br/>        skip_update: false<br/>        insecure: false<br/>      jobservice:<br/>        max_job_workers: 10<br/>      notification:<br/>        webhook_job_max_retry: 10<br/>      chart:<br/>        absolute_url: disabled<br/>      log:<br/>        level: info<br/>        local:<br/>          rotate_count: 50<br/>          rotate_size: 200M<br/>          location: /var/log/harbor<br/>      _version: 2.2.0<br/>      proxy:<br/>        http_proxy:<br/>        https_proxy:<br/>        no_proxy:<br/>        components:<br/>          - core<br/>          - jobservice<br/>          - trivy<br/>    owner: root:root<br/>    permissions: '0644'</span><span id="6a42" class="km iq hh lm b fi lu lr l ls lt">########## SECTION 5 #########<br/>runcmd:<br/>  - parted /dev/sdb mklabel gpt<br/>  - parted /dev/sdb mkpart primary xfs 1MB 10240MB<br/>  - /sbin/mkfs.xfs /dev/sdb1<br/>  - mkdir -p /data<br/>  - mount -t xfs --rw /dev/sdb1 /data<br/>  - curl -L "<a class="ae kl" href="https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname" rel="noopener ugc nofollow" target="_blank">https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname</a> -s)-$(uname -m)" -o /usr/local/bin/docker-compose<br/>  - chmod +x /usr/local/bin/docker-compose<br/>  - ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose<br/>  - systemctl enable docker<br/>  - systemctl start docker<br/>  - wget -q <a class="ae kl" href="https://github.com/goharbor/harbor/releases/download/v2.2.1/harbor-offline-installer-v2.2.1.tgz" rel="noopener ugc nofollow" target="_blank">https://github.com/goharbor/harbor/releases/download/v2.2.1/harbor-offline-installer-v2.2.1.tgz</a><br/>  - tar --skip-old-files -xzvf harbor-offline-installer-v2.2.1.tgz<br/>  - rm -f harbor-offline-installer-v2.2.1.tgz<br/>  - /harbor/install-harbor.sh</span></pre><p id="d2af" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">让我们看看YAML档案中的一些附加注释的部分。用户可以也必须根据他们的需求修改部分。</p><h2 id="db1f" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">第1部分—用户配置</h2><p id="51da" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">用户可以根据需要修改该部分。登录(通过SSH)虚拟机的实际要求只是为了故障排除。出于安全原因，用户可以根据环境要求自定义添加/删除该密钥和相关密钥。由于Harbor需要Docker作为一个组件来执行，因此为了进行故障排除而登录的用户应该成为Docker组的成员，以便进行无缝故障排除。</p><h2 id="40ff" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">第2部分—系统配置(网络和磁盘)</h2><p id="c22d" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">用户可以使用此部分来提供网络和存储配置。网络配置非常简单。作者试图使用cloud-init特性来配置存储，但是由于一些基础映像打包问题，配置无法工作。因此，作者采取了变通办法。目前，本节中的挂载操作更新了<code class="du ma mb mc lm b">/etc/fstab</code>文件，而没有实际挂载文件系统(到<code class="du ma mb mc lm b">/data</code>)，这是当前在最后一节中执行的。</p><h2 id="8b92" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">第3节—软件包安装</h2><p id="37d3" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">Harbor要求安装Docker，contained及其预先要求的软件包。本节为cloud-init设置相关的稳定Docker CE yum存储库，以下载和安装适当的包。Net工具是可选的(故障排除需要)。</p><h2 id="bfe3" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">第4节—生成配置文件</h2><p id="4cc6" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">创建了四个文件供在云初始化阶段使用。</p><ul class=""><li id="bfa5" class="md me hh jp b jq lv ju lw jy mf kc mg kg mh kk mi mj mk ml bi translated"><strong class="jp hi"> /harbor/tls.pem </strong>和<strong class="jp hi"> /harbor/tls.key </strong>是启用SSL和暴露443端口上的应用程序所需的证书文件和私钥文件。在本例中，SSL证书中的DNS记录指向主机名<code class="du ma mb mc lm b">harbor-centos.navlab.io</code>(稍后将在/harbor/harbor.yml文件中引用)</li></ul><p id="ab75" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">(见以下节选自<a class="ae kl" href="https://goharbor.io/docs/2.2.0/install-config/configure-https/" rel="noopener ugc nofollow" target="_blank">港湾网站</a>)</p><blockquote class="mm mn mo"><p id="f322" class="jn jo mp jp b jq lv js jt ju lw jw jx mq lx ka kb mr ly ke kf ms lz ki kj kk ha bi translated">在生产环境中，请始终使用HTTPS。如果您启用公证内容信任来正确签署所有图像，您必须使用HTTPS。要配置HTTPS，您必须创建SSL证书。您可以使用由受信任的第三方CA签名的证书，也可以使用自签名证书。本节描述如何使用<a class="ae kl" href="https://www.openssl.org/" rel="noopener ugc nofollow" target="_blank"> OpenSSL </a>来创建CA，以及如何使用您的CA来签署服务器证书和客户端证书。您可以使用其他CA提供商，例如<a class="ae kl" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>。下面的过程假设您的Harbor registry的主机名是<code class="du ma mb mc lm b">yourdomain.com</code>，并且它的DNS记录指向您运行Harbor的主机。</p></blockquote><ul class=""><li id="bb04" class="md me hh jp b jq lv ju lw jy mf kc mg kg mh kk mi mj mk ml bi translated"><strong class="jp hi"> /harbor/harbor.yaml </strong>这是安装脚本用来安装harbor的实际配置文件。用户可以在这里找到详情<a class="ae kl" href="https://goharbor.io/docs/2.2.0/install-config/configure-yml-file/" rel="noopener ugc nofollow" target="_blank">。注意，它引用了上面创建的SSL证书文件。我们需要再次强调主机名值指向SSL证书中的DNS记录。我们还将管理员密码设置为非默认值。另一个需要注意的事项是,<code class="du ma mb mc lm b">data_volume</code>值指向专门为此目的创建的新文件系统。</a></li><li id="696f" class="md me hh jp b jq mt ju mu jy mv kc mw kg mx kk mi mj mk ml bi translated"><strong class="jp hi">/harbor/install-Harbor . sh</strong>这是使用上述harbor.yaml文件并在启用Trivy和公证人的情况下在该虚拟机上安装Harbor的安装脚本。</li></ul><h2 id="4c51" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">第5部分—将所有内容放在一起。</h2><p id="7b05" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">这部分是奇迹发生的地方。用户可以使用前五个命令添加额外的存储，并将其挂载到/data挂载点。这是Harbor存储所有数据的地方。(请注意，如果cloud-init磁盘创建问题得到解决，这些可能会被删除)</p><p id="e4db" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">以下五个命令用于下载docker-compose的最新版本，使用正确的权限安装它并启动docker守护进程。</p><p id="18ef" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">最后，我们下载最新的Harbor二进制文件，将它们解压到我们在第4节中创建所有文件的确切位置。接下来调用安装脚本来执行安装。</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><h2 id="04dd" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">vm.yaml</h2><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ff8c" class="km iq hh lm b fi lq lr l ls lt">---<br/>apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: harbor-pvc<br/>  namespace: demo1<br/>spec:<br/>  accessModes:<br/>  - ReadWriteOnce<br/>  resources:<br/>    requests:<br/>      storage: 10Gi<br/>  storageClassName: nav-gold-policy<br/>  volumeMode: Filesystem<br/>---<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>    name: centos-cloudinit<br/>    namespace: demo1<br/>data:<br/>  user-data: I2Nsb3VkL...5zdGFsbC1oYXJib3Iuc2gK<br/>  hostname: harbor-centos<br/>---<br/>apiVersion: vmoperator.vmware.com/v1alpha1<br/>kind: VirtualMachine<br/>metadata:<br/>  labels:<br/>    vm-selector: harbor-centosvm<br/>  name: harbor-centosvm<br/>  namespace: demo1<br/>spec:<br/>  imageName: centos-stream-8-vmservice-v1alpha1-1619529007339<br/>  className: best-effort-small<br/>  powerState: poweredOn<br/>  storageClass: nav-gold-policy<br/>  networkInterfaces:<br/>  - networkType: nsx-t<br/>    networkName: ""<br/>  volumes:<br/>  - name: my-centos-vol<br/>    persistentVolumeClaim:<br/>      claimName: harbor-pvc<br/>  readinessProbe:<br/>    tcpSocket:<br/>      port: 22<br/>  vmMetadata:<br/>    configMapName: centos-cloudinit<br/>    transport: OvfEnv<br/>---<br/>apiVersion: vmoperator.vmware.com/v1alpha1<br/>kind: VirtualMachineService<br/>metadata:<br/>  name: harbor-vmservices<br/>spec:<br/>  ports:<br/>  - name: ssh<br/>    port: 22<br/>    protocol: TCP<br/>    targetPort: 22<br/>  - name: harbor<br/>    port: 443<br/>    protocol: TCP<br/>    targetPort: 443<br/>  - name: notary<br/>    port: 4443<br/>    protocol: TCP<br/>    targetPort: 4443<br/>  selector:<br/>    vm-selector: harbor-centosvm<br/>  type: LoadBalancer</span></pre><p id="1f5e" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">该文件将在demo1名称空间中的Supervisor集群上下文中部署一个VM。用户可以根据自己的需求修改名称空间。我们将讨论这里创建的相关对象。</p><h2 id="7329" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">PersistantVolumeClaim</h2><p id="ff9d" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">YAML用于从存储类请求一个10GB的PVC，该PVC已可供vSPhere with Tanzu中的Supervisor集群使用。</p><h2 id="071a" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated"><strong class="ak">配置图</strong></h2><p id="5f03" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">用户需要从我们之前讨论过的cloud-init.yaml文件创建一个<code class="du ma mb mc lm b">configmap</code>。<code class="du ma mb mc lm b">user-data</code>是cloud-init.yaml文件的base64编码值。用户可以通过执行以下命令<code class="du ma mb mc lm b">cat cloud-init.yaml|base64 -w0;echo</code>来生成数据。将base64编码值复制并粘贴到vm.yaml文件中。vSphere <code class="du ma mb mc lm b">hostname</code>也是通过<code class="du ma mb mc lm b">configmap</code>配置的。</p><h2 id="f5b3" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">虚拟机器</h2><p id="1ba8" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">用户可以使用相关的VMclass为Harbor VM提供所需的计算能力。如果这个虚拟机的<code class="du ma mb mc lm b">networkType</code>是基于<code class="du ma mb mc lm b">nst-t</code>的WCP环境，那么<code class="du ma mb mc lm b">networkName</code>需要留空。如果<code class="du ma mb mc lm b">networkType</code>是<code class="du ma mb mc lm b">vsphere-distributed</code>，那么需要在<code class="du ma mb mc lm b">networkInterfaces</code>部分填充相关的工作量<code class="du ma mb mc lm b">networkName</code>。</p><p id="01b4" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">请注意，之前请求的PVC是作为卷安装到此虚拟机的。这将为虚拟机预设一个原始磁盘，然后通过云初始化过程对其进行格式化、分区和挂载。</p><h2 id="d887" class="km iq hh bd ir kn ko kp iv kq kr ks iz jy kt ku jd kc kv kw jh kg kx ky jl kz bi translated">虚拟中国服务</h2><p id="ef38" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">最后，用户通过服务类型<code class="du ma mb mc lm b">loadbalancer</code>公开Harbor应用程序端口443、4443(公证)和22(故障排除目的)</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><p id="29c0" class="pw-post-body-paragraph jn jo hh jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ha bi translated">准备好这些文件后，用户可以使用<code class="du ma mb mc lm b">kubectl</code>或CICD进程在管理集群上下文中部署<em class="mp"> vm.yaml </em>文件。这将部署一个功能齐全的Harbor虚拟机。由于在云初始化阶段完成了大量工作，虚拟机完全运行可能需要4-5分钟。用户可以为新创建的VirtualMachineService获取负载平衡器<em class="mp">外部IP </em>地址。一旦修改了DNS，将这个IP地址指向harbor VM的主机名(参见cloud-init.yaml部分)，我们应该能够无缝地访问应用程序。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es my"><img src="../Images/1f71bc2c43284f1143b7e38dbe2af7ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6EIXQxjd_hxLttG6YItSQ.png"/></div></div></figure></div></div>    
</body>
</html>