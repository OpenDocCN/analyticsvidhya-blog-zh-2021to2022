<html>
<head>
<title>Exploratory Data Analysis using Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spark进行探索性数据分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/exploratory-data-analysis-using-spark-c19964faf620?source=collection_archive---------0-----------------------#2021-10-31">https://medium.com/analytics-vidhya/exploratory-data-analysis-using-spark-c19964faf620?source=collection_archive---------0-----------------------#2021-10-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/fe3b030af1779f05d38c1182464a73d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*7WxGEM6TGJXbfEfPOmsVbQ.png"/></div></figure><h1 id="dab3" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">介绍</h1><p id="9a7b" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">这篇博客旨在展示使用apache spark执行探索性数据分析的一步一步的方法。它的目标受众是开始接触PySpark的初学者和中级数据工程师。但是，更有经验或更高级的spark用户也可以查看这些材料，并提出改进措施。</p><p id="5b3a" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">请注意，进行探索性数据分析有多种方法，本博客只是其中一种。这个博客的目的是帮助初学者开始使用spark的旅程，并为中级数据工程师提供现成的参考。这里提供的信息可以有多种用途。它可以按原样使用，也可以组合在一起构建各种其他方式来执行EDA或构建特定功能。</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><h1 id="c031" class="im in hi bd io ip ku ir is it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj bi translated">先决条件</h1><p id="00ac" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">本博客中使用的数据取自<a class="ae kz" href="https://www.kaggle.com/new-york-city/nyc-parking-tickets?select=Parking_Violations_Issued_-_Fiscal_Year_2017.csv" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/new-york-city/nyc-parking-tickets</a>。数据集大约有1000万条记录</p><p id="af11" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">火花分布从https://spark.apache.org/downloads.html<a class="ae kz" href="https://spark.apache.org/downloads.html" rel="noopener ugc nofollow" target="_blank">下载</a></p><p id="d887" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我用来开发这里介绍的代码的发行版是spark-3.0.3-bin-hadoop2.7.tgz</p><p id="f06c" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这篇博客假设读者可以在本地或通过AWS EMR或通过Databricks或Azure HDInsights访问Spark集群</p><p id="2d9d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">最后但同样重要的是，读者应该将Spark API参考资料<a class="ae kz" href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql.html" rel="noopener ugc nofollow" target="_blank">https://Spark . Apache . org/docs/latest/API/python/reference/py Spark . SQL . html</a></p><p id="e1e3" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">本博客中使用的所有代码都可以在<a class="ae kz" href="https://github.com/sumaniitm/complex-spark-transformations" rel="noopener ugc nofollow" target="_blank">https://github.com/sumaniitm/complex-spark-transformations</a>获得</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="1a57" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">事不宜迟，让我们开始吧</p><figure class="lb lc ld le fd ij er es paragraph-image"><div class="er es la"><img src="../Images/233a1e2c3819b2afb0ecae025d6923cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*_yEx5nNkB09EL1wQwt0xCQ.jpeg"/></div></figure><h1 id="3385" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">预处理</h1><p id="9948" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">首先也是最重要的是我们想要对数据进行的预处理</p><p id="aa61" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们将参考笔记本<a class="ae kz" href="https://github.com/sumaniitm/complex-spark-transformations/blob/main/preprocessing.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/sumaniitm/complex-spark-transformations/blob/main/preprocessing . ipynb</a></p><p id="392c" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">作为第一步，我们将在一个公共位置提供一些先决条件，这样我们就可以随时回来并在必要时更改它们。例如，保存数据文件的路径(输入数据和输出数据)、各种解释变量和响应变量的名称(要了解这些变量的含义，请查看<a class="ae kz" href="https://www.statisticshowto.com/probability-and-statistics/types-of-variables/explanatory-variable/" rel="noopener ugc nofollow" target="_blank">https://www . statistics show to . com/probability-and-statistics/types-of-variables/explanatory-variable/</a>)。这些在一个简单的python文件中声明<a class="ae kz" href="https://github.com/sumaniitm/complex-spark-transformations/blob/main/config.py" rel="noopener ugc nofollow" target="_blank">https://github . com/sumaniitm/complex-spark-transformations/blob/main/config . py</a></p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/c98520476bccad2f4553fe5edf779862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BiDj96kFJ9__SENY-FdIWA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">config.py文件中声明的配置</figcaption></figure><p id="908b" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如您所见，我已经列出了作为响应和解释变量的数据属性。这里的目的是研究哪种类型的响应变量相对于解释变量更常见。为了使它更清楚，让我们提出这样的问题:一个月内违反哪种<em class="lo">法律_章节</em>最多，一周内违反哪种<em class="lo">车牌_类型</em>最多。这些问题中的星期和月份显然来自于<em class="lo">发布日期</em>和<em class="lo">违反时间</em>。</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="ed36" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">从统计的世界回到工程的世界，下一步是开始一个spark会话并使配置文件在会话中可用，然后使用配置文件中提到的配置从文件中读入数据。我们通过以下方式做到这一点</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lp"><img src="../Images/a84af30037d44207fa499f3e9e2897d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-uZo1R54AtkgA_ce5SIjcQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">初始声明和读入文件数据</figcaption></figure><p id="937a" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">现在我们已经在一个<em class="lo"> PySpark </em> dataframe中有了数据，我们会注意到在列名中有空格。这在后面会很不方便，所以为了简化我们的EDA，我们用下划线代替空格，如下所示</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/af9a8370ce3cbe6b7c885942a897aabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXZaTOfwDmHV6dgmtzvOpQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">删除列名中的空格</figcaption></figure><p id="125e" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">为了开始预处理，我们首先尝试查看数据帧中存在多少个响应变量的唯一值，换句话说，我们需要一种基数感。因此，我们继续进行以下工作</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lr"><img src="../Images/5ebc13b36d1214dc8e43cc7401af2b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CqY_ddQIRd-Q0tmutDr5Ng.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">响应变量的不同值</figcaption></figure><p id="285b" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如您所见，一些响应变量具有大量不同的值，而另一些则少得多，例如<em class="lo"> Law_Section </em>和<em class="lo"> Violation_County </em>是两个具有不同值(分别为8和12)的响应变量，在没有图表/绘图的情况下更容易看到。因此，为了简单起见，我们将选择这两个进行进一步的EDA。</p><p id="7419" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">接下来，我们将重点关注解释变量，作为对所选变量质量的第一次检查，我们将试图找出数据中存在多少解释变量的<em class="lo">空值</em>或<em class="lo">南值</em></p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ls"><img src="../Images/d9be40be5187264d07481d70c4a90e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FL5glpfj2mJvxeXTivREjQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">解释变量中的空值/NaNs检查</figcaption></figure><p id="ce31" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这很好，我们选择的解释变量不会很容易出现<em class="lo">空值</em>或<em class="lo">空值</em></p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="b433" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">查看<em class="lo"> Violation_Time </em>解释变量，我们可以看到创建另一个解释变量的机会，这可以为我们的EDA添加另一个维度，因此我们现在就创建它，而不是在功能或转换构建阶段创建它</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lt"><img src="../Images/06ce536c9b7435e111b0762ba9c63399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Hi7h3d9MOeURONuN17ncQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">新分类解释变量AM/PM</figcaption></figure><p id="f159" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">这个新的解释变量将给出一天中违规行为发生最多的时间，是在凌晨、深夜还是在中午。</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="4911" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们关心的下一个问题是列<em class="lo"> Issue_Date </em>中的日期格式，目前是MM/dd/yyyy格式，需要标准化为YYYY-MM-DD格式。因此，我们执行以下操作</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lu"><img src="../Images/b82c5253284b5d4e5504fdf82e08aa60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G3HrshTwa6hlF_soyjw4tA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">日期格式标准化</figcaption></figure><p id="e788" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">请注意，<em class="lo"> Issue_Date </em>列中的值将具有大量不同的值，因此以其当前形式处理起来会很麻烦(不借助绘图)。因此，我们从中派生出一些分类解释变量，其基数比当前形式的<em class="lo"> Issue_Date </em>要小得多。我们将提取年、月、星期几和月几，如下所示</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lv"><img src="../Images/1ae84d3cffa8aaaa6af832407a6a22ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AN65zfsBzXURmDZ5CrEfCw.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">Issue_Date的分类变量</figcaption></figure><p id="3139" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们还研究了数据框架中的几列，看看它们是否可以作为响应变量</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lw"><img src="../Images/7355a4f38d6db1f61e856bd8c6b3f3c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kBmpPcecEKtbGmmt-FlwTw.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">搜索其他响应变量</figcaption></figure><p id="a308" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">非常高的<em class="lo">null/NaNs，</em>因此被拒绝</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lx"><img src="../Images/4bb1b6bcd01b6fd000ccb2278bd8ded4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6_UIkYMqKFYlkiAkvTjFQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">搜索其他响应变量。</figcaption></figure><p id="ec31" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">除了<em class="lo">脚离开路缘</em>之外，其他两个都可以被拒绝</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ly"><img src="../Images/1c334e1027d84f9c96e996eb3f61f4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHX5jPoyHsB2EqvCFyf8Vw.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">更多响应变量的最终搜索</figcaption></figure><p id="30c1" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">所有这三个都可以被拒绝</p><p id="8e85" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">为了减小数据帧的大小，让我们删除这些对我们没有明显用处的列。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lz"><img src="../Images/8824fe2e55597f5ef0b0f0ef591c4ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zspgVcPlt0lAZEcQmyfwQQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">删除不需要的列</figcaption></figure><p id="87d1" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们将执行的下一项检查将告诉我们数据是否在预期的时间范围内。请记住，我们从kaggle的纽约市出租车数据集中选择了2017年的数据，因此发布日期的范围预计在2017年以内。让我们看看这是不是真的，如果不是，就纠正过来。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ma"><img src="../Images/6a580966dd935920ba303a03a8bb6991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QKoyuaePuS6dnRKppNZypw.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">清除不良数据</figcaption></figure><p id="90d3" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如您所见，有未来发行日期的记录，这实际上没有任何意义，因此我们将数据缩减到2017年以内。然而，这将使分类解释变量<em class="lo"> Issue_Year </em>(之前创建的)变得多余，但这是我们愿意做出的权衡。我们将通过从<em class="lo">违例_时间</em>变量中导出另一个变量来弥补这个丢失的变量</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mb"><img src="../Images/7d8bed1bb790fdfb16444ac52cdd3b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uu_I6JfBJHM67by-HfhqSA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">取代发行年份的新解释变量</figcaption></figure><p id="5438" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">最终记录大约是500万</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mc"><img src="../Images/0ea5b8bb4d21b5169ef9b5984d356e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XrWlLcK6WK8PZX8yyAdiBQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">限制在2017年以内后的记录数</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="39c0" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">最后，我们通过将此数据帧写入csv来保存它，从而完成预处理，这将是我们用于进一步EDA的数据集</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es md"><img src="../Images/8327df77a901fc70724a028116079980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dD6vzIdzipcSahkdpTjBxA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">将最终数据帧写入磁盘</figcaption></figure><h1 id="10a8" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">转换</h1><p id="0138" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">在下面的讨论中，我们将参考笔记本<a class="ae kz" href="https://github.com/sumaniitm/complex-spark-transformations/blob/main/transformations.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/sumaniitm/complex-spark-transformations/blob/main/transformations . ipynb</a></p><p id="24bc" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">我们通过读取我们在上面的磁盘中写入的预处理数据集来摆脱，并开始寻找季节性，即违规行为是否在任何特定月份都更多(记住我们只处理2017年)。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es me"><img src="../Images/088d91e257aa26da1a0f5a8dc6ed050a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9CEn8LSYDH_k_fwRg-SbA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">调查季节性</figcaption></figure><p id="e605" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">从上面我们可以看到，违规行为在上半年更为常见。这为我们提供了另一个机会，将我们的数据框架进一步缩减至2017年上半年。请记住，这可能是源数据本身的错误，但在我们目前的讨论范围内，我们无法验证这一点。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mf"><img src="../Images/76cdc1a2632130ba0b6d547d7cd4ac18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s8G8yHTuKZzBLthElDC5YA.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">数据缩减至2017年前6个月</figcaption></figure></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="d56e" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">接下来，我们试图在一个月内将违规行为标准化/规范化。要了解标准化和规范化之间的区别，请查看<a class="ae kz" rel="noopener" href="/swlh/difference-between-standardization-normalization-99be0320c1b1">https://medium . com/swlh/difference-between-standard-normalization-99be 0320 C1 B1</a></p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mg"><img src="../Images/7751b13dc0676e2b23c62e6b353fb130.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QCKOlWiA5qIwoYvjAXvKig.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">得出标准化/规范化数字的步骤</figcaption></figure><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mh"><img src="../Images/4dab061144179ea2c810bf79ca2dbd98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UigjVRlkt1MCxKx_EwJaiQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">标准化/规范化违规计数</figcaption></figure><p id="a9f1" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">观察标准化数字(违规计数高于或低于标准1、2或3个单位)，违规似乎在月初和月末更常见，月中略有下降。现在我们已经看到了这个月的一些趋势，让我们缩小到一周内。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mi"><img src="../Images/1ef88b89eeee51b510e48381c7b629a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZ0cQEY6OCGjIVnaNpPyaQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">看着一周</figcaption></figure><p id="aea6" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如您所料，在工作日期间，违规更为常见(违规计数比标准高出或低于1或2个单位)</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="22ad" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">到目前为止，我们一次只查看一个响应变量，让我们换个角度，尝试观察响应变量的组合。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mj"><img src="../Images/625ad8c49af7c785fe8cf7ac5c3a8efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZ9HcvMDv5aDK5rmK44o0Q.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">具有多个响应变量的透视</figcaption></figure><p id="fc8d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">请密切注意spark中pivot函数的用法，这是spark武器库中的一个强大工具，可以以多种有用的方式使用。但是，这个视图在确定这种响应变量组合的违规趋势时不是很有用，所以让我们尝试一些不同的方法。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mk"><img src="../Images/bdf0802f639d55aa80cbfa048e7f57c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JxnIa5urpRzqOU9_eQLtZg.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">十大组合</figcaption></figure><p id="728d" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">有明显的迹象表明，在纽约注册的车辆是最常见的违规者，其中违规行为在纽约县更常见，408节是最常违反的法律。然而，这是很明显的，因为整个数据集来自纽约。让我们去掉NY county和NY作为注册州，看看哪个组合出现在前10名中。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ml"><img src="../Images/f69925b1057359c4de3dfc5604ac0f38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-MyzO0hljokZIPpqE_vjw.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">过滤掉纽约</figcaption></figure><p id="bdd3" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">现在，新泽西州注册的车辆名列前茅，K县是违反法律408最多的接收端。</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="1937" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">到目前为止还不错，但是响应变量的组合对视觉检查提出了挑战(因为我们没有使用任何图来保持我们自己完全在spark内)，因此我们回到研究单个响应变量。</p><p id="d350" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">有一点很突出，那就是<em class="lo">问题_DayofWeek </em>，它目前存储为数字，以后可能会带来挑战，所以我们在该列的数据前面追加一个字符串<em class="lo"> Day_ </em>。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lp"><img src="../Images/129d5306e38962196a22c0a338deb2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yfk8hPxRfzxFbrLdFrTmAQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">将字符串追加到列条目</figcaption></figure><p id="1336" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">现在我们一次关注一个反应变量，看看它们在一周内是如何分布的</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mm"><img src="../Images/662f61d8515f4b747f5d994b4241abec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XaXPB8Z49i5kARJfnY9ldw.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">法律部分在一周内的分布</figcaption></figure><p id="65d0" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">注意对<code class="du mn mo mp mq b"><em class="lo">dropna</em></code>函数的调用中的<code class="du mn mo mp mq b"><em class="lo">how=‘any’</em></code> <em class="lo"> </em>，这告诉spark删除任何一列中有空值的行。这就把我们的观察限制在一周内被违反的法律部分。如你所见，408是违反法律最多的部分，这一周都在违反。</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mr"><img src="../Images/e7d354e42d4b57953a176fe42bcbbdf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cp_W0tqM_OLwwNDFabho1g.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">一周内违规县分布</figcaption></figure><p id="89ff" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">使用与用于<em class="lo">法律部分</em>类似的变换，我们观察到K县在一周内记录了最多的违规。请记住，我们已经从这个数据集中过滤掉了NY，否则NY county会像以前一样出现在最上面。</p><p id="f2ae" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">最后，我们查看<em class="lo">注册状态</em>，但是要记住这个变量的基数很高，所以我们必须根据违规计数对所有工作日进行排序，然后查看前10个数据点。让我们去做吧</p><figure class="lb lc ld le fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ms"><img src="../Images/3daa020a847a92ee10cc809c28e62b23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQ5NlcH42YgRWm5pTayhEg.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx translated">十大注册州</figcaption></figure><p id="d142" class="pw-post-body-paragraph jk jl hi jm b jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc kd km kf kg kh hb bi translated">如前所述(在处理多个响应变量的组合时)，注册在新泽西州的车辆是一周内最常见的违规者。密切注意变量<em class="lo"> colmToOrderBy。</em>该变量有助于我们避免将所有日期都作为数据帧排序的列。有必要学习使用这些速记技术，以使您的代码更加模块化和可读性更强，并尽可能避免硬编码。</p><h1 id="ca7a" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">EDA的最终结果</h1><p id="b95f" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">基于2017年数据的总体结论如下:违规行为在上半年最常见，违规行为在月初或月末更频繁发生。工作日更容易违规。在纽约和新泽西州注册的车辆是最违规的，这些违规行为在纽约和K县被观察到最多</p><h1 id="955f" class="im in hi bd io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj bi translated">结论</h1><p id="cdf3" class="pw-post-body-paragraph jk jl hi jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">如果你已经做到这一步，我感谢你花时间，并希望这是有价值的。请在评论中分享你的观点或鼓掌(如果你认为值得花时间)。</p></div></div>    
</body>
</html>