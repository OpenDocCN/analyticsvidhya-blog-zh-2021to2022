<html>
<head>
<title>Accelerating Tensorflow using M1 Chip — The Antonai Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用M1芯片加速张量流</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/accelerating-tensorflow-using-m1-chip-the-antonai-blog-2a4388e3bd36?source=collection_archive---------4-----------------------#2021-11-22">https://medium.com/analytics-vidhya/accelerating-tensorflow-using-m1-chip-the-antonai-blog-2a4388e3bd36?source=collection_archive---------4-----------------------#2021-11-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="53d8" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">安装指南</h1><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/0319a724bf1f997bb3ca2d456d6b779d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/0*bXm11gaofkcoev2e"/></div></figure><p id="ec2e" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="ki">作者安东尼奥·利斯</em></p><h1 id="9a9e" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="45b8" class="pw-post-body-paragraph jk jl hh jm b jn kj jp jq jr kk jt ju jv kl jx jy jz km kb kc kd kn kf kg kh ha bi translated">大家好，欢迎回到另一篇数据科学博文。今天我们将讨论M1芯片，以及如何用它来加速张量流。</p><p id="8d66" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">去年春天，我决定最终购买一台M1 MacBook air。苹果真的用这台机器做到了。它非常适合日常使用，电池续航时间长，没有风扇噪音，速度惊人。</p><p id="3f1d" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">但我不仅仅是一个临时用户。我想用我的笔记本电脑完成简单的编程任务和数据科学领域的原型制作。</p><p id="a766" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我可以用它做任何事情，但是安装带有M1芯片原生支持的Tensorflow就不那么简单了。因此，我认为安装指南可能对像我一样想使用Tensorflow来开发M1 GPU功能的其他人有用。</p><h1 id="d5e7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">苹果官方指南</h1><p id="b8d3" class="pw-post-body-paragraph jk jl hh jm b jn kj jp jq jr kk jt ju jv kl jx jy jz km kb kc kd kn kf kg kh ha bi translated">你可以在这里找到苹果官方的说明<a class="ae ko" href="https://developer.apple.com/metal/tensorflow-plugin/" rel="noopener ugc nofollow" target="_blank"/>。所以首先我们需要有最新的macOS 12测试版。你可以在这里找到加入苹果测试软件程序<a class="ae ko" href="https://beta.apple.com/sp/betaprogram/enroll" rel="noopener ugc nofollow" target="_blank">的说明</a>。</p><p id="d248" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">然后我们需要从<a class="ae ko" href="https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-MacOSX-arm64.sh" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装MacOS的miniconda。安装完成后，确保将conda命令链接到您刚刚下载的命令。</p><p id="cb8a" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">因此，我们将创建一个名为tensorflow_m1的虚拟环境:</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="44da" class="ku if hh kq b fi kv kw l kx ky">conda create --name tensorflow_m1</span></pre><p id="d1c9" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">现在，我们可以激活刚刚创建的环境:</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="f743" class="ku if hh kq b fi kv kw l kx ky">conda activate tensorflow_m1</span></pre><p id="cf2e" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在安装新东西和/或开始新项目之前，您应该始终创建一个虚拟环境。这是一个好习惯，万一搞砸了，可以节省你很多时间。</p><p id="ac3a" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们现在可以安装tensorflow依赖项:</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="f000" class="ku if hh kq b fi kv kw l kx ky">​​conda install -c apple tensorflow-deps==2.5.0</span></pre><p id="35c1" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们在这里指定版本只是为了避免最新版本的错误/问题。</p><p id="58b4" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">然后我们为MacOS安装tensorflow和tensorflow-metal插件:</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="255c" class="ku if hh kq b fi kv kw l kx ky">python -m pip install tensorflow-macos <br/>python -m pip install tensorflow-metal</span></pre><p id="a4f8" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这样，我们就按照苹果官方指南做了。以下是我在执行这些步骤时遇到的主要问题:</p><ul class=""><li id="28a5" class="kz la hh jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">如果在没有版本的情况下使用<em class="ki">conda install-c apple tensorflow-deps</em>会导致无法导入tensor flow</li><li id="aa62" class="kz la hh jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">如果你没有最新的macOS测试版，它根本就不能工作</li><li id="62a7" class="kz la hh jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">即使按照上面的步骤，您也可能得到错误“导入numpy c-extensions失败”</li></ul><p id="6da4" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">解决numpy错误。我找到了这个<a class="ae ko" href="https://stackoverflow.com/questions/58868528/importing-the-numpy-c-extensions-failed" rel="noopener ugc nofollow" target="_blank">页面</a>，里面解释说你可以简单的重装numpy。所以我只是在终端中键入了以下命令:</p><pre class="jd je jf jg fd kp kq kr ks aw kt bi"><span id="99ef" class="ku if hh kq b fi kv kw l kx ky">pip install --upgrade --force-reinstall numpy</span></pre><h1 id="4dc8" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">最终检查</h1><p id="0d8e" class="pw-post-body-paragraph jk jl hh jm b jn kj jp jq jr kk jt ju jv kl jx jy jz km kb kc kd kn kf kg kh ha bi translated">你应该可以用M1芯片加速张量流。为了确保一切正常，只需在终端(激活环境后)键入python。您应该得到这样的结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ln"><img src="../Images/f95bfc2f2aa9902f4c04df337996330c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tHV7PU1j2ax4fYhA"/></div></div></figure><p id="df6a" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">现在可以导入tensorflow了:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ln"><img src="../Images/5f8ee4e10778d2b539c95f0c1ddbbac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mytBIzGco7SYaFtE"/></div></div></figure><p id="3c83" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们可以检查它是否可以使用GPU:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ls"><img src="../Images/f6d7fd596422b2ab5abb21b032040c34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BF-hscpkBkr8BkXj"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lt"><img src="../Images/8437d41def83e6b273778e6db2842108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PgCMPrdSvKm7tVpn"/></div></div></figure><p id="5607" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">仅此而已。</p><p id="457d" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我希望该指南对您有用。有任何问题，你可以通过Linkedin联系我。</p><p id="43e7" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果你喜欢这篇文章，分享给你的朋友和同事吧！我会在下一篇文章中看到你。与此同时，要小心，保持安全，记住不要成为另一块墙上的砖。</p><p id="45c2" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Anton.ai</p></div><div class="ab cl lu lv go lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ha hb hc hd he"><p id="320f" class="pw-post-body-paragraph jk jl hh jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="ki">原载于2021年11月22日</em><a class="ae ko" href="https://antonai.blog/accelerating-tensorflow-using-m1-chip/" rel="noopener ugc nofollow" target="_blank"><em class="ki">https://antonai . blog</em></a><em class="ki">。</em></p></div></div>    
</body>
</html>