<html>
<head>
<title>The pursuit of happiness with Python and PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python和PostgreSQL追求快乐</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-pursuit-of-happiness-with-python-and-postgresql-4f3f8f5fc08e?source=collection_archive---------17-----------------------#2021-06-28">https://medium.com/analytics-vidhya/the-pursuit-of-happiness-with-python-and-postgresql-4f3f8f5fc08e?source=collection_archive---------17-----------------------#2021-06-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/608cb96f6d18b2fa312bba41a8f3f0e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_v7LciA-fVJcbDsy"/></div></div></figure><p id="a934" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创造信息就像任何创造过程一样。它从寻找材料(在这种情况下是数据源)开始，然后是清理、连接和争论数据集。当你完成的时候，你已经建造了一些美丽的东西，并获得了新的见解来分享——然后你又重新开始。</p><p id="2702" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在信息创建中使用最广泛的语言之一是Python，它受到数据科学家、工程师和分析师的喜爱，因为它有一个巨大的现有库生态系统来处理数据争论。</p><p id="acd1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇博文探索了三个这样的库:<code class="du jn jo jp jq b">pandas</code>、<code class="du jn jo jp jq b">ddlgenerator</code>和<code class="du jn jo jp jq b">psycopg2</code>。这些都使我们能够清理数据集，并将其推送到PostgreSQL数据库，以后可以在该数据库中查询数据，并将其暴露给大量不同的公司数据。</p><p id="4589" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">今天，我们的目标很简单:我们将探索一个幸福数据集，并试图找出我们应该搬到世界上的哪个地方才能拥有快乐的生活！</p><p id="9440" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以下是高级流程:</p><h1 id="29ca" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">0.获取数据集</h1><p id="e6f6" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">如前所述，首先要找到一个数据集。<a class="ae ku" href="https://www.kaggle.com" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>是一个在数据科学社区广泛使用的网站，提供用于挑战、比赛或学习的数据集。他们有一个很好的关于世界幸福的数据集，只需要登录就可以下载。它包含5个CSV文件，每年一个，列出了各个国家的幸福排名以及其他一些指标。</p><p id="58a1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们创建一个名为<code class="du jn jo jp jq b">happiness</code>的文件夹和一个名为<code class="du jn jo jp jq b">data</code>的子文件夹来存储文件:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="4e3f" class="ld js hh jq b fi le lf l lg lh">mkdir -p happiness/data cd happiness</span></pre><p id="e1b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，从<a class="ae ku" href="https://www.kaggle.com/unsdsn/world-happiness" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载数据，并将5个CSV放在<code class="du jn jo jp jq b">happiness/data</code>文件夹中。</p><h1 id="ccab" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">1.清理数据</h1><p id="7ab9" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">正如经常发生的那样，源数据集并不总是整洁干净的。对于我们的幸福数据集来说也是如此。浏览文件时，我们可以看到<code class="du jn jo jp jq b">2015.csv</code>和<code class="du jn jo jp jq b">2016.csv</code>共享相同格式的列名和数据。但是<code class="du jn jo jp jq b">2017.csv</code>缺少了<code class="du jn jo jp jq b">Region</code>列，其他一些列的命名和排序不同(<code class="du jn jo jp jq b">Generosity</code>和<code class="du jn jo jp jq b">Trust</code>被交换)。这同样适用于文件<code class="du jn jo jp jq b">2018.csv</code>和<code class="du jn jo jp jq b">2019.csv</code>，在那里我们再也找不到置信区间了。此外，年份只包含在文件名中，而不在列中。</p><p id="356f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在开始我们的清理工作之前，每次我们开始一个新的Python项目时，创建一个单独的<a class="ae ku" href="https://docs.python.org/3/tutorial/venv.html" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>是一个很好的实践。这确保了我们的默认Python环境不会因为可能冲突的库而过载。我们可以创建一个虚拟环境，并像这样启用它:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="0175" class="ld js hh jq b fi le lf l lg lh">python -m venv python_pg source python_pg/bin/activate</span></pre><p id="061d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了产生一致的数据视图，文件需要一些处理，所以让我们戴上Python超级英雄的面具。首先安装<a class="ae ku" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>库，它将通过在您的终端中执行以下代码来帮助我们进行数据操作和分析:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="66d3" class="ld js hh jq b fi le lf l lg lh">pip install pandas</span></pre><p id="d2ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们可以在我们的<code class="du jn jo jp jq b">happiness</code>文件夹中创建一个名为<code class="du jn jo jp jq b">prepare.py</code>的文件，并开始在其中包含一些Python代码。我们将首先导入先前安装的库，以及默认情况下应该安装的和，并分别启用与操作系统和路径名模式扩展的交互。</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="3588" class="ld js hh jq b fi le lf l lg lh">import pandas as pd import glob, os</span></pre><p id="07d1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，定义我们将在名为<code class="du jn jo jp jq b">all_years_df</code>的目标数据帧中使用的列名，以存储清理后的数据集。将以下几行添加到<code class="du jn jo jp jq b">prepare.py</code>文件:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="0c2c" class="ld js hh jq b fi le lf l lg lh">column_names = ['survey_yr', 'country', 'overall_rank',<br/>                'score', 'gdp', 'generosity', 'freedom',<br/>                'social_support', 'life_exp', 'gov_trust']</span><span id="af33" class="ld js hh jq b fi li lf l lg lh">all_years_df = pd.DataFrame()</span></pre><p id="db5d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在是时候拨乱反正，解析<code class="du jn jo jp jq b">data</code>文件夹中的所有CSV文件了。将以下代码添加到<code class="du jn jo jp jq b">prepare.py</code>文件中:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="6aae" class="ld js hh jq b fi le lf l lg lh">files = glob.glob('data/*.csv')</span><span id="4d80" class="ld js hh jq b fi li lf l lg lh">for fp in files:<br/>    # Handling file names as new column<br/>    file_year = os.path.basename(fp).split('.')[0]<br/>    file_content = pd.read_csv(fp).assign(Year=int(file_year)-2000)</span><span id="ea2a" class="ld js hh jq b fi li lf l lg lh"># Picking the right column for each file based on the year<br/>    uniformed_columns = find_columns(file_content, file_year)</span><span id="df81" class="ld js hh jq b fi li lf l lg lh"># Conforming column names and appending the parsed year data to all_years_df<br/>    uniformed_columns.columns = column_names<br/>    all_years_df = pd.concat([all_years_df, uniformed_columns])</span><span id="9d1d" class="ld js hh jq b fi li lf l lg lh">all_years_df.to_csv('results.csv', index=False)</span></pre><p id="25c6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du jn jo jp jq b">glob</code>函数返回<code class="du jn jo jp jq b">happiness/data</code>文件夹中的文件列表，我们循环遍历这些文件。对于每个文件，我们用<code class="du jn jo jp jq b">os.path.basename</code>读取文件名，用点(<code class="du jn jo jp jq b">.</code>)分割文件名，取第一部分，只提取年份信息。<code class="du jn jo jp jq b">file_content</code>行使用pandas的<code class="du jn jo jp jq b">read_csv</code>函数加载文件数据，并用年份的最后两位数字(<code class="du jn jo jp jq b">int(file_year)-2000</code>)填充新列<code class="du jn jo jp jq b">Year</code>(使用<code class="du jn jo jp jq b">assign</code>函数)。</p><p id="2304" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来我们调用<code class="du jn jo jp jq b">find_columns</code>函数，我们将很快定义它，根据年份从源文件中选择正确的列。</p><p id="bf7c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">之后，我们合并仅包含一年数据的<code class="du jn jo jp jq b">uniformed_columns</code>数据帧中的列名，然后在过程结束时将它附加到包含整个数据集的<code class="du jn jo jp jq b">all_years_df</code>数据帧中。最后，我们将最终结果存储在<code class="du jn jo jp jq b">happiness</code>文件夹中名为<code class="du jn jo jp jq b">results.csv</code>的CSV文件中。</p><h1 id="8a2a" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">选择正确的列</h1><p id="6f50" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">缺少的部分是<code class="du jn jo jp jq b">find_columns</code>函数定义，在这里我们合并了列名和顺序。如上所述，根据年份，我们需要从源文件中选择正确的列。将以下代码添加到<code class="du jn jo jp jq b">prepare.py</code>文件中，紧接在<code class="du jn jo jp jq b">import</code>语句之后，以在不同年份执行该技巧:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="8347" class="ld js hh jq b fi le lf l lg lh">def find_columns(file_content, file_year):<br/>    if file_year in ['2015', '2016']:<br/>        uniformed_columns = file_content[[<br/>            'Year', 'Country', 'Happiness Rank', 'Happiness Score',<br/>            'Economy (GDP per Capita)', 'Generosity', 'Freedom', 'Family',<br/>            'Health (Life Expectancy)', 'Trust (Government Corruption)'<br/>            ]]</span><span id="bf33" class="ld js hh jq b fi li lf l lg lh">elif file_year in ['2017']:<br/>        uniformed_columns = file_content[[<br/>            'Year', 'Country', 'Happiness.Rank', 'Happiness.Score',<br/>            'Economy..GDP.per.Capita.', 'Generosity', 'Freedom', 'Family',<br/>            'Health..Life.Expectancy.', 'Trust..Government.Corruption.'<br/>            ]]</span><span id="3610" class="ld js hh jq b fi li lf l lg lh">else:<br/>        uniformed_columns = file_content[[<br/>            'Year', 'Country or region', 'Overall rank', 'Score',<br/>            'GDP per capita', 'Generosity', 'Freedom to make life choices',<br/>            'Social support', 'Healthy life expectancy',<br/>            'Perceptions of corruption'<br/>            ]]</span><span id="05bb" class="ld js hh jq b fi li lf l lg lh">return uniformed_columns</span></pre><p id="cdac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该函数为每年选择正确的列，并返回结果数据帧。</p><p id="c804" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在是检查管道是否工作的时候了。将终端放在<code class="du jn jo jp jq b">happiness</code>文件夹上，让我们执行以下操作:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="fd4b" class="ld js hh jq b fi le lf l lg lh">python prepare.py</span></pre><p id="29d1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在检查<code class="du jn jo jp jq b">happiness</code>文件夹中的文件<code class="du jn jo jp jq b">results.csv</code>以验证代码是否有效。结果应该是这样的:</p><figure class="kv kw kx ky fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/85fbbc085c9723486294258a77116d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4FQVI5LPqKDR_Jeh.png"/></div></div></figure><h1 id="794c" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">2.创建PostgreSQL实例</h1><p id="cc25" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">第二步是将我们的数据存储在PostgreSQL表中。但是在存储它之前，我们需要一个PG数据库；让我们在终端中用<a class="ae ku" href="https://aiven.io/blog/command-line-magic-with-the-aiven-cli?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=blog_art&amp;utm_content=post" rel="noopener ugc nofollow" target="_blank"> Aiven CLI </a>创建一个</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="9011" class="ld js hh jq b fi le lf l lg lh">avn service create demo-pg    \<br/>  -t pg                       \<br/>  --cloud google-europe-west3 \<br/>  -p hobbyist</span></pre><p id="3840" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上面的命令使用一个<code class="du jn jo jp jq b">hobbyist</code>计划在<code class="du jn jo jp jq b">google-europe-west3</code>上创建一个名为<code class="du jn jo jp jq b">demo-pg</code>的PostgreSQL实例。你可以在我们的定价页面查看所有PostgreSQL计划<a class="ae ku" href="https://aiven.io/pricing?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=blog_art&amp;utm_content=post" rel="noopener ugc nofollow" target="_blank">。为了连接到它，我们需要包含像<code class="du jn jo jp jq b">host</code>、<code class="du jn jo jp jq b">port</code>和默认<code class="du jn jo jp jq b">avnadmin</code>用户的<code class="du jn jo jp jq b">password</code>这样的信息的<code class="du jn jo jp jq b">service uri</code>。我们可以通过以下方式检索它:</a></p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="76b0" class="ld js hh jq b fi le lf l lg lh">avn service get demo-pg --format '{service_uri}'</span></pre><p id="b122" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们有几分钟的时间放松一下，等待终端中的以下调用之后实例准备好</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="a05b" class="ld js hh jq b fi le lf l lg lh">avn service wait demo-pg</span></pre><h1 id="dc89" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">3.将数据推送到PostgreSQL</h1><p id="b29b" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">一旦服务开始运行，返回Python并准备数据推送。</p><p id="fa54" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们将使用<a class="ae ku" href="https://github.com/catherinedevlin/ddl-generator" rel="noopener ugc nofollow" target="_blank"> ddlgenerator </a>库自动生成SQL语句来创建PostgreSQL表，并使用<a class="ae ku" href="https://www.psycopg.org/" rel="noopener ugc nofollow" target="_blank"> psycopg2 </a>与数据库进行交互。我们可以在终端中使用以下代码行安装这两者:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="b434" class="ld js hh jq b fi le lf l lg lh">pip install psycopg2 ddlgenerator</span></pre><p id="a1fc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在创建一个新的<code class="du jn jo jp jq b">push.py</code>文件，添加导入，并连接到数据库语句。用上面的<code class="du jn jo jp jq b">avn service get</code>命令的输出替换下面代码中的<code class="du jn jo jp jq b">&lt;SERVICE_URI_OUTPUT&gt;</code>参数:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="e1b4" class="ld js hh jq b fi le lf l lg lh">import psycopg2 </span><span id="90aa" class="ld js hh jq b fi li lf l lg lh">conn = psycopg2.connect('&lt;SERVICE_URI_OUTPUT&gt;')</span></pre><p id="ccbe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">连接已建立。我们现在可以创建表并推送数据。<code class="du jn jo jp jq b">ddlgenerator</code>提供了从CSV文件创建表DDL和insert语句的良好功能。我们可以将下面的代码添加到<code class="du jn jo jp jq b">push.py</code>文件中:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="2fdf" class="ld js hh jq b fi le lf l lg lh">from ddlgenerator.ddlgenerator import Table</span><span id="4014" class="ld js hh jq b fi li lf l lg lh">table = Table('results.csv', table_name='HAPPINESS')<br/>sql = table.sql('postgresql', inserts=True)</span></pre><p id="9654" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从<code class="du jn jo jp jq b">ddlgenerator</code>导入<code class="du jn jo jp jq b">Table</code>类后，代码创建一个解析<code class="du jn jo jp jq b">results.csv</code>文件的实例，目标表名为<code class="du jn jo jp jq b">HAPPINESS</code>。最后一行为PostgreSQL创建了<code class="du jn jo jp jq b">CREATE</code>表定义SQL，包括每行的insert语句(<code class="du jn jo jp jq b">inserts=True</code>)。如果我们打印SQL语句，它应该如下所示:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="02f0" class="ld js hh jq b fi le lf l lg lh">DROP TABLE IF EXISTS happiness;</span><span id="9734" class="ld js hh jq b fi li lf l lg lh">CREATE TABLE happiness (<br/>    survey_yr INTEGER NOT NULL,<br/>    country VARCHAR(24) NOT NULL,<br/>    overall_rank INTEGER NOT NULL,<br/>    score DECIMAL(15, 14) NOT NULL,<br/>    gdp DECIMAL(17, 16) NOT NULL,<br/>    generosity DECIMAL(16, 16) NOT NULL,<br/>    freedom DECIMAL(16, 16) NOT NULL,<br/>    social_support DECIMAL(16, 15) NOT NULL,<br/>    life_exp DECIMAL(17, 16) NOT NULL,<br/>    gov_trust DECIMAL(16, 16)<br/>);</span><span id="9ada" class="ld js hh jq b fi li lf l lg lh">INSERT INTO happiness (survey_yr, country, overall_rank, score, gdp, generosity, freedom, social_support, life_exp, gov_trust) VALUES (19, 'Finland', 1, 7.769, 1.34, 0.153, 0.596, 1.587, 0.986, 0.393);<br/>INSERT INTO happiness (survey_yr, country, overall_rank, score, gdp, generosity, freedom, social_support, life_exp, gov_trust) VALUES (19, 'Denmark', 2, 7.6, 1.383, 0.252, 0.592, 1.573, 0.996, 0.41);<br/>...</span></pre><p id="d2e8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在可以通过将以下代码添加到<code class="du jn jo jp jq b">push.py</code>文件来对数据库执行sql语句</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="1007" class="ld js hh jq b fi le lf l lg lh">cur = conn.cursor()<br/>cur.execute(sql)<br/>conn.commit()<br/>cur.close()<br/>conn.close()</span></pre><p id="7980" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们创建了一个游标，执行了sql语句，提交了对数据库的更改，并关闭了游标和连接。现在是运行代码的时候了。使用<code class="du jn jo jp jq b">happiness</code>文件夹上的相同终端，运行以下程序:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="7158" class="ld js hh jq b fi le lf l lg lh">python push.py</span></pre><p id="539d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">恭喜，数据现在已经加载到PostgreSQL中了。</p><h1 id="2803" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">4.查询PostgreSQL中的数据</h1><p id="9295" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">让我们验证PostgreSQL <code class="du jn jo jp jq b">happiness</code>表中的数据是否被正确填充。用以下内容创建一个新的Python文件<code class="du jn jo jp jq b">query.py</code>(和以前一样，编辑连接<code class="du jn jo jp jq b">service uri</code>):</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="c25c" class="ld js hh jq b fi le lf l lg lh">import psycopg2</span><span id="e2e5" class="ld js hh jq b fi li lf l lg lh">conn = psycopg2.connect('&lt;SERVICE_URI_OUTPUT&gt;')</span><span id="bb7f" class="ld js hh jq b fi li lf l lg lh">cur = conn.cursor()<br/>cur.execute('''<br/>SELECT SURVEY_YR, COUNTRY, OVERALL_RANK<br/>from HAPPINESS<br/>WHERE OVERALL_RANK &lt;= 3<br/>ORDER BY SURVEY_YR, OVERALL_RANK<br/>''')</span><span id="407a" class="ld js hh jq b fi li lf l lg lh">print(cur.fetchall())<br/>cur.close()<br/>conn.close()</span></pre><p id="9518" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据<code class="du jn jo jp jq b">push.py</code>文件，我们创建一个到PostgreSQL的连接，然后执行一个查询来检查哪些国家在不同的年份中处于前三名的位置。结果应该类似于:</p><pre class="kv kw kx ky fd kz jq la lb aw lc bi"><span id="59de" class="ld js hh jq b fi le lf l lg lh">[<br/>(15, 'Switzerland', 1),   (15, 'Iceland', 2),       (15, 'Denmark', 3),<br/>(16, 'Denmark', 1),       (16, 'Switzerland', 2),   (16, 'Iceland', 3),<br/>(17, 'Norway', 1),        (17, 'Denmark', 2),       (17, 'Iceland', 3),<br/>(18, 'Finland', 1),       (18, 'Norway', 2),        (18, 'Denmark', 3),<br/>(19, 'Finland', 1),       (19, 'Denmark', 2),       (19, 'Norway', 3)<br/>]</span></pre><p id="f6ec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">看起来北欧国家是一个居住的好地方！特别要注意的是，艾文的祖国<code class="du jn jo jp jq b">Finland</code>在过去两年中一直位居榜首。</p><p id="43f8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些数据现在可以在PostgreSQL关系表中获得，可以通过所有主要的分析和报告工具进行查询和公开，使其可以被更广泛的受众访问。</p><h1 id="4576" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">包扎</h1><p id="8763" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">找到正确的数据集仅仅是开始:清理、争论和发布数据创造了帮助人们决策的信息。Python非常适合这个领域，并在数据社区中被广泛采用。博客中提到的<code class="du jn jo jp jq b">pandas</code>、<code class="du jn jo jp jq b">ddlgenerator</code>和<code class="du jn jo jp jq b">psycopg2</code>库实现了简单的数据处理和向PostgreSQL的推送。这为数据发现或公司报告打下了坚实的基础。</p><p id="e718" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">更多信息:</p><ul class=""><li id="6233" class="lk ll hh ir b is it iw ix ja lm je ln ji lo jm lp lq lr ls bi translated">L:关于艾文公司的所有信息</li><li id="8498" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated"><a class="ae ku" href="https://help.aiven.io/en/articles/489561-supported-postgresql-extensions?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=blog_art&amp;utm_content=post" rel="noopener ugc nofollow" target="_blank"> Aiven PostgreSQL支持的扩展</a>:浏览我们支持的扩展</li><li id="cb9f" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated"><a class="ae ku" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>，<a class="ae ku" href="https://github.com/catherinedevlin/ddl-generator" rel="noopener ugc nofollow" target="_blank"> ddlgenerator </a>和<a class="ae ku" href="https://www.psycopg.org/" rel="noopener ugc nofollow" target="_blank"> psycopg2 </a>:关于所用库的文档</li></ul><p id="a8aa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi">—</p><p id="6e7c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">还没有使用Aiven服务？现在就报名参加在<a class="ae ku" href="https://console.aiven.io/signup?utm_source=medium&amp;utm_medium=organic&amp;utm_campaign=blog_art&amp;utm_content=post" rel="noopener ugc nofollow" target="_blank">https://console.aiven.io/signup</a>的免费试用吧！</p><p id="235d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与此同时，请确保您关注我们的<a class="ae ku" href="https://aiven.io/changelog/" rel="noopener ugc nofollow" target="_blank"> changelog </a>和<a class="ae ku" href="https://aiven.io/blog/" rel="noopener ugc nofollow" target="_blank"> blog </a> RSS feeds或我们的<a class="ae ku" href="https://www.linkedin.com/company/aiven/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae ku" href="https://twitter.com/aiven_io" rel="noopener ugc nofollow" target="_blank"> Twitter </a>账户，了解产品和功能相关的最新消息。</p></div><div class="ab cl ly lz go ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ha hb hc hd he"><p id="c4a4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="mf">原载于</em><a class="ae ku" href="https://aiven.io/blog/the-pursuit-of-happiness-with-python-and-postgresql" rel="noopener ugc nofollow" target="_blank"><em class="mf">https://aiven . io</em></a><em class="mf">。</em></p></div></div>    
</body>
</html>