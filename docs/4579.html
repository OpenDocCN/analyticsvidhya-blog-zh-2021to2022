<html>
<head>
<title>Autoscale on AWS with EC2, Python, Flask, and Nginx Part3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EC2、Python、Flask和Nginx Part3在AWS上自动缩放</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/autoscale-on-aws-with-ec2-python-flask-and-nginx-part3-9ab0abeeeea6?source=collection_archive---------4-----------------------#2021-11-21">https://medium.com/analytics-vidhya/autoscale-on-aws-with-ec2-python-flask-and-nginx-part3-9ab0abeeeea6?source=collection_archive---------4-----------------------#2021-11-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/8a33a3c2ffc8c27b59e90495ab7fe190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XDgM41VG_gP0WCs_.jpg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">使用<a class="ae it" href="https://imgflip.com/i/5uvg9h" rel="noopener ugc nofollow" target="_blank"> Imgflip </a>生成的图像</figcaption></figure><p id="8278" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之前我们<a class="ae it" href="https://dlmade.medium.com/autoscale-on-aws-with-ec2-python-flask-and-nginx-part1-240c6bbf5c35" rel="noopener">搭建了一个EC2服务器</a>，通过Putty访问，<a class="ae it" href="https://dlmade.medium.com/autoscale-on-aws-with-ec2-python-flask-and-nginx-part2-f5640e406105" rel="noopener">用waste WSGI创建了一个Flask服务器</a>，还创建了ubuntu服务，配置了一个Nginx服务器。现在，我们将创建一个自动缩放组。</p><p id="88d4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在创建自动缩放组之前，我们需要AMI、目标组、启动模板。因此，让我们从创建AMI开始。</p><h1 id="fd25" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">阿米</strong></h1><p id="cfd5" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">AMI(Amazon机器映像)提供启动实例所需的信息。它将基本上存储我们在实例中完成的每个配置，我们将从该实例中创建AMI。</p><ul class=""><li id="229f" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">转到EC2实例，选择要为其创建映像的实例。然后点击操作→图像和模板<strong class="iw hi"> → </strong>创建图像。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/d85b00c987f78a8a10fd1926c58457b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*saU_ryBJKv98ZsQEZ9ENSw.png"/></div></div></figure><ul class=""><li id="29c2" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">给出图像名称和描述，其他的保持默认。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/a48a2bafb365957fa9a87cddbe011321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*DbjxZ-gzvojCPaTRMpldpg.png"/></div></figure><ul class=""><li id="f8d3" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">我们的形象被创造出来。现在让我们创建启动模板。</li></ul><h1 id="549d" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">启动模板</h1><ul class=""><li id="efc1" class="kv kw hh iw b ix kq jb kr jf lj jj lk jn ll jr la lb lc ld bi translated">启动模板将告诉我们的auto scale组使用AMI启动每个新实例，这些实例是我们之前使用给定的一组指令(如实例类型和网络设置)创建的。</li><li id="8ce8" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr la lb lc ld bi translated">在EC2仪表板的左侧，您可以看到点击启动模板。根据您的选择给出模板名称和版本。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/a8a9b2e27077cb7d5a71d2af7515d6ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*nyVq66LEcqCpB3sN5ecq_Q.png"/></div></figure><ul class=""><li id="7e76" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">转到AMI部分。您必须选择我们之前创建的图像。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/142a58279ea5e95ac8963411aed5153f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*PeVWwzWUwcedrZ3T-VmPgw.png"/></div></figure><ul class=""><li id="ac08" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">要选择图像，您只需在搜索框中键入您的图像名称，您的图像将出现在“我的AMIs”部分。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/8bdd222c817e20c6b5f462b52ab65a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*EwfjvQHmJvqkFg0Yv1rrxw.png"/></div></figure><ul class=""><li id="6fdd" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">现在向下滚动，您将看到实例类型和密钥对部分。根据您的选择选择实例类型和密钥对。每当创建一个新实例时，它将使用这个实例类型和密钥对文件。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/70bf6658b00aff320b083b41482e40dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*11wjmauCFB_SOjYhvZ0fqg.png"/></div></figure><ul class=""><li id="b062" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">在网络设置中，请确保您将选择我们在第一部分中创建的安全组。这将启用ssh和HTTP规则，否则您将无法通过互联网或SSH(如putty)访问您的实例。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/2e3ea0ad06ee0b3fcf18daf3e04703a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*nNC_k09hOOG0yztO-dlJzA.png"/></div></figure><ul class=""><li id="df60" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">保留所有默认设置，然后单击创建启动模板。我们的发布模板已经准备好，让我们继续关注目标群体。这将帮助负载平衡器将流量路由到自动缩放组中创建的所有实例。</li></ul><h1 id="3c46" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">目标群</h1><ul class=""><li id="c1d3" class="kv kw hh iw b ix kq jb kr jf lj jj lk jn ll jr la lb lc ld bi translated">您可以在ec2仪表板的负载平衡部分找到目标组。这里我们将选择目标类型作为实例，因为我们是为ec2创建的。根据您的选择给出目标组名称，然后单击下一步。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/ddd44ce7a3b0db9b000969bdc3ad25a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*y6WMDtOaNUokWbLiN5QyCw.png"/></div></figure><ul class=""><li id="a0d7" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">选择您创建的ec2实例的第一部分。现在，单击下面的“包括为待定”。它将在这个目标组中注册我们的实例。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/1b61ad1c0a02fdc7da979f1cb66c3ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*AQPnKsjJvHdOJYbGzI09KA.png"/></div></figure><ul class=""><li id="6ab1" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">向下滚动一点，您会看到在目标组中注册了一个实例。点击创建目标组。至此，我们已经创建了一个启动模板、AMI和目标组，现在我们拥有了自动缩放组所需的所有东西。</li></ul><h1 id="f224" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">自动缩放组</strong></h1><ul class=""><li id="3c6a" class="kv kw hh iw b ix kq jb kr jf lj jj lk jn ll jr la lb lc ld bi translated">您可以在EC2仪表板左侧底部的自动缩放部分找到自动缩放组。单击自动缩放组，然后单击创建自动缩放组。</li><li id="ed2b" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr la lb lc ld bi translated">首先，输入您选择的自动缩放组名称。选择我们之前创建的发布模板，并确保发布模板的版本是最新的。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/809264b495ba34e02b64497151d22534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*-PVe4maGwbBGCS5zt0GCRg.png"/></div></figure><ul class=""><li id="442b" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">选择创建实例时使用的VPC。选择所有可用性区域。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/fd37d4459b4cb8d9824e2326bfdd566f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Al_nQEN4QIyt_5fhXK3c0g.png"/></div></figure><ul class=""><li id="5d90" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">现在，我们将创建我们的负载平衡器，并包括我们的目标群体。选择“Attach new load balancer”单选按钮，并将负载平衡器类型设置为“Application load balancer ”,因为我们将控制HTTP和HTTPS流量。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/42eb9ccdc327ee701090a51c4280cfa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*0ZgYCTVR1ZO-UkErm06-9Q.png"/></div></figure><ul class=""><li id="aeff" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated"><strong class="iw hi">负载均衡器</strong></li></ul><ol class=""><li id="5f83" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr lr lb lc ld bi translated">根据您的选择创建负载平衡器名称。</li><li id="e47e" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr lr lb lc ld bi translated">选择负载平衡器方案和面向互联网，因为我们希望我们的客户访问应用程序。</li><li id="1bdd" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr lr lb lc ld bi translated">选择与我们之前创建的实例相同的VPC和可用性区域。</li><li id="649c" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr lr lb lc ld bi translated">在监听器和路由中，选择我们之前创建的目标组。</li><li id="c36d" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr lr lb lc ld bi translated">单击下一步。</li></ol><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/2a216a64b96ad1cbdd64028d479b14c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*F6XlITQNjitFk8RM87dHtg.png"/></div></figure><ul class=""><li id="2bbf" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">在组大小中，我们可以根据我们的要求选择所需的服务器容量。出于演示目的，我将保持所需容量为1，最小容量为1，最大容量为2。</li><li id="08d4" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr la lb lc ld bi translated">扩展策略是一个指标，它将告诉自动扩展组何时增加或减少服务器。在这里，我们保持50%的CPU利用率阈值。因此，如果CPU利用率超过50%，它将添加一个新实例；或者，如果我们的实例数量超过了最低要求，而CPU利用率低于50%，它将减少实例数量。预热秒数是指直到您的实例利用率达到阈值并保持在该阈值以上的时间，然后自动缩放组将增加/减少实例。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/6bc65f82000e1fdfa0a9fda111300080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*pGETO3dUprLwp6gN1FSbmQ.png"/></div></figure><ul class=""><li id="487c" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">将所有步骤保留为默认，检查并启动自动缩放组。</li><li id="1a80" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr la lb lc ld bi translated">这就是我们已经创建的自动缩放组。现在让我们来验证它是如何工作的。</li></ul><h1 id="77cf" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">访问站点</strong></h1><ul class=""><li id="6b03" class="kv kw hh iw b ix kq jb kr jf lj jj lk jn ll jr la lb lc ld bi translated">要访问您的站点，您可以转到负载平衡器→选择负载平衡器→复制DNS名称→粘贴到您的浏览器中。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/b3e4b2b596742bf96a9a47a3b0079228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*ZRBAeAuxTFx3h-t24YkMlA.png"/></div></figure><ul class=""><li id="c52b" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">如果您无法访问该网站，请确保您尝试使用HTTPS和HTTP的DNS名称。如果不起作用，请尝试将负载平衡器的安全组更改为与实例安全组相同的组。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/3501ef966b14a90e8ec60a7233a6b331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*_4Fe4r_nek6ufHLz9RLzBw.png"/></div></figure><ul class=""><li id="0d6c" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">对于更改安全组，选择负载平衡器，然后向下滚动，您将获得一个安全组选项。</li></ul><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es le"><img src="../Images/ff373922035ba247fdf24d2e458f2097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*Y3S2QTiN8P0lQmKMoZHpNw.png"/></div></figure><ul class=""><li id="bb04" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">为了检查auto-scale的性能，让我们在站点上创建一些人工负载。这里有很多选项你可以找到<a class="ae it" href="https://geekflare.com/web-performance-benchmark/" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="76cd" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr la lb lc ld bi translated">我将使用<strong class="iw hi"> Apache基准测试</strong>。我们将向100个并发用户发送10000个请求。结果将保存在test1.txt文件中。</li></ul><pre class="lf lg lh li fd ls lt lu lv aw lw bi"><span id="b3c0" class="lx jt hh lt b fi ly lz l ma mb">ab -n 100000 -c 100 load_balancer_dns_name &gt; test1.txt</span></pre><ul class=""><li id="096e" class="kv kw hh iw b ix iy jb jc jf kx jj ky jn kz jr la lb lc ld bi translated">它将产生15–20%的CPU使用率。您可以将自动缩放CPU使用率参数更改为10%，以便进行验证。</li><li id="ab71" class="kv kw hh iw b ix lm jb ln jf lo jj lp jn lq jr la lb lc ld bi translated">要检查CPU使用情况，请运行以下命令。哪个命令将显示每秒钟的CPU使用百分比</li></ul><pre class="lf lg lh li fd ls lt lu lv aw lw bi"><span id="d2ef" class="lx jt hh lt b fi ly lz l ma mb">mpstat 1</span></pre><p id="835b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你喜欢这篇文章，点击给我买杯咖啡！感谢阅读。</p><figure class="lf lg lh li fd ii er es paragraph-image"><a href="https://www.payumoney.com/paybypayumoney/#/147695053B73CAB82672E715A52F9AA5"><div class="er es mc"><img src="../Images/d1500c2f9e74d7f54553250f9445e8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*RPDyXqHjKKbesbJgLZ96mQ.png"/></div></a></figure><p id="48f8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你的每一个小小的贡献都会鼓励我创造更多这样的内容。</p></div></div>    
</body>
</html>