# æ–°å† è‚ºç‚:åŸºäº TensorFlow å’Œ OpenCV çš„äººè„¸é¢å…·æ£€æµ‹ç³»ç»Ÿ

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/covid-19-face-mask-detection-system-with-tensorflow-and-opencv-1bd19a14125e?source=collection_archive---------1----------------------->

# å…³äºæˆ‘

å—¨ï¼Œæˆ‘æ˜¯ Vishal S Rï¼Œæˆ‘ä½åœ¨é’¦å¥ˆï¼Œæˆ‘æ˜¯ä¸€åæœ€åä¸€å¹´çš„ B-Tech è®¡ç®—æœºç§‘å­¦å­¦ç”Ÿã€‚æˆ‘ä¸“æ”»æœºå™¨å­¦ä¹ ã€‚æˆ‘éå¸¸ç›¸ä¿¡è‡ªå­¦ã€‚æˆ‘æŠŠæ¯ä¸ªé—®é¢˜éƒ½è§†ä¸ºæ¢ç´¢æ–°äº‹ç‰©çš„æœºä¼šã€‚

LinkedIn:[*vishalsr*](http://www.linkedin.com/in/vishalsr)

Github: [vishal-sr](https://github.com/vishal-sr)

insta gram:[vishal . Sr_](https://www.instagram.com/vishal.sr_)

é¡¹ç›®å›è´­:[Github å›è´­ ](https://github.com/vishal-sr/AI-in-Healthcare/tree/main/Face%20Mask%20Detection)

# ç›®å½•

1.  æ‘˜è¦
2.  æ–¹æ³•å­¦
3.  æ•°æ®å’Œé¢„å¤„ç†
4.  å±¥è¡Œ
5.  ä»£ç ğŸ˜ğŸ‘¨â€ğŸ’»
6.  ç»“è®º

# æ‘˜è¦

ä¸–ç•Œå¼€å§‹å…³æ³¨äººå·¥æ™ºèƒ½çš„å¥½å¤„ï¼Œè€Œä¸æ˜¯å®ƒçš„å¯ç¤ºã€‚äººä»¬å¼€å§‹ä½¿ç”¨äººå·¥æ™ºèƒ½è§£å†³å¤æ‚çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ã€‚æˆ‘ç ”ç©¶äº†æ£€æµ‹å’Œåˆ†ç±»ä¸€ä¸ªäººæ˜¯å¦æˆ´å£ç½©çš„é—®é¢˜ã€‚éšç€è¿™ä¸ªç–«æƒ…æˆä¸º ***æ–°å¸¸æ€*** æˆ´å£ç½©å¾ˆé‡è¦ï¼Œå¹¶ç¡®è®¤æˆ‘ä»¬å‘¨å›´çš„äººæ˜¯å¦æˆ´å£ç½©ã€‚è®©æˆ‘ä»¬è®©äººå·¥æ™ºèƒ½æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ç”¨äº†ä¸¤æ­¥æµæ°´çº¿æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

# æ–¹æ³•å­¦

æ­£å¦‚æˆ‘æåˆ°çš„ï¼Œè¿™ä¸ªé¡¹ç›®åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†ä¸¤æ­¥ç®¡é“çš„è®¾è®¡ã€‚

![](img/89d2dc4294844e3ea7ae2a3f5ceff19f.png)

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ç³»ç»Ÿå¦‚ä½•æ£€æµ‹äººè„¸å¹¶åˆ†ç±»äººè„¸æ˜¯å¦åŒ…å«äººè„¸é¢å…·ã€‚

ä»è§†é¢‘æ•è·ä¸­ï¼Œæˆ‘ä½¿ç”¨ OpenCV è·å–äº†ä¸€ä¸ªå•ç‹¬çš„å¸§ï¼Œå¹¶å°†è·å–çš„å¸§ä¼ é€’ç»™ Viola-Jones äººè„¸æ£€æµ‹å™¨(HaarCascade äººè„¸æ£€æµ‹å™¨)ã€‚åœ¨æ£€æµ‹å™¨æ£€æµ‹åˆ°äººè„¸åï¼Œæˆ‘è£å‰ªäº†äººè„¸ ROI(æ„Ÿå…´è¶£åŒºåŸŸ),å¹¶å°†å…¶ä¼ é€’åˆ°æµè¡Œçš„ CNN æ¶æ„ VGG16 ä¸­ï¼Œä»¥åˆ†ç±»äººè„¸ ROI æ˜¯å¦åŒ…å«äººè„¸é®ç½©ã€‚ä¹‹åï¼Œä½¿ç”¨æ¥è‡ª Viola-Jones æ£€æµ‹å™¨çš„åæ ‡å’Œæ¥è‡ª VGG16 æ¨¡å‹çš„ç±»åˆ«æ¦‚ç‡ï¼Œæˆ‘åˆ†åˆ«ä¸ºæ‰€æœ‰å¯èƒ½çš„äººè„¸åŠå…¶ç±»åˆ«æ¦‚ç‡ç»˜åˆ¶äº†è¾¹ç•Œæ¡†ã€‚

# æ•°æ®å’Œé¢„å¤„ç†

æˆ‘ä»[***Github repo***](http://github.com/balajisrinivas/Face-Mask-Detection/tree/master/dataset)ä¸­æ”¶é›†äº†æ•°æ®ï¼Œå…¶ä¸­åŒ…å«äº†æˆ´é¢å…·å’Œä¸æˆ´é¢å…·çš„äººè„¸å›¾åƒã€‚åœ¨è®­ç»ƒ VGG16 ç½‘ç»œä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚è·å–å’Œé¢„å¤„ç†æ•°æ®çš„æ­¥éª¤å¦‚ä¸‹:

## å¯¼èˆªåˆ°æ•°æ®é›†æ–‡ä»¶å¤¹å¹¶åˆ›å»ºç±»åˆ«ã€æ ‡ç­¾å­—å…¸:

è·å–å›¾åƒæ–‡ä»¶å¤¹(å¸¦é¢ç½©çš„äººè„¸æ–‡ä»¶å¤¹å’Œä¸å¸¦é¢ç½©çš„äººè„¸æ–‡ä»¶å¤¹)å¹¶åˆ›å»ºç±»åˆ«å’Œæ ‡ç­¾å­—å…¸ã€‚

```
Main folder
    - with_mask
          -- images
          .
          .
    - without_mask
          -- images
          .
          .
```

## ä»å­æ–‡ä»¶å¤¹ä¸­è·å–å›¾åƒå¹¶å¯¹å…¶è¿›è¡Œé¢„å¤„ç†:

ä½¿ç”¨ OpenCV å•ç‹¬è·å–æ¯å¼ å›¾åƒå¹¶æ‰§è¡Œä¸€äº›é¢„å¤„ç†æ­¥éª¤ï¼Œ

1.  å°† BGR å›¾åƒè½¬æ¢ä¸º RGB æ ¼å¼çš„ cv2.imread()å‡½æ•°å°†å›¾åƒè¯»å–ä¸º BGRã€‚
2.  å°†å›¾åƒå¤§å°è°ƒæ•´ä¸º 160 x 160 x 3ã€‚
3.  å°†å›¾åƒè½¬æ¢æˆ NumPy çŸ©é˜µã€‚
4.  å°†æ‰€æœ‰åƒç´ ä» 0 é‡æ–°è°ƒæ•´åˆ° 1
5.  å°†å›¾åƒçŸ©é˜µçš„å¤§å°è°ƒæ•´ä¸º#imagesï¼Œ160ï¼Œ160ï¼Œ3ã€‚
6.  å°†ç›®æ ‡æ ‡ç­¾è½¬æ¢æˆä¸€ä¸ªçƒ­ç‚¹å‘é‡ã€‚
7.  åˆ†ä¸ºè®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚

# å±¥è¡Œ

å½“æˆ‘ä»¬æœ‰ç®¡é“ã€æ•°æ®å’Œè§£å†³é—®é¢˜çš„æ–¹æ³•æ—¶ï¼Œå®ç°æ•´ä¸ªæ£€æµ‹ç³»ç»Ÿæ˜¯å®¹æ˜“çš„ã€‚æ¥è¿‘çš„æ­¥éª¤ï¼Œ

1.  å¯¼å…¥æ‰€éœ€çš„åº“å’Œæ¡†æ¶
2.  æ•°æ®å’Œé¢„å¤„ç†
3.  å»ºæ¨¡
4.  æ¨¡ç‰¹åŸ¹è®­
5.  ä¼°ä»·
6.  æŠŠæ‰€æœ‰çš„æ”¾åœ¨ä¸€èµ·

## å¯¼å…¥æ‰€éœ€çš„åº“å’Œæ¡†æ¶

è¦å®ç°æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆé€‰æ‹©æ‰€éœ€çš„åº“ã€‚

```
import os
import cv2
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report, confusion_matrix
from tensorflow.keras.applications.vgg16 import VGG16
from tensorflow.keras.layers import Input, Dense, Flatten
from tensorflow.keras.models import Model, load_model
from tensorflow.keras.preprocessing.image import ImageDataGenerator
from tensorflow.keras.utils import to_categorical
```

## æ•°æ®å’Œé¢„å¤„ç†

æ•°æ®å’Œæ‰€æœ‰é¢„å¤„ç†æ­¥éª¤åœ¨ä¸Šä¸€èŠ‚ä¸­è®¨è®ºè¿‡ã€‚

## å»ºæ¨¡

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘å®šä¹‰äº†ä¸¤ä¸ªæ¨¡å‹ï¼Œä¸€ä¸ªç”¨äºæ£€æµ‹äººè„¸ï¼Œå¦ä¸€ä¸ªç”¨äºå¯¹æ£€æµ‹åˆ°çš„äººè„¸è¿›è¡Œåˆ†ç±»ã€‚

1.  äººè„¸æ£€æµ‹å™¨
2.  é¢ç½©åˆ†ç±»å™¨

**äººè„¸æ£€æµ‹å™¨:**

ä¸ºäº†æ£€æµ‹äººè„¸ï¼Œæˆ‘ä½¿ç”¨äº† Viola-Jones äººè„¸æ£€æµ‹ç®—æ³•ã€‚å®ƒå°†è§†é¢‘å¸§ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç»™æˆ‘å¯èƒ½çš„é¢éƒ¨åæ ‡ã€é¢éƒ¨é«˜åº¦å’Œå®½åº¦ã€‚

```
faceCascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')
```

**å£ç½©åˆ†ç±»å™¨:**

å¯¹äºäººè„¸é¢å…·åˆ†ç±»å™¨ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ç§æµè¡Œçš„æŠ€æœ¯ï¼Œç§°ä¸º VGG16 CNN æ¶æ„çš„è½¬ç§»å­¦ä¹ ã€‚

> è¿ç§»å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ ä¸­çš„ä¸€ç§æŠ€æœ¯ï¼Œå…¶ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®å‰ªé¡¶å±‚(å®Œå…¨è¿æ¥çš„å±‚)æ¥ä½¿ç”¨åœ¨å¤§å‹æ•°æ®é›†ä¸Šè®­ç»ƒçš„é¢„è®­ç»ƒ CNN æ¨¡å‹è¿›è¡Œæ£€æµ‹æˆ–åˆ†ç±»é—®é¢˜ã€‚åº•å±‚(å·ç§¯å±‚æˆ–æ‰å¹³åŒ–å±‚ä»¥ä¸‹)ç”¨äºç‰¹å¾æå–ï¼Œæˆ‘ä»¬æ–°æ·»åŠ çš„å…¨è¿æ¥å±‚ç”¨äºåˆ†ç±»ã€‚

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘åœ¨ ImageNet ä¸Šçš„é¢„è®­ç»ƒ VGG16 ä¸Šä½¿ç”¨äº†è¿ç§»å­¦ä¹ æŠ€æœ¯ï¼Œå¹¶æ·»åŠ äº† 64 ä¸ªå•å…ƒä½œä¸ºå®Œå…¨è¿æ¥å±‚(ReLU æ¿€æ´»)å’Œ 2 ä¸ªå•å…ƒä½œä¸ºè¾“å‡ºå±‚(Softmax æ¿€æ´»)ã€‚åœ¨æˆ‘ä»¬çš„æ¨¡å‹ä¸­ï¼Œåªæœ‰æœ€åä¸¤ä¸ªå±‚è¢«è®¾ç½®ä¸ºåœ¨æˆ‘ä»¬çš„æ•°æ®é›†ä¸Šè®­ç»ƒ(å¸¦ _mask å’Œä¸å¸¦ _mask ),å› ä¸ºæ‰€æœ‰å…¶ä»–å±‚éƒ½æ˜¯é¢„è®­ç»ƒçš„ã€‚

```
Model: "model" _________________________________________________________________ Layer (type)                 Output Shape              Param #    ================================================================= input_1 (InputLayer)         [(None, 160, 160, 3)]     0          _________________________________________________________________ block1_conv1 (Conv2D)        (None, 160, 160, 64)      1792       _________________________________________________________________ block1_conv2 (Conv2D)        (None, 160, 160, 64)      36928      _________________________________________________________________ block1_pool (MaxPooling2D)   (None, 80, 80, 64)        0          _________________________________________________________________ block2_conv1 (Conv2D)        (None, 80, 80, 128)       73856      _________________________________________________________________ block2_conv2 (Conv2D)        (None, 80, 80, 128)       147584     _________________________________________________________________ block2_pool (MaxPooling2D)   (None, 40, 40, 128)       0          _________________________________________________________________ block3_conv1 (Conv2D)        (None, 40, 40, 256)       295168     _________________________________________________________________ block3_conv2 (Conv2D)        (None, 40, 40, 256)       590080     _________________________________________________________________ block3_conv3 (Conv2D)        (None, 40, 40, 256)       590080     _________________________________________________________________ block3_pool (MaxPooling2D)   (None, 20, 20, 256)       0          _________________________________________________________________ block4_conv1 (Conv2D)        (None, 20, 20, 512)       1180160    _________________________________________________________________ block4_conv2 (Conv2D)        (None, 20, 20, 512)       2359808    _________________________________________________________________ block4_conv3 (Conv2D)        (None, 20, 20, 512)       2359808    _________________________________________________________________ block4_pool (MaxPooling2D)   (None, 10, 10, 512)       0          _________________________________________________________________ block5_conv1 (Conv2D)        (None, 10, 10, 512)       2359808    _________________________________________________________________ block5_conv2 (Conv2D)        (None, 10, 10, 512)       2359808    _________________________________________________________________ block5_conv3 (Conv2D)        (None, 10, 10, 512)       2359808    _________________________________________________________________ block5_pool (MaxPooling2D)   (None, 5, 5, 512)         0          _________________________________________________________________ flatten (Flatten)            (None, 12800)             0          _________________________________________________________________ dense_1 (Dense)              (None, 64)                819264     _________________________________________________________________ dense (Dense)                (None, 2)                 130        ================================================================= Total params: 15,534,082 
Trainable params: 819,394 
Non-trainable params: 14,714,688 _________________________________________________________________
```

## **æ¨¡å‹è®­ç»ƒ(äººè„¸é¢å…·åˆ†ç±»å™¨):**

æˆ‘ä»¬çš„æ¨¡å‹åœ¨æˆ‘ä»¬ä¹‹å‰é¢„å¤„ç†çš„å›¾åƒæ•°æ®é›†çš„ ImageDataGenerator()ä¸Šè®­ç»ƒã€‚

```
datagen = ImageDataGenerator(
      rotation_range=15,
      zoom_range = 0.15,
      width_shift_range=0.1,
      height_shift_range=0.1)
```

è®­ç»ƒå±æ€§å’Œè¶…å‚æ•°:

*   æŸå¤±å‡½æ•°â€”åˆ†ç±»äº¤å‰ç†µ
*   ä¼˜åŒ–å™¨â€” Adam(è‡ªé€‚åº”çŸ©ä¼°è®¡)
*   çºªå…ƒâ€” 11

```
Epoch 1/11 loss: 0.2238 - accuracy: 0.9185 - val_loss: 0.0804 - val_accuracy: 0.9661 
Epoch 2/11 loss: 0.0576 - accuracy: 0.9801 - val_loss: 0.0729 - val_accuracy: 0.9713 
Epoch 3/11 loss: 0.0534 - accuracy: 0.9808 - val_loss: 0.0807 - val_accuracy: 0.9869 
Epoch 4/11 loss: 0.0397 - accuracy: 0.9840 - val_loss: 0.0724 - val_accuracy: 0.9765 
Epoch 5/11 loss: 0.0503 - accuracy: 0.9801 - val_loss: 0.0753 - val_accuracy: 0.9817 
Epoch 6/11 loss: 0.0339 - accuracy: 0.9850 - val_loss: 0.0879 - val_accuracy: 0.9765 
Epoch 7/11 loss: 0.0274 - accuracy: 0.9902 - val_loss: 0.0805 - val_accuracy: 0.9791 
Epoch 8/11 loss: 0.0351 - accuracy: 0.9889 - val_loss: 0.1267 - val_accuracy: 0.9582 
Epoch 9/11 loss: 0.0485 - accuracy: 0.9856 - val_loss: 0.0778 - val_accuracy: 0.9843 
Epoch 10/11 loss: 0.0180 - accuracy: 0.9945 - val_loss: 0.0712 - val_accuracy: 0.9765 
Epoch 11/11 loss: 0.0172 - accuracy: 0.9941 - val_loss: 0.0987 - val_accuracy: 0.9791
```

## è¯„ä¼°(é¢ç½©åˆ†ç±»å™¨):

åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨ä¸‰ä¸ªåº¦é‡æˆ–å‡½æ•°æ¥è¯„ä¼°æ¨¡å‹ï¼Œ

1.  å‡†ç¡®(æ€§)
2.  æ··æ·†çŸ©é˜µ
3.  åˆ†ç±»æŠ¥å‘Š
4.  ç»˜åˆ¶æŸè€—å’Œç²¾ç¡®åº¦

**ç²¾åº¦:**

åœ¨ç¬¬ 11 ä¸ªçºªå…ƒç»“æŸæ—¶ï¼Œæˆ‘ä»¬çš„æ¨¡å‹è·å¾—äº†ï¼Œ

*   99.41%çš„è®­ç»ƒå‡†ç¡®ç‡ï¼Œ
*   97.91%çš„éªŒè¯å‡†ç¡®æ€§ï¼Œä»¥åŠ
*   99.21%çš„æµ‹è¯•å‡†ç¡®ç‡ã€‚

```
correct = 0
total = 0
pred = np.argmax(model.predict(X_test), axis=1)
for i, img in enumerate(pred):
      if img == np.argmax(y_test[i]):
            correct += 1
      total += 1print(correct/total * 100)
```

**æ··æ·†çŸ©é˜µ:**

ä»æµ‹è¯•é›†(384 ä¸ªæ ·æœ¬)ä¸Šçš„æ··æ·†çŸ©é˜µä¸­ï¼Œæˆ‘è·å¾—äº†ï¼Œ

*   çœŸé˜³æ€§å’ŒçœŸé˜´æ€§åˆ†åˆ«æ˜¯ 200 å’Œ 181ï¼Œ
*   å‡é˜³æ€§å’Œå‡é˜´æ€§åˆ†åˆ«ä¸º 1 å’Œ 2ã€‚

```
cm = confusion_matrix(
      np.argmax(model.predict(X_test), axis=1), 
      np.argmax(y_test, axis = 1)
     )
print(cm)
```

**åˆ†ç±»æŠ¥å‘Š:**

![](img/5b4c33f2b42c8c72951d1fac04e791c8.png)

```
cr = classification_report(
      np.argmax(model.predict(X_test), axis=1), 
      np.argmax(y_test, axis = 1)
     )
print(cr)
```

**æ ‡ç»˜æŸå¤±å’Œç²¾åº¦:**

![](img/4223b042c92f5a85c7324ec282d45edf.png)

```
plt.plot(np.arange(0, 11), 
      history.history['val_loss'], label='val_loss')
plt.plot(np.arange(0, 11), 
      history.history['loss'], label = 'loss')
plt.plot(np.arange(0, 11), 
      history.history['accuracy'], label = 'accuracy')
plt.plot(np.arange(0, 11), 
      history.history['val_accuracy'], label = 'val_accuracy')
plt.legend()
plt.show()
```

## ç»¼ä¸Šæ‰€è¿°:

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„ç³»ç»Ÿçš„å·¥ä½œæµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»è§†é¢‘æº(è§†é¢‘é“¾æ¥ï¼Œç½‘ç»œæ‘„åƒå¤´ç­‰)æ•æ‰å¸§ã€‚)å¹¶å¤„ç†å›¾åƒ(ä» BGR è½¬æ¢ä¸ºç°åº¦)ã€‚å°†å¤„ç†åçš„å›¾åƒä¼ å…¥ Viola-Jones äººè„¸æ£€æµ‹å™¨ï¼Œå¹¶è·å–å¯èƒ½äººè„¸çš„åæ ‡ã€‚åœ¨å¾—åˆ°äººè„¸çš„åæ ‡åï¼Œæˆ‘è£å‰ªäº†äººè„¸ ROI(æ„Ÿå…´è¶£åŒºåŸŸ),å¹¶å°†äººè„¸ ROI ä¼ é€’åˆ° VGG16 äººè„¸é®ç½©åˆ†ç±»å™¨ä¸­ã€‚VGG16 æ¨¡å‹è¿”å›äººè„¸ ROI æ˜¯å¦åŒ…å«äººè„¸é®ç½©ï¼Œä»¥åŠå®ƒä»¬çš„åˆ†ç±»æ¦‚ç‡ã€‚æ ¹æ® Viola-Jones å’Œ VGG16 æ¨¡å‹çš„ç»“æœï¼Œæˆ‘ä½¿ç”¨ OpenCV ç¼–ç¨‹ç»˜åˆ¶äº†å®ƒä»¬çš„ç±»æ¦‚ç‡çš„è¾¹ç•Œæ¡†å’Œæ–‡æœ¬ã€‚

## ä»£ç ğŸ˜ğŸ‘¨â€ğŸ’»

# ç»“è®º

ä¸€ä¸ªäººå·¥æ™ºèƒ½ç³»ç»Ÿè¢«æˆåŠŸåœ°è§„åˆ’ã€æ„å»ºã€è¯„ä¼°å’Œæµ‹è¯•ï¼Œä»¥å‘ç°ä¸€ä¸ªäººæ˜¯å¦æˆ´ç€é¢ç½©ã€‚æˆ‘æ‰€æœ‰çš„é¡¹ç›®ä»£ç å’Œæ•°æ®é›†éƒ½ä¸Šä¼ åˆ°äº† [Github](https://github.com/vishal-sr/AI-in-Healthcare/tree/main/Face%20Mask%20Detection) ã€‚