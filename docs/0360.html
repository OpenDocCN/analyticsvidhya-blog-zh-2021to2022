<html>
<head>
<title>Customer Segmentation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">客户细分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/customer-segmentation-23cb8dddb298?source=collection_archive---------17-----------------------#2021-01-13">https://medium.com/analytics-vidhya/customer-segmentation-23cb8dddb298?source=collection_archive---------17-----------------------#2021-01-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="9d96" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开发一个预测客户行为的模型，并将其应用于其他客户群。幸运的是，该模型将允许公司精心挑选最有可能购买该产品的客户，排除无响应者，从而使下一次活动利润丰厚。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><p id="8992" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该数据集包含约2，240名联系过的客户的社会人口统计和公司地理特征。此外，它还包含一个针对那些通过购买产品来响应活动的客户的标志。</p><ul class=""><li id="699c" class="jj jk hh ig b ih ii il im ip jl it jm ix jn jb jo jp jq jr bi translated">在这个项目中，进行RFM计算是为了理解应该如何对客户进行分类。</li><li id="0648" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">然后使用朴素贝叶斯算法建立预测分类模型。</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es jx"><img src="../Images/fb61486d7e44888709aab8766a763539.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*YmVKoGQdTTjQEVX_3wYZWA.gif"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">是的，我们将使用RFM分析和机器学习！</figcaption></figure><h1 id="e9e4" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">首先要做的是建立RFM代码</h1><pre class="jy jz ka kb fd lh li lj bn lk ll bi"><span id="48dd" class="lm kk hh li b be ln lo l lp lq"># value spent on products<br/>dados$mont &lt;- dados$MntFishProducts+dados$MntFruits+<br/>              dados$MntGoldProds+dados$MntMeatProducts+<br/>              dados$MntSweetProducts+dados$MntWines<br/># amount of purchases<br/>dados$num &lt;- dados$NumCatalogPurchases+dados$NumDealsPurchases+<br/>             dados$NumStorePurchases+dados$NumWebPurchases<br/>customers_RFM = sqldf(<br/>    "SELECT ID,<br/>            MIN(Recency) AS 'Recency',<br/>            Sum(num) AS 'Frequency',<br/>            SUM(mont) AS 'Monetary'<br/>        FROM dados<br/>        GROUP BY 1"<br/>)<br/>customers_RFM %&gt;% <br/>  head(10) %&gt;% <br/>      formattable::formattable()</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lr"><img src="../Images/1a4bbed04eb285ebd06348fe8ea61b86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kv_1mdnYieoQ6a3HvDsTeg.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">输出将是这样的</figcaption></figure><h1 id="5879" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">为了评估RFM参数的分布，我们可以使用直方图</h1><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lw"><img src="../Images/3e3f6447197e763a449fee6076dea6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xULmpLCuW6zjlzer6Z-lJA.png"/></div></div></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lx"><img src="../Images/e54efda3f7e61d971f22a26c2313eb57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cnH840mi1lb-qhEig9MpcA.png"/></div></div></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ly"><img src="../Images/98e3524c31ce634bd3b00b77b769c7be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kHJv9FO9I8iHMTRSb0Awog.png"/></div></div></figure><h1 id="2bd0" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">现在让我们看看百分位数</h1><p id="8da5" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">分析客户最后一次购买是多少天，我们可以看到:</p><ul class=""><li id="71c0" class="jj jk hh ig b ih ii il im ip jl it jm ix jn jb jo jp jq jr bi translated">过去19天购买的前20名客户；</li><li id="c76c" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">接下来的20%的客户购买时间在19到39天之间；</li><li id="b071" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">而最后20%的顾客在超过79天的时间里没有进行任何购买。</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es me"><img src="../Images/271dd1bebf26fe5bb5076760736a7013.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*uezxEGPkac9IYSYOiKwFew.png"/></div></figure><p id="1071" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">至于他们购买的频率，我们可以看到:</p><ul class=""><li id="682d" class="jj jk hh ig b ih ii il im ip jl it jm ix jn jb jo jp jq jr bi translated">在审查期间，前20名客户购买次数超过22次；</li><li id="e4b7" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">以下20%的客户购买次数在17-22次之间；</li><li id="dc07" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">最后20%的顾客在审查期间购买了7次。</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mf"><img src="../Images/51bc39e14d913a768970e879647a6d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*NUbfLydAvXoH4DHLk36Xnw.png"/></div></figure><p id="414a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">至于客户花费的金额，我们可以看到:</p><ul class=""><li id="1c17" class="jj jk hh ig b ih ii il im ip jl it jm ix jn jb jo jp jq jr bi translated">前20名客户平均消费超过1174.00美元(货币单位)；</li><li id="e096" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">接下来的20%的顾客花费在635.4到1174.00美元之间，而最后的20%的顾客平均花费不到55.00美元。</li></ul><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mg"><img src="../Images/af78f48320abbbfa7a06026eaa3c2fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*wKjXic8qNe0vAIyXtctt7A.png"/></div></figure><h1 id="0918" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">RFM分数</h1><pre class="jy jz ka kb fd lh li lj bn lk ll bi"><span id="cad8" class="lm kk hh li b be ln lo l lp lq">rfm_data &lt;- customers_RFM<br/>rfm_data &lt;- rfm_data %&gt;%<br/>    mutate(<br/>        R = ntile(desc(Recency), 5),<br/>        F = ntile(Frequency, 5),<br/>        M = ntile(Monetary, 5)<br/>    )<br/>rfm_data$RFM &lt;- rfm_data$R * 100 + rfm_data$F * 10 + rfm_data$M<br/>rfm_data %&gt;% <br/>  head(10) %&gt;% <br/>      formattable::formattable()</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mh"><img src="../Images/2e7df35363eca2d467e78db02bd1f85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orFFVS4ccIufvih4n1RlBw.png"/></div></div></figure><p id="1957" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，具有高RFM分数的客户对变量Recency的值较低，对变量Frequency和Monetary的值较高，例如ID = 25，而具有低RFM分数的客户对变量Recency的值较高，对变量Frequency的值较高，例如ID = 17。因此，对于具有中等RFM分值的客户，他们需要更仔细的分析。如下文将会看到的。</p><h1 id="16a3" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">客户细分</h1><pre class="jy jz ka kb fd lh li lj bn lk ll bi"><span id="c793" class="lm kk hh li b be ln lo l lp lq">rfm_data$segment &lt;- NA<br/>rfm_data$segment[which(rfm_data$RFM == 111)] &lt;- 'Lost'<br/>rfm_data$segment[which(rfm_data$RFM &gt; 111)] &lt;- 'Hibernating'<br/>rfm_data$segment[which(rfm_data$RFM &gt;= 222)] &lt;- 'About to sleep'<br/>rfm_data$segment[which(rfm_data$RFM &gt;= 333)] &lt;- 'Potential loyalist'<br/>rfm_data$segment[which(rfm_data$RFM &gt;= 444)] &lt;- 'Champion'<br/># 2nd round<br/>rfm_data$segment[which(rfm_data$segment == 'Potential loyalist' &amp;<br/>                           (rfm_data$F &gt;= 4))] &lt;- 'Loyal customer'<br/>rfm_data$segment[which(rfm_data$segment == 'About to sleep' &amp;<br/>                           (rfm_data$M &gt;= 4))] &lt;-'Needing attention'<br/>rfm_data$segment[which(rfm_data$segment == 'Hibernating' &amp;<br/>                           (rfm_data$F &gt;= 4 &amp; rfm_data$M &gt;= 4))] &lt;-'Can not lose them'<br/>rfm_data[, -c(5, 6,7)] %&gt;% <br/>    head(10) %&gt;% <br/>    formattable::formattable()</span></pre><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mi"><img src="../Images/bdbc7cd184027008e9a74a5ad2f51cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxYznrDFoUiXPAjReooWJw.png"/></div></div></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es jx"><img src="../Images/b2e60858496fff00cff3a518de859e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*VnJeeSBSWy6-JOaUWxxgXg.gif"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">起作用了！！</figcaption></figure><h1 id="3140" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">客户的细分分布</h1><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mj"><img src="../Images/76d3300f219eb659f04e9b5fad7a38e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sEc9yXQVJ9KGlyoWQc3lDw.png"/></div></div></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es mk"><img src="../Images/10f6177b78dd08357aa337e38e858ff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PuQsWgyjIBISYPS8c1pOGQ.png"/></div></div></figure><p id="6e3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果表明:</p><ul class=""><li id="0e17" class="jj jk hh ig b ih ii il im ip jl it jm ix jn jb jo jp jq jr bi translated">冠军客户(598)被认为是最有价值的客户，平均消费743.00美元，购买次数超过17次，平均最后一次购买是在14天前；</li><li id="6efc" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">而丢失的情况是88天没有购买的最坏情况；</li><li id="7d08" class="jj jk hh ig b ih js il jt ip ju it jv ix jw jb jo jp jq jr bi translated">重点是需要关注的细分市场，因为他们的消费很高，但上次活动是在2个多月前。</li></ul><h1 id="9157" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">数据可视化</h1><figure class="jy jz ka kb fd kc er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es ml"><img src="../Images/c2923932a9850403306162520a1679d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4zWtUV7DUzYqGhus9iN18A.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">冠军细分市场中的客户被认为是最有价值的，即将入睡，需要关注，需要一些特殊的关注来拯救他们。</figcaption></figure><h1 id="ce1c" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">应用朴素贝叶斯算法</h1><p id="48ea" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">我选择了朴素贝叶斯算法，因为它忽略了变量之间的相关性，独立地对待每个变量。该算法实现起来也比例如SVM算法更快，并且不需要大量数据来进行分类。</p><pre class="jy jz ka kb fd lh li lj bn lk ll bi"><span id="6c39" class="lm kk hh li b be ln lo l lp lq"># transforming categorical attributes, to be able to use the <br/># machine learning algorithm<br/><br/>table(dados$Education)<br/>unique(dados$Education)<br/><br/>dados$Education &lt;- factor(dados$Education,<br/>levels = c('2n Cycle','Basic', 'Graduation', 'Master', 'PhD'), <br/>labels = c(1,2,3,4,5))<br/><br/>dados[is.na(dados$Education)]<br/>table(dados$Marital_Status)<br/>unique(dados$Marital_Status)<br/><br/>dados$Marital_Status &lt;- factor(dados$Marital_Status, <br/>levels = c('Single','Together', 'Married', 'Divorced', 'Widow', <br/>'Alone', 'Absurd', 'YOLO'), <br/>labels = c(1,2,3,4,5,6,7,8))<br/><br/>dados[is.na(dados$Marital_Status)]<br/><br/># transforming the variable of interest into a factor<br/>dados$Response &lt;- as.factor(as.numeric(dados$Response))<br/><br/># scaling numeric attributes<br/>dados [ , 2] = scale(dados [ , 2])<br/>dados [ , 5:25] = scale(dados[ , 5:25])<br/><br/>#train and test<br/>set.seed(1)<br/><br/># 75% because the database is not that big<br/>divisao = sample.split(dados$Response, SplitRatio = 0.75)<br/>base_treinamento = subset(dados[-1], divisao == TRUE) <br/>base_teste = subset(dados[-1], divisao == FALSE)</span></pre><h1 id="662b" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">混淆矩阵</h1><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mm"><img src="../Images/d955bfd8922898e1f9f879f70759f5a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*Tu7nJkkRvjVAcFBQ7JhGxg.png"/></div></figure><p id="cacf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过分析混淆矩阵，该模型正确地预测出449个客户没有购买该报价，67个客户购买了该报价，结果准确率为93.14%。</p><p id="d6e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">做预测</p><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es mn"><img src="../Images/47bb3b0aa8d23315c1aba89043ae6b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*97BslnmLMs7dMwYX6EqSYQ.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">在前10个id(客户)中，8个分类正确，2个分类不正确。</figcaption></figure><figure class="jy jz ka kb fd kc er es paragraph-image"><div class="er es jx"><img src="../Images/de6a5c27823fd7312fc7319252918c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*yjeq1oLqZMnq0J9J64vMPA.gif"/></div></figure><p id="5c94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在这里查看完整的代码:</p><div class="mo mp ez fb mq mr"><a href="https://github.com/rachderossi/data-analysis-R" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hi fi z dy mw ea eb mx ed ef hg bi translated">GitHub-rachderossi/data-analysis-R:用R做的项目。</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">该数据集包含约2，240名联系过的客户的社会人口统计和公司地理特征…</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">github.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf kd mr"/></div></div></a></div><p id="d884" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再见，伙计们！</p></div></div>    
</body>
</html>