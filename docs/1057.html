<html>
<head>
<title>Build a web service that visualises data in a map</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个可视化地图数据的web服务</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/build-a-web-service-that-visualise-data-in-a-map-c8e36bd4e445?source=collection_archive---------6-----------------------#2021-02-12">https://medium.com/analytics-vidhya/build-a-web-service-that-visualise-data-in-a-map-c8e36bd4e445?source=collection_archive---------6-----------------------#2021-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a34a537117b1299a33b073e260fdef33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gMjiQVty4DynR0Q4"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@iambrettzeck?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Brett Zeck </a>拍照</figcaption></figure><p id="47f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这篇博客中，我将解释我是如何用浏览器将几个位置坐标可视化并显示在地图上的。</p><p id="40f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将这个练习分为两个部分:</p><ol class=""><li id="0ec1" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">演示如何使用Python包folium将坐标可视化为地图。</li><li id="3e3c" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">使用Flask创建restful API，Flask是一个python web框架，一旦浏览器发出请求，它就会返回html文件或内容。</li></ol><p id="280b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们需要使用pip命令安装必要的软件包:</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="4262" class="kx ky hi kt b fi kz la l lb lc"># python 2<br/>pip install folium<br/>pip install flask<br/># python 3<br/>pip3 install folium<br/>pip3 install flask</span></pre><h1 id="8fa9" class="ld ky hi bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">生成地图</strong></h1><p id="4f62" class="pw-post-body-paragraph iv iw hi ix b iy ma ja jb jc mb je jf jg mc ji jj jk md jm jn jo me jq jr js hb bi translated">在动手之前，收集了一些香港医院的相关坐标，保存在一个csv文件中，如下图。我们需要纬度和经度来生成地图。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/125e75f30f1223ccff81df2225e27a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VTDMOVDnm_HDO-z1A_pZAg.png"/></div></div></figure><p id="c5d8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们从编写main.py开始:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="46d9" class="kx ky hi kt b fi kz la l lb lc">import folium<br/>import pandas as pd<br/><br/>def generate_map():<br/>    df = pd.read_csv("coordinates.csv")<br/><br/>    my_map = folium.Map(<br/>        # center: Hong Kong Space Museum<br/>        location=[22.295403586726987, 114.17205382336623],<br/>        tiles='cartodbpositron',<br/>        zoom_start=13<br/>    )<br/>    df.apply(lambda row:folium.Marker(location=[row["Latitude"], row["Longitude"]], popup=row["Location"], icon=folium.Icon(color='red', prefix='fa fa-circle-o')).add_to(my_map), axis=1)<br/>    my_map.save("mymap.html")<br/>    <br/><br/>if __name__=="__main__":<br/>    generate_map()<br/>    print("Map is generated")</span></pre><p id="9707" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，导入pandas来加载coordinates.csv文件中的数据。然后，使用变量my_map创建地图，并将香港太空馆的坐标分配给用于标识地图中心的参数location。参数zoom_start用于确定要显示的区域。数字越大，面积越小或越详细。最后，使用函数标记将所有坐标应用到对象my_map，并将对象保存为html文件。</p><p id="1b03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好吧。让我们尝试运行脚本。打开终端，导航到当前工作目录并运行它。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/c65b03e114009fd505192e2aec7b914d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8QqT5QgDdZ0lyTeuBrQzA.png"/></div></div></figure><p id="bc34" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您应该看到在当前目录中生成了一个文件名为“mymap.html”的文件。如果你用浏览器打开它，你会看到和下图一样的效果。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/d9e8abc1703db05a882ad73e3736c691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CpjYfZ6GggFh6Wxm63Q3MA.png"/></div></div></figure><p id="776d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">太好了。我们已经完成了生成地图的过程。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><h1 id="4713" class="ld ky hi bd le lf mi lh li lj mj ll lm ln mk lp lq lr ml lt lu lv mm lx ly lz bi translated">创建web服务</h1><p id="4e8c" class="pw-post-body-paragraph iv iw hi ix b iy ma ja jb jc mb je jf jg mc ji jj jk md jm jn jo me jq jr js hb bi translated">现在，我们应该考虑如何构建一个web服务来为浏览器提供html文件。我们将使用Flask中的render_template函数将html文件呈现给浏览器。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="288c" class="kx ky hi kt b fi kz la l lb lc">from flask import Flask, render_template<br/>app = Flask(__name__)</span></pre><p id="0e4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将创建两个端点，一个用于检查状态，确保我的服务正在运行。另一个用于渲染文件。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="c2e4" class="kx ky hi kt b fi kz la l lb lc">@app.route("/", methods=["GET"])<br/>def status():<br/>    print("/")<br/>    return "Status: OK"<br/><br/>@app.route("/map", methods=["GET"])<br/>def map():<br/>    print("/map")<br/>    return render_template("mymap.html")</span></pre><p id="a128" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，由于render_template函数将从文件夹模板中查找文件名，我们需要修改之前保存html文件的目录代码，方法是更改</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="93e2" class="kx ky hi kt b fi kz la l lb lc">my_map.save("mymap.html")</span></pre><p id="a0b5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="1c88" class="kx ky hi kt b fi kz la l lb lc">my_map.save("templates/mymap.html")</span></pre><p id="3f15" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">记住在当前目录中创建一个名为“templates”的文件夹。</p><p id="8ccc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，我们需要用下面的代码片段托管服务。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="2c39" class="kx ky hi kt b fi kz la l lb lc">if __name__=="__main__":<br/>    generate_map()<br/>    print("Map is generated")<br/><br/>    app.run(host="0.0.0.0", port=4000, debug=True)</span></pre><p id="2c5d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是时候再次测试它了。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/f00b4f216a54a9573dc3ab1bf5f6b3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBwC7GOMMUIjypqbdcrhZA.png"/></div></div></figure><p id="2ae6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我指定服务在端口4000运行。现在转到浏览器搜索栏，键入“localhost:4000/”，您应该看到“状态:正常”显示，这表明服务正在成功运行。之后再试试“localhost:4000/map”耶！！你成功地创建了一个简单的web应用程序，在地图上显示坐标。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/f04391f370e36aaf61022b00e271e4b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3QUMMcTwv9pO8M-PEuu08A.png"/></div></div></figure><p id="c977" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">耶！！你成功地创建了一个简单的web应用程序，在地图上显示坐标列表。</p><p id="2c4f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想停止你的服务，只需按Control + C退出。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="2efc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，如果不想保存html文件，可以将map对象转换为字符串并直接返回它。好处是不执行I/O。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="fe86" class="kx ky hi kt b fi kz la l lb lc">return(my_map.get_root().render())</span></pre><p id="1dc0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完整代码:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="b39d" class="kx ky hi kt b fi kz la l lb lc">import folium<br/>import pandas as pd<br/>from flask import Flask, render_template<br/><br/>app = Flask(__name__)<br/><br/>@app.route("/", methods=["GET"])<br/>def status():<br/>    print("/")<br/>    return "Status: OK"<br/><br/>@app.route("/map", methods=["GET"])<br/>def map():<br/>    print("/map")<br/>    return render_template("mymap.html")<br/>    # return(my_map.get_root().render())<br/><br/>def generate_map():<br/>    df = pd.read_csv("coordinates.csv")<br/><br/>    my_map = folium.Map(<br/>        # center: Hong Kong Space Museum<br/>        location=[22.295403586726987, 114.17205382336623],<br/>        tiles='cartodbpositron',<br/>        zoom_start=13<br/>    )<br/>    df.apply(lambda row:folium.Marker(location=[row["Latitude"], row["Longitude"]], popup=row["Location"], icon=folium.Icon(color='red', prefix='fa fa-circle-o')).add_to(my_map), axis=1)<br/>    my_map.save("templates/mymap.html")<br/><br/><br/>if __name__=="__main__":<br/>    generate_map()<br/>    print("Map is generated")<br/><br/>    app.run(host="0.0.0.0", port=4000, debug=True)</span></pre><p id="3003" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢你阅读这篇博客。</p><p id="58aa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">访问我的GitHub库<a class="ae iu" href="https://github.com/Rogerlaulau/web-service-for-data-visualization" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></div></div>    
</body>
</html>