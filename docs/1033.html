<html>
<head>
<title>Visualize the gradient descent of a cost function with its level circles -Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可视化带有水平圆的成本函数的梯度下降-Python</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visualize-the-gradient-descent-of-a-cost-function-with-its-level-circles-python-d8c850731b0a?source=collection_archive---------4-----------------------#2021-02-11">https://medium.com/analytics-vidhya/visualize-the-gradient-descent-of-a-cost-function-with-its-level-circles-python-d8c850731b0a?source=collection_archive---------4-----------------------#2021-02-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="7a66" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嗨！在这里，我们将计算任意成本函数的梯度，并显示其在梯度下降过程中的演变。所有的代码都可以在我的GitHub上的这个链接中找到。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/981813d75fb623c97c343b923709aa14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42qqFofWwMwyYLRiM6pxgA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">作者图片</figcaption></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><h2 id="a6d5" class="kb kc hi bd kd ke kf kg kh ki kj kk kl ix km kn ko jb kp kq kr jf ks kt ku kv bi translated">装置</h2><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="35ad" class="kb kc hi kx b fi lb lc l ld le">pip install numpy<br/>pip install matplotlib</span></pre><h2 id="c8ef" class="kb kc hi bd kd ke kf kg kh ki kj kk kl ix km kn ko jb kp kq kr jf ks kt ku kv bi translated">进口</h2><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="1647" class="kb kc hi kx b fi lb lc l ld le">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import math<br/>from math import *</span></pre><p id="e6f7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">首先，我们定义我们的成本函数:</p><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="b054" class="kb kc hi kx b fi lb lc l ld le">def f(x1, x2):<br/>    return 0.5*x1**2 + (5/2)*x2**2 - x1*x2 - 2*(x1 + x2)</span></pre><p id="338b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们手动计算函数的梯度:</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lf"><img src="../Images/b406d343b081b9e5ac69252a904d9026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1FQEwb3puDz3wiCobtQPg.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">作者图片</figcaption></figure><p id="ba00" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们必须定义两个函数:</p><ul class=""><li id="a6dc" class="lg lh hi io b ip iq it iu ix li jb lj jf lk jj ll lm ln lo bi translated">返回我们上面计算结果的梯度函数，</li><li id="4d20" class="lg lh hi io b ip lp it lq ix lr jb ls jf lt jj ll lm ln lo bi translated">范数函数将有助于了解我们在梯度下降的每次迭代中走了多远，</li></ul><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="4e7f" class="kb kc hi kx b fi lb lc l ld le">def gradient(x1, x2):<br/>    return np.array([-2 + x1 - x2, -2 - x1 + 5*x2])</span><span id="5b01" class="kb kc hi kx b fi lu lc l ld le">def norm(matrice_1x2):<br/>    n_line = matrice_1x2.shape[0]<br/>    N = 0<br/>    for i in range(n_line):<br/>        N += matrice_1x2[i]**2<br/>    return math.sqrt(N)</span></pre><p id="eb56" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们用任意值初始化变量<strong class="io hj"> x1 </strong>和<strong class="io hj"> x2 </strong>:</p><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="8e17" class="kb kc hi kx b fi lb lc l ld le">x1, x2 = 2, 1</span></pre><p id="7e08" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们为我们的步骤<strong class="io hj"> t </strong>设置一个值(t越大，我们的算法收敛得越快，但是如果<strong class="io hj"> t </strong>太大，我们的算法可能会发散，所以要小心并为该步骤测试几个值)。</p><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="6293" class="kb kc hi kx b fi lb lc l ld le">t = 0.1</span></pre><p id="6832" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们还为“<strong class="io hj"> epsilon </strong>”阈值设置了一个值:一旦在梯度下降期间行进的距离小于设置的阈值，我们将停止迭代。</p><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="bb6c" class="kb kc hi kx b fi lb lc l ld le">epsilon = pow(10,-6)</span></pre><p id="2197" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">然后，我们为其余变量赋予初始值:</p><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="fb99" class="kb kc hi kx b fi lb lc l ld le">grad_f = gradient(x1, x2)<br/>n_grad = norm(grad_f)<br/>i = 1<br/>evolution_X1_X2 = [[x1, x2]]</span></pre><h2 id="a28a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl ix km kn ko jb kp kq kr jf ks kt ku kv bi translated">梯度下降</h2><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="cc93" class="kb kc hi kx b fi lb lc l ld le">while n_grad &gt; epsilon:<br/>    <br/>    direction = -grad_f<br/>    x1, x2 = x1 + t*direction[0], x2 + t*direction[1] <br/>    evolution_X1_X2 = np.vstack((evolution_X1_X2, [x1, x2]))<br/>    grad_f = gradient(x1, x2)<br/>    n_grad = norm(grad_f)<br/>    i +=1</span></pre><p id="a55a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们在evolution_X1_X2数组中检索我们的两个变量<strong class="io hj"> X1 </strong>和<strong class="io hj"> X2 </strong>的演化:</p><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="ecf7" class="kb kc hi kx b fi lb lc l ld le">evolution_X1 = evolution_X1_X2[:, 0]<br/>evolution_X2 = evolution_X1_X2[:, 1]</span></pre><h2 id="a2a2" class="kb kc hi bd kd ke kf kg kh ki kj kk kl ix km kn ko jb kp kq kr jf ks kt ku kv bi translated">可视化1</h2><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="b4f2" class="kb kc hi kx b fi lb lc l ld le">x1 = np.linspace(2, 3.5, 150)<br/>x2 = np.linspace(0.25, 1.75, 150)<br/>X1, X2 = np.meshgrid(x1, x2)<br/>Z = f(X1, X2)</span><span id="f157" class="kb kc hi kx b fi lu lc l ld le">fig = plt.figure(figsize = (10,7))<br/>contours = plt.contour(X1, X2, Z, 20)<br/>plt.clabel(contours, inline = True, fontsize = 10)<br/>plt.title("Evolution of the cost function during gradient descent with level circles", fontsize=15)</span><span id="66ef" class="kb kc hi kx b fi lu lc l ld le">plt.plot(evolution_X1, evolution_X2)<br/>plt.plot(evolution_X1, evolution_X2, '*', label = "Cost function")</span><span id="0311" class="kb kc hi kx b fi lu lc l ld le">plt.xlabel('x1', fontsize=11)<br/>plt.ylabel('x2', fontsize=11)<br/>plt.colorbar()<br/>plt.legend(loc = "upper right")<br/>plt.show()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es lv"><img src="../Images/b743d2027aba6547e39537280446e1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*FihIDtdO5IMHq_t-cuIuJg.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">作者图片</figcaption></figure><h1 id="adde" class="lw kc hi bd kd lx ly lz kh ma mb mc kl md me mf ko mg mh mi kr mj mk ml ku mm bi translated">另一个版本更加丰富多彩——让我们疯狂吧</h1><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="3a1f" class="kb kc hi kx b fi lb lc l ld le">x1, x2 = -25, -35<br/>grad_f = gradient(x1, x2)<br/>n_grad = norm(grad_f)<br/>t = 0.1<br/>epsilon = pow(10,-6)<br/>n_grad = norm(grad_f)<br/>i = 1<br/>evolution_X1_X2 = [[x1, x2]]</span><span id="34df" class="kb kc hi kx b fi lu lc l ld le">while n_grad &gt; epsilon:<br/>    <br/>    direction = -grad_f<br/>    x1, x2 = x1 + t*direction[0], x2 + t*direction[1] <br/>    evolution_X1_X2 = np.vstack((evolution_X1_X2, [x1, x2]))<br/>    grad_f = gradient(x1, x2)<br/>    n_grad = norm(grad_f)<br/>    i +=1</span><span id="d4f9" class="kb kc hi kx b fi lu lc l ld le">evolution_X1 = evolution_X1_X2[:, 0]<br/>evolution_X2 = evolution_X1_X2[:, 1]</span></pre><h2 id="68db" class="kb kc hi bd kd ke kf kg kh ki kj kk kl ix km kn ko jb kp kq kr jf ks kt ku kv bi translated">可视化2</h2><pre class="jm jn jo jp fd kw kx ky kz aw la bi"><span id="008b" class="kb kc hi kx b fi lb lc l ld le">x1 = np.linspace(-30, 25, 150)<br/>x2 = np.linspace(-40, 20, 150)<br/>X1, X2 = np.meshgrid(x1, x2)<br/>Z = f(X1, X2)</span><span id="1740" class="kb kc hi kx b fi lu lc l ld le">fig = plt.figure(figsize = (10,7))</span><span id="4008" class="kb kc hi kx b fi lu lc l ld le">plt.imshow(Z, extent = [-30,25,-40,20], origin = 'lower', cmap = 'jet', alpha = 1)</span><span id="83da" class="kb kc hi kx b fi lu lc l ld le">plt.title("Evolution of the cost function during gradient descent with level circles", fontsize=15)</span><span id="acf2" class="kb kc hi kx b fi lu lc l ld le">plt.plot(evolution_X1, evolution_X2)<br/>plt.plot(evolution_X1, evolution_X2, '*', label = "Cost function")</span><span id="6d02" class="kb kc hi kx b fi lu lc l ld le">plt.xlabel('x1', fontsize=11)<br/>plt.ylabel('x2', fontsize=11)<br/>plt.colorbar()<br/>plt.legend(loc = "upper right")<br/>plt.show()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es mn"><img src="../Images/715c9b31e4f72b2c7bbf5dc4d73beb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*SVrOupaBWp2oIKkiME6yTA.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">作者图片</figcaption></figure><h2 id="da68" class="kb kc hi bd kd ke kf kg kh ki kj kk kl ix km kn ko jb kp kq kr jf ks kt ku kv bi translated">我希望你觉得这很有趣！</h2></div></div>    
</body>
</html>