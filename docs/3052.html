<html>
<head>
<title>Playing with Pandas library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">玩熊猫图书馆</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/playing-with-pandas-library-31e09f43ed81?source=collection_archive---------10-----------------------#2021-05-31">https://medium.com/analytics-vidhya/playing-with-pandas-library-31e09f43ed81?source=collection_archive---------10-----------------------#2021-05-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c9b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重塑、分组和透视数据的技术</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/d14616ac4f5f1fc8aebe45af32a726c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RsD_RFwlDbn1fXdO"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">弗兰基·查马基在<a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2b53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Python凭借其受欢迎程度和效率在短短十年内改变了世界。Python提供了可靠的数据科学趋势，包括:</p><p id="cf9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据采集</p><p id="a7a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据清理</p><p id="a729" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">机器学习模型</p><p id="ed22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据可视化</p><p id="e108" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Pandas是Python中一个非常基础的内置库，占用了很多空间。这是一个易于使用的开源库，提供了高效率和许多用于Python编程数据分析的工具。</p><p id="a700" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Pandas是一个内存中非SQL类型的数据库，为基本的SQL结构、统计方法和绘图能力提供帮助。因为它是在Cython之上构建的，所以运行速度更快，并且访问机器内存的时间更少。</p><p id="550d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→Pandas有一个非常先进的功能，可以对数据帧组执行一些操作。</p><p id="45da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→数据框:被标记的2D数据。它包含不同的列和行。</p><blockquote class="jt ju jv"><p id="ed02" class="ie if jw ig b ih ii ij ik il im in io jx iq ir is jy iu iv iw jz iy iz ja jb ha bi translated">因此，在本文中，我们将快速浏览一些分组、整形和透视数据的方法。</p></blockquote><p id="3cc7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→对于这一部分，我们将根据学生分数来表示我们的数据:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="30c6" class="kf kg hh kb b fi kh ki l kj kk">scores = pd.DataFrame({'name':['Bob','Selena','Michael','Daisy'],<br/>'gender': ['Male','Female','Male','Female'],<br/>'test1': [59, None, 79, 90],<br/>'test2': [40,69,80,67],'mentor': ['Mike', 'Ellie', 'John', 'Ellie']})</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kl"><img src="../Images/2250cbc3ead04c525a7b9f58ebb0897f.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*CQz2ySTOFy8LbDBTXExMPQ.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><h1 id="9ac3" class="km kg hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">使用分组还原的技巧</strong></h1><p id="3066" class="pw-post-body-paragraph ie if hh ig b ih lj ij ik il lk in io ip ll ir is it lm iv iw ix ln iz ja jb ha bi translated">的。groupby函数是一个低级功能强大的工具，允许您按列对数据框进行分组，然后再将其合并到输出中。</p><p id="96ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，让我们计算每个导师的测试中值。首先，我们会打电话。分组然后执行。输出中值:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="4d9f" class="kf kg hh kb b fi kh ki l kj kk">scores.groupby('mentor').median()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lo"><img src="../Images/c391858df00b48740e54b28a7ea3bf41.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*tVpjxW2FVAUYTmH_BxKDrQ.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="5b94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们调用. GroupBy时，会返回一个groupby实例。在本例中，该实体将具有相同mentor的所有行组合在一起。</p><p id="1455" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">分组是一个强大的工具，那么你也可以通过许多列来分组。只需按导师和性别分组，即可发现每位导师的性别中值:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="1a8d" class="kf kg hh kb b fi kh ki l kj kk">scores.groupby(['mentor', 'gender']).median()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lp"><img src="../Images/769bbcf70e7b49cf3cf5ceca04973ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtl1mEfF9iJQVkqXKjtkbQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="b0e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">特别说明:</strong>按多列分组的结果是层次索引，通常称为多级索引。</p><p id="b683" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们实现了。agg技术，并向其传递一个函数列表，以便在我们需要mentor的最低和最高考试分数时调用:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="6918" class="kf kg hh kb b fi kh ki l kj kk">scores.groupby(['mentor', 'gender']).agg([min, max])</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lq"><img src="../Images/4ded96d6c54bffbda46c9aa200ea8717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*745kvoZkc2IWCK1QojqPUA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="850a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">groupby对象包含几种将组值缩减为单个值的方法。它们是:</p><p id="cae8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→ .全部，。任何，。数数，。大小，。idxmax，。idxmin，。分位数，。agg(函数)。应用(函数)。max，。意思是。最小值，。第n次，。最后，。中位数，。扫描电镜，。产品。总和，。标准，。定义变量</p><h1 id="4d48" class="km kg hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">旋转数据</strong></h1><p id="758c" class="pw-post-body-paragraph ie if hh ig b ih lj ij ik il lk in io ip ll ir is it lm iv iw ix ln iz ja jb ha bi translated">我们可以使用数据透视表来概括某些groupby行为。我们可以使用下一个公式来计算导师得分的中位数:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="ebb1" class="kf kg hh kb b fi kh ki l kj kk">scores.pivot_table(index='mentor',<br/>values=['test1', 'test2'],aggfunc='median',margins=True)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lr"><img src="../Images/2d90a343f8a433a04941d13c5340b6b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*1wBiXnwl4OSlBo7UVppKRQ.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="d269" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们希望按导师和性别进行组合，我们只需使用包含两者的索引参数列表:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="3387" class="kf kg hh kb b fi kh ki l kj kk">scores.pivot_table(index=['mentor', 'gender'],<br/>values=['test1', 'test2'],aggfunc='median')</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ls"><img src="../Images/7f64065761d31414c81a081fd1a23d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*VKQEt5AUh4dlL6P5vkywSA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="d7ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们希望应用多个函数，请使用函数列表。在这一部分，我们将检查每位导师的最少和最多研究结果:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="f621" class="kf kg hh kb b fi kh ki l kj kk">scores.pivot_table(index='mentor',values=['test1', 'test2'],aggfunc=[min, max])</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lt"><img src="../Images/a07f3806566a2b253eb97f127f96f5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*OLkmioZGO88rAvGxtMh7lA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="95c1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以观察到数据透视表和group by的操作非常相似。许多电子表格的普通用户喜欢数据透视表的声明性语言，而不熟悉数据透视表的程序员喜欢分组原则。</p><h1 id="2005" class="km kg hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">熔化数据</h1><p id="b540" class="pw-post-body-paragraph ie if hh ig b ih lj ij ik il lk in io ip ll ir is it lm iv iw ix ln iz ja jb ha bi translated">OLAP有一个事实和维度的概念。事实是可测量和可报告的值。维度是表征事实环境的一组值。然后可以使用这些维度来分析数据。</p><p id="7673" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里使用的分数数据是宽格式的(也称为堆叠或记录)。与“长”格式(也称为整齐格式)相比，在“长”格式中，每一行都包含一个事实(可能有额外的变量来表示维度)。如果一个测试分数被认为是一个事实，这种宽形式似乎有一个以上的事实在一排，所以它是宽的。</p><p id="e906" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用熊猫的融化功能来处理数据，使其变长。因为我熟悉OLAP术语(事实和维度)，我将使用这些词来描述如何以及何时使用melt。</p><p id="172b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">分数数据框中的test1和test2列包含事实。我们希望开发一个新的数据框架，其中测试名称被分成单独的一列，实际上测试分数被分组在一列中。事实列的列表放在value vars参数中来实现这一点。我们应该在id vars参数中列出我们想要维护的任何维度。</p><p id="1774" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里以姓名和性别为维度，以考试成绩为事实:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="d756" class="kf kg hh kb b fi kh ki l kj kk">pd.melt(scores, id_vars=['name', 'gender'],value_vars=['test1', 'test2'])</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lu"><img src="../Images/82d8170309f9af551f260999ae5e8eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BkIamRjseXSkG46sKa-NhQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="d8a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们要将事实的描述从变量修改为更具解释性的东西，我们可以使用var name参数。使用值名称参数重命名事实列(默认为值):</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="23c5" class="kf kg hh kb b fi kh ki l kj kk">pd.melt(scores, id_vars=['name', 'gender'],value_vars=['test1', 'test2'], var_name='test', value_name='score')</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lv"><img src="../Images/bc0ab6e7c011ddf0277cdfac5149b63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tOamvBqO2p-PT9TLGA5jFQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><h2 id="1604" class="kf kg hh bd kn lw lx ly kr lz ma mb kv ip mc md kz it me mf ld ix mg mh lh mi bi translated">再次转换为宽</h2><p id="5f0b" class="pw-post-body-paragraph ie if hh ig b ih lj ij ik il lk in io ip ll ir is it lm iv iw ix ln iz ja jb ha bi translated">我们可以使用数据透视表从长样式切换到宽样式。往相反的方向走就有点复杂了:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="13d4" class="kf kg hh kb b fi kh ki l kj kk">long_df = pd.melt(scores, id_vars=['name', 'gender'],value_vars=['test1', 'test2'],var_name='test', value_name='score')</span></pre><p id="c553" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们首先透视，使用维度作为索引参数，事实列名称作为列参数，事实列作为值参数:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="d559" class="kf kg hh kb b fi kh ki l kj kk">wide_df = long_df.pivot_table(index=['name', 'gender'],columns=['test'],values=['score'])<br/>wide_df</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mj"><img src="../Images/7c5bd4297e933bf82a5cff18c60e0e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*7g3Yd6XQuuPD2zv1YAborA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="5760" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这会产生分层的列标签(或多级)以及分层的索引。使用。重置索引过程以展平索引。它将从原始索引创建一列(如果索引是分层的，则创建多列):</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="610f" class="kf kg hh kb b fi kh ki l kj kk">wide_df = wide_df.reset_index()<br/>wide_df</span></pre><p id="ad54" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">的。从列属性中获取级别值的技术可用于展平嵌套的列。这可能更困难，因为如果级别1为空，我们希望将级别0的值集成到级别1列中。为了完成这项任务，我将利用列表中的条件表达式来理解:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="927a" class="kf kg hh kb b fi kh ki l kj kk">cols = wide_df.columns<br/>cols.get_level_values(0)<br/>#Output: Index(['name', 'age', 'score', 'score'], dtype='object')<br/>cols.get_level_values(1)<br/>#Output: Index(['', '', 'test1', 'test2'], dtype='object', name='test')<br/>l1 = cols.get_level_values(1)<br/>l0 = cols.get_level_values(0)<br/>names = [x[1] if x[1] else x[0] for x in zip(l0, l1)]<br/>names</span></pre><p id="b6f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，将列名更改为新名称:</p><pre class="jd je jf jg fd ka kb kc kd aw ke bi"><span id="70a5" class="kf kg hh kb b fi kh ki l kj kk">wide_df.columns = names<br/>wide_df</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mk"><img src="../Images/043d9fac2115b14e003b00fe69c30130.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*FBhYb__W7JEIt6CEDkQ56Q.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><h1 id="39dc" class="km kg hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">堆叠和拆分</h1><p id="771c" class="pw-post-body-paragraph ie if hh ig b ih lj ij ik il lk in io ip ll ir is it lm iv iw ix ln iz ja jb ha bi translated">“堆叠”然后“拆分”数据的能力是操纵数据的另一种方式。当您已经拥有多级索引时，这一点尤其有用，如果您利用index参数传入一个列表，就可以从数据透视表中获得这些索引。</p><p id="b06c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">拆分接受多级索引数据集，并提取索引的最内层，使其成为列的最内层。堆叠在另一个方向起作用。请参见下图以供参考:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ml"><img src="../Images/1befa560ee4f913d2a7142f750f30029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfVPFqb7AGBZ8TcUu8yJWQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><h1 id="4f69" class="km kg hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="f1c1" class="pw-post-body-paragraph ie if hh ig b ih lj ij ik il lk in io ip ll ir is it lm iv iw ix ln iz ja jb ha bi translated">从本文中，您确实可以使用任何工具来重新排列您的数据。与需要手动迭代信息的高要求解决方案相比，它速度更快，需要的代码更少。然而，可能需要一些时间来弄清楚如何转换原始数据。尝试这些技巧，并寻找其他人的例子，看看他们是如何在公众中运用这些技巧的。</p></div></div>    
</body>
</html>