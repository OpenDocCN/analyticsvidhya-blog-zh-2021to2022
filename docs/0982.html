<html>
<head>
<title>Cordova audio recorder plugin tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">科尔多瓦录音机插件教程</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/cordova-audio-recorder-plugin-tutorial-51217e504bd1?source=collection_archive---------26-----------------------#2021-02-08">https://medium.com/analytics-vidhya/cordova-audio-recorder-plugin-tutorial-51217e504bd1?source=collection_archive---------26-----------------------#2021-02-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="eba6" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">插件概念</h1><p id="3eed" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">插件cordova audio recorder ，可用于在android和iOS上录制音频。这个插件提供了一个<strong class="je hi"> <em class="kb"> api，可以使用全局对象<code class="du kc kd ke kf b">cordova.plugins.audioRecorder</code>访问</em> </strong>。</p><p id="0568" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated">API<strong class="je hi"><em class="kb">由两个函数</em> </strong>组成，一个用于执行录制，一个用于停止录制。</p><p id="5b28" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">为录制</em></strong><code class="du kc kd ke kf b">cordova.plugins.audioRecorder.audioCapture_Start</code>功能，可以使用，它有如下签名:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="09b7" class="kt if hh kf b fi ku kv l kw kx">cordova.plugins.audioRecorder.audioCapture_Start(audioCapture_Ended , audioCapture_Failed , audioCapture_duration )<br/>/*<br/>audioCapture_duration : <br/>    Number of seconds to perform audio<br/>    recording . If non is provided , <br/>    the default is 60 seconds . <br/>audioCapture_Ended : <br/>    call back function , called when the<br/>    amount of time allocated for recording , <br/>    audioCapture_duration , has elapsed . <br/>    It receives as argument , a String <br/>    containing the path of the recorded <br/>    m4a audio file .<br/>    If cordova.plugins.audioRecorder.audioCapture_Stop <br/>    is  called , while performing recording , <br/>    then the registered methods ,<br/>    using this function , are not called  , <br/>    instead the registered functions , using <br/>    cordova.plugins.audioRecorder.audioCapture_Stop<br/>    are called .    <br/>audioCapture_Failed : <br/>    If any error happens during the <br/>    act of performing the recording , <br/>    this method is called . It is passed.   <br/>    a String , detailing the error .*/</span></pre><p id="aa00" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated">要<strong class="je hi"> <em class="kb">停止录制</em> </strong> <em class="kb"> </em>，要么在经过设定的时间后自动停止，要么使用<code class="du kc kd ke kf b">cordova.plugins.audioRecorder.audioCapture_Stop</code>方法随时停止，其签名如下</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="22e8" class="kt if hh kf b fi ku kv l kw kx">cordova.plugins.audioRecorder.audioCapture_Stop(audioCapture_Ended , audioCapture_Failed )<br/>/*<br/>audioCapture_Ended : <br/>   call back function , called when successfully , <br/>   the audioCapture_Stop function , stopped the<br/>   recording of the audio file . <br/>   audioCapture_Ended receives as argument , a <br/>   String containing the path to the recorded file . <br/>audioCapture_Failed : <br/>   Called when performing the recording has <br/>   failed . <br/>   It receives as an argument , a String , detailing <br/>   the error .*/</span></pre><p id="50a9" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">录制的音频文件</em> </strong>是一个<code class="du kc kd ke kf b">m4a</code>音频文件，保存在应用程序的缓存目录中。系统可能会清空低存储上的缓存目录。因此，为了永久存储，记录的文件必须复制到其他地方。</p><p id="ce5f" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">对于iOS，在</em></strong><code class="du kc kd ke kf b">config.xml</code>文件中，在应用程序的根目录下，必须添加以下内容，在<code class="du kc kd ke kf b">widget</code>元素之间:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="d955" class="kt if hh kf b fi ku kv l kw kx">&lt;edit-config file="*-Info.plist" mode="merge" target="NSMicrophoneUsageDescription"&gt;<br/>    &lt;string&gt;Describe why microphone permission is needed&lt;/string&gt;<br/>&lt;/edit-config&gt;</span></pre><p id="bcbb" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated">对于iOS，同样，为了<strong class="je hi"> <em class="kb">允许在后台</em> </strong>中继续录制，您应该在<code class="du kc kd ke kf b">config.xml</code>文件中添加<code class="du kc kd ke kf b">UIBackgroundModes</code>:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="dcac" class="kt if hh kf b fi ku kv l kw kx">&lt;platform name="ios"&gt;<br/>...<br/>    &lt;config-file parent="UIBackgroundModes" platform="ios" target="*-Info.plist"&gt;<br/>        &lt;array&gt;<br/>            &lt;string&gt;audio&lt;/string&gt;<br/>        &lt;/array&gt;<br/>    &lt;/config-file&gt;<br/>...<br/>&lt;/platform&gt;</span></pre><h1 id="cf16" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">插件演示</h1><p id="a7c3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">创建一个应用</em> </strong>如下:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="8de5" class="kt if hh kf b fi ku kv l kw kx">$ cordova create audio-recorder-plugin-demo com.twiserandom.mobileapps.demo.audioRecorderPluginDemo "Audio Recorder Plugin Demo"<br/>$ cd audio-recorder-plugin-demo/<br/>$ cordova platform add ios<br/>$ cordova platform add android<br/>$ cordova plugin add cordova-plugin-audio-recorder</span></pre><p id="7255" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">编辑</em> </strong> <code class="du kc kd ke kf b">www/index.html</code>文件，看起来像这样:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="bf53" class="kt if hh kf b fi ku kv l kw kx">&lt;!DOCTYPE html &gt;<br/>&lt;html &gt;<br/>    &lt;head &gt;<br/>        &lt;meta name="format-detection" content="telephone=no" &gt;<br/>        &lt;meta name="msapplication-tap-highlight" content="no" &gt;<br/>        &lt;meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" &gt;<br/>        &lt;title&gt;Audio Recorder Plugin Demo&lt;/title&gt;</span><span id="eff0" class="kt if hh kf b fi ky kv l kw kx">&lt;style &gt;<br/>        *{<br/>            margin: 0px;<br/>            padding: 0px; }<br/>        html{<br/>            box-sizing: border-box; }<br/>        html * , html *::before , html *::after{<br/>            box-sizing: inherit; }</span><span id="dada" class="kt if hh kf b fi ky kv l kw kx">.app_AudioRecorder_Demo{<br/>            display: flex;<br/>            flex-direction: column; }</span><span id="5d28" class="kt if hh kf b fi ky kv l kw kx">.app_AudioRecorder_Demo button{<br/>            font-size : 19px; }</span><span id="9187" class="kt if hh kf b fi ky kv l kw kx">.app_AudioRecorder_Demo audio {<br/>            width : 100%; }<br/>    &lt;/style&gt; &lt;/head&gt;</span><span id="7ce1" class="kt if hh kf b fi ky kv l kw kx">&lt;body &gt;</span><span id="2ff8" class="kt if hh kf b fi ky kv l kw kx">&lt;div class="app_AudioRecorder_Demo" &gt;</span><span id="cf44" class="kt if hh kf b fi ky kv l kw kx">&lt;button<br/>                id="recordButton"<br/>                onclick="audioCapture_Start(this )"&gt;<br/>                    Record &lt;/button&gt;</span><span id="60c0" class="kt if hh kf b fi ky kv l kw kx">&lt;button<br/>                id='stopButton'<br/>                disabled<br/>                onclick="audioCapture_Stop(this )"&gt;<br/>                    Stop &lt;/button&gt;</span><span id="00a2" class="kt if hh kf b fi ky kv l kw kx">&lt;audio id="audioPlayer" autoplay controls &gt;&lt;/audio&gt; &lt;/div&gt;</span><span id="0f43" class="kt if hh kf b fi ky kv l kw kx">&lt;script type="text/javascript" src="cordova.js"&gt;&lt;/script&gt;</span><span id="266a" class="kt if hh kf b fi ky kv l kw kx">&lt;script&gt;<br/>            document.addEventListener('deviceready', onDeviceReady , false );</span><span id="94e3" class="kt if hh kf b fi ky kv l kw kx">function onDeviceReady( ){<br/>                deviceIsReady = true;<br/>                recordButton = document.getElementById('recordButton' );<br/>                stopButton = document.getElementById('stopButton' );<br/>                audioPlayer = document.getElementById('audioPlayer' ); }</span><span id="9ec8" class="kt if hh kf b fi ky kv l kw kx">function audioCapture_Start( ){<br/>                if(deviceIsReady ){<br/>                    buttons_recordStop_Toggle( );<br/>                    cordova.plugins.audioRecorder.audioCapture_Start(<br/>                                        audioCapture_Ended ,<br/>                                        audioCapture_Failed<br/>                                        , 20 ); }}</span><span id="476c" class="kt if hh kf b fi ky kv l kw kx">function audioCapture_Stop( ){<br/>                if(deviceIsReady ){<br/>                    cordova.plugins.audioRecorder.audioCapture_Stop(<br/>                                        audioCapture_Ended ,<br/>                                        audioCapture_Failed ); } }</span><span id="f4ca" class="kt if hh kf b fi ky kv l kw kx">function audioCapture_Ended(audioRecording_path ){<br/>                buttons_recordStop_Toggle( );<br/>                audioPlayer.src = audioRecording_path; }</span><span id="9609" class="kt if hh kf b fi ky kv l kw kx">function audioCapture_Failed(audioRecording_error ){<br/>                buttons_recordStop_Toggle( );<br/>                console.log(audioRecording_error ); }</span><span id="e799" class="kt if hh kf b fi ky kv l kw kx">function buttons_recordStop_Toggle( ){<br/>                if(stopButton.disabled == true){<br/>                    recordButton.disabled = true ;<br/>                    stopButton.disabled = false; }<br/>                else{<br/>                    recordButton.disabled = false ;<br/>                    stopButton.disabled = true; } }</span><span id="4878" class="kt if hh kf b fi ky kv l kw kx">&lt;/script&gt;<br/>    &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="302c" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">编辑</em> </strong> <code class="du kc kd ke kf b"><strong class="je hi"><em class="kb">config.xml</em></strong></code>文件，在应用程序的根目录下，看起来像这样:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="feb4" class="kt if hh kf b fi ku kv l kw kx">&lt;?xml version='1.0' encoding='utf-8'?&gt;<br/>&lt;widget id="com.twiserandom.mobileapps.demo.audioRecorderPluginDemo" version="1.0.0" ae ka" href="http://www.w3.org/ns/widgets" rel="noopener ugc nofollow" target="_blank"&gt;http://www.w3.org/ns/widgets" xmlns:cdv="<a class="ae ka" href="http://cordova.apache.org/ns/1.0" rel="noopener ugc nofollow" target="_blank">http://cordova.apache.org/ns/1.0</a>"&gt;</span><span id="75e8" class="kt if hh kf b fi ky kv l kw kx">    &lt;name&gt;Audio Recorder Plugin Demo&lt;/name&gt;<br/>    &lt;description&gt;<br/>        A sample Apache Cordova application that responds to the deviceready event.<br/>    &lt;/description&gt;<br/>    &lt;author email="<a class="ae ka" href="mailto:dev@cordova.apache.org" rel="noopener ugc nofollow" target="_blank">dev@cordova.apache.org</a>" href="<a class="ae ka" href="http://cordova.io" rel="noopener ugc nofollow" target="_blank">http://cordova.io</a>"&gt;<br/>        Apache Cordova Team<br/>    &lt;/author&gt;</span><span id="5e95" class="kt if hh kf b fi ky kv l kw kx">    &lt;content src="index.html" /&gt;</span><span id="e28e" class="kt if hh kf b fi ky kv l kw kx">    &lt;access origin="*" /&gt;<br/>    &lt;allow-intent href="<a class="ae ka" rel="noopener ugc nofollow" target="_blank" href="/*/*">http://*/*</a>" /&gt;<br/>    &lt;allow-intent href="<a class="ae ka" rel="noopener ugc nofollow" target="_blank" href="/*/*">https://*/*</a>" /&gt;<br/>    &lt;allow-intent href="tel:*" /&gt;<br/>    &lt;allow-intent href="sms:*" /&gt;<br/>    &lt;allow-intent href="mailto:*" /&gt;<br/>    &lt;allow-intent href="geo:*" /&gt;</span><span id="a163" class="kt if hh kf b fi ky kv l kw kx">    &lt;platform name="android"&gt;<br/>        &lt;allow-intent href="market:*" /&gt;<br/>    &lt;/platform&gt;<br/>    &lt;platform name="ios"&gt;<br/>        &lt;allow-intent href="itms:*" /&gt;<br/>        &lt;allow-intent href="itms-apps:*" /&gt;<br/>        &lt;!-- Optional , allow recording in background for ios --&gt;<br/>        &lt;config-file parent="UIBackgroundModes" platform="ios" target="*-Info.plist"&gt;<br/>            &lt;array&gt;<br/>                &lt;string&gt;audio&lt;/string&gt;<br/>            &lt;/array&gt;<br/>        &lt;/config-file&gt;<br/>    &lt;/platform&gt;</span><span id="a47d" class="kt if hh kf b fi ky kv l kw kx">    &lt;edit-config file="*-Info.plist" mode="merge" target="NSMicrophoneUsageDescription"&gt;<br/>        &lt;string&gt;Describe why microphone permission is needed&lt;/string&gt;<br/>    &lt;/edit-config&gt;<br/>&lt;/widget&gt;</span></pre><p id="5b85" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><strong class="je hi"> <em class="kb">运行应用</em> </strong>:</p><pre class="kl km kn ko fd kp kf kq kr aw ks bi"><span id="a4c0" class="kt if hh kf b fi ku kv l kw kx">$ cordova emulate ios<br/>$ cordova emulate android</span></pre><div class="kl km kn ko fd ab cb"><figure class="kz la lb lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/781d68002736c9be481508102cfe5604.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*qBlR8e9sqncFIm7UTuS0Ow.png"/></div></figure><figure class="kz la lm lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/a65671dd624f68f7ba13ace866c7ae80.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*_VojR8G07Tx7OEDDDW32Mg.png"/></div></figure><figure class="kz la ln lc ld le lf paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><img src="../Images/acae24d83ef15ec7ff806b99014194d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*SZ_IQlNC9GVm7EQ3kHsprQ.png"/></div></figure></div></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="3816" class="pw-post-body-paragraph jc jd hh je b jf kg jh ji jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz ha bi translated"><em class="kb">原载于2021年2月8日https://twiserandom.com</em><a class="ae ka" href="https://twiserandom.com/cordova/cordova-audio-recorder-plugin-tutorial/" rel="noopener ugc nofollow" target="_blank"><em class="kb"/></a><em class="kb">。</em></p></div></div>    
</body>
</html>