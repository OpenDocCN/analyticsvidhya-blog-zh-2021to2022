<html>
<head>
<title>Scraping apps and automatically transfer the data by mail: a Python learning journey</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">抓取应用程序并通过邮件自动传输数据:Python学习之旅</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-apps-and-automatically-transfer-the-data-by-mail-a-python-learning-journey-11e15127608c?source=collection_archive---------2-----------------------#2022-01-12">https://medium.com/analytics-vidhya/scraping-apps-and-automatically-transfer-the-data-by-mail-a-python-learning-journey-11e15127608c?source=collection_archive---------2-----------------------#2022-01-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="d25f" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">“Ommetje-app”如何教会我自动化某些任务的第一步</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/0c5ae74155c6eb06d3b56881d4dd499f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YYUY_eobi5W5hEXJ"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">肖恩·奥尔登多夫在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3eed" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">想象你想以一个好的开始开始2022年，所以你决定今年一定要坚持你的健康意图。你在手机上安装了一个活动追踪器，每周你都想在邮箱里更新你的进展情况。或者想象另一种情况，你的国家有一位了不起的神经心理学教授，他开发了一种刺激人们更经常走路的应用程序，你想跟踪你的行走活动。这听起来可能像是人为编造的场景，但在荷兰，我们确实有这样一位教授，名叫埃里克·舍德，他绝对值得谷歌搜索一下！他在激励人们拥有更积极的生活方式方面做得很好，并与荷兰大脑基金会一起开发了“Ommetje-app”。通过使用这款应用程序，人们可以通过散步至少20分钟(荷兰语称为<em class="kj"> ommetje </em>)来获得积分，并在不同的团队中相互竞争。我们和我的同事一起参加这样的工作竞赛，我们的队长必须每周向组织报告我们的分数。提取分数，将它们相加得到一个总的团队分数，通过邮件发送信息……不同的部分可能在一个自动化的过程中被组装起来！嗯，这其实是我学习之旅的起点。让我们一起探索吧！</p></div><div class="ab cl kk kl go km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="ha hb hc hd he"><p id="a714" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">好吧，首先一个小小的免责声明:在我开始这个项目之前，我没有使用Python或任何其他编程语言自动化任务的经验。所以，不要期待高水平的专家指导！但无论如何，我希望通过带你一起走我的学习之旅，为你提供一些有用的提示和技巧。我认为非常有益的是首先将问题公式化，并将其分成子问题:</p><ol class=""><li id="ff9d" class="kr ks hh jp b jq jr jt ju jw kt ka ku ke kv ki kw kx ky kz bi translated">从Ommetjes-app中提取分数；</li><li id="7145" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">将分数格式化成文本消息；</li><li id="3cf2" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">通过邮件发送短信；</li><li id="5642" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">安排流程，以便自动执行步骤1-3。</li></ol><p id="6f5a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在接下来的部分中，我们将一个接一个地探索这些步骤。</p><h2 id="2b5d" class="lf lg hh bd lh li lj lk ll lm ln lo lp jw lq lr ls ka lt lu lv ke lw lx ly lz bi translated">1.从Ommetjes-app中提取分数</h2><p id="8228" class="pw-post-body-paragraph jn jo hh jp b jq ma ii js jt mb il jv jw mc jy jz ka md kc kd ke me kg kh ki ha bi translated">在我们深入研究从Ommetjes-app中提取数据所需的步骤之前，我认为最好先了解一下应用程序的外观。在这里你可以看到我们团队分数的截图，都设计得很漂亮，有昵称，不同的分数(XP)和几个不同成就的奖牌。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mf"><img src="../Images/fb80119a90770290076f70aea08c941a.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*CQ8rC3pfUSZaU8hagd62WA.png"/></div></figure><p id="4021" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">对于我们的项目，我们特别感兴趣的是昵称和相应的XP-score，这是我们希望从应用程序中提取的功能。要做到这一点，我们必须拦截我们的应用程序和互联网之间的数据流量，<code class="du mg mh mi mj b">mitmproxy</code>是一个非常好的工具。Gaurav Sharma已经写了一个关于如何做到这一点的<a class="ae jm" rel="noopener" href="/testvagrant/intercept-ios-android-network-calls-using-mitmproxy-4d3c94831f62">惊人教程</a> (Android和iOS)，但我将在这里为苹果用户总结这些步骤:</p><ol class=""><li id="7278" class="kr ks hh jp b jq jr jt ju jw kt ka ku ke kv ki kw kx ky kz bi translated">[Mac]在终端安装mitm proxy:<code class="du mg mh mi mj b">brew install mitmproxy</code></li><li id="3943" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">[Mac]查找您网络的IP地址:<strong class="jp hi">系统偏好设置→网络→ Wi-Fi →高级… → TCP/IP → </strong> IPv4地址</li><li id="0117" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">[iPhone]设置您的iPhone: <strong class="jp hi">设置→Wi-Fi→</strong>[点击已连接网络旁边的蓝色(I)]<strong class="jp hi">→</strong>[向下滚动到HTTP-PROXY] <strong class="jp hi"> →配置代理服务器→手动</strong></li><li id="1f94" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">【iPhone】服务器:<em class="kj">来自步骤3的IPv4地址</em> <br/>端口:<em class="kj"> 8080 </em></li><li id="e010" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">[Mac]在终端中打开mitm proxy:<code class="du mg mh mi mj b">mitmproxy</code></li><li id="9548" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">[iPhone]进入<em class="kj"> mitm.it </em>，选择苹果，安装证书</li><li id="2eb9" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">【iPhone】<strong class="jp hi">设置→通用→ VPN → </strong>安装并认证【mitmproxy】</li><li id="9366" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">[iPhone] <strong class="jp hi">设置→通用→关于→证书信任设置→ </strong>打开mitmproxy按钮，瞧！</li></ol><p id="cd10" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">哦耶，我们现在<em class="kj">几乎</em>可以去截取我们想要的数据了！是的，几乎…但是坚持住，因为我们只需要进行一些额外的小步骤！我们在终端输入<code class="du mg mh mi mj b">mitmproxy</code>，打开手机上的app。如果在前面的步骤中一切正常，现在我们将看到代理拦截的所有流量:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mk"><img src="../Images/0d41d3588832df7f5323658a685851c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EohhberZNoQGpNSBiIfsew.png"/></div></div></figure><p id="b3a9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">最后一行(<code class="du mg mh mi mj b">GET https://ommetje.nu/api/users/highscore</code>)是我们想要跳转的一行，因为那是我们数据存储的地方。现在，只需点击它，在<em class="kj">响应</em>下，我们实际上会看到昵称和分数，这正是我们正在寻找的！</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mk"><img src="../Images/588f8e868965094ce52fa519118df821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTbRRXmjeI2P_ZFmhMAv_w.png"/></div></div></figure><p id="fe04" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">为了将信息转换成Python可以处理的格式，我们将其转换成Python请求:</p><ol class=""><li id="7042" class="kr ks hh jp b jq jr jt ju jw kt ka ku ke kv ki kw kx ky kz bi translated">按下<code class="du mg mh mi mj b">w</code>，用<code class="du mg mh mi mj b">export.clip curl @focus</code>替换<code class="du mg mh mi mj b">save.file @focus path</code>。点击[Enter]将会把curl复制到你的剪贴板上</li><li id="22df" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">转到一个curl转换器(例如，<a class="ae jm" href="https://curlconverter.com" rel="noopener ugc nofollow" target="_blank">https://curlconverter.com</a>)将复制的curl转换成Python请求</li><li id="0da1" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">将Python请求复制到您喜欢的Python IDE中</li></ol><p id="d1d0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">所有步骤成功完成？干得好！大量的工作已经完成，我们现在准备做真正酷的东西，所以坚持住！^^</p><h2 id="49f3" class="lf lg hh bd lh li lj lk ll lm ln lo lp jw lq lr ls ka lt lu lv ke lw lx ly lz bi translated">2.将分数格式化成短信</h2><p id="7320" class="pw-post-body-paragraph jn jo hh jp b jq ma ii js jt mb il jv jw mc jy jz ka md kc kd ke me kg kh ki ha bi translated">好了，让我们从一些好消息开始这一部分:过程中最乏味的部分已经被覆盖，所以我们可以切换到一些实际的Pyton编程。我们要做的第一件事是导入我们需要的库，从request-object中提取文本，将其转换为一个<code class="du mg mh mi mj b">BeautifulSoup()</code>对象，并将数据加载为json格式。也有其他可能的格式，但我发现这是最容易使用的，因为它有类似字典的结构。下面是相应的Python代码:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="2901" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">现在我们有了json格式的数据，我们首先确定竞争者的数量，然后创建存储昵称和XP分数的列表，最后将整个事情格式化成一个漂亮的数据帧。我们通过计算团队总分来结束。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="d60d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">唯一剩下的事情就是创建一条我们可以通过电子邮件发送的文本消息。有几种方法可以做到这一点——我的方法可能不是最美观的——但是当你使用HTML时，确保最终的消息以<code class="du mg mh mi mj b">&lt;body&gt;</code>开始，以<code class="du mg mh mi mj b">&lt;/body&gt;</code>结束。也可以使用<code class="du mg mh mi mj b">&lt;br&gt;</code>跳到下一行。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="a15d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">事实上，这就是我们自动化流程的第二步！</p><h2 id="1892" class="lf lg hh bd lh li lj lk ll lm ln lo lp jw lq lr ls ka lt lu lv ke lw lx ly lz bi translated">3.通过邮件发送短信</h2><p id="4f20" class="pw-post-body-paragraph jn jo hh jp b jq ma ii js jt mb il jv jw mc jy jz ka md kc kd ke me kg kh ki ha bi translated">现在你可能想休息一下，但是我的建议是再坚持一会儿，因为这一步只需要一些复制-粘贴-插入操作。下面代码的一些说明性注释:我们从导入几个基本库开始，创建一个与我们的电子邮件服务器的连接，然后添加我们想要写的电子邮件，最后发送邮件。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="ca40" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">现在你可以喝咖啡了。☕️</p><h2 id="5139" class="lf lg hh bd lh li lj lk ll lm ln lo lp jw lq lr ls ka lt lu lv ke lw lx ly lz bi translated">4.安排流程</h2><p id="85a8" class="pw-post-body-paragraph jn jo hh jp b jq ma ii js jt mb il jv jw mc jy jz ka md kc kd ke me kg kh ki ha bi translated">好吧，如果你已经走到了最后一步，你绝对值得喝那杯咖啡，所以我希望它尝起来很棒！它甚至可能被证明非常方便，因为我们真的可以使用咖啡因来帮助我们完成本教程的最后一部分:实际的自动化步骤。当使用<code class="du mg mh mi mj b">crontab</code>时，这应该不会太难，但是我有一些安全问题，为此我决定走一条替代路线。因此，你可以在这里停下来，跟随例如来自<a class="mn mo ge" href="https://medium.com/u/5f5a32d9aade?source=post_page-----11e15127608c--------------------------------" rel="noopener" target="_blank"> Gavin Wiener </a>的<a class="ae jm" href="https://gavinwiener.medium.com/how-to-schedule-a-python-script-cron-job-dea6cbf69f4e" rel="noopener">这篇教程</a>，或者你可以继续阅读Yaniss Illoul 的<a class="ae jm" href="https://martechwithme.com/schedule-python-scripts-windows-mac/" rel="noopener ugc nofollow" target="_blank">实现摘要。选择权在你，但现在可能有趣的是——虽然我将为Mac用户描述步骤——后者也适合Windows用户。说到这里，让我们看看如何让调度任务工作起来。第一步是将我们的Python脚本转换成可执行文件(。这可以通过终端中的几行代码很容易地完成:</a></p><ol class=""><li id="9112" class="kr ks hh jp b jq jr jt ju jw kt ka ku ke kv ki kw kx ky kz bi translated">导航到您想要存储可执行文件的文件夹，并输入<code class="du mg mh mi mj b">nano [insert file name]</code>。确保不要在文件名中添加任何文件扩展名！</li><li id="bdc8" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">将下面两行代码添加到空文件中:</li></ol><pre class="ix iy iz ja fd mp mj mq mr aw ms bi"><span id="de7e" class="lf lg hh mj b fi mt mu l mv mw">#!/bin/sh<br/>Python [insert path_to_Python_file]</span></pre><p id="5f04" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">它应该是这样的:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mk"><img src="../Images/f30fbc1f556823557c8cb292d12a57bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZEoc04SP0f-fgUXAL9wXA.png"/></div></div></figure><p id="7c81" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">3.当你保存了文件并回到终端时，只需输入<code class="du mg mh mi mj b">chmod 755 [insert path to newly created file]</code>并点击【回车】。</p><p id="720e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们现在有了一个可执行文件，但不幸的是，在我们可以按计划实际执行这个文件之前，还需要一些额外的步骤。这里要做的基本事情是转换我们的。exe到我们使用Automator的应用程序:</p><ol class=""><li id="5074" class="kr ks hh jp b jq jr jt ju jw kt ka ku ke kv ki kw kx ky kz bi translated">[Cmd] + [Space]，键入<em class="kj"> Automator </em>并点击[Enter]</li><li id="4827" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated"><strong class="jp hi">新建文档→应用程序→ </strong>将<em class="kj">获取指定的Finder项</em>和<em class="kj">打开Finder项</em>拖动到右侧面板</li><li id="4543" class="kr ks hh jp b jq la jt lb jw lc ka ld ke le ki kw kx ky kz bi translated">在<em class="kj">获取指定的Finder项目</em>面板中，点击<strong class="jp hi">添加</strong>，导航到您的可执行文件并添加。结果应该是这样的:</li></ol><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mx"><img src="../Images/5a03de626ed33ddf4f34d82efb4e6d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2rr6G1lKJCTxkGm9S1pvg.png"/></div></div></figure><p id="1110" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">4.保存文件([Cmd] + [s])，您的应用程序就创建好了！现在我们有了一个应用程序，剩下唯一要做的事情就是按计划运行它，为此我们可以使用日历应用程序。因此，在Mac上打开日历应用程序，创建一个新的iCloud议程项目(为了清晰起见，创建一个单独的日历可能会很有用。进入<strong class="jp hi">文件→新日历→【插入日历名称】</strong></p><p id="9634" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">5.设置您希望执行文件的日期和时间，并以所需的频率重复议程项目。例如，我想在两个月的时间里，每周五下午3点发送一封电子邮件。这里没什么特别的，诀窍在于设置提醒:<strong class="jp hi">提醒→自定义→ </strong> <em class="kj">打开文件</em> <strong class="jp hi"> → </strong>【选择创建的应用】。结果是:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es my"><img src="../Images/176bff602a8c5498be5bc24308bc62d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*X-7sS46LRe3TDsPpPu73tQ.png"/></div></figure><p id="7760" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">就是这样！您的Mac现在将在您选择的预定日期和时间执行Python脚本！我意识到在整个过程中涉及到很多步骤，但是我希望我的一些学习经验——我发现很有启发性——也能对你有用。很有可能，它甚至会帮助你坚持你的2022健康目标，这将是一个不错的奖励，但如果没有:不要责怪你自己，因为不到10%的人能够习惯他们的新习惯。2022快乐！</p></div><div class="ab cl kk kl go km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="ha hb hc hd he"><p id="8c58" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><em class="kj">资源:</em></p><p id="d606" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">[1]<a class="ae jm" rel="noopener" href="/testvagrant/intercept-ios-android-network-calls-using-mitmproxy-4d3c94831f62">https://medium . com/test vague/intercept-IOs-Android-network-calls-using-mitm proxy-4d3c 94831 f62</a><br/>【2】<a class="ae jm" href="https://www.youtube.com/watch?v=LbPKgknr8m8" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=LbPKgknr8m8</a><br/>【3】<a class="ae jm" href="https://martechwithme.com/convert-python-script-app-windows-mac/#formac" rel="noopener ugc nofollow" target="_blank">https://martechwithme . com/convert-python-script-app-windows-MAC/# formac</a><br/>【4】<a class="ae jm" href="https://martechwithme.com/schedule-python-scripts-windows-mac/#formac" rel="noopener ugc nofollow" target="_blank">https://martechwithme . com/https</a></p></div></div>    
</body>
</html>