<html>
<head>
<title>3 ways to deal with SettingWithCopyWarning in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三种方法来处理熊猫的版权警告</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/3-ways-to-deal-with-settingwithcopywarning-in-pandas-f06bfbd0a86b?source=collection_archive---------3-----------------------#2021-12-22">https://medium.com/analytics-vidhya/3-ways-to-deal-with-settingwithcopywarning-in-pandas-f06bfbd0a86b?source=collection_archive---------3-----------------------#2021-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b7c5b9f83f92797f9cd7703aad187782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQ46cij3YyfarLPbFyoYoQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片:<a class="ae iu" href="https://storyset.com/illustration/warning" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><blockquote class="iv"><p id="5a91" class="iw ix hi bd iy iz ja jb jc jd je jf dx translated">忽视警告是没有好处的。即使它们毫无意义。—黛布拉·多伊尔</p></blockquote><p id="31aa" class="pw-post-body-paragraph jg jh hi ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc jf hb bi translated">我在学习编码时学到的一件事就是不要被代码中的“警告”所困扰。“专注于修复主要的bug和错误，警告不是什么大事”。当我开始处理真实世界的情况时，我意识到这是一个多么糟糕的建议。有时候警告会让你付出超乎想象的代价。一个这样的警告是对熊猫的警告。</p><p id="d456" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">不管你和熊猫一起工作了多长时间，你迟早都会遇到<code class="du kd ke kf kg b">Settingwithcopywarning</code>。如果你想弄清楚它是什么，为什么它会一直出现，即使你“<em class="km">确实得到了你期望的结果”，</em>那么这篇文章就是为你准备的。</p><p id="c9f2" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">为了解释警告背后的逻辑，我使用了来自Kaggle的<a class="ae iu" href="https://www.kaggle.com/gagandeep16/car-sales" rel="noopener ugc nofollow" target="_blank">汽车销售数据集</a>。该数据集包含不同类型汽车的信息。</p><p id="8979" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">这里是数据集的数据和结构的一瞥。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/7e84555ab89fd35f69b24598286a93f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PoHNlwqmiyzUZ9e9AvITZA.jpeg"/></div></div></figure><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="d6db" class="kw kx hi kg b fi ky kz l la lb"># car_sales is the dataframe containing the dataset<br/>car_sales.info()</span></pre><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/ca7000892677e21adb91bd1571885e4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lttg7v0CvXZO9DIht7fvSA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">汽车销售数据集信息</figcaption></figure><p id="980d" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">让我们假设一个场景，我们已经收到一个更新，所有保时捷汽车的<code class="du kd ke kf kg b">fuel_capacity</code> <em class="km"> </em>已经从17.0增加到18.0，我们被要求进行更改。让我们继续改变它们。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="38a8" class="kw kx hi kg b fi ky kz l la lb">car_sales[car_sales['Manufacturer'] == 'Porsche']['Fuel_capacity'] = 18.0</span></pre><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/40c0e51185337f0ba997f5f5ee7a36b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mS62GErb1Gn8C5RebSltg.png"/></div></div></figure><p id="08ef" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">啊哦！我们触发了著名的<code class="du kd ke kf kg b">SettingWithCopy</code>警告。</p><p id="0d0c" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">如果我们现在看一下数据帧，我们可以看到值没有更新。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="0fbe" class="kw kx hi kg b fi ky kz l la lb">car_sales[car_sales['Manufacturer'] == 'Porsche']</span></pre><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c89874ef28b1cabdf9df40809045d952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8O2B3gnUF_8suBAebZYXag.png"/></div></div></figure><p id="1149" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">我们必须明白<code class="du kd ke kf kg b"><em class="km">SettingWithCopy</em></code>是一个警告而不是一个错误。错误会破坏您的代码，并阻止您在没有修复它的情况下继续前进。但是，一个警告表明您的代码在产生输出时有问题。</p><p id="5be2" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">在这种情况下，有时我们可能会得到我们想要的输出，但也会忽略警告。但是我们永远不应该忽略这个警告，因为它意味着我们试图执行的操作可能没有像我们预期的那样工作，并且将来可能会出现一些意想不到的问题。</p><p id="8ac9" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">这些是熊猫的核心开发者之一Jeff Reback 关于为什么你永远不应该忽视这个警告的话。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/161a77f73585ee3147d30b04ae8a2954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*didSklby_TijqLpoKp8izA.png"/></div></div></figure><figure class="ko kp kq kr fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/75cb176b7e88cd4ccfc477f71ca00141.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*FCuBFPgUTvSnNu8ecPjspg.gif"/></div></figure><p id="f1bb" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">为了理解如何修复这个警告以及当我们面对它时该做什么，必须知道Pandas中视图和副本之间的区别以及它们是如何工作的。</p><h1 id="e3e1" class="lg kx hi bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">视图与副本</h1><p id="8a10" class="pw-post-body-paragraph jg jh hi ji b jj md jl jm jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc jf hb bi translated">在上面的代码中，我们试图从数据中返回所有Porsche汽车，我们得到的结果可能是一个视图或数据帧的副本。</p><p id="3d16" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">视图(或浅层副本)是原始对象的子集，它没有自己的内存和地址空间。它只是我们试图访问的对象的投影。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/35aeb3ba6550d2e70ca955f72acca206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*813kzGHXIxPolUyJjrMZ5w.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">数据帧的视图</figcaption></figure><p id="3a00" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">副本(或深层副本)是原始对象的副本，它有自己的内存和地址空间。这是一个独立的实体，一旦我们给熊猫做了手术，它就会被扔掉。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/93ae13698e571da4aaae66b91911f29b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15KsChaCaAOdQ-0o1vVuug.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">数据帧的副本</figcaption></figure><p id="1751" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">视图和副本之间的主要区别之一是，修改视图会修改原始数据帧，反之亦然，而修改副本不会影响原始数据帧。</p><p id="0637" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">假设我们把<code class="du kd ke kf kg b">Model</code> Boxter的车<code class="du kd ke kf kg b">sales_in_thousands</code> <em class="km"> </em>改成9.35。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/80646089421f6a9d048f20c140eac8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*naqZlfQ81u8YF5hjzFBmkw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">修改视图</figcaption></figure><p id="24ab" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">从上面可以看出，修改视图也会修改原始数据帧。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/701b115a7559e932d2c7868af5d44539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N7dlfaWabuKFC06ncjJvsA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">修改副本</figcaption></figure><p id="063d" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">相反，修改副本不一定会修改原始数据帧。</p><p id="b8f7" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">Pandas从底层Numpy数组获得了视图和副本的这种行为。Numpy数组仅限于一种数据类型，因此可以预测是返回视图还是副本。当Pandas使用其Numpy内核时，它遵循一套复杂的规则来优化空间并确定是返回视图还是副本。因此，每当我们索引一个数据帧时，没有固定的方法来预测是否返回一个视图或副本。引用熊猫文献，</p><blockquote class="iv"><p id="594f" class="iw ix hi bd iy iz mm mn mo mp mq jf dx translated">除了简单的情况之外，很难预测它将返回一个视图还是一个副本(这取决于数组的内存布局，对此pandas不做任何保证)……这就是SettingWithCopy警告你的！</p></blockquote><p id="5182" class="pw-post-body-paragraph jg jh hi ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc jf hb bi translated">要检查是否返回了视图或副本，您可以使用内部属性<code class="du kd ke kf kg b">_is_view</code>或<code class="du kd ke kf kg b">_is_copy</code>。_is_view返回布尔值，而_is_copy返回对原始数据帧的引用或无。</p><p id="669b" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">让我们看看遇到此警告的三个最常见的问题以及如何处理它们。</p><h1 id="7a22" class="lg kx hi bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">1.链式分配</h1><p id="4422" class="pw-post-body-paragraph jg jh hi ji b jj md jl jm jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc jf hb bi translated">Pandas生成此警告的最常见原因之一是当它检测到链式分配或链式索引时。</p><p id="58e4" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">我们对熊猫数据框架做了两件事，或者</p><ul class=""><li id="ce46" class="ms mt hi ji b jj kh jn ki jr mu jv mv jz mw jf mx my mz na bi translated">设定 —给某物赋值</li><li id="7241" class="ms mt hi ji b jj nb jn nc jr nd jv ne jz nf jf mx my mz na bi translated">或者，<strong class="ji hj"> Get </strong> —从某物中获取值</li></ul><p id="ce03" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">链式分配是指我们试图通过使用多个索引操作来分配(<strong class="ji hj"> set </strong>)某物。</p><p id="f791" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">回想一下我们之前使用的例子。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="0c74" class="kw kx hi kg b fi ky kz l la lb">car_sales[car_sales['Manufacturer'] == 'Porsche']['Fuel_capacity'] = 18.0</span></pre><p id="bc4c" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">这里，两个索引操作被组合来设置一个值。首先，我们尝试从数据帧中访问(<strong class="ji hj"> get </strong>)所有“保时捷”汽车，然后我们尝试为“燃油容量”分配(<strong class="ji hj"> set </strong>)一个新值。</p><p id="df59" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">我们希望修改原始数据帧，但此操作可能会尝试创建副本并修改它。这就是警告告诉我们的。<em class="km">‘试图在数据帧的一个片段的副本上设置一个值’。</em></p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/40c0e51185337f0ba997f5f5ee7a36b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mS62GErb1Gn8C5RebSltg.png"/></div></div></figure><p id="3c50" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">我们在上面讨论过，当我们试图访问(<strong class="ji hj"> get </strong>)一个操作的子集时，Pandas可以创建一个视图或者一个副本。</p><p id="f7f9" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">让我们看看我们试图执行的操作是在视图上还是在副本上。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="46fa" class="kw kx hi kg b fi ky kz l la lb">car_sales[car_sales['Manufacturer'] == 'Porsche']['Fuel_capacity']._is_view<br/><br/># output<br/>True</span><span id="7412" class="kw kx hi kg b fi ng kz l la lb">car_sales[car_sales['Manufacturer'] == 'Porsche']['Fuel_capacity']._is_copy<br/><br/>#output<br/>&lt;weakref at 0x7fe118b59b80; to 'DataFrame' at 0x7fe1187a14f0&gt;</span></pre><p id="213d" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated"><code class="du kd ke kf kg b">_is_view</code>返回了<code class="du kd ke kf kg b">True</code>,表示这是一个视图，而<code class="du kd ke kf kg b">_is_copy</code>返回了<code class="du kd ke kf kg b">weakref</code>,表示这是一个副本。因此，'<strong class="ji hj"> get </strong>'操作的输出不明确。最后可以是任何东西。这就是为什么无视<code class="du kd ke kf kg b">SettingWithCopy</code>的警告是一个坏主意。它最终会导致在您最意想不到的时候破坏代码中的某些东西。</p><p id="a04b" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">通过使用<code class="du kd ke kf kg b">.loc</code>将背靠背的索引操作合并成一个操作，可以很容易地解决链式分配的问题。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="23a1" class="kw kx hi kg b fi ky kz l la lb">car_sales.loc[car_sales.Manufacturer == 'Porsche', 'Fuel_capacity'] = 18.0<br/>car_sales[car_sales.Manufacturer == 'Porsche']['Fuel_capacity']<br/><br/>#output<br/>124    18.0<br/>125    18.0<br/>126    18.0<br/>Name: Fuel_capacity, dtype: float64</span></pre><h1 id="e45f" class="lg kx hi bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">2.隐藏链接</h1><p id="f0d8" class="pw-post-body-paragraph jg jh hi ji b jj md jl jm jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc jf hb bi translated">触发此警告的第二个最常见的原因是隐藏链接。追踪这个问题的根源可能很棘手，也很困难，因为它可能会跨越您的整个代码库。</p><p id="eff7" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">让我们看一个隐藏链接的场景。我们将继续创建一个包含所有'<em class="km">Chevrolet</em>'汽车的新数据框架，同时记住要使用上一课中的<code class="du kd ke kf kg b">.loc</code>。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="33fe" class="kw kx hi kg b fi ky kz l la lb">chevrolet_cars = car_sales.loc[car_sales.Manufacturer == 'Chevrolet']<br/>chevrolet_cars</span></pre><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nh"><img src="../Images/1e25f4d251e02414811f15287436a677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QIBgQCgxtye81AK9vmilA.png"/></div></div></figure><p id="d3b1" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">我们花一些时间做一些其他的操作，然后摆弄我们的代码。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="8faa" class="kw kx hi kg b fi ky kz l la lb">chevrolet_cars['Model'].value_counts()<br/>....<br/># few lines of code<br/>chevrolet_cars['Sales_in_thousands'].std()<br/>....<br/>chevrolet_cars['__year_resale_value'].max()<br/>....<br/># few lines of code<br/>chevrolet_cars.loc[20,'Price_in_thousands'] = 17.638</span></pre><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ni"><img src="../Images/5060c4d900b60ac18ff69bc33e760148.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gySV9tJHuAB2hXa8bMpNtQ.png"/></div></div></figure><p id="9ce3" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">嘣！又是这个警告！！</p><p id="ef28" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">在最后一行代码中没有链式赋值，但它仍然触发了警告。让我们看看数据框架中的值。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ni"><img src="../Images/ac05e441799b5893325c9b4c810e8bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8o5rNFq8IXTuD9lqTC2qHg.png"/></div></div></figure><p id="0302" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">它更新了我们的价值。那么，这次我们应该继续前进，忽略警告吗？大概不会。</p><p id="d152" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">这段代码中没有明显的链式赋值。实际上，它可能出现在一行代码中，甚至跨多行代码。当我们创建<code class="du kd ke kf kg b">chevrolet_cars</code>数据帧时，我们使用了一个<strong class="ji hj"> get </strong>操作。所以不能保证这是返回了一个<em class="km">视图</em>还是一个<em class="km">副本</em>。因此，我们也可能试图修改原始数据帧。</p><p id="3114" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">在跨越数千行代码的实际代码库中，识别这个问题可能非常繁琐，但解决这个问题非常简单。当您想要创建一个新的数据帧时，使用<code class="du kd ke kf kg b">.copy()</code>方法显式地创建一个<strong class="ji hj">副本</strong>。这将向熊猫清楚地表明，我们正在一个新的数据框架上操作。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="303b" class="kw kx hi kg b fi ky kz l la lb">chevrolet_cars = car_sales.loc[car_sales.Manufacturer == 'Chevrolet'].copy()<br/>chevrolet_cars.loc[20,'Price_in_thousands'] = 17.638<br/>chevrolet_cars.loc[20, 'Price_in_thousands']<br/><br/>#output<br/>17.638</span></pre><h1 id="804a" class="lg kx hi bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">3.假阳性</h1><p id="acf2" class="pw-post-body-paragraph jg jh hi ji b jj md jl jm jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc jf hb bi translated">误报是指警告在不该触发的时候被触发。在这种情况下，忽略警告是非常安全的。多年来，许多导致“假阳性”警告的情况已经在熊猫身上得到解决。如果你想看的话，在熊猫文档中有讨论。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nj"><img src="../Images/8a6d8c850c2c1f270d6ebc0cc18dcb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OTIAokBTfZHMZSv41jdpwQ.png"/></div></div></figure><p id="3e01" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">假设我们只想要将<code class="du kd ke kf kg b">Vehicle_type</code>作为<em class="km">乘客</em>的汽车，我们希望创建一个新列，该列将是一个布尔值，指示汽车是否可用。</p><pre class="ko kp kq kr fd ks kg kt ku aw kv bi"><span id="1be0" class="kw kx hi kg b fi ky kz l la lb">car_sales = car_sales[car_sales['Vehicle_type'] == 'Passenger']<br/>car_sales['In Stock'] = 'True'<br/><br/>#output<br/>:1: SettingWithCopyWarning: <br/>A value is trying to be set on a copy of a slice from a DataFrame.<br/>Try using .loc[row_indexer,col_indexer] = value instead</span></pre><p id="2612" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">如果您查看dataframe，它会更新新列。在这种情况下，如果它覆盖了原始的数据帧，我们也不会担心。</p><p id="ccc5" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">我们可以通过如下更改默认行为来取消警告，</p><ul class=""><li id="67b8" class="ms mt hi ji b jj kh jn ki jr mu jv mv jz mw jf mx my mz na bi translated"><code class="du kd ke kf kg b">pd.set_option(‘mode.chained_assignment’, None)</code> —抑制并关闭警告</li><li id="9dd5" class="ms mt hi ji b jj nb jn nc jr nd jv ne jz nf jf mx my mz na bi translated"><code class="du kd ke kf kg b">pd.set_option(‘mode.chained_assignment’, ‘Warn’)</code> —发出警告</li><li id="c38f" class="ms mt hi ji b jj nb jn nc jr nd jv ne jz nf jf mx my mz na bi translated"><code class="du kd ke kf kg b">pd.set_option(‘mode.chained_assignment’, ‘Raise’)</code> —引发异常</li></ul><p id="5e0d" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">除非你知道自己在做什么，否则不建议改变行为。</p><h2 id="6a31" class="kw kx hi bd lh nk nl nm ll nn no np lp jr nq nr lt jv ns nt lx jz nu nv mb nw bi translated">结束注释</h2><p id="e09c" class="pw-post-body-paragraph jg jh hi ji b jj md jl jm jn me jp jq jr mf jt ju jv mg jx jy jz mh kb kc jf hb bi translated">通过与熊猫清楚地沟通，大多数<code class="du kd ke kf kg b">SettingWithCopy</code>警告的情况都可以避免。当你想要修改原始数据帧时，使用<code class="du kd ke kf kg b">.loc</code>或当你想要一个副本时，直接指定。这不仅可以防止将来出现警告和错误，还可以使您的代码库在维护时更加健壮。</p><p id="048d" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">你可以在GitHub <a class="ae iu" href="https://github.com/pandas-dev/pandas/pull/5390" rel="noopener ugc nofollow" target="_blank"> #5390 </a>和<a class="ae iu" href="https://github.com/pandas-dev/pandas/issues/5597" rel="noopener ugc nofollow" target="_blank"> #5597 </a>上看看这些问题的背景讨论。</p><p id="d83a" class="pw-post-body-paragraph jg jh hi ji b jj kh jl jm jn ki jp jq jr kj jt ju jv kk jx jy jz kl kb kc jf hb bi translated">感谢您一路阅读到这里！如果你有任何反馈、批评或担忧，请在评论中告诉我。祝你今天开心！玩的开心！</p></div></div>    
</body>
</html>