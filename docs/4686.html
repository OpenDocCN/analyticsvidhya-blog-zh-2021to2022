<html>
<head>
<title>Training a model for custom object detection (TF 2.x) on Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Colab上训练自定义对象检测(TF 2.x)模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/training-a-model-for-custom-object-detection-tf-2-x-on-google-colab-4507f2cc6b80?source=collection_archive---------0-----------------------#2022-01-01">https://medium.com/analytics-vidhya/training-a-model-for-custom-object-detection-tf-2-x-on-google-colab-4507f2cc6b80?source=collection_archive---------0-----------------------#2022-01-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/65e76a599c8ac4dcfd735d69400ce1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TcpxAPxGpmna366Im2m1hg.png"/></div></div></figure><div class=""/><div class=""><h2 id="685f" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">使用TensorFlow对象检测API</h2></div><h1 id="0798" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">我在Youtube上的视频！</h1><figure class="ka kb kc kd fd hk"><div class="bz dy l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h2 id="64d3" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">在本教程中，我将在Google Colab上使用<strong class="ak"> TensorFlow 2.x </strong>训练一个用于自定义对象检测的深度学习模型。下面是它的路线图。</h2><h2 id="6f40" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">路标</h2><ul class=""><li id="360f" class="le lf ht lg b lh li lj lk ku ll kx lm la ln lo lp lq lr ls bi translated">收集图像数据集，并对它们进行标记，以获得它们的XML文件。</li><li id="8f2b" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">安装TensorFlow对象检测API。</li><li id="6466" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">生成培训所需的TFRecord文件。(为此需要生成_tfrecord.py脚本和CSV文件)</li><li id="964a" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">编辑模型管道配置文件，并下载预先训练的模型检查点。</li><li id="7a3e" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">训练和评估模型。</li></ul></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="0edc" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在这里，我正在训练一个自定义对象检测(人脸面具检测)的模型。这是通过下面提到的16个步骤完成的:</p><p id="0808" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">(但首先✅Subscribe到我的YouTube频道👉🏻https://bit.ly/3Ap3sdi<a class="ae mn" href="https://bit.ly/3Ap3sdi" rel="noopener ugc nofollow" target="_blank">😁😜)</a></p><ol class=""><li id="75eb" class="le lf ht lg b lh ma lj mc ku mo kx mp la mq lo mr lq lr ls bi translated"><a class="ae mn" href="#4364" rel="noopener ugc nofollow"> <strong class="lg hu">导入库</strong> </a></li><li id="b808" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#bb6b" rel="noopener ugc nofollow"> <strong class="lg hu">在google drive </strong> </a>中创建customTF2、training和data文件夹</li><li id="d25c" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#8841" rel="noopener ugc nofollow"> <strong class="lg hu">创建并上传您的图像文件和XML文件</strong> </a></li><li id="8be2" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#e2ca" rel="noopener ugc nofollow"> <strong class="lg hu">将generate_tfrecord.py文件上传到您的驱动器</strong> </a>中的customTF2文件夹</li><li id="1260" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#5a27" rel="noopener ugc nofollow"> <strong class="lg hu">挂载驱动并链接你的文件夹</strong> </a></li><li id="5dfa" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#863d" rel="noopener ugc nofollow"> <strong class="lg hu">克隆TensorFlow模型git库&amp;安装TensorFlow对象检测API </strong> </a></li><li id="82cb" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#6806" rel="noopener ugc nofollow"> <strong class="lg hu">测试模型构建器</strong> </a></li><li id="17bb" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#b513" rel="noopener ugc nofollow"> <strong class="lg hu">导航到<em class="ms">/my drive/custom tf2/data/</em>，将images.zip和annotations.zip文件解压到数据文件夹</strong> </a></li><li id="36f3" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><strong class="lg hu">C</strong><a class="ae mn" href="#065a" rel="noopener ugc nofollow"><strong class="lg hu">create test _ labels&amp;train _ labels</strong></a></li><li id="e77d" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#8978" rel="noopener ugc nofollow"> <strong class="lg hu">创建_CSV和“label_map.pbtxt”文件</strong> </a></li><li id="a935" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#041b" rel="noopener ugc nofollow"> <strong class="lg hu">创建‘train . record’&amp;【test . record】文件</strong> </a></li><li id="ceb5" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#b748" rel="noopener ugc nofollow"> <strong class="lg hu">下载预训练模型检查点</strong> </a></li><li id="aa19" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#9634" rel="noopener ugc nofollow"> <strong class="lg hu">获取模型管线配置文件，对其进行修改，并将其放入数据文件夹</strong> </a></li><li id="df8c" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#6dfc" rel="noopener ugc nofollow"> <strong class="lg hu">负载张量板</strong> </a></li><li id="e79e" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#5a3a" rel="noopener ugc nofollow"> <strong class="lg hu">训练模型</strong> </a></li><li id="0475" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo mr lq lr ls bi translated"><a class="ae mn" href="#666a" rel="noopener ugc nofollow"> <strong class="lg hu">测试你训练好的模型</strong> </a></li></ol></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="ff04" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">如何开始？</h1><ul class=""><li id="0ab7" class="le lf ht lg b lh li lj lk ku ll kx lm la ln lo lp lq lr ls bi translated">在您的浏览器上打开我的<a class="ae mn" href="https://colab.research.google.com/drive/1QCU_dCR0ozI8j6X2btEDCsaUk5p_b1uw?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Colab笔记本</a>。</li><li id="c0aa" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">点击菜单栏中的<strong class="lg hu">文件</strong>并点击<strong class="lg hu">在驱动器</strong>中保存一份副本。这将在您的浏览器上打开我的Colab笔记本的副本，您现在可以使用它了。</li><li id="befc" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">接下来，一旦你打开了我的笔记本的副本，并连接到Google Colab虚拟机，点击菜单栏中的<strong class="lg hu">运行时</strong>，并点击<strong class="lg hu">更改运行时类型</strong>。选择<strong class="lg hu"> GPU </strong>并点击保存。</li></ul></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="2906" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">我们开始吧！！</h1><h1 id="4364" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">1)导入库</h1><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="6b12" class="kn jj ht mz b fi nd ne l nf ng">import os<br/>import glob<br/>import xml.etree.ElementTree as ET<br/>import pandas as pd<br/>import tensorflow as tf</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="bb6b" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">2)在google drive中创建customTF2、training和data文件夹</h1><p id="a610" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">在google drive中创建一个名为<strong class="lg hu"> <em class="ms"> customTF2 </em> </strong>的文件夹。</p><p id="cc4f" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在<strong class="lg hu"> <em class="ms"> customTF2 </em> </strong>文件夹内再创建一个文件夹，名为<strong class="lg hu"><em class="ms">training</em></strong>(<strong class="lg hu"><em class="ms">training</em></strong>文件夹是训练时保存检查点的地方)。</p><p id="e094" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在<strong class="lg hu"> <em class="ms"> customTF2 </em> </strong>文件夹内创建另一个名为<strong class="lg hu"> <em class="ms"> data </em> </strong>的文件夹。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="8841" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">3)创建并上传您的图像文件及其相应的带标签的XML文件。</h1><p id="a520" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">为您的自定义数据集图像创建一个名为<strong class="lg hu"> <em class="ms"> images </em> </strong>的文件夹，并为其对应的PASCAL_VOC格式的XML文件创建另一个名为<strong class="lg hu"> <em class="ms"> annotations </em> </strong>的文件夹。</p><p id="b57e" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">接下来，创建他们的zip文件并上传到你的驱动器中的<strong class="lg hu"> <em class="ms"> customTF2 </em> </strong>文件夹。</p><blockquote class="nk nl nm"><p id="43dc" class="ly lz ms lg b lh ma iu mb lj mc ix md nn me mf mg no mh mi mj np mk ml mm lo hb bi translated"><strong class="lg hu"> <em class="ht">确保所有的图像文件的扩展名都为”。仅jpg”。</em> </strong></p><p id="2aca" class="ly lz ms lg b lh ma iu mb lj mc ix md nn me mf mg no mh mi mj np mk ml mm lo hb bi translated"><em class="ht">其他格式如</em> <strong class="lg hu"> <em class="ht"> &lt;。png &gt;，&lt;。jpeg &gt; </em> </strong> <em class="ht">会给出错误自</em><strong class="lg hu"><em class="ht"/>generate _ TF record<em class="ht"/></strong><em class="ht">和</em><strong class="lg hu"><em class="ht"/>XML _ to _ CSV<em class="ht"/></strong><em class="ht">脚本这里只有</em> <strong class="lg hu"> <em class="ht"> &lt;。jpg &gt; </em> </strong> <em class="ht">在其中。如果您有其他格式的图像，您可以相应地在脚本中进行更改。</em></p></blockquote><p id="540b" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">对于数据集，您可以在本文底部的致谢部分查看我的数据集来源。</p><h2 id="2c9f" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">收集图像数据集并标记它们以获得它们的PASCAL_VOC XML注释。</h2><h2 id="19be" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">标注数据集</h2><p id="38c3" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">输入图像示例(<strong class="lg hu">Image1.jpg</strong>)</p><figure class="ka kb kc kd fd hk er es paragraph-image"><div class="er es nq"><img src="../Images/0567b1afb19a8a84a79ccef927b1666e.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*sRyrsdgJxTS7z5OV.jpeg"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="164b" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">您可以使用任何软件进行贴标，如<a class="ae mn" href="https://github.com/tzutalin/labelImg#labelimg" rel="noopener ugc nofollow" target="_blank"> <strong class="lg hu">贴标</strong> </a>工具。</p><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nr"><img src="../Images/d2fbf42863ffe11d23f928d0fbb0dc89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vdvDkNBXy3kkdfo3.png"/></div></div></figure><p id="8491" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">我使用一个叫做<strong class="lg hu"> OpenLabeling </strong>的开源标签工具，它有一个非常简单的UI。</p><figure class="ka kb kc kd fd hk er es paragraph-image"><div class="er es ns"><img src="../Images/5042e2f5ed9c0cfd417609cf1d680687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*A2tSsDlnDSOvAnxV.gif"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="e248" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">点击下面的链接，了解更多关于贴标过程和其他软件的信息:</p><ul class=""><li id="7c7b" class="le lf ht lg b lh ma lj mc ku mo kx mp la mq lo lp lq lr ls bi translated"><a class="ae mn" href="https://techzizou.com/dataset-labeling-annotation-tutorial-for-beginners/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg hu">影像数据集标注条</strong> </a></li></ul><p id="ed76" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">注:</strong>垃圾入=垃圾出。选择和标记图像是最重要的部分。尽量找质量好的图片。数据的质量在很大程度上决定了结果的质量。</p><p id="c446" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">输出的PASCAL_VOC标记的XML文件如下所示:</p><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/75e156df3e082b863032d1cb343f9ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T1DUBPk6o6S3jdmu.png"/></div></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="e2ca" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">4)将generate_tfrecord.py文件上传到驱动器中的customTF2文件夹。</h1><p id="7eac" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">你可以在这里找到generate_tfrecord.py文件<a class="ae mn" href="https://github.com/techzizou/Train-Object-Detection-Model-TF-2.x" rel="noopener ugc nofollow" target="_blank"/></p><figure class="ka kb kc kd fd hk"><div class="bz dy l di"><div class="nu kf l"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="5a27" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">5)安装驱动器并链接您的文件夹</h1><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="eec4" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu">#mount drive</strong></span><span id="c976" class="kn jj ht mz b fi nv ne l nf ng">from google.colab import drive<br/>drive.mount('/content/gdrive')</span><span id="320f" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu"># this creates a symbolic link so that now the path /content/gdrive/My Drive/ is equal to /mydrive</strong></span><span id="96b5" class="kn jj ht mz b fi nv ne l nf ng">!ln -s /content/gdrive/My Drive/ /mydrive<br/>!ls /mydrive</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="863d" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">6)克隆TensorFlow模型git存储库并安装TensorFlow对象检测API</h1><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="72df" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu"># clone the tensorflow models on the colab cloud vm</strong></span><span id="e27e" class="kn jj ht mz b fi nv ne l nf ng">!git clone --q https://github.com/tensorflow/models.git</span><span id="6182" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu"># navigate to /models/research folder to compile protos</strong></span><span id="49e2" class="kn jj ht mz b fi nv ne l nf ng">%cd models/research</span><span id="a93b" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu"># Compile protos.</strong></span><span id="4d17" class="kn jj ht mz b fi nv ne l nf ng">!protoc object_detection/protos/*.proto --python_out=.</span><span id="8321" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu"># Install TensorFlow Object Detection API.</strong></span><span id="6413" class="kn jj ht mz b fi nv ne l nf ng">!cp object_detection/packages/tf2/setup.py .<br/>!python -m pip install .</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="6806" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">7)测试模型构建器</h1><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="c533" class="kn jj ht mz b fi nd ne l nf ng">!python object_detection/builders/model_builder_tf2_test.py</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="b513" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">8)导航到/mydrive/customTF2/data/</h1><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="5b8c" class="kn jj ht mz b fi nd ne l nf ng">%cd /mydrive/customTF2/data/</span><span id="131e" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu"># unzip the datasets and their contents so that they are now in /mydrive/customTF2/data/ folder</strong></span><span id="755c" class="kn jj ht mz b fi nv ne l nf ng">!unzip /mydrive/customTF2/images.zip -d .<br/>!unzip /mydrive/customTF2/annotations.zip -d .</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="065a" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">9)创建测试标签和训练标签</h1><p id="4d11" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录为<strong class="lg hu"><em class="ms">/my drive/custom tf2/data/</em></strong></p><p id="7cdb" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">将标注分为test_labels(20%)和train_labels(80%)。</p><figure class="ka kb kc kd fd hk"><div class="bz dy l di"><div class="nu kf l"/></div></figure><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/61abd3e006be7d45172d1efa7dcbdd9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nUHQLp8S8ZSIFxt-.png"/></div></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="8978" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">10)创建CSV文件和“label_map.pbtxt”文件</h1><p id="9d3e" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录为<strong class="lg hu"><em class="ms">/my drive/custom tf2/data/</em></strong></p><p id="3440" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">运行下面的xml_to_csv脚本，创建<strong class="lg hu"><em class="ms">test _ labels . CSV</em></strong>和<strong class="lg hu"><em class="ms">train _ labels . CSV</em></strong></p><p id="6fca" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">该脚本还使用xml文件中提到的类创建了<strong class="lg hu"><em class="ms">label _ map . Pb txt</em></strong>文件。</p><figure class="ka kb kc kd fd hk"><div class="bz dy l di"><div class="nu kf l"/></div></figure><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/803ffbd96ccca46885a5241bc9d6647e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tk3GVCUx2lG6DI_-.png"/></div></div></figure><p id="ffd9" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">创建的3个文件，即<strong class="lg hu"> train_labels.csv </strong>、<strong class="lg hu"> test_labels.csv </strong>和<strong class="lg hu"> label_map.pbtxt </strong>，如下图所示:</p><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nw"><img src="../Images/52933be6f475461d626d0c8025e3421c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VjEjcHkUgoLcZ9IU"/></div></div></figure><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nx"><img src="../Images/1663776f483dd6823a7b908cbdf4e643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TEPuGWorSmpVlIqn"/></div></div></figure><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ny"><img src="../Images/1065297ea4522e831b9030477daffcad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JG7SK8DdWEWOab2s"/></div></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><p id="08f2" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">train_labels.csv包含所有训练图像的名称、这些图像中的类及其注释。</p><p id="1356" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu"> test_labels.csv </strong>包含了所有测试图像的名称，这些图像中的类，以及它们的注释。</p><p id="28cf" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu"> label_map.pbtxt </strong>文件包含来自您的带标签的XML文件的类名。</p><p id="be95" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">注意:</strong>我有两个类，即“带_mask”和“不带_mask”。</p><blockquote class="nk nl nm"><p id="1fb0" class="ly lz ms lg b lh ma iu mb lj mc ix md nn me mf mg no mh mi mj np mk ml mm lo hb bi translated"><em class="ht">标签映射id 0为背景标签保留。</em></p></blockquote></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="041b" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">11)创建训练记录和测试记录文件</h1><p id="5a1b" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录为<strong class="lg hu"><em class="ms">/my drive/custom tf2/data/</em></strong></p><p id="0dda" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">运行<strong class="lg hu"><em class="ms">generate _ TF record . py</em></strong>脚本，创建<strong class="lg hu"> <em class="ms"> train.record </em> </strong>和<strong class="lg hu"> <em class="ms"> test.record </em> </strong>文件</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="82da" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu">#Usage:</strong><br/>#!python generate_tfrecord.py output.csv output_pb.txt /path/to/images output.tfrecords</span><span id="81ef" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">#For train.record</strong><br/>!python /mydrive/customTF2/generate_tfrecord.py train_labels.csv  label_map.pbtxt images/ train.record</span><span id="7de3" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">#For test.record</strong><br/>!python /mydrive/customTF2/generate_tfrecord.py test_labels.csv  label_map.pbtxt images/ test.record</span></pre><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nw"><img src="../Images/a18a5428d74a8b9cbb7f5f755e7467d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LBxvAQTObz-fX8y8.png"/></div></div></figure><p id="0255" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">图像文件的总数是1370。因为我们将标签分为两类，即。train_labels(80%)和test_labels(20%)，“<strong class="lg hu">train . record”</strong>的文件数为1096，“<strong class="lg hu"> test.record </strong>的文件数为274。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="b748" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">12)下载预先训练的模型检查点</h1><p id="4022" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录为<strong class="lg hu"><em class="ms">/my drive/custom tf2/data/</em></strong></p><p id="155e" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">根据您的数据和要求，您可以选择任何模型进行培训。阅读<a class="ae mn" href="https://serokell.io/blog/how-to-choose-ml-technique" rel="noopener ugc nofollow" target="_blank">这篇</a>博客，了解更多这方面的信息。TensorFlow 2.x的检测模型检查点官方列表可以在<a class="ae mn" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="ec5e" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在本教程中，我将使用<strong class="lg hu">SSD _ mobilenet _ v2 _ fpnlite _ 320 x320 _ coco 17 _ TPU-8</strong>模型。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="372e" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu"># Download the pre-trained model ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.tar.gz into the <em class="ms">data</em> folder &amp; unzip it</strong></span><span id="b9ec" class="kn jj ht mz b fi nv ne l nf ng">!wget http://download.tensorflow.org/models/object_detection/tf2/20200711/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.tar.gz</span><span id="59b5" class="kn jj ht mz b fi nv ne l nf ng">!tar -xzvf ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.tar.gz</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="9634" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">13)获取模型管线配置文件，对其进行更改，并将其放入数据文件夹中</h1><p id="d8c7" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录为<strong class="lg hu"><em class="ms">/my drive/custom tf2/data/</em></strong></p><p id="7ca1" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">从<strong class="lg hu"><em class="ms">/content/models/research/object _ detection/configs/tf2</em></strong>下载<strong class="lg hu">SSD _ mobilenet _ v2 _ fpn lite _ 320 _ coco 17 _ TPU-8 . config</strong>。对其进行必要的修改，并上传到<strong class="lg hu"><em class="ms">/my drive/custom/data</em></strong>文件夹。</p><p id="38d1" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">或</strong></p><p id="1dd5" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在colab vm中编辑<strong class="lg hu"><em class="ms">/content/models/research/object _ detection/configs/tf2</em></strong>中的配置文件，并将编辑后的配置文件复制到<strong class="lg hu"><em class="ms">/my drive/custom tf2/data</em></strong>文件夹中。</p><p id="f6ea" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">您还可以在我们在上一步中刚刚下载的模型检查点文件夹中找到管道配置文件。</p><p id="3446" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">你需要做如下修改:</strong></p><ul class=""><li id="9017" class="le lf ht lg b lh ma lj mc ku mo kx mp la mq lo lp lq lr ls bi translated">将<strong class="lg hu"> <em class="ms"> num_classes </em> </strong>更改为您的类数。</li><li id="bb7c" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">将<strong class="lg hu"><em class="ms">test . record</em></strong>path、<strong class="lg hu"><em class="ms">train . record</em></strong>path&amp;<strong class="lg hu"><em class="ms">label map</em></strong>path改为您创建这些文件的路径(训练时路径应该相对于您当前的工作目录)。</li><li id="d289" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">将<strong class="lg hu"> <em class="ms">微调检查点</em> </strong>改为步骤12下载的检查点所在的目录路径。</li><li id="904f" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">根据类型，用值<strong class="lg hu">分类</strong>或<strong class="lg hu">检测</strong>改变<strong class="lg hu"> <em class="ms">微调检查点类型</em> </strong>。</li><li id="353e" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">根据您的GPU的能力，将<strong class="lg hu"> <em class="ms"> batch_size </em> </strong>更改为8的任意倍数。(例如:- 24，128，…，512)。GPU能力越好，你能走的越高。我的设置为64。</li><li id="e4c7" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">将<strong class="lg hu"> <em class="ms"> num_steps </em> </strong>更改为您希望探测器训练的步数。</li></ul><blockquote class="nk nl nm"><p id="8e9d" class="ly lz ms lg b lh ma iu mb lj mc ix md nn me mf mg no mh mi mj np mk ml mm lo hb bi translated">最大批量大小=可用GPU内存字节数/ 4 /(张量大小+可训练参数)</p></blockquote><p id="b8ce" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">接下来，复制编辑好的配置文件</strong>。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="94f3" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu"># copy the edited config file from the configs/tf2 directory to the data/ folder in your drive</strong></span><span id="95ce" class="kn jj ht mz b fi nv ne l nf ng">!cp /content/models/research/object_detection/configs/tf2/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.config /mydrive/customTF2/data</span></pre><p id="a1a3" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">此时的工作区:</strong></p><figure class="ka kb kc kd fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nz"><img src="../Images/3cdd6ce08810627248afc2ab823075fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1UCYmc_Wvuj95-jJ_jfLw.jpeg"/></div></div></figure><blockquote class="nk nl nm"><p id="47b7" class="ly lz ms lg b lh ma iu mb lj mc ix md nn me mf mg no mh mi mj np mk ml mm lo hb bi translated">您可以添加许多数据扩充选项。查看完整列表<a class="ae mn" href="https://github.com/tensorflow/models/blob/master/research/object_detection/protos/preprocessor.proto" rel="noopener ugc nofollow" target="_blank"> <em class="ht">此处</em> </a>。对于新手来说，以上改动就足够了。</p></blockquote><h2 id="7418" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">数据扩充建议(可选)</h2><p id="db15" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">首先，您应该使用带有上述基本更改的示例配置文件来训练模型，并看看它做得如何。如果你过拟合，那么你可能想做一些更多的图像放大。</p><p id="cc4c" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在示例配置文件中:默认添加<code class="du oa ob oc mz b"><strong class="lg hu">random_horizontal_flip</strong></code> &amp; <code class="du oa ob oc mz b"><strong class="lg hu">ssd_random_crop</strong></code>。您也可以尝试添加以下内容:</p><p id="ff99" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">(<strong class="lg hu">注</strong>:每次图像增强都会大幅增加训练时间)</p><ol class=""><li id="3d6a" class="le lf ht lg b lh ma lj mc ku mo kx mp la mq lo mr lq lr ls bi translated">来自<strong class="lg hu">列车配置{}: </strong></li></ol><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="502d" class="kn jj ht mz b fi nd ne l nf ng">data_augmentation_options {<br/>    random_adjust_contrast {<br/>    }<br/>  }<br/>  data_augmentation_options {<br/>    random_rgb_to_gray {<br/>    }<br/>  }<br/>  data_augmentation_options {<br/>    random_vertical_flip {<br/>    }<br/>  }<br/>  data_augmentation_options {<br/>    random_rotation90 {<br/>    }<br/>  }<br/>  data_augmentation_options {<br/>    random_patch_gaussian {<br/>    }<br/>  }</span></pre><p id="9da7" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">2.在<strong class="lg hu">型号{ }&gt;SSD { }&gt;box _ predictor { }:</strong>将<code class="du oa ob oc mz b"><strong class="lg hu">use_dropout</strong></code>设置为<code class="du oa ob oc mz b">true</code>这将帮助您应对过度拟合。</p><p id="b9f7" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">3.在<strong class="lg hu"> eval_config : {} </strong>设置<code class="du oa ob oc mz b"><strong class="lg hu">num_examples</strong></code>中的<strong class="lg hu">测试</strong>图像的数量，并移除<code class="du oa ob oc mz b"><strong class="lg hu">max_eval</strong></code>以无限期评估</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="10c1" class="kn jj ht mz b fi nd ne l nf ng">eval_config: {<br/>  num_examples: 274 # set this to the number of test images we divided earlier<br/>  num_visualizations: 20 # the number of visualization to see in tensorboard<br/>}</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="6dfc" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">14)加载张量板</h1><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="b903" class="kn jj ht mz b fi nd ne l nf ng">%load_ext tensorboard<br/>%tensorboard --logdir '/content/gdrive/MyDrive/customTF2/training'</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="5a3a" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">15)训练模型</h1><p id="e59d" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">导航到Colab VM中的<strong class="lg hu"><em class="ms">object _ detection</em></strong>文件夹</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="7036" class="kn jj ht mz b fi nd ne l nf ng">%cd /content/models/research/object_detection</span></pre><h2 id="390e" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">15 (a)使用model_main_tf2.py进行培训</h2><p id="651a" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">这里<strong class="lg hu"> {PIPELINE_CONFIG_PATH} </strong>指向管道配置，<strong class="lg hu"> {MODEL_DIR} </strong>指向训练检查点和事件将被写入的目录。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="16ab" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu">#Run the command below from the content/models/research/object_detection directory</strong></span><span id="6295" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">"""<br/>PIPELINE_CONFIG_PATH=path/to/pipeline.config<br/>MODEL_DIR=path to training checkpoints directory<br/>NUM_TRAIN_STEPS=50000<br/>SAMPLE_1_OF_N_EVAL_EXAMPLES=1</strong></span><span id="b014" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">python model_main_tf2.py -- \<br/>--model_dir=$MODEL_DIR --num_train_steps=$NUM_TRAIN_STEPS \<br/>--sample_1_of_n_eval_examples=$SAMPLE_1_OF_N_EVAL_EXAMPLES \<br/>--pipeline_config_path=$PIPELINE_CONFIG_PATH \<br/>--alsologtostderr</strong></span><span id="1c2a" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">"""</strong></span><span id="19ab" class="kn jj ht mz b fi nv ne l nf ng">!python model_main_tf2.py --pipeline_config_path=/mydrive/customTF2/data/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.config --model_dir=/mydrive/customTF2/training --alsologtostderr</span></pre><p id="142b" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">注:</strong></p><p id="821f" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">为了获得最佳结果，如果可能的话，应该在损失小于0.1时停止训练，否则训练模型，直到损失暂时没有任何显著变化。理想的损耗应该在0.05以下(在不过度拟合模型的情况下，尽量让损耗尽可能低。如果模型已经收敛，不要在训练步骤上走得太高，以试图降低损失。如果它不能进一步显著减少损失，并且需要一段时间才能下降。)</p><p id="367e" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">理想情况下，我们希望损失尽可能低，但我们应该小心，以免模型过度拟合。您可以将步数减少到50000，并检查损失是否低于0.1，如果没有，则可以用更高的步数重新训练模型。</p><p id="b668" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">输出通常看起来像是“冻结”了，但不要急于取消该过程。默认情况下，训练仅每100步输出一次日志，因此，如果您等待一段时间，您应该会在第100步看到一个丢失日志。您应该等待的时间可能会有很大的不同，这取决于您是否使用GPU以及在配置文件中为<code class="du oa ob oc mz b">batch_size</code>选择的值，所以请耐心等待。</p><h2 id="9b2c" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">15 (b)使用model_main_tf2.py的评估(可选)</h2><p id="1bb0" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">您可以打开另一个colab笔记本，同时运行这个命令和上面的训练命令(不要忘记安装驱动器，克隆TF git repo，并在那里安装TF2对象检测API)。这将给你验证损失，地图等，所以你有一个更好的想法如何你的模型执行。</p><p id="cca0" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">这里<strong class="lg hu">{检查点目录} </strong>指向包含训练作业产生的检查点的目录。评估事件被写入<strong class="lg hu">{模型_目录/评估} </strong>。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="14f6" class="kn jj ht mz b fi nd ne l nf ng"><strong class="mz hu"># Run the command below from the content/models/research/object_detection directory</strong></span><span id="86ed" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">"""<br/>PIPELINE_CONFIG_PATH=path/to/pipeline.config<br/>MODEL_DIR=path to training checkpoints directory<br/>CHECKPOINT_DIR=${MODEL_DIR}<br/>NUM_TRAIN_STEPS=50000<br/>SAMPLE_1_OF_N_EVAL_EXAMPLES=1</strong></span><span id="4fba" class="kn jj ht mz b fi nv ne l nf ng"><strong class="mz hu">python model_main_tf2.py -- \<br/>--model_dir=$MODEL_DIR --num_train_steps=$NUM_TRAIN_STEPS \<br/>--checkpoint_dir=${CHECKPOINT_DIR} \<br/>--sample_1_of_n_eval_examples=$SAMPLE_1_OF_N_EVAL_EXAMPLES \<br/>--pipeline_config_path=$PIPELINE_CONFIG_PATH \<br/>--alsologtostderr<br/>"""</strong></span><span id="273d" class="kn jj ht mz b fi nv ne l nf ng">!python model_main_tf2.py --pipeline_config_path=/mydrive/customTF2/data/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.config --model_dir=/mydrive/customTF2/training/ --checkpoint_dir=/mydrive/customTF2/training/ --alsologtostderr</span></pre><h2 id="8c79" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">重新训练模型(以防断线)</h2><p id="5a37" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">如果您在Colab VM上断开连接或丢失会话，您可以从您停止的地方开始您的培训，因为检查点保存在您的驱动器上的<strong class="lg hu"> <em class="ms"> training </em> </strong>文件夹中。要重新开始训练，只需运行<strong class="lg hu">步骤1、5、6、7、14和15。</strong></p><p id="b33d" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">请注意，由于我们拥有培训所需的所有文件，如记录文件、编辑过的管道配置文件、label_map文件和模型检查点文件夹，因此我们不需要再次创建这些文件。</p><p id="e413" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">【The model _ main _ tf2.py脚本每1000步保存一次检查点。训练会自动从上次保存的检查点重新开始。</p><p id="9731" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">但是，如果您发现它没有从最后一个检查点重新开始训练，您可以在管道配置文件中进行1处更改。将<strong class="lg hu"> fine_tune_checkpoint </strong>更改为写入最新训练检查点的位置，并使其指向最新检查点，如下所示:</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="47a1" class="kn jj ht mz b fi nd ne l nf ng">fine_tune_checkpoint: "/mydrive/customTF2/training/ckpt-X" (where ckpt-X is the latest checkpoint)</span></pre><p id="9cda" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">阅读<a class="ae mn" href="https://tensorflow-object-detection-api-tutorial.readthedocs.io/en/latest/training.html#" rel="noopener ugc nofollow" target="_blank">这篇</a> TensorFlow物体检测API教程，了解更多关于TF2的培训过程。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="666a" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">16)测试您训练过的自定义对象检测模型</h1><h2 id="9817" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">导出推理图</h2><p id="b2ae" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录是<strong class="lg hu"><em class="ms">/内容/模型/研究/对象_检测</em> </strong></p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="b776" class="kn jj ht mz b fi nd ne l nf ng">!python exporter_main_v2.py --trained_checkpoint_dir=/mydrive/customTF2/training --pipeline_config_path=/content/gdrive/MyDrive/customTF2/data/ssd_mobilenet_v2_fpnlite_320x320_coco17_tpu-8.config --output_directory /mydrive/customTF2/data/inference_graph</span></pre><p id="b418" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">注意</strong>:上述命令中的<em class="ms"> trained_checkpoint_dir </em>参数需要训练目录的路径。有一个名为“检查点”的文件，其中保存了所有的模型路径和最新的模型检查点路径。因此它会自动使用最新的检查点。在我的例子中，检查点文件中为最新的model_checkpoint_path写入了ckpt-36。</p><p id="950e" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">对于<em class="ms"> pipeline_config_path </em>，给出我们用来训练上述模型的已编辑配置文件的路径。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h2 id="34a1" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">在图像上测试您训练的自定义对象检测模型</h2><p id="17cb" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">当前工作目录为<strong class="lg hu"><em class="ms">/内容/模型/研究/对象_检测</em> </strong></p><p id="8ad2" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">这一步是可选的。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="d3e6" class="kn jj ht mz b fi nd ne l nf ng"># <strong class="mz hu">Different font-type and font-size for labels text</strong></span><span id="6faf" class="kn jj ht mz b fi nv ne l nf ng">!wget https://freefontsdownload.net/download/160187/arial.zip<br/>!unzip arial.zip -d .</span><span id="7371" class="kn jj ht mz b fi nv ne l nf ng">%cd utils/<br/>!sed -i "s/font = ImageFont.truetype('arial.ttf', 24)/font = ImageFont.truetype('arial.ttf', 50)/" visualization_utils.py<br/>%cd ..</span></pre><h2 id="b23d" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">测试您训练好的模型</h2><figure class="ka kb kc kd fd hk"><div class="bz dy l di"><div class="nu kf l"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="a5f5" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">对于网络摄像头捕捉或视频测试:</h1><p id="dd17" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">使用<a class="ae mn" href="https://colab.research.google.com/drive/17ej2V3gUg6PTl6PpyYjKWtTdFWLEEOGh?usp=sharing" rel="noopener ugc nofollow" target="_blank">这款colab笔记本</a>。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="42b6" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">注意:</h1><p id="9101" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">我收集的用于遮罩检测的数据集主要包含特写图像。你可以在网上搜索更多的长镜头图片。有很多网站可以下载有标签和无标签的数据集。我在数据集来源下面给出了一些链接。我也给出了一些掩膜数据集的链接。其中一些有超过10，000张图片。</p><p id="2f10" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">虽然我们可以对我们的训练配置文件进行某些调整和更改，或者通过增强为每种类型的对象类向数据集添加更多图像，但我们必须小心，以免导致影响模型准确性的过度拟合。</p><p id="5100" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">对于初学者，你可以简单地使用我上传到GitHub <strong class="lg hu">上的配置文件开始。</strong>我还上传了我的掩模图像数据集以及PASCAL_VOC格式的文本文件，虽然这可能不是最好的，但将为您提供一个如何使用SSD模型训练您自己的自定义对象检测器的良好开端。你可以找到一个质量更好的带标签的数据集或者一个不带标签的数据集，以后自己标注。</p><figure class="ka kb kc kd fd hk er es paragraph-image"><div class="er es ns"><img src="../Images/969bcacae549a6bcdc126603627b09d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*GCfoN3Tt_kFHF92d.gif"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="8d86" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">我的GitHub</h1><p id="3169" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">培训文件</p><div class="hh hi ez fb hj od"><a href="https://github.com/techzizou/Train-Object-Detection-Model-TF-2.x" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hu fi z dy oi ea eb oj ed ef hs bi translated">GitHub-techzizou/Train-Object-Detection-Model-TF-2 . x:训练一个自定义的对象检测模型，使用…</h2><div class="ok l"><h3 class="bd b fi z dy oi ea eb oj ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or hp od"/></div></div></a></div><h1 id="973b" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">我的掩膜数据集</h1><div class="hh hi ez fb hj od"><a href="https://www.kaggle.com/techzizou/labeled-mask-dataset-pascal-voc-format" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hu fi z dy oi ea eb oj ed ef hs bi translated">带标签的掩膜数据集(PASCAL_VOC)</h2><div class="ok l"><h3 class="bd b fi z dy oi ea eb oj ed ef dx translated">PASCAL_VOC格式XML注释</h3></div><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">www.kaggle.com</p></div></div><div class="om l"><div class="os l oo op oq om or hp od"/></div></div></a></div><h1 id="9024" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">我的Colab笔记本</h1><div class="hh hi ez fb hj od"><a href="https://colab.research.google.com/drive/1QCU_dCR0ozI8j6X2btEDCsaUk5p_b1uw?usp=sharing" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hu fi z dy oi ea eb oj ed ef hs bi translated">TECHZIZOU '</h2><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">自定义对象检测TensorFlow 2.x</p></div></div><div class="om l"><div class="ot l oo op oq om or hp od"/></div></div></a></div></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="6ca0" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">如果你觉得这篇文章有帮助，请订阅我的YouTube频道，并考虑在YouTube、Medium或以下任何🖖上支持我</h1><div class="hh hi ez fb hj od"><a href="https://www.youtube.com/techzizou" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hu fi z dy oi ea eb oj ed ef hs bi translated">泰克齐祖</h2><div class="ok l"><h3 class="bd b fi z dy oi ea eb oj ed ef dx translated">创建人工智能、机器学习、深度学习、计算机视觉、物体检测、图像等方面的视频教程</h3></div><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">www.youtube.com/techzizouizichtech</p></div></div><div class="om l"><div class="ou l oo op oq om or hp od"/></div></div></a></div><div class="hh hi ez fb hj od"><a href="https://www.buymeacoffee.com/techzizou" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hu fi z dy oi ea eb oj ed ef hs bi translated">给我买杯咖啡！</h2><div class="ok l"><h3 class="bd b fi z dy oi ea eb oj ed ef dx translated">嘿，👋我正在创建技术博客和视频。你现在可以给我买杯咖啡来支持我的频道了！</h3></div><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">www.buymeacoffee.com/techzizou</p></div></div></div></a></div><div class="hh hi ez fb hj od"><a href="https://www.patreon.com/techzizou" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab dw"><div class="of ab og cl cj oh"><h2 class="bd hu fi z dy oi ea eb oj ed ef hs bi translated">订阅模式</h2><div class="ok l"><h3 class="bd b fi z dy oi ea eb oj ed ef dx translated">立即成为TechZizou的赞助人:获得世界上最大的会员的独家内容和体验…</h3></div><div class="ol l"><p class="bd b fp z dy oi ea eb oj ed ef dx translated">www.patreon.com/techzizou</p></div></div><div class="om l"><div class="ov l oo op oq om or hp od"/></div></div></a></div></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="793d" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">看看我在Youtube上的视频</h1><figure class="ka kb kc kd fd hk"><div class="bz dy l di"><div class="ke kf l"/></div></figure></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="e8ec" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">信用</h1><h2 id="a20b" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">文件/参考资料</h2><ul class=""><li id="342b" class="le lf ht lg b lh li lj lk ku ll kx lm la ln lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/tensorflow" rel="noopener ugc nofollow" target="_blank"> Tensorflow简介</a></li><li id="0b4a" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models" rel="noopener ugc nofollow" target="_blank"> Tensorflow模型Git库</a></li><li id="c804" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank"> TensorFlow对象检测API库</a></li><li id="63b0" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://tensorflow-object-detection-api-tutorial.readthedocs.io/en/latest/training.html#" rel="noopener ugc nofollow" target="_blank"> TensorFlow物体检测API教程</a></li><li id="cc7b" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models/tree/master/research/object_detection/g3doc" rel="noopener ugc nofollow" target="_blank"> TF对象检测文档</a></li><li id="1649" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2.md" rel="noopener ugc nofollow" target="_blank"> TF2安装指南</a></li><li id="d14d" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_detection_zoo.md" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2检测模型动物园</a></li><li id="a8e2" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_classification_zoo.md" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2分类模型动物园</a></li><li id="09c6" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2_training_and_evaluation.md" rel="noopener ugc nofollow" target="_blank">使用TensorFlow 2进行培训和评估</a></li><li id="8e15" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://www.tensorflow.org/tutorials" rel="noopener ugc nofollow" target="_blank">张量流教程</a></li><li id="e8eb" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://tfhub.dev/" rel="noopener ugc nofollow" target="_blank">张量流枢纽</a></li><li id="2384" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/tensorflow/hub/blob/master/examples/colab/tf2_object_detection.ipynb" rel="noopener ugc nofollow" target="_blank"> TensorFlow Hub对象检测Colab </a></li><li id="34fc" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://towardsdatascience.com/detailed-tutorial-build-your-custom-real-time-object-detector-5ade1017fd2d" rel="noopener" target="_blank">物体探测器教程</a></li></ul><h2 id="2146" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">数据集源</h2><p id="16d8" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">您可以从下面提到的网站下载许多对象的数据集。这些网站还包含许多种类的对象的图像以及它们的多种格式的注释/标签，例如YOLO_DARKNET txt文件和PASCAL_VOC xml文件。</p><ul class=""><li id="cbb1" class="le lf ht lg b lh ma lj mc ku mo kx mp la mq lo lp lq lr ls bi translated"><a class="ae mn" href="https://storage.googleapis.com/openimages/web/index.html" rel="noopener ugc nofollow" target="_blank">通过谷歌打开图像数据集</a></li><li id="be79" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://www.kaggle.com/datasets" rel="noopener ugc nofollow" target="_blank"> Kaggle数据集</a></li><li id="a16a" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://public.roboflow.com/" rel="noopener ugc nofollow" target="_blank"> Roboflow公共数据集</a></li><li id="0dff" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://www.visualdata.io/discovery" rel="noopener ugc nofollow" target="_blank">可视化数据数据集</a></li></ul><h2 id="d2a6" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">屏蔽数据集源</h2><ul class=""><li id="40f4" class="le lf ht lg b lh li lj lk ku ll kx lm la ln lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/prajnasb/observations" rel="noopener ugc nofollow" target="_blank">般若Github </a></li><li id="89c6" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://www.kaggle.com/andrewmvd/face-mask-detection" rel="noopener ugc nofollow" target="_blank">安德鲁·默德·卡格尔</a></li><li id="d864" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated"><a class="ae mn" href="https://github.com/X-zhangyang/Real-World-Masked-Face-Dataset" rel="noopener ugc nofollow" target="_blank">X-张洋Github </a></li></ul><h2 id="f703" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">更多掩膜数据集</h2><ul class=""><li id="882b" class="le lf ht lg b lh li lj lk ku ll kx lm la ln lo lp lq lr ls bi translated">Prasoonkottarathil ka ggle(20000张图片)</li><li id="efb5" class="le lf ht lg b lh lt lj lu ku lv kx lw la lx lo lp lq lr ls bi translated">ashishjangra 27 ka ggle(12000张图片)</li></ul></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="d837" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">故障排除:</h1><h2 id="407b" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">OpenCV错误:</h2><p id="8573" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">如果上面的_registerMatType cv2出现错误，这可能是因为Colab中的OpenCV版本不匹配。运行<code class="du oa ob oc mz b">!pip list|grep opencv</code>查看已安装的OpenCV包版本，即<code class="du oa ob oc mz b">opencv-python</code>、<code class="du oa ob oc mz b">opencv-contrib-python</code>、&amp;、<code class="du oa ob oc mz b">opencv-python-headless</code>。版本会有所不同，这导致了这个错误。当colab更新其支持的版本时，此错误将会消失。现在，您可以通过简单地卸载和安装OpenCV包来解决这个问题。</p><p id="3510" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">检查版本:</strong></p><p id="dddc" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">！pip列表|grep opencv</p><p id="acb3" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">如果只有opencv-python-headless的版本不同</strong>，则使用以下两个命令</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="ec96" class="kn jj ht mz b fi nd ne l nf ng">!pip uninstall opencv-python-headless --y</span><span id="bba5" class="kn jj ht mz b fi nv ne l nf ng">!pip install opencv-python-headless==4.1.2.30</span></pre><p id="eb3b" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">如果其他opencv包是不同的版本，则使用以下命令。卸载并安装所有相同的版本。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="b422" class="kn jj ht mz b fi nd ne l nf ng">!pip uninstall opencv-python --y</span><span id="f261" class="kn jj ht mz b fi nv ne l nf ng">!pip uninstall opencv-contrib-python --y</span><span id="5e22" class="kn jj ht mz b fi nv ne l nf ng">!pip uninstall opencv-python-headless --y</span><span id="5dc7" class="kn jj ht mz b fi nv ne l nf ng">!pip install opencv-python==4.5.4.60</span><span id="0d68" class="kn jj ht mz b fi nv ne l nf ng">!pip install opencv-contrib-python==4.5.4.60</span><span id="0ed7" class="kn jj ht mz b fi nv ne l nf ng">!pip install opencv-python-headless==4.5.4.60</span></pre></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="2753" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">DNN误差</h1><h2 id="8add" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">没有找到DNN图书馆</h2><p id="8d6d" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">此错误是由于Google Colab环境中的版本不匹配造成的。这可能是由于两个原因。第一，由于Google Colab的默认TensorFlow版本是2.8，但是我们在步骤6中安装的对象检测API的默认TensorFlow版本是2.9.0，这导致了一个错误。</p><p id="ee00" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">第二，Google Colab的默认cuDNN版本是8.0.5，但是对于TF 2.8和更高版本，它应该是8.1.0。这也会导致版本不匹配。</p><p id="20d3" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">当Colab更新它的包时，这个错误将会消失。但是对于临时解决方案，在搜索了许多在线论坛并查看了Google Colab团队成员的回复后，我可以推荐以下两个可能的解决方案:</p><h2 id="1053" class="kn jj ht bd jk ko kp kq jo kr ks kt js ku kv kw ju kx ky kz jw la lb lc jy ld bi translated">解决方案1)</h2><p id="470b" class="pw-post-body-paragraph ly lz ht lg b lh li iu mb lj lk ix md ku nh mf mg kx ni mi mj la nj ml mm lo hb bi translated">这是最简单的修复方法，但是根据Google Colab团队成员在论坛上的评论，这不是最佳实践，也不安全。这也会导致与其他包或库不匹配。但是作为这里的一个临时解决方法，这将会起作用。</p><p id="5af5" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在训练步骤之前运行以下命令。这将更新cudnn版本，之后您将不会有任何错误。</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="738a" class="kn jj ht mz b fi nd ne l nf ng">!apt install --allow-change-held-packages libcudnn8=8.1.0.77-1+cuda11.2</span></pre><p id="a7bc" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated"><strong class="lg hu">解决方案2) </strong></p><p id="67b6" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">在此方法中，您可以编辑要安装在TensorFlow对象检测API中的包版本，使其与Colab的默认版本相同。</p><p id="336f" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">我们将步骤6分成两个部分。</p><p id="9533" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">第一节:</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="5a45" class="kn jj ht mz b fi nd ne l nf ng"># clone the tensorflow models on the colab cloud vm<br/>!git clone --q <a class="ae mn" href="https://github.com/tensorflow/models.git" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/models.git</a></span><span id="1484" class="kn jj ht mz b fi nv ne l nf ng">#navigate to /models/research folder to compile protos<br/>%cd models/research</span><span id="9138" class="kn jj ht mz b fi nv ne l nf ng"># Compile protos.<br/>!protoc object_detection/protos/*.proto --python_out=.</span></pre><p id="8605" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">上面的第1节将克隆TF模型git存储库。</p><p id="7dfa" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">之后可以在<strong class="lg hu"><em class="ms">object _ detection/packages/tf2/setup . py</em></strong>编辑文件。<br/>更改所需包中的代码，在pandas包行后包含以下4行:</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="8e27" class="kn jj ht mz b fi nd ne l nf ng">    'tensorflow==2.8.0',<br/>    'tf-models-official==2.8.0',<br/>    'tensorflow_io==0.23.1',<br/>    'keras==2.8.0'</span></pre><p id="4584" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">接下来，在这之后，您可以运行下面所示的步骤6的第2部分，用更新后的<strong class="lg hu"> <em class="ms"> setup.py </em> </strong>文件安装TF2 OD API。</p><p id="3f1a" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">第二节:</p><pre class="ka kb kc kd fd my mz na nb aw nc bi"><span id="0f6c" class="kn jj ht mz b fi nd ne l nf ng"># Install TensorFlow Object Detection API.</span><span id="8b19" class="kn jj ht mz b fi nv ne l nf ng">!cp object_detection/packages/tf2/setup.py .<br/>!python -m pip install .</span></pre><p id="8b34" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">这将使用TensorFlow 2.8 0安装TensorFlow对象检测API，并使用我们在<strong class="lg hu"> <em class="ms"> setup.py </em> </strong>文件中指定的更新版本安装其他必需的包。</p><p id="f4e5" class="pw-post-body-paragraph ly lz ht lg b lh ma iu mb lj mc ix md ku me mf mg kx mh mi mj la mk ml mm lo hb bi translated">现在，您将能够正确无误地运行培训步骤。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="de0e" class="ji jj ht bd jk jl mt jn jo jp mu jr js iz mv ja ju jc mw jd jw jf mx jg jy jz bi translated">别忘了留下👏</h1><h1 id="75aa" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">祝您愉快！！！✌</h1><h1 id="28fa" class="ji jj ht bd jk jl jm jn jo jp jq jr js iz jt ja ju jc jv jd jw jf jx jg jy jz bi translated">⚡♕·特奇佐·♕⚡</h1></div></div>    
</body>
</html>