<html>
<head>
<title>Mathematical Scheduling of Operating Rooms — How Analytics Enable Smoother Hospital Shifts and Stays</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">手术室的数学调度——分析如何实现更顺畅的医院轮班和住院</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mathematical-scheduling-of-operating-rooms-how-analytics-enable-smoother-hospital-shifts-and-501c7edf1120?source=collection_archive---------11-----------------------#2021-01-11">https://medium.com/analytics-vidhya/mathematical-scheduling-of-operating-rooms-how-analytics-enable-smoother-hospital-shifts-and-501c7edf1120?source=collection_archive---------11-----------------------#2021-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d000c5b709c15ed9f709ddd9ed8210b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YACZ_Vbhy71vnydLooHxQw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片提供:<a class="ae iu" href="https://www.timesofisrael.com/" rel="noopener ugc nofollow" target="_blank">https://www.timesofisrael.com/</a></figcaption></figure><h1 id="eb40" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">概观</h1><p id="0b53" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">作为医疗保健领域的数据科学家和真正的数学家，我一直着迷于复杂系统(如医院系统)如何有效地利用优化算法来最大限度地利用他们的熟练人力，确保最高标准的患者护理。本文基于一个来自加州洛杉矶Cedars-Sinai医院的案例研究，介绍了他们如何帮助组织在资源有限的医院中确定高效的周计划，将手术室分配给不同的科室。</p><h1 id="fae1" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">挑战</h1><p id="216f" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在全国大多数医院，外科医生的报酬是根据他们所做的手术数量来计算的，也就是说，是根据<em class="kr">服务费</em>来计算的。手术室计划外的变动会直接影响他们的收入。因此，创建一个有效的时间表最终成为医院内部的一个高度政治化的过程。此外，每个部门根据每周手术小时数设定自己的目标，如果管理层未能制定有效的时间表，这可能会造成内部冲突。这就需要运用数学敏锐度来提出一个优化的计划，在不损害治疗质量的情况下，在医院的所有部门之间取得健康的平衡。现在让我们仔细看看样本问题。</p><h1 id="bd78" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">问题定义</h1><p id="3235" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">Cedars-Sinai医院有10个手术室，从周一到周五每天工作8小时。也就是说，</p><p id="9b4d" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">10个手术室* 5天* 8小时= 400个手术小时，在医院的5个主要部门之间有效分配，即:</p><ol class=""><li id="1dbe" class="kx ky hi jv b jw ks ka kt ke kz ki la km lb kq lc ld le lf bi translated">妇科</li><li id="bfc9" class="kx ky hi jv b jw lg ka lh ke li ki lj km lk kq lc ld le lf bi translated">心脏科</li><li id="1c18" class="kx ky hi jv b jw lg ka lh ke li ki lj km lk kq lc ld le lf bi translated">神经外科</li><li id="2937" class="kx ky hi jv b jw lg ka lh ke li ki lj km lk kq lc ld le lf bi translated">骨科，以及</li><li id="e7b6" class="kx ky hi jv b jw lg ka lh ke li ki lj km lk kq lc ld le lf bi translated">普通外科</li></ol><p id="36de" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">我们将通过用Python编写LPP来解决上述案例研究。本文中使用的所有代码和数据都可以通过我的Git repo(<a class="ae iu" href="https://github.com/mohiteprathamesh1996/Hospital-OR-Scheduling" rel="noopener ugc nofollow" target="_blank">https://github . com/mohiteprathamesh 1996/Hospital-OR-Scheduling</a>)访问。</p><p id="fc25" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">导入必要的依赖项，</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="6e7f" class="lu iw hi lq b fi lv lw l lx ly">import pandas as pd<br/>import numpy as np<br/>import itertools<br/>from pulp import *<br/></span><span id="b93b" class="lu iw hi lq b fi lz lw l lx ly">from IPython.core.display import display, HTML</span><span id="7bff" class="lu iw hi lq b fi lz lw l lx ly">def display_side_by_side(dfs:list, captions:list):<br/>    """Display tables side by side to save vertical space<br/>    Input:<br/>        dfs: list of pandas.DataFrame<br/>        captions: list of table captions<br/>    """<br/>    output = ""<br/>    combined = dict(zip(captions, dfs))<br/>    for caption, df in combined.items():<br/>        output += df.style.set_table_attributes("style='display:inline'").set_caption(caption)._repr_html_()<br/>        output += "\xa0\xa0\xa0"<br/>    display(HTML(output))</span><span id="ddcc" class="lu iw hi lq b fi lz lw l lx ly"><br/>import warnings<br/>warnings.filterwarnings("ignore")</span></pre><p id="87db" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">如前所述，每个部门都设定了一周手术小时数的目标，如下所示:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="14f2" class="lu iw hi lq b fi lv lw l lx ly">target_hours_per_week = pd.read_excel("OR Scheduling.xlsx",         sheet_name="Target Hours per Week")</span><span id="b40d" class="lu iw hi lq b fi lz lw l lx ly">target_hours_per_week.set_index(["Department"], inplace=True)</span></pre><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/1da2d52dfd564f06423de3f580af33e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*0vCms3G8h4Xo9d5spXVq5Q.png"/></div></figure><p id="e5ac" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">现在，每个部门每天都有数量有限的手术团队，具体如下:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="f7a0" class="lu iw hi lq b fi lv lw l lx ly">teams_available_per_week = pd.read_excel("OR Scheduling.xlsx", sheet_name="Available teams per week")</span><span id="1466" class="lu iw hi lq b fi lz lw l lx ly">teams_available_per_week.set_index(["Department"], inplace=True)</span></pre><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/a49162d1a9d4d0f1d763db0b9e23da90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*5Dkr-BneTMimrhzqiv0RDw.png"/></div></figure><p id="2a4c" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">此外，每个部门可以对一周的ORs数量有一个最大的每日需求，如下所示:</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="ae6d" class="lu iw hi lq b fi lv lw l lx ly">max_daily_OR_requirement = pd.read_excel("OR Scheduling.xlsx", sheet_name="Max Daily OR requirements")</span><span id="ad93" class="lu iw hi lq b fi lz lw l lx ly">max_daily_OR_requirement.set_index(["Department"], inplace=True)</span></pre><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/0ab209a64aa1ef46965a556bab3a288a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*ChYvNa2SxhpWY6x2a7R9wg.png"/></div></figure><h1 id="45aa" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">决定性因素</h1><p id="dc8d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">基于上述可用的信息，医院管理层必须决定在整个星期的每一天应该给每个部门分配多少ORs？</p><p id="a164" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">假设这种情况下的决策变量为:</p><blockquote class="md me mf"><p id="fd4d" class="jt ju kr jv b jw ks jy jz ka kt kc kd mg ku kg kh mh kv kk kl mi kw ko kp kq hb bi translated"><strong class="jv hj"> X (j，k) =在第‘k’天分配给部门‘j’的ORs数量(将是一个整数！)</strong></p></blockquote><p id="fd4b" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">其中j<em class="kr">∈(</em>‘基因学’，‘心脏病学’，‘神经外科’，‘骨科’，<br/>，‘普通外科’，<em class="kr"> ) </em></p><p id="73de" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated"><em class="kr">和k ∈ ( </em>'星期一'，'星期二'，'星期三'，'星期四'，'星期五'<em class="kr"> ) </em></p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="0a38" class="lu iw hi lq b fi lv lw l lx ly">teams = teams_available_per_week.index.to_list()<br/>day_of_week = teams_available_per_week.columns.to_list()</span><span id="d2f8" class="lu iw hi lq b fi lz lw l lx ly">var_dict = LpVariable.dicts(<br/>            "Allotment",<br/>            [(dept, day) for dept in teams for day in day_of_week], <br/>            lowBound = 0, <br/>            cat = "Integer")</span></pre><h1 id="96d6" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">目标函数</h1><p id="dba9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">医院管理层的目标是分配ORs，以最大化每个部门每周手术小时数的目标比例。也就是说，如果部门“j”的目标是该周的“t(j)”小时手术，那么我们必须<strong class="jv hj">最大化:</strong><strong class="jv hj">∑(8 * X(j，k))/t(j) </strong>该周所有部门的总和。这确保了最大的利用率！</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="8e6d" class="lu iw hi lq b fi lv lw l lx ly">model = LpProblem(<br/>"Optimized Allocation of Hospital Operating Rooms", <br/>LpMaximize)</span><span id="e8f1" class="lu iw hi lq b fi lz lw l lx ly"><br/>model += lpSum(<br/>[8*var_dict[(team,days)]/target_hours_per_week.loc[team, "Target_Hours"] for team in teams for days in day_of_week])</span></pre><h1 id="43d8" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">限制</h1><p id="1c10" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在任何给定的一天，医院最多有10个手术室可用，这些手术室应该安排在这5个科室进行手术。</p><p id="cf80" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">因此，</p><p id="be03" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated"><strong class="jv hj">0≤σX(j，k) ≤ 10 </strong></p><p id="1855" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">其中“j”<em class="kr">∈(</em>‘基因学’，‘心脏病学’，‘神经外科’，‘整形外科’，<br/>‘普通外科’，<em class="kr"> ) </em>，‘k’对于一周中的那一天保持不变。</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="e046" class="lu iw hi lq b fi lv lw l lx ly">for day in day_of_week:<br/>    model += lpSum([var_dict[(team, day)] for team in teams]) &lt;= 10</span></pre><p id="8a80" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">接下来，为一个部门分配的ORs数量不能超过该部门当天可用团队的数量。</p><p id="94b4" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">也就是说，</p><p id="aac6" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated"><strong class="jv hj"> 0 ≤ X (j，k) ≤部门‘j’在‘k’日可用的团队数量</strong></p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="bf4f" class="lu iw hi lq b fi lv lw l lx ly">for team in teams:<br/>    for day in day_of_week:<br/>        model += var_dict[(team, day)] &lt;= teams_available_per_week.loc[team, day]</span></pre><p id="264f" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">最后，我们必须满足每个部门每天的最大需求。</p><p id="c40e" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">因此，</p><p id="fdbe" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated"><strong class="jv hj"> 0 ≤ X (j，k) ≤部门‘j’在‘k’日要求的最大ORs</strong></p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="56d6" class="lu iw hi lq b fi lv lw l lx ly">for team in teams:<br/>    for day in day_of_week:<br/>        model += var_dict[(team, day)] &lt;= max_daily_OR_requirement.loc[team, day]</span></pre><h1 id="e43b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">最优解</h1><p id="4c55" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">既然我们已经定义了决策变量，制定了目标函数和约束条件，我们可以获得如下的最优解。下面的代码输出了数学上最有效的时间表！</p><pre class="ll lm ln lo fd lp lq lr ls aw lt bi"><span id="ad2e" class="lu iw hi lq b fi lv lw l lx ly">model.solve()</span><span id="828c" class="lu iw hi lq b fi lz lw l lx ly"><br/>if LpStatus[model.status]=="Optimal":<br/>    optimal_soln = pd.DataFrame(<br/>[(v.name, <br/>int(v.varValue)) for v in model.variables() if v.varValue!=0],<br/>columns=["Decisions", "# ORs Allocated"])</span><span id="8a83" class="lu iw hi lq b fi lz lw l lx ly"><br/>display_side_by_side(dfs = [optimal_soln[optimal_soln["Decisions"].str.contains(d)].reset_index(drop=True) for d in day_of_week],<br/>captions = ["Operating Room Schedule for "+i for i in day_of_week])</span></pre><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/a438950d7f0e22c567db7051ca772c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_yXA0Kri0g7T9HwgNOJbTA.png"/></div></div></figure><p id="71f9" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">如果你喜欢读这篇文章，请随时留下你的评论或建议！谢谢你的时间。</p><p id="2cb7" class="pw-post-body-paragraph jt ju hi jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq hb bi translated">我们在LinkedIn上连线吧！<a class="ae iu" href="https://www.linkedin.com/in/prathameshmohite96/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/prathameshmohite96/</a></p></div></div>    
</body>
</html>