<html>
<head>
<title>Building Scalable Systems using Queues</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用队列构建可伸缩系统</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-scalable-systems-using-queues-eeb52ec31751?source=collection_archive---------2-----------------------#2021-12-13">https://medium.com/analytics-vidhya/building-scalable-systems-using-queues-eeb52ec31751?source=collection_archive---------2-----------------------#2021-12-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/ad8e65b09d9bcf0bfff0fd0f483f079d.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*_nhhATN0j-O3giwT3oIHXA.png"/></div></figure><p id="35a5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">可伸缩系统的定义可能因人而异，但是根据我的看法，可伸缩系统是</p><ul class=""><li id="483e" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">耐穗</li><li id="f5fa" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">水平可伸缩</li><li id="5495" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">负载平衡</li></ul><p id="230f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">今天我们将讨论如何使用队列和事件驱动编程来创建一个可伸缩的系统</p></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><h1 id="dca6" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">队列</strong></h1><p id="443b" class="pw-post-body-paragraph il im hh in b io lc iq ir is ld iu iv iw le iy iz ja lf jc jd je lg jg jh ji ha bi translated">队列是一种数据结构，它遵循</p><blockquote class="lh li lj"><p id="1921" class="il im lk in b io ip iq ir is it iu iv ll ix iy iz lm jb jc jd ln jf jg jh ji ha bi translated">先进先出</p></blockquote><p id="c21e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在软件术语中，先进先出是什么意思？</p><p id="c574" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">想想你的打印机如何处理所有的请求。当不止一个人想要访问打印机时会发生什么。</p><p id="e09c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它会交叉请求吗？</p><p id="8257" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">答案是<strong class="in hi">否</strong>，打印机是高效使用队列数据结构的一个很好的例子。</p><p id="0c96" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它接收所有请求，并将它们放入打印机作业池，然后从作业池中挑选一个作业并启动任务。</p><p id="8b3f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这里需要补充的一点是，打印机将按照任务到达打印机的顺序来选择任务(FIFO)。</p><p id="c047" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在我们知道了什么是队列，让我们来讨论如何使用这个简单的东西来扩展巨大的系统。</p></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><h1 id="cdf0" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">何时使用队列</h1><p id="e864" class="pw-post-body-paragraph il im hh in b io lc iq ir is ld iu iv iw le iy iz ja lf jc jd je lg jg jh ji ha bi translated">为了理解这一点，让我们以一台文鼎机器为例，该机器以x饼干/分钟的速率生产饼干，你是这些饼干的消费者，你可以以y饼干/分钟的速率消费饼干，其中</p><blockquote class="lh li lj"><p id="402b" class="il im lk in b io ip iq ir is it iu iv ll ix iy iz lm jb jc jd ln jf jg jh ji ha bi translated">x <y/></p></blockquote><p id="8d05" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">In this scenario, you can consume all the biscuits which are produced by the machine.</p><p id="b082" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">What if the rate is increased by some amount z such that</p><blockquote class="lh li lj"><p id="af8b" class="il im lk in b io ip iq ir is it iu iv ll ix iy iz lm jb jc jd ln jf jg jh ji ha bi translated">x+z&gt; y</p></blockquote><p id="11fa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在你不能吃掉所有机器生产的饼干。所有多余的农产品都洒在了地板上。</p><p id="5866" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">看着你的情况，一个聪明的人给你拿来一个托盘，放入你在机器生产率恢复正常之前无法食用的所有多余饼干，即<strong class="in hi"> x </strong></p><p id="ac6b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这个板块在软件术语中被称为<strong class="in hi">队列</strong></p><p id="699e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">队列是一个存储额外产出的桶，用软件术语来说，就是向服务器发出的请求的数量，因为服务器响应这些响应的速率受到服务器容量的限制，但是产出的速率不受任何约束的限制。</p><h1 id="5a3f" class="ke kf hh bd kg kh lo kj kk kl lp kn ko kp lq kr ks kt lr kv kw kx ls kz la lb bi translated">有队列的系统设计</h1></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><figure class="lu lv lw lx fd ii er es paragraph-image"><div class="er es lt"><img src="../Images/9fe8cd28cc6bdc41d146396680f5f1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*9nEE6cb5UwdV2syGv0CmMw.png"/></div></figure><p id="251c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们看看我们之前讨论过的事情，这里我们的服务器一次可以处理10个请求，但是它被20个请求轰炸了。此时需要考虑一些有趣的问题</p><p id="dba3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="lk">我们的服务器会有什么行为？</em>T12】</strong></p><p id="1fc9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它将开始拒绝服务请求。</p><p id="71c0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="lk">如何处理这个问题？</em> </strong></p><ul class=""><li id="0932" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">提高服务器的服务能力(纵向扩展)</li><li id="0983" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">增加服务器数量(横向可扩展)</li></ul><p id="41a9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果负载是一致的，并且我们的服务器通常会收到比它们所能提供的更多的请求，那么这些解决方案会非常有效。此外，在我们了解这种情况之前，我们的服务器一直处于负载状态，这可能会导致拒绝请求。</p><p id="af9b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是，如果我们想让这个过程异步，就像你去银行存一张支票，出纳员收集所有的支票，并确认它将被处理，并在他从所有需要立即服务的客户那里获得空闲时处理它。</p><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es ly"><img src="../Images/1803bed679a155ae8bee8e44ab68b3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0l5AyE894F9DhFExs9Lzg.png"/></div></div></figure><p id="e386" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">类似地，在客户机和服务器之间使用队列数据结构，它充当缓冲区，有助于保持向服务器发送请求的速率。</p><p id="bd23" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">有多种类型的队列，基于拉的和基于推的，但是讨论它们超出了本文的范围。</p><p id="a64c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们看看这将如何工作:</p><p id="8198" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">假设，15个人想同时使用打印机，所以他们向打印机发送打印命令，但是打印机一次只能运行一个命令，打印机不会拒绝其他命令，但是这些额外的命令将被保存在队列中，当打印机完成当前命令时，这些命令将被选取。</p><p id="0ddd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用队列的另一个好处是，我们可以多添加一台打印机，它可以从同一个队列中提取命令，这样一台打印机就可以从队列中选择一条命令。</p><h1 id="822c" class="ke kf hh bd kg kh lo kj kk kl lp kn ko kp lq kr ks kt lr kv kw kx ls kz la lb bi translated">真正的游戏</h1><p id="1458" class="pw-post-body-paragraph il im hh in b io lc iq ir is ld iu iv iw le iy iz ja lf jc jd je lg jg jh ji ha bi translated">我们在LambdaTest严重依赖Apache Kafka进行服务间的通信。</p><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es md"><img src="../Images/53c29e01ebb6841cd19f13452871c7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OhXjJcB0V7uPtJ00iR89A.png"/></div></div></figure><p id="16e2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">没有两个服务直接相互通信。Kafka充当通信媒介和缓冲服务间请求的媒介。</p><p id="3531" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这样，通过使用事件驱动的编程，我们可以管理服务上的负载，并且在需要时，我们可以横向扩展我们的服务，以处理高峰时间增加的负载。</p><p id="e7c5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用这种架构的优势在于:</p><ul class=""><li id="3ea2" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">易于扩展</li><li id="034a" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">系统变得能够容忍使用高峰</li><li id="4786" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">如果需要，我们可以重播这条消息</li><li id="2d94" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">事件可以被多个服务监听(实际工作者服务和用于维护使用记录的分析服务)</li></ul><p id="bb00" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这种方法的一些缺点:</p><ul class=""><li id="8940" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">开发一个功能的时间增加了</li><li id="4e5e" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">代码的可读性降低</li><li id="b379" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">新加入者加入该服务的时间会增加</li><li id="6a1e" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">服务的响应时间可能会增加</li></ul><h1 id="be53" class="ke kf hh bd kg kh lo kj kk kl lp kn ko kp lq kr ks kt lr kv kw kx ls kz la lb bi translated"><strong class="ak">其他一些基于队列的系统包括</strong></h1><ul class=""><li id="2373" class="jj jk hh in b io lc is ld iw me ja mf je mg ji jo jp jq jr bi translated">兔子q</li><li id="2667" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">ActiveMQ</li><li id="3caf" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">亚马逊SQS</li></ul><p id="da4f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">还有很多现成的解决方案，但是你可以使用数据库创建自己的解决方案。</p><p id="842a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我希望这有助于您做出一些架构决策。</p><p id="9225" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">快乐学习</p><p id="240b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">关注我的YT频道获取相关内容</p><figure class="lu lv lw lx fd ii"><div class="bz dy l di"><div class="mh mi l"/></div></figure></div></div>    
</body>
</html>