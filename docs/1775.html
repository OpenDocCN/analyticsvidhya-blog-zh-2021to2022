<html>
<head>
<title>Random Cut Forest with example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">随机采伐森林示例</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/random-cut-forest-with-example-84ad62453361?source=collection_archive---------5-----------------------#2021-03-17">https://medium.com/analytics-vidhya/random-cut-forest-with-example-84ad62453361?source=collection_archive---------5-----------------------#2021-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b8c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://sagemaker-examples.readthedocs.io/en/latest/introduction_to_amazon_algorithms/random_cut_forest/random_cut_forest.html" rel="noopener ugc nofollow" target="_blank">代码为</a>的乱砍森林，你要提防什么。</p><p id="f72d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我之前的故事的延续，在那里我必须解释随机采伐森林的理论。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/1664db728ccaba75838503dce2ce6dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vlCZB2N6WoQd-sWY"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">照片由<a class="ae jd" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">詹姆斯·哈里逊</a>在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6b49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嘿，伙计们，我们已经知道RCF是如何工作的，让我们直接进入编码。我可以保证这将是迄今为止你面对任何异常检测代码时最简单的方法。</p><p id="98ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单地说，基于我们的数据点，RCF模型会分配分数，并基于该分数来决定异常情况。</p><p id="e5bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我不会直接举AWS提供纽约出租车数据的例子，而是使用<a class="ae jd" href="https://github.com/numenta/NAB/blob/master/data/realKnownCause/ambient_temperature_system_failure.csv" rel="noopener ugc nofollow" target="_blank">这里</a>的机器故障数据。</p><h2 id="6af7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">密码</h2><p id="5ca6" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">让我们导入所有必需的库</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="7921" class="ju jv hi kv b fi kz la l lb lc">## Importing all necessary Libs that will be required<br/>import pandas as pd<br/>import numpy as np<br/>import os<br/>import warnings<br/>import pickle<br/>import matplotlib.pyplot as plt<br/>import boto3<br/># import sagemaker<br/>import sys<br/>import seaborn as sns<br/>import holoviews as hv<br/>from holoviews import opts<br/>hv.extension('bokeh')</span></pre><p id="fba0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也将增加一些更好的视图选项</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="a16c" class="ju jv hi kv b fi kz la l lb lc">warnings.simplefilter('ignore')<br/>pd.set_option('display.max_columns', None)<br/>pd.set_option('display.max_rows', None)</span><span id="d33c" class="ju jv hi kv b fi ld la l lb lc">sns.set_style('white')<br/>sns.set_palette('pastel',8)</span><span id="af7a" class="ju jv hi kv b fi ld la l lb lc">seed=345<br/>np.random.seed(seed)</span></pre><p id="5d48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">加载数据:</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="8528" class="ju jv hi kv b fi kz la l lb lc">## Loading Data<br/>df = pd.read_csv("./data/nab_machine_failure.csv")<br/>print("")<br/># print("Data columns ---&gt; {}".format(list(fulldata.columns)))<br/># fulldata = df<br/>print("Total Number of records ---&gt; {}".format(df.shape[0]))<br/>print("Total Number of features ---&gt; {}".format(df.shape[1]))<br/>print("")<br/>df.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es le"><img src="../Images/5326e2c175105eaab3c8a28cd9a39d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*mJwO2X_zEXA2J14Zsd5tXA.png"/></div></figure><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="64a0" class="ju jv hi kv b fi kz la l lb lc">anomaly_points = [<br/>        ["2013-12-10 06:25:00.000000","2013-12-12 05:35:00.000000"],<br/>        ["2013-12-15 17:50:00.000000","2013-12-17 17:00:00.000000"],<br/>        ["2014-01-27 14:20:00.000000","2014-01-29 13:30:00.000000"],<br/>        ["2014-02-07 14:55:00.000000","2014-02-09 14:05:00.000000"]<br/>]</span><span id="39f5" class="ju jv hi kv b fi ld la l lb lc">df['timestamp'] = pd.to_datetime(df['timestamp'])<br/>#is anomaly? : True =&gt; 1, False =&gt; 0<br/>df['anomaly'] = 0<br/>for start, end in anomaly_points:<br/>    df.loc[((df['timestamp'] &gt;= start) &amp; (df['timestamp'] &lt;= end)), 'anomaly'] = 1</span><span id="bad5" class="ju jv hi kv b fi ld la l lb lc">df['year'] = df['timestamp'].apply(lambda x : x.year)<br/>df['month'] = df['timestamp'].apply(lambda x : x.month)<br/>df['day'] = df['timestamp'].apply(lambda x : x.day)<br/>df['hour'] = df['timestamp'].apply(lambda x : x.hour)<br/>df['minute'] = df['timestamp'].apply(lambda x : x.minute)</span></pre><p id="1854" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修改了数据框，增加了一些功能，将完整的日期时间戳转换为单独的功能。让我们看看它们是如何形成的。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="ed77" class="ju jv hi kv b fi kz la l lb lc">df.index = df['timestamp']<br/>df.drop(['timestamp'], axis=1, inplace=True)<br/>df.head(3)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lf"><img src="../Images/9443f083aa6d7ff49535a03161405bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*0Mb5kirzb0GYNuZ8gUFxoQ.png"/></div></figure><p id="a67b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将看到一个异常点的例子。因为我们已经明确给出了基于anomly _ point的异常点。所以为了形象化，我使用了孔视图，它们很棒，有时会在上面写一个故事。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="6ff6" class="ju jv hi kv b fi kz la l lb lc">anomalies = [[ind, value] for ind, value in zip(df[df['anomaly']==1].index, df.loc[df['anomaly']==1,'value'])]<br/>(hv.Curve(df['value'], label="Temperature") * hv.Points(anomalies, label="Anomaly Points").opts(color='red', legend_position='bottom', size=2, title="Temperature &amp; Given Anomaly Points"))\<br/>    .opts(opts.Curve(xlabel="Time", ylabel="Temperature", width=700, height=400,tools=['hover'],show_grid=True))</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lg"><img src="../Images/8e4a12fba76e79df010ed915109ec57e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpKVjj-4OaBniCYayibeHw.png"/></div></div></figure><p id="8b26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在对于主事件，如何将RCF应用于此，并将得到我们所有的异常。让我们从再次导入一些imp库开始，以便使用随机切割森林。由于RCF是AWS创建的模型，我们必须加载Sagemaker、boto3等。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="9bda" class="ju jv hi kv b fi kz la l lb lc">from sagemaker import RandomCutForest<br/>import boto3<br/>import botocare<br/>import sagemaker<br/>import sys</span></pre><p id="a656" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义角色:</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="0bd4" class="ju jv hi kv b fi kz la l lb lc">iam = boto3.client('iam')<br/>role = iam.get_role(RoleName='NAB_machine_failure_analytics')['Role']['Arn']<br/>print(role)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lh"><img src="../Images/3093fe813f7a2d735b61da37bdab056c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*cKVDoqC_XPvY0uFQba-nKg.png"/></div></figure><p id="89fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准备好培训评估员角色:</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="7e37" class="ju jv hi kv b fi kz la l lb lc"># Training<br/>rcf = RandomCutForest(<br/>    role=role,<br/>    instance_count=1,<br/>    instance_type='ml.m4.xlarge'<br/>    output_path='s3://data/output_rcf',<br/>    num_sample_per_tree=512,<br/>    num_trees=50<br/>)</span><span id="9f73" class="ju jv hi kv b fi ld la l lb lc"># automatically upload the training data to s3 and run the training job<br/>rcf.fit(rcf.record_set(data['value'].to_numpy().reshape(-1,1)))</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es li"><img src="../Images/9e0d6b56e8e30d844a77481a836b3686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UQlp_-CSYa87L0hZeWiCFw.png"/></div></div></figure><p id="f0df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你看到这样的东西，这意味着你的训练开始了。确保您在培训结束时也能收到培训完成的消息。</p><p id="2f40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了预测数据，我们必须推断它，这意味着我们必须部署它。我们有一个部署好的方法来创建推论。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="72d0" class="ju jv hi kv b fi kz la l lb lc">rcf_interference = rcf.deploy(initial_instance_count=1, ins)</span></pre><p id="2fed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们必须对其进行序列化，以便将分数添加到主数据框中。然后你会得到一个这样的数据帧。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="a3ec" class="ju jv hi kv b fi kz la l lb lc">from sagemaker.serializers import CSVSerializer<br/>from sagemaker.deserializers import JSONDeserializer</span><span id="e87b" class="ju jv hi kv b fi ld la l lb lc">rcf_inference.serializer = CSVSerializer()<br/>rcf_inference.deserializer = JSONDeserializer()</span><span id="aa8a" class="ju jv hi kv b fi ld la l lb lc">machine_data_numpy = data.value.to_numpy().reshape(-1, 1)<br/>print(machine_data_numpy[:6])<br/>results = rcf_inference.predict(<br/>    machine_data_numpy[:6], initial_args={"ContentType": "text/csv", "Accept": "application/json"}<br/>)</span><span id="e7eb" class="ju jv hi kv b fi ld la l lb lc">results = rcf_inference.predict(machine_data_numpy)<br/>scores = [datum["score"] for datum in results["scores"]]</span><span id="4304" class="ju jv hi kv b fi ld la l lb lc"># add scores to taxi data frame and print first few values<br/>data["score"] = pd.Series(scores, index=data.index)<br/>data.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lj"><img src="../Images/0ec18c7c2f6d864dfa4efd8fc8840823.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*eIfW6lWgnCdQWrVYHbgzFA.png"/></div></figure><p id="ebe3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看分数向我们展示了什么异常。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lk"><img src="../Images/f267710fc261b0950b0c842d1dc74637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*le3_meFEyH5T4aBZaIA43Q.png"/></div></div></figure><p id="781d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如您所见，这是一种非常简单的异常检测方法。</p><p id="d971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你们阅读这篇文章。如有任何疑问，请发表评论。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><h1 id="66b8" class="ls jv hi bd jw lt lu lv ka lw lx ly ke lz ma mb kh mc md me kk mf mg mh kn mi bi translated">现在怎么办？</h1><p id="b16b" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这边请..你现在编码随机砍伐森林。下一篇博客将探讨其他AWS模型。然后我们会仔细观察全息视图。</p><p id="08f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mj"><img src="../Images/cc966bebf9823e73df076f70acb94af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J-wZ3PElv720As21.png"/></div></div></figure><p id="c3bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这篇文章，请一定要鼓掌。请关注我的Github和我的medium个人资料上的更多项目和文章。</p><div class="mk ml ez fb mm mn"><a href="https://github.com/tapanKumarPatro" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hj fi z dy ms ea eb mt ed ef hh bi translated">tapanKumarPatro -概述</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">Arctic Code Vault贡献者来自greensdata/成为数据科学家的10个步骤📢准备学习或复习…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">github.com</p></div></div><div class="mw l"><div class="mx l my mz na mw nb jo mn"/></div></div></a></div><div class="mk ml ez fb mm mn"><a href="https://tapanpatro.medium.com/" rel="noopener follow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hj fi z dy ms ea eb mt ed ef hh bi translated">Tapan Kumar Patro -中等</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">关于这个无监督的机器学习算法你应该知道的事情。我猜如果你在找这个…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">tapanpatro.medium.com</p></div></div><div class="mw l"><div class="nc l my mz na mw nb jo mn"/></div></div></a></div><p id="806c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不要忘了用Android应用程序开发来检查深度学习项目的端到端部署。</p><div class="mk ml ez fb mm mn"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/end-to-end-deep-learning-based-app-af67d4008550"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hj fi z dy ms ea eb mt ed ef hh bi translated">基于深度学习的端到端app。</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">聪明烹饪</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">medium.com</p></div></div><div class="mw l"><div class="nd l my mz na mw nb jo mn"/></div></div></a></div><p id="104f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢了。如有任何疑问，请留言。</p></div></div>    
</body>
</html>