<html>
<head>
<title>How to attach watermark to your pdf file (with multiple pages)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将水印附加到您的pdf文件(多页)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-attach-watermark-to-your-pdf-file-with-multiple-pages-90089fa2ad15?source=collection_archive---------3-----------------------#2021-04-11">https://medium.com/analytics-vidhya/how-to-attach-watermark-to-your-pdf-file-with-multiple-pages-90089fa2ad15?source=collection_archive---------3-----------------------#2021-04-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d22e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我第一次接触pdf和python时，我父亲问我是否有一种简单的方法来选择pdf中的表格，并将其放入excel中，目的是使数据操作更容易，尽管这是一个在excel中执行“ctrl-c”和“ctrl-v”的简单任务，我发现使用python和pdf的可能性很有趣，但没有开始任何项目。</p><p id="5d58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着时间的推移，作为我大学金融俱乐部的成员，一些有趣的事情浮出水面，我们每个学期讲授的教科书都有问题，任务是在每份讲义上添加一个带有该人姓名的自定义水印。</p><p id="b583" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了让其他有同样问题的人更容易理解，也为了巩固我的研究，我做了这个快速指南，解释如何从零开始构建。</p><p id="cf1f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我确实在这个网站上发现了许多有趣的内容:</p><p id="ea0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://realpython.com/" rel="noopener ugc nofollow" target="_blank"> Python教程——真正的Python </a></p><h2 id="30b4" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">开始前的重要步骤</h2><ul class=""><li id="27a2" class="jy jz hh ig b ih ka il kb ip kc it kd ix ke jb kf kg kh ki bi translated"><strong class="ig hi"> Jupyter实验室</strong>:如果你正在使用Jupyter笔记本，把你的文件放在和笔记本相同的目录下是很重要的。</li><li id="e066" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb kf kg kh ki bi translated"><strong class="ig hi"> Google Colab </strong>:如果你正在使用Google Colab，重要的是首先从这段代码开始导入excel(。xlsx)，以及课程用书(。pdf)文件。</li></ul><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="8834" class="jd je hh kt b fi kx ky l kz la">from google.colab import files<br/>uploaded = files.upload()</span></pre><h2 id="14df" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">在python中使用pdf</h2><p id="871b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">有一些库可以处理pdf文件，但是因为我们的目标是处理一本教科书，我们的水印的目标是出现在这本教科书的每一页，同时这本书必须是可读的(在我的搜索中，我发现了许多向pdf文件添加水印的方法，但是它们实际上覆盖了教科书中所写的内容)，所以我决定处理这些库:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="3d58" class="jd je hh kt b fi kx ky l kz la">from fpdf import FPDF<br/>import PyPDF2<br/>from PyPDF2 import PdfFileMerger<br/>from PyPDF2 import PdfFileWriter, PdfFileReader<br/>from reportlab.pdfgen import canvas<br/>from reportlab.lib.units import cm</span></pre><p id="f597" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你正在使用google colab或jupyter notebook，你可能必须安装德FPDF、PyPDF2和reportlab库，如果你必须这样做，在<strong class="ig hi"> jupyter lab </strong>中，你只需在你的命令提示符中写下以下内容:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="a392" class="jd je hh kt b fi kx ky l kz la">pip install FPDF<br/>pip install PyPDF2<br/>pip install reportlab</span></pre><p id="26c1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你使用的是<strong class="ig hi"> google colab </strong>，只需在笔记本上的一行代码中这样做:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="a109" class="jd je hh kt b fi kx ky l kz la">!pip install FPDF<br/>!pip install PyPDF2<br/>!pip install reportlab</span></pre><p id="3d12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">是的，区别只是“！”在开始，和位置。</p><h2 id="6a15" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">开始创造我们的水印</h2><p id="fa83" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">技巧的事情是，你必须在开始你的主要目标之前创建“n”(n是你必须做的不同自定义水印的数量)个pdf水印文件，因为每一个都是不同的，稍后会与你的课程书合并。</p><p id="65d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一步是创建一个excel文件，是的，我将使用excel和python，因为我发现它更容易，但你也可以只使用python。</p><p id="dc04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您打开excel时，您可以在第一个工作表(Sheet1)中写入要在水印中写入的内容，对于我的项目，我写了:“名字，姓氏，身份证号”，并且我将使用第二个工作表(Sheet2)来写入我们未来的pdf水印文件的名称，因此我写了:“名字，姓氏，。pdf”，这真的很重要。pdf，因为这是您的计算机识别pdf文件的方式，这样做是为了以后单独调用这些文件。</p><p id="c7ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码如下:</p><ul class=""><li id="9b4e" class="jy jz hh ig b ih ii il im ip le it lf ix lg jb kf kg kh ki bi translated">创建水印功能</li></ul><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="7cbf" class="jd je hh kt b fi kx ky l kz la">def watermark(file,content):<br/>   page= canvas.Canvas(arquivo, pagesize = (21*cm, 29.7*cm)<br/>   page.translate(14.40*cm, 14.85*cm)<br/>   page.setFont("Helvetica", 20)<br/>   page.rotate(45)<br/>   page.setFillColorRGB(0.55,0.55,0.55)<br/>   page.setFillAlpha(0.3)<br/>   page.drawString(-10*cm, 3*cm, content)<br/>   page.save()</span></pre><p id="d03c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">逐步解释我们在做什么:</p><ol class=""><li id="5214" class="jy jz hh ig b ih ii il im ip le it lf ix lg jb lh kg kh ki bi translated">创建我们的文件，用A4纸大小，</li><li id="e449" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">把我们的原点坐标移到纸的中心，</li><li id="ed44" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">选择我们的字体风格和大小，</li><li id="bf1f" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">旋转到45度，我选择在这个方向写水印，</li><li id="021d" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">选择我的水印颜色，</li><li id="fdea" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">“SetFillAlpha”设置透明度，选择一个不影响你的课本读者视图的透明度非常重要，</li><li id="d88e" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">设置水印文本开始位置，</li><li id="983a" class="jy jz hh ig b ih kj il kk ip kl it km ix kn jb lh kg kh ki bi translated">最后，我们保存并关闭我们的pdf。</li></ol><h2 id="7ca7" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">访问我们的excel文件，最后做所有水印</h2><p id="f9c7" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">为此，我们将使用熊猫图书馆，它已经安装在jupyter和谷歌colab，所以你只需要导入</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="6073" class="jd je hh kt b fi kx ky l kz la">import pandas as pd</span></pre><p id="1999" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将是创建“n”水印文件的代码。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="6a30" class="jd je hh kt b fi kx ky l kz la">data_names = pd.read_excel('EXCEL_FILE_NAME.xlsx',<br/>sheet_name='Sheet1')<br/>names = data_names.values.tolist()</span><span id="b392" class="jd je hh kt b fi li ky l kz la">for i in range(len(nomes)):<br/>   names[i][0] = names[i][0].replace(u'\xa0', ' ')<br/>   #this line is just because this xa0 was bothering me</span><span id="4e33" class="jd je hh kt b fi li ky l kz la">data_file = pd.read_excel('EXCEL_FILE_NAME.xlsx', sheet_name='Sheet2')<br/>file = data_file.values.tolist()</span><span id="77ad" class="jd je hh kt b fi li ky l kz la">for i in range(len(names)):<br/>    watermark(file[i][0], names[i][0])</span></pre><h2 id="1054" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">将我们的水印添加到我们的教科书中</h2><p id="b242" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">这是我第一眼看到的挑战，我们有一本超过100页的书，单独添加水印会非常累，所以我试图找到可以让我们作为一个群体的生活更容易的东西，我们任务的主要代码将是以下函数:</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="839f" class="jd je hh kt b fi kx ky l kz la">def add_watermark(cbook,output,watermark):<br/>   watermark_obj = PdfFileReader(watermark)<br/>   watermark_page = watermark_obj.getPage(0)<br/>   pdf_reader = PdfFileReader(cbook)<br/>   pdf_writer = PdfFileWriter<br/>   for page in range(pdf_reader.getNumPages()):<br/>      page = pdf_reader.getPage(page)<br/>      page.mergePage(watermark_page)<br/>      pdf_writer.addPage(page)<br/>   with open(output, 'wb') as out:<br/>      pdf_writer.write(out)</span></pre><p id="9738" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我解释一下我们在这里做什么，首先我们用PdfFileReader初始化pdf(这个操作需要一些时间)，然后我们得到这个水印的第0页，因为它是一个单页文件，我们说的是存在的单页，其次我们用PdfFileReader初始化或者教程阅读(同样需要一些时间)，接着我们支持用PdfFileWriter写，这个步骤将在我们的循环中使用。</p><p id="aa16" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们进入我们的循环，我们需要迭代我们的教科书中的每一页，第一步是使用函数“getPage(page)”，这是迭代我们的书的所有页面所必需的，第二步我们将合并页面，用“mergePage”(是的，给文件添加水印只不过是合并两个文件，一个带有我们的水印，一个带有教科书的页面)，然后我们将添加页面，因为这种合并实际上是创建一个新的pdf文件。然后，我们将使用函数“with open”来打开文件，这很重要，“wb”意味着“写入和二进制”，这只是模式(这意味着我们告诉解释器文件将被使用的方式)。最后，我们用新文档中的“write()”来写pdf。</p><h2 id="6c30" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">钓鱼我们的代码</h2><p id="bc37" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">现在我们将制作包含所有水印的课程。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="3e92" class="jd je hh kt b fi kx ky l kz la">data_final_file = pd.read_excel('EXCEL_FILE_NAME.xlsx', sheet_name = 'Sheet3')<br/>books = data_final_file.values.tolist()</span><span id="2b9c" class="jd je hh kt b fi li ky l kz la">for i in range(len(names)):<br/>   cbook = "NAME OF YOUR COURSE BOOK .pdf"<br/>   output = books[i][0]<br/>   watermark = file[i][0]<br/>   add_watermark(cbook, output, watermark)</span></pre><p id="35ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">解释我们在这里所做的事情，首先我们在excel的sheet3中为属于我们学生的每门课程添加我们想要的名称，因此举一个例子，它可以是:“Course book of investments-Eduardo”，重要的是名称不同以便于访问，而不是我们使用我们的循环来迭代我们文件中存在的所有名称，并为我们的学生生成带有水印的每本书。</p><h2 id="1298" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">毕竟，你的pdf应该是这样的</h2><figure class="ko kp kq kr fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/62f728d88a51ed8fb5c23243ac515a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIGaSn_CMW65ecuBAoCXlA.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">我创建这个文档只是作为一个示例，</figcaption></figure><p id="afeb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想你的水印更强，只需改变设置。</p><p id="52ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">观察:</strong>当我运行这段代码时，我正在处理一本120页的教科书，以及120个不同的水印，所以计算我正在处理的14400个合并，需要22分钟才能得出结论。</p><p id="a487" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢你的阅读，如果你有更快的方法，请在下面评论。</p></div></div>    
</body>
</html>