<html>
<head>
<title>AWS: Adding Python Libraries to Lambda Layers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS:将Python库添加到Lambda层</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/aws-adding-python-libraries-to-lambda-layers-8c4eaf8fed80?source=collection_archive---------0-----------------------#2021-04-04">https://medium.com/analytics-vidhya/aws-adding-python-libraries-to-lambda-layers-8c4eaf8fed80?source=collection_archive---------0-----------------------#2021-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3cb5ea2d25f1382f8428f052f4cb18b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3Um5igHw8BEJ3gcY"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">克里斯里德在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4bf1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> AWS Lambda </strong>是制作<em class="jt">短工作流</em>或<em class="jt">调度简单CRON作业</em>的方法，这些作业可能最多运行<strong class="ix hj"> 15分钟</strong>。最棒的是，人们不需要担心设置计算环境，因为它都是无服务器的。您甚至可以将它用作<em class="jt">调度器</em>来触发您的ECS或AWS批处理任务。可能还有很多其他的东西，但是我还没有探索它们。</p><p id="7ca4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Lambda中的Python运行时自带一套<a class="ae iu" href="https://gist.github.com/gene1wood/4a052f39490fae00e0c3" rel="noopener ugc nofollow" target="_blank">标准库</a>。已经安装了很多库，比如boto3、requests、e.t.c，你可以直接导入并创建你的lambda函数。但是，当你想使用不可用的库时，问题就出现了(<em class="jt">甚至熊猫也不可用</em>😐).</p><p id="f4d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，现在要解决这个问题，可以采用以下任何一种方法:</p><ol class=""><li id="efcd" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated"><a class="ae iu" href="https://docs.aws.amazon.com/lambda/latest/dg/python-package.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj"> AWS部署包</strong> </a>:将代码及其所有依赖项打包成一个ZIP文件，上传到AWS。不要觉得这有用，因为你总是需要上传包，即使你每次都使用相同的库。当然，有点反直觉。</li><li id="29de" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj"> AWS Lambda Layers </strong>:把依赖项打包成ZIP文件，上传到AWS就可以了。此外，一旦定义了一个层，任何数量的Lambda函数都可以使用它的所有底层依赖项。</li></ol><p id="f736" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我觉得后一种方法是最好的，因为它节省了大量的时间和空间，并提高了可重复性。我将从现在开始讨论这种方法。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><blockquote class="kp kq kr"><p id="b1ac" class="iv iw jt ix b iy iz ja jb jc jd je jf ks jh ji jj kt jl jm jn ku jp jq jr js hb bi translated"><strong class="ix hj">请注意</strong> : Lambda使用亚马逊linux环境作为其OS。因此，您在Windows笔记本电脑/PC上安装的所有python包可能都无法在其上运行。安装在基于Linux的发行版(如Ubuntu)上的软件包可以工作。Mac应该也能工作但不确定。在我的windows机器上使用<a class="ae iu" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank"> Docker </a>，我将把安装在Ubuntu上的包上传到我的lambda层。所以，如果你还没有安装Docker，我也建议你安装它。</p></blockquote><p id="9f80" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，这就是我们开始将所需的包添加到Lambda层的地方。请原谅我离题了，但我认为给出一个概述总是更好的:)</p><p id="a0b9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">只需按顺序执行以下步骤。突出显示的命令将在您的CLI中运行。</p><ol class=""><li id="7d75" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated"><code class="du kv kw kx ky b">docker run ubuntu</code>:如果图像不存在，提取图像并运行容器。</li><li id="941b" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">apt update</code>:更新高级包工具。</li><li id="f7f4" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">apt install python3.8</code>:安装Python(小心版本。我正在安装3.8)。</li><li id="78d1" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">apt install python3-pip</code>:安装pip。</li><li id="2f29" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">mkdir -p lambda_layer/python/lib/python3.8/site-packages</code>:创建一个安装软件包的目录(确保目录路径相同。第一个文件夹名可以由你选择，在我的例子中是“lambda_layer”。只是要谨慎python版本)。</li><li id="e7d9" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">pip3 install &lt;package-name&gt; -t lambda_layer/python/lib/python3.8/site-packages/</code>:将需要的python包安装到made目录下。对于多个包裹，按空间分开包裹。</li><li id="9508" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">apt-get install zip</code>:安装zip(如果还没有的话)。</li><li id="7c2c" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">cd lambda_layer</code>:将光盘放入文件夹中制作。</li><li id="5cfa" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">zip -r python.zip *</code>:将所有安装好的包保存到一个ZIP文件中。</li><li id="5b84" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">在pc上并排打开一个新的命令提示符会话。</li><li id="34e2" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">docker ps -a</code>:列出所有正在运行的容器。</li><li id="06a0" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">复制ubuntu映像的<strong class="ix hj">容器ID </strong>。它是一个字母数字，如<strong class="ix hj"> 79e37f5ff0db </strong>。</li><li id="eaea" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><code class="du kv kw kx ky b">docker cp 79e37f5ff0db:/lambda_layer/python.zip C:\Users\anshul.sharma\aws</code>:使用以下约定将zip文件从docker容器复制到您的PC—docker CP&lt;CONTAINER _ ID&gt;:&lt;容器中zip的路径&gt; &lt;源目录&gt;</li><li id="04e1" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated">如果<strong class="ix hj"> python.zip </strong>文件小于<strong class="ix hj"> 10MB </strong>直接上传到lambda层，否则先上传到s3，定义lambda层时输入路径。</li></ol><p id="2089" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">起初，这些可能看起来像很多步骤。但是，正如我所说的，这是一次性的活动，一旦上传，任何用户都可以使用这些库，只需将相应的层添加到他们的lambda函数中。</p><p id="b805" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望这篇文章对你有所帮助。我花了很多时间试图找出一种方法来将库添加到lambda层，并考虑共享它。如有任何疑问，请随时联系我:)</p><h2 id="f6d2" class="kz la hi bd lb lc ld le lf lg lh li lj jg lk ll lm jk ln lo lp jo lq lr ls lt bi translated"><a class="ae iu" href="https://www.linkedin.com/in/anshuls235/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>T21<a class="ae iu" href="http://anshuls235@gmail.com" rel="noopener ugc nofollow" target="_blank">Gmail</a></h2></div></div>    
</body>
</html>