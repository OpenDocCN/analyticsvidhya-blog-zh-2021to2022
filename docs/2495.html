<html>
<head>
<title>Write Kubernetes manifests for python flask app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä¸ºpython flaskåº”ç”¨ç¨‹åºç¼–å†™Kubernetesæ¸…å•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/write-kubernetes-manifests-for-python-flask-app-aa9e3bee710b?source=collection_archive---------1-----------------------#2021-04-27">https://medium.com/analytics-vidhya/write-kubernetes-manifests-for-python-flask-app-aa9e3bee710b?source=collection_archive---------1-----------------------#2021-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9ca9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™ç¯‡æ–‡ç« æ˜¯ç³»åˆ—<a class="ae jd" href="https://augustasberneckas.medium.com/prepare-and-deploy-python-app-to-kubernetes-736b13fe4cef" rel="noopener"> <strong class="ih hj">å‡†å¤‡å’Œéƒ¨ç½²pythonåº”ç”¨åˆ°Kubernetes </strong> </a>çš„ä¸€éƒ¨åˆ†</p><p id="8263" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://augustasberneckas.medium.com/containerizing-python-flask-application-19faa9db031c" rel="noopener">ğŸ‘ˆå‰ä¸€ç¯‡æ–‡ç« :å®¹å™¨åŒ–python flaskåº”ç”¨ç¨‹åº</a></p><p id="887c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://augustasberneckas.medium.com/getting-to-know-minikube-e93f9676dea7" rel="noopener">ğŸ‘ˆå‰è´´:äº†è§£Minikube </a></p><p id="656d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸ªç³»åˆ—çš„æœ€åï¼Œæˆ‘ä»¬å°†åœ¨Kubernetesä¸­æ‹¥æœ‰ä¸€ä¸ªå®Œå…¨å¯ç”¨çš„flaskåº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:<a class="ae jd" href="https://github.com/brnck/k8s-python-demo-app/tree/docker" rel="noopener ugc nofollow" target="_blank">https://github.com/brnck/k8s-python-demo-app/tree/docker</a></p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="ddf4" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">å…ˆå†³æ¡ä»¶</h1><p id="706a" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">æˆ‘ä»¬å°†ä½¿ç”¨<code class="du ko kp kq kr b">minikube</code>å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Kubernetesã€‚å¦‚æœä½ å¯¹å®ƒä¸ç†Ÿæ‚‰ï¼Œè¯·åˆ°<a class="ae jd" href="https://augustasberneckas.medium.com/getting-to-know-minikube-e93f9676dea7" rel="noopener">è¿™ç¯‡æ–‡ç« </a>äº†è§£æ›´å¤šï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨è¿™é‡Œè®¨è®ºå¦‚ä½•ä½¿ç”¨Minikubeç­‰è¯é¢˜ã€‚</p><h1 id="1df2" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">å®šä¹‰ç”¨ä¾‹</h1><p id="5f11" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">åœ¨æˆ‘ä»¬å¼€å§‹ç¼–å†™Kubernetesæ¸…å•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè‡ªå·±æ¸…æ¥šåœ°å®šä¹‰æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç”¨ä¾‹ã€‚ç¡®å®šæˆ‘ä»¬éœ€è¦å‘Kuberneteséƒ¨ç½²ä»€ä¹ˆèµ„æºä¼šæ›´å®¹æ˜“ã€‚</p><p id="78dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å› æ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åº:</p><ul class=""><li id="2a6b" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">å¤„ç†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç”¨æˆ·çš„HTTPè¯·æ±‚å¹¶è¿”å›ä¸€äº›å†…å®¹ï¼›</li><li id="f5c6" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">æœ‰ä¸€ä¸ªCLIå‘½ä»¤ï¼Œå®ƒä¹Ÿèƒ½åšä¸€äº›äº‹æƒ…ã€‚è¿™å¯èƒ½æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œæˆ–cronjobã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä»½ä¸€æ¬¡æ€§å·¥ä½œã€‚</li></ul><p id="9744" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦:</p><ul class=""><li id="47cd" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">ä»ç¾¤é›†å¤–éƒ¨è®¿é—®åº”ç”¨ç¨‹åºï¼›</li><li id="1040" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">èƒ½å¤Ÿç‹¬ç«‹æ‰©å±•åº”ç”¨ç¨‹åºï¼›</li><li id="f839" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">èƒ½å¤Ÿè¿è¡Œä¸€æ¬¡æ€§çš„å·¥ä½œã€‚</li></ul><p id="27a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™äº›ç”¨ä¾‹æ¸…æ¥šåœ°è¡¨æ˜äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†ä½¿ç”¨ä»€ä¹ˆæ ·çš„<a class="ae jd" href="https://kubernetes.io/docs/concepts/workloads/" rel="noopener ugc nofollow" target="_blank">å·¥ä½œè´Ÿè½½</a>ã€‚ç°åœ¨ï¼Œæˆ‘ä¸æ‰“ç®—æ·±å…¥è§£é‡Šå·¥ä½œè´Ÿè½½ï¼Œå› ä¸ºæˆ‘å‡è®¾æ‚¨å·²ç»æˆ–å¤šæˆ–å°‘åœ°äº†è§£äº†å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚é™¤äº†å·¥ä½œè´Ÿè½½ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»å›´ç»•å®ƒä»¬æ·»åŠ é¢å¤–çš„èµ„æºï¼Œä»¥ä¾¿é‡‘èæœºæ„å®¢æˆ·èƒ½å¤Ÿè®¿é—®æˆ‘ä»¬çš„åº”ç”¨ã€‚</p><p id="d65f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ€»è€Œè¨€ä¹‹ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬å°†è¦éƒ¨ç½²åˆ°æˆ‘ä»¬çš„Kubernetesé›†ç¾¤çš„Kubernetesèµ„æº:</p><ul class=""><li id="eed9" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" rel="noopener ugc nofollow" target="_blank">åç§°ç©ºé—´</a></li><li id="7743" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">éƒ¨ç½²</a></li><li id="b70c" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" rel="noopener ugc nofollow" target="_blank">å·¥ä½œ</a></li><li id="8c99" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">æœåŠ¡</a></li><li id="f682" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="noopener ugc nofollow" target="_blank">å…¥å£</a></li></ul><h1 id="742d" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">å‡†å¤‡ç›®å½•å’Œæ–‡ä»¶</h1><p id="7d18" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">ä¸ºæ¸…å•åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶æ·»åŠ ç©º(ç›®å‰)æ–‡ä»¶:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="1fe6" class="lt jm hi kr b fi lu lv l lw lx">mkdir k8s-manifests<br/>touch k8s-manifests/namespace.yaml<br/>touch k8s-manifests/deployment.yaml<br/>touch k8s-manifests/job.yaml<br/>touch k8s-manifests/service.yaml<br/>touch k8s-manifests/ingress.yaml</span></pre><p id="c00a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦å¤–ï¼Œå°†<code class="du ko kp kq kr b">k8s-manifests</code>æ–‡ä»¶å¤¹æ·»åŠ åˆ°<code class="du ko kp kq kr b">.dockerignore</code>æ–‡ä»¶ä¸­ï¼Œå› ä¸ºå°†æ¸…å•æ·»åŠ åˆ°æ˜ åƒä¸­æ²¡æœ‰æ„ä¹‰ã€‚å¦‚æœæ‚¨ä½¿ç”¨Kuberneteså·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€äº›å…¬å…±ä¾›åº”å•†åªä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥ä¿å­˜æ‰€æœ‰çš„æ¸…å•ã€‚è™½ç„¶è¿™æ²¡æœ‰ä»€ä¹ˆé”™ï¼Œä½†å®ƒäº§ç”Ÿçš„ç»“æœä¸å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­å¹¶ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°éƒ¨ç½²æ˜¯ä¸€æ ·çš„ã€‚äº‹å®ä¸Šï¼Œå°†æ‰€æœ‰æ¸…å•æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰åŠ©äºèµ„æºéƒ¨ç½²çš„æ’åºï¼Œå› ä¸ºå¿…é¡»é¦–å…ˆéƒ¨ç½²åç§°ç©ºé—´ã€‚ç„¶è€Œï¼Œä¸ºäº†æ¸…æ™°å’Œå¯è¯»æ€§ï¼Œæˆ‘ä»¬å°†æŒ‰èµ„æºåˆ†å‰²æ–‡ä»¶ã€‚</p><h1 id="81aa" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">æ­£åœ¨åˆ›å»ºå‘½åç©ºé—´æ¸…å•</h1><p id="5069" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">åˆ›å»ºåç§°ç©ºé—´é€šå¸¸åŸºäºä¸Šä¸‹æ–‡ã€‚æœ€å¸¸è§çš„å¤§æ¦‚å°±æ˜¯å›¢é˜Ÿæˆ–è€…é¡¹ç›®ã€‚æ‚¨å¯ä»¥ä¸ºæ•´ä¸ªå¼€å‘å›¢é˜Ÿåˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´ï¼Œå®ƒå°†ç”¨äºéƒ¨ç½²æ‰€æœ‰ç±»å‹çš„åº”ç”¨ç¨‹åºã€‚ä»–ä»¬ç”šè‡³å¯èƒ½æ ¹æœ¬æ²¡æœ‰å…³ç³»ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯åªä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å°†å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåšçš„äº‹æƒ…ã€‚ä¸ºä¸€ä¸ªé¡¹ç›®è€Œä¸æ˜¯ä¸€ä¸ªå›¢é˜Ÿåˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´å¯ä»¥é˜²æ­¢ç±»ä¼¼â€œå¦‚æœè¿™ä¸ªå›¢é˜Ÿä¸å…¶ä»–å›¢é˜Ÿåˆä½œç®¡ç†åº”ç”¨ç¨‹åºä¼šæ€ä¹ˆæ ·ï¼Ÿâ€ç”šè‡³ä¸ä¼šå‡ºç°ï¼Œå› ä¸ºä»ç®¡ç†å‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°æ§åˆ¶è®¿é—®ï¼Œå¹¶å°†å®ƒä»¬åªæˆäºˆå¼€å‘äººå‘˜æˆ–å›¢é˜Ÿéœ€è¦è®¿é—®çš„åº”ç”¨ç¨‹åºã€‚</p><p id="748c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬çš„åº”ç”¨å«åš<strong class="ih hj"> k8s-python-demo-app </strong>ã€‚æˆ‘ä»¬å¯ä»¥å»æ‰å‰ç¼€<code class="du ko kp kq kr b">k8s-</code>ï¼Œå°†æˆ‘ä»¬çš„åç§°ç©ºé—´å‘½åä¸º<code class="du ko kp kq kr b">python-demo-app</code>ã€‚</p><p id="982e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬æœ€ç»ˆçš„<code class="du ko kp kq kr b">namespace.yaml</code>æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="3a85" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: python-demo-app</span></pre><h1 id="dee2" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">æ­£åœ¨åˆ›å»ºéƒ¨ç½²æ¸…å•</h1><p id="38be" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">ä¸ºäº†æ›´å¥½åœ°ç†è§£åº”ç”¨ç¨‹åºçš„webéƒ¨åˆ†éœ€è¦ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬æ›´æ·±å…¥åœ°ç ”ç©¶å¹¶å®šä¹‰ç”¨ä¾‹ï¼Œå°±åƒæˆ‘ä»¬å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºæ‰€åšçš„é‚£æ ·ã€‚è¿™å°†æœ‰åŠ©äºæ›´å¥½åœ°ç†è§£å¦‚ä½•ç¼–å†™éƒ¨ç½²æ¸…å•ã€‚</p><p id="5454" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä»ä¸€å¼€å§‹ï¼Œå¿…é¡»åœ¨åç§°ç©ºé—´<code class="du ko kp kq kr b">python-demo-app</code>ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code class="du ko kp kq kr b">python-demo-app-web</code>çš„éƒ¨ç½²ã€‚å®ƒåº”è¯¥ä½¿ç”¨<code class="du ko kp kq kr b">python-demo-app</code>ä½œä¸ºå›¾åƒï¼Œä½¿ç”¨<code class="du ko kp kq kr b">init</code>ä½œä¸ºå›¾åƒæ ‡ç­¾ã€‚æ­¤å¤–ï¼Œå®¹å™¨å¿…é¡»ä½œä¸ºæ²¡æœ‰æƒé™æå‡çš„<code class="du ko kp kq kr b">app</code> (id 1000)ç”¨æˆ·å¯åŠ¨ã€‚å®¹å™¨åº”è¯¥è¯·æ±‚128Miå†…å­˜å’Œ100ä¸ªCPUå‘¨æœŸã€‚æ­¤å¤–ï¼Œèµ„æºåº”è¯¥é™åˆ¶åœ¨256Miå’Œ200ä¸ªCPUå‘¨æœŸã€‚åº”è¯¥æœ‰2ä¸ªå‰¯æœ¬éƒ¨ç½²åˆ°Kubernetesã€‚æœ€åï¼Œå¿…é¡»è¿›è¡Œå¥åº·æ£€æŸ¥ã€‚<a class="ae jd" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-readiness-probes" rel="noopener ugc nofollow" target="_blank">å‡†å¤‡å°±ç»ªæ¢é’ˆ</a>åº”ä¸æ–­æ£€æŸ¥<code class="du ko kp kq kr b">8000</code>ç«¯å£å’Œ<code class="du ko kp kq kr b">/</code>ç«¯ç‚¹ã€‚<a class="ae jd" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-a-liveness-command" rel="noopener ugc nofollow" target="_blank">æ´»æ€§æ¢æµ‹å™¨</a>åº”å¯»æ‰¾Gunicornä¸»è¿›ç¨‹å¹¶ç¡®ä¿å…¶æ­£å¸¸è¿è¡Œã€‚</p><p id="25f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç”¨ä¾‹å·²å®šä¹‰ã€‚ç°åœ¨å¼€å§‹å°†å®ƒè½¬æ¢æˆéƒ¨ç½²èµ„æºæ¸…å•ã€‚</p><p id="d689" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¦–å…ˆï¼Œä»æ·»åŠ å…ƒæ•°æ®å¼€å§‹:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="aa8d" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app</span></pre><p id="3d3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç»§ç»­è¿›è¡Œ<code class="du ko kp kq kr b">.spec</code>éƒ¨åˆ†ã€‚å°†<code class="du ko kp kq kr b">replicas: 2</code>æ·»åŠ åˆ°<code class="du ko kp kq kr b">.spec</code>:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="0539" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app<br/>spec:<br/>  replicas: 2</span></pre><p id="2ee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬è¿˜éœ€è¦åŠ ä¸Š<code class="du ko kp kq kr b">.spec.selector</code>ã€‚æ ¹æ®æ–‡æ¡£ï¼Œ<code class="du ko kp kq kr b">.spec.selector</code>å­—æ®µå®šä¹‰äº†éƒ¨ç½²å¦‚ä½•æ‰¾åˆ°è¦ç®¡ç†çš„podã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨é€‰æ‹©åœ¨Podæ¨¡æ¿ä¸­å®šä¹‰çš„æ ‡ç­¾(<code class="du ko kp kq kr b">app: python-demo-app</code>å’Œ<code class="du ko kp kq kr b">role: web</code>)ã€‚ç„¶è€Œï¼Œæ›´å¤æ‚çš„é€‰æ‹©è§„åˆ™æ˜¯å¯èƒ½çš„ï¼Œåªè¦Podæ¨¡æ¿æœ¬èº«æ»¡è¶³è¯¥è§„åˆ™ã€‚</p><p id="9221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬æ¥å®šä¹‰è¿™ä¸¤è€…:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="8391" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: python-demo-app<br/>      role: web<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: python-demo-app<br/>        role: web</span></pre><p id="e07d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿›ä¸€æ­¥ç§»åŠ¨åˆ°<code class="du ko kp kq kr b">.spec.template.spec</code>ã€‚åœ¨å®šä¹‰å®¹å™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¤„ç†å®‰å…¨æ€§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å€¼ä¸º<code class="du ko kp kq kr b">runAsGroup: 1000</code>å’Œ<code class="du ko kp kq kr b">runAsUser: 1000</code>çš„<code class="du ko kp kq kr b">securitycontext</code>é”®æ¥åšåˆ°è¿™ä¸€ç‚¹(å› ä¸ºæˆ‘ä»¬çš„å›¾åƒç”¨æˆ·æ˜¯app (id 1000))ã€‚ä¸ºä¸€ä¸ªpodå®šä¹‰<code class="du ko kp kq kr b">securitycontext</code>å°†ä½¿Kubernetesä¸ºè¯¥podä¸­çš„æ‰€æœ‰å®¹å™¨åº”ç”¨è¯¥ä¸Šä¸‹æ–‡ã€‚ç»§ç»­æ·»åŠ å®¹å™¨åç§°ã€å›¾åƒã€æ ‡ç­¾å’Œå®¹å™¨ç«¯å£ã€‚è¿˜è®°å¾—dockerçš„å‰ä¸€è¯¾å—ï¼Ÿæˆ‘ä»¬å·²ç»è®¨è®ºè¿‡é»˜è®¤ç›‘å¬ç«¯å£<code class="du ko kp kq kr b">gunicorn</code>ï¼Œå³<code class="du ko kp kq kr b">8000</code>ã€‚å®ƒåº”è¯¥è¢«å®šä¹‰å¹¶å‘½åä¸º<code class="du ko kp kq kr b">gunicorn</code>ã€‚è™½ç„¶å‘½åç«¯å£æ˜¯å¯é€‰çš„ï¼Œä½†å®ƒç¨åä¼šå¯¹æˆ‘ä»¬æœ‰æ‰€å¸®åŠ©ã€‚</p><p id="e01c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç»è¿‡ä¸Šè¿°æ›´æ”¹åï¼Œéƒ¨ç½²æ–‡ä»¶ç°åœ¨åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="9f14" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: python-demo-app<br/>      role: web<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: python-demo-app<br/>        role: web<br/>    spec:<br/>      securityContext:<br/>        runAsGroup: 1000<br/>        runAsUser: 1000 <br/>      containers:<br/>        - name: python-demo-app-web<br/>          image: python-demo-app:init<br/>          ports:<br/>            - name: gunicorn <br/>              containerPort: 8000</span></pre><p id="57d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éœ€è¦ä¸ºå®¹å™¨åˆ†é…å’Œé™åˆ¶çš„èµ„æºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥ä½œè´Ÿè·å¯ä»¥æ²¡æœ‰å·²å®šä¹‰çš„èµ„æºã€‚è¿™æ„å‘³ç€æ‚¨çš„åº”ç”¨ç¨‹åºæœ‰å¯èƒ½æ¥ç®¡æ•´ä¸ªé›†ç¾¤ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå‡ºç°äº†å†…å­˜æ³„æ¼ã€‚è¿™å°†åœ¨ä¸´æ—¶é›†ç¾¤ä¸­é€ æˆé—®é¢˜ï¼Œå¹¶å¯èƒ½åœ¨ç”Ÿäº§é›†ç¾¤ä¸­é€ æˆç¾éš¾ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸ºæ‰€æœ‰å®¹å™¨åˆ†é…å’Œé™åˆ¶èµ„æºé€šå¸¸æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„åšæ³•ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ·±å…¥çš„è¯é¢˜ï¼Œéœ€è¦å¾ˆå¥½åœ°äº†è§£æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŠå®ƒåœ¨å¯åŠ¨å’Œç©ºé—²æ—¶å¦‚ä½•åœ¨å¤§è´Ÿè½½ä¸‹å·¥ä½œã€‚è®¾ç½®ä½é™åˆ¶å°†å¯¼è‡´ä¸å¿…è¦çš„åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸è¦è®¾ç½®å¤ªé«˜çš„é™åˆ¶ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ç§èµ„æºæµªè´¹ï¼Œä¼šé™ä½é›†ç¾¤çš„æ•ˆç‡ã€‚è€ƒè™‘åˆ°è¿™åªæ˜¯ä¸€ä¸ªæŒ‡å—ï¼Œè€Œä¸”æˆ‘ä»¬æ­£åœ¨å­¦ä¹ ï¼Œæˆ‘ä»¬ä¸è¦åœ¨è¿™é‡Œé›†ä¸­ç²¾åŠ›ï¼Œåªå®šä¹‰ä¸€äº›é€»è¾‘èµ„æº<code class="du ko kp kq kr b">requests</code>å’Œ<code class="du ko kp kq kr b">limits</code>ã€‚æ­£å¦‚æˆ‘ä¸Šé¢æåˆ°çš„:</p><blockquote class="ly lz ma"><p id="94c6" class="if ig mb ih b ii ij ik il im in io ip mc ir is it md iv iw ix me iz ja jb jc hb bi translated"><em class="hi">å®¹å™¨åº”è¯¥è¯·æ±‚128Miå†…å­˜å’Œ100ä¸ªCPUå‘¨æœŸã€‚æ­¤å¤–ï¼Œèµ„æºåº”é™åˆ¶åœ¨256Miå’Œ200ä¸ªCPUå‘¨æœŸå†…</em></p></blockquote><p id="36ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åå†è¡¥å……ä¸€ä¸‹<code class="du ko kp kq kr b">liveness</code>å’Œ<code class="du ko kp kq kr b">readiness</code>å¥åº·æ£€æŸ¥ã€‚ä½¿ç”¨<code class="du ko kp kq kr b">readiness</code>æˆ‘ä»¬å°†æ£€æŸ¥æˆ‘ä»¬çš„webæœåŠ¡å™¨æ˜¯å¦å“åº”çŠ¶æ€ä¸º<code class="du ko kp kq kr b">200</code>çš„HTTPè¯·æ±‚ï¼Œä½¿ç”¨<code class="du ko kp kq kr b">liveness</code>æˆ‘ä»¬å°†æ£€æŸ¥<code class="du ko kp kq kr b">gunicorn</code>è¿›ç¨‹çš„PIDä»¥ç¡®ä¿å®ƒæ­£åœ¨è¿è¡Œã€‚æ­¤å¤–ï¼Œè®©æˆ‘ä»¬ç»™å®ƒä¸€äº›åˆå§‹å»¶è¿Ÿï¼Œä»¥ä¾¿<code class="du ko kp kq kr b">gunicorn</code>å·¥äººå¯ä»¥å¯åŠ¨ã€‚</p><p id="775a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€ç»ˆçš„éƒ¨ç½²æ¸…å•åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="547b" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: python-demo-app<br/>      role: web<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: python-demo-app<br/>        role: web<br/>    spec:<br/>      securityContext:<br/>        runAsGroup: 1000<br/>        runAsUser: 1000<br/>      containers:<br/>        - name: python-demo-app-web<br/>          image: python-demo-app:init<br/>          ports:<br/>            - name: gunicorn<br/>              containerPort: 8000<br/>          resources:<br/>            requests:<br/>              memory: 128Mi<br/>              cpu: 100m<br/>            limits:<br/>              memory: 256Mi<br/>              cpu: 200m<br/>          readinessProbe:<br/>            initialDelaySeconds: 10<br/>            httpGet:<br/>              port: gunicorn<br/>              path: /<br/>          livenessProbe:<br/>            initialDelaySeconds: 10<br/>            exec:<br/>              command:<br/>                - /bin/sh<br/>                - -c <br/>                - "pidof -x gunicorn"</span></pre><h1 id="1ca5" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">æ­£åœ¨åˆ›å»ºæœåŠ¡æ¸…å•</h1><p id="00d1" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">ä¸€ç§å°†è¿è¡Œåœ¨ä¸€ç»„podä¸Šçš„åº”ç”¨ç¨‹åºå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æŠ½è±¡æ–¹å¼ã€‚Kubernetesä¸ºä¸€ç»„podæä¾›å®ƒä»¬è‡ªå·±çš„IPåœ°å€å’Œä¸€ä¸ªDNSåç§°ï¼Œå¹¶å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚</p><p id="735f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é€šå¸¸ï¼Œé¦–å…ˆåˆ›å»ºå…ƒæ•°æ®:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="22b1" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app</span></pre><p id="db52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è½¬åˆ°<code class="du ko kp kq kr b">.spec</code>ï¼Œéœ€è¦å®šä¹‰<code class="du ko kp kq kr b">selector</code>ã€‚å®ƒçš„å·¥ä½œåŸç†å’Œã€ŠT2ã€‹ä¸­çš„å·®ä¸å¤šã€‚æœåŠ¡éœ€è¦çŸ¥é“å“ªäº›podæœ‰èµ„æ ¼å°†æµé‡è·¯ç”±åˆ°ã€‚ç”šè‡³å¯ä»¥æ·»åŠ ç›¸åŒçš„<code class="du ko kp kq kr b">labels</code>:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="6ad2" class="lt jm hi kr b fi lu lv l lw lx">spec:<br/>  selector:<br/>    app: python-demo-app<br/>    role: web</span></pre><p id="2fab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ€åï¼ŒæœåŠ¡ä¸ä»…éœ€è¦çŸ¥é“æµé‡è·¯ç”±åˆ°å“ªä¸ªpodï¼Œè¿˜éœ€è¦çŸ¥é“æµé‡è·¯ç”±åˆ°å…¬å¼€ç«¯å£ä¸­çš„å“ªä¸ªç«¯å£ã€‚è™½ç„¶å®ƒå¯ä»¥å°†ä»»ä½•ç«¯å£æ˜ å°„åˆ°ç›®æ ‡podç«¯å£ï¼Œä½†ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼ŒtargetPortè¢«è®¾ç½®ä¸ºä¸ç«¯å£å­—æ®µç›¸åŒçš„å€¼ã€‚è®©æˆ‘ä»¬å°†80ç«¯å£ç”¨äºæœåŠ¡ï¼Œå°†å…¶å‘½åä¸º<code class="du ko kp kq kr b">http</code>ï¼Œå¹¶å°†æµé‡è·¯ç”±åˆ°podä¸­çš„<code class="du ko kp kq kr b">gunicorn</code>(æ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åç§°è€Œä¸æ˜¯ç«¯å£å·)ç«¯å£ã€‚å¦‚æœæ‚¨åšçš„ä¸€åˆ‡éƒ½æ­£ç¡®ï¼Œæ‚¨çš„æœ€ç»ˆæœåŠ¡æ¸…å•åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="a70a" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app<br/>spec:<br/>  selector:<br/>    app: python-demo-app<br/>    role: web<br/>  ports:<br/>    - name: http<br/>      port: 80<br/>      targetPort: gunicorn</span></pre><p id="4c25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæˆ‘ä»¬ç°åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„ä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨<code class="du ko kp kq kr b">service-name.namespace-name</code>è¯­æ³•è®¿é—®è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥åœ¨æ­¤é˜…è¯»æ›´å¤šå…³äºå†…éƒ¨é›†ç¾¤DNSè§£æ<a class="ae jd" href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#namespaces-of-services" rel="noopener ugc nofollow" target="_blank">çš„ä¿¡æ¯ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©æˆ‘ä»¬çš„å®¢æˆ·æ¶ˆè´¹åº”ç”¨ç¨‹åºã€‚è¿™å°±æ˜¯<code class="du ko kp kq kr b">ingress</code>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹</a></p><h1 id="a445" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">æ­£åœ¨åˆ›å»ºå…¥å£æ¸…å•</h1><p id="7eef" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">å…¥å£åŸºæœ¬ä¸Šæ˜¯HTTPå’ŒHTTPSè·¯ç”±å™¨ä»é›†ç¾¤å¤–éƒ¨æä¾›çš„æœåŠ¡ã€‚è·¯ç”±æ˜¯åŸºäºè§„åˆ™çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŸŸå¹¶åŸºäºè§„åˆ™è·¯ç”±åˆ°å®Œå…¨ä¸åŒçš„podã€‚è¿™åªæœ‰ä¸€ä¸ªè·¯ç”±<code class="du ko kp kq kr b">/</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æ‰“ç®—æ·±å…¥ç ”ç©¶é€šè¿‡ä¸€ä¸ªå…¥å£è·¯ç”±åˆ°å¤šä¸ªæœåŠ¡ã€‚ç›¸åï¼Œå½“å¯¹Kubernetesçš„HTTPè¯·æ±‚å¸¦æœ‰ä¸€ä¸ªä¸»æœº<code class="du ko kp kq kr b">python-app.demo.com</code>å’Œ<code class="du ko kp kq kr b">/</code>ç«¯ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°†é…ç½®ingresså°†æµé‡è·¯ç”±åˆ°<code class="du ko kp kq kr b">python-demo-app-web</code>æœåŠ¡</p><p id="a079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘æƒ³åœ¨è¿™é‡Œæ”¾ä¸€ä¸ªå¤§å¤§çš„<strong class="ih hj">å…è´£å£°æ˜</strong>ã€‚<strong class="ih hj"> Nginx </strong>å…¥å£æ§åˆ¶å™¨ä¸­æœ‰ä¸€ä¸ª<a class="ae jd" href="https://github.com/kubernetes/ingress-nginx/pull/6187" rel="noopener ugc nofollow" target="_blank"> bug </a>ã€‚å°†åœ¨minikubeé›†ç¾¤ä¸­ä½¿ç”¨çš„é‚£ä¸ªã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ—§çš„<strong class="ih hj"> apiVersion </strong>ä¼šè¢«ä½¿ç”¨(å½“åº”ç”¨ingressæ—¶ä½ ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Š)ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“ä½œä¸€ä¸ªæŒ‘æˆ˜ï¼Œç”¨ä¿®å¤äº†è¿™ä¸ªé”™è¯¯çš„é•œåƒç‰ˆæœ¬éƒ¨ç½²å…¥å£æ§åˆ¶å™¨ã€‚</p><p id="29e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ å·²ç»çŸ¥é“ç¨‹åºäº†ã€‚å…ƒæ•°æ®:)</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="15f2" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: networking.k8s.io/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app</span></pre><p id="544f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨<code class="du ko kp kq kr b">.spec</code>éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†å®šä¹‰å…¥å£ç±»åï¼Œæˆ‘å·²ç»åœ¨å£°æ˜ä¸­æåˆ°è¿‡äº†ã€‚å¦å¤–ï¼Œ<code class="du ko kp kq kr b">rules</code>æ•°ç»„å¿…é¡»è¢«å®šä¹‰ã€‚æˆ‘ä»¬å¯ä»¥ä»æ·»åŠ ä¸»æŒäºº<code class="du ko kp kq kr b">python-app.demo.com</code>çš„è§„åˆ™å¼€å§‹</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="4441" class="lt jm hi kr b fi lu lv l lw lx">spec:<br/>  rules:<br/>    - host: python-app.demo.com</span></pre><p id="194f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸»æŒå®Œæ¯•ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªç«¯ç‚¹å¹¶å°†æœåŠ¡é™„åŠ åˆ°è¯¥è§„åˆ™ã€‚åœ¨<code class="du ko kp kq kr b">host</code>åŒèƒ- <code class="du ko kp kq kr b">http</code>ä¸‹ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯å®šä¹‰çš„ã€‚æœ€ç»ˆç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="f441" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: networking.k8s.io/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: python-demo-app-web<br/>  namespace: python-demo-app<br/>spec:<br/>  rules:<br/>    - host: python-app.demo.com<br/>      http:<br/>        paths:<br/>          - path: /<br/>            pathType: Prefix<br/>            backend:<br/>              serviceName: python-demo-app-web<br/>              servicePort: http</span></pre><p id="9f03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å› ä¸ºé”®åå¾ˆå®¹æ˜“è§£é‡Šï¼Œæ‰€ä»¥æ‚¨å¯èƒ½å·²ç»çŸ¥é“è¿™ä¸ªæ¸…å•å¯ä»¥ç¿»è¯‘ä¸º:</p><blockquote class="ly lz ma"><p id="09e7" class="if ig mb ih b ii ij ik il im in io ip mc ir is it md iv iw ix me iz ja jb jc hb bi translated"><em class="hi">é€šè¿‡å…¥å£æ§åˆ¶å™¨ã€ä¸»æœºpython-app.demo.comå’Œä»¥/å¼€å¤´çš„ç«¯ç‚¹å‘å‡ºçš„æ‰€æœ‰httpè¯·æ±‚å¿…é¡»è½¬å‘åˆ°åä¸ºpython-demo-appçš„æœåŠ¡åŠå…¶ç«¯å£httpï¼Œè¯¥ç«¯å£http(å¦‚æœæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹æœåŠ¡æ¸…å•)åº”å°†æµé‡è½¬å‘åˆ°å…¶ä¸­ä¸€ä¸ªåº”ç”¨:python-demo-appï¼Œrole: webæ ‡ç­¾çš„podsåŠå…¶gunicornç«¯å£8000 </em></p></blockquote><p id="cde9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç½‘ç»œæµé‡å¤„ç†çš„ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ã€‚è®©æˆ‘ä»¬ä¸ºè¿è¡Œä¸€æ¬¡æ€§ä½œä¸šåˆ›å»ºæœ€åä¸€ä¸ªæ¸…å•</p><h1 id="1e81" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">æ­£åœ¨åˆ›å»ºä½œä¸šæ¸…å•</h1><p id="3d32" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" rel="noopener ugc nofollow" target="_blank">ä½œä¸š</a>åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªpodï¼Œå®ƒä»¬è¢«å®‰æ’è¿è¡Œç›´åˆ°æˆåŠŸå®Œæˆæˆ–è¢«åˆ é™¤ã€‚äººå·¥æ™ºèƒ½ä½œä¸šå¯ç”¨äºè¿è¡Œæ•°æ®åº“æ¨¡å¼æ›´æ–°ï¼Œæ‰§è¡ŒæŸç§ç»´æŠ¤ä»»åŠ¡ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­çš„å·¥ä½œéå¸¸ç®€å•â€”â€”æ‰“å°å‡º<code class="du ko kp kq kr b">Hello, world from CLI!</code>ã€‚</p><p id="5f4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸æ‰€æœ‰å…¶ä»–æ¸…å•ä¸€æ ·ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œä½œä¸šéœ€è¦apiVersionã€kindå’Œmetadataå­—æ®µã€‚</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="7a49" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: batch/v1<br/>kind: Job<br/>metadata:<br/>  name: hello-world-job<br/>  namespace: python-demo-app</span></pre><p id="3629" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ko kp kq kr b">.spec.template</code>æ˜¯<code class="du ko kp kq kr b">.spec</code>çš„å”¯ä¸€å¿…å¡«å­—æ®µã€‚æ›´ä½•å†µ<code class="du ko kp kq kr b">.spec.template</code>æ˜¯ä¸€ä¸ªpodæ¨¡æ¿ã€‚å®ƒä¸podå…·æœ‰å®Œå…¨ç›¸åŒçš„æ¨¡å¼ï¼Œé™¤äº†å®ƒæ˜¯åµŒå¥—çš„å¹¶ä¸”æ²¡æœ‰<code class="du ko kp kq kr b">apiVersion</code>æˆ–<code class="du ko kp kq kr b">kind</code>ã€‚äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬å®Œæˆåˆ›å»ºè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°<code class="du ko kp kq kr b">deployment</code>å’Œ<code class="du ko kp kq kr b">job</code>æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚</p><p id="8fa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚<code class="du ko kp kq kr b">deployment</code>æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†<code class="du ko kp kq kr b">labels</code>æ·»åŠ åˆ°<code class="du ko kp kq kr b">template</code>ä¸­:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="bc56" class="lt jm hi kr b fi lu lv l lw lx">spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: python-demo-app<br/>        role: hello-world-job</span></pre><p id="a976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ·»åŠ <code class="du ko kp kq kr b">.spec.template.spec.securityContext</code>ç»§ç»­ã€‚æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå®¹å™¨ä¹Ÿèƒ½ä½œä¸ºç”¨æˆ·<strong class="ih hj">åº”ç”¨</strong>è¿è¡Œã€‚ä½ æƒ³è¿‡å¦‚æœå·¥ä½œå¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆå—ï¼ŸKubernetesä¼šé‡å¯ä½œä¸šå—ï¼Ÿæˆ–è€…å®ƒåªæ˜¯å°†å…¶æ ‡è®°ä¸ºå¤±è´¥è€Œä»€ä¹ˆä¹Ÿä¸åšï¼Ÿæ ¹æ®æ–‡ä»¶è®°è½½:</p><blockquote class="ly lz ma"><p id="2ff5" class="if ig mb ih b ii ij ik il im in io ip mc ir is it md iv iw ix me iz ja jb jc hb bi translated"><em class="hi">ä½œä¸šä»…é€‚ç”¨äºé‡å¯ç­–ç•¥ç­‰äºOnFailureæˆ–Neverçš„podã€‚(æ³¨æ„:å¦‚æœæ²¡æœ‰è®¾ç½®RestartPolicyï¼Œé»˜è®¤å€¼æ€»æ˜¯</em></p></blockquote><p id="f02d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ–è€…æ¢å¥è¯è¯´ï¼ŒKubernetesé»˜è®¤å°†<code class="du ko kp kq kr b">restartPolicy</code>è®¾ä¸º<code class="du ko kp kq kr b">Always</code>ã€‚å¦‚æœåœ¨æ²¡æœ‰è®¾ç½®é€‚å½“çš„<code class="du ko kp kq kr b">restartPolicy</code>çš„æƒ…å†µä¸‹éƒ¨ç½²ä½œä¸šï¼Œéƒ¨ç½²æœ¬èº«å°±ä¼šå¤±è´¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ <code class="du ko kp kq kr b">restartPolicy: OnFailure</code></p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="49c1" class="lt jm hi kr b fi lu lv l lw lx">spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: python-demo-app<br/>        role: hello-world-job<br/>    spec:<br/>      securityContext:<br/>        runAsGroup: 1000<br/>        runAsUser: 1000<br/>      restartPolicy: OnFailure</span></pre><p id="83aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¯¹äºå®¹å™¨éƒ¨åˆ†ï¼Œä¼šæœ‰ä¸€äº›ä¸åŒã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¸éœ€è¦å…¬å¼€ä»»ä½•å®¹å™¨ç«¯å£ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªCLIå‘½ä»¤ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ä¼šåšä»»ä½•<code class="du ko kp kq kr b">readiness</code>æ£€æŸ¥ï¼Œå› ä¸ºè¯¥å®¹å™¨ä¸æ¥å—ä»»ä½•æµé‡ã€‚æ­¤å¤–ï¼Œä¸ºäº†è¿™ä¸ªæŒ‡å—ï¼Œæˆ‘ä»¬ä¸è¦åš<code class="du ko kp kq kr b">liveness</code>æ£€æŸ¥ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤ä¼šè¿è¡Œå¾—å¾ˆå¿«ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰ç”¨ã€‚</p><p id="8ac4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åº”ç”¨æ›´æ”¹<code class="du ko kp kq kr b">containers</code>åï¼Œé›¶ä»¶åº”å¦‚ä¸‹æ‰€ç¤º:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="bc07" class="lt jm hi kr b fi lu lv l lw lx">      containers:<br/>        - name: python-demo-app-hello-world-job<br/>          image: python-demo-app:init<br/>          command:<br/>            - python3<br/>          args:<br/>            - cli.py<br/>          resources:<br/>            requests:<br/>              memory: 128Mi<br/>              cpu: 100m<br/>            limits:<br/>              memory: 256Mi<br/>              cpu: 200m</span></pre><p id="be88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°æœ‰ä¸¤ä¸ªæ–°çš„é”®(<code class="du ko kp kq kr b">command</code>å’Œ<code class="du ko kp kq kr b">args</code>ï¼Œå®ƒä»¬åœ¨<code class="du ko kp kq kr b">deployment</code>ä¸­æ²¡æœ‰å‡ºç°)ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹æˆ‘ä»¬åœ¨è¿™é‡Œåšä»€ä¹ˆã€‚å¦‚æœæ‚¨ä»ä¸€å¼€å§‹å°±éµå¾ªæœ¬æŒ‡å—ï¼Œæ‚¨å¯èƒ½ä¼šè®°å¾—æˆ‘ä»¬ä½¿ç”¨äº†ç›¸åŒçš„æ˜ åƒæ¥è¿è¡Œæˆ‘ä»¬çš„webæœåŠ¡å™¨å’ŒCLIå‘½ä»¤ã€‚å”¯ä¸€çš„ä¸åŒæ˜¯æˆ‘ä»¬æ”¹å˜äº†å®¹å™¨<code class="du ko kp kq kr b">entrypoint</code>å’Œ<code class="du ko kp kq kr b">cmd</code>ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€åšçš„ã€‚å…³äº<code class="du ko kp kq kr b">command</code>å’Œ<code class="du ko kp kq kr b">args</code>çš„æ›´å¤šè§£é‡Šå¯ä»¥åœ¨<a class="ae jd" href="https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚åƒè¿™æ ·çš„æ–¹æ³•å¹¶ä¸æ€»æ˜¯å¥½çš„ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸“é—¨ä¸ºCLIåˆ›å»ºå•ç‹¬çš„æ˜ åƒä¼šæ›´å¥½ï¼Œä½†æˆ‘ä»¬ä¸è¦è®¨è®ºç»†èŠ‚ï¼Œå› ä¸ºè¿™è¶…å‡ºäº†æœ¬æŒ‡å—çš„èŒƒå›´ã€‚</p><p id="953b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬çš„æœ€ç»ˆå·¥ä½œåº”è¯¥æ˜¯è¿™æ ·çš„:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="eb56" class="lt jm hi kr b fi lu lv l lw lx">apiVersion: batch/v1<br/>kind: Job<br/>metadata:<br/>  name: hello-world-job<br/>  namespace: python-demo-app<br/>spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: python-demo-app<br/>        role: hello-world-job<br/>    spec:<br/>      securityContext:<br/>        runAsGroup: 1000<br/>        runAsUser: 1000<br/>      restartPolicy: OnFailure<br/>      containers:<br/>        - name: python-demo-app-hello-world-job<br/>          image: python-demo-app:init<br/>          command:<br/>            - python3<br/>          args:<br/>            - cli.py<br/>          resources:<br/>            requests:<br/>              memory: 128Mi<br/>              cpu: 100m<br/>            limits:<br/>              memory: 256Mi<br/>              cpu: 200m</span></pre><h1 id="803e" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">éƒ¨ç½²åˆ°Kubernetes</h1><p id="57c5" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">æ˜¯æ—¶å€™å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Kubernetesäº†ã€‚</p><p id="f32a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª<code class="du ko kp kq kr b">minikube</code>é›†ç¾¤ã€‚æˆ‘å°†ä¸ºæˆ‘çš„Kubernetesé›†ç¾¤æä¾›<code class="du ko kp kq kr b">virtualbox</code>é©±åŠ¨ç¨‹åºå’Œ<code class="du ko kp kq kr b">kubernetes-version</code>ç‰ˆæœ¬1.20.5 ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨ä¸æˆ‘ç›¸åŒçš„å‘½ä»¤ï¼Œå¦åˆ™ï¼ŒæŸäº›éƒ¨åˆ†å¯èƒ½ä¸ä¼šäº§ç”Ÿæˆ‘ä»¬æœŸæœ›çš„ç»“æœã€‚åªæœ‰å½“ä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆçš„æ—¶å€™ï¼Œæ‰è¿›è¡Œä¸åŒçš„é…ç½®ã€‚</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="01ad" class="lt jm hi kr b fi lu lv l lw lx">minikube start --driver=virtualbox --kubernetes-version=1.20.5</span></pre><p id="24b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¯ç”¨å…¥å£æ’ä»¶:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="4f55" class="lt jm hi kr b fi lu lv l lw lx">minikube addons enable ingress</span></pre><p id="b2ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç¡®è®¤ç¾¤é›†å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œ:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="c7a9" class="lt jm hi kr b fi lu lv l lw lx">kubectl get nodes                                        <br/>NAME       STATUS   ROLES                  AGE   VERSION<br/>minikube   Ready    control-plane,master   81s   v1.20.5</span></pre><p id="482d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æœ¬æŒ‡å—ä¸ä»‹ç»å¦‚ä½•æ„å»ºä¸€ä¸ªæ˜ åƒå¹¶å°†å…¶æ¨é€åˆ°ç§æœ‰æˆ–å…¬å…±æ³¨å†Œä¸­å¿ƒã€‚ç›¸åï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ç›´æ¥åœ¨minikubeè™šæ‹Ÿæœºä¸Šæ„å»ºä¸€ä¸ªæ˜ åƒã€‚ç¡®ä¿æ‚¨ä½äºç»ˆç«¯çš„åº”ç”¨ç¨‹åºç›®å½•ä¸­:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="147c" class="lt jm hi kr b fi lu lv l lw lx">eval $(minikube docker-env)<br/>docker build -t python-demo-app:init .<br/>&lt;...&gt;<br/>Successfully built 22008520508b<br/>Successfully tagged python-demo-app:init</span></pre><p id="af49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç¡®è®¤:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="9353" class="lt jm hi kr b fi lu lv l lw lx">minikube ssh docker images | grep python-demo-app<br/>python-demo-app                           init         22008520508b   About a minute ago   125MB</span></pre><p id="7f50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚ç»§ç»­åˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´å¹¶ç¡®è®¤å®ƒ:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="2e6a" class="lt jm hi kr b fi lu lv l lw lx">kubectl apply -f k8s-manifests/namespace.yaml<br/>kubectl get namespaces<br/>NAME              STATUS   AGE<br/>default           Active   11m<br/>ingress-nginx     Active   10m<br/>kube-node-lease   Active   11m<br/>kube-public       Active   11m<br/>kube-system       Active   11m<br/>python-demo-app   Active   12s # &lt;-- Here is our namespace</span></pre><p id="b9ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="7b56" class="lt jm hi kr b fi lu lv l lw lx">kubectl apply -f k8s-manifests/deployment.yaml \<br/>  -f k8s-manifests/service.yaml \<br/>  -f k8s-manifests/ingress.yaml \<br/>  -f k8s-manifests/job.yaml</span></pre><p id="dafd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubectlå°†è¿”å›ä¸€ä¸ªè¾“å‡º:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="7ba0" class="lt jm hi kr b fi lu lv l lw lx">deployment.apps/python-demo-app-web created<br/>service/python-demo-app-web created<br/>Warning: networking.k8s.io/v1beta1 Ingress is deprecated in v1.19+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress<br/>ingress.networking.k8s.io/python-demo-app-web created<br/>job.batch/hello-world-job created</span></pre><p id="ada9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å·²ç»æåˆ°äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨<code class="du ko kp kq kr b">networking.k8s.io/v1beta1</code>è€Œä¸æ˜¯<code class="du ko kp kq kr b">networking.k8s.io/v1</code></p><p id="5da8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è®©æˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æ‰€æœ‰èµ„æºéƒ½å·²éƒ¨ç½²å¹¶æ­£åœ¨è¿è¡Œ:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="f1d9" class="lt jm hi kr b fi lu lv l lw lx">kubectl get pods,jobs,service,ingress -n python-demo-app<br/>NAME                                      READY   STATUS      RESTARTS   AGE<br/>pod/hello-world-job-9l9w9                 0/1     Completed   0          10s<br/>pod/python-demo-app-web-5f756fbcc-628cd   0/1     Running     0          10s<br/>pod/python-demo-app-web-5f756fbcc-cz5kl   0/1     Running     0          10s</span><span id="3d47" class="lt jm hi kr b fi mf lv l lw lx">NAME                        COMPLETIONS   DURATION   AGE<br/>job.batch/hello-world-job   1/1           3s         10s</span><span id="9dde" class="lt jm hi kr b fi mf lv l lw lx">NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE<br/>service/python-demo-app-web   ClusterIP   10.100.245.172   &lt;none&gt;        80/TCP    10s</span><span id="7d9f" class="lt jm hi kr b fi mf lv l lw lx">NAME                                            CLASS   HOSTS                 ADDRESS   PORTS   AGE<br/>ingress.networking.k8s.io/python-demo-app-web   nginx   python-app.demo.com             80      10s</span></pre><p id="45b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç½‘ç»œè±†èšè¿˜åœ¨å¯åŠ¨ã€‚è®©æˆ‘ä»¬å†ç­‰å‡ ç§’é’Ÿã€‚åœ¨æˆ‘ä»¬ç­‰å¾…çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥<code class="du ko kp kq kr b">job</code>ç®±<code class="du ko kp kq kr b">pod/hello-world-job-9l9w9</code>ï¼Œå› ä¸ºå·¥ä½œè¢«æ ‡è®°ä¸ºå·²å®Œæˆ:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="f093" class="lt jm hi kr b fi lu lv l lw lx">kubectl logs hello-world-job-9l9w9 -n python-demo-app                         <br/>Hello, world from CLI!</span></pre><p id="7397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å®Œç¾ï¼ä¸€æ¬¡æ€§ä½œä¸šæˆåŠŸè¿è¡Œå¹¶å®Œæˆã€‚è¿”å›webçª—æ ¼:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="f644" class="lt jm hi kr b fi lu lv l lw lx">kubectl get deployment,replicaset,pods -n python-demo-app<br/>NAME                                  READY   UP-TO-DATE   AVAILABLE   AGE<br/>deployment.apps/python-demo-app-web   0/2     2            0           6m9s</span><span id="22d1" class="lt jm hi kr b fi mf lv l lw lx">NAME                                            DESIRED   CURRENT   READY   AGE<br/>replicaset.apps/python-demo-app-web-5f756fbcc   2         2         0       6m9s</span><span id="e6cb" class="lt jm hi kr b fi mf lv l lw lx">NAME                                      READY   STATUS      RESTARTS   AGE<br/>pod/hello-world-job-9l9w9                 0/1     Completed   0          6m9s<br/>pod/python-demo-app-web-5f756fbcc-628cd   0/1     Running     0          6m9s<br/>pod/python-demo-app-web-5f756fbcc-cz5kl   0/1     Running     0          6m9s</span></pre><p id="3b46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">podæ­£åœ¨è¿è¡Œï¼Œä½†æœªæ ‡è®°ä¸ºå°±ç»ªã€‚æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚æˆ‘ä»¬éœ€è¦æ£€æŸ¥ä¸€ä¸ªè±†èšçš„æ—¥å¿—:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="f402" class="lt jm hi kr b fi lu lv l lw lx">kubectl logs python-demo-app-web-5f756fbcc-628cd -n python-demo-app<br/>[2021-04-22 21:22:32 +0000] [1] [INFO] Starting gunicorn 20.0.4<br/>[2021-04-22 21:22:32 +0000] [1] [INFO] Listening at: http://127.0.0.1:8000 (1)<br/>[2021-04-22 21:22:32 +0000] [1] [INFO] Using worker: sync<br/>[2021-04-22 21:22:32 +0000] [7] [INFO] Booting worker with pid: 7</span></pre><p id="63a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ²¡ä»€ä¹ˆå¥‡æ€ªçš„ã€‚æè¿°ä¸€ä¸‹é‚£ä¸ªè±†èšæ€ä¹ˆæ ·:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="b882" class="lt jm hi kr b fi lu lv l lw lx">kubectl describe pod python-demo-app-web-5f756fbcc-628cd -n python-demo-app<br/>&lt;...&gt;<br/>Events:<br/>  Type     Reason     Age                     From               Message<br/>  ----     ------     ----                    ----               -------<br/>  Normal   Scheduled  9m5s                    default-scheduler  Successfully assigned python-demo-app/python-demo-app-web-5f756fbcc-628cd to minikube<br/>  Normal   Pulled     9m3s                    kubelet            Container image "python-demo-app:init" already present on machine<br/>  Normal   Created    9m3s                    kubelet            Created container python-demo-app-web<br/>  Normal   Started    9m3s                    kubelet            Started container python-demo-app-web<br/>  Warning  Unhealthy  3m55s (x30 over 8m45s)  kubelet            Readiness probe failed: Get "http://172.17.0.3:8000/": dial tcp 172.17.0.3:8000: connect: connection refused</span></pre><p id="3e44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é€šè¿‡æ£€æŸ¥ä¸¤ä¸ªè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°é—®é¢˜ã€‚<code class="du ko kp kq kr b">gunicorn</code>æ¸…æ¥šåœ°æ˜¾ç¤ºå®ƒåœ¨<code class="du ko kp kq kr b">localhost</code>ç›‘å¬ï¼Œè€Œ<code class="du ko kp kq kr b">Readiness</code>è¯•å›¾å‘å®¹å™¨IPå‘å‡ºHTTPè¯·æ±‚ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å°†<code class="du ko kp kq kr b">gunicorn</code>ç»‘å®šåˆ°æ‰€æœ‰æ¥å£ã€‚è¿™å¯ä»¥é€šè¿‡å‘å¸¦æœ‰<code class="du ko kp kq kr b">--bind 0.0.0.0</code>æ ‡å¿—çš„<code class="du ko kp kq kr b">container</code>æ·»åŠ <code class="du ko kp kq kr b">args</code>éƒ¨åˆ†æ¥è§£å†³ã€‚å½“ç„¶ï¼Œæœ‰æ›´å¤šçš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æˆ‘å°†æŠŠé‚£ä¸ªç•™ç»™ä½ ï¼Œä»¥é˜²è¿™ä¸ªå¤ªå®¹æ˜“ã€‚</p><p id="61fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä»<code class="du ko kp kq kr b">Dockerfile</code>æˆ‘ä»¬çŸ¥é“ï¼Œæä¾›ç»™<code class="du ko kp kq kr b">entrypoint</code>çš„å‚æ•°æ˜¯<code class="du ko kp kq kr b">app:app</code>ã€‚è¿™æ„å‘³ç€å®ƒä¹Ÿå¿…é¡»æ·»åŠ åˆ°<code class="du ko kp kq kr b">args</code>ä¸­ã€‚</p><p id="efa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å‰å¾€<code class="du ko kp kq kr b">deployment</code>æ¸…å•ï¼Œå¹¶åœ¨<code class="du ko kp kq kr b">image</code>é”®ä¸‹æ·»åŠ <code class="du ko kp kq kr b">args</code>:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="0fb1" class="lt jm hi kr b fi lu lv l lw lx">&lt;...&gt;<br/>          image: python-demo-app:init<br/>          args:<br/>            - '--bind'<br/>            - '0.0.0.0'<br/>            - 'app:app'<br/>          ports:<br/>&lt;...&gt;</span></pre><p id="2795" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">é‡æ–°éƒ¨ç½²</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="4dd2" class="lt jm hi kr b fi lu lv l lw lx">kubectl apply -f k8s-manifests/deployment.yaml<br/>deployment.apps/python-demo-app-web configured</span></pre><p id="0966" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">30-60ç§’åï¼Œpodåº”è¯¥å¼€å§‹è¿è¡Œ</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="c2d5" class="lt jm hi kr b fi lu lv l lw lx">kubectl get pods -n python-demo-app                      <br/>NAME                                   READY   STATUS      RESTARTS   AGE<br/>hello-world-job-9l9w9                  0/1     Completed   0          22m<br/>python-demo-app-web-6c4cc75ddc-tmxjl   1/1     Running     0          67s<br/>python-demo-app-web-6c4cc75ddc-wb79r   1/1     Running     0          87s</span></pre><p id="ea23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">çš„ç¡®å¦‚æ­¤ã€‚æˆ‘ä»¬èµ°å§ã€‚æˆ‘ä»¬å‘ç°å¹¶ä¿®å¤äº†ä¸€ä¸ªé”™è¯¯ï¼</p><p id="9aee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å¯ä»¥ä»å¤–éƒ¨è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå—ï¼Ÿè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="7cb2" class="lt jm hi kr b fi lu lv l lw lx">curl -H "Host: python-app.demo.com" $(minikube ip)/<br/>Hello, World!</span></pre><p id="5569" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HTTPè¯·æ±‚æˆåŠŸï¼Œè¿”å›ç­”æ¡ˆï¼æ²¡æœ‰åˆ«çš„äº‹å¯åšäº†ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥æ¸…é™¤é›†ç¾¤ä¸­çš„æ‰€æœ‰å†…å®¹:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="30a3" class="lt jm hi kr b fi lu lv l lw lx">kubectl delete -f k8s-manifests/deployment.yaml \<br/>  -f k8s-manifests/service.yaml \<br/>  -f k8s-manifests/ingress.yaml \<br/>  -f k8s-manifests/job.yaml</span></pre><p id="ba05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­¤å¤–ï¼Œåˆ é™¤åç§°ç©ºé—´:</p><pre class="ll lm ln lo fd lp kr lq lr aw ls bi"><span id="042c" class="lt jm hi kr b fi lu lv l lw lx">kubectl delete -f k8s-manifests/namespace.yaml</span></pre><h1 id="d0dd" class="jl jm hi bd jn jo ks jq jr js kt ju jv jw ku jy jz ka kv kc kd ke kw kg kh ki bi translated">ç»“è®º</h1><p id="5f50" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">æ­å–œä½ å†™äº†ä½ è‡ªå·±çš„Kubernetesæ¸…å•ã€‚å¦‚æœè¿™å¤ªç®€å•äº†ï¼Œè€Œä½ æƒ³è¦æ›´å¤šï¼Œè¿™é‡Œæœ‰å‡ ä¸ªå¯ä»¥é¢å¤–å®Œæˆçš„ä»»åŠ¡:</p><ul class=""><li id="c406" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">ä¿®æ”¹CLIå‘½ä»¤ä»¥è¯»å–åä¸º<code class="du ko kp kq kr b">MESSAGE</code>çš„<code class="du ko kp kq kr b">environment variable</code>ï¼Œå¹¶ä½¿ç”¨<a class="ae jd" href="https://kubernetes.io/docs/concepts/configuration/configmap/" rel="noopener ugc nofollow" target="_blank">é…ç½®å›¾</a>ä¼ é€’å€¼</li><li id="37b5" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">ä½¿ç”¨<code class="du ko kp kq kr b">configmap</code>åˆ›å»º<code class="du ko kp kq kr b">gunicorn</code>é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶å®‰è£…åˆ°<code class="du ko kp kq kr b">web</code>åŠèˆ±ã€‚ç¡®ä¿<code class="du ko kp kq kr b">bind</code>æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶ä¼ é€’çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡<code class="du ko kp kq kr b">args</code></li></ul><p id="ee46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åº”ç”¨ç¨‹åºçš„æ¸…å•å¯ä»¥åœ¨<a class="ae jd" href="https://github.com/brnck/k8s-python-demo-app/tree/manifests" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚ç»§ç»­ä¸‹ä¸€ä¸ªæŒ‡å—ï¼Œæˆ‘ä»¬å°†<a class="ae jd" href="https://augustasberneckas.medium.com/write-helm-charts-for-python-flask-app-ee2777fb458c" rel="noopener">å°†æ¸…å•åŒ…è£…åˆ°èˆµå›¾</a></p></div></div>    
</body>
</html>