<html>
<head>
<title>Performance Analysis and Optimization in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的性能分析和优化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/performance-analysis-and-optimization-in-python-c94939eceb91?source=collection_archive---------13-----------------------#2021-02-07">https://medium.com/analytics-vidhya/performance-analysis-and-optimization-in-python-c94939eceb91?source=collection_archive---------13-----------------------#2021-02-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1039" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为一名程序员，最重要的任务之一就是分析代码并优化它，这样代码就可以使用更少的内存和时间。有人可能会认为，找到占用更多内存空间的代码部分是一项单调乏味的任务。但是等等，幸运的是在Python中，我们有不同的性能分析库，例如:cProfile，line-profiler，guppy，memory-profiler。在本文中，我们将讨论用于监控内存消耗的内存分析器库。</p><p id="1908" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模块<strong class="ih hj">内存分析器</strong>返回python程序的内存消耗的逐行分析。</p><p id="f37f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">安装</strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="2bf9" class="jm jn hi ji b fi jo jp l jq jr">pip install -U memory_profiler</span></pre><p id="ac64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要获得逐行分析，请遵循以下两个步骤:</p><ol class=""><li id="f003" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc jx jy jz ka bi translated">导入模块。</li><li id="6e4b" class="js jt hi ih b ii kb im kc iq kd iu ke iy kf jc jx jy jz ka bi translated">使用装饰@配置文件</li></ol><p id="dc7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的例子中，我们调用my_func()，在其中我们只是做一些计算并存储在变量' a '中，然后我们删除了' a '。这个程序可能与实际问题无关，但是这个代码足以理解内存分析。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="d9e1" class="jm jn hi ji b fi jo jp l jq jr">from memory_profiler import profile<br/>@profile<br/>def my_func(x):<br/>    a = [x]*(10**8)<br/>    del a</span><span id="e6d0" class="jm jn hi ji b fi kg jp l jq jr">my_func(20)</span></pre><p id="3b6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">输出:</strong></p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="9f2d" class="jm jn hi ji b fi jo jp l jq jr">Line #    Mem usage    Increment  Occurences   Line Contents<br/>============================================================<br/>     2     20.3 MiB     20.3 MiB           1   <a class="ae kh" href="http://twitter.com/profile" rel="noopener ugc nofollow" target="_blank">@profile</a><br/>     3                                         def my_func(x):<br/>     4    783.2 MiB    762.9 MiB           1       a = [x]*(10**8)<br/>     5     20.3 MiB   -762.9 MiB           1       del a</span></pre><p id="f9a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一列表示已被分析的代码的行号，第二列(<em class="ki"> Mem usage </em>)表示该行被执行后使用的内存。第三列(<em class="ki">增量</em>)表示当前行相对于上一行的内存差异。第四列<em class="ki">(occurrences)</em>表示特定代码行的出现次数。最后一列(<em class="ki">行内容</em>)打印已经分析过的代码。</p><blockquote class="kj kk kl"><p id="5c21" class="if ig ki ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">注:</em> </strong> <em class="hi">内存分析器</em>以<strong class="ih hj"> MiB(兆字节)而非MB(兆字节)表示内存使用量。</strong>一个<strong class="ih hj">兆字节</strong>等于<strong class="ih hj">1048576字节</strong>一个<strong class="ih hj">兆字节等于<strong class="ih hj">1000000字节。</strong></strong></p><p id="c22b" class="if ig ki ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated">如果您已经观察到了上述示例的输出，内存分析器需要一些内存来进行分析，因此建议在开发中使用，而不是在生产中使用。</p></blockquote><p id="6dd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时候，将完整的内存使用报告作为外部进程(无论是否是Python脚本)的时间函数(而不是逐行)是很有用的。在这种情况下，可执行文件<strong class="ih hj"> mprof </strong>可能会有用。</p><p id="759f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先需要在终端运行程序使用<strong class="ih hj"><em class="ki">mprov运行&lt;可执行&gt; </em> </strong>命令:</p><p id="3172" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">示例:</strong>运行以下命令后，它将返回与上面相同的输出。</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="9884" class="jm jn hi ji b fi jo jp l jq jr">mprof run profiler.py</span></pre><p id="8eaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在使用下面命令来绘制图形:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="4403" class="jm jn hi ji b fi jo jp l jq jr">mprof plot</span></pre><figure class="jd je jf jg fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kp"><img src="../Images/3b04d2f0a07b7a0e454e25d18bdeb12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ew78eTIy0zfHQBEkwhjLkA.png"/></div></div></figure><p id="85a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">其他mprof命令:</strong></p><ul class=""><li id="685f" class="js jt hi ih b ii ij im in iq ju iu jv iy jw jc kx jy jz ka bi translated"><strong class="ih hj"> <em class="ki"> mprof list: </em> </strong>以用户友好的方式列出所有记录的内存使用文件。</li><li id="f927" class="js jt hi ih b ii kb im kc iq kd iu ke iy kf jc kx jy jz ka bi translated"><strong class="ih hj"><em class="ki">MPR of clean:</em></strong><em class="ki"/>清除所有记录的内存使用文件。</li><li id="ff16" class="js jt hi ih b ii kb im kc iq kd iu ke iy kf jc kx jy jz ka bi translated"><strong class="ih hj"> <em class="ki"> mprof rm: </em> </strong> <em class="ki"> </em>清除具体记录内存使用情况的文件。</li></ul><p id="d4db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你抓住了使用更多时间和空间的那部分代码，你就可以很容易地修改那部分代码来优化程序。</p><p id="acb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong>我们已经学会了监控程序的内存消耗和逐行分析。我们还学会了绘制内存消耗相对于时间的图表。</p></div></div>    
</body>
</html>