<html>
<head>
<title>How to create your own Question and Answering API(Flask+Docker +BERT) using haystack framework — Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用haystack框架创建自己的问答API(Flask+Docker+BERT)——第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-your-own-question-and-answering-api-flask-docker-bert-using-haystack-framework-7084208c2e7e?source=collection_archive---------13-----------------------#2021-01-18">https://medium.com/analytics-vidhya/how-to-create-your-own-question-and-answering-api-flask-docker-bert-using-haystack-framework-7084208c2e7e?source=collection_archive---------13-----------------------#2021-01-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/920afc2ea2854408018232e6c0e53b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XvVnjCdgiQ4ckjuDaS4_g.jpeg"/></div></div></figure><blockquote class="iq ir is"><p id="33c8" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="hi">作者注:</em> </strong></p><p id="fb44" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本文中，我们将学习如何使用python、flask和带有docker的<a class="ae js" href="https://github.com/deepset-ai/haystack" rel="noopener ugc nofollow" target="_blank"> haystack </a>框架创建自己的问答(QA) API。haystack框架将提供完整的QA特性，它是高度可扩展和可定制的。在本文中<a class="ae js" href="https://policy.medium.com/medium-rules-30e5502c4eb4" rel="noopener">中，规则</a>文本将被用作目标文档，并对模型进行微调。</p><p id="94fb" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> <em class="hi">所需基础知识:</em></strong><em class="hi">elastic search&amp;Docker</em></p><p id="7960" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这篇文章包含的工作代码，可以直接建立使用docker。</p></blockquote><p id="e99b" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">突出文章的内容</p><ol class=""><li id="3099" class="jw jx hi iw b ix iy jb jc jt jy ju jz jv ka jr kb kc kd ke bi translated">文档库设置—安装Elasticsearch</li><li id="9b30" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">API代码解释</li><li id="2bd6" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">在docker中构建Flask API</li><li id="e1f5" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">从API加载数据</li><li id="fb48" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">API的演示</li><li id="cc6e" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">微调模型</li><li id="54ff" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">代码调整(已培训/预培训)</li><li id="0545" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">总结结果</li></ol><h1 id="761a" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">6.微调模型</h1><p id="3a92" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">让我们尝试改进模型，按照我们的要求训练自己。对于任何特定领域的训练，我们必须训练自己，<a class="ae js" href="https://annotate.deepset.ai/index.html" rel="noopener ugc nofollow" target="_blank"> Haystack注释工具</a>将用于标记我们的数据。在本文中，我将使用来自haystack的注释工具的托管版本。</p><p id="662f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">对于本地版本，请点击此处。</p><p id="443a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><a class="ae js" href="https://github.com/deepset-ai/haystack/tree/master/annotation_tool" rel="noopener ugc nofollow" target="_blank">https://github . com/deepset-ai/haystack/tree/master/annotation _ tool</a></p><p id="f281" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">现在用你的个人邮箱id创建一个账户，上传txt文档。在下面的快照中注释您的问题和答案:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/73423bac12a0555626871077eb6d300c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eah7Is9Xl6H6nnoFSKqRhA.jpeg"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">使用Haystack注释工具进行文本注释</figcaption></figure><p id="9ca8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">现在将所有标签以小队格式导出为<strong class="iw hj"><em class="iv">" answers . JSON "</em></strong>，并使用以下命令将文件复制到docker容器中:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/8f02a1fcfef94a6a60c6bb1c34bc13b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xW78I30ydx0o4CFdC6mUdA.jpeg"/></div></div></figure><h2 id="3a30" class="lx kl hi bd km ly lz ma kq mb mc md ku jt me mf ky ju mg mh lc jv mi mj lg mk bi translated">代码解释util-trainer.py</h2><p id="b7ba" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">在收集了训练标签之后，这个python工具将帮助我们根据我们的需求来训练和微调模型。让我们用10个纪元进行训练。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="ba10" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">使用以下docker命令从docker容器执行:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/4def5d8d97da4196d0f97768898a5888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m2xU8RBq0ooNak-FrLxBQQ.jpeg"/></div></div></figure><p id="b1a7" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">要开始训练，运行命令"<strong class="iw hj"> python util-trainer.py " </strong></p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/6d96dc520da9b593e327d1ccaea3d42a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zHMclluC6sJ3_-NoV8Ewpg.jpeg"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">用10个纪元训练</figcaption></figure><p id="1f5b" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">训练结束时，模型将保存在<strong class="iw hj"> train_model </strong>目录<strong class="iw hj">中。现在训练已经成功完成。</strong></p><h1 id="a86f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">7.代码调整(训练和未训练)模型</h1><p id="5315" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">让我们修改代码，在同一个端点中订阅已训练和预训练的模型。我们将添加额外的参数“模式”来对模型进行分类。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="ml mm l"/></div></figure><p id="4303" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">将包含以下命令的代码发布到docker:</p><blockquote class="iq ir is"><p id="b879" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">docker copy main . py qna _ app:/usr/src/app/main . py</p></blockquote><p id="2d55" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">现在重启容器以反映API中的变化</p><blockquote class="iq ir is"><p id="e92e" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">docker重启qna_app</p></blockquote><p id="2a5f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">现在，API已经准备好订阅经过培训和预培训的模型。</p><h1 id="2db5" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">8.总结结果</h1><p id="aacb" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">现在让我们比较两个模型(训练的和预训练的)并分析最可能的答案。在快照中使用下面的API:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/38eec5f9c2b6fd814a07f718c1530aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HoOvWydVCTte5LqFgVfGIg.jpeg"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">训练和预训练模型比较</figcaption></figure><p id="a146" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">经过训练的模型给出了完美的结果，因为我们在训练数据中提供了标签。</p><p id="c890" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">我希望我们已经学会了通过微调模型来开发我们自己的QNA api。</p><blockquote class="iq ir is"><p id="3292" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://kohinoor-soubam.medium.com/how-to-create-your-question-and-answering-flask-api-using-haystack-e97205a240d1" rel="noopener">如何使用haystack框架创建自己的问答API(Flask+Docker+BERT)——第一部分</a></p></blockquote><p id="f715" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">完整的源代码可以在<a class="ae js" href="https://github.com/Kohimax/qna-api" rel="noopener ugc nofollow" target="_blank">这里</a>找到</p><h1 id="4331" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">参考</h1><ol class=""><li id="31b4" class="jw jx hi iw b ix li jb lj jt mq ju mr jv ms jr kb kc kd ke bi translated">【https://github.com/deepset-ai/haystack T4】</li><li id="3b78" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated"><a class="ae js" href="https://github.com/deepset-ai/haystack/tree/master/annotation_tool" rel="noopener ugc nofollow" target="_blank">https://github . com/deepset-ai/haystack/tree/master/annotation _ tool</a></li><li id="10ab" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated"><a class="ae js" href="https://github.com/deepset-ai/haystack/blob/master/tutorials/Tutorial2_Finetune_a_model_on_your_data.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/deepset-ai/haystack/blob/master/tutoria L2 _ fine tune _ a _ model _ on _ your _ data . ipynb</a></li></ol><h1 id="9165" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">如果这篇文章有帮助，请点击拍手👏按钮下面几下，以示支持！⬇⬇</h1></div></div>    
</body>
</html>