<html>
<head>
<title>Pandas: How to change value based on condition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫:如何根据条件改变价值</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pandas-how-to-change-value-based-on-condition-fc8ee38ba529?source=collection_archive---------0-----------------------#2021-10-17">https://medium.com/analytics-vidhya/pandas-how-to-change-value-based-on-condition-fc8ee38ba529?source=collection_archive---------0-----------------------#2021-10-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/56864f83f78c4976179eda89805e26a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-qvdZf8jroH0QdHg.jpg"/></div></div></figure><p id="78ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">DataFrame列中的值可以基于条件表达式进行更改。在本教程中，我们将介绍几种创建Pandas条件列的方法。</p><h1 id="610b" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">加载样本数据帧</strong></h1><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="3e92" class="kv jp hi kr b fi kw kx l ky kz">import pandas as pd</span><span id="fd7a" class="kv jp hi kr b fi la kx l ky kz">data = {'Stock': ['AAPL', 'IBM', 'MSFT', 'WMT'],<br/>       'Price': [144.8, 141.61, 304.21, 139.5],<br/>       'PE': [25, 21, 39, 16],  <br/>       'TradingExchange': ['NASDAQ', 'NYSE', 'NASDAQ', 'NYSE']}</span><span id="68bf" class="kv jp hi kr b fi la kx l ky kz">df = pd.DataFrame(data)</span><span id="e387" class="kv jp hi kr b fi la kx l ky kz">print(df)</span></pre><figure class="km kn ko kp fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/4ba1a40a57a4db55cef8593c3cf7b1e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*UdYK1oXgk8jgdV1E6Krufg.png"/></div></figure><h1 id="808c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">方法1:使用Pandas loc创建条件列</h1><p id="7712" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">Pandas的loc可以根据条件创建布尔掩码。它可以只是选择行和列，也可以用于过滤数据帧。</p><h2 id="b765" class="kv jp hi bd jq lh li lj ju lk ll lm jy jb ln lo kc jf lp lq kg jj lr ls kk lt bi translated">句法</h2><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="4596" class="kv jp hi kr b fi kw kx l ky kz">example_df.loc[example_df["column_name1"] condition, "column_name2"] = value</span></pre><ul class=""><li id="7d31" class="lu lv hi is b it iu ix iy jb lw jf lx jj ly jn lz ma mb mc bi translated">column_name1是要计算的列；</li><li id="0499" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">column_name2是要创建或更改的列，它可以与column_name1相同</li><li id="97b8" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">condition是要应用的条件表达式</li><li id="634f" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi translated">value是要分配的新值</li></ul><p id="dab1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过将字符串“低于150”分配给任何价格低于140美元的股票，将“高于150”分配给任何价格高于150美元的股票来尝试一下。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="7193" class="kv jp hi kr b fi kw kx l ky kz">df["Prcie_Category"] = "Over 150"<br/>df.loc[df["Price"] &lt; 150, "Price_Category"] = "Under 150"</span></pre><p id="addc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们是这样做的:</p><ol class=""><li id="2462" class="lu lv hi is b it iu ix iy jb lw jf lx jj ly jn mi ma mb mc bi translated">我们创建一个新的列“<em class="mj">价格类别</em>，并为数据帧中的每条记录分配“超过150”。</li><li id="2115" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn mi ma mb mc bi translated">然后，我们使用。loc在“<em class="mj">价格</em>”列上创建一个布尔掩码，以过滤价格低于150的行。当“<em class="mj">价格</em>”列值满足条件时，<em class="mj">价格_类别</em>”被赋予新值“低于150”。</li></ol><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/7663854e1b57345ebaf20b3f13a95321.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75O4WXKV9Az-Kbk7vieJuA.png"/></div></div></figure><h1 id="c6ee" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">方法2:使用Numpy.where</h1><h2 id="ef19" class="kv jp hi bd jq lh li lj ju lk ll lm jy jb ln lo kc jf lp lq kg jj lr ls kk lt bi translated">句法</h2><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="d7a0" class="kv jp hi kr b fi kw kx l ky kz">import numpy as np</span><span id="8ea4" class="kv jp hi kr b fi la kx l ky kz">example_df["column_name1"] = np.where(condition, new_value, “column_name2”) </span></pre><p id="c7dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们仍然创建“价格_类别”列，并将值指定为“低于150”或“高于150”。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="f395" class="kv jp hi kr b fi kw kx l ky kz">df["Prcie_Category"] = "Over 150"<br/>df['Price_Category'] = np.where(df["Price"] &lt; 150, "Under 150", df['Price_Category'])</span></pre><p id="9838" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们会得到同样的结果。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/3e3f8760a77a222c80cda9e3a8430c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8qFSYPhCpEogfKnjykIWmg.png"/></div></div></figure><p id="2b28" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是如果我们有多个条件呢？我们仍然可以使用<strong class="is hj">。loc </strong>多次，但是会很难理解，写起来也不愉快。</p><h1 id="09e4" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">方法3:使用Numpy。选择使用多个条件设置值</h1><p id="bbc4" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">现在，我们想应用一些不同的PE(市盈率)组:</p><ul class=""><li id="6351" class="lu lv hi is b it iu ix iy jb lw jf lx jj ly jn lz ma mb mc bi">&lt; 20</li><li id="3f75" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi">20–30</li><li id="a8b6" class="lu lv hi is b it md ix me jb mf jf mg jj mh jn lz ma mb mc bi">&gt; 30</li></ul><p id="23be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现这一点，我们可以创建一个条件列表</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="a6dc" class="kv jp hi kr b fi kw kx l ky kz">PE_Conditions = [<br/>    (df['PE'] &lt; 20),<br/>    (df['PE'] &gt;= 20) &amp; (df['PE'] &lt; 30),<br/>    (df['PE'] &gt;= 30)<br/>]</span><span id="9c6a" class="kv jp hi kr b fi la kx l ky kz">PE_Categories = ['Less than 20', '20-30', '30+']</span><span id="2de7" class="kv jp hi kr b fi la kx l ky kz">df['PE_Category'] = np.select(PE_Conditions, PE_Categories)</span><span id="f808" class="kv jp hi kr b fi la kx l ky kz">print(df)</span></pre><p id="c6fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将得到以下结果:</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mm"><img src="../Images/8ee4fb9c79d69d931a5ebbc8514ebc36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRy9Uu7xyvdcKmLbwQSDCw.png"/></div></div></figure><h1 id="7095" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="423a" class="pw-post-body-paragraph iq ir hi is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">在本文中，我们学习了创建熊猫条件列的三种方法。要了解更多关于熊猫的运作，你也可以查阅官方文件。</p><p id="d260" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae mn" href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" rel="noopener ugc nofollow" target="_blank">名词短语</a></p><p id="09fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae mn" href="https://numpy.org/doc/stable/reference/generated/numpy.select.html" rel="noopener ugc nofollow" target="_blank"> np.select </a></p><p id="cd02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae mn" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html" rel="noopener ugc nofollow" target="_blank"> pd.loc </a></p></div></div>    
</body>
</html>