<html>
<head>
<title>Scraping Reddit data using Reddit API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Reddit API抓取Reddit数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-reddit-data-using-reddit-api-3eba4bd7a56a?source=collection_archive---------3-----------------------#2021-07-18">https://medium.com/analytics-vidhya/scraping-reddit-data-using-reddit-api-3eba4bd7a56a?source=collection_archive---------3-----------------------#2021-07-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="aa9e" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在本文中，我们将从石溪大学子网站收集<strong class="ak">热门帖子</strong> &amp; <strong class="ak">新帖</strong>。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/db8a0d01f9ce949ceedf269ddba8d85f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bUAyU-VmtfoqmtbRtihWTQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">大声喊出来<a class="ae jn" href="https://unsplash.com/@brett_jordan" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a></figcaption></figure><p id="513c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">首先，</strong></p><ul class=""><li id="75f2" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">参观https://www.reddit.com/prefs/apps<a class="ae jn" href="https://www.reddit.com/prefs/apps" rel="noopener ugc nofollow" target="_blank"/></li><li id="169b" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">滚动到按钮并点击:<strong class="jq hj">创建应用</strong>按钮</li><li id="8468" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">接下来，根据您的需要填写任何所需的名称和描述，然后单击'<strong class="jq hj">创建应用'</strong></li><li id="0c7e" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">获取“密钥”和“个人使用脚本”信息。</li><li id="7957" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">然后，我们继续下面的python代码。</li></ul><p id="51a7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">秘密= 12345。个人使用脚本= 'abcde '</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="3eb1" class="ld le hi kz b fi lf lg l lh li">secret_key = '12345'<br/>client_id = 'abcde'</span><span id="c4ed" class="ld le hi kz b fi lj lg l lh li"># pip install requests<br/>import requests</span></pre><p id="cd74" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">使用客户端id和密钥获得授权</strong></p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="7f3a" class="ld le hi kz b fi lf lg l lh li">auth = requests.auth.HTTPBasicAuth(client_id,secret_key)</span></pre><p id="925e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，我们需要登录，以便获取信息。初始化字典以存储登录信息，指定我们将使用用户名和密码登录。</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="6434" class="ld le hi kz b fi lf lg l lh li">login_data = {<br/>    'grant_type' : 'password',<br/>    'username' : 'XYZ',<br/>    'password' : 'MNO'<br/>}</span></pre><p id="c868" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">接下来，我们需要确定API的版本</strong></p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="d929" class="ld le hi kz b fi lf lg l lh li">headers = {'User-Agent': 'MyAPI/0.0.1'}</span></pre><p id="91dd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这里，我们可以发送一个对OAuth令牌的请求，当使用API时，我们将在我们的头中使用它</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="dd8b" class="ld le hi kz b fi lf lg l lh li">response = requests.post('https://www.reddit.com/api/v1/access_token',auth=auth,data=login_data, headers=headers)<br/>response.json()</span><span id="4325" class="ld le hi kz b fi lj lg l lh li">token = response.json()['access_token']</span><span id="14dc" class="ld le hi kz b fi lj lg l lh li">headers = {**headers, **{'Authorization': f'bearer {token}'}}<br/>headers</span></pre><h2 id="574d" class="ld le hi bd lk ll lm ln lo lp lq lr ls jx lt lu lv kb lw lx ly kf lz ma mb mc bi translated">最后，有了这个，我们可以访问Reddit API中的每个端点。</h2><p id="8134" class="pw-post-body-paragraph jo jp hi jq b jr md ij jt ju me im jw jx mf jz ka kb mg kd ke kf mh kh ki kj hb bi translated">让我们分别从SBU subreddit查看热门帖子和新帖子，并收集50个帖子信息</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="ae4d" class="ld le hi kz b fi lf lg l lh li">res_hot = requests.get('https://oauth.reddit.com/r/SBU/hot',headers=headers,params={'limit':'50'})<br/>res_new = res = requests.get('https://oauth.reddit.com/r/SBU/new',headers=headers,params={'limit':'50'})</span></pre><p id="02c9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">用这个来看看这些讨厌的数据，因为文章长度的原因，我没有展示结果</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="2412" class="ld le hi kz b fi lf lg l lh li">res_hot.json()</span><span id="4640" class="ld le hi kz b fi lj lg l lh li"># Moving on to the next procedure...</span><span id="7cff" class="ld le hi kz b fi lj lg l lh li"># pip install pandas<br/>import pandas as pd<br/>from datetime import datetime</span><span id="74a4" class="ld le hi kz b fi lj lg l lh li">post = res_hot.json()['data']['children'][0]<br/>[i for i in post['data'].keys()]</span><span id="85be" class="ld le hi kz b fi lj lg l lh li"># Following is the items we can access:</span><span id="6f45" class="ld le hi kz b fi lj lg l lh li">['approved_at_utc',<br/> 'subreddit',<br/> 'selftext',<br/> 'author_fullname',<br/> 'saved',</span><span id="ce3b" class="ld le hi kz b fi lj lg l lh li">   .<br/>   .<br/>   .</span><span id="57ad" class="ld le hi kz b fi lj lg l lh li"> 'subreddit_subscribers',<br/> 'created_utc',<br/> 'num_crossposts',<br/> 'media',<br/> 'is_video']</span></pre><h1 id="f4e4" class="mi le hi bd lk mj mk ml lo mm mn mo ls io mp ip lv ir mq is ly iu mr iv mb ms bi translated">检查此子编辑中的新帖子</h1><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="1144" class="ld le hi kz b fi lf lg l lh li">df_hot_posts = pd.DataFrame()<br/>for post in res_hot.json()['data']['children']:<br/>    df_hot_posts = df_hot_posts.append(<br/>                           {'subreddit' : post['data']['subreddit'],<br/>                 'author_fullname': post['data']['author_fullname'],<br/>   'created at': datetime.utcfromtimestamp(post['data']['created']),<br/>                                     'title': post['data']['title'],<br/>                               'selftext': post['data']['selftext'],<br/>                       'upvote_ratio': post['data']['upvote_ratio'],<br/>                      'Post ID':post['kind']+'_'+post['data']['id']<br/>                            }, ignore_index=True)</span></pre><p id="bda9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">用这个检查所有的标题</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="8ed0" class="ld le hi kz b fi lf lg l lh li">[[i] for i in df_hot_posts['title']]</span><span id="2cc5" class="ld le hi kz b fi lj lg l lh li"># next..</span><span id="66e4" class="ld le hi kz b fi lj lg l lh li">df_hot_posts.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl mt"><img src="../Images/8c5661d995fd8da69e556a55a70c4eef.png" data-original-src="https://miro.medium.com/v2/format:webp/1*-ZJ1R7MYNvdwETP79n820A.png"/></div></figure><h1 id="4e80" class="mi le hi bd lk mj mk ml lo mm mn mo ls io mp ip lv ir mq is ly iu mr iv mb ms bi translated">检查此子编辑中的新帖子</h1><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="3914" class="ld le hi kz b fi lf lg l lh li">df_new_posts = pd.DataFrame()<br/>for post in res_new.json()['data']['children']:<br/>    df_new_posts = df_new_posts.append(<br/>                           {'subreddit' : post['data']['subreddit'],<br/>                 'author_fullname': post['data']['author_fullname'],<br/>   'created at': datetime.utcfromtimestamp(post['data']['created']),<br/>                                     'title': post['data']['title'],<br/>                               'selftext': post['data']['selftext'],<br/>                       'upvote_ratio': post['data']['upvote_ratio'],<br/>                      'Post ID':post['kind']+'_'+post['data']['id']<br/>                            }, ignore_index=True)</span><span id="96ad" class="ld le hi kz b fi lj lg l lh li">df_new_posts.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl mt"><img src="../Images/e6e0bff6be599784558b4056e8bcd7b1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*db0yCXY79flv0Std8ENYTA.png"/></div></figure><p id="41b5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">看看所有的标题</p><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="e2d4" class="ld le hi kz b fi lf lg l lh li">[ [i] for i in df_new_posts['title']]</span></pre><h1 id="2b4b" class="mi le hi bd lk mj mk ml lo mm mn mo ls io mp ip lv ir mq is ly iu mr iv mb ms bi translated">以CSV格式存储数据</h1><pre class="iy iz ja jb fd ky kz la lb aw lc bi"><span id="5b33" class="ld le hi kz b fi lf lg l lh li">pwd()</span><span id="6f39" class="ld le hi kz b fi lj lg l lh li">'/Users/nilsonchapagain/Desktop/Blogs'</span><span id="4eff" class="ld le hi kz b fi lj lg l lh li">df_hot_posts.to_csv('/Users/nilsonchapagain/Desktop/Blogs/data/sbu_hot_post.csv', index=False)</span><span id="a8ed" class="ld le hi kz b fi lj lg l lh li">df_new_posts.to_csv('/Users/nilsonchapagain/Desktop/Blogs/data/sbu_new_post.csv', index=False)</span></pre><h2 id="c67f" class="ld le hi bd lk ll lm ln lo lp lq lr ls jx lt lu lv kb lw lx ly kf lz ma mb mc bi translated">谢谢你看我的帖子。我希望你学到了一些东西*🙌 🎉</h2></div></div>    
</body>
</html>