<html>
<head>
<title>Personal Notification Hub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">个人通知中心</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/personal-notification-hub-97eb1ee48fb3?source=collection_archive---------25-----------------------#2021-04-12">https://medium.com/analytics-vidhya/personal-notification-hub-97eb1ee48fb3?source=collection_archive---------25-----------------------#2021-04-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="63bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">很久以前，我的一个朋友让我验证一下这个很酷的想法，它只是一个小小的显示设备，“<em class="jd">让你随时了解对你来说重要的事情</em>”。不知何故，这个想法没能筹集到资金，最终不了了之。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/9f779c020c51393eceb3ab5b43ed4dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*5JgDPA2pALsXf_TWWBaiMw.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">仅供参考。无意制造精确的装置。这幅图像完全是https://smart-stickers.com/的<a class="ae jc" href="http://smart-stickers.com/" rel="noopener ugc nofollow" target="_blank">的一部分。红色部分是我们试图通过这篇文章达到的目的</a></figcaption></figure></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><h1 id="0b02" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">这个想法</h1><p id="a377" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated">虽然我不可能为这样的想法创造硬件(如果你有那样的技术水平，请随时联系我)，但我试图实现这个想法的软件部分。我试图创建的是一个集中的中心，为我提供不同社交平台(WhatsApp、Skype、脸书、Youtube)上的<em class="jd">未读通知</em> <em class="jd">计数</em>。该中心将只提供未读通知计数，而不是未读邮件，因为这个想法只是有一个事情的简明摘要，而不是详细的视图。你不必打开手机来检查你是否错过了一条信息。如果你注意到一个计数，你总是有移动电话去查看消息。</p></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><h1 id="3fc9" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">市场上当前可用的选项</h1><p id="fef4" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated">当我尝试谷歌搜索时，我没有遇到任何服务于此目的的工具或应用程序。这给了我创建这个工具的另一个原因。我想到的第一个想法是，我将点击web服务，比如说脸书，并获得一个通知计数。类似地，我会点击WhatsApp的web服务并获得我的计数。不幸的是，这些平台没有这样的服务(脸书曾经有一个，但现在停止了)。Slack非常擅长为自己提供这种有用的网络服务，我认为其他社交平台应该认真考虑这一点。此外，要很好地理解每个社交媒体平台提供的网络服务，并加上它们可能是付费的或对点击量/日有一些限制，这可能是一项非常乏味的任务。</p></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><h1 id="cba5" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">履行</h1><p id="23ef" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated">当什么都没用的时候，你总是可以选择<em class="jd">网页抓取</em>。是的，读了scraping这个词，你们中的大多数人应该已经知道这篇文章接下来要讲什么了。是的，我们将使用Selenium Python框架，为每个社交媒体平台开放并行浏览器实例，并进行搜集。为了增加这个工具，我们将创建一个基于Flask的微服务，这样你点击该服务，它将返回每个社交媒体平台的未读通知的计数。我个人已经在Windows系统上完成了实现，但是如果在Linux或Raspberry系统上也可以尝试一下(它们可能不支持head模式下的自动化工具)。</p><ol class=""><li id="55ac" class="la lb hh ig b ih ii il im ip lc it ld ix le jb lf lg lh li bi translated">首先，你需要可以从<a class="ae jc" href="https://chromedriver.chromium.org/downloads" rel="noopener ugc nofollow" target="_blank">这里</a>下载的Chromedriver for Windows。任何版本都可以。</li><li id="7674" class="la lb hh ig b ih lj il lk ip ll it lm ix ln jb lf lg lh li bi translated">导入必要的包:用于抓取目的的selenium，用于为每个社交媒体平台创建并行线程的threading，以及用于创建最终微服务的flask。</li></ol><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="8a32" class="lt jy hh lp b fi lu lv l lw lx">from selenium import webdriver<br/>import time<br/>import threading<br/>from flask import Flask, request, jsonify, make_response</span></pre><p id="d066" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.为每个社交媒体平台创建驱动程序实例</p><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="6185" class="lt jy hh lp b fi lu lv l lw lx">fbDriver = webdriver.Chrome("chromedriver")<br/>fbDriver.get("https://www.facebook.com/")<br/>waDriver = webdriver.Chrome("chromedriver")<br/>waDriver.get("https://web.whatsapp.com/")<br/>ytDriver = webdriver.Chrome("chromedriver")<br/>ytDriver.get("https://www.youtube.com/")</span></pre><p id="d244" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.定义保存每个(社交媒体)平台计数的全局变量。为什么是全球？以便scraping(变量的设置者)和Flask-microservice(最终用户的变量获取者)使用相同的变量，并且在值上没有差异。</p><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="beac" class="lt jy hh lp b fi lu lv l lw lx">fbNotifications=0   #for facebook related notification<br/>msgNotifications=0  #for messenger related notification<br/>waNotifications=0   #for whatsapp related notification<br/>ytNotifications=0   # for youtube related notiifcation</span></pre><p id="da1f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.为每一个社交媒体平台创建一个处理函数，真正的抓取工作就发生在这个平台上。更新函数内部的全局变量。这是一个脸书刮函数的例子</p><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="b53c" class="lt jy hh lp b fi lu lv l lw lx">def fbCountManager():<br/>    global fbNotifications<br/>    global msgNotifications<br/>    while True:<br/>        try:<br/>            fbNotifications=fbDriver.find_element_by_id('notificationsCountValue')<br/>            msgNotifications=fbDriver.find_element_by_id('mercurymessagesCountValue')<br/>        except:<br/>            fbNotifications=0<br/>            msgNotifications=0<br/><br/>        fbDriver.refresh()<br/>        time.sleep(20)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es ly"><img src="../Images/bca5ef1e4af68597cbbecdd2755d6586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUJBzD9HcVSOFkJEjYSqag.png"/></div></div></figure><p id="12c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们想要的是UI中这两个标记的值(第一个标记给出messenger的通知计数，第二个标记给出脸书通知计数)。我不会讨论我是如何识别元素id的，但是您可以通过Selenium语法和教程来查看更多相关信息。</p><p id="1925" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是whatsapp的一个类似功能</p><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="f561" class="lt jy hh lp b fi lu lv l lw lx">def waCountManager():<br/>    global waNotifications<br/>    while True:<br/>        try:<br/>            waNotifications=0<br/>            allMsgs=waDriver.find_elements_by_css_selector('.OUeyt')<br/>            <br/>            for msg in allMsgs: <br/>                waNotifications=waNotifications+int(msg.text) <br/>                <br/>        except:<br/>            <br/>            waNotifications=0<br/><br/>        waDriver.refresh()<br/>        time.sleep(20)</span></pre><blockquote class="md me mf"><p id="d563" class="ie if jd ig b ih ii ij ik il im in io mg iq ir is mh iu iv iw mi iy iz ja jb ha bi translated">请注意，出于安全考虑，我们不会在python代码中存储任何平台的任何凭证。因此，您必须一次手动登录到每个平台。虽然这个登录过程也可以通过Selenium实现自动化，但是我建议不要在普通的脚本文件中泄露您的凭证。</p></blockquote><p id="568b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.你同样可以为每个社交媒体平台创建抓取功能。接下来，您必须为每个平台创建并启动并行线程。这是你如何做它。目标参数接受这个线程应该调用的函数。</p><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="953a" class="lt jy hh lp b fi lu lv l lw lx">fbThread = threading.Thread(target=fbCountManager)<br/>fbThread.start()<br/><br/>waThread = threading.Thread(target=waCountManager)<br/>waThread.start()<br/><br/>ytThread = threading.Thread(target=ytCountManager)<br/>ytThread.start()</span></pre><p id="a76c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">7.最后一部分是创建一个基于<a class="ae jc" href="https://flask.palletsprojects.com/" rel="noopener ugc nofollow" target="_blank"> Flask </a>的微服务，以便最终用户(也就是你)点击服务并获得包含每个社交媒体平台计数的累积响应。我非常喜欢微服务的概念(用户并不关心数据是如何获取的，他只是点击服务并获得结果。他是快乐的)</p><pre class="jf jg jh ji fd lo lp lq lr aw ls bi"><span id="b76b" class="lt jy hh lp b fi lu lv l lw lx">app=Flask(__name__)<br/><br/>@app.route('/getcounts/', methods=['GET'])<br/>def respond():<br/>    response_body = {<br/>            "fbNotifications":fbNotifications,<br/>            "msgNotifications": msgNotifications,<br/>            "waNotifications": waNotifications,<br/>            "ytNotifications": ytNotifications<br/>        }<br/><br/>    res = make_response(jsonify(response_body), 200)<br/>    return res<br/><br/><br/>@app.route('/')<br/>def index():<br/>    getCoronaCounts()<br/>    return '&lt;h1&gt;Notiifcation App&lt;/h1&gt;'<br/><br/>if __name__ == '__main__':<br/>    # Threaded option to enable multiple instances for multiple user access support<br/>    app.run(threaded=True, port=5000)</span></pre><p id="3193" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意我们是如何使用之前定义的全局变量的。我知道我可以在这里做得更好，增加一些安全性或一些更花哨的功能。但目标是创造一个快速的解决方案。但是现在你意识到了这个想法，你总是有改进的余地。</p><p id="9cb1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">8.一切就绪，让我们试着测试这个微服务返回的响应是什么。该服务运行在我们在最后一行中定义的端口5000上。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mj"><img src="../Images/cf8cf1f94ac36988d49fac9f62128c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*9bn1LKROCpRNREM1aYJX3A.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">基于烧瓶的终点的响应</figcaption></figure></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><h1 id="199c" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">下一步怎么样</h1><p id="d23b" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated">如果您已经完成了实用程序或hub的创建，您有以下使用该实用程序的想法(这些我都没有亲自做过，所以如果您能与我分享，我会很高兴)</p><ol class=""><li id="9627" class="la lb hh ig b ih ii il im ip lc it ld ix le jb lf lg lh li bi translated">试着在Raspberry Pi上部署它，这样你就不用整天依赖你的个人笔记本电脑来运行它了。</li><li id="c0a6" class="la lb hh ig b ih lj il lk ip ll it lm ix ln jb lf lg lh li bi translated">使用<a class="ae jc" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>将通知计数服务创建为public，这样您就可以在家庭网络之外访问计数。</li><li id="69e2" class="la lb hh ig b ih lj il lk ip ll it lm ix ln jb lf lg lh li bi translated">在智能镜子或背景墙显示器中使用它。</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es mk"><img src="../Images/aa21bacc6be834a5d8dbf40437931990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hF8_c3abkb1XlyKKo4kLBA.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">图片来自DIYPerks。查看如何创建<a class="ae jc" href="https://www.youtube.com/watch?v=puFSdfIRNIw" rel="noopener ugc nofollow" target="_blank">智能镜子</a></figcaption></figure></div><div class="ab cl jq jr go js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="ha hb hc hd he"><h1 id="5751" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">使用条款</h1><p id="84ce" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated">我想清楚地提到，这个工具或集线器只是供您个人使用。正如你已经清楚地看到，没有增加或额外的安全存在，<strong class="ig hi">所以非常小心地使用它</strong>。此外，请参考您正在抓取的网站的使用条款，在某些网站上执行任何类型的抓取都是不合法的。</p></div></div>    
</body>
</html>