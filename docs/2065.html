<html>
<head>
<title>Flask Web Development Part 6: CRUD App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flask Web开发第6部分:CRUD应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/flask-development-part-6-crud-app-d3413cd94363?source=collection_archive---------16-----------------------#2021-04-03">https://medium.com/analytics-vidhya/flask-development-part-6-crud-app-d3413cd94363?source=collection_archive---------16-----------------------#2021-04-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3cb1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让您的应用程序能够创建、读取、更新和删除数据库对象。</p><p id="705a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一系列文章的第6部分，通过开发和托管一个简单的CRUD应用程序，带你了解Flask Web开发的基础。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/0fdde0c5543c9946ee7ddef5cbbc1389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWK6yDaBe7x5viez2VyeMw.jpeg"/></div></div></figure><h1 id="d4f6" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">该系列分为6个部分:</h1><ol class=""><li id="aeb8" class="km kn hh ig b ih ko il kp ip kq it kr ix ks jb kt ku kv kw bi translated"><a class="ae kx" href="https://medium.com/p/69cbf9e83abc/edit" rel="noopener">一个简单的Hello World应用</a></li><li id="d74f" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated"><a class="ae kx" href="https://medium.com/p/d10442121fdd/edit" rel="noopener">渲染HTML模板。</a></li><li id="1d06" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated"><a class="ae kx" href="https://medium.com/p/68e3bf2f6642/edit" rel="noopener">构建可扩展的文件结构。</a></li><li id="58e7" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated"><a class="ae kx" href="https://medium.com/p/648b11f708a5/edit" rel="noopener">配置数据库。</a></li><li id="5302" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated"><a class="ae kx" href="https://medium.com/p/a79042c9368c/edit" rel="noopener">处理用户登录和注册。</a></li><li id="c1dd" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated"><a class="ae kx" href="https://medium.com/p/d3413cd94363/edit" rel="noopener"> <strong class="ig hi">增加CRUD(创建、读取、更新、删除)功能。</strong>T15】</a></li></ol><p id="ab1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从技术上讲，通过在数据库中创建用户，我们已经克服了创建和读取部分。但是我们将更进一步，创建一个新的数据库对象，允许用户创建、读取、更新和删除该对象的实例。此外，我们将使每个用户在登录时只能看到自己的对象。</p><h2 id="ebb8" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">步骤1:创建新的数据库对象</h2><p id="faa2" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">为了简单起见，我们把它记下来。为此，我们将在config.py文件中添加以下代码。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="5af5" class="ld jp hh lv b fi lz ma l mb mc">class Note(db.Model):</span><span id="300e" class="ld jp hh lv b fi md ma l mb mc">    id = db.Column(db.Integer, primary_key = True)<br/>    note = db.Column(db.String(800), nullable = False)</span></pre><p id="86d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还可以添加一些其他字段类型进行练习。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="13a8" class="ld jp hh lv b fi lz ma l mb mc">class Note(db.Model):</span><span id="8c9d" class="ld jp hh lv b fi md ma l mb mc">    id = db.Column(db.Integer, primary_key = True)<br/>    username = db.Column(db.String(20), nullable = False)<br/>    note = db.Column(db.String(800), nullable = False)<br/>    <strong class="lv hi">boolean = db.Column(db.Boolean, default = False)<br/>    float = db.Column(db.Float, nullable = False)<br/>    date = db.Column(db.Date, nullable = False)</strong></span></pre><p id="6aea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以看到，我们的字符串字段的创建方式与我们在用户对象中创建它们的方式相同。我们的3个新字段是不同的类型:布尔型、浮点型和日期型。有关SQL alchemy可用的所有字段类型的更多信息，请查看这里的文档<a class="ae kx" href="https://docs.sqlalchemy.org/en/13/core/type_basics.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="01b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们的config.py文件中有了一个新的数据库对象。但是还记得我们在第4部分中如何用终端命令构建数据库吗？因为我们是在创建这个对象之前做的，所以它不在我们的site.db文件中。</p><p id="8876" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有一种快速而简单的方法来更新我们的数据库以包含这个文件。</p><p id="f383" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们将打开终端，以与第4部分相同的方式访问config.py文件。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="49f9" class="ld jp hh lv b fi lz ma l mb mc">cd Desktop/FlaskApp/backend</span><span id="bfa7" class="ld jp hh lv b fi md ma l mb mc">python</span><span id="08fd" class="ld jp hh lv b fi md ma l mb mc">from config import db</span></pre><p id="55b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在使用create_all()之前，我们将清空整个数据库。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="f4af" class="ld jp hh lv b fi lz ma l mb mc">db.drop_all()</span></pre><p id="78f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们可以继续重建它。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="6141" class="ld jp hh lv b fi lz ma l mb mc">db.create_all()</span></pre><p id="cd87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在用一个新的数据库从头开始。我们之前创建的任何用户现在都不存在了，但是注释对象现在存在了。</p><h2 id="952d" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">步骤2:为创建新对象创建一个烧瓶形状</h2><p id="48b7" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">首先，我们将在forms.py文件中导入一些新的字段类型。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="d64b" class="ld jp hh lv b fi lz ma l mb mc">from flask_wtf import FlaskForm<br/>from wtforms import StringField, PasswordField, SubmitField, BooleanField<strong class="lv hi">, TextAreaField, FloatField, DateField</strong><br/>from wtforms.validators import DataRequired, Length, Email, EqualTo</span></pre><p id="0625" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您没有安装datetime，可以通过在终端中运行以下命令来安装它。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="84b5" class="ld jp hh lv b fi lz ma l mb mc">pip install datetime</span></pre><p id="7b01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们将从datetime导入date方法。我们将使用它来设置日期字段的默认值。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="d207" class="ld jp hh lv b fi lz ma l mb mc">from flask_wtf import FlaskForm<br/>from wtforms import StringField, PasswordField, SubmitField, BooleanField, TextAreaField, FloatField, DateField<br/>from wtforms.validators import DataRequired, Length, Email, EqualTo<br/><strong class="lv hi">from datetime import date</strong></span></pre><p id="c44f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们将创建一个新的烧瓶窗体类。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="314c" class="ld jp hh lv b fi lz ma l mb mc">class NoteForm(FlaskForm):<br/>    note = TextAreaField('Note', <br/>                         validators = [DataRequired(),         <br/>                         Length(min=1, max=800)])<br/>    boolean = BooleanField('Boolean Field',<br/>                           default="checked")<br/>    float = FloatField('Float', <br/>                       validators = [DataRequired()])<br/>    date = DateField('Date',<br/>                      default=date.today, <br/>                      validators = [DataRequired()])<br/>    submit = SubmitField('Submit')</span></pre><p id="a2f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个表单是使用我们在第5部分中创建登录和注册表单时使用的语法创建的。这里需要注意的唯一重要的事情是，对于布尔型和日期型字段，我们还设置了默认值。布尔字段被设置为“checked ”,这意味着复选框将自动呈现为True值，并且该框在视觉上被选中。我们的date字段默认设置为date.today，它使用从datetime导入的date方法来获取当天的日期。</p><p id="934b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们将把新表单传递给index.py文件中的render_template函数。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="3f05" class="ld jp hh lv b fi lz ma l mb mc">return render_template('index.html',<br/>                       notes = notes,<br/>                       login_form = forms.LoginForm(),<br/>                       register_form = forms.RegistrationForm(),<br/>                       <strong class="lv hi">note_form = forms.NoteForm()</strong>)</span></pre><p id="5de8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这与我们的其他表格一样。我们现在可以在HTML文件中引用这个表单作为note_form。</p><h2 id="3e9d" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">步骤3:将我们的新表单添加到前端</h2><p id="79a3" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">我们将把这个新的表单放到我们的模板&gt;视图&gt; authenticated.html文件中。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="dc80" class="ld jp hh lv b fi lz ma l mb mc">&lt;form method="POST" action=""&gt;<br/>  {{ note_form.hidden_tag() }}<br/>    {{ note_form.note(placeholder = "Note") }}<br/>    {{ note_form.boolean() }}<br/>    {{ note_form.float(placeholder = "Float") }}<br/>    {{ note_form.date() }}<br/>    {{ note_form.submit() }}<br/>&lt;/form&gt;</span></pre><p id="2f13" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就像我们制作的其他表单一样，我们使用在flask form类中定义的每个字段。还要注意，我们使用占位符参数来定义在注释和浮动字段的输入字段中显示什么。我们不需要为布尔和日期字段这样做，因为我们已经在表单类中定义了默认值。</p><p id="8691" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们经过验证的视图应该如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/2492013664c6e7b20a06c8e07c80eb91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RKDUO6G9Jt25S6r0ByXGZg.png"/></div></div></figure><h2 id="f4bc" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">步骤4:配置我们的后端来处理新表单的提交和验证</h2><p id="5c1d" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">首先，我们将创建另一个“if”语句，就像我们对登录和注册表单所做的那样。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="a333" class="ld jp hh lv b fi lz ma l mb mc">if forms.NoteForm().validate_on_submit():</span><span id="cd7c" class="ld jp hh lv b fi md ma l mb mc">    return redirect(url_for('hello_world'))</span></pre><p id="31ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就像我们的其他表单提交一样，if语句检查post请求是否是正在提交的note表单，并且还根据表单类中的验证器检查表单中的数据是否有效。</p><p id="df6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将添加一些代码，从表单中获取信息，并用它创建一个note类的实例。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="095e" class="ld jp hh lv b fi lz ma l mb mc">if forms.NoteForm().validate_on_submit():</span><span id="c5fb" class="ld jp hh lv b fi md ma l mb mc"><strong class="lv hi">    note_form = forms.NoteForm()<br/>    note = Note(username = current_user.username,<br/>                note = note_form.note.data,<br/>                boolean = note_form.boolean.data,<br/>                float = note_form.float.data,<br/>                date = note_form.date.data)<br/>    db.session.add(note)<br/>    db.session.commit()</strong></span><span id="dfec" class="ld jp hh lv b fi md ma l mb mc">return redirect(url_for('hello_world'))</span></pre><p id="8b0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里的四行是:</p><ol class=""><li id="dc0f" class="km kn hh ig b ih ii il im ip mf it mg ix mh jb kt ku kv kw bi translated">从我们的表单文件中获取注释表单。</li><li id="b848" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">使用提交的表单中的数据创建我们的note对象的实例。(请注意，用户名是使用current_user.username添加的，它是我们之前配置的登录管理器的一部分)</li><li id="7774" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">将注释添加到数据库</li><li id="ee46" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">提交数据库更改。</li></ol><p id="4866" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，当我们添加新的笔记时，它们将出现在我们的认证视图中。</p><h2 id="02a1" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">第五步:读取并显示当前用户的笔记。</h2><p id="7997" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">现在我们可以使用我们的表单来创建新的笔记。但是我们看不见它们。让我们添加一些阅读功能，并向用户显示他们自己的笔记。</p><p id="eee7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们需要将新的数据库类导入到index.py文件中，就像我们导入User类一样。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="1437" class="ld jp hh lv b fi lz ma l mb mc">from config import app, db, bcrypt, User<strong class="lv hi">, Note</strong><br/>from flask import Flask, render_template, request, redirect, url_for<br/>from flask_login import login_user, current_user, logout_user, login_required<br/>import forms</span></pre><p id="4b0a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将查询数据库以获取属于当前用户的所有实例。为此，我们将在index.py文件中添加以下代码。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="a7e4" class="ld jp hh lv b fi lz ma l mb mc">if current_user.is_authenticated:<br/>    notes = Note.query.filter_by(user = current_user.username).all()<br/>else:<br/>    notes = []</span></pre><p id="252e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这段代码获取用户名与当前用户的用户名匹配的所有笔记。包含if逻辑是因为未经身份验证的用户没有用户名。</p><p id="0b92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们需要将结果传递给render_template函数。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="3df3" class="ld jp hh lv b fi lz ma l mb mc">return render_template('index.html',<br/>                        <strong class="lv hi">notes = notes,</strong><br/>                        login_form = forms.LoginForm(),<br/>                        register_form = forms.RegistrationForm(),<br/>                        csrf_form = forms.csrf_form())</span></pre><p id="07ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在我们的认证视图中，我们将循环浏览这些笔记，并在浏览器中显示它们。我们将通过在模板&gt;视图&gt; authenticated.html中添加以下代码来实现</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="794c" class="ld jp hh lv b fi lz ma l mb mc">&lt;div&gt;<br/>  {% for note in notes %}<br/>    {{note.note}}<br/>    {{note.boolean}}<br/>    {{note.float}}<br/>    {{note.date}}<br/>  {% endfor %}<br/>&lt;/div&gt;</span></pre><p id="fcc2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，当我们使用表单添加注释时，它们会像这样显示在我们的页面上:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mi"><img src="../Images/7d5cb406abb6d77e025c823ae81e48ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4VpVJob7yjs1J7Pp3ao8w.png"/></div></div></figure><h2 id="fe79" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">第六步。添加表单以更新现有注释</h2><p id="d6ae" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">首先，我们将在模板&gt;视图&gt; authenticated.html文件的notes循环中添加一个表单。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="e3ba" class="ld jp hh lv b fi lz ma l mb mc">&lt;div&gt;<br/>  {% for note in notes %}<br/>    {{note.note}}<br/>    {{note.boolean}}<br/>    {{note.float}}<br/>    {{note.date}}<br/><br/>   <strong class="lv hi"> &lt;form method="POST" action=""&gt;<br/>      {{ note_form.hidden_tag() }}<br/>        {{ note_form.note(placeholder = "Note") }}<br/>        {{ note_form.boolean() }}<br/>        {{ note_form.float(placeholder = "Float") }}<br/>        {{ note_form.date()}}<br/>        &lt;input type="hidden" name="post_header" value="update note"&gt;</strong>      <br/>       <strong class="lv hi"> &lt;input type="hidden" name="note_to_update" value=" <br/>         {{note.id}}"&gt; <br/>       {{ note_form.submit() }}<br/>    &lt;/form&gt;</strong></span><span id="b405" class="ld jp hh lv b fi md ma l mb mc">  {% endfor %}<br/>&lt;/div&gt;</span></pre><p id="4ffa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我们重用了我们的注释表单，因为我们希望在更新注释时进行与创建注释时相同的验证。不同之处在于，我们还包括了两个隐藏字段。</p><ol class=""><li id="bb30" class="km kn hh ig b ih ii il im ip mf it mg ix mh jb kt ku kv kw bi translated">我们的帖子标题。这和注销按钮上的文章标题是一样的。这将通知我们的后端，这个post请求想要更新一个注释。</li><li id="132e" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">便笺id。这将是不同的每一个笔记，并会传达给后端哪个笔记更新。</li></ol><h2 id="c254" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">步骤7:配置后端来处理我们的新post请求</h2><p id="dcbc" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">现在，我们将更改index.py文件中if语句内的代码，该代码检查提交时是否验证了note表单。</p><p id="7483" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在它只是使用表单创建一个新对象:</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="0342" class="ld jp hh lv b fi lz ma l mb mc">if forms.NoteForm().validate_on_submit():<br/>   note_form = forms.NoteForm()<br/>   note = Note(username = current_user.username,<br/>               note = note_form.note.data,<br/>               boolean = note_form.boolean.data,<br/>               float = note_form.float.data,<br/>               date = note_form.date.data)<br/>   db.session.add(note)<br/>   db.session.commit()</span><span id="088d" class="ld jp hh lv b fi md ma l mb mc">   return redirect(url_for('hello_world'))</span></pre><p id="5331" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将添加一个额外的逻辑层来决定是添加还是更新一个注释。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="7a3e" class="ld jp hh lv b fi lz ma l mb mc">if forms.NoteForm().validate_on_submit():<br/>    <strong class="lv hi">if request.form.get('post_header') == 'update note':<br/>    <br/>    else:</strong><br/>        note_form = forms.NoteForm()<br/>        note = Note(username = current_user.username,<br/>                    note = note_form.note.data,<br/>                    boolean = note_form.boolean.data,<br/>                    float = note_form.float.data,<br/>                    date = note_form.date.data)<br/>        db.session.add(note)<br/>        db.session.commit()</span><span id="ef98" class="ld jp hh lv b fi md ma l mb mc">return redirect(url_for('hello_world'))</span></pre><p id="45ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个if语句在我们的note表单验证中。这意味着，如果验证了笔记表单，并且post_header隐藏输入是“更新笔记”,我们将做一些事情，否则我们将像以前一样创建一个新的笔记。</p><p id="19aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，如果文章标题是“更新注释”，我们将添加一些代码来更新注释。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="5529" class="ld jp hh lv b fi lz ma l mb mc">if forms.NoteForm().validate_on_submit():<br/>    if request.form.get('post_header') == 'update note':<br/>        <strong class="lv hi">note_form = forms.NoteForm()</strong><br/>        <strong class="lv hi">Note.query.filter_by(id =      <br/>        request.form.get('note_to_update')).update({<br/>                         'note' : note_form.note.data,<br/>                         'boolean' : note_form.boolean.data,<br/>                         'float' : note_form.float.data,<br/>                         'date' : note_form.date.data})<br/>        db.session.commit()</strong><br/>    else:<br/>        note_form = forms.NoteForm()<br/>        note = Note(username = current_user.username,<br/>                    note = note_form.note.data,<br/>                    boolean = note_form.boolean.data,<br/>                    float = note_form.float.data,<br/>                    date = note_form.date.data)<br/>        db.session.add(note)<br/>        db.session.commit()</span><span id="7366" class="ld jp hh lv b fi md ma l mb mc">return redirect(url_for('hello_world'))</span></pre><p id="d5e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与我们创建新对象的方式类似，我们首先从表单文件中获取表单。然后，我们查询对象，获取id与表单中第二个隐藏字段的id相匹配的注释。那我们就用。update()对我们的字段进行更改，并将它们设置为提交的表单中的值。当然，最后，我们将更改提交给数据库。有关更新数据库对象的更多信息，请查看这里的文档<a class="ae kx" href="https://docs.sqlalchemy.org/en/13/core/dml.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="fd1b" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">第八步。添加删除笔记的按钮</h2><p id="e6e4" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">首先，让我们在notes循环中添加一个按钮。为此，我们将向模板&gt;视图&gt; authenticated.html添加以下代码</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="50b4" class="ld jp hh lv b fi lz ma l mb mc">&lt;div&gt;<br/>  {% for note in notes %}<br/>    {{note.note}}<br/>    {{note.boolean}}<br/>    {{note.float}}<br/>    {{note.date}}</span><span id="ca7b" class="ld jp hh lv b fi md ma l mb mc">    <strong class="lv hi">&lt;form method="post"&gt;<br/>     &lt;input type="hidden" name="csrf_token"value="{{csrf_token()}}"&gt;  <br/>     &lt;input type="hidden" name="post_header" value="delete note"&gt; <br/>     &lt;input type="hidden" name="note_to_delete" value="{{not.id}}"&gt;        <br/>     &lt;input type="submit"  value="Delete"&gt;<br/>    &lt;/form&gt;</strong></span><span id="ea96" class="ld jp hh lv b fi md ma l mb mc">    &lt;form method="POST" action=""&gt;<br/>      {{ note_form.hidden_tag() }}<br/>        {{ note_form.note(placeholder = "Note") }}<br/>        {{ note_form.boolean() }}<br/>        {{ note_form.float(placeholder = "Float") }}<br/>        {{ note_form.date()}}<br/>        &lt;input type="hidden" name="post_header" value="update note"&gt;      <br/>        &lt;input type="hidden" name="note_to_update" value=" <br/>         {{note.id}}"&gt; <br/>       {{ note_form.submit() }}<br/>    &lt;/form&gt;<strong class="lv hi"><br/></strong>  {% endfor %}<br/>&lt;/div&gt;</span></pre><p id="cd68" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">类似于我们的注销按钮，我们不需要任何验证，因此不需要为此创建一个表单类。我们将使用3个隐藏输入:</p><ol class=""><li id="7802" class="km kn hh ig b ih ii il im ip mf it mg ix mh jb kt ku kv kw bi translated">我们的CSRF代币</li><li id="2238" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">一个post头告诉我们的后端，这个post请求想要删除一个注释。</li><li id="09c8" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">我们要删除的便笺的ID号。</li></ol><p id="50d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当然还有我们的提交按钮。</p><p id="6362" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在我们每个笔记的下面，我们会看到一个表单和一个删除按钮。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/240ce54ec247cbcee55ba4523a743391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2CKxlMKneQzNM2wr8QZmg.png"/></div></div></figure><h2 id="bafa" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">第九步。配置我们的后端来处理删除帖子请求</h2><p id="e434" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">首先，让我们更新index.py文件来处理这个post请求。我们将从另一个if语句开始，类似于我们用来处理注销的语句。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="236f" class="ld jp hh lv b fi lz ma l mb mc">if (request.method == "POST") &amp; (request.form.get('post_header') == 'delete note'):</span><span id="70c0" class="ld jp hh lv b fi md ma l mb mc">    return redirect(url_for('hello_world'))</span></pre><p id="4e42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果有post请求且post_header等于“删除注释”,将进入if循环。因此，当我们的删除按钮被点击，我们将进入这个循环。</p><p id="7204" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将添加一些代码来删除您点击的笔记。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="75e4" class="ld jp hh lv b fi lz ma l mb mc">if (request.method == "POST") &amp; (request.form.get('post_header') == 'delete note'):<br/>    <br/>    <strong class="lv hi">note_id = request.form.get('note_to_delete')<br/>    Note.query.filter_by(id = note_id ).delete()<br/>    db.session.commit()</strong><br/>        <br/>        return redirect(url_for('hello_world'))</span></pre><p id="7cf8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这三行:</p><ol class=""><li id="0be0" class="km kn hh ig b ih ii il im ip mf it mg ix mh jb kt ku kv kw bi translated">获取要从表单中删除的注释的id。</li><li id="a160" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">从数据库中删除具有该id的便笺。</li><li id="6d3e" class="km kn hh ig b ih ky il kz ip la it lb ix lc jb kt ku kv kw bi translated">将我们的更改提交到数据库。</li></ol><p id="20e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关删除的更多信息，请查看此处的文档<a class="ae kx" href="https://docs.sqlalchemy.org/en/13/core/dml.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="689b" class="ld jp hh bd jq le lf lg ju lh li lj jy ip lk ll kc it lm ln kg ix lo lp kk lq bi translated">第十步。重组我们的档案</h2><p id="6665" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip lr ir is it ls iv iw ix lt iz ja jb ha bi translated">您可能已经注意到，我们还没有使用完整的文件结构。现在我们的一些文件变得很长。让我们花一点时间将它们重组为一种更可持续的形式。</p><p id="3ad1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们将通过拆分组件来整理我们的HTML模板。</p><p id="23cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在templates文件夹中添加两个名为“forms”和“components”的新文件夹，并在“forms”文件夹中再创建4个文件夹:“actions”、“create”、“delete”和“update”</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mk"><img src="../Images/960f8ddea0460d8b7b886bcbdfba62e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*4-5paJmt7_bhbE8I0q49wA.png"/></div></figure><p id="a46a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们将开始把代码从我们的authenticated.html文件转移到这些新的文件夹中。</p><p id="b06f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在“表单”文件夹的“创建、更新和删除”文件夹中，创建一个note.html文件。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ml"><img src="../Images/7ba929f900731d3a98d7c791b46729a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*IyHU9NSTVKUFLWfxgiy_DA.png"/></div></figure><p id="3b4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将以下代码从authenticated.html移动到create&gt;note.html</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="d36d" class="ld jp hh lv b fi lz ma l mb mc">&lt;form method="POST" action=""&gt;<br/>  {{ note_form.hidden_tag() }}<br/>    {{ note_form.note(placeholder = "Note") }}<br/>    {{ note_form.boolean() }}<br/>    {{ note_form.float(placeholder = "Float") }}<br/>    {{ note_form.date()}}<br/>    {{ note_form.submit() }}<br/>&lt;/form&gt;</span></pre><p id="e3c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将以下代码从authenticated.html移动到updated&gt;note.html</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="742f" class="ld jp hh lv b fi lz ma l mb mc">&lt;form method="POST" action=""&gt;<br/>  {{ note_form.hidden_tag() }}<br/>    {{ note_form.note(placeholder = "Note") }}<br/>    {{ note_form.boolean() }}<br/>    {{ note_form.float(placeholder = "Float") }}<br/>    {{ note_form.date()}}<br/>    &lt;input type="hidden" name="post_header" value="update note"&gt;<br/>    &lt;input type="hidden" name="note_to_update" value="{{note.id}}"&gt;<br/>    {{ note_form.submit() }}<br/>&lt;/form&gt;</span></pre><p id="96f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将以下代码从authenticated.html移动到delete&gt;note.html</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="3eb3" class="ld jp hh lv b fi lz ma l mb mc">&lt;form method="post"&gt;<br/>  &lt;input type="hidden" name="csrf_token" value="{{ csrf_token() }}"&gt;<br/>  &lt;input type="hidden" name="post_header" value="delete note"&gt;<br/>  &lt;input type="hidden" name="note_to_delete" value="{{note.id}}"&gt;<br/>  &lt;input type="submit"  value="Delete"&gt;<br/>&lt;/form&gt;</span></pre><p id="f9c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后在表单&gt;动作中创建一个名为logout.html的文件。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mm"><img src="../Images/a80b1e5ae088a98eaad56830a3998a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*8adYD4KTA547Vkc50frcSA.png"/></div></figure><p id="1b21" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将下面的代码从authenticated.html移到logout.html。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="e67f" class="ld jp hh lv b fi lz ma l mb mc">&lt;form method="post"&gt;<br/>  &lt;input type="hidden" name="csrf_token" value="{{ csrf_token() }}"&gt;<br/>  &lt;input type="hidden" name="post_header" value="log out"&gt;<br/>  &lt;input type="submit"  value="Logout"&gt;<br/>&lt;/form&gt;</span></pre><p id="3170" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将更新我们的authenticated.html文件，以包含我们刚刚创建的所有这些文件。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="f083" class="ld jp hh lv b fi lz ma l mb mc">&lt;p&gt;Hello, authenticated user!&lt;/p&gt;</span><span id="23bd" class="ld jp hh lv b fi md ma l mb mc"><strong class="lv hi">{% include 'forms/actions/logout.html' %}<br/>{% include 'forms/create/note.html' %}<br/></strong>&lt;div&gt;<br/>  {% for note in notes %}<br/>    {{note.note}}<br/>    {{note.boolean}}<br/>    {{note.float}}<br/>    {{note.date}}<br/>    <strong class="lv hi">{% include 'forms/update/note.html' %}<br/></strong>    <strong class="lv hi">{% include 'forms/delete/note.html' %}<br/> </strong><br/>  {% endfor %}<br/>&lt;/div&gt;</span></pre><p id="17c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将在templates&gt;components中创建一个名为note_list.html的文件。然后，我们将循环遍历我们的注释的整个div从我们的authenticated.html移动到我们的新文件中。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="a7a4" class="ld jp hh lv b fi lz ma l mb mc">&lt;div&gt;<br/>  {% for note in notes %}<br/>    {{note.note}}<br/>    {{note.boolean}}<br/>    {{note.float}}<br/>    {{note.date}}</span><span id="fdf9" class="ld jp hh lv b fi md ma l mb mc">    {% include 'forms/update/note.html' %}<br/>    {% include 'forms/delete/note.html' %}<br/>    <br/>  {% endfor %}<br/>&lt;/div&gt;</span></pre><p id="d793" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们将更新我们的authenticated.html文件以包含这个新组件。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="41cb" class="ld jp hh lv b fi lz ma l mb mc">&lt;p&gt;Hello, authenticated user!&lt;/p&gt;</span><span id="daf9" class="ld jp hh lv b fi md ma l mb mc">{% include 'forms/actions/logout.html' %}<br/>{% include 'forms/create/note.html' %}<br/><strong class="lv hi">{% include 'components/note_list.html' %}</strong></span></pre><p id="0284" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将整理index.py文件。</p><p id="e00c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，让我们在backend&gt;CRUD&gt; create.py中创建一个新函数</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="da94" class="ld jp hh lv b fi lz ma l mb mc">def user(register_form):<br/>    <br/>    return()</span></pre><p id="7787" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，让我们将创建新用户的代码从index.py移到这个新函数中。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="3231" class="ld jp hh lv b fi lz ma l mb mc">def user(register_form):</span><span id="9415" class="ld jp hh lv b fi md ma l mb mc"><strong class="lv hi">    hashed_password =  <br/>bcrypt.generate_password_hash(register_form.password.data).decode('utf-8')<br/>    user = User(username = register_form.username.data,<br/>                email = register_form.email.data,<br/>                password = hashed_password)</strong></span><span id="6469" class="ld jp hh lv b fi md ma l mb mc"><strong class="lv hi">    db.session.add(user)<br/>    db.session.commit()</strong><br/>    <br/>    return()</span></pre><p id="ffdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了让这个函数工作，我们还需要添加以下导入。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="44e6" class="ld jp hh lv b fi lz ma l mb mc"><strong class="lv hi">from config import  bcrypt, User, db</strong></span><span id="f8b0" class="ld jp hh lv b fi md ma l mb mc">def user(register_form):</span><span id="4b88" class="ld jp hh lv b fi md ma l mb mc">    hashed_password =  <br/>bcrypt.generate_password_hash(register_form.password.data).decode('utf-8')<br/>    user = User(username = register_form.username.data,<br/>                email = register_form.email.data,<br/>                password = hashed_password)</span><span id="7d1b" class="ld jp hh lv b fi md ma l mb mc">    db.session.add(user)<br/>    db.session.commit()<br/>    <br/>    return()</span></pre><p id="e47f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们可以简化index.py文件来使用这个函数:</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="3a0f" class="ld jp hh lv b fi lz ma l mb mc">create.user(forms.RegistrationForm())</span></pre><p id="0715" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用它，我们需要在index.py文件中更新我们的导入。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="dcbf" class="ld jp hh lv b fi lz ma l mb mc">from config import app, db, bcrypt, User, Note<br/>from flask import Flask, render_template, request, redirect, url_for<br/>from flask_login import login_user, current_user, logout_user, login_required<br/>import forms<br/><strong class="lv hi">import sys<br/>sys.path.append('backend/CRUD')<br/>import create<br/>import update<br/>import delete<br/>import actions</strong></span></pre><p id="08c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将向CRUD&gt;create.py添加另一个函数</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="e74b" class="ld jp hh lv b fi lz ma l mb mc">def note(note_form):</span><span id="a391" class="ld jp hh lv b fi md ma l mb mc">    note = Note(username = current_user.username,<br/>                note = note_form.note.data,<br/>                boolean = note_form.boolean.data,<br/>                float = note_form.float.data,<br/>                date = note_form.date.data)<br/>    db.session.add(note)<br/>    db.session.commit()</span><span id="0279" class="ld jp hh lv b fi md ma l mb mc">return()</span></pre><p id="8423" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们也将把我们的Note类添加到导入中。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="29a8" class="ld jp hh lv b fi lz ma l mb mc">from config import  bcrypt, User, db<strong class="lv hi">, Note</strong></span></pre><p id="7427" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们在CRUD&gt; update.py文件中为我们的note类创建一个更新函数。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="5020" class="ld jp hh lv b fi lz ma l mb mc">from config import  db, Note<br/>from flask import request</span><span id="1b5b" class="ld jp hh lv b fi md ma l mb mc">def note(note_form):</span><span id="87d0" class="ld jp hh lv b fi md ma l mb mc">    Note.query.filter_by(id =   <br/>    request.form.get('note_to_update')).update({<br/>                  'note' : note_form.note.data,<br/>                  'boolean' : note_form.boolean.data,<br/>                  'float' : note_form.float.data,<br/>                  'date' : note_form.date.data})<br/>    db.session.commit()<br/>    <br/>    return()</span></pre><p id="54ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们可以简化在index.py中处理我们的note表单的post请求的if语句。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="bc17" class="ld jp hh lv b fi lz ma l mb mc">if forms.NoteForm().validate_on_submit():<br/>    if request.form.get('post_header') == 'update note':<br/>        update.note(forms.NoteForm())<br/>    else:<br/>        create.note(forms.NoteForm())<br/>    return redirect(url_for('hello_world'))</span></pre><p id="2fa1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，让我们在CRUD&gt;delete.py文件中添加一个函数。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="2f26" class="ld jp hh lv b fi lz ma l mb mc">from config import  db, Note</span><span id="dbdd" class="ld jp hh lv b fi md ma l mb mc">def note(note_id):</span><span id="83f5" class="ld jp hh lv b fi md ma l mb mc">    Note.query.filter_by(id = note_id ).delete()<br/>    db.session.commit()</span><span id="c808" class="ld jp hh lv b fi md ma l mb mc">return()</span></pre><p id="cf36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们可以更新我们的index.py文件。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="6562" class="ld jp hh lv b fi lz ma l mb mc">if (request.method == "POST") &amp; <br/>   (request.form.get('post_header') == 'delete note'):<br/>    <br/>    delete.note(request.form.get('note_to_delete'))<br/>    <br/>    return redirect(url_for('hello_world'))</span></pre><p id="b8cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将在CRUD&gt;actions.py文件中创建一个函数来处理登录。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="cfa2" class="ld jp hh lv b fi lz ma l mb mc">from flask_login import login_user, current_user<br/>from config import bcrypt, User<br/>from flask import request</span><span id="e357" class="ld jp hh lv b fi md ma l mb mc">def login(email, password):</span><span id="d6d5" class="ld jp hh lv b fi md ma l mb mc">    user = User.query.filter_by(email = email).first()<br/>    if user and bcrypt.check_password_hash(user.password, password):<br/>        login_user(user)</span><span id="c1d1" class="ld jp hh lv b fi md ma l mb mc">return()</span></pre><p id="ea7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们可以简化处理登录和注册的if语句。</p><pre class="jd je jf jg fd lu lv lw lx aw ly bi"><span id="8123" class="ld jp hh lv b fi lz ma l mb mc">if forms.RegistrationForm().validate_on_submit():<br/>        create.user(forms.RegistrationForm())<br/>        actions.login(forms.RegistrationForm().email.data,                                  <br/>                      forms.RegistrationForm().password.data)<br/>        return redirect(url_for('hello_world'))</span><span id="79d6" class="ld jp hh lv b fi md ma l mb mc">if forms.LoginForm().validate_on_submit():<br/>                 <br/>        actions.login(forms.RegistrationForm().email.data,                               <br/>                      forms.RegistrationForm().password.data)<br/>        return redirect(url_for('hello_world'))</span></pre><p id="ff97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是第六部分的结尾！这部分的源代码可以在我的GitHub <a class="ae kx" href="https://github.com/shawnhymers/FlaskApp/tree/Part-6" rel="noopener ugc nofollow" target="_blank">这里找到:</a></p></div></div>    
</body>
</html>