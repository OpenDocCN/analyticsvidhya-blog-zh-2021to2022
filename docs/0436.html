<html>
<head>
<title>Mapping and Listing in Household Surveys with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用R绘制和列出住户调查</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mapping-and-listing-in-household-surveys-with-r-a978b9bf2df7?source=collection_archive---------17-----------------------#2021-01-16">https://medium.com/analytics-vidhya/mapping-and-listing-in-household-surveys-with-r-a978b9bf2df7?source=collection_archive---------17-----------------------#2021-01-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><p id="8efd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">家庭调查可能是一项艰巨的任务，因为许多移动数据必须同步才能收集到可靠的数据。这需要大型团队一起完成许多不同的任务。此外，还需要复杂的工具来准备调查。</p><p id="496c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然而，有时团队会很小，缺少重要的工具，同样的目标是收集高质量的数据。在这种情况下，使用提供的或类似的R script可以方便地处理列表和制图等问题，即使没有先进的GIS工具，如ArchGIS或所选样本区域的高清图片。</p><p id="977a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在住户调查(或一般调查)的A、B、c中，应使访问者能够容易地在实地调查工作中识别出要访问的选定住户样本中的住户。</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jj"><img src="../Images/a136a91d76edf9cea5a8bcb3745494a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0x73Hk66RB0yCfK42MEJqQ.jpeg"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">CAPI实地数据收集，插图</figcaption></figure><p id="51b6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">通常会编制被选中进行调查的住户名单，并交给负责用编制好的调查问卷访问住户成员的统计员。此外，为了便于识别住户，清单应包括户主的姓名、所选住户的实际地址(包括邮政编码、城市名称、街道地址和号码等)，以及住户所在地区的地图，最好是关于如何到达住户居住的每个实际住所的简短说明。</p><p id="5553" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">列表信息通常是通过列表工作准备的，包括若干列表员(普查员)和绘图员小组访问调查所选地区的所有家庭</p><p id="c587" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如前所述，统计局通常有非常复杂和精确的地理数据用于实地调查。以及以用户友好的方式绘制数据的工具，使现场团队的列表工作更加容易。</p><p id="5b3f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">被选作调查样本的住户的地理标记数据(坐标信息)对正在进行调查的统计员来说是非常有用的信息。</p><p id="a8bc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是，如果数据无法在高清屏幕上绘制。地图或使用许可软件，R和以下脚本可能有助于提供所需质量的所需地图，以推进实地工作数据收集的地图绘制和列表工作。在与small stats office的合作中，我们遇到了这个挑战。</p></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><p id="b827" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为了让团队做好野外工作数据收集的准备，我们准备了r。</p><p id="964d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">首先，这是用于创建映射文件的库的列表。请注意，其中一些我是在没有严格审查每个包的附加值的情况下离开的。但总的来说，它们将有助于为拟议的测绘工作创造一个更好的外观。</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="dec9" class="ke kf hh ka b fi kg kh l ki kj">  library(ggplot2)<br/>  library(ggmap)<br/>  library(rgdal)<br/>  library(ggrepel)<br/>  library(cowplot)<br/>  library(rgdal)<br/>  library(ggspatial)<br/>  library(ggpubr)<br/>  library(ggsn)</span></pre><p id="164f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">出于隐私和伦理方面的考虑，本例中使用的数据已被匿名化(户主姓名已被替换为通用名)，而lon和lat值已被修改为一个通用值。</p><p id="46cf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Dropbox上提供了本练习使用根据所述原则生成虚拟值文件，可以使用以下函数访问该文件。代码片段中的以下行以允许使用列表数据集中的常用术语的方式命名列。</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="a95d" class="ke kf hh ka b fi kg kh l ki kj">tr &lt;- read.csv("<a class="ae kk" href="https://www.dropbox.com/s/i72ntsiba8h7jnr/hh_sample.csv" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/s/i72ntsiba8h7jnr/hh_sample.csv</a>", comment.char="#")</span><span id="4165" class="ke kf hh ka b fi kl kh l ki kj">colnames(tr)&lt;-c("Team", "Day", "HH", "Cluster Number", "Household Number", "EA code", "hh_id", "hhsize", "island", "island code", "village", "village code", "EA code4", "occupancy", "dwelling type", "name", "family name", "domain", "domain5", "LAT", "LON", "HH_Head")</span></pre><p id="d1eb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在使用ggmap包中的google maps之前，确保你有与R Studio连接的google服务的API密匙(关于如何做，请阅读这里的<a class="ae kk" href="https://developers.google.com/maps/documentation/geocoding/get-api-key" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="4a42" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于这个例子，实际上只使用了几列——户主姓名、纬度和经度数据。为了格式化数据帧中选定的列，我使用了这部分代码</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="1c88" class="ke kf hh ka b fi kg kh l ki kj">df &lt;- NULL<br/>  df$HH&lt;-tr$HH<br/>  df$HH_Head &lt;- tr$HH_Head<br/>  df$lat&lt;- tr$LAT<br/>  df$lon&lt;- tr$LON<br/>  df&lt;-as.data.frame(df)<br/>  df$HH_Head1&lt;-paste(df$HH,df$HH_Head, sep=".")<br/> df &lt;- na.omit(object = df)</span></pre><p id="00ab" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在有趣的部分——在地图上标出纬度和经度。为此，你应该在Google上设置一个API键，并在r。</p><p id="adb4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于映射本身，我使用ggmap包中的一个标准get_map函数，并将创建两个具有类似功能的映射。</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="9d95" class="ke kf hh ka b fi kg kh l ki kj">sample.mapea &lt;- get_map(location = c(lon = mean(df$lon), lat = mean(df$lat)), zoom = 17, source = "google" , maptype = "hybrid", scale = 1)</span></pre><p id="7f38" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在这张基本地图上，现在添加了将要绘制出来的每户人家的标签。这些标签代表根据清单数据集中的现有数据占据实际住所的户主姓名。由于可以从一个查点区域中选择20个以上的家庭，所以显示标签是分开的，因此使用平均值，标签的光环将绘制在地图的左侧，而另一半将在右侧。</p><p id="41e0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">此外，无论标注将绘制在哪一边，标注都需要放置为不重叠，因此geom _ label _ repel用于分布标注，以便平均分布标注。</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="c1a7" class="ke kf hh ka b fi kg kh l ki kj">geom_point(data = df, aes(x = lon, y = lat, color= "white"), color="red", fill= "black", stroke = 1.5, shape = 21, alpha=0.9)+<br/>    <br/>  geom_label_repel(data = subset(df, df$lon&gt;=mean(df$lon)),<br/>                  aes(x = lon, y = lat, label = HH_Head1), <br/>                  fontface = "bold",<br/>                  <br/>                  nudge_x = 0.02,<br/>                  <br/>                  direction = "y",<br/>                  box.padding = unit(0.081, 'lines'),<br/>                  hjust = 1,<br/>                  <br/>                  segment.size = 0.1,<br/>                 <br/>                  arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),force=5) +<br/>        <br/>    geom_label_repel(data = subset(df, df$lon&lt;mean(df$lon)),<br/>                     aes(x = lon, y = lat, label = HH_Head1), <br/>                     fontface = "bold",<br/>                     <br/>                     nudge_x = -0.7,<br/>                     <br/>                     direction = "y",<br/>                     box.padding = unit(0.081, 'lines'),<br/>                     hjust = 0,<br/>                     <br/>                     segment.size = 0.1,<br/>                     <br/>                     arrow = arrow(length = unit(0.03, "npc"), type = "closed", ends = "first"),force=5) +</span></pre><p id="1187" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最后，我还在这张地图上添加了一个指南针箭头，这样采访者或团队主管就可以很容易地在现场确定方向。这只是对地图的额外美化。</p><p id="9b9b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这里还为第一张地图添加了一个通用的标题。</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="1aca" class="ke kf hh ka b fi kg kh l ki kj">scale_fill_viridis_c(trans = "sqrt", alpha = .9)+</span><span id="3ac0" class="ke kf hh ka b fi kl kh l ki kj">annotation_north_arrow(location = "bl", which_north = "true", <br/>                           pad_x = unit(0.75, "in"), pad_y = unit(0.5, "in"),<br/>                           style = north_arrow_fancy_orienteering) +</span><span id="5314" class="ke kf hh ka b fi kl kh l ki kj">ggtitle("", subtitle = "(Cluster # 00001, Team # 001)")+<br/>   <br/>    theme_void() + <br/>    <br/>    theme(legend.position="none")</span></pre><p id="c286" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">第二张地图也需要一个标题:</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="4210" class="ke kf hh ka b fi kg kh l ki kj">ggarrange(sample.mapea, sample.mapea_small + rremove("x.text"), <br/>             labels = c("Location of Households in EA", "Location of the EA"),<br/>              <br/>             ncol = 1, nrow = 2,align = "v")</span></pre><p id="b85a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最后，我创建了一个A4大小的PDF文件，其中绘制了两张地图，便于现场采访者使用:</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="fdcb" class="ke kf hh ka b fi kg kh l ki kj">ggsave(filename = "Cluster_map_sample.pdf", plot = last_plot(), device = NULL, path = NULL,<br/>          width = 8.3, height = 11.7,<br/>          dpi = "retina", limitsize = TRUE)</span></pre><p id="7f8d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最终产品看起来会像这样:</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es km"><img src="../Images/a34b267ec2a1c1396ff7e406645973b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gfnmPfW6HzdGtq7O5tUo_w.jpeg"/></div></div></figure><p id="d091" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">希望这将有助于你的测绘工作。</p><p id="a48a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">策划吧！</p></div></div>    
</body>
</html>