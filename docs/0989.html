<html>
<head>
<title>Load Keras Weight to PyTorch And Transform Keras Architecture to PyTorch Easily</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Keras的重量加载到PyTorch，并轻松地将Keras架构转换为PyTorch</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/load-keras-weight-to-pytorch-and-transform-keras-architecture-to-pytorch-easily-8ff5dd18b86b?source=collection_archive---------6-----------------------#2021-02-09">https://medium.com/analytics-vidhya/load-keras-weight-to-pytorch-and-transform-keras-architecture-to-pytorch-easily-8ff5dd18b86b?source=collection_archive---------6-----------------------#2021-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="937f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大多数人已经开始使用Keras API建立深度学习模型，这不是最好的，但最容易使用，但PyTorch具有非常高的调试能力。其中一个原因是，在PyTorch中，我们必须编写每一个步骤，这样我们就可以很好地了解代码，并且可以很容易地调试错误，但在Keras中却不是这样。</p><p id="1e40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在PyTorch中实现架构时也遇到了问题，但是记住一些重要的提示，实现起来很容易。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="8527" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们把模型做成Keras </strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/0d141d31fe3f5e710f1bf74023793c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SBSEMCTmRdZLmuEjs4Kh1g.png"/></div></div></figure><p id="4827" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们做了一个简单的建筑</p><ul class=""><li id="0a0b" class="jw jx hi ih b ii ij im in iq jy iu jz iy ka jc kb kc kd ke bi translated">在第一个conv2D层中-输入图像(200，200，3)，过滤器数量-64，内核-(2*2)</li><li id="f690" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">在第二conv2D层中-过滤器数量-32，内核-(2*2)</li><li id="4417" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">MaxPool2D图层以减少要素的数量</li><li id="05b4" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">最后致密层</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kk"><img src="../Images/d35646605e87f8b354f2b86dd76d3938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r9LJH3k6SmLihF4X3LmNgA.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">模型架构</figcaption></figure><h1 id="4c4c" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">重要的</h1><p id="a7a0" class="pw-post-body-paragraph if ig hi ih b ii ln ik il im lo io ip iq lp is it iu lq iw ix iy lr ja jb jc hb bi translated">在加载模型之前，我们必须使用— <strong class="ih hj"> save() </strong>而不是<strong class="ih hj">save _ weights()来保存权重。</strong></p><p id="76dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">model . save(' weights _ name . H5 ')</strong></p><p id="314b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">原因</strong> - save()将权重和模型结构保存到单个HDF5文件中。我相信它还包括优化器状态之类的东西。然后，您可以使用带有load()的HDF5文件来重建整个模型，包括权重。</p><p id="58ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">save_weights()只将权重保存到HDF5，不保存任何其他内容。您需要额外的代码来从JSON文件重建模型。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ls"><img src="../Images/25f66461335c8a6f956ba9f14a780893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D9tG9py8Lpq1bSoIAntn_A.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">装载重物</figcaption></figure><p id="cb9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">将Keras架构转换为PyTorch架构</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lt"><img src="../Images/8ebef3d2f5a12518678225be0af98392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jSZThC2j1JkQQpHuOTg3HA.png"/></div></div></figure><h2 id="a4e0" class="lu kq hi bd kr lv lw lx kv ly lz ma kz iq mb mc ld iu md me lh iy mf mg ll mh bi translated">将Keras代码转换为Pytorch时的重要事项</h2><ul class=""><li id="0337" class="jw jx hi ih b ii ln im lo iq mi iu mj iy mk jc kb kc kd ke bi translated">第一个卷积层的输入形状应该是图像的通道数，在我们的例子中是3</li><li id="0464" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">对于第一个完全连接的层，我们需要计算输入形状。就像我们的例子CONV1D(199，199，3) -&gt;CONV2D (198，198，3) -&gt; MAXPOOL2D(99，99，3)</li><li id="abec" class="jw jx hi ih b ii kf im kg iq kh iu ki iy kj jc kb kc kd ke bi translated">#99*99*3=313632与keras的展平层相同(<strong class="ih hj">输入形状— (kernel_size-1)) </strong></li></ul><p id="a22b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Keras和PyTorch如何储存体重</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ml"><img src="../Images/3edc6b2ba533da9efc6f1ab87dea3a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5sbIZLgM3Y1XtlTOIoNdw.png"/></div></div></figure><p id="c2ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们将Keras权重加载到PyTorch模型中</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mm"><img src="../Images/2c188b392db4927081e5e8269c63617a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xfn7HOZcd5940BDUPMuGuw.png"/></div></div></figure><p id="c62f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以根据我们的数据进行测试……..</p><p id="80c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><div class="mn mo ez fb mp mq"><a href="https://pytorch.org/" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hj fi z dy mv ea eb mw ed ef hh bi translated">PyTorch</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">推动自然语言处理和多任务学习的发展。利用PyTorch的灵活性有效地研究新的…</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">pytorch.org</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne ju mq"/></div></div></a></div><p id="f344" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae nf" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank">https://keras.io/</a></p><p id="8106" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae nf" href="https://stackoverflow.com/questions/42621864/difference-between-keras-model-save-and-model-save-weights" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/42621864/difference-between-keras-model-save-and-model-save-weights</a></p><p id="3fe2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae nf" href="https://discuss.pytorch.org/t/how-to-convert-keras-model-to-pytorch-and-run-inference-in-c-correctly/93451" rel="noopener ugc nofollow" target="_blank">https://discuse . py torch . org/t/how-to-convert-keras-model-to-py torch-and-run-inference-in-c-correctly/93451</a></p></div></div>    
</body>
</html>