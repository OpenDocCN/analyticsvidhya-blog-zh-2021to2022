<html>
<head>
<title>“The not evil YouTube” extension for Firefox — A tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">火狐浏览器的“非邪恶YouTube”扩展——教程</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-not-evil-youtube-extension-for-firefox-a-tutorial-ebb7063367b6?source=collection_archive---------17-----------------------#2021-03-28">https://medium.com/analytics-vidhya/the-not-evil-youtube-extension-for-firefox-a-tutorial-ebb7063367b6?source=collection_archive---------17-----------------------#2021-03-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="0c56" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="a643" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">作为一名软件工程师，我在YouTube上看了很多教育视频。像freecodecamp、MITOpenCourseware等频道有很多很棒的内容，有助于理解不同的概念以及不同的编码框架。但这遇到了一个基本问题，YouTube希望你留在他们的网站上，因此会显示许多与你正在观看的教育内容不一定相关的推荐。(你知道那些标题像“你不会相信接下来发生了什么”的)所以我决定写一个Firefox扩展来解决这个问题。我决定将它命名为“不邪恶的YouTube”，灵感来自谷歌最初的座右铭“不要邪恶”。这是我第一次尝试写扩展，我将分享我在这篇文章中学到的东西。</p><h1 id="d920" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第1部分:清单. json</h1><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="d853" class="kj if hh kf b fi kk kl l km kn">{<br/>  "manifest_version": 2,<br/>  "name": "The not evil youtube",<br/>  "version": "3.0.2",<br/>  "description": "Removes unwanted videos from suggestions on homepage as well as suggestion tab when the video is playing.",<br/>  "icons": {<br/>    "48": "yt_icon.png"<br/>  },<br/>  "permissions": [<br/>    "activeTab",<br/>    "tabs",<br/>    "storage"<br/>  ],<br/>  "browser_action": {<br/>    "default_icon": "yt_icon.png",<br/>    "default_title": "DBE",<br/>    "default_popup": "index.html"<br/>  }<br/>}</span></pre><p id="20d0" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">在项目的根目录中，您必须创建这个文件，并将其命名为“manifest.json”。这是描述扩展组件的文件。</p><p id="0de1" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">密钥manifest_version、name和version是必需的。</p><p id="42cb" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">permissions键用于指定扩展所需的所有权限。</p><p id="1a2d" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">browser动作用于设计当您单击浏览器菜单上的扩展图标时弹出的页面。</p><p id="b3f0" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">现在让我们来看看index.html</p><h1 id="7f8b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第二部分:index.html与fe.js</h1><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="992f" class="kj if hh kf b fi kk kl l km kn">&lt;!DOCTYPE HTML&gt;<br/>&lt;html&gt;</span><span id="4665" class="kj if hh kf b fi kt kl l km kn">&lt;head&gt;<br/>    &lt;link rel="stylesheet" href="<a class="ae ku" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css</a>"<br/>        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"&gt;<br/>    &lt;script src="<a class="ae ku" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" rel="noopener ugc nofollow" target="_blank">https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js</a>"<br/>        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"<br/>        crossorigin="anonymous"&gt;&lt;/script&gt;<br/>    &lt;style&gt;<br/>        #maindiv {<br/>            margin-left: 3%;<br/>            margin-right: 3%;<br/>            margin-top: 5%;<br/>            align-items: center;<br/>            align-content: center;<br/>        }</span><span id="5f57" class="kj if hh kf b fi kt kl l km kn">#global {<br/>            background-image: linear-gradient(to bottom, #63645f, #f5f1f1);<br/>        }</span><span id="3af7" class="kj if hh kf b fi kt kl l km kn">.bton {<br/>            padding-left: 10px;<br/>            padding-right: 10px;<br/>            text-align: center;<br/>            font-size: auto;<br/>            cursor: pointer;<br/>        }</span><span id="32a5" class="kj if hh kf b fi kt kl l km kn">.myBtn {<br/>            margin-top: 5%;<br/>            margin-bottom: 5%;<br/>        }<br/>    &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="c0db" class="kj if hh kf b fi kt kl l km kn">&lt;body id="global"&gt;<br/>    &lt;div id="maindiv"&gt;<br/>        &lt;h4 class="text"&gt;Enter Names of Allowed Channels:-&lt;/h3&gt;<br/>            &lt;div class="form-group"&gt;<br/>                &lt;div class="myBtn form-group"&gt;&lt;input class="form-control"<br/>                        placeholder="Enter allowed channel names separated by commas" id="ip" type="text" /&gt;&lt;/div&gt;<br/>                &lt;small id="emailHelp" class="form-text font-weight-bolder"&gt;Example: Casey Neistat,Peter Mckinnon&lt;/small&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="form-group"&gt;<br/>                &lt;div class="bton myBtn btn btn-primary btn-block" id="submit"&gt; Allow above<br/>                    channels&lt;/div&gt;<br/>                &lt;div class="bton myBtn btn btn-success btn-block" id="remove"&gt; Remove<br/>                    suggestions from Home&lt;/div&gt;<br/>                &lt;div class="bton myBtn btn btn-danger btn-block" id="deleteAll"&gt; Remove<br/>                    all allowed channels<br/>                    &lt;small class="form-text font-weight-bolder"&gt;&lt;u&gt;All Stored Channels will be deleted!&lt;/u&gt;&lt;/small&gt;<br/>                &lt;/div&gt;</span><span id="2d8f" class="kj if hh kf b fi kt kl l km kn">&lt;/div&gt;<br/>            &lt;p&gt;&lt;strong&gt;&lt;u&gt;Thanks for using DBE Extension!&lt;/u&gt;&lt;/strong&gt;&lt;/p&gt;<br/>    &lt;/div&gt;<br/>    &lt;script src="fe.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span><span id="40f3" class="kj if hh kf b fi kt kl l km kn">&lt;/html&gt;</span></pre><p id="aeea" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">这只是一个非常基本的html页面，带有一些引导样式。页面中嵌入的脚本fe.js是我们实际开始编写扩展的地方。</p><p id="328d" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">这就是index.html的样子。</p><figure class="ka kb kc kd fd kw er es paragraph-image"><div class="er es kv"><img src="../Images/92ef64db658626d07e2865afcfc3929e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*CotypmWTxCv8uMWkMYHRfg.png"/></div></figure><ul class=""><li id="58b7" class="kz la hh je b jf ko jj kp jn lb jr lc jv ld jz le lf lg lh bi translated">fe.js(前端脚本)</li></ul><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="c54a" class="kj if hh kf b fi kk kl l km kn">function listenForClicks() {</span><span id="2546" class="kj if hh kf b fi kt kl l km kn">/*<br/>        This function triggers the listener in hide.js to <br/>        call the function "trigger" in hide.js<br/>    */<br/>    function trigger(tabs) {<br/>        browser.tabs.sendMessage(tabs[0].id, {<br/>            command: "run",<br/>        });<br/>    }</span><span id="f80d" class="kj if hh kf b fi kt kl l km kn">//Set a listener on the remove suggestions button<br/>    let elem = document.getElementById("remove");<br/>    elem.addEventListener("click", (e) =&gt; {<br/>        browser.tabs.query({ active: true, currentWindow: true })<br/>            .then(trigger)<br/>            .catch(() =&gt; {<br/>                console.error("Script Broke")<br/>            });</span><span id="b75b" class="kj if hh kf b fi kt kl l km kn">});</span><span id="151a" class="kj if hh kf b fi kt kl l km kn">/*<br/>        This function triggers the listener in hide.js to <br/>        call the function "allowedChannel" in hide.js and passes value as an argument.<br/>    */<br/>  //Label - A<br/>    function triggerInput(tabs) {<br/>        let value = document.getElementById("ip").value;<br/>        browser.tabs.sendMessage(tabs[0].id, {<br/>            command: "ip",<br/>            data: value<br/>        });<br/>    }</span><span id="1f32" class="kj if hh kf b fi kt kl l km kn">//Set a listener on the submit channel button<br/>  //Label - B<br/>    let ele = document.getElementById("submit");<br/>    ele.addEventListener("click", (e) =&gt; {<br/>        browser.tabs.query({ active: true, currentWindow: true })<br/>            .then(triggerInput)<br/>            .catch(() =&gt; {<br/>                console.error("Script Broke")<br/>            });</span><span id="cda7" class="kj if hh kf b fi kt kl l km kn">});</span><span id="85b6" class="kj if hh kf b fi kt kl l km kn">/*<br/>        This function triggers the listener in hide.js to <br/>        call the function "clearStorage" in hide.js<br/>    */<br/>    function clearStorage(tabs) {<br/>        browser.tabs.sendMessage(tabs[0].id, {<br/>            command: "armageddon"<br/>        });<br/>    }</span><span id="e21b" class="kj if hh kf b fi kt kl l km kn">let btn = document.getElementById("deleteAll");<br/>    btn.addEventListener("click", (e) =&gt; {<br/>        browser.tabs.query({ active: true, currentWindow: true })<br/>            .then(clearStorage)<br/>            .catch(() =&gt; {<br/>                console.error("Script Broke")<br/>            });</span><span id="985d" class="kj if hh kf b fi kt kl l km kn">});</span><span id="e07c" class="kj if hh kf b fi kt kl l km kn">}</span><span id="9a42" class="kj if hh kf b fi kt kl l km kn">/**<br/> * When the popup loads, inject a content script into the active tab,<br/> * and add a click handler.<br/> * If we couldn't inject the script, handle the error.<br/> * This is taken from official documentation from <br/> * <a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension</a><br/> */<br/>browser.tabs.executeScript({ file: "/hide.js" })<br/>    .then(listenForClicks)<br/>    .catch(() =&gt; {<br/>        console.log("Script Broke");<br/>    });</span></pre><p id="a3e4" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">当fe.js加载时，我们调用hide.js脚本(也称为内容脚本),它在选项卡上设置一个监听器。这有助于我们从内容脚本中动态注入不同的功能。我们还声明了一个listenForClicks函数，它在index.html的所有按钮上设置onclick侦听器。</p><p id="ac2a" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">我将在这里解释其中一个监听器，其他两个以同样的方式工作。</p><p id="98cc" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">标签B处的ele.addEventListener函数(见上面的代码)设置一个onclickevent，如果当前选项卡是活动的，它调用标签A处的triggerInput函数(见上面的代码)。</p><p id="acb0" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">triggerInput函数调用browser.tabs.sendMessage，将当前选项卡的id和一个对象作为参数传递。</p><p id="4ac4" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">现在让我们看看hide.js是如何读取这个对象的。</p><h1 id="4609" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第3部分:hide.js(内容脚本)</h1><p id="7782" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这被称为内容脚本(来自官方文档)，它被注入到浏览器中，并与网页上的元素进行交互。它有3个功能clearStorage，trigger和addAllowedChannel。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="0b38" class="kj if hh kf b fi kk kl l km kn">function clearStorage(){<br/>    localStorage.clear();<br/>    //console.log("All channel names deleted!");<br/>}</span><span id="ca9a" class="kj if hh kf b fi kt kl l km kn">if (!localStorage.getItem("allowedArray")) {<br/>    //A sample array of channel names.<br/>    let allowedArrayString = "freeCodeCamp.org,ecnerwala,Engineering with Utsav,sudoCODE,3Blue1Brown,Clément Mihailescu, Errichto,Akshay Saini,MIT OpenCourseWare,stanfordonline,Andrew Huberman";<br/>    localStorage.setItem("allowedArray", allowedArrayString);<br/>    //console.log("First Write Done")<br/>}</span><span id="b680" class="kj if hh kf b fi kt kl l km kn">function addAllowedChannel(channelName = "default") {<br/>    if (channelName === "default") {<br/>        return;<br/>    }<br/>    else {<br/>        let currentString = localStorage.getItem("allowedArray");<br/>        let array = currentString.split(',');<br/>        if (array.indexOf(channelName) === -1) {<br/>            let allowedArrayString = currentString + "," + channelName;<br/>            localStorage.setItem("allowedArray", allowedArrayString);<br/>            //console.log("Added channel ", channelName);<br/>        }</span><span id="57d7" class="kj if hh kf b fi kt kl l km kn">}<br/>}</span><span id="3b17" class="kj if hh kf b fi kt kl l km kn">function trigger() {<br/>    var allowedArray = localStorage.getItem("allowedArray").split(',')<br/>    //console.log("Triggered", allowedArray);<br/>  //Label - Main Logic<br/>    if (window.location.href === "<a class="ae ku" href="https://www.youtube.com/" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/</a>") {<br/>        var e = null;<br/>        e = document.getElementById("contents").childNodes;<br/>        let i = e[0];<br/>        while (i !== null) {<br/>            let b = i.nextSibling;<br/>            var allowed = false;<br/>            for (let j = 0; j &lt; allowedArray.length; j++) {<br/>                if (i.innerText.includes(allowedArray[j])) {<br/>                    allowed = true;<br/>                }<br/>            }<br/>            if (!allowed) {<br/>                i.remove();<br/>            }<br/>            i = b;</span><span id="56d4" class="kj if hh kf b fi kt kl l km kn">}<br/>    }<br/>    else {<br/>        var element = null;<br/>        element = document.getElementById("secondary");<br/>        element.remove();<br/>    }<br/>    let toolbar = document.getElementById("guide-button");<br/>    toolbar.remove();</span><span id="4835" class="kj if hh kf b fi kt kl l km kn">let chips = document.getElementById("chips");<br/>    if (chips) {<br/>        chips.click();<br/>        chips.remove();<br/>    }</span><span id="42a2" class="kj if hh kf b fi kt kl l km kn">let sections = document.getElementById("contentContainer");<br/>    if (sections) {<br/>        sections.remove();<br/>    }</span><span id="2ca0" class="kj if hh kf b fi kt kl l km kn">}</span><span id="0511" class="kj if hh kf b fi kt kl l km kn">/*  <br/>    This is a listener set when the pop up loads and <br/>    is called when we call browser.tabs.query() from fe.js<br/>    Based on agrument passed, it calls different functions.<br/>*/<br/>browser.runtime.onMessage.addListener((message) =&gt; {<br/>    if (message.command === "run") {<br/>        trigger();<br/>    }<br/>    else if (message.command === "ip") {<br/>        addAllowedChannel(message.data);<br/>    }<br/>    else if(message.command === "armageddon"){<br/>        clearStorage();<br/>    }<br/>});</span></pre><p id="0226" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">现在，我们停止了上一部分，我们调用了browser.tabs.sendMessage，并将参数作为对象。browser . runtime . on message . add listener侦听此事件。</p><p id="a94a" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">在函数内部，我们检查命令，这里是“ip ”,因此我们读取从fe.js发送的数据，并调用addAllowedChannel方法将此通道添加到allowedArray。该数组也存储在浏览器的本地存储中。(为此，我们还在manifest.json中添加了存储权限。)</p><p id="887d" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">在触发器函数中，我们基本上基于id获取不同的元素并删除它们。</p><p id="6068" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">在Label-Main逻辑的触发功能中，我们主要检查我们是否在主页上，如果是，则获取页面上的所有视频，并检查它们是否来自我们允许的频道。如果没有，我们删除它们。</p><p id="4b02" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">这里是首页的前后:</p><figure class="ka kb kc kd fd kw er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es li"><img src="../Images/ebdb050d48669fc98753799ed1e08c9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tnTmXkqrS5M_DXpd9d2I_g.jpeg"/></div></div></figure><h1 id="58f2" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">结论</h1><p id="5cc0" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">因此，当你在YouTube上观看视频时，你有一个简单的扩展来收回控制权。正如我所说，这是我第一次延期，所以我知道这可能并不完美，也不是最有效的方式。如果你对我如何改进有任何建议，请告诉我。</p><p id="f2af" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">下次见。</p><p id="baec" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">我会在下面留下一些有用的链接。</p><p id="38f0" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">该项目的Github Repo:</p><p id="0513" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated"><a class="ae ku" href="https://github.com/Prathmesh2498/FireFoxYTExtension" rel="noopener ugc nofollow" target="_blank">https://github.com/Prathmesh2498/FireFoxYTExtension</a></p><p id="1b82" class="pw-post-body-paragraph jc jd hh je b jf ko jh ji jj kp jl jm jn kq jp jq jr kr jt ju jv ks jx jy jz ha bi translated">Firefox的官方文档:</p><ol class=""><li id="8683" class="kz la hh je b jf ko jj kp jn lb jr lc jv ld jz ln lf lg lh bi translated"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Mozilla/Add-ons/web extensions/Your _ first _ web extension</a></li><li id="973e" class="kz la hh je b jf lo jj lp jn lq jr lr jv ls jz ln lf lg lh bi translated"><a class="ae ku" href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Mozilla/Add-ons/web extensions/Your _ second _ web extension</a></li></ol></div></div>    
</body>
</html>