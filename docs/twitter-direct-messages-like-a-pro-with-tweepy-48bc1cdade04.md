# Twitter åƒä¸“ä¸šäººå£«ä¸€æ ·ç›´æ¥å‘é€æ¶ˆæ¯(å¸¦ Tweepy)

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/twitter-direct-messages-like-a-pro-with-tweepy-48bc1cdade04?source=collection_archive---------2----------------------->

Twitter ä¸Šçš„ç›´æ¥æ¶ˆæ¯å·²ç»å‡ºç°äº†ä¸€æ®µæ—¶é—´ã€‚è¿™å¹¶ä¸ä»¤äººæƒŠè®¶ï¼Œå› ä¸ºçŸ­ä¿¡æ— ç–‘å¯¹æˆ‘ä»¬æ¯å¤©äº¤æµã€å·¥ä½œå’Œè”ç³»çš„æ–¹å¼äº§ç”Ÿäº†å·¨å¤§å½±å“ã€‚

åœ¨ç¤¾äº¤å¹³å°ä¸Šï¼Œå¯¹äºé‚£äº›å¸Œæœ›é€šè¿‡å®¢æˆ·ä½“éªŒå’Œæ”¯æŒæ‰©å¤§å½±å“(å¢åŠ å…³æ³¨è€…)ã€åˆ›å»ºç‹¬ç‰¹å“ç‰Œæˆ–æä¾›â€œä¸ä½äºå“è¶Šâ€çš„ä¼ä¸šæ¥è¯´ï¼Œæ¶ˆæ¯ä¼ é€’å¯ä»¥å‘æŒ¥å…³é”®ä½œç”¨ã€‚

![](img/386b175875a5b0c884097091b1f889e7.png)

å¥¥åˆ—æ ¼Â·é©¬å°¼åœ¨ [Unsplash](https://unsplash.com/s/photos/twitter-messaging?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„çš„ç…§ç‰‡

åœ¨è¿™é‡Œ **1)** æˆ‘å°†è®¨è®ºä¸€äº›å…³äºç›´æ¥çš„ç§äººä¿¡æ¯å¦‚ä½•ç»™ä¸€ä¸ªå“ç‰Œæˆ–ç»„ç»‡å¸¦æ¥ä»·å€¼çš„äº‹å®å’Œè€ƒè™‘ï¼Œ **2)** æˆ‘å°†æ·±å…¥ä¸€äº›æŠ€æœ¯æ€§çš„ä¾‹å­(ç»™æŠ€æœ¯äººå‘˜)ğŸ¤“Twitter æœºå™¨äººå¦‚ä½•ä½¿ç”¨ Tweepy è¯»å–å’Œå‘é€ DMsã€‚

# ç›´æ¥ä¿¡æ¯çš„ä»·å€¼

ç›®çš„åœ°ç®¡ç†ç³»ç»Ÿå¯ç”¨äºè¿½æ±‚ä¸åŒçš„ç›®æ ‡:

*   çæƒœä½ çš„è¿½éšè€…:ä»»ä½•æ–°çš„è¿½éšè€…éƒ½ä¼šå—åˆ°â€œè°¢è°¢ä½ å…³æ³¨æˆ‘ä»¬â€çš„æ¬¢è¿æ¶ˆæ¯
*   å‚ä¸:å‘å…³æ³¨è€…å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥ä»–ä»¬ä¸€äº›é‡è¦çš„äº‹æƒ…(æœåŠ¡æˆ–æ”¿ç­–çš„å˜åŒ–)æˆ–æ–°çš„æœºä¼š(å¯ç”¨çš„ä¼˜æƒ æˆ–æœ‰ç”¨çš„æç¤º)
*   ä¸ªäºº:ä»¥å‹å¥½å’Œä¸ªäººçš„æ–¹å¼ç§ä¸‹æ¥è§¦å¯ä»¥åœ¨å“ç‰Œå’Œè¿½éšè€…ä¹‹é—´å»ºç«‹è”ç³»
*   åˆ©ç”¨è¿™äº›åŠŸèƒ½:Twitter DMs æ”¯æŒå¤šè¾¾ 10k ä¸ªå­—ç¬¦ï¼Œå…è®¸å®¢æˆ·æäº¤ä»–ä»¬çš„æŸ¥è¯¢ï¼Œè€Œä¸å—æ ‡å‡† Tweet(æœ€å¤š 280 ä¸ªå­—ç¬¦)çš„é™åˆ¶

ç›´æ¥ä¿¡æ¯**ä¸åº”è¢«æ»¥ç”¨**ï¼Œå› ä¸ºå®ƒä»¬ä¼šå˜æˆåƒåœ¾ä¿¡æ¯ï¼Œè½¬ç§»äººä»¬çš„å…´è¶£ï¼Œå¹¶ç»™å“ç‰Œå½¢è±¡è’™ä¸Šé˜´å½±ã€‚å‡ºäºåŒæ ·çš„åŸå› ï¼Œå®ƒä»¬**ä¸åº”è¯¥è¢«å¿½ç•¥**æˆ–è¢«è®¤ä¸ºæ˜¯å“åº”è¾ƒæ™šæˆ–è¾ƒå·®çš„ä½ä¼˜å…ˆçº§ã€‚

æœ€åï¼Œå½“å‡†å¤‡å¥½å¹¶æäº¤åï¼Œå¯ç”¨ä»æ¯ä¸ªäººé‚£é‡Œæ¥æ”¶ DMs çš„é€‰é¡¹:å½“ç›®æ ‡æ˜¯è®©å®¢æˆ·å’Œç”¨æˆ·èƒ½å¤Ÿè”ç³»åˆ°æ‚¨æ—¶ï¼Œè¿™å¾ˆé‡è¦ã€‚

![](img/151baaca0f970b82bfa120f6bfbe77c8.png)

é€‰ä¸­â€œå…è®¸æ¥è‡ªæ‰€æœ‰äººçš„æ¶ˆæ¯è¯·æ±‚â€

# Twitter æœºå™¨äººçš„ç‰‡æ®µå’Œå¼€å‘å®è·µ

Tweepy æ˜¯è®¿é—® Twitter æœ€æµè¡Œçš„åº“ä¹‹ä¸€ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå›´ç»• Twitter REST API çš„åŒ…è£…å™¨ï¼Œä»¥ç®€åŒ–ç«¯ç‚¹çš„é…ç½®ã€è®¤è¯å’Œè°ƒç”¨ã€‚

Tweepy å¯¹ Twitter ç›´æ¥æ¶ˆæ¯çš„æ”¯æŒéå¸¸å¥½ã€‚

åœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

*   è®¾ç½®å¯¹ Twitter API çš„è®¿é—®
*   è·å–å‘é€åˆ° Twitter å¸æˆ·çš„ DMs
*   è¡¨è¾¾é‡è¦æ„æ€
*   åˆ é™¤é‚®ä»¶

# è¯æ˜

è®¾ç½®å’ŒéªŒè¯éå¸¸ç®€å•ã€‚é¦–å…ˆåœ¨ [Twitter Dev](https://developer.twitter.com/en) ç½‘ç«™ä¸Šç”³è¯·ä¸€ä¸ª Twitter å¼€å‘è€…è´¦æˆ·ï¼Œä»¥è·å¾—å¿…è¦çš„è®¿é—®å¯†é’¥ã€‚

```
import tweepy

# Authenticate access
auth = tweepy.OAuthHandler("CONSUMER_KEY", "CONSUMER_SECRET")
auth.set_access_token("ACCESS_TOKEN", "ACCESS_TOKEN_SECRET")

# Create API handler
api = tweepy.API(auth)
```

ä¸è¦åœ¨æºä»£ç ä¸­ç¡¬ç¼–ç ä»¤ç‰Œå’Œå‡­è¯ï¼Œè€Œæ˜¯å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ä¸­ã€‚env)æˆ–è€…(ç”šè‡³æ›´å¥½)æ”¾åœ¨ç¯å¢ƒå˜é‡ä¸­ã€‚

# æ”¶åˆ°ç›´æ¥ä¿¡æ¯

å‘é€åˆ°æ‚¨å¸æˆ·çš„ DMs ä¼šå‡ºç°åœ¨â€œä¿¡æ¯â€æ”¶ä»¶ç®±ä¸­ã€‚Tweepy åº“æä¾›äº†ä¸€ä¸ªè·å–å®ƒä»¬çš„æ–¹æ³•:

```
messages = api.list_direct_messages(count=5)**for** message **in** reversed(messages):
  # who is sending?  
  sender_id = message.message_create[**"sender_id"**]
  # what is she saying?
  text = message.message_create[**"message_data"**][**"text"**]
```

å…³äºä¸Šé¢ä»£ç çš„å‡ ç‚¹è¯´æ˜:

1.  å•ä¸ª API è°ƒç”¨è·å–çš„æ¶ˆæ¯æ•°é‡æ˜¯å¯ä»¥æ§åˆ¶çš„(é»˜è®¤å€¼ä¸º 20ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨ 50)
2.  è¯¥åˆ—è¡¨è¢«åå‘å¤„ç†ï¼Œé¦–å…ˆè¯»å–æœ€è¿‘çš„æ¶ˆæ¯
3.  **æ‰€æœ‰æ”¶å‘çš„**ä¿¡æ¯éƒ½ä¼šè¢«è¿”å›(æ˜¯çš„ï¼Œè¿˜æœ‰æˆ‘ä»¬çš„å›å¤)
4.  å°½ç®¡ DM å¾ˆå¿«å‡ºç°åœ¨ Twitter æ¶ˆæ¯æ”¶ä»¶ç®±ä¸­ï¼Œä½†æ˜¯åœ¨é€šè¿‡ API è·å¾—ä¹‹å‰æœ‰ä¸€ä¸ª**å»¶è¿Ÿ**

æ›´å¤šä¿¡æ¯è¯·è®¿é—® [Twitter REST API è·å–ç›´æ¥æ¶ˆæ¯](https://developer.twitter.com/en/docs/twitter-api/v1/direct-messages/sending-and-receiving/api-reference/list-events)

# å‘é€ç›´æ¥ä¿¡æ¯

å‘é€ DMs ä¹Ÿæ˜¯ä¸€ä¸ªç®€å•çš„æ“ä½œ:

```
recipient_id = "123"  # ID of the user
api.send_direct_message(recipient_id, **"Hoi hoi"**)
```

å›å¤åŒ…æ‹¬ä¸€ä¸ª**åª’ä½“**ï¼Œå¯èƒ½å‘é€ä¸€ä¸ªæ„Ÿè°¢ gif æˆ–ä¸€ä¸ªå°çš„ä»‹ç»è§†é¢‘ï¼Œè¿™å¯èƒ½ä¼šå¾ˆé…·ã€‚

```
# upload media
media = api.media_upload(filename=**'/files/thankyou.png'**)# send with media
recipient_id = "123"  # ID of the user
api.send_direct_message(recipient_id=recipient_id, text='Thank You!', attachment_type=**'media'**, attachment_media_id=media.media_id)
```

æ³¨æ„`recipient_id`æ˜¯ Twitter ç”¨æˆ·çš„ ID(å·ç ),è€Œä¸æ˜¯ç”¨æˆ·å(å­—ç¬¦ä¸²ï¼Œå³@beppecatanese)ã€‚æ•°å­—ç”¨æˆ· ID å¯ä»¥é€šè¿‡ API è°ƒç”¨è·å¾—

```
user = api.get_user("beppecatanese")
recipient_id = user.id_str
```

å½“å›å¤ä¸€ä¸ª DM æ—¶ï¼Œæˆ‘ä»¬æ”¶åˆ°çš„`recipient_id`å¯ä»¥åœ¨åŸå§‹æ¶ˆæ¯çš„ JSON æœ‰æ•ˆè½½è·ä¸­æ‰¾åˆ°

```
recipient_id = message.message_create[**"sender_id"**]
```

æ›´å¤šä¿¡æ¯è¯·è®¿é—® [Twitter REST API å‘å¸ƒç›´æ¥æ¶ˆæ¯](https://developer.twitter.com/en/docs/twitter-api/v1/direct-messages/sending-and-receiving/api-reference/new-event)

# åˆ é™¤ç›´æ¥æ¶ˆæ¯

åˆ é™¤æ¶ˆæ¯ä¹Ÿä¾¿äºæ¸…ç†æ”¶ä»¶ç®±ï¼Œè¿˜å¯ä»¥é¿å…æ— æ„ä¸­å›å¤åŒä¸€æ¡æ¶ˆæ¯ã€‚

**æ³¨æ„**:æˆ‘é€šå¸¸ä¼šåœ¨å›å¤ååˆ é™¤ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™æ ·æˆ‘å°±ä¸ç”¨æ‹…å¿ƒä¸‹æ¬¡ä¸‹è½½æ¶ˆæ¯æ—¶ä¼šè·³è¿‡è¿™æ¡æ¶ˆæ¯ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯ç»å¯¹å¿…è¦çš„ï¼Œä½†å®ƒç®€åŒ–äº†æ”¶ä»¶ç®±çš„ç®¡ç†ã€‚

```
# delete by ID
api.destroy_direct_message(message.id)
```

# ç»“è®º

åœ¨ [GitHub](https://github.com/gcatanese/1-2-3-Direct-Messages-With-Tweepy) ä¸ŠæŸ¥çœ‹æºä»£ç 

å¯¹äºåäºŒä¸ªæ–°æ‰‹ï¼Œæˆ‘æ¨èä¸€ä¸ªéå¸¸å¥½çš„å…³äºçœŸæ­£ Python çš„æ•™ç¨‹

å¦‚æœ‰åé¦ˆå’Œé—®é¢˜ï¼Œè¯·é€šè¿‡æ¨ç‰¹è”ç³»æˆ‘ã€‚