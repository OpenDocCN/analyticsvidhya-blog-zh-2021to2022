<html>
<head>
<title>How to deploy Django application on AWS Ubuntu EC2 with Nginx and uWSGI — A Practical Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Nginx和uWSGI在AWS Ubuntu EC2上部署Django应用程序——实用指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-deploy-django-application-on-aws-ubuntu-ec2-with-nginx-and-uwsgi-a-practical-guide-1c114cb5f6b6?source=collection_archive---------0-----------------------#2021-12-21">https://medium.com/analytics-vidhya/how-to-deploy-django-application-on-aws-ubuntu-ec2-with-nginx-and-uwsgi-a-practical-guide-1c114cb5f6b6?source=collection_archive---------0-----------------------#2021-12-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="694c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我过去写过很多Django相关的博客。我没有讨论的一件事是如何将Django项目投入生产。在这篇文章中，我想讨论这个问题。要将项目部署到生产环境中，有许多方法。首先，您的主机/服务器环境是什么？其次，您必须选择将要使用的Web服务器(HTTP ),最后，您需要选择一个WSGI服务器，因为Django是一个Python Web框架。在本文中，我将通过使用AWS Ubuntu EC2 + Nginx + uWSGI来说明其中一个解决方案。</p><p id="f002" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从AWS开始，您可以创建一个AWS帐户来享受一些免费层产品，包括我们将在其上部署Django项目的服务器。AWS喜欢将这些服务器称为EC2实例。</p><p id="76c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">链接到AWS免费层:</p><p id="aeb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/free/</a></p><p id="de87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简而言之，整个技术栈和依赖项如下所示。</p><ul class=""><li id="8224" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">Ubuntu 20.04</li><li id="80c5" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">Nginx</li><li id="9f3d" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">uWSGI</li><li id="afd4" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">Python 3.8</li><li id="9cd3" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">Django 2.2.24</li><li id="7615" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">主题库—管理</li></ul><p id="d6b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图说明了上述堆栈的系统拓扑。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/dd54aa877c4e29ed2a4ff9ab8beef68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrODNmhDeEOhg0aaLVK2ug.png"/></div></div></figure><p id="5835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将在这里使用示例项目<a class="ae jd" href="https://github.com/slow999/DjangoAndAWSEC2Deployment" rel="noopener ugc nofollow" target="_blank"/>，它是我在上一篇文章<a class="ae jd" rel="noopener" href="/analytics-vidhya/how-to-use-adminlte-in-django-225359ce8c72">“Django and admin LTE”</a>中提到的项目的副本。让我们开始吧。</p></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h1 id="634f" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">步骤1:提供EC2实例</h1><p id="6fa4" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">在https://console.aws.amazon.com/ec2/<a class="ae jd" href="https://console.aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">打开亚马逊EC2控制台</a>。从控制台仪表板中，单击<strong class="ih hj">启动实例</strong>。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es lo"><img src="../Images/be9095b2d43fb89de36f2ab33b123aa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*sTbNYmtoibdVLdeh8oWbjA.png"/></div></figure><p id="8ff0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">步骤1:选择一个亚马逊机器映像(AMI) </strong>页面，</p><ol class=""><li id="fcc4" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc lp jk jl jm bi translated">用“ubuntu”搜索。</li><li id="46de" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">从<strong class="ih hj">快速入门</strong>选项卡的结果中，选择<strong class="ih hj"> 64位(x86) </strong>并选择<strong class="ih hj"> Ubuntu Server 20.04 LTS (HVM)，SSD卷类型</strong>。</li></ol><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/5f450e0638cb04d76272974bc0c05395.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZlNlLIsg_l8qGruDBzkQRw.png"/></div></div></figure><p id="dbb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">步骤2:选择实例类型页面</strong>，</p><ol class=""><li id="f693" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc lp jk jl jm bi translated">选择标记为<strong class="ih hj">自由层合格</strong>的实例类型</li><li id="649d" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">点击<strong class="ih hj">查看并启动</strong>。</li></ol><p id="1e2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将被引导至步骤7。不要担心其他步骤。保留默认设置。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/598dc8849a8b867621ed89e54550c606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hF5uukS_Repmcn0YV_aTtw.png"/></div></div></figure><p id="fb9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">Step 7:Review Instance Launch</strong>页面上，我们的实例将运行Ubuntu Server 20.04。它将有1个CPU，1 GB内存和8 GB存储。点击<strong class="ih hj">发射</strong>。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/777e887e2eb055b7869b599c041efed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tiCnnHXcIU3J8uKneG3kyQ.png"/></div></div></figure><p id="5918" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">上选择一个现有的密钥对或创建一个新的密钥对</strong>模式:</p><ol class=""><li id="a740" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc lp jk jl jm bi translated">选择<strong class="ih hj">创建新的密钥对</strong></li><li id="3d29" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">选择<strong class="ih hj"> RSA </strong>密钥对类型</li><li id="8295" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">键入密钥对名称。比如我的_demo_key。</li><li id="f2ed" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">点击<strong class="ih hj">下载密钥对</strong>。应该在您的本地机器上下载一个<strong class="ih hj"> my_demo_key.pem </strong>文件。请确保您安全地存储了这个密钥文件。</li><li id="d22f" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">点击<strong class="ih hj">启动实例</strong>。</li></ol><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lr"><img src="../Images/12024145dd722e40333154a9c57f86f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1aALlpeJvc9e-bcEEaBMA.png"/></div></div></figure><p id="ec58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">等待几秒钟。一旦实例准备就绪，我们应该会看到下面的页面。点击<strong class="ih hj">查看实例</strong>。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/44053a9cc8b35a990e20c66c7dc27539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pi6aupmouyVcJ-gz_7iEqA.png"/></div></div></figure><p id="ead5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">实例</strong>页面上，应该会显示我们刚刚启动的实例。</p><ol class=""><li id="4ad3" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc lp jk jl jm bi translated">请键入一个容易记住的名称。比如my_demo_server。</li><li id="8b76" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">记下它的公共IPv4地址。例如，54.193.19.108。</li><li id="4c21" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">记下它的安全组名。例如，默认情况下，启动向导-1。</li></ol><p id="187f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，启动了一个新实例。</p><p id="cb13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了连接实例并使实例公开，我们需要改变安全组。</p><ol class=""><li id="a45e" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc lp jk jl jm bi translated">打开<strong class="ih hj">网络&amp;安全</strong>部分下的<strong class="ih hj">安全组</strong>页面。</li><li id="f99e" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">点击<strong class="ih hj">启动向导-1 </strong>组的<strong class="ih hj">安全组ID </strong>。</li><li id="d186" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">在<strong class="ih hj">启动-向导-1 </strong>页面，点击<strong class="ih hj">编辑入库规则</strong>。</li><li id="3c94" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">在<strong class="ih hj">编辑入库规则</strong>页面中，</li></ol><p id="91f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.1.添加<strong class="ih hj"> SSH </strong>类型规则。来源是<strong class="ih hj">我的IP </strong>。</p><p id="3a61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.2.添加<strong class="ih hj"> HTTP </strong>类型规则。源是<strong class="ih hj"> Anywhere-IPv4 </strong>。</p><p id="7f09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.3.添加<strong class="ih hj"> HTTP </strong>类型规则。来源是<strong class="ih hj"> Anywhere-IPv6 </strong>。</p><p id="fba7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.4.添加<strong class="ih hj"> HTTPS </strong>型法则。来源是<strong class="ih hj"> Anywhere-IPv4 </strong>。</p><p id="3405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.5.添加<strong class="ih hj"> HTTPS </strong>型尺。来源是<strong class="ih hj"> Anywhere-IPv6 </strong>。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/b9f78e19e3181cdb5e56dcdf4547a367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2iF-PgP2MxJW3mnK3iQmA.png"/></div></div></figure><h1 id="5709" class="kl km hi bd kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le lw lg lh li bi translated">第二步:改变设置</h1><p id="3ca1" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">打开<strong class="ih hj"> mysite/settings.py </strong>文件，如下更改变量。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="e186" class="mc km hi ly b fi md me l mf mg">ALLOWED_HOSTS = ['54.193.19.108']<br/>STATIC_ROOT = '/var/www/mysite/assets/'</span></pre><h1 id="52a7" class="kl km hi bd kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le lw lg lh li bi translated">步骤3:在EC2实例上上传代码库</h1><p id="fdf8" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">有许多SFTP客户。在本教程中，让我们使用适用于微软视窗系统的WinSCP。</p><ol class=""><li id="2a25" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc lp jk jl jm bi translated">建立连接，点击<strong class="ih hj">登录</strong>。需要使用<strong class="ih hj"> my_demo_key.pem </strong>密钥文件来配置<strong class="ih hj">高级</strong>&gt;&gt;<strong class="ih hj">SSH</strong>&gt;&gt;<strong class="ih hj">认证</strong> &gt; &gt; <strong class="ih hj">私钥文件</strong>。</li><li id="466a" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">在<strong class="ih hj"> /home/ubuntu/ </strong>目录下创建一个<strong class="ih hj"> project_codebase </strong>目录。</li><li id="cf9c" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc lp jk jl jm bi translated">将代码库内容从本地机器上传到我们刚刚创建的目录。</li></ol><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/d97e528b500fd718a4dec857baeb62fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gZ-SfMqomGEdGemNt7hcCw.png"/></div></div></figure><h1 id="6565" class="kl km hi bd kn ko ls kq kr ks lt ku kv kw lu ky kz la lv lc ld le lw lg lh li bi translated">步骤4:配置EC2实例</h1><p id="de33" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">有几种方法可以连接服务器。请在此处查看AWS文档<a class="ae jd" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstances.html" rel="noopener ugc nofollow" target="_blank">中的演练。由于上一步我们使用了WinSCP，我们可以通过PuTTY 中打开的<strong class="ih hj">命令</strong>菜单<strong class="ih hj"> </strong> &gt; &gt; <strong class="ih hj">来连接服务器。</strong></a></p><p id="8883" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们应该会看到如下所示的新窗口。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/45cbd9f07f833f38e4c0f0d36ba791ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFpQ4cdnExSXUrnACW86Aw.png"/></div></div></figure><p id="e3e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令安装<strong class="ih hj"> Python 3.8 </strong>。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="a214" class="mc km hi ly b fi md me l mf mg">sudo apt update<br/>sudo apt-get install python3.8 python3.8-dev python3.8-distutils python3.8-venv</span></pre><p id="78b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令安装<strong class="ih hj">虚拟环境</strong>。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="cb0f" class="mc km hi ly b fi md me l mf mg">python3.8 -m venv /home/ubuntu/venv/</span></pre><p id="2ff1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令安装<strong class="ih hj"> gcc </strong>。这是可选的。如果你因为缺少gcc而遇到错误，它会有所帮助。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="9b95" class="mc km hi ly b fi md me l mf mg">sudo apt-get install gcc</span></pre><p id="6c9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令，在虚拟环境下安装<strong class="ih hj">轮</strong>和<strong class="ih hj"> uwsgi </strong>。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="6b5e" class="mc km hi ly b fi md me l mf mg">source /home/ubuntu/venv/bin/activate<br/>pip install wheel<br/>pip install uwsgi</span></pre><p id="7ee7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装这个Django项目所需的<strong class="ih hj">其他库</strong>。然后停用虚拟环境。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="d5e7" class="mc km hi ly b fi md me l mf mg">pip install -r /home/ubuntu/project_codebase/requirements.txt</span></pre><p id="1f3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建<strong class="ih hj"> uwsgi_params </strong>文件。路径和内容如下。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="7413" class="mc km hi ly b fi md me l mf mg">nano /home/ubuntu/uwsgi_params</span></pre><p id="371b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">内容:</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="0f49" class="mc km hi ly b fi md me l mf mg">uwsgi_param  QUERY_STRING       $query_string;<br/>uwsgi_param  REQUEST_METHOD     $request_method;<br/>uwsgi_param  CONTENT_TYPE       $content_type;<br/>uwsgi_param  CONTENT_LENGTH     $content_length;</span><span id="46b0" class="mc km hi ly b fi mh me l mf mg">uwsgi_param  REQUEST_URI        $request_uri;<br/>uwsgi_param  PATH_INFO          $document_uri;<br/>uwsgi_param  DOCUMENT_ROOT      $document_root;<br/>uwsgi_param  SERVER_PROTOCOL    $server_protocol;<br/>uwsgi_param  REQUEST_SCHEME     $scheme;<br/>uwsgi_param  HTTPS              $https if_not_empty;</span><span id="7520" class="mc km hi ly b fi mh me l mf mg">uwsgi_param  REMOTE_ADDR        $remote_addr;<br/>uwsgi_param  REMOTE_PORT        $remote_port;<br/>uwsgi_param  SERVER_PORT        $server_port;<br/>uwsgi_param  SERVER_NAME        $server_name;</span></pre><p id="a2b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令创建<strong class="ih hj"> /run/uwsgi/ </strong>文件夹。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="2f25" class="mc km hi ly b fi md me l mf mg">sudo mkdir /run/uwsgi/<br/>sudo chown ubuntu:ubuntu /run/uwsgi/</span></pre><p id="1371" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令安装<strong class="ih hj"> Nginx </strong>。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="6126" class="mc km hi ly b fi md me l mf mg">sudo apt-get install nginx</span></pre><p id="4f0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的路径中创建<strong class="ih hj"> mysite.nginx.conf </strong>文件，并填写如下内容。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="a705" class="mc km hi ly b fi md me l mf mg">sudo nano /etc/nginx/sites-available/mysite.nginx.conf</span></pre><p id="c9c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">内容:</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="675d" class="mc km hi ly b fi md me l mf mg">upstream django {<br/>    server unix:///run/uwsgi/mysite.sock;<br/>}<br/>server {<br/>    listen      80;<br/>    server_name 54.193.19.108;<br/>    charset     utf-8;</span><span id="1077" class="mc km hi ly b fi mh me l mf mg">location = /favicon.ico { access_log off; log_not_found off; }<br/>    location /static {<br/>        alias /var/www/mysite/assets/;<br/>    }</span><span id="d9a0" class="mc km hi ly b fi mh me l mf mg">location / {<br/>        uwsgi_pass  django;<br/>        include     /home/ubuntu/uwsgi_params;<br/>    }<br/>}</span></pre><p id="400a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，server_name是EC2实例的IPv4地址。</p><p id="2303" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建指向<strong class="ih hj"> mysite.nginx.conf </strong>文件的符号链接，以便nginx进程可以找到。重启Nginx以反映变化。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="762c" class="mc km hi ly b fi md me l mf mg">sudo ln -s /etc/nginx/sites-available/mysite.nginx.conf /etc/nginx/sites-enabled/<br/>sudo systemctl restart nginx</span></pre><p id="d8d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，我们应该能够通过运行如下命令在虚拟环境下启动Django项目。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="49d8" class="mc km hi ly b fi md me l mf mg">uwsgi --socket /run/uwsgi/mysite.sock --chdir /home/ubuntu/project_codebase/ --module mysite.wsgi --chmod-socket=666</span></pre><p id="513a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应该打印以下日志。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/ad7203b519df0def342db54232d9b4a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvCIMrmp6J7ZdAjOqkkbSw.png"/></div></div></figure><p id="1c85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们应该能够浏览这个网站，并看到如下页面。显然css、image和javascript还没有加载。因为我们没有收集静态文件。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es mi"><img src="../Images/0abdd302cc72822518beff0eae133ec1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*LginPSD29Vx48zNa-EqloQ.png"/></div></figure><p id="061d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行以下命令创建<strong class="ih hj"> mysite </strong>静态文件夹。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="f113" class="mc km hi ly b fi md me l mf mg">sudo mkdir /var/www/mysite<br/>sudo chmod 777 /var/www/mysite</span></pre><p id="62c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行以下命令收集虚拟环境下的静态文件。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="595c" class="mc km hi ly b fi md me l mf mg">python /home/ubuntu/project_codebase/manage.py collectstatic</span></pre><p id="8b78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们应该会看到以下消息。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/712bd4dd63414e300e7dbed93a9c530d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zsGLIAbuNRuxciR96oI8pw.png"/></div></div></figure><p id="96d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行以下命令创建uwsgi文件夹。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="4a25" class="mc km hi ly b fi md me l mf mg">sudo mkdir -p /etc/uwsgi/sites</span></pre><p id="f467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行以下命令创建uwsgi日志文件夹。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="32a7" class="mc km hi ly b fi md me l mf mg">sudo mkdir /var/log/uwsgi/<br/>sudo chmod 666 /var/log/uwsgi/</span></pre><p id="5820" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建uwsgi <strong class="ih hj"> myproject.ini </strong>文件。路径和内容应该如下所示。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="f4c1" class="mc km hi ly b fi md me l mf mg">sudo nano /etc/uwsgi/sites/myproject.ini</span></pre><p id="18a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">内容:</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="f207" class="mc km hi ly b fi md me l mf mg">[uwsgi]<br/>chdir = /home/ubuntu/project_codebase/<br/>module = mysite.wsgi<br/>home = /home/ubuntu/venv/<br/>master = true<br/>processes = 10<br/>socket = /run/uwsgi/mysite.sock<br/>chmod-socket = 666<br/>vacuum = true<br/>logto = /var/log/uwsgi/%n.log<br/>logfile-chown = %(uid):%(uid)<br/>logfile-chmod = 666</span></pre><p id="ceb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行如下命令重新启动服务器。实例将在几分钟后重新启动。之后重新连接。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="4d3d" class="mc km hi ly b fi md me l mf mg">sudo reboot</span></pre><p id="8780" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建<strong class="ih hj"> uwsgi.service </strong>文件。文件路径和内容应该如下所示。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="f53c" class="mc km hi ly b fi md me l mf mg">sudo nano /etc/systemd/system/uwsgi.service</span></pre><p id="6aac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">内容:</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="aaa9" class="mc km hi ly b fi md me l mf mg">[Unit]<br/>Description=uWSGI Emperor service</span><span id="9202" class="mc km hi ly b fi mh me l mf mg">[Service]<br/>ExecStartPre=/bin/bash -c 'mkdir -p /run/uwsgi; chown ubuntu:www-data /run/uwsgi'<br/>ExecStart=/home/ubuntu/venv/bin/uwsgi --emperor /etc/uwsgi/sites<br/>Restart=always<br/>KillSignal=SIGQUIT<br/>Type=notify<br/>NotifyAccess=all</span><span id="7f3b" class="mc km hi ly b fi mh me l mf mg">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="b7ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行以下命令检查配置语法。</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="e3dd" class="mc km hi ly b fi md me l mf mg">sudo nginx -t</span></pre><p id="5144" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切配置正确，它应该显示以下消息。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es mj"><img src="../Images/d7bdf88072cc3bfa18805bd6ee97c45e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUVL7horZWdYfUAQNKrQIw.png"/></div></div></figure><p id="b6a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动<strong class="ih hj"> nginx </strong>和<strong class="ih hj"> uwsgi </strong></p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="daf9" class="mc km hi ly b fi md me l mf mg">sudo systemctl restart nginx<br/>sudo systemctl start uwsgi</span></pre><p id="ceef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切顺利，您可以通过键入以下命令使这两个服务在启动时自动启动:</p><pre class="jt ju jv jw fd lx ly lz ma aw mb bi"><span id="ff87" class="mc km hi ly b fi md me l mf mg">sudo systemctl enable nginx<br/>sudo systemctl enable uwsgi</span></pre><p id="7b41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们应该能够再次浏览网站，并看到如下完全加载的页面。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/baccb6ad036a7f7d07714fb834bd6625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Knm-11SKo87BT1O9RLAF1g.png"/></div></div></figure></div><div class="ab cl ke kf gp kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hb hc hd he hf"><h1 id="0805" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="44b9" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">恭喜你。您已经在云服务器上启动了Django项目。为了说明关键组件，我在下图中添加了文件/目录路径。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lq"><img src="../Images/8dd24f4d5ebbe9dbdbe360d84ea8c8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLicCLtwasa8bF7f0eiaZA.png"/></div></div></figure><p id="8b77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这篇文章能解除您对部署的困扰。当然，您需要细化每个组件来提高性能。这个教程再深入挖掘就有点过了。请不要犹豫留下你的评论。</p><p id="de92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，我在本文中使用的示例项目是上传到GitHub上的。链接如下。</p><p id="12bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/slow999/DjangoAndAWSEC2Deployment" rel="noopener ugc nofollow" target="_blank">https://github.com/slow999/DjangoAndAWSEC2Deployment</a></p><p id="3194" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你对视频教程感兴趣，请查看我下面的视频。</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="bd38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读。敬请关注。</p></div></div>    
</body>
</html>