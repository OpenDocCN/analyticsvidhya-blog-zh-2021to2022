<html>
<head>
<title>Analyzing Chess Positions with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python分析国际象棋的位置</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/analyzing-chess-positions-with-python-26d73b7c892?source=collection_archive---------6-----------------------#2021-02-07">https://medium.com/analytics-vidhya/analyzing-chess-positions-with-python-26d73b7c892?source=collection_archive---------6-----------------------#2021-02-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3401" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下棋时，我发现我的棋落在相似的位置。这是故意的。专注于几个不同的空位有助于提高你的比赛，因为你会一遍又一遍地看到相同的位置。但我一直很好奇，更普遍地说，棋子的常见和不常见位置是由什么构成的。为了找到答案，我开始用Python和chess.py分析一年的国际象棋比赛。</p><p id="cdf4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://github.com/matteson/chess-positions/tree/main" rel="noopener ugc nofollow" target="_blank">将</a>链接到该项目的Git回购。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9d7d323b744ec60754f8e33bb1523d0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iebaqYRIigvrIVSplDxsg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">由<a class="ae jc" href="https://unsplash.com/@roketpik?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Artur Shamsutdinov </a>在<a class="ae jc" href="https://unsplash.com/s/photos/chess-tournament?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="1baa" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">分析的初始目标</h2><p id="068b" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">一盘国际象棋是由棋手移动定义的棋盘位置序列。如果我随机下一盘棋，并随机停止它，那么棋子更有可能在某些地方。从直觉上来说，一个王在棋盘上一直游荡，比他安全地留在自己的起始位置上的可能性要小。</p><p id="3904" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在国际象棋中，有6个棋子，2种颜色，8个等级和8个档。将这些相乘，我们得到总共768个可能的棋子位置。作为最初的目标，我想找出这768个位置中的每一个出现在从国际象棋数据库中选择的随机棋盘位置中的概率。</p><p id="acf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有了目标，下一步就是“获取大量数据”</p><h2 id="4809" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">解析大量国际象棋游戏</h2><p id="fb87" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">当我第一次开始探索国际象棋的位置时，我为可移植游戏符号(PGN)文件编写了自己的解析器。如果你想知道解析国际象棋符号工作的细节，请查看我关于这个主题的文章。随着我工作的扩展，我决定使用<a class="ae jc" href="https://python-chess.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> chess.py </a>，因为它提供了PGN解析以及对导出董事会职位的支持。</p><p id="d389" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本周我在国际象棋中从<a class="ae jc" href="https://theweekinchess.com/twic" rel="noopener ugc nofollow" target="_blank">下载了14个月的国际象棋锦标赛数据。我们的工作流程将是:</a></p><ol class=""><li id="9087" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated">加载PGN文件。</li><li id="d9ef" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">迭代游戏。</li><li id="e189" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">迭代每一步棋，导出棋盘位置。</li><li id="ffeb" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">将游戏格式转换成可以用数字处理的格式。</li></ol><p id="fff9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Chess.py通过导出到<a class="ae jc" href="https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation" rel="noopener ugc nofollow" target="_blank">Forsyth-Edwards-Notation</a>(FEN)为步骤1-3提供现成的支持。FEN是一个描述性的字符串，列出了棋盘上每个棋子的位置。为了便于分析，我们想将这个字符串转换成棋盘的<a class="ae jc" href="https://en.wikipedia.org/wiki/One-hot" rel="noopener ugc nofollow" target="_blank">一键编码</a>。一位热码是一个768位的向量，表示某个棋子位置是否出现在棋盘上(如下图所示)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/5047d3dcc897d87c50c81462195a0102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*UyEHa37AMmcJwkY3C3V8iA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">国际象棋位置的一键编码(作者)</figcaption></figure><pre class="je jf jg jh fd li lj lk ll aw lm bi"><span id="432f" class="jt ju hh lj b fi ln lo l lp lq"># Find the function fentohot in the linked Git repository.</span><span id="66b3" class="jt ju hh lj b fi lr lo l lp lq">import chess</span><span id="faa3" class="jt ju hh lj b fi lr lo l lp lq"># Load the first game<br/>pgn = open('twic980.pgn')<br/>game = chess.pgn.read_game(pgn)</span><span id="5ff0" class="jt ju hh lj b fi lr lo l lp lq"># Iterate through the moves of the game outputting the board.<br/>board = game.board()<br/>for move in game.mainline_moves():<br/>  board.push(move)<br/>  hot = fentohot(board.fen()).reshape((768,))<br/>  positions[:, iter] = hot<br/>  iter = iter + 1</span></pre><p id="ec72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在链接Git repo中，我循环了60个PGN文件中的所有游戏。我总共有1460万多一点的棋局头寸要分析。</p><h2 id="821e" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">初始统计和可视化</h2><p id="f6bc" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">从这些数据中，我们可以找到某个特定棋子位置出现在随机棋盘位置的概率。从这里，我们可以问这样的问题，什么是常见的工件位置？什么不常见？并由此产生一些概率的可视化</p><p id="f936" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">排除非法位置(一级和八级的棋子)，最不常见的位置是a1上的黑王(13000个位置中的1个)，其次是a8上的白王(9800个位置中的1个)。最常见的棋子位置是f7上的黑卒(1.6位置中的1)。概率有助于一些美好的形象化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ls"><img src="../Images/8dd5ea837550e9f9f0a564d215b65ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDY1i68wSL0PDGg601Jxiw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">棋子位置的概率(按作者)</figcaption></figure><h2 id="a425" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">我将何去何从</h2><p id="a5af" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在我工作的下一阶段，我正在寻找位置共现。总的来说，我从信息论的角度来描述整个董事会。如果你想看更多，请跟我来！</p></div></div>    
</body>
</html>