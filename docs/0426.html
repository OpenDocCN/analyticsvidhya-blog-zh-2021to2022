<html>
<head>
<title>Apache Spark Applications with Amazon EMR and S3 Services using Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jupyter笔记本的Apache Spark应用程序与Amazon EMR和S3服务</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/apache-spark-applications-with-amazon-emr-and-s3-services-using-jupyter-notebook-41968a1c2d7?source=collection_archive---------7-----------------------#2021-01-16">https://medium.com/analytics-vidhya/apache-spark-applications-with-amazon-emr-and-s3-services-using-jupyter-notebook-41968a1c2d7?source=collection_archive---------7-----------------------#2021-01-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="bd3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">技术每天都在发展，甚至每秒钟都在不停地发展，它也在许多不同的方面改善着我们的生活。在20世纪90年代，1兆字节的芯片ram容量对于Amiga 500游戏电脑来说是一场巨大的革命，这样我们甚至可以玩街头霸王或真人快打这样的流行游戏😀有这种能力。</p><p id="e393" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些年来发生了很多变化，从1mb到petabytes，甚至到Exabytes……根据CSIRO的说法，在未来十年，天文学家预计每小时将处理来自SKA望远镜的10pb数据。这确实是一个巨大而令人兴奋的发展，包括一个非常重要的问题；</p><p id="896c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将如何处理海量数据？</p><p id="04ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好的，好的，不要惊慌，我们还有第二个引擎😀(是的，我实际上是一名飞行员)。玩笑归玩笑，如今许多公司都有非常大的数据中心或服务器来访问计算能力和存储等服务。除此之外，这些类型的服务可以通过基于时间或基于功率的定价在互联网上按需交付，我们称之为“云计算”。</p><p id="4e06" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用云计算服务比购买和维护物理数据中心和服务器更实惠、更高效。</p><p id="66c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还有一些比较知名的云计算服务，比如亚马逊Web服务，微软Azure，谷歌云平台。今天，我们将在Jupyter笔记本上使用AWS进行Spark应用。</p><h1 id="6ba1" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">什么是AWS？</h1><p id="7595" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">AWS (Amazon Web Services)是亚马逊提供的高度可扩展、全面、快速、可靠和用户友好的完整云计算平台。它也是最受欢迎的，因为它是云计算世界的第一个代表。AWS提供了许多工具，如VPC、EC2、EMR和S3。你可以从AWS网页轻松注册，无需支付任何费用。</p><p id="bfe3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天，我们将在示例中使用AWS EMR和S3服务。所以让我们更好地了解这些服务。</p><h1 id="4521" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">什么是EMR？</h1><p id="48c2" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Amazon Elastic MapReduce (EMR)是一个Amazon Web Services (AWS)平台，使用Apache Spark、Apache Hive、Apache HBase、Apache Flink和Presto等著名的开源工具进行大数据处理和分析。EMR为Pb级的大数据提供可扩展、灵活和快速的计算。</p><h1 id="bfbe" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">什么是S3？</h1><p id="f771" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">亚马逊简单存储服务(亚马逊S3)为互联网提供对象存储服务，旨在存储来自任何来源的数据(高达5tb的单个文件),并提供可扩展性、数据可用性、安全性和性能。此外，亚马逊声称S3提供了99.99%的耐用性和99.99%的可用性。</p><p id="7789" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">到目前为止，我试图向您简要介绍云计算、AWS及其组件EMR和S3。现在是动手练习的时候了，以便更好地理解AWS与我们心爱的Jupyter笔记本的用法。</p><p id="1744" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">* * *重要提示</strong>:请记住，AWS是一家付费服务提供商，在您注册并定义您的信用卡后，AWS将为您提供一种现收现付的定价方式。作为新会员，您还可以享受一些免费服务，但无论如何，只要您在服务运行时不花费太多时间，并且在完成计算后不要忘记终止服务，使用EMR服务的价格将非常低(我的例子中不到1美元)。在我们完成示例后，我将向您展示如何终止服务。</p><p id="0c13" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以让我们开始我们的例子；</p><p id="d64f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注册AWS后，我们将从AWS管理控制台的“存储”列表中选择S3服务。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/9fff14a9ceb5a71b6257eb15b1469d11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJiF4CvsT8R7TRn4lrNchQ.jpeg"/></div></div></figure><p id="88b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在S3控制台中，我们将选择“Create bucket”按钮，只需为它命名(您可以将其余部分保留为默认值),然后单击页面底部的“Create bucket ”,就可以轻松创建我们的S3 bucket。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/3583ca740c28a8bc5608d6288269ec76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-tj9wlJOwRlUIcSpTclZw.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/d5005bbd1c5d62717a8144bafa7fcf46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fy3uFgjz_GSqQ6HVFEhRiw.png"/></div></div></figure><p id="3996" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们已经创建了我们的S3桶。您可以从S3控制台选择新创建的存储桶，并在其中上传数据文件。我将为我们的示例上传2个数据文件(u.data和u.item)。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/9af39e8c2dd1e854e0bb744f884ee3f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTsmX_j_u3A1Ukc7OdjAag.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kt"><img src="../Images/2cfef18ddf9098218d44176c8e5ea4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVo1NGQ_pS6kyanByeisDw.png"/></div></div></figure><p id="da6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们成功上传了将用于Spark应用程序的数据文件。现在我们可以返回到AWS管理控制台，这次我们将从“分析”列表中选择EMR工具。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ku"><img src="../Images/8b930124047fb378766c2c87313ff2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PzOr1U2gtD23zaZRT5qEsA.jpeg"/></div></div></figure><p id="44d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在EMR控制台中，我们将选择“创建集群”按钮，并开始创建我们的EMR集群。我们将首先为我们的群集命名，然后选择软件配置。我会选择兼容Jupyter笔记本的“emr-5.30.1”版本。我们还会选择硬件配置。通常我们必须根据我们要处理的数据大小来指定它，但是今天我们将为我们的示例选择一个足够大的值(m4.xlarge)。我还将选择“在没有EC2密钥对的情况下继续”(您可以随时在EC2控制台中创建EC2密钥对)，并单击最后的“创建集群”按钮。</p><p id="0f55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们在群集页面中看到“正在运行”时，我们将拥有新的EMR群集。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/6324b904fe65eba19ea63eead8e88959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VFXu_DE65lLONd20iDnuIw.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/5339061f00ca1556f4f0f3df0f63ebe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Hayf5ZuET63PQQ3iG6auA.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/01447e220c8e7ae1534c9b925149fcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bKZ8oEl_rFx9_p0DHRttkw.png"/></div></div></figure><p id="0e0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以返回到EMR控制台，我们将看到我们的集群已经创建完毕，正在等待我们。到目前为止，我们已经创建了我们的S3桶和EMR集群。现在是时候创建我们的笔记本了。</p><p id="8dbf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从左侧菜单中选择“笔记本”，在新页面中，我们将配置我们的笔记本。首先，我们将命名它并选择我们现有的EMR集群。我们还将选择保存笔记本文件的S3存储桶。最后，我们将单击“创建笔记本”按钮，当我们在控制台上看到“就绪”消息时，我们将拥有我们的笔记本。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kv"><img src="../Images/7d35177e9b3e57553240155a2079ae3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dzl4AX9cDDD9aKYRndETEg.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kw"><img src="../Images/51297dc127ac4e025e620aab52a48bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ArXvQJcIAUV4B6HlwCYFug.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kx"><img src="../Images/95390dd179f6a5f4d21ad1e2aa960bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wra3QR82TvYZ6eRjoNFQUg.png"/></div></div></figure><p id="9fd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">恭喜你！！！现在，我们已经拥有了Spark应用程序所需的所有工具。我们已经创建了用于获取数据并保存回数据的S3存储桶、用于使用Apache Spark的EMR集群和用于打开Jupyter笔记本的笔记本。</p><p id="af46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择“在Jupyter中打开”按钮后，我们会看到一些熟悉的东西，让我们感觉又回到了甜蜜的家😀</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/4d1616d437fa380d63ca4b9c8af0fee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Ib_VH_vjuOoxSDs703drA.png"/></div></div></figure><p id="95db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们选择笔记本并开始编写SparkSql查询，同时不要忘记从“kernel”菜单中选择Pyspark内核。</p><p id="af77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于我们的例子，我将做一些非常简单的事情。我们有两个关于电影的数据文件。我会试着找出评分最高的电影及其名称，并在最后加入2个文件，以找出其平均评分。就像我上面提到的，我将使用SparkSQL api进行查询。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/e0c7813f314881db4fcf388e8dfce119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehblndDXA8dOD1hAyJUxBQ.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ky"><img src="../Images/2c17c8c85f025246ca84e11163963554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jyqa87w9sFDY3dtbSZjj9w.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kz"><img src="../Images/d087a430e59052876b9426fc2cb87504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yh-Bnz5zRkqAti2kOa9fYg.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es la"><img src="../Images/760713f64c6fa510d967e8c585a3318b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5Q3tYuMa3GvZZg29vfoQg.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lb"><img src="../Images/351d3e94be8e7c58fc77cd1348f59cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhzfXtdiD8Rf5bvo4ZgGfQ.png"/></div></div></figure><p id="7310" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当然是《星球大战》😀…因此，我们进行了查询，还创建了一个新的数据帧，并将其保存回我们的S3存储桶。让我们从S3控制台再次检查我们的铲斗。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lc"><img src="../Images/29eb6c5f3cda34a31d2c6c7c991a9261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*whovc13m9p1RZvGggPWaAw.png"/></div></div></figure><p id="5b4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如您在上面的截图中看到的，我们设法将数据保存到我们的bucket中，作为一个CSV文件。</p><p id="b6b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以我们已经完成了我们的项目，除了一件更重要的事情；终止我们的EMR集群。</p><p id="437c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们完成任务后，终止集群是非常重要的。否则AWS会继续定价。在EMR控制台中，勾选我们已经创建的EMR集群，然后选择“终止”按钮。短时间内会终止，不会说；我会回来的！！！😀</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/d41efe00b15316ca9523aa618c69cfa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*INDEn3E9KxkPbQVdCqOUYw.png"/></div></div></figure><p id="f8ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，你也可以停止你的笔记本(笔记本是不付费的)，并从S3控制台删除你的S3桶。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/17af5e2def3386683cd2fc913bd814f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uV6_bc63v_gJSuGiENNuoA.jpeg"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ld"><img src="../Images/611b9c6a58634893eeb7b821b29c3602.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkfLY6gVRl8fzXIQTFS4UA.jpeg"/></div></div></figure><h1 id="9ddc" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="cf26" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在本文中，我尝试简要介绍了如何通过Jupyter Notebook将AWS用于Spark应用程序。AWS中还有许多更有用的工具，您可以通过在AWS网页中搜索<a class="ae kf" href="https://docs.aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>来提高自己的知识。</p><p id="800f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望这篇文章对你有所帮助。在下一篇文章中，我将讲述如何在本地创建和运行Spark独立集群。</p><p id="b7aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我将很高兴听到您的任何意见或问题。愿数据伴随你！</p></div></div>    
</body>
</html>