<html>
<head>
<title>Scraping and analyzing tweets in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">抓取和分析R中的tweets</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-and-analyzing-tweets-in-r-62582e2f4543?source=collection_archive---------2-----------------------#2021-01-31">https://medium.com/analytics-vidhya/scraping-and-analyzing-tweets-in-r-62582e2f4543?source=collection_archive---------2-----------------------#2021-01-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="838c" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">学习从twitter上抓取数据，并用R</h2></div><p id="15c9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">2021年1月是美国政治史上的一个重要月份，原因有很多。首先，因为乔·拜登被宣布赢得2020年美国总统大选。二是因为数百名特朗普支持者冲击国会大厦，以示对唐纳德·特朗普的支持。第三，因为Covid疫苗接种于1月份开始推广。在所有这些事件中，全球政治领导人都发布了大量关于周围发生的事件的推文。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/eb0a0110b78b21a18388cd8b4f81a708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fQLdrESOOQMbF_5kDq1izw.png"/></div></div></figure><p id="5c8d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个分析项目中，让我们试着从twitter上抓取Joe Biden上个月的推文，并通过将它们分成不同的主题来进行主题建模。</p><h2 id="5aeb" class="ke kf hh bd kg kh ki kj kk kl km kn ko jf kp kq kr jj ks kt ku jn kv kw kx ky bi translated">步骤1:从Twitter获取API访问权限</h2><p id="9609" class="pw-post-body-paragraph iw ix hh iy b iz kz ii jb jc la il je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">为了从twitter上抓取数据，您首先需要在这里创建一个twitter开发者帐户<a class="ae le" href="https://developer.twitter.com/en" rel="noopener ugc nofollow" target="_blank"/>。一旦完成，你就获得了访问推文的授权码。同样的详细说明可以在<a class="ae le" href="https://cran.r-project.org/web/packages/rtweet/vignettes/auth.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="84ba" class="ke kf hh lg b fi lk ll l lm ln">my_authorization &lt;- rtweet::create_token(app = "your app name",<br/> consumer_key = "your consumer key",<br/> consumer_secret = "your consumer secret", access_token="your access token", access_secret = "Your access secret")</span></pre><h2 id="1067" class="ke kf hh bd kg kh ki kj kk kl km kn ko jf kp kq kr jj ks kt ku jn kv kw kx ky bi translated">第二步:抓取推文</h2><p id="ff2e" class="pw-post-body-paragraph iw ix hh iy b iz kz ii jb jc la il je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">使用上面生成的授权代码，我们从Jo Biden的twitter帐户中抓取推文，并保存在一个. csv文件中。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="b67d" class="ke kf hh lg b fi lk ll l lm ln">biden_tweets &lt;- rtweet::get_timeline(c("joebiden"), n = 3000, parse=T, token=my_authorization)<br/>rtweet::write_as_csv(biden_tweets, "biden_tweets.csv", prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")</span></pre><p id="2859" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以检查一下。csv文件，看到有3000行(由我们指定)和90个不同的列，如日期，推文创建，推文文本，标签，转发次数等细节。</p><h2 id="655c" class="ke kf hh bd kg kh ki kj kk kl km kn ko jf kp kq kr jj ks kt ku jn kv kw kx ky bi translated">第三步:分析推文</h2><p id="3ebd" class="pw-post-body-paragraph iw ix hh iy b iz kz ii jb jc la il je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">然后使用readtext库中的readtext函数读取csv文件。Readtext库使导入各种格式的文本文件变得更加容易，并返回一个易于操作的数据框。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="4c1b" class="ke kf hh lg b fi lk ll l lm ln">bidenTexts &lt;- readtext::readtext("biden_tweets.csv", text_field = "text")<br/>dim(bidenTexts)</span></pre><p id="ebe1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们检索5条最受欢迎且转发次数最多的推文。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="ce29" class="ke kf hh lg b fi lk ll l lm ln">head(bidenTexts[order(-bidenTexts$retweet_count), 'text' ],5)</span></pre><p id="5d6f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们得到以下答案:-</p><p id="4f53" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[1]“美国，我很荣幸你们选择我来领导我们伟大的国家。\ n \我们面前的工作将是艰难的，但我向你们保证:我将是所有美国人的总统——无论你们是否投票给我。\ n \ nI我会保持你对我的信任。【https://t.co/moA9qhmjn8】<br/>【2】【我们做到了，<a class="ae le" href="http://twitter.com/JoeBiden" rel="noopener ugc nofollow" target="_blank"> @JoeBiden </a>。https://t.co/oCgeylsjB4美国新的一天开始了。本周国会大厦遇袭后，我想对我的美国同胞和世界各地的朋友们说。<a class="ae le" href="https://t.co/blOy35LWJ5" rel="noopener ugc nofollow" target="_blank">https://t.co/blOy35LWJ5</a><br/>【5】“我不敢相信我不得不这么说，但是请不要喝漂白剂。"</p><p id="7112" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">类似地，我们可以分析数据帧来检索被标记为最大次数收藏的推文。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="d824" class="ke kf hh lg b fi lk ll l lm ln">head(bidenTexts[order(-bidenTexts$favorite_count), 'text'], 5)</span></pre><p id="201d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[1]“这是美国新的一天。”“美国，我很荣幸你选择我来领导我们伟大的国家。\ n \我们面前的工作将是艰难的，但我向你们保证:我将是所有美国人的总统——无论你们是否投票给我。\ n \ nI我会保持你对我的信任。<a class="ae le" href="https://t.co/moA9qhmjn8" rel="noopener ugc nofollow" target="_blank">https://t.co/moA9qhmjn8</a><br/>【3】“保持信念，伙计们。我们会赢的。<br/> [4]“唐纳德·川普是我们有史以来最糟糕的总统。”<br/>【5】“美国回来了。"</p><h2 id="165d" class="ke kf hh bd kg kh ki kj kk kl km kn ko jf kp kq kr jj ks kt ku jn kv kw kx ky bi translated">第四步:找到最常用的单词和话题</h2><p id="b25c" class="pw-post-body-paragraph iw ix hh iy b iz kz ii jb jc la il je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">我们首先为推文创建一个语料库。corpus函数将每条tweet转换成文档，并具有文档中标记的数量、类型、用户id、文本宽度等特征。我们可以使用summary命令获得所有特性的列表。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="275d" class="ke kf hh lg b fi lk ll l lm ln">#create a corpus<br/>bidenCorpus&lt;-quanteda::corpus(bidenTexts)<br/>summary(bidenCorpus)<br/>dfmbiden &lt;- dfm(bidenCorpus, remove = c(stopwords("english")),<br/>                remove_punct = TRUE, remove_numbers = TRUE,    remove_symbol = TRUE,tolower=T)</span></pre><p id="4569" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，我们使用dfm函数将语料库转换为文档特征矩阵，该矩阵表示文档的特征计数。在文档特征矩阵中，语料库被转换成稀疏矩阵，该稀疏矩阵具有与语料库中的文档一样多的行以及与语料库中的单词一样多的特征。如果某个单词出现在文档中，则用它在文档中出现的次数来表示，否则为0。在这样做的同时，我们也删除了停用词，如“如果”，“安”等，并删除了符号，数字和标点符号。</p><p id="9bd6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了查看拜登在他的推文中使用最多的词，我们可以使用库quanteda中的textplot_wordcloud函数绘制一个词云。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="fb84" class="ke kf hh lg b fi lk ll l lm ln">set.seed(111)<br/>quanteda::textplot_wordcloud(dfmbiden, max_words = 150, color = RColorBrewer::brewer.pal(8, "Dark2"))</span></pre><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/1ecca6c43fee3859cb30377e46292de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*dnt548t3NtOYBs0NBKG6Mw.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">乔·拜登推文中最常用词的词云</figcaption></figure><p id="2400" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们尝试做主题建模，将推文分成不同的主题。为此，我们首先为每个主题定义一个包含示例单词的字典。我们为此分析定义了10个主题。不属于这些主题的推文将被划分为“其他”。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="66f6" class="ke kf hh lg b fi lk ll l lm ln">dict &lt;- dictionary(list(capitol_attack = c("attack", "responsibility", "capitol", "shame", "storming"),<br/>        cabinet = c("cabinet", "minister", "advisory"),<br/>        education = c("school", "education"),<br/>        employment = c("job", "right", "wage","employment"),<br/>        winning = c("victory", "win", "thank", "america","great", "back", "proud"),<br/>        economy = c("poverty","crisis", "society", "job*", "rent", "relief" ),<br/>        war = c("war", "soldier*", "nuclear"),<br/>        crime = c("crime*", "murder", "killer", "violence"),<br/>        corona = c("covid-19", "corona", "pandemic", "virus", "mask", "vaccine"),<br/>        trump = c("trump", "donald","president", "law" )))</span></pre><p id="5bda" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们现在使用库seededlda中的textmodel_seededlda()来实现半监督潜在Dirichlet分配(seeded-LDA)。不用深入算法的细节，知道这个算法把文本分成预定义的主题就够了。我们通过将seeded_lda模型拟合到上面定义的dfm来做到这一点。然后，我们可以检查每个主题的热门词汇。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="60f2" class="ke kf hh lg b fi lk ll l lm ln">slda &lt;- textmodel_seededlda(dfmbiden_tfidf, dict, residual = TRUE)<br/>topwords_biden &lt;- as.data.frame(seededlda::terms(slda, 20))</span></pre><p id="f316" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我们将这样识别的主题存储到数据框的“主题”列中。之后，我们将语料库中每个主题的频率列表，并为其创建一个比例表。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="025a" class="ke kf hh lg b fi lk ll l lm ln">bidenTweets$topic &lt;- seededlda::topics(slda)</span><span id="b267" class="ke kf hh lg b fi lt ll l lm ln">#tabulate frequencies of each topic in your corpus:<br/>topics_table &lt;-ftable(bidenTweets$topic)<br/>topicsprop_table &lt;- as.data.frame(prop.table(topics_table))</span></pre><p id="10cc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我们需要做的是根据比例表中的频率来绘制主题。</p><pre class="jt ju jv jw fd lf lg lh li aw lj bi"><span id="d1df" class="ke kf hh lg b fi lk ll l lm ln">ggplot(data=topicsprop_table, aes(x=Var1, y=Freq)) + <br/>  geom_bar(stat = "identity") +<br/>  labs (x= "Topics", y = "Topic %")+<br/>  labs(title = "Topic proportions - Biden") +<br/>  theme(axis.text.x = element_text(face="bold", <br/>                                   size=10, angle=45,hjust = 1))</span></pre><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es lo"><img src="../Images/e6e546ca4b99cbcc5275f297fdd718c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*jhGl4Bj8O0dHjmFnCa12-g.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx translated">乔·拜登推文的主题比例</figcaption></figure><p id="1e2f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以从上面的条形图中看到，在乔·拜登1月份发布的3000条推文中，最多的(13%)是关于他赢得选举的，其次是新冠肺炎(11%)和经济(9%)。</p></div><div class="ab cl lu lv go lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ha hb hc hd he"><p id="bd93" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇文章中，我们学会了从twitter应用程序中抓取推文，并根据它们被转发或成为最爱的次数来分析它们。我们还学习了绘制单词云和主题建模。这篇文章的详细代码可以在这个<a class="ae le" href="https://github.com/hgarg01/biden_tweets" rel="noopener ugc nofollow" target="_blank">链接</a>上找到。</p><p id="e653" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你喜欢这篇文章，请不要忘记鼓掌并关注。</p></div></div>    
</body>
</html>