<html>
<head>
<title>PCA and How to Interpret it— with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PCA以及如何用Python解释它</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pca-and-how-to-interpret-it-with-python-8aa664f7a69a?source=collection_archive---------2-----------------------#2021-07-02">https://medium.com/analytics-vidhya/pca-and-how-to-interpret-it-with-python-8aa664f7a69a?source=collection_archive---------2-----------------------#2021-07-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4858" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">主成分分析用于降维，找出变量协变的方式。</p><p id="c2eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在机器学习(ML)和人工智能(AI)领域，有两种处理数据的基本方法:有监督的和无监督的机器学习。与监督学习相反，在监督学习中，我们用数据来训练模型，而在非监督学习中，我们不用。因此，监督技术主要是为预测而设计的。对于无监督学习，由于没有基础事实/标签，我们主要使用它进行描述性分析。换句话说，无监督学习用于知识发现。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/25cd5005aecbbef7d2d43dccd4504922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVX7LwA-v7ziskn7ilu0gw.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><a class="ae js" href="https://www.spiria.com/en/blog/artificial-intelligence/face-recognition-by-principal-component-analysis/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="e7a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">无监督学习可以用来实现不同的目标。在某些情况下，它可用于在没有标记反应的情况下创建预测规则[1]。在其他情况下，目标可能是<em class="jt">将数据的维度</em>减少到一组更易于管理的变量。减少的数据然后可以被馈送到用于预测目的的监督学习算法中。</p><h1 id="54be" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">主成分分析</h1><p id="eb91" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">主成分分析作为一种无监督的方法，主要用于发现数值变量协变的方式。它用于线性组合不同的特征。因此，以类似方式变化的特征/变量可以用一个组合变量来表示。通过这种方式，我们降低了数据维度，这可能会导致清晰的解释和预测目的的低复杂性。通过主成分分析，我们实际上找到了变量的加权线性组合形式</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kx"><img src="../Images/e2667b607028d9422b2155809bedb3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*rWK7Fv25yWxJDS9lNilkGA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">加权线性组合</figcaption></figure><p id="e44a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中<em class="jt"> i </em>的范围从1到变量总数。重量称为部件载荷。这些将原始变量转换成主要成分。第一个主成分，<em class="jt"> Z </em> 1，是最佳解释总变异的线性组合。第二个主成分，Z<em class="jt">2，与第一个主成分正交，并尽可能多地解释剩余的变化。(如果有额外的组件，每个额外的组件将与其他组件正交)[1]。</em></p><h1 id="fa09" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">PCA的Python实现</h1><p id="30f1" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">为了展示主成分分析在现实世界问题中的应用，我们将主成分分析应用于一个股票市场数据集。完整的数据集可以从<a class="ae js" href="https://www.kaggle.com/szrlee/stock-time-series-20050101-to-20171231" rel="noopener ugc nofollow" target="_blank"> Kaggle网站</a>下载。它由30家DJIA公司中的29家的多种股票价格组成(不包括“V ”,因为它没有完整的12年数据)。我们将利用<em class="jt"> Sci-kit Learn </em>包来实现股票回报的PCA。完整的代码可以在<a class="ae js" href="https://www.kaggle.com/vahidnaghshin/pcacorrespondenceanalysis" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="98c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为第一步，我们将计算所有公司每只股票的每日回报率。</p><pre class="jd je jf jg fd ky kz la lb aw lc bi"><span id="9f10" class="ld jv hh kz b fi le lf l lg lh">dic_stock_return = defaultdict(int)<br/>for dirname, _, filenames in os.walk('/kaggle/input'):<br/>    for filename in filenames:<br/>        print(os.path.join(dirname, filename))<br/>        df = pd.read_csv(os.path.join(dirname, filename))<br/>        df['return'] = (df.Close - df.Open) / df.Open<br/>        dic_stock_return[df.Name[0]] = df['return']</span><span id="e82d" class="ld jv hh kz b fi li lf l lg lh">df_stock_return = pd.DataFrame(dic_stock_return)<br/>df_stock_return.head()</span></pre><p id="cdbf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该数据帧的前5行如下:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lj"><img src="../Images/69b27bcb839414ae8308a5c941370fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IilbGiWf4TdPxC8k_Fd6mA.png"/></div></div></figure><pre class="jd je jf jg fd ky kz la lb aw lc bi"><span id="f766" class="ld jv hh kz b fi le lf l lg lh">#drop last row since it is NaN<br/>tech_px = tech_px.drop(3019)</span><span id="cbb7" class="ld jv hh kz b fi li lf l lg lh">pcs = PCA(n_components=2)<br/>pcs.fit(tech_px)<br/>loadings = pd.DataFrame(pcs.components_, columns=tech_px.columns)<br/>print(loadings)</span></pre><p id="bc51" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">负载将为</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lk"><img src="../Images/3a30714623ba53fa88ef35019422ebcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*9R2O96T-XnSP5nkbkIqcoQ.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">古尔和AAPL的五氯苯甲醚负荷</figcaption></figure><p id="0117" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jt">如何解读这个</em>？第一个主成分基本上是谷歌和AAPL的平均值，反映了两家能源公司之间的相关性。第二个主要因素衡量谷歌和AAPL的股价何时出现分歧。为了可视化主成分分析，我们可以使用以下python代码。</p><pre class="jd je jf jg fd ky kz la lb aw lc bi"><span id="fe7d" class="ld jv hh kz b fi le lf l lg lh">def abline(slope, intercept, ax):<br/>    """Calculate coordinates of a line based on slope and intercept"""<br/>    x_vals = np.array(ax.get_xlim())<br/>    return (x_vals, intercept + slope * x_vals)</span><span id="4721" class="ld jv hh kz b fi li lf l lg lh">ax = tech_px.plot.scatter(x='GOOGL', y='AAPL', alpha=0.3, figsize=(14, 14))<br/>ax.set_xlim(-0.2, 0.2)<br/>ax.set_ylim(-0.2, 0.2)<br/>ax.plot(*abline(loadings.loc[0, 'AAPL'] / loadings.loc[0, 'GOOGL'], 0, ax),<br/>        '--', color='C1')<br/>ax.plot(*abline(loadings.loc[1, 'AAPL'] / loadings.loc[1, 'GOOGL'], 0, ax),<br/>        '--', color='C1')</span><span id="69f5" class="ld jv hh kz b fi li lf l lg lh">plt.tight_layout()<br/>plt.show()</span></pre><p id="5f60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输出将是</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ll"><img src="../Images/75b9eceb24b9f6a186d1be15032b0c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hq7FHkydSFtVI10WiDMgZA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">虚线表示的PCA</figcaption></figure><p id="2092" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于所有公司，五氯苯甲醚的成分含量可通过以下方式获得</p><pre class="jd je jf jg fd ky kz la lb aw lc bi"><span id="7bcf" class="ld jv hh kz b fi le lf l lg lh">#remove rows with at least one NaN values<br/>nan_rows = df_stock_return[df_stock_return.isnull().T.any()]<br/>df_stock_return = df_stock_return.drop(list(nan_rows.index))</span><span id="5557" class="ld jv hh kz b fi li lf l lg lh">syms = sorted(['MMM', 'AXP', 'AAPL', 'BA', 'CAT', 'CVX', 'CSCO', 'KO', 'DIS', 'XOM', 'GE',<br/>               'GS', 'HD', 'IBM', 'INTC', 'JNJ', 'JPM', 'MCD', 'MRK', 'MSFT', 'NKE', 'PFE',<br/>               'PG', 'TRV', 'UTX', 'UNH', 'VZ', 'WMT', 'GOOGL', 'AMZN', 'AABA'])<br/>top_df = df_stock_return[syms]</span><span id="6d01" class="ld jv hh kz b fi li lf l lg lh">sp_pca = PCA()<br/>sp_pca.fit(top_df)</span><span id="d135" class="ld jv hh kz b fi li lf l lg lh">explained_variance = pd.DataFrame(sp_pca.explained_variance_)</span><span id="da0b" class="ld jv hh kz b fi li lf l lg lh">#showing the first value<br/>ax = explained_variance.head(10).plot.bar(legend=False, figsize=(8, 4))<br/>ax.set_xlabel('Component')</span><span id="86e2" class="ld jv hh kz b fi li lf l lg lh">plt.tight_layout()<br/>plt.show()</span></pre><p id="e2d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">组件的前10个解释差异如下</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lm"><img src="../Images/a34e58d9493ef148e7d8c5d6e8241b9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*M0qRWxd3CNKyaFwEOJDC8A.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">解释了前十个组件的差异</figcaption></figure><p id="7199" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于前5个组件的加载，我们有</p><pre class="jd je jf jg fd ky kz la lb aw lc bi"><span id="ad8e" class="ld jv hh kz b fi le lf l lg lh">loadings = pd.DataFrame(sp_pca.components_[0:5, :], <br/>                        columns=top_df.columns)<br/>maxPC = 1.01 * np.max(np.max(np.abs(loadings.loc[0:5, :])))</span><span id="5a4c" class="ld jv hh kz b fi li lf l lg lh">f, axes = plt.subplots(5, 1, figsize=(15, 10), sharex=True)</span><span id="c90c" class="ld jv hh kz b fi li lf l lg lh">for i, ax in enumerate(axes):<br/>    pc_loadings = loadings.loc[i, :]<br/>    colors = ['C0' if l &gt; 0 else 'C1' for l in pc_loadings]<br/>    ax.axhline(color='#888888')<br/>    pc_loadings.plot.bar(ax=ax, color=colors)<br/>    ax.set_ylabel(f'PC{i+1}')<br/>    ax.set_ylim(-maxPC, maxPC)</span><span id="4948" class="ld jv hh kz b fi li lf l lg lh">plt.tight_layout()<br/>plt.show()</span></pre><p id="575f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">前5种成分的载荷可以表示为</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ln"><img src="../Images/7622bea269fae19edd15f4eaf4627d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ljxCJVdxlcAM-i8CnbOMQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">前五个组件的加载</figcaption></figure><h1 id="fe00" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">如何解读PCA？</h1><p id="ac3b" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">第一个主成分的负荷具有相同的符号:这对于所有列共享一个公共因子(在这种情况下，是整个股票市场趋势)的数据是典型的。第二个组成部分捕捉科技股相对于其他股票的价格变化。第三个因素主要是摩根大通(JP Morgan)和高盛(Goldman Sachs)的走势对比。第四部分对比了联合健康(UNH)和其他能源股的走势。最后，第五个组成部分主要由非科技公司主导。</p><h1 id="0fcc" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">参考</h1><p id="4f0a" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">[1]布鲁斯、彼得、安德鲁·布鲁斯和彼得·格德克。<em class="jt">数据科学家实用统计学:使用R和Python的50多个基本概念</em>。奥莱利媒体，2020。</p></div></div>    
</body>
</html>