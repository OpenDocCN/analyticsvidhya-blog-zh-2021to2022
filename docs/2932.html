<html>
<head>
<title>ML model deployment with Flask using AWS EC2 - PART II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS EC2的带烧瓶的ML模型部署-第二部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ml-model-deployment-with-flask-using-aws-ec2-part-ii-38ca941e0c4b?source=collection_archive---------4-----------------------#2021-05-26">https://medium.com/analytics-vidhya/ml-model-deployment-with-flask-using-aws-ec2-part-ii-38ca941e0c4b?source=collection_archive---------4-----------------------#2021-05-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c31e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第一部分中，我们已经看到了如何构建模型、设计HTML/CSS页面并最终在localhost上运行它。在第二部分中，我们将展示如何通过10个简单的步骤在webhost上部署它(使用Amazon EC2)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/89b7ea2f8de0187544ebe237e5015815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ldMOEzZH7SIG9ObV7ZNEpw.jpeg"/></div></div></figure><p id="0533" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">先决条件是，您必须在完成第一部分后创建以下内容:</p><ul class=""><li id="4c7e" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated"><em class="jy"> 'loan.py' </em>(这将构建模型并生成pickle文件)</li><li id="60ce" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated"><em class="jy"> 'loan_approval.pkl' </em>(泡菜文件)</li><li id="e715" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated"><em class="jy"> 'index.html' </em>(前端文件)</li><li id="2427" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated"><em class="jy"> 'app.py' </em>(后端文件，构成Flask app)</li><li id="1dc7" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated"><em class="jy"> 'requirements.txt' </em>(拥有运行项目所需的所有库的列表)</li></ul><h1 id="eddd" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">1.<strong class="ak">在EC2上创建实例</strong></h1><ul class=""><li id="bbce" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">转到<a class="ae jc" href="https://us-east-2.console.aws.amazon.com/ec2/v2/home?region=us-east-2" rel="noopener ugc nofollow" target="_blank"> EC2仪表板</a>。</li><li id="6881" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated">单击实例。</li><li id="a1be" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated">单击启动实例。</li><li id="3be8" class="jp jq hh ig b ih jz il ka ip kb it kc ix kd jb ju jv jw jx bi translated">第一步，选择一个亚马逊机器镜像<strong class="ig hi">(</strong>AMI)——选择Ubuntu Server 18.04。单击下一步。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/706d8e41d5d0374531e00206ef432653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qROAQzjA44Odghaf"/></div></div></figure><ul class=""><li id="f61b" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">在步骤2中选择实例类型—<em class="jy">‘T2 . micro’</em>。单击下一步。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/d18ee745082bde2f7ee42f64a26c6941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y2i60X12hXBHTS13"/></div></div></figure><ul class=""><li id="02f8" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">忽略第3、4步，在第5步单击添加标签。关键:<em class="jy">‘贷款’</em>，数值:<em class="jy">‘贷款标签’</em>。单击下一步。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lj"><img src="../Images/5edf2eb0034e242a7d4506543663a1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*40UMSqH9Gjsw9ju-"/></div></div></figure><ul class=""><li id="65c4" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">在第6步中，将安全组名称更改为<em class="jy">‘sgloantag’</em>。单击查看并启动。</li></ul><h1 id="3add" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">2.<strong class="ak">投放实例</strong></h1><ul class=""><li id="54a2" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">单击启动。创建密钥对名称- <em class="jy"> 'kploantag' </em>。下载密钥对。将PEM文件保存在桌面上的新文件夹(名称:deploy)中。单击启动实例。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lk"><img src="../Images/105929a8404ea603b026765cc85b0e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2WBQbh_dJqOxcAj-"/></div></div></figure><ul class=""><li id="403b" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">转到查看实例并为实例添加一个名称-<em class="jy">‘loan’</em>。它应该显示运行。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/2cb6466e4107585c497bcc5d3b90bfd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e06VaIk_6h0gdkqi"/></div></div></figure><ul class=""><li id="c3e2" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">现在单击实例id。转到安全选项卡。单击安全组链接。编辑入站规则-&gt;添加规则:自定义TCP |端口:5000 |源:0.0.0.0/0 |保存规则。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/d4c97e620a71910535bbc6d170684481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RP16ez_z7rMk_HAR"/></div></div></figure><h1 id="f51e" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">3.<strong class="ak">准备好目录</strong></h1><ul class=""><li id="7401" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">转到包含项目文件的文件夹(名称:loanproject)。它应该包含:dataset，app.py，requirements.txt，pkl文件，包含html文件的模板文件夹。将项目文件夹压缩为loanproject.zip。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/ca4832e3de0e1f25c7d1ed0134deb51f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*yFG-HVrTI7tJHgls"/></div></figure><ul class=""><li id="59fe" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">转到保存PEM文件的文件夹(名称:deploy)。复制loanproject.zip并将其粘贴到PEM文件所在的同一文件夹中。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lo"><img src="../Images/8d23ac913fb4952fcf42cc2ba1a2eee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/0*GgjeqrwxrTj7Se7E"/></div></figure><h1 id="33bb" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">4.<strong class="ak">检查连接环节</strong></h1><ul class=""><li id="2540" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">转到EC2上的实例页面，选择实例，然后选择连接。下面的屏幕将出现。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/d64f3d97f065118df011ebfd8f8b493c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T71Okl4fM6rbIgL1"/></div></div></figure><p id="540a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面图像的最后一行将用于连接到服务器。</p><p id="6bea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第四行将用于在浏览器上查看项目UI。</p><h1 id="6023" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">5.<strong class="ak">检查实例摘要</strong></h1><ul class=""><li id="e291" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">单击实例名称，检查实例摘要详细信息是否良好(如图所示)。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/68305a67d684f3d7f47e4526b12aba0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-WmdpJwLbDXHgV5T"/></div></div></figure><h1 id="5205" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">6.<strong class="ak">连接到实例</strong></h1><ul class=""><li id="ac91" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">从该文件夹打开PowerShell，方法是转到地址栏并键入Powershell，在它启动后，运行以下命令:</li></ul><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="ebcf" class="lw kf hh ls b fi lx ly l lz ma">&gt; scp -i kploantag.pem loanproject.zip ubuntu@ec2-18-191-25-39.us-east-2.compute.amazonaws.com:</span></pre><p id="0576" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述命令会将我们的文件发送到web服务器。我们也可以使用WinSCP/FileZilla/PuTTY来代替<code class="du mb mc md ls b">scp</code>命令。</p><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="2fae" class="lw kf hh ls b fi lx ly l lz ma">&gt; ssh -i "kploantag.pem" ubuntu@ec2-18-191-25-39.us-east-2.compute.amazonaws.com</span></pre><p id="8d7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将有助于连接到服务器。</p><h1 id="9853" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">7.<strong class="ak">获取服务器上的文件</strong></h1><p id="21a5" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip me ir is it mf iv iw ix mg iz ja jb ha bi translated">运行以下命令。</p><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="f4e8" class="lw kf hh ls b fi lx ly l lz ma">&gt; dir</span><span id="dee4" class="lw kf hh ls b fi mh ly l lz ma">&gt; sudo apt install zip unzip</span><span id="a968" class="lw kf hh ls b fi mh ly l lz ma">&gt; unzip loanproject.zip</span><span id="1901" class="lw kf hh ls b fi mh ly l lz ma">&gt; cd loanproject</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/fbd8e6438af00b144841e4b78cb8e910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A3PACBz37TOATvE7"/></div></div></figure><h1 id="f8e6" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">8.准备好<strong class="ak">环境</strong></h1><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="9359" class="lw kf hh ls b fi lx ly l lz ma">&gt; sudo apt-get update</span><span id="8da9" class="lw kf hh ls b fi mh ly l lz ma">&gt; sudo apt-get install -y python3-pip</span><span id="cb37" class="lw kf hh ls b fi mh ly l lz ma">&gt; pip3 install -r requirements.txt</span></pre><p id="e9bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">“requirements.txt”包含运行项目所需的所有库。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mj"><img src="../Images/f6f1bac07ab9b072c05c5383cd799090.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/0*-dIZPt1duPNFaxsg"/></div></figure><p id="d421" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果在运行最后一段代码时出现任何错误，请检查哪个库安装失败，然后手动安装，如下所示:</p><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="b16f" class="lw kf hh ls b fi lx ly l lz ma">&gt; pip3 install numpy</span></pre><p id="8c2a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我的例子中，我必须手动安装flask和sklearn以及numpy。这主要是由于版本兼容性问题。</p><h1 id="ce46" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">9.运行脚本</h1><ul class=""><li id="524b" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">最后运行python文件app.py:</li></ul><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="899c" class="lw kf hh ls b fi lx ly l lz ma">&gt; python3 app.py</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/21ce5bfdfa0173f31466f4c88949381d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ggV_-U1ry5NlAAK3"/></div></div></figure><p id="4ed4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">服务器已启动并正在运行。如果它失败了，就会抛出错误。</p><h1 id="e484" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">10.<strong class="ak">运行在浏览器上</strong></h1><ul class=""><li id="d95e" class="jp jq hh ig b ih lc il ld ip le it lf ix lg jb ju jv jw jx bi translated">通过连接到实例转到SSH客户端页面，并复制链接以运行。这个网址对于不同的用户是不同的。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ml"><img src="../Images/544abaa21e40baebae7633a968cc9b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mIcyiZWlzeM57CyW74a_w.png"/></div></div></figure><ul class=""><li id="f7e1" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">转到浏览器，粘贴连接到实例后得到的链接。注意，我们需要在末尾追加port-&gt;:5000/</li></ul><p id="fc73" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">粘贴并在浏览器上运行:</p><pre class="je jf jg jh fd lr ls lt lu aw lv bi"><span id="afc5" class="lw kf hh ls b fi lx ly l lz ma">http://ec2-18-191-25-39.us-east-2.compute.amazonaws.com:5000/</span></pre><p id="6bc7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是正在运行的web应用程序和用户输入的一些内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/c5a5752bc98c4d96da3646598ecde3dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nsM4KF6vgIe4sV2h"/></div></div></figure><p id="7a6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是底部的结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/06964a54f489cacc7998358bc762ba86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oBTcqADYI6I2M-uO"/></div></div></figure><h1 id="e6e6" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">结论</h1><p id="3fc9" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip me ir is it mf iv iw ix mg iz ja jb ha bi translated">因此，我们终于成功部署了该应用程序。一旦我们输入值，并点击提交按钮，屏幕将显示输出，如果贷款将为用户批准与否。</p><p id="83de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢阅读我的文章！如果你喜欢我的文章吗👏。</p><p id="7d30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该项目的完整代码，请查看<a class="ae jc" href="https://github.com/hrisav/loan-acceptance" rel="noopener ugc nofollow" target="_blank"> Github链接</a>。</p><p id="ca68" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过<a class="ae jc" href="https://www.linkedin.com/in/hrisav/" rel="noopener ugc nofollow" target="_blank">链接的</a>与我联系，获取更多更新，或者如果你被困在任何地方。</p></div></div>    
</body>
</html>