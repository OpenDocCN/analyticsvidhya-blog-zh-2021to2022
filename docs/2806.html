<html>
<head>
<title>Using scikit-learn model into Java app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Java应用程序中使用scikit-learn模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-scikit-learn-model-into-java-app-96d776b84c44?source=collection_archive---------5-----------------------#2021-05-18">https://medium.com/analytics-vidhya/using-scikit-learn-model-into-java-app-96d776b84c44?source=collection_archive---------5-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1c08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将长代码库从一种编程语言迁移到另一种编程语言通常是一个挑战，有时甚至没有意义。如果您正在使用Java，并且需要应用scikit-learn的机器学习模型，本教程可能会对您有所帮助。</p><p id="4b70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将使用3个库:scikit-learn、sklearn2pmml和pllm4s。为了帮助管理数据，我们还使用了其他库，但如果需要，您可以替换它们。</p><h1 id="a06b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">代码看起来像什么</h1><p id="01a9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">为了导出模型，我们有简单的步骤，如下所述。在这个例子中，我们在<em class="kg"> PMMLPipeline </em>类中使用回归器，但是如果你想的话，你也可以使用分类器。不要忘记将<em class="kg"> scikit-learn </em>和<em class="kg"> sklearn2pmml </em>添加到您的python项目依赖项中。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="093a" class="kq je hi km b fi kr ks l kt ku">from sklearn.datasets import load_diabetes<br/>from sklearn.tree import DecisionTreeRegressor<br/>from sklearn2pmml import PMMLPipeline, sklearn2pmml<br/>import pandas as pd</span><span id="544a" class="kq je hi km b fi kv ks l kt ku"># fetching data example<br/>df = load_diabetes()<br/>X = pd.DataFrame(columns = df.feature_names, data = df.get('data'))<br/>y = pd.DataFrame(columns = ['target'], data = df.get('target'))</span><span id="2813" class="kq je hi km b fi kv ks l kt ku"># here you can use the key classifier, if suitable<br/>pipeline = PMMLPipeline([ ('regressor', DecisionTreeRegressor()) ])</span><span id="a22e" class="kq je hi km b fi kv ks l kt ku">#training the model<br/>pipeline.fit(X, y)</span><span id="93be" class="kq je hi km b fi kv ks l kt ku"># exporting the model<br/>sklearn2pmml(pipeline, 'model.pmml', with_repr = True)</span></pre><p id="33e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保将列名添加到数据集中，否则您将无法识别Java代码中的特性。此外，这个例子非常简单，但是如果您有一个复杂的问题，您可以通过查看<a class="ae kw" href="https://github.com/jpmml/sklearn2pmml" rel="noopener ugc nofollow" target="_blank"> SkLearn2PMML文档</a>来使用更多的库功能。</p></div><div class="ab cl kx ky gp kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="hb hc hd he hf"><p id="e345" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Java代码中，做出预测也非常简单。我们在下面展示一个例子。在这个例子中，我们使用的是<a class="ae kw" href="https://github.com/autodeployai/pmml4s" rel="noopener ugc nofollow" target="_blank"> pmml4s库</a>，所以不要忘记添加依赖项。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7a10" class="kq je hi km b fi kr ks l kt ku">import org.pmml4s.model.Model;<br/><br/>import java.util.*;<br/><br/>public class Main {<br/><br/>    private final Model model = Model.fromFile(Main.class.getClassLoader().getResource("model.pmml").getFile());<br/><br/>    public Double getRegressionValue(Map&lt;String, Double&gt; values) {<br/>        Object[] valuesMap = Arrays.stream(model.inputNames())<br/>                .map(values::get)<br/>                .toArray();<br/><br/>        Object[] result = model.predict(valuesMap);<br/>        return (Double) result[0];<br/>    }<br/><br/>    public static void main(String[] args) {<br/>        Main main = new Main();<br/>        Map&lt;String, Double&gt; values = Map.of(<br/>                "age", 20d,<br/>                "sex", 1d,<br/>                "bmi", -100d,<br/>                "bp", -200d,<br/>                "s1", 1d,<br/>                "s2", 2d,<br/>                "s3", 3d,<br/>                "s4", 4d,<br/>                "s5", 5d,<br/>                "s6", 6d<br/>        );<br/><br/>        double predicted = main.getRegressionValue(values);<br/>        System.out.println(predicted);<br/>    }<br/>}</span></pre><p id="431c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个java代码，我们需要的主要方法是<em class="kg"> predict </em>，您可以简单地向它传递一个数组。尽可能地简化代码，但是要注意将这些特性添加到这个数组的顺序，这就是我们使用Map的原因。<em class="kg"> inputNames </em>方法向您展示了您需要遵循的特性输入顺序。</p><h1 id="d98b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">测试它的工作情况</h1><p id="0569" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">出于测试目的，我导出了在Python代码中使用的相同测试数据，并在Java代码中导入。有各种各样的指标可以用来衡量我们的机器学习模型，在这里，使用MAE ( <em class="kg">表示绝对误差</em>)是因为它非常简单和直观。</p><figure class="kh ki kj kk fd lf er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es le"><img src="../Images/78f0d729ff585dc3b7f9c04fe0b61eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-_fiNx3B3J7bTkDEccCrg.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">比较Python和Java中模型的MAE</figcaption></figure><p id="fcf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看上图，我们可以看到两种代码中的MAE是相同的。这意味着我们预测的是相同的值，这只是检查您是否正确导出了模型的一个想法。您还可以使用任何其他指标来确保这一点。</p><p id="1c64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本测试中使用的代码可从以下网址获得:</p><ul class=""><li id="a02c" class="lq lr hi ih b ii ij im in iq ls iu lt iy lu jc lv lw lx ly bi translated">python:<a class="ae kw" href="https://colab.research.google.com/drive/1OFdBfKQrqRpRb0jWZtq7kgv7M3JRfs-o?usp=sharing#scrollTo=DuJq1np-ln1q" rel="noopener ugc nofollow" target="_blank">https://colab . research . Google . com/drive/1 ofdbfkqrprb 0 jwztq 7 kgv 7 m3 jrfs-o？USP = sharing # scroll to = duj q1np-ln1q</a></li><li id="7672" class="lq lr hi ih b ii lz im ma iq mb iu mc iy md jc lv lw lx ly bi translated">Java:<a class="ae kw" href="https://replit.com/@JhonatanSilva3/MachineLearningPipeline#Main.java" rel="noopener ugc nofollow" target="_blank">https://replit . com/@ jhonatansilva 3/machinelingpipeline # main . Java</a></li></ul><p id="1643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这对你有所帮助(:</p></div></div>    
</body>
</html>