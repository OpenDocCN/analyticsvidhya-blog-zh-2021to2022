<html>
<head>
<title>Ubuntu 18.04 to macOS M1 — Developer Review</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Ubuntu 18.04到MAC OS M1——开发者评论</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ubuntu-18-04-to-macos-m1-developer-review-197dee99d80a?source=collection_archive---------7-----------------------#2021-01-20">https://medium.com/analytics-vidhya/ubuntu-18-04-to-macos-m1-developer-review-197dee99d80a?source=collection_archive---------7-----------------------#2021-01-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/0320c9fcda3b6d39f5c17964013c6142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZfNnO621c5uoWPYA"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">马丁·卡特勒在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="ef8b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">标题说明了一切。这只是一个简短的帖子，描述我作为一名机器学习工程师从x86机器上的Ubuntu 18.04切换到苹果芯片上的MacBook Pro的经历。我的观点是，作为一个以前从未使用过mac的人，下面的一些内容也适用于那些想换到旧mac的人，或者从旧MAC换到M1的人。</p><h1 id="9b37" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">规格</h1><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="a63c" class="kz jt hh kv b fi la lb l lc ld">- Machine: Lenovo ThinkPad L390<br/>- OS: Ubuntu 18.04.5<br/>- Processor: Intel® Core™ i7-8565U CPU @ 1.80GHz × 8<br/>- Memory: 16GB<br/>- Disk: 512GB<br/>+ Machine: MacBook Pro (13-inch)<br/>+ OS: macOS Big Sur 11.1<br/>+ Processor: Apple M1<br/>+ Memory: 8GB<br/>+ Disk: 256GB</span></pre><h1 id="99f2" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">末端的</h1><p id="8383" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">不要使用默认的macOS终端，我强烈建议使用<a class="ae it" href="https://iterm2.com/" rel="noopener ugc nofollow" target="_blank"> iTerm2 </a>来代替。它<em class="lj">包含了</em>你永远不会想到终端会有的功能。</p><p id="ea74" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">不过不管用哪个，一定要用<code class="du lk ll lm kv b">Rosetta</code>(其实是Rosetta 2)打开。这应该会自动安装自己，并负责翻译x86代码，使其与Apple Silicon兼容。更详细的说明可以在<a class="ae it" href="https://www.notion.so/Run-x86-Apps-including-homebrew-in-the-Terminal-on-Apple-Silicon-8350b43d97de4ce690f283277e958602" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="9511" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，mac上的默认shell是<code class="du lk ll lm kv b">zsh</code>，而如果你来自Ubuntu，你会习惯于标准的<code class="du lk ll lm kv b">bash</code>。<code class="du lk ll lm kv b">zsh</code>附带了很多<code class="du lk ll lm kv b">bash</code>所没有的很酷的特性，但是如果你想坚持你所知道的，你可以使用以下命令将你的默认shell设置为bash:</p><pre class="kq kr ks kt fd ku kv kw kx aw ky bi"><span id="c092" class="kz jt hh kv b fi la lb l lc ld">chsh -s /bin/bash</span></pre><h1 id="f0b1" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">包管理器</h1><p id="f860" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">你可能会习惯使用<code class="du lk ll lm kv b">apt</code>，但在mac上你应该改用<code class="du lk ll lm kv b">homebrew</code>。假设你已经用Rosetta打开了你的终端，你应该能够按照他们网站上的说明顺利安装<code class="du lk ll lm kv b">homebrew</code>。它的用法和<code class="du lk ll lm kv b">apt</code>很像。</p><h1 id="f44f" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">计算机编程语言</h1><p id="4b60" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">macOS附带了python 2.7安装。如果你和大多数pythonistas一样使用3.x，可以考虑卸载。<strong class="iw hi">请勿卸载。我不知道为什么，但它可以破坏你的整个操作系统。更多信息<a class="ae it" href="https://stackoverflow.com/questions/3819449/how-to-uninstall-python-2-7-on-a-mac-os-x-10-6-4" rel="noopener ugc nofollow" target="_blank">点击这里</a>。就这样吧，在虚拟环境中设置你想要的python。</strong></p><p id="1920" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这一点上，许多人报告了让<code class="du lk ll lm kv b">pyenv</code>(或一般的虚拟环境)在M1上正常工作的问题，并因此在环境中安装了库。我设法通过在我的虚拟环境中使用<code class="du lk ll lm kv b">conda</code>来完全避免这种情况。如果可以避免的话，我倾向于不安装带有<code class="du lk ll lm kv b">conda</code>的包(尽管他们建议),而只在<code class="du lk ll lm kv b">conda</code>环境中使用<code class="du lk ll lm kv b">pip</code>。因此，我的环境或任何库都没有任何问题。</p><h1 id="6010" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">深度学习图书馆</h1><p id="1add" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">假设你已经按照我上面所做的做了，你应该能够安装<code class="du lk ll lm kv b">tensorflow</code>和<code class="du lk ll lm kv b">pytorch</code>，使用<code class="du lk ll lm kv b">pip</code>作为标准没有问题。然而，他们的表现完全是另一回事。</p><h2 id="ba90" class="kz jt hh bd ju ln lo lp jy lq lr ls kc jf lt lu kg jj lv lw kk jn lx ly ko lz bi translated">张量流</h2><p id="3b8f" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">苹果公司好心地提供了一个<code class="du lk ll lm kv b">tensorflow</code>的<a class="ae it" href="https://github.com/apple/tensorflow_macos" rel="noopener ugc nofollow" target="_blank">分支</a>，它已经被调整为在苹果芯片上运行，无需Rosetta。如果你安装了这个版本的<code class="du lk ll lm kv b">tensorflow</code>(而不是如上所述使用pip)，你应该可以享受M1提供的显著加速。</p><p id="a813" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在网上找到各种基准测试M1性能的帖子，但我遇到的最好的一个是<a class="ae it" href="https://towardsdatascience.com/benchmark-m1-vs-xeon-vs-core-i5-vs-k80-and-t4-e3802f27421c" rel="noopener" target="_blank">这个</a>，它比较了苹果的<code class="du lk ll lm kv b">tensorflow</code> fork和GPU上的常规<code class="du lk ll lm kv b">tensorflow</code>。下面的图表(转载自博客帖子)显示了M1如何在使用3种不同批量训练3种不同模型时与英伟达的K80和T4 GPU进行比较。</p><figure class="kq kr ks kt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ma"><img src="../Images/7da850e07b7070bdfa01251d122aac7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*D4r10a-Ew5Gj7m8x.png"/></div></div></figure><p id="499f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从这张图表中，我们可以了解到M1与Nvidia GPUs相比的一些情况:</p><ul class=""><li id="65d2" class="mb mc hh iw b ix iy jb jc jf md jj me jn mf jr mg mh mi mj bi translated">它在小批量时表现更好，大大超过K80，与T4不相上下</li><li id="c15e" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">较大批量的性能提升是非常缓慢的，例如，在训练时，批量增加了4个数量级(32到512 ), LSTM只为M1提供了3倍的加速，而K80和T4都获得了6倍的加速</li><li id="e102" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">它在卷积中的表现相对较差，在批量较大的情况下，它实际上比K80慢得多</li></ul><h2 id="e0af" class="kz jt hh bd ju ln lo lp jy lq lr ls kc jf lt lu kg jj lv lw kk jn lx ly ko lz bi translated">Pytorch</h2><p id="b187" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">不幸的是，<code class="du lk ll lm kv b">pytorch</code>的情况完全不同。没有Apple fork，而且<code class="du lk ll lm kv b">pytorch</code>本身还不支持Apple silicon，所以我们坚持使用Rosetta，这严重影响了我们的性能。github上有很多关于这个的讨论。<a class="ae it" href="https://github.com/pytorch/pytorch/issues/47702" rel="noopener ugc nofollow" target="_blank">这个</a>是关于这个问题的最佳线索。</p><p id="4e54" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我没有任何官方的基准数据，但是根据我目前的经验，<code class="du lk ll lm kv b">pytorch</code>在M1上的表现可以和我以前的机器相媲美。如果有的话，它实际上可能会慢一点，但没有什么重要的。</p><h1 id="4e38" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">VS代码</h1><p id="eeea" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">我大部分时间使用VS代码作为我的IDE。这也不支持M1，所以实际上比我以前的机器要慢得多。并非令人沮丧，只是明显如此。然而，支持已经在前沿版本中引入，称为<a class="ae it" href="https://code.visualstudio.com/insiders/#osx" rel="noopener ugc nofollow" target="_blank"> VS代码内部人员</a>。简单试用后，老实说，我没有发现太大的区别，所以我决定继续使用稳定版本，只等待mac ARM版本。</p><p id="4dfb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">到目前为止，我遇到了一些问题:</p><ul class=""><li id="0f62" class="mb mc hh iw b ix iy jb jc jf md jj me jn mf jr mg mh mi mj bi translated">集成终端卡在前面提到的系统python 2.7上。这似乎也是老款MAC电脑的一个问题。修复它<a class="ae it" href="https://stackoverflow.com/questions/54582361/vscode-terminal-shows-incorrect-python-version-and-path-launching-terminal-from" rel="noopener ugc nofollow" target="_blank">这里</a>。(你只需要修改<code class="du lk ll lm kv b">settings.json</code>)</li><li id="3209" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">python <code class="du lk ll lm kv b">multiprocessing</code>在只使用集成终端时似乎不能正常工作(它崩溃了，出现奇怪的日志)——但是当从普通终端调用运行它的脚本时，它工作得很好。我不确定确切的问题是什么，但我知道我没有使用Linux</li><li id="06a5" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">扩展市场空无一物。不知道这里发生了什么，最终我只是重启解决了问题</li></ul><h1 id="d8c5" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">浏览器</h1><p id="31fd" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">这里的情况相当好。Chrome和其他公司(例如<a class="ae it" href="https://brave.com/" rel="noopener ugc nofollow" target="_blank"> Brave </a>)很快引入了支持，与M1上的x86版本相比，差异是巨大的(可能也比我的旧机器上的x86版本略快)。我使用Brave，M1上的ARM版本和机器自带的原生Safari一样快。</p><h1 id="73e7" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">多方面的</h1><ul class=""><li id="daa8" class="mb mc hh iw b ix le jb lf jf mp jj mq jn mr jr mg mh mi mj bi translated">Ubuntu 18.04随OpenJDK版本11一起安装，非常方便。在mac上不是这样，需要单独安装</li><li id="b6c8" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">Git autocomplete确实可以开箱即用。修复<a class="ae it" href="https://stackoverflow.com/questions/14970728/homebrew-s-git-not-using-completion" rel="noopener ugc nofollow" target="_blank">这里的</a></li><li id="b072" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">没有开箱即用的<code class="du lk ll lm kv b">wget</code>，需要单独安装</li></ul><p id="46bc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，与开发无关，但值得一提的是:</p><ul class=""><li id="34aa" class="mb mc hh iw b ix iy jb jc jf md jj me jn mf jr mg mh mi mj bi translated">电池寿命是。一次充电我可以轻松工作一整天，并且在结束时仍然有足够的电池，这仍然让我感到惊讶。风扇非常安静，也不会发热。</li><li id="5348" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated">显示器是。4k视网膜显示器几乎太放纵了。不是真正的游戏改变者，但它绝对是一个不错的选择</li><li id="a408" class="mb mc hh iw b ix mk jb ml jf mm jj mn jn mo jr mg mh mi mj bi translated"><a class="ae it" href="https://www.alfredapp.com/" rel="noopener ugc nofollow" target="_blank">阿福</a>是。这是一个生产力应用程序，让你的生活更轻松(仅在mac上可用)</li></ul><h1 id="c677" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="16ff" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">如果您刚刚开始使用M1，希望以上内容能够帮助您在开发方面打好基础。谢天谢地，到目前为止，我的体验相当不错，尤其是考虑到早期采用者总会遇到初期问题。</p><p id="bd21" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，如果你仍然在考虑冒险，我可能会建议推迟几个月，因为错误已经解决，更多的应用程序/库(特别是<code class="du lk ll lm kv b">pytorch</code>)将原生支持ARM硬件，因为使用Rosetta确实会显著限制M1性能。</p></div><div class="ab cl ms mt go mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ha hb hc hd he"><p id="212a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lj">原载于2021年1月20日</em><a class="ae it" href="https://amin-nejad.github.io/2021/01/20/ubuntu-to-mac/" rel="noopener ugc nofollow" target="_blank"><em class="lj">https://Amin-nejad . github . io</em></a><em class="lj">。</em></p></div></div>    
</body>
</html>