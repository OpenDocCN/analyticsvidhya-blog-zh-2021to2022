<html>
<head>
<title>Custom Data Catalog Parquet File using Azure Data Factory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure数据工厂的自定义数据目录拼花文件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/custom-data-catalog-parquet-file-using-azure-data-factory-7312f406b662?source=collection_archive---------13-----------------------#2021-02-09">https://medium.com/analytics-vidhya/custom-data-catalog-parquet-file-using-azure-data-factory-7312f406b662?source=collection_archive---------13-----------------------#2021-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="3edf" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">用例</h1><ul class=""><li id="e64a" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">使用ADF构建基于元数据的模式信息抽取</li><li id="a20d" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">解析拼花地板并查找列</li><li id="b956" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">更新数据库以存储详细信息</li><li id="c8d5" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">如果可能的话，提供一个计划的方法</li><li id="4469" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">手动提供拼花文件夹</li></ul><h1 id="93b1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">体系结构</h1><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/b74618fb0b61904d6cea27dfba7fe7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YZDNhq38KiOe8qmW.jpg"/></div></div></figure><h1 id="3083" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件</h1><ul class=""><li id="b808" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">创建Azure帐户</li><li id="5984" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建存储帐户</li><li id="2769" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建Azure数据工厂</li><li id="0fdc" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建Azure SQL</li><li id="0a18" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建函数</li></ul><h1 id="f502" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">数据库ˌ资料库</h1><ul class=""><li id="00f8" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">用列名创建一个表</li><li id="15a8" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建数据库</li><li id="7736" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建适当的访问权限以写入表</li></ul><pre class="kb kc kd ke fd km kn ko kp aw kq bi"><span id="e325" class="kr ig hi kn b fi ks kt l ku kv">Drop table metacolumn; <br/>Create Table metacolumn ( <br/>id bigint IDENTITY(1,1), <br/>filename varchar(200), <br/>columnname varchar(200), <br/>columntype varchar(200) <br/>)</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es kw"><img src="../Images/28ce58b598119ce1c11481edd39ac1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/0*0_XxPCh7kwNGW-iP.jpg"/></div></figure><h1 id="4b6d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">加载样本数据</h1><ul class=""><li id="9777" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">创建存储帐户</li><li id="dc15" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">加载样本数据</li><li id="beb2" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">我创建了名为USpopulationInput\fact的文件夹</li><li id="6ccd" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">加载了几个样本拼花文件</li></ul><h1 id="66e6" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Azure数据工厂</h1><ul class=""><li id="2398" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">创建Azure数据工厂管道</li><li id="f50d" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">我们将使用获取元数据</li><li id="1c06" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">为每个循环创建一个</li><li id="3618" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">总流量</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kx"><img src="../Images/c0773fc351093f25f0abf88f700c6b56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*okX08SkMBWo1BEiA.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ky"><img src="../Images/9d490e29fa01aef8d5a1344157c3cd42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QC4a3q3Fpr8fQlfC.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kz"><img src="../Images/f8c7617b474c8952c311c0c00b066820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_-fftEgMhexyRhiA.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es la"><img src="../Images/4065856fd07d6b4bc4d21463659bd98e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tW3ivzhBsNiN_G1a.jpg"/></div></div></figure><ul class=""><li id="4d38" class="jd je hi jf b jg lb ji lc jk ld jm le jo lf jq jr js jt ju bi translated">选择拼花文件所在的文件夹</li><li id="cc74" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">拖动Foreach并选择选择子项</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lg"><img src="../Images/bd601f9ad9e0704239c7f91c92449a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q8JbuBfMISgQ1KKd.jpg"/></div></div></figure><ul class=""><li id="453a" class="jd je hi jf b jg lb ji lc jk ld jm le jo lf jq jr js jt ju bi translated">现在转到活动</li><li id="49f1" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">每个内装带以下组件</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ky"><img src="../Images/cbc4ae20c55106a04486966f8b78b502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YDYSDsq2cWUUxEaK.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lh"><img src="../Images/d71a50d03bedb6a4f18cb48f878762de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QQ5IjYJig1uDK_91.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es li"><img src="../Images/bd63838bcb0f5cf330bc86ab72a2a383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ju00fqusihnCDAy1.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lj"><img src="../Images/233f85ef657bb924de7f12b5202f33e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ISlFZbw2oOgxsTO9.jpg"/></div></div></figure><pre class="kb kc kd ke fd km kn ko kp aw kq bi"><span id="3cd3" class="kr ig hi kn b fi ks kt l ku kv">@dataset().FileName</span></pre><ul class=""><li id="2e00" class="jd je hi jf b jg lb ji lc jk ld jm le jo lf jq jr js jt ju bi translated">创建新字段</li><li id="0c90" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">一个用于项目名称</li><li id="8e50" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">一个用于项目类型</li><li id="02ec" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">上次修改时间</li><li id="49c6" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">具有列集合的结构</li><li id="d882" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">对于文件名类型</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lk"><img src="../Images/c6ac008c6928037257444dd685f3e5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9MfokF4Dh4slvO3Q.jpg"/></div></div></figure><h1 id="2489" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Azure函数</h1><ul class=""><li id="783f" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">在门户中创建一个名为metafunc1的Azure函数</li><li id="20b0" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">使用Visual Studio代码创建和编码</li></ul><pre class="kb kc kd ke fd km kn ko kp aw kq bi"><span id="4e53" class="kr ig hi kn b fi ks kt l ku kv">using System;<br/>using System.IO;<br/>using System.Threading.Tasks;<br/>using Microsoft.AspNetCore.Mvc;<br/>using Microsoft.Azure.WebJobs;<br/>using Microsoft.Azure.WebJobs.Extensions.Http;<br/>using Microsoft.AspNetCore.Http;<br/>using Microsoft.Extensions.Logging;<br/>using Newtonsoft.Json;<br/>using Newtonsoft.Json.Linq;<br/>using System.Collections.Generic;<br/>using System.Data.SqlClient;</span><span id="6c9c" class="kr ig hi kn b fi ll kt l ku kv">namespace Company.Function<br/>{</span><span id="942f" class="kr ig hi kn b fi ll kt l ku kv">public class metadataItem<br/>    {<br/>        public string name {<br/>            get; set;<br/>        }<br/>        public string type {<br/>            get;<br/>            set;<br/>        }<br/>    }</span><span id="cab5" class="kr ig hi kn b fi ll kt l ku kv">public class metadata<br/>    {<br/>        public string filename {<br/>            get; set;<br/>        }<br/>        public List&lt;metadataItem&gt; name {<br/>            get; set;<br/>        }</span><span id="10ad" class="kr ig hi kn b fi ll kt l ku kv">}</span><span id="6eb8" class="kr ig hi kn b fi ll kt l ku kv">public static class metafunc1<br/>    {</span><span id="3f6d" class="kr ig hi kn b fi ll kt l ku kv">[FunctionName("metafunc1")]<br/>        public static async Task&lt;IActionResult&gt; Run(<br/>            [HttpTrigger(AuthorizationLevel.Function, "get", "post", Route = null)] HttpRequest req,<br/>            ILogger log)<br/>        {<br/>            log.LogInformation("C# HTTP trigger function processed a request.");</span><span id="24af" class="kr ig hi kn b fi ll kt l ku kv">//string name = req.Query["name"];</span><span id="caff" class="kr ig hi kn b fi ll kt l ku kv">string requestBody = await new StreamReader(req.Body).ReadToEndAsync();<br/>            metadata data = JsonConvert.DeserializeObject&lt;metadata&gt;(requestBody);<br/>            <br/>            string connectionString = "Server=tcp:sqlservername.database.windows.net,1433;Initial Catalog=databasename;Persist Security Info=False;User ID=username;Password=xxxxxxx;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;";</span><span id="b88d" class="kr ig hi kn b fi ll kt l ku kv">//JObject body = new JObject&lt;(data);<br/>           <br/>                using(SqlConnection connection = new SqlConnection(connectionString)){<br/>                    // Opening a connection<br/>                    connection.Open();<br/> <br/>                    // Defining the log message and Create Date<br/>                    //var logMessage = $"{name} has logged in.";<br/>                    var createDate = DateTime.UtcNow;</span><span id="6b61" class="kr ig hi kn b fi ll kt l ku kv">foreach(var ea in data.name)<br/>                    {<br/>                         // Prepare the SQL Query<br/>                        var query = $"INSERT INTO [metacolumn] ([filename],[columnname], [columntype]) VALUES('{data.filename}', '{ea.name}', '{ea.type}')";<br/>    <br/>                        // Prepare the SQL command and execute query<br/>                        SqlCommand command = new SqlCommand(query,connection);<br/>    <br/>                        // Open the connection, execute and close connection<br/>                        if(command.Connection.State == System.Data.ConnectionState.Open){<br/>                            command.Connection.Close();<br/>                        }<br/>                        command.Connection.Open();<br/>                        command.ExecuteNonQuery();<br/>                        log.LogInformation("data value. {0} {1}", ea.name, ea.type);<br/>                    }<br/> <br/>                   connection.Close();<br/> <br/>                }<br/>            // Using the connection string to open a connection<br/>            //try{<br/>            //<br/>            //}<br/>            //catch(Exception e){<br/>            //    log.LogError(e.ToString());<br/>                //responseMessage = e.ToString();<br/>            //}</span><span id="fa74" class="kr ig hi kn b fi ll kt l ku kv">string responseMessage = $"Hello, { data.name.Count}. This HTTP triggered function executed successfully.";</span><span id="0324" class="kr ig hi kn b fi ll kt l ku kv">JObject result = new JObject();<br/>            result.Add("result", responseMessage);<br/>            dynamic response = JsonConvert.SerializeObject(result);<br/>            return new JsonResult(result);<br/>        }<br/>    }<br/>}</span><span id="5846" class="kr ig hi kn b fi ll kt l ku kv">dotnet add package System.Data.SqlClient</span></pre><ul class=""><li id="ef2e" class="jd je hi jf b jg lb ji lc jk ld jm le jo lf jq jr js jt ju bi translated">安装其他必要的软件包</li><li id="6bc4" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">部署功能</li><li id="844b" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建资源组</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lm"><img src="../Images/e183c7bad08a48da056351294f9b6793.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pqdTCdtrPtNq_pK6.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ln"><img src="../Images/b3be3173b18b33a1a28d00e6662b7725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lMw1Xbd5jpAlsOg1.jpg"/></div></div></figure><pre class="kb kc kd ke fd km kn ko kp aw kq bi"><span id="93b0" class="kr ig hi kn b fi ks kt l ku kv">{ "name": [ { "name": "decennialTime", "type": "String" }, { "name": "stateName", "type": "String" }, { "name": "countyName", "type": "String" }, { "name": "population", "type": "Int32" }, { "name": "race", "type": "String" }, { "name": "sex", "type": "String" }, { "name": "minAge", "type": "Int32" }, { "name": "maxAge", "type": "Int32" } ] }</span></pre><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ln"><img src="../Images/6767725617d6cec2f7190565662c2319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hs86IkrQiS1xp-yI.jpg"/></div></div></figure><h1 id="1330" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Azure数据工厂</h1><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lk"><img src="../Images/19ea6b1cbc158ff3c9892edc4710a214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1VsIYpO-pMWyWNCR.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lo"><img src="../Images/9a73adec96db2c08a56ce086e3d5797d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LMdYb3lbc00xNCQX.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lp"><img src="../Images/86c4697bfe7df5bfe42687ed557b8b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i7o0_nkpFjHGcLbj.jpg"/></div></div></figure><ul class=""><li id="053f" class="jd je hi jf b jg lb ji lc jk ld jm le jo lf jq jr js jt ju bi translated">拯救管道</li><li id="53ea" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">全部验证</li><li id="cc03" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">发布管道</li><li id="df6e" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">然后转到管道，单击添加触发器并选择立即触发</li><li id="7a5f" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">转到监视器并查看结果</li><li id="1eb4" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">查看作业并选择作业运行以查看详细信息</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lq"><img src="../Images/553ba6eb30581385b86115b94d45c79d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JPXU4FFVl3KukpKV.jpg"/></div></div></figure><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lq"><img src="../Images/cb96244114cb4f30495aac46c4fb39aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Uci_kpMJbBQpPOUf.jpg"/></div></div></figure></div><div class="ab cl lr ls gp lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hb hc hd he hf"><p id="7e91" class="pw-post-body-paragraph ly lz hi jf b jg lb ma mb ji lc mc md jk me mf mg jm mh mi mj jo mk ml mm jq hb bi translated"><em class="mn">最初发表于</em><a class="ae mo" href="https://github.com/balakreshnan/Accenture/blob/master/cap/parquetdatadictadf.md" rel="noopener ugc nofollow" target="_blank"><em class="mn">【https://github.com】</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>