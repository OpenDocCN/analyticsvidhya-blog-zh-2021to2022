<html>
<head>
<title>Extract Tables from pdf and save</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从pdf中提取表格并保存</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/extract-tables-from-pdf-and-save-86b7e1170607?source=collection_archive---------7-----------------------#2021-05-10">https://medium.com/analytics-vidhya/extract-tables-from-pdf-and-save-86b7e1170607?source=collection_archive---------7-----------------------#2021-05-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="c2dd" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用表单识别器—认知服务</h1><p id="92a8" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">从pdf中提取表格和文本信息并保存回存储器。使用Azure函数实现自动化和扩展。</p><h1 id="ac9e" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">体系结构</h1><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es ka"><img src="../Images/671411d4199fa7f4dc6ecf52c8082344.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/0*J6FlTVYdqWLIiqdZ.jpg"/></div></figure><h1 id="9f4b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">步伐</h1><ul class=""><li id="229b" class="ki kj hh je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq bi translated">创建Azure帐户</li><li id="df45" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建存储帐户</li><li id="8ac1" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建pdfinput容器</li><li id="88bc" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建pdfoutput容器</li><li id="2cb3" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建表单识别器</li><li id="304a" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建函数</li></ul><h1 id="fb4c" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">细节</h1><ul class=""><li id="895d" class="ki kj hh je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq bi translated">创建输入容器</li><li id="13a8" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">将输入容器设为blob类型</li><li id="5678" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">未启用Cors</li><li id="70eb" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建输出容器</li><li id="cd40" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">打开Visual Studio代码</li><li id="be83" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">安装Azure功能扩展</li><li id="fec8" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">安装C#</li><li id="6429" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">创建新的功能应用程序</li><li id="f4c7" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">选择Blob触发器并提供pdfinput作为容器名称</li><li id="11c6" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">选择。net 3.0</li><li id="d795" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">为存储选择存储帐户</li><li id="634b" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">安装Azure。来自Nuget的AI.FormRecognizer</li><li id="6379" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">现在编写代码来读取blob pdf并提取表格信息</li></ul><pre class="kb kc kd ke fd kw kx ky kz aw la bi"><span id="5eea" class="lb if hh kx b fi lc ld l le lf">using System;<br/>using System.IO;<br/>using Microsoft.Azure.WebJobs;<br/>using Microsoft.Azure.WebJobs.Host;<br/>using Microsoft.Extensions.Logging;<br/><br/>using Azure;<br/>using Azure.AI.FormRecognizer;  <br/>using Azure.AI.FormRecognizer.Models;<br/>using Azure.AI.FormRecognizer.Training;<br/><br/>using System.Collections.Generic;<br/>using System.Threading.Tasks;<br/>using System.Text;<br/><br/>namespace formprocessing.Function<br/>{<br/>    public static class BlobTriggerCSharp1<br/>    {<br/>        private static readonly string endpoint = "https://cogacctname.cognitiveservices.azure.com/";<br/>        private static readonly string apiKey = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";<br/>        private static readonly AzureKeyCredential credential = new AzureKeyCredential(apiKey);<br/><br/>        [FunctionName("BlobTriggerCSharp1")]<br/>        public async static void Run([BlobTrigger("pdfinputpython/{name}", Connection = "cogstorage_STORAGE")]Stream myBlob, [Blob("pdfoutput/{name}", FileAccess.Write)] Stream outputcsv, string name, ILogger log)<br/>        {<br/>            log.LogInformation($"C# Blob trigger function Processed blob\n Name:{name} \n Size: {myBlob.Length} Bytes");<br/>            var credential = new AzureKeyCredential(apiKey);<br/>            var client = new FormRecognizerClient(new Uri(endpoint), credential);<br/>            string completeuri = "https://cushwakestorage.blob.core.windows.net/pdfinputpython/" + name; <br/><br/>            Uri formUri = new Uri(completeuri);<br/><br/>            //Response&lt;FormPageCollection&gt; response = client.StartRecognizeContentFromUri(formUri);<br/>            Response&lt;FormPageCollection&gt; response = await client.StartRecognizeContentFromUriAsync(formUri).WaitForCompletionAsync();<br/>            //response.Wait();<br/>            FormPageCollection formPages = response.Value;<br/>            <br/><br/>            foreach (FormPage page in formPages)<br/>            {<br/>                Console.WriteLine($"Form Page {page.PageNumber} has {page.Lines.Count} lines.");<br/><br/>                /*<br/>                for (int i = 0; i &lt; page.Lines.Count; i++)<br/>                {<br/>                    FormLine line = page.Lines[i];<br/>                    Console.WriteLine($"  Line {i} has {line.Words.Count} {(line.Words.Count == 1 ? "word" : "words")}, and text: '{line.Text}'.");<br/><br/>                    if (line.Appearance != null)<br/>                    {<br/>                        // Check the style and style confidence to see if text is handwritten.<br/>                        // Note that value '0.8' is used as an example.<br/>                        if (line.Appearance.Style.Name == TextStyleName.Handwriting &amp;&amp; line.Appearance.Style.Confidence &gt; 0.8)<br/>                        {<br/>                            Console.WriteLine("The text is handwritten");<br/>                        }<br/>                    }<br/><br/>                    Console.WriteLine("    Its bounding box is:");<br/>                    Console.WriteLine($"    Upper left =&gt; X: {line.BoundingBox[0].X}, Y= {line.BoundingBox[0].Y}");<br/>                    Console.WriteLine($"    Upper right =&gt; X: {line.BoundingBox[1].X}, Y= {line.BoundingBox[1].Y}");<br/>                    Console.WriteLine($"    Lower right =&gt; X: {line.BoundingBox[2].X}, Y= {line.BoundingBox[2].Y}");<br/>                    Console.WriteLine($"    Lower left =&gt; X: {line.BoundingBox[3].X}, Y= {line.BoundingBox[3].Y}");<br/>                }<br/>                */<br/><br/>                for (int i = 0; i &lt; page.Tables.Count; i++)<br/>                {<br/>                    StringBuilder sb = new StringBuilder();<br/>                    FormTable table = page.Tables[i];<br/>                    Console.WriteLine($"  Table {i} has {table.RowCount} rows and {table.ColumnCount} columns.");<br/>                    string line = "";<br/>                    foreach (FormTableCell cell in table.Cells)<br/>                    {<br/>                        if(cell.ColumnIndex &gt;= (table.ColumnCount - 1))<br/>                        {<br/>                            line = line.TrimEnd(',');<br/>                            sb.AppendLine(line);<br/>                            line = "";<br/>                        }<br/>                        //Console.WriteLine($"    Cell ({cell.RowIndex}, {cell.ColumnIndex}) contains text: '{cell.Text}'.");<br/>                        line += cell.Text + ",";<br/>                    }<br/>                    //sb.AppendLine(line);<br/>                    Console.WriteLine("Table Output : " + sb.ToString());<br/>                }<br/><br/>                /*<br/>                for (int i = 0; i &lt; page.SelectionMarks.Count; i++)<br/>                {<br/>                    FormSelectionMark selectionMark = page.SelectionMarks[i];<br/>                    Console.WriteLine($"  Selection Mark {i} is {selectionMark.State}.");<br/>                    Console.WriteLine("    Its bounding box is:");<br/>                    Console.WriteLine($"      Upper left =&gt; X: {selectionMark.BoundingBox[0].X}, Y= {selectionMark.BoundingBox[0].Y}");<br/>                    Console.WriteLine($"      Upper right =&gt; X: {selectionMark.BoundingBox[1].X}, Y= {selectionMark.BoundingBox[1].Y}");<br/>                    Console.WriteLine($"      Lower right =&gt; X: {selectionMark.BoundingBox[2].X}, Y= {selectionMark.BoundingBox[2].Y}");<br/>                    Console.WriteLine($"      Lower left =&gt; X: {selectionMark.BoundingBox[3].X}, Y= {selectionMark.BoundingBox[3].Y}");<br/>                }<br/>                */<br/>            }<br/><br/>            <br/><br/>            log.LogInformation($"Completed function Processed blob\n Name:{name} \n Size: {myBlob.Length} Bytes");<br/><br/>        }<br/><br/><br/>        <br/><br/>    }<br/>}</span></pre><ul class=""><li id="f06a" class="ki kj hh je b jf lg jj lh jn li jr lj jv lk jz kn ko kp kq bi translated">按F5运行代码</li><li id="8110" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">将pdf上传到pdf输入容器</li><li id="df48" class="ki kj hh je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq bi translated">查看控制台日志中的输出。</li></ul></div><div class="ab cl ll lm go ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ha hb hc hd he"><p id="7c72" class="pw-post-body-paragraph jc jd hh je b jf lg jh ji jj lh jl jm jn ls jp jq jr lt jt ju jv lu jx jy jz ha bi translated"><em class="lv">最初发表于</em><a class="ae lw" href="https://github.com/balakreshnan/Samples2021/blob/main/AzureAI/formProcessing.md" rel="noopener ugc nofollow" target="_blank"><em class="lv">【https://github.com】</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>