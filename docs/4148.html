<html>
<head>
<title>Anonymize PII Data in Spark using Presidio (ML Based)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Presidio匿名化Spark中的PII数据(基于ML)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/anonymize-pii-data-in-spark-using-presidio-ml-based-34164650e410?source=collection_archive---------1-----------------------#2021-09-01">https://medium.com/analytics-vidhya/anonymize-pii-data-in-spark-using-presidio-ml-based-34164650e410?source=collection_archive---------1-----------------------#2021-09-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="46df" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">通过PII使用Azure Databricks匿名化文本</h1><h1 id="9aee" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">用例</h1><ul class=""><li id="86fc" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">能够匿名化数据集中的PII数据</li><li id="cbcf" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">用于数据工程</li><li id="6ec1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">用于机器学习</li></ul><h1 id="302b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="a900" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="5a67" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储帐户</li><li id="81bd" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure数据块</li><li id="11b0" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">安装库</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="78de" class="ki if hh ke b fi kj kk l kl km">presidio-analyzer <br/>presidio-anonymizer</span></pre><h1 id="3b78" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">参考</h1><ul class=""><li id="217b" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">支持的PII实体—<a class="ae kn" href="https://microsoft.github.io/presidio/supported_entities/" rel="noopener ugc nofollow" target="_blank">https://microsoft.github.io/presidio/supported_entities/</a></li><li id="8e6a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Presidio的回购—<a class="ae kn" href="https://github.com/microsoft/presidio/tree/main/docs/samples/deployments/spark" rel="noopener ugc nofollow" target="_blank">https://github . com/Microsoft/presi dio/tree/main/docs/samples/deployments/spark</a></li></ul><h1 id="5e9a" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">火花代码</h1><ul class=""><li id="dae0" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">确认安装了上述presidio库</li></ul><figure class="jz ka kb kc fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ko"><img src="../Images/255f57f137070cdc67754ea781f5819b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0WEOaoeulOTLF22i.jpg"/></div></div></figure><ul class=""><li id="c968" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">现在让我们编写代码</li><li id="6134" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">把所有进口货都带来</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="027e" class="ki if hh ke b fi kj kk l kl km">from presidio_analyzer import AnalyzerEngine<br/>from presidio_anonymizer import AnonymizerEngine<br/>from presidio_anonymizer.entities.engine import OperatorConfig<br/>from pyspark.sql.types import StringType<br/>from pyspark.sql.functions import input_file_name, regexp_replace<br/>from pyspark.sql.functions import col, pandas_udf<br/>import pandas as pd<br/>import os</span></pre><ul class=""><li id="24a4" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">加载样本泰坦尼克号数据集</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="2a2a" class="ki if hh ke b fi kj kk l kl km">df = spark.sql("Select * from default.titanictbl")</span></pre><ul class=""><li id="1d00" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">现在显示数据</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="530c" class="ki if hh ke b fi kj kk l kl km">display(df)</span></pre><figure class="jz ka kb kc fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lb"><img src="../Images/f75ea781b77ea71d05bf52236dcf6160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g04gmzoVKsXV2YdG.jpg"/></div></div></figure><ul class=""><li id="eed5" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">初始化分析仪</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="b06d" class="ki if hh ke b fi kj kk l kl km">analyzer = AnalyzerEngine()<br/>anonymizer = AnonymizerEngine()<br/>broadcasted_analyzer = sc.broadcast(analyzer)<br/>broadcasted_anonymizer = sc.broadcast(anonymizer)</span></pre><ul class=""><li id="5603" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">创建要匿名的UDF</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="082a" class="ki if hh ke b fi kj kk l kl km">def anonymize_text(text: str) -&gt; str:<br/>    analyzer = broadcasted_analyzer.value<br/>    anonymizer = broadcasted_anonymizer.value<br/>    analyzer_results = analyzer.analyze(text=text, language="en")<br/>    anonymized_results = anonymizer.anonymize(<br/>        text=text,<br/>        analyzer_results=analyzer_results,<br/>        operators={"DEFAULT": OperatorConfig("replace", {"new_value": "&lt;ANONYMIZED&gt;"})},<br/>    )<br/>    return anonymized_results.text<br/></span><span id="9efd" class="ki if hh ke b fi lc kk l kl km">def anonymize_series(s: pd.Series) -&gt; pd.Series:<br/>    return s.apply(anonymize_text)<br/></span><span id="1995" class="ki if hh ke b fi lc kk l kl km"># define a the function as pandas UDF<br/>anonymize = pandas_udf(anonymize_series, returnType=StringType())</span></pre><ul class=""><li id="65be" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">设置匿名化列名</li><li id="bdcb" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">只会匿名链接中设置的实体—【https://microsoft.github.io/presidio/supported_entities/ T4】</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="f216" class="ki if hh ke b fi kj kk l kl km">anonymized_column = "Name"</span></pre><ul class=""><li id="b43c" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">现在匿名化数据</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="c2b3" class="ki if hh ke b fi kj kk l kl km"># apply the udf<br/>anonymized_df = df.withColumn(<br/>    anonymized_column, anonymize(col(anonymized_column))<br/>)<br/>display(anonymized_df)</span></pre><figure class="jz ka kb kc fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lb"><img src="../Images/d560a61d0344be94df0d966a44530a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xUo6yhmsVnDm0cAd.jpg"/></div></div></figure></div><div class="ab cl ld le go lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ha hb hc hd he"><p id="a11c" class="pw-post-body-paragraph lk ll hh je b jf kw lm ln jh kx lo lp jj lq lr ls jl lt lu lv jn lw lx ly jp ha bi translated"><em class="lz">原载于</em><a class="ae kn" href="https://github.com/balakreshnan/Samples2021/blob/main/adb/presidiotest.md" rel="noopener ugc nofollow" target="_blank"><em class="lz">https://github.com</em></a><em class="lz">。</em></p></div></div>    
</body>
</html>