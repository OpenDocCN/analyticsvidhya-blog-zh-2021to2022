<html>
<head>
<title>Batch Processing using MaxCompute</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MaxCompute进行批处理</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/batch-processing-using-maxcompute-9f5755fb0d0d?source=collection_archive---------23-----------------------#2021-03-09">https://medium.com/analytics-vidhya/batch-processing-using-maxcompute-9f5755fb0d0d?source=collection_archive---------23-----------------------#2021-03-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="d668" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">MaxCompute如何在电商场景下进行漏斗模型分析？</h2></div><p id="ac03" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">漏斗模型其实是通过各种产品数据的转化率来判断产品运营的工具。转化漏斗就是利用每个阶段数据的转化来确定产品哪里有问题，然后不断优化产品。在电子商务中，漏斗模型是用户购买商品的路径，是从浏览商品到支付订单的每个环节的转换。本文将从用户的“浏览-点击-购买”链接展示漏斗分析和展示。</p><p id="ae98" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">利用阿里云的日志服务、MaxCompute、DataWorks和Quick BI，可以实现批量处理实时电子商务数据以进行漏斗分析的快速管道。</p><ol class=""><li id="b25c" class="js jt hh iy b iz ja jc jd jf ju jj jv jn jw jr jx jy jz ka bi translated">通过阿里云日志服务收集日志数据。</li><li id="7c1c" class="js jt hh iy b iz kb jc kc jf kd jj ke jn kf jr jx jy jz ka bi translated">日志服务的数据同步到大数据计算服务MaxCompute。在MaxCompute中创建ods_user_trace_data.db。</li></ol><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5362" class="kp kq hh kl b fi kr ks l kt ku">CREATE TABLE IF NOT EXISTS ods_user_trace_data <br/>(    <br/>     md5                     STRING,<br/>     uid                     STRING,<br/>     ts                      BIGINT,<br/>     ip                      STRING,<br/>     status                  BIGINT,<br/>     bytes                   BIGINT,<br/>     device_brand            STRING,<br/>     device                  STRING,<br/>     system_type             STRING,<br/>     customize_event         STRING,<br/>     use_time                BIGINT,<br/>     customize_event_content STRING<br/>)  <br/>PARTITIONED BY <br/>(     dt STRING  <br/>);</span></pre><p id="a8e5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">将日志服务收集的增量数据同步到MaxCompute分区表。</p><p id="81ca" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">3.MaxCompute做离线计算。</p><p id="e9f3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">并通过Dataworks，设置定时调度执行，每天凌晨定时取前一天的数据，计算出以天为单位的转化率漏斗图。在DataWorks中创建dw_user_trace_data.db。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3d4b" class="kp kq hh kl b fi kr ks l kt ku">CREATE TABLE IF NOT EXISTS dw_user_trace_data <br/>(    <br/>     uid                     STRING,<br/>     device_brand            STRING,<br/>     device                  STRING,<br/>     system_type             STRING,<br/>     customize_event         STRING,<br/>     use_time                BIGINT,<br/>     customize_event_content STRING<br/>)  <br/>PARTITIONED BY <br/>(     dt STRING  <br/>);</span></pre><p id="7650" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，创建一个应用程序数据服务</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e965" class="kp kq hh kl b fi kr ks l kt ku">CREATE TABLE IF NOT EXISTS rpt_user_trace_data <br/>(    <br/>     browse      STRING,<br/>     click       STRING,<br/>     purchase    STRING,<br/>     browse_rate STRING,<br/>     click_rate  STRING<br/>)<br/>PARTITIONED BY <br/>(<br/>     dt STRING <br/>);</span></pre><p id="e710" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">4.通过阿里云Quick BI可视化数据展示。使用Quick BI，创建一个查询来获取关键营销指标、客户流失和相关统计数据。</p><p id="15e0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">客户旅程如下:</p><blockquote class="kv kw kx"><p id="09e0" class="iw ix ky iy b iz ja ii jb jc jd il je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">浏览-&gt;点击-&gt;购买，每个链接的转化率(转化率=从一个页面进入下一个页面的人数之比)。</p></blockquote><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3ff9" class="kp kq hh kl b fi kr ks l kt ku">INSERT OVERWRITE table rpt_user_trace_data PARTITION (dt=${bdp.system.bizdate}) <br/>SELECT browse as Traffic,<br/>       click as ClickVolume,<br/>       purchase as BuyVolume,<br/>       concat(round((click/browse)*100,2),'%') as ClickRate,<br/>       concat(round((purchase/click)*100,2),'%') as ConversionRate<br/>FROM<br/>(SELECT dt,count(1) browse from dw_user_trace_data where customize_event='browse'   and dt = ${bdp.system.bizdate} group by dt) a <br/>LEFT JOIN (select dt,count(1) click from dw_user_trace_data where customize_event='click'   and dt = ${bdp.system.bizdate} group by dt) b <br/>ON a.dt=b.dt <br/>LEFT JOIN (select dt,count(1) purchase from dw_user_trace_data where customize_event='purchase'  and dt = ${bdp.system.bizdate} group by dt)c  <br/>ON a.dt=c.dt  ;</span><span id="de4b" class="kp kq hh kl b fi lc ks l kt ku">#Select to view a particular date conversion funnel from rpt_user_trace_data that is overwritten<br/>SELECT * FROM rpt_user_trace_data WHERE dt='20210303';</span></pre><figure class="kg kh ki kj fd le er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es ld"><img src="../Images/b63e1d4cc5401878aca87dbc61e45ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFH8q4UDgB8g0Rq-YmF8dA.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">特定日期客户群的漏斗分析</figcaption></figure><p id="0e91" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过Quick BI创建网站用户分析画像仪表盘，实现数据表可视化。从上图我们发现，浏览到点击的业务量呈现出明显的萎缩趋势，转化率较低。分析当前业务流程中哪个环节是薄弱环节，可以帮助人们更加关注薄弱环节，提高整个流程的产出。进而提高整个流程的效率。</p></div></div>    
</body>
</html>