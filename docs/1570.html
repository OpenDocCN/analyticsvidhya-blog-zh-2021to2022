<html>
<head>
<title>Benchmarking fresh produce prices against Talaad Thai (ตลาดไท) with web scraping in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python进行网络抓取，将新鲜农产品价格与泰语talaad(ตลาดไท)进行比较</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/benchmarking-fresh-produce-prices-against-talaad-thai-%E0%B8%95%E0%B8%A5%E0%B8%B2%E0%B8%94%E0%B9%84%E0%B8%97-with-web-scraping-in-python-4b53208ff4c5?source=collection_archive---------34-----------------------#2021-03-07">https://medium.com/analytics-vidhya/benchmarking-fresh-produce-prices-against-talaad-thai-%E0%B8%95%E0%B8%A5%E0%B8%B2%E0%B8%94%E0%B9%84%E0%B8%97-with-web-scraping-in-python-4b53208ff4c5?source=collection_archive---------34-----------------------#2021-03-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1414" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成本管理是经营每一项业务的关键，尤其是经营一家餐馆。成本的急剧上升将转化为利润率的下降，最终导致餐厅管理的螺旋式下降。新鲜农产品被认为是一种商品，它确实可以根据市场上当前的需求和供应而波动。因此，有一个可靠的价格来源来衡量每个供应商的报价是至关重要的。</p><p id="84da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将展示如何从Talaad Thai (ตลาดไท)获取新鲜农产品的价格，然后将其存储在一个现成的excel中，以便与我们的实际成本价进行比较。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="24b9" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">为什么是泰语？</h1><p id="6585" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">在深入研究编码之前，让我们先讨论一下Talaad Thai如何成为一个可靠的基准，以及它在泰国农产品市场中的作用。</p><p id="6926" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">位于泰国巴吞他尼，占地超过214英亩，是亚洲最大的农产品批发市场，Talaad Thai。该市场旨在成为国内和进口产品的集散地。根据泰国塔拉德官方<a class="ae km" href="https://talaadthai.com/" rel="noopener ugc nofollow" target="_blank">网站</a>的数据，通过泰国塔拉德的商品每年价值超过60亿美元(汇率为1美元兑换30泰铢)。这种巨大的市场规模和多种多样的产品加速了价格发现过程，从而创造了一个可靠和可获得的基准价格。</p><h1 id="9d31" class="jj jk hh bd jl jm kn jo jp jq ko js jt ju kp jw jx jy kq ka kb kc kr ke kf kg bi translated">编码</h1><p id="52d0" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">对于那些不熟悉网页抓取的人，请查看下面的链接。</p><div class="ks kt ez fb ku kv"><a href="https://towardsdatascience.com/everything-you-need-to-know-about-web-scraping-6541b241f27e" rel="noopener follow" target="_blank"><div class="kw ab dw"><div class="kx ab ky cl cj kz"><h2 class="bd hi fi z dy la ea eb lb ed ef hg bi translated">关于网络抓取，你需要知道的一切</h2><div class="lc l"><h3 class="bd b fi z dy la ea eb lb ed ef dx translated">每个人都应该知道的神奇工具！</h3></div><div class="ld l"><p class="bd b fp z dy la ea eb lb ed ef dx translated">towardsdatascience.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj lk kv"/></div></div></a></div><p id="38f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有时候，网络抓取可能会引发关于数据使用的<a class="ae km" href="https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01" rel="noopener" target="_blank">道德问题</a>。检查网站所有者的网页抓取权限的一个好方法是在网站url后添加<strong class="ig hi"> <em class="ll"> \robots.txt </em> </strong>。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div class="er es lm"><img src="../Images/ab9e035c16339d5b2db1cbad91ad0a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*8VDdmwO3UJrh0yhK00HngQ.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">原始URL</figcaption></figure><figure class="ln lo lp lq fd lr er es paragraph-image"><div class="er es lx"><img src="../Images/c14e63a9bf24bf9fb5476a232917ec29.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*jDsdYA3r3bQwpYBAaEiZjg.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">正在检查抓取权限URL</figcaption></figure><figure class="ln lo lp lq fd lr er es paragraph-image"><div class="er es ly"><img src="../Images/c7198096c28d976c5036757c4856818a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*veWqWvZnTF1zBVulsZ_npQ.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">Facebook.com允许机器人</figcaption></figure></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><p id="d1e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ll">备注:对于Talaad Thai网站，作者以上述方式检查了机器人权限，但无法找到允许/不允许站点抓取的信息。本文旨在教育读者，并介绍数据科学如何在管理传统业务中发挥作用。作者无意将这篇文章或从网上获取的数据货币化。</em></p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><p id="0250" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，导入库并挂载Google drive。</p><pre class="ln lo lp lq fd lz ma mb mc aw md bi"><span id="ecef" class="me jk hh ma b fi mf mg l mh mi">import json</span><span id="cb4d" class="me jk hh ma b fi mj mg l mh mi">import requests</span><span id="2263" class="me jk hh ma b fi mj mg l mh mi">import pandas as pd</span><span id="f103" class="me jk hh ma b fi mj mg l mh mi">from bs4 import BeautifulSoup</span><span id="106c" class="me jk hh ma b fi mj mg l mh mi">import urllib3</span><span id="ba79" class="me jk hh ma b fi mj mg l mh mi">from google.colab import drive</span><span id="075f" class="me jk hh ma b fi mj mg l mh mi">urllib3.disable_warnings() #to turn off warnings</span><span id="f6a9" class="me jk hh ma b fi mj mg l mh mi">drive.mount('/content/drive') #mount Google drive</span><span id="bed1" class="me jk hh ma b fi mj mg l mh mi">headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36'}</span></pre><p id="5ffe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设我想取消猪肉价格，我会先去网站的<a class="ae km" href="https://talaadthai.com/product/10-05-17-ground-pork" rel="noopener ugc nofollow" target="_blank">链接</a>。然后复制链接，使用BeautifulSoup通过下面的代码把<strong class="ig hi"> <em class="ll"> html </em> </strong>变成<strong class="ig hi"><em class="ll">text</em></strong><em class="ll"/>。</p><pre class="ln lo lp lq fd lz ma mb mc aw md bi"><span id="46d9" class="me jk hh ma b fi mf mg l mh mi">r_test = requests.get("https://talaadthai.com/product/10-05-17-ground-pork", headers=headers,verify=False)</span><span id="417a" class="me jk hh ma b fi mj mg l mh mi">soup = BeautifulSoup(r_test.content,'html.parser')</span><span id="f50e" class="me jk hh ma b fi mj mg l mh mi">data = soup.text</span></pre><p id="8fe4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">打印数据，你会得到这个:</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mk"><img src="../Images/7b7ed19e72857a5714d1e05fd0acd30b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZzLqB8SshPVEnNNK1qBJQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">来自碎猪肉页面的文本</figcaption></figure><p id="703f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之后，我会找到一个链接，该网站使用上传每日价格。注意，这个过程相当繁琐。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mp"><img src="../Images/60052c81c6d8c405091d919acb599cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAcHSdur9iGMnelcTMdd2Q.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">用于查询每日价格的主链接</figcaption></figure><p id="0e7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">黄色框中的链接是我们的主要链接，我们将使用它来查询每日价格。此外，我注意到红色圆圈中的数字是产品ID。因此，我们可以更改产品ID来查询除碎猪肉以外的其他价格。但是，您需要重复上述过程来获得这样的产品ID。比如，“<em class="ll"> 9578 </em>”是鸡胸肉，“<em class="ll"> 9533 </em>”是肉末，“<em class="ll"> 9570 </em>”是咸鸭蛋。</p><p id="8f3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，让我们使用上面的链接创建价格抓取代码。</p><figure class="ln lo lp lq fd lr"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">将数据放入数据框</figcaption></figure><p id="8ca3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们将<em class="ll"> data_df </em>导出到excel，就会是这样的。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es ms"><img src="../Images/659939526b8741faab3eef72ad7ea0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4VM-cafWbVP3CVsN8X5-TQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">excel格式的data_df</figcaption></figure><p id="1e1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上图中，我们想要的价格在<em class="ll">‘最近价格’</em>行和<em class="ll">‘ACF’</em>列中。然后，我们可以通过以下代码提取价格。</p><pre class="ln lo lp lq fd lz ma mb mc aw md bi"><span id="cdf5" class="me jk hh ma b fi mf mg l mh mi">test_rm_df = pd.DataFrame(data=data_df.loc['recent_price']['acf'],index=['Raw_Mat_Price'])</span><span id="a6ac" class="me jk hh ma b fi mj mg l mh mi">number = data_df['id'].drop_duplicates()</span><span id="1649" class="me jk hh ma b fi mj mg l mh mi">test_rm_df['Product_ID'] = number[0]</span><span id="e70a" class="me jk hh ma b fi mj mg l mh mi">test_rm_df['Product_Name'] = 'Ground Pork'</span><span id="2aff" class="me jk hh ma b fi mj mg l mh mi">test_rm_df</span></pre><p id="8cab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果如下所示。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mt"><img src="../Images/7109c011c8481f08c66b659ac0840d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T0tpZLCX4ZQIgGqjVBR0sA.png"/></div></div></figure><p id="dd7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据上面的示例，如果我们有一个如下所示的产品ID和产品名称列表，我们可以如下循环价格查询:</p><figure class="ln lo lp lq fd lr"><div class="bz dy l di"><div class="mq mr l"/></div></figure><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mu"><img src="../Images/5a20e32eda9cb98e43b2539c8c19e744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kub6rr7YsXNj3B2IcttQPg.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">每日结果数据框架</figcaption></figure><p id="c7d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的代码中，我们可以每天运行代码将价格存储在excel文件中。</p><p id="a8fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行代码一段时间后，我们可以创建图表来比较价格和实际成本，如下所示。我感谢Tansita W .给我实际成本数据，以便与Talaad Thai价格进行比较。</p><figure class="ln lo lp lq fd lr er es paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="er es mv"><img src="../Images/9f61343c9701b9b39c134c7716fa39bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eg9BGhy--6GP7rLoXjBtkQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">泰国塔拉德的碎猪肉价格与实际成本的比较</figcaption></figure><p id="1663" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我想指出的是，我们不应该过于频繁地查询价格，只获取必要的信息，因为每次查询都会耗费网站资源。</p><h1 id="3177" class="jj jk hh bd jl jm kn jo jp jq ko js jt ju kp jw jx jy kq ka kb kc kr ke kf kg bi translated">进一步的用途</h1><p id="6735" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">收集数据是所有分析的第一步。从上面的数据集，我们可以无止境地扩展用途。例如，我们可以通过产品之间的相关性分析来分析价格变动。此外，我们可以从农产品价格跟踪通货膨胀，因为它反映了零售企业所依赖的实际成本。最后，如果有足够的数据集，我们也许能够建模和预测价格。</p></div></div>    
</body>
</html>