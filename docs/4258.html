<html>
<head>
<title>Customer Life Time Value Prediction by Using BG-NBD &amp; Gamma-Gamma Models and Applied Example in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于BG-NBD和Gamma-Gamma模型的客户生命周期价值预测及Python应用实例</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/customer-life-time-value-prediction-by-using-bg-nbd-gamma-gamma-models-and-applied-example-in-997a5ee481ad?source=collection_archive---------0-----------------------#2021-09-13">https://medium.com/analytics-vidhya/customer-life-time-value-prediction-by-using-bg-nbd-gamma-gamma-models-and-applied-example-in-997a5ee481ad?source=collection_archive---------0-----------------------#2021-09-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="dd31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大家好。在这个故事中，我将尝试解释什么是BG-NBD模型，什么是伽马-伽马子模型，以及我们如何使用这些统计方法来计算客户的生命周期价值。在这个故事的最后，我们将看到一个Python中的应用示例。我将在这里解释代码的含义，我也将在Kaggle笔记本上分享代码。你可以从<a class="ae jd" href="https://www.kaggle.com/enesbaysan/customer-life-time-value-prediction-by-using-bg-nb" rel="noopener ugc nofollow" target="_blank">这里</a>进入笔记本。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/f7e1897189211e0ec8564cdc5ce3f876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ypPtVGL-SNazPNQF7vpAQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated"><a class="ae jd" href="https://unsplash.com/@lenscapewithme?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯汀·三都</a>在<a class="ae jd" href="https://unsplash.com/s/photos/statistics?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1f2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用这些技术，我们可以预测以下事情</p><ul class=""><li id="491d" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">哪个客户会在下一期购买？</li><li id="7205" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">预计下一阶段前N名客户的购买量最大</li><li id="b577" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">客户会为我们的企业创造什么价值？</li></ul><p id="372b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">BG-NBD模型将模拟每个客户的购买行为分布，并预测每个客户的预期交易数量。</p><p id="3d22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Gamma-Gamma子模型将模拟预期平均利润分布，并预测每个客户的预期平均利润。</p><h1 id="9e73" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">BG-NBD模型</h1><p id="4a57" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">贝塔几何/负二项分布被称为BG-NBD模型。有时它也会出现为“买到死”。它给出了下一个周期的条件预期交易数。该模型可以回答以下问题</p><ul class=""><li id="043a" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">下周会有多少交易？</li><li id="3095" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">未来3个月内会有多少笔交易？</li><li id="4911" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">在接下来的2周内，哪些顾客会购买最多？</li></ul><p id="6868" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模型通过使用概率来预测预期的交易数量，从而对两个流程进行建模</p><ul class=""><li id="d4e7" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">交易流程(购买)</li><li id="60b5" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">辍学过程(直到你死)</li></ul><h2 id="41d0" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">交易流程(购买)</h2><ul class=""><li id="0812" class="ju jv hi ih b ii lg im lh iq lz iu ma iy mb jc jz ka kb kc bi translated">我们用这个来表示购买过程</li><li id="c273" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">在客户存活期间，将由客户产生的数量，将由交易率参数分配毒药</li><li id="091b" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">在客户存在期间，他们将按照自己的交易率进行购买</li><li id="2f01" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">每个客户的交易率将会改变，并且它们将被分布为gamma (r，α)</li></ul><h2 id="54a4" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">辍学过程(直到你死)</h2><ul class=""><li id="0bcd" class="ju jv hi ih b ii lg im lh iq lz iu ma iy mb jc jz ka kb kc bi translated">这意味着放弃购买</li><li id="9b5e" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">每个顾客都有自己的p概率辍学率</li><li id="e8b4" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">顾客将会以p的概率退出</li><li id="d0df" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">对于每个客户，退出率会有所不同，对于大众，退出率将分布为beta (a，b)</li></ul><h2 id="3527" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">贝格-NBD公式</h2><p id="cc50" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们在下面看到了BG-NBD模型的公式。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/5bce4301e13d6eb59e03bd354d3958b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZcERUbH36qDWniPvQGZDcQ.png"/></div></div></figure><p id="9d06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将解释等式左边的参数。</p><ul class=""><li id="516a" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated"><code class="du md me mf mg b">E</code>指预期值</li><li id="0b7a" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">|</code>是指这个概率是有条件的(有条件的预期交易数)</li><li id="a2e8" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">x</code>指每位顾客至少购买2次的频率。</li><li id="5ee2" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">tx</code>指每个客户的新近度。在这种情况下，我们将假设新近性是基于周的。从最后一个采购日期到第一个采购日期的时间(周)。</li><li id="0c08" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">T</code>是指从今天到最后一个购买日期的时间(周)。</li><li id="6a04" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">r,α</code>来自伽马分布(购买过程)。<strong class="ih hj">批量交易费率。</strong></li><li id="2ad6" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">a,b</code>来自贝塔分布(直到你死的过程)。<strong class="ih hj">群众的辍学率。</strong></li><li id="b842" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">Y(t)</code>指每个客户的预期交易次数。</li></ul><h1 id="990d" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">伽马-伽马子模型</h1><p id="4672" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们使用这个模型来预测我们可以为每个客户赚取多少平均利润。在对大众的平均利润建模后，它给出了每个客户的预期平均利润。</p><ul class=""><li id="8988" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">客户的货币价值(客户交易金额的总和)将围绕其交易价值的平均值随机分布</li><li id="2235" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">客户之间的平均交易值可能会在不同时期发生变化，但对于客户来说不会发生变化</li><li id="9a0a" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">平均交易值将在所有客户之间分配</li></ul><h2 id="2aba" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">伽马-伽马子模型公式</h2><p id="f969" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我们看到下面的伽玛-伽玛子模型的公式。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mc"><img src="../Images/fe247b0441db8fb17d1bea130b4e2090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vq9LSCSGkC-USWehNrwOeQ.png"/></div></div></figure><p id="dd53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将再次解释等式左边的参数。</p><ul class=""><li id="3ee5" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated"><code class="du md me mf mg b">E</code>指预期值</li><li id="bb0f" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">x</code>指每个客户的频率</li><li id="5b90" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">mx</code>指每个客户的货币</li><li id="fb95" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">M</code>指交易的预期价值(预期平均利润)</li><li id="6dcd" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated"><code class="du md me mf mg b">p,q,γ</code>来自伽马分布</li></ul><p id="6362" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们可以进入“应用示例”部分。</p><h1 id="09a6" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">Python中的一个应用实例</h1><p id="362d" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">在本节中，我们将使用<a class="ae jd" href="https://www.kaggle.com/nathaniel/uci-online-retail-ii-data-set" rel="noopener ugc nofollow" target="_blank">这个</a>数据集。还有，你可以从<a class="ae jd" href="https://archive.ics.uci.edu/ml/datasets/Online+Retail+II" rel="noopener ugc nofollow" target="_blank">这里</a>得到。正如我之前所说，我将在这里解释代码的含义，并将在<a class="ae jd" href="https://www.kaggle.com/enesbaysan/customer-life-time-value-prediction-by-using-bg-nb" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上分享代码。</p><h2 id="1404" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">我们开始吧</h2><p id="c9c4" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我将导入下面的包。我们将使用<code class="du md me mf mg b">datetime</code>来创建<code class="du md me mf mg b">today_date</code>变量。该数据集包含2009年至2011年的数据。我将使用2010-2011年的表单。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="8eae" class="ll kj hi mg b fi ml mm l mn mo">import pandas as pd<br/>import datetime as dt<br/>from lifetimes import BetaGeoFitter<br/>from lifetimes import GammaGammaFitter</span></pre><p id="886c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用<code class="du md me mf mg b">lifetimes</code>包来使用统计模型。您可以在您的工作区中安装软件包，如下所示:</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="512a" class="ll kj hi mg b fi ml mm l mn mo">!pip install lifetimes<br/>!pip install openpyxl</span></pre><p id="cb8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，我已经安装了用于读取excel文件的<code class="du md me mf mg b">openpyxl</code>包。</p><h2 id="9f5e" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">正在加载数据集</h2><p id="2355" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我已经把数据集上传到我的Kaggle工作空间了。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="1ae4" class="ll kj hi mg b fi ml mm l mn mo">raw_data = pd.read_excel('../input/uci-online-retail-ii-data-set/online_retail_II.xlsx',sheet_name='Year 2010-2011')</span><span id="a8ad" class="ll kj hi mg b fi mp mm l mn mo">df = raw_data.copy()</span><span id="f6d8" class="ll kj hi mg b fi mp mm l mn mo">df.head()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mq"><img src="../Images/562bc383231253be50fc527dcaeb27bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sEr_j5pL81XkCGR2jkhDrg.png"/></div></div></figure><p id="e7a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以学习下面的可变含义。</p><ul class=""><li id="26e3" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">发票:发票编号。如果这个号码以“C”开头，就意味着这个交易取消了。</li><li id="a925" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">库存代码:产品代码</li><li id="c2ce" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">描述:产品名称</li><li id="69cd" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">数量:产品数量</li><li id="c6f0" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">发票日期:交易日期</li><li id="2395" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">价格:单个产品价格</li><li id="572c" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">CustomerID:唯一的客户号</li><li id="c981" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">国家:客户的国家名称</li></ul><h2 id="03e1" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">数据准备</h2><p id="7084" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我将排除行中有<code class="du md me mf mg b">na</code>值的条目。之后，我将对数据集应用另一个过滤器。我还会选择发票列不是以“C”开头的数据。因为如果以‘C’开头，就说明这是一笔取消的交易。然后我将过滤<code class="du md me mf mg b">Quantity</code>列，并为每笔交易计算<code class="du md me mf mg b">TotalPrice</code>。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="8480" class="ll kj hi mg b fi ml mm l mn mo">df.dropna(inplace=True)<br/>df = df[~df["Invoice"].str.contains("C", na=False)]<br/>df = df[df["Quantity"] &gt; 0]<br/>df['TotalPrice'] = df['Price'] * df['Quantity']</span></pre><p id="d48a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实上，我们可以向数据集提出一些问题，我们可以从中获得一些见解，但我不会这样做。我想把重点放在主题上。</p><h2 id="bca9" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">准备用于计算CLV的数据集</h2><p id="c67f" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我要创造一个虚拟的约会。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="65c6" class="ll kj hi mg b fi ml mm l mn mo">today_date = dt.datetime(2011, 12, 11)</span></pre><p id="3113" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我需要计算统计模型的列。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="2e38" class="ll kj hi mg b fi ml mm l mn mo">cltv = df.groupby('Customer ID').agg({<br/>    'InvoiceDate': [<br/>        lambda x: (x.max() - x.min()).days,  <em class="mr"># recency</em><br/>        lambda x: (today_date - x.min()).days  <em class="mr"># T</em><br/>    ],<br/>    'Invoice': lambda x: x.nunique(),  <em class="mr"># frequency</em><br/>    'TotalPrice': lambda x: x.sum()  <em class="mr"># monetary</em><br/>})</span></pre><p id="793d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我需要修复数据集的列。Pandas为它创建了基于级别的列，因为在<code class="du md me mf mg b">InvoiceDate</code>列中有2 lambda函数。此外，我将像统计模型使用的那样重命名列。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="cbc8" class="ll kj hi mg b fi ml mm l mn mo">cltv.columns = cltv.columns.droplevel(0)<br/><br/>cltv.columns = ['recency', 'T', 'frequency', 'monetary']</span></pre><p id="853d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将计算每笔交易的平均收入。在这种情况下，我们将假设货币价值是每笔交易的平均收入。Gamma-Gamma模型使用那样的<code class="du md me mf mg b">monetary</code>值。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="5ae8" class="ll kj hi mg b fi ml mm l mn mo">cltv = cltv[cltv['monetary'] &gt; 0]</span><span id="2b59" class="ll kj hi mg b fi mp mm l mn mo">cltv['monetary'] = cltv['monetary'] / cltv['frequency']</span></pre><p id="591e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我需要将基于NG-NBD模型的天数转换为周数。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="fd99" class="ll kj hi mg b fi ml mm l mn mo"><em class="mr"># transforming days to weeks</em></span><span id="ec1e" class="ll kj hi mg b fi mp mm l mn mo">cltv['recency'] = cltv['recency'] / 7</span><span id="fc8e" class="ll kj hi mg b fi mp mm l mn mo">cltv['T'] = cltv['T'] / 7</span></pre><p id="d360" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我正在过滤掉大于1的<code class="du md me mf mg b">frequency</code>值。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="88c4" class="ll kj hi mg b fi ml mm l mn mo">cltv = cltv[(cltv['frequency'] &gt; 1)]</span></pre><h2 id="2fd4" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">创建NG-NBD模型</h2><p id="159a" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我将使用<code class="du md me mf mg b">lifetimes</code>包中的<code class="du md me mf mg b">BetaGeoFitter</code>。我将创建一个实例，并通过使用频率、新近度和T值来拟合它。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="eb3c" class="ll kj hi mg b fi ml mm l mn mo">bgf = BetaGeoFitter(penalizer_coef=0.001)</span><span id="8d1c" class="ll kj hi mg b fi mp mm l mn mo">bgf.fit(cltv['frequency'], cltv['recency'], cltv['T'])</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ms"><img src="../Images/288dc6eeb0aa7616106380fca946d635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDOyGsWY9MRWhdFrMPoryg.png"/></div></div></figure><p id="2258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经在上面创建了一个NG-NBD模型。现在我们可以预测一些期望值。我们将在下面看到一些问题示例。</p><p id="8adc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mr">预计一周内购买量最大的前10名客户</em></p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="e88b" class="ll kj hi mg b fi ml mm l mn mo">bgf.conditional_expected_number_of_purchases_up_to_time(1, <em class="mr"># week</em><br/>                                                        cltv['frequency'],<br/>                                                        cltv['recency'],<br/>                                                        cltv['T']).sort_values(ascending=False).head(10)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/e88b518eaeedcf805b71dfff5732e59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkaILur9PeZ3YKL-pPOPjA.png"/></div></div></figure><p id="fb6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mr">预计一个月内购买量最多的前10名客户</em></p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="7832" class="ll kj hi mg b fi ml mm l mn mo">bgf.conditional_expected_number_of_purchases_up_to_time(4, <br/>                                                 <em class="mr"># 4 weeks = 1 month</em><br/>                                                        cltv['frequency'],<br/>                                                        cltv['recency'],<br/>                                                        cltv['T']).sort_values(ascending=False).head(10)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/32b18bf27e7cf08d066e39dd7b04226e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VD-M1js7wD9tMFdJv4In3Q.png"/></div></div></figure><p id="131a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一点很重要，我们不应该忽略。这种模式以星期为基础。因此，我们需要传递基于周的时间参数(函数中的第一个参数)。</p><p id="2fdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mr">预计未来6个月购买量最大的前10名客户</em></p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="12a9" class="ll kj hi mg b fi ml mm l mn mo">bgf.conditional_expected_number_of_purchases_up_to_time(4 * 6, <br/>                                           <em class="mr"># weeks * count = months</em><br/>                                                        cltv['frequency'],<br/>                                                        cltv['recency'],<br/>                                                        cltv['T']).sort_values(ascending=False).head(10)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/9552addcb51a582aea16afc49301d4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yvLKOKsTUgjK24M5ucQyMQ.png"/></div></div></figure><p id="870f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mr">未来6个月预计总交易数</em></p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="b925" class="ll kj hi mg b fi ml mm l mn mo">bgf.conditional_expected_number_of_purchases_up_to_time(4 * 6,<br/>                                                        cltv['frequency'],<br/>                                                        cltv['recency'],<br/>                                                        cltv['T']).sum()</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/daeaad3549d71f68442c87e22efd9ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XMN8gR3PBngv2qCwv-_tGw.png"/></div></div></figure><h2 id="8f5c" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">创建伽玛伽玛子模型</h2><p id="8f85" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我将使用<code class="du md me mf mg b">lifetimes</code>包中的<code class="du md me mf mg b">GammaGammaFitter</code>。我将创建一个实例，并通过使用频率和货币值来拟合它。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="9b5b" class="ll kj hi mg b fi ml mm l mn mo">ggf = GammaGammaFitter(penalizer_coef=0.01)<br/><br/>ggf.fit(cltv['frequency'], cltv['monetary'])</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/780d088c3af07b8c4c4edf0f59e80340.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5niG2z7XqulmNTkIPs_TbA.png"/></div></div></figure><p id="9a72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样，我们可以通过使用如下模型来回答问题。</p><p id="10b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mr">预计最有价值的10大客户</em></p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="447d" class="ll kj hi mg b fi ml mm l mn mo">ggf.conditional_expected_average_profit(cltv['frequency'],<br/>                               cltv['monetary']).sort_values(ascending=False).head(10)</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mt"><img src="../Images/b3266d3f0f72cd1eda16586ee630a73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HsROSbCbfjmlABwJs_XMtA.png"/></div></div></figure><h2 id="afe8" class="ll kj hi bd kk lm ln lo ko lp lq lr ks iq ls lt kw iu lu lv la iy lw lx le ly bi translated">用BG-NBD和Gamma-Gamma模型预测CLV</h2><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="f572" class="ll kj hi mg b fi ml mm l mn mo"><em class="mr"># The customers' lifetime values expected to in the next 3 months</em></span><span id="75ad" class="ll kj hi mg b fi mp mm l mn mo">cltv['cltv_pred_3_months'] = ggf.customer_lifetime_value(bgf,<br/>                                   cltv['frequency'],<br/>                                   cltv['recency'],<br/>                                   cltv['T'],<br/>                                   cltv['monetary'],<br/>                                   time=3,  <em class="mr"># 3 months</em><br/>                                   freq="W",  <br/><em class="mr"># frequency information of T. In this case we set week by using 'W'</em><br/>                                   discount_rate=0.01)</span><span id="470c" class="ll kj hi mg b fi mp mm l mn mo">cltv</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mu"><img src="../Images/7921697f2c9bb071ed533bcb35b0e7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*b5stwOVBjQ1wIJk3JPimbQ.png"/></div></figure><p id="37b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，如果我们愿意，我们可以利用客户的CLV价值观对他们进行细分。使用这些数据有助于采取行动。你可以在下面看到一个例子。</p><pre class="jf jg jh ji fd mh mg mi mj aw mk bi"><span id="6d06" class="ll kj hi mg b fi ml mm l mn mo">cltv['segment'] = pd.qcut(cltv['cltv_pred_3_months'],4,['D','C','B','A'])<br/><br/>cltv</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mv"><img src="../Images/7814d1062349707ba31f22be16ed478c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*ZmtHVYyTlnHJhlvT-Oyy1w.png"/></div></figure><h1 id="c82c" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">最后的想法</h1><p id="f004" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">希望这是有帮助的，你喜欢它。我没有深究更复杂的统计数据。老实说，有时候对于一些没有数学基础的人来说，这可能太复杂了。然而，对于理解输入的人来说更容易。有一点很重要。我们学习了每个模型的输入。现在，我们可以区分BG-NBD模型和Gamma-Gamma模型之间的差异，并可以将这些模型用于我们的业务。</p><p id="29cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">亲切的问候。</p></div></div>    
</body>
</html>