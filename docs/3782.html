<html>
<head>
<title>How to dockerize Python Pytesseract for AWS Lambda using Elastic Container Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用弹性容器注册表为AWS Lambda对接Python Pytesseract</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-dockerize-python-pytesseract-for-aws-lambda-using-elastic-container-registry-752a651edecd?source=collection_archive---------5-----------------------#2021-07-26">https://medium.com/analytics-vidhya/how-to-dockerize-python-pytesseract-for-aws-lambda-using-elastic-container-registry-752a651edecd?source=collection_archive---------5-----------------------#2021-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="203f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将解释编排docker映像以在ECR中部署并最终在无服务器环境中使用AWS lambda运行的整个过程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8e4ad7df1997a89ca04a144eb139a2aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SyB3mOaT0TFBbAUt.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://godatadriven.com/topic/the-virtual-classroom/" rel="noopener ugc nofollow" target="_blank">https://godatadriven.com/topic/the-virtual-classroom/</a></figcaption></figure><h2 id="9a19" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">目录:</h2><p id="a89b" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">∘ <a class="ae jt" href="#a55c" rel="noopener ugc nofollow">数据工程师的问题陈述</a> <br/> ∘ <a class="ae jt" href="#cee2" rel="noopener ugc nofollow">为什么是Docker？</a> <br/> ∘ <a class="ae jt" href="#ded0" rel="noopener ugc nofollow"> Docker文件内容</a><br/>∘<a class="ae jt" href="#5d36" rel="noopener ugc nofollow">Docker文件做以下</a> <br/> ∘ <a class="ae jt" href="#423c" rel="noopener ugc nofollow"> app.py内容</a> <br/> ∘ <a class="ae jt" href="#d4ec" rel="noopener ugc nofollow"> app.py做以下</a><br/>∘<a class="ae jt" href="#5906" rel="noopener ugc nofollow">requirements . txt内容</a> <br/> ∘ <a class="ae jt" href="#da6d" rel="noopener ugc nofollow"> requirement.txt文件做以下</a> <br/> ∘ <a class="ae jt" href="#56d4" rel="noopener ugc nofollow">步骤创建docker镜像</a> 部署到集控室<br/> ∘ <a class="ae jt" href="#f54b" rel="noopener ugc nofollow">部署到AWS</a>步骤<br/> ∘ <a class="ae jt" href="#993b" rel="noopener ugc nofollow">测试使用</a>t49】∘<a class="ae jt" href="#6d38" rel="noopener ugc nofollow">关于作者</a>t52】∘<a class="ae jt" href="#8e0d" rel="noopener ugc nofollow">github</a>t55】∘<a class="ae jt" href="#0193" rel="noopener ugc nofollow">LinkedIn</a></p><h2 id="a55c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">数据工程师的问题陈述:</h2><p id="a4f8" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">将图像或文本扩展名转换为pdf。听起来很简单？让我们深入了解一下。输入文件会在S3。输出也将被写入输入所在的同一个S3文件夹。听起来不错…嗯，让我们看看更多的细节。解决方案需要有tesseract二进制文件来运行无服务器lambda。此外，这个包应该可以在Amazon Linux上运行。这意味着宇宙魔方二进制文件应该与Amazon Linux兼容。除此之外，我们对部署包的大小有lambda限制。如果你用的是windows或mac，这种情况不会很快消失。</p><p id="f053" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我想到了一个东西，如果它在本地工作，应该可以在无服务器中无缝工作——Docker！</p><h2 id="cee2" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">为什么是Docker？</h2><p id="c68c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">仅仅因为docker可以构建和分享容器化的应用——从桌面到云。句号。这给了我足够的信心，让我开始为docker开发一些代码并构建它。</p><p id="a21c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我创建了一个如下的结构:</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="a01f" class="ju jv hi kv b fi kz la l lb lc">│   Dockerfile<br/>│   requirements.txt<br/>├───app<br/>│       app.py</span></pre><h2 id="ded0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">Docker文件内容:</h2><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="0f8f" class="ju jv hi kv b fi kz la l lb lc">FROM public.ecr.aws/lambda/python:3.8</span><span id="cf64" class="ju jv hi kv b fi ld la l lb lc">COPY requirements.txt ./requirements.txt<br/>RUN pip install -r requirements.txt</span><span id="bb11" class="ju jv hi kv b fi ld la l lb lc">RUN rpm -Uvh <a class="ae jt" href="https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm" rel="noopener ugc nofollow" target="_blank">https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</a><br/>RUN yum -y update<br/>RUN yum -y install tesseract</span><span id="13e5" class="ju jv hi kv b fi ld la l lb lc">COPY ./app/app.py   ./</span><span id="8abc" class="ju jv hi kv b fi ld la l lb lc">RUN aws configure set aws_access_key_id ""<br/>RUN aws configure set aws_secret_access_key ""<br/>RUN aws configure set region ""<br/>RUN aws configure set output ""</span><span id="0413" class="ju jv hi kv b fi ld la l lb lc">CMD ["app.lambda_handler"]</span></pre><h2 id="5d36" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">Dockerfile执行以下操作:</h2><p id="8af2" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在构建映像时，它将逐个运行docker文件中的每个语句并执行。</p><ol class=""><li id="b97d" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">从支持3.8的AWS lambda克隆Amazon Linux的公共ECR映像</li><li id="0035" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">复制要求文件，然后安装python程序app.py运行的要求</li><li id="d10a" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">接下来，它在映像中安装宇宙魔方</li><li id="7568" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">复制应用程序文件夹内容</li><li id="9c66" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">最后，它设置了AWS CLI与S3协同工作的环境。</li><li id="8caa" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">最后一行告诉图像，每当有请求时，app.lambda_handler是我的应用程序入口点。</li></ol><h2 id="423c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">app.py内容:</h2><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="f1d1" class="ju jv hi kv b fi kz la l lb lc">from fpdf import FPDF<br/>import os<br/>import pytesseract<br/>import boto3<br/>from PIL import Image</span><span id="751c" class="ju jv hi kv b fi ld la l lb lc">def download_dir(prefix, local, bucket, client):<br/>    """<br/>    params:<br/>    - prefix: pattern to match in s3<br/>    - local: local path to folder in which to place files<br/>    - bucket: s3 bucket with target contents<br/>    - client: initialized s3 client object<br/>    """<br/>    keys = []<br/>    dirs = []<br/>    next_token = ''<br/>    base_kwargs = {<br/>        'Bucket':bucket,<br/>        'Prefix':prefix,<br/>    }<br/>    while next_token is not None:<br/>        kwargs = base_kwargs.copy()<br/>        if next_token != '':<br/>            kwargs.update({'ContinuationToken': next_token})<br/>        results = client.list_objects_v2(**kwargs)<br/>        contents = results.get('Contents')<br/>        for i in contents:<br/>            k = i.get('Key')<br/>            if k[-1] != '/':<br/>                keys.append(k)<br/>            else:<br/>                dirs.append(k)<br/>        next_token = results.get('NextContinuationToken')<br/>    for d in dirs:<br/>        dest_pathname = os.path.join(local, d)<br/>        if not os.path.exists(os.path.dirname(dest_pathname)):<br/>            os.makedirs(os.path.dirname(dest_pathname))<br/>    for k in keys:<br/>        dest_pathname = os.path.join(local, k)<br/>        if not os.path.exists(os.path.dirname(dest_pathname)):<br/>            os.makedirs(os.path.dirname(dest_pathname))<br/>        client.download_file(bucket, k, dest_pathname)</span><span id="b7c0" class="ju jv hi kv b fi ld la l lb lc">def lambda_handler(event, context):<br/>    pdf = FPDF()<br/>    pdf.add_page()<br/>    pdf.set_font('Arial', size=20)</span><span id="e987" class="ju jv hi kv b fi ld la l lb lc">session = boto3.Session()<br/>    s3_client = session.client('s3')<br/>    bucket_name='filestorageexchange'<br/>    s3_folder='main_folder/sub_folder'<br/>    lambda_write_path = '/tmp/'<br/>    download_dir(prefix=s3_folder, local=lambda_write_path, bucket=bucket_name, client=s3_client)</span><span id="e6bc" class="ju jv hi kv b fi ld la l lb lc">for item in os.listdir(main_path := os.path.abspath(os.path.join(lambda_write_path, s3_folder))):<br/>        for folder in os.listdir(sub_path := os.path.join(main_path, item)):<br/>            for file in os.listdir(sub_folder_path := os.path.join(sub_path, folder)):<br/>                Converted = False<br/>                file_path = os.path.join(sub_folder_path, file)<br/>                print(f'\nProcessing text file...{file_path}')<br/>                pdf_file_name = file_path.replace(file_path.split('.')[1], 'pdf')<br/>                s3_folder = 'main_folder' + '/' + 'sub_folder' + '/' + item + '/' + folder<br/>                s3_object = pdf_file_name.split(os.sep)[-1]<br/>                try:<br/>                    if file_path.endswith('txt'):<br/>                        pdf.cell(200, 10, txt="".join(open(file_path)))<br/>                        pdf.output(os.path.join(lambda_write_path, pdf_file_name))<br/>                        Converted=True<br/>                    if file_path.lower().endswith(('png', 'jpg', 'gif', 'tif')):<br/>                        pdf_png = pytesseract.image_to_pdf_or_hocr(file_path, extension='pdf')<br/>                        with open(os.path.join(lambda_write_path, pdf_file_name), 'w+b') as f:<br/>                            f.write(pdf_png)<br/>                        Converted=True    <br/>                    if file_path.endswith(('pcd')):                       <br/>                        Image.open(file_path).save(temp_file:=file_path.replace(file_path.split('.')[1], 'png'))<br/>                        pdf_png = pytesseract.image_to_pdf_or_hocr(temp_file, extension='pdf')<br/>                        with open(os.path.join(lambda_write_path, pdf_file_name), 'pdf', 'w+b') as f:<br/>                            f.write(pdf_png)<br/>                            os.remove(temp_file)<br/>                        Converted=True<br/>                except Exception as e:<br/>                    print(e)</span><span id="010a" class="ju jv hi kv b fi ld la l lb lc">if Converted:<br/>                    print(f"Created - {os.path.join(lambda_write_path, pdf_file_name)}")<br/>                    with open(os.path.join(lambda_write_path, pdf_file_name), 'rb') as data:<br/>                        s3_client.upload_fileobj(data, bucket_name, s3_folder + '/' + s3_object)<br/>                    print(f"Uploaded to - {s3_folder + '/' + s3_object}")<br/>                else:<br/>                    print(f"Not Created - {os.path.join(lambda_write_path, pdf_file_name)}")</span><span id="54d3" class="ju jv hi kv b fi ld la l lb lc">if __name__ == "__main__":<br/>    if os.name == 'nt':<br/>        pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'<br/>    else:<br/>        pytesseract.pytesseract.tesseract_cmd = r'tesseract/4.1.1/bin/tesseract'<br/>    <br/>    lambda_handler(None, None)</span></pre><p id="ff1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:app.py是在3.8中编写和测试的</p><h2 id="d4ec" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">app.py执行以下操作:</h2><ol class=""><li id="bc33" class="le lf hi ih b ii kp im kq iq ls iu lt iy lu jc lj lk ll lm bi translated">使用appid和appsecret登录AWS</li><li id="1d9f" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">从S3桶下载文件</li><li id="4f7f" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">使用pytesseract、fpdf和pillow转换它们</li><li id="5962" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">给S3回信</li></ol><h2 id="5906" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">requirements.txt内容:</h2><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="02ba" class="ju jv hi kv b fi kz la l lb lc">fpdf<br/>pillow<br/>pytesseract<br/>awscli<br/>boto3</span></pre><h2 id="da6d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">requirement.txt文件执行以下操作:</h2><ol class=""><li id="7fd4" class="le lf hi ih b ii kp im kq iq ls iu lt iy lu jc lj lk ll lm bi translated">收集以上所有python包。</li><li id="0b85" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">安装上述所有软件包。</li></ol><h2 id="56d4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">创建docker映像的步骤:</h2><p id="6687" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">先决条件:</p><ol class=""><li id="4dde" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">安装docker并确保它在后台运行</li><li id="2157" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">在vs代码中安装docker扩展(可选)。这将让您轻松浏览图像，查看日志和许多其他内容。</li></ol><h2 id="bd35" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">构建:</h2><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="8621" class="ju jv hi kv b fi kz la l lb lc">docker build -t &lt;image-name&gt; .</span></pre><p id="f05a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者右键单击vscode中的dockerfile，然后单击→从Dockerfile构建映像</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lv"><img src="../Images/be1c56331704ab94e1d08106fd985709.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*GejbkSbPj6mXFSh-CMVVMA.png"/></div></figure><p id="afd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦您创建了这个，您将在vs代码扩展中看到类似这样的内容。理想章鱼是我16小时前给它起的名字。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lw"><img src="../Images/9ba963cbf9943c89aa2d14e3cb1957ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*tlqA5duiLWDTyy8B_Mq5yA.png"/></div></figure><p id="457e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者您可以在终端中执行此操作</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="a5a9" class="ju jv hi kv b fi kz la l lb lc">docker images</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/aa3d990768d46907ca9259af6ad4b1bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tiGCOUcjAJvAoX47wXLvtg.png"/></div></div></figure><p id="5b3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将向您显示系统中的所有docker图像。</p><h2 id="c71f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">运行:</h2><p id="fa4c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">要运行映像，请在终端中输入以下命令并设置端口</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="e8c1" class="ju jv hi kv b fi kz la l lb lc">docker run -p 9000:8080 &lt;image-name&gt;</span></pre><p id="f336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你这样做了，终端会显示这个</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="e6a3" class="ju jv hi kv b fi kz la l lb lc">docker run -p 9000:8080 idealoctopotato:latest                            <br/>time="2021-07-18T15:54:14.975" level=info msg="exec '/var/runtime/bootstrap' (cwd=/var/task, handler=)"</span></pre><p id="17bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这个映像运行在本地主机端口8080/tcp，9000是绑定地址。</p><p id="76c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列出容器图像:</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="44c1" class="ju jv hi kv b fi kz la l lb lc">docker container ls<br/>CONTAINER ID   IMAGE                    COMMAND                  CREATED         STATUS         PORTS                                       NAMES<br/>9c19c488f2dc   idealoctopotato:latest   "/lambda-entrypoint.…"   16 hours ago   Up 16 hours  0.0.0.0:9000-&gt;8080/tcp, :::9000-&gt;8080/tcp   dreamy_chebyshev</span></pre><p id="bf6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Vs代码docker扩展帮助你导航到图像目录，并验证文件和内容。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/6c54dfb824190c0d8de10a8ce3a0967d.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*Sm9m2uW9EuGCHJicEITtLw.png"/></div></figure><h2 id="2642" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">测试:</h2><p id="13a0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">打开另一个终端并键入</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="5a00" class="ju jv hi kv b fi kz la l lb lc">curl -XPOST "http://localhost:9000/2015-03-31/functions/function/invocations" -d "{}"</span></pre><p id="6d1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在容器内部启动app.py处理。</p><p id="14c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以切换回之前开始运行docker的终端，并在应用程序运行时查看其日志。</p><h2 id="ddad" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">什么是ECR</h2><p id="1d5b" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">来自AWS文档—</p><blockquote class="lz"><p id="07df" class="ma mb hi bd mc md me mf mg mh mi jc dx translated">Amazon Elastic Container Registry(<strong class="ak">ECR</strong>)是一个完全托管的容器注册中心，它使存储、管理、共享和部署容器映像变得容易</p></blockquote><p id="6c17" class="pw-post-body-paragraph if ig hi ih b ii mj ik il im mk io ip iq ml is it iu mm iw ix iy mn ja jb jc hb bi translated">因此，我们的想法是使用ECR并在我们刚刚在本地创建的云中托管docker映像。</p><h2 id="ae56" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">部署到ECR的步骤</h2><ol class=""><li id="9fcc" class="le lf hi ih b ii kp im kq iq ls iu lt iy lu jc lj lk ll lm bi translated">去亚马逊弹性容器注册处</li><li id="2322" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">创建一个私有库，因为lambda不支持公共库:</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/866ae95002835eda2dfa32f614c33bb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fMzhGERyY7tTiaFXF1Sigg.png"/></div></div></figure><p id="a78a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.现在使用这个命令登录并获得权限</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="aebe" class="ju jv hi kv b fi kz la l lb lc">aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin &lt;aws_account_id&gt;.dkr.ecr.us-east-1.amazonaws.com</span></pre><p id="442c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果一切正常，它应该会给你这个—</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="87a6" class="ju jv hi kv b fi kz la l lb lc">Login Succeeded</span></pre><p id="ce39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.接下来，使用此命令为您创建的图像添加一个标签</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="3c95" class="ju jv hi kv b fi kz la l lb lc">docker tag &lt;docker_image_id&gt; ecr_uri</span></pre><p id="8468" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图像id —可以通过在终端中运行<strong class="ih hj"> docker images </strong>并从图像中复制id来获得。</p><p id="2efd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ecr_uri —从控制台的存储库中复制uri。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/945bbb681141a39689de1ea445d5307c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dsrd2Y0-99Fbby1poEAQUQ.png"/></div></div></figure><p id="0f87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.运行这个命令将图像推送到AWS中的存储库。</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="596b" class="ju jv hi kv b fi kz la l lb lc">docker push ecr_uri</span></pre><p id="47ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你这样做了，你应该会看到这样的东西</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mq"><img src="../Images/049ceb2ad8648cf226e80ad89500f88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kfOCJiCNhzsKymJxL5bGpw.gif"/></div></figure><p id="4d20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当所有东西都被推动时，它会向你展示—</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="8473" class="ju jv hi kv b fi kz la l lb lc">latest: digest: sha256:2a0c7a019ddabaf92babxxxxxxxxxxxa1879e size: 3673</span></pre><p id="ec3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以刷新AWS控制台，并在那里看到带有您的图像的最新标记。</p><h2 id="f54b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">部署到AWS Lambda的步骤</h2><p id="dd0d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">现在你的图像在ECR中，打开Lambda控制台</p><ol class=""><li id="6019" class="le lf hi ih b ii ij im in iq lg iu lh iy li jc lj lk ll lm bi translated">在AWS lambda功能页面中选择容器图像选项。</li><li id="7136" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">把URI的形象和创造</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/50f6010c639adaea9ffc844991ce7d45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUE0HKFFMR0TSD92vWbAZA.png"/></div></div></figure><p id="314a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该看起来像</p><pre class="je jf jg jh fd ku kv kw kx aw ky bi"><span id="8f3b" class="ju jv hi kv b fi kz la l lb lc">aws_account_id.dkr.ecr.us-east-1.amazonaws.com/python-aws-docker:latest</span></pre><p id="c5ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦完成，它会向你展示这个—</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/1560855f7c10090250c5cce18f5751d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuBEYQOXUu_qNW-2jUGTLQ.png"/></div></div></figure><h2 id="993b" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">使用lambda测试</h2><ol class=""><li id="79e9" class="le lf hi ih b ii kp im kq iq ls iu lt iy lu jc lj lk ll lm bi translated">在AWS lambda Cloud9 ide中点击test，您可以看到与刚才在docker本地看到的相同的应用程序日志。</li><li id="86bb" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">访问S3，并通过下载验证pdf文件。</li><li id="b16e" class="le lf hi ih b ii ln im lo iq lp iu lq iy lr jc lj lk ll lm bi translated">查看云监控日志。</li></ol><p id="e996" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终的结果—</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/0afb09d93749d9e8fa461ec4b41ddc97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJqh9awMa95QAb9OdsNorQ.png"/></div></div></figure><p id="c061" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！您刚刚使用来自Amazon Elastic Container Registry的Docker容器图像构建了一个无服务器的Amazon Lambda函数，它将各种图像格式转换为驻留在S3的pdf。</p><h1 id="6d38" class="mu jv hi bd jw mv mw mx ka my mz na ke nb nc nd kh ne nf ng kk nh ni nj kn nk bi translated">关于作者:</h1><p id="5115" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我是Kuharan Bhowmik，我希望你喜欢这篇文章。上述工作仍在进行中，是目前托管在Github中的私有库。我欢迎任何相同的建议。</p><p id="da95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们贡献自己的一点知识，让互联网变得更美好。</p><h2 id="8e0d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">Github —</h2><div class="nl nm ez fb nn no"><a href="https://github.com/kuharan" rel="noopener  ugc nofollow" target="_blank"><div class="np ab dw"><div class="nq ab nr cl cj ns"><h2 class="bd hj fi z dy nt ea eb nu ed ef hh bi translated">库哈兰-概述</h2><div class="nv l"><h3 class="bd b fi z dy nt ea eb nu ed ef dx translated">数据工程师| Python | Azure | AWS |</h3></div><div class="nw l"><p class="bd b fp z dy nt ea eb nu ed ef dx translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jn no"/></div></div></a></div><h2 id="0193" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">LinkedIn —</h2><div class="nl nm ez fb nn no"><a href="https://www.linkedin.com/in/kuharan/" rel="noopener  ugc nofollow" target="_blank"><div class="np ab dw"><div class="nq ab nr cl cj ns"><h2 class="bd hj fi z dy nt ea eb nu ed ef hh bi translated">Kuharan Bhowmik -应用开发高级分析师-埃森哲| LinkedIn</h2><div class="nv l"><h3 class="bd b fi z dy nt ea eb nu ed ef dx translated">数据工程师:Python、PySpark、Powershell、Shell Script、AWS Lambda、Azure Data Factory、Azure ML、Azure Logic Apps……</h3></div><div class="nw l"><p class="bd b fp z dy nt ea eb nu ed ef dx translated">www.linkedin.com</p></div></div></div></a></div></div></div>    
</body>
</html>