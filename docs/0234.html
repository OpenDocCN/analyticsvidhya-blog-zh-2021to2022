<html>
<head>
<title>ML Model productionization using Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Heroku的ML模型生产</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ml-model-productionization-using-heroku-a809afd51d93?source=collection_archive---------9-----------------------#2021-01-09">https://medium.com/analytics-vidhya/ml-model-productionization-using-heroku-a809afd51d93?source=collection_archive---------9-----------------------#2021-01-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d5ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Heroku是一个自2007年以来一直在开发的平台即服务，由James Lindenbaum、Adam Wiggins和Orion Henry创建，最初只支持Ruby编程语言，但现在支持Java、Node.js、Scala、Clojure、Python、PHP和GO，使开发人员能够构建、运行和操作应用程序。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/65dd5e8c7bbd415361de67a9bfce2f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*CIv6YAXcT8oLls28xcg7mg.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx translated">Heroku@Twitter</figcaption></figure><p id="70a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博客中，我将向你解释使用基本的Flask API在Heroku上生产任何ML模型的步骤，这些API是我在进行微软恶意软件预测的自我案例研究后部署的。我希望你已经了解了<a class="ae jo" href="https://www.tutorialspoint.com/flask/index.htm" rel="noopener ugc nofollow" target="_blank">烧瓶</a>、<a class="ae jo" href="https://www.tutorialspoint.com/git/index.htm" rel="noopener ugc nofollow" target="_blank">吉特</a>和<a class="ae jo" href="https://docs.anaconda.com/anaconda/user-guide/getting-started/" rel="noopener ugc nofollow" target="_blank">蟒蛇</a>的基本知识。</p><p id="50ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于案例研究的更多详细信息，你可以关注我下面的博客，我已经详细解释了我是如何解决这个问题的。</p><div class="jp jq ez fb jr js"><a rel="noopener follow" target="_blank" href="/swlh/microsoft-malware-prediction-using-classical-machine-learning-algorithms-5ade962ca73a"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hi fi z dy jx ea eb jy ed ef hg bi translated">使用经典机器学习算法的微软恶意软件预测</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">作为自我案例研究的一部分，我选择了一个问题陈述微软恶意软件预测从Kaggle这是一个…</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg ji js"/></div></div></a></div><p id="64fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">起初，我创建了名为Malware_Prediction的虚拟环境，以便管理python包和在Heroku上轻松部署我的应用程序。</p><p id="3eb6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用anaconda开发flask api，所以我使用anaconda创建了<a class="ae jo" href="https://uoa-eresearch.github.io/eresearch-cookbook/recipe/2014/11/20/conda/" rel="noopener ugc nofollow" target="_blank">虚拟环境</a>并激活了该环境。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="85f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦虚拟环境被激活，我安装了运行flask应用程序所需的各种包。</p><p id="a8c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我将目录更改为app目录，其中整理了部署app所需的配置文件和app.py。</p><p id="4d81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">文件夹结构将是这样的:</p><pre class="jd je jf jg fd kj kk kl km aw kn bi"><span id="f799" class="ko kp hh kk b fi kq kr l ks kt">Malware_Prediction<br/>|- Templates<br/>    |- index.html<br/>|- app.py<br/>|- binary.npz<br/>|- categorical.npz<br/>|- highly_correlated_binary_features.npz<br/>|- highly_correlated_categorical_features.npz<br/>|- highly_correlated_numerical_features.npz<br/>|- lightgbm_best_model_after_feature_selection.pkl<br/> </span></pre><p id="4b27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">App.py是实际的flask应用程序代码文件，它将在Heroku上部署后执行。</p><p id="b9cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">模板文件夹将包含运行应用程序所需的所有模板。</p><p id="fbb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在更改目录并整理了app目录中所有需要的文件后，尝试在本地运行app并检查app是否运行良好，我也这样做是为了在Heroku上顺利部署并且没有任何问题。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="304c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本地运行和验证应用程序后，现在是生成requirements.txt文件的时候了。</p><p id="e30a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Requirements.txt文件是用于指定运行项目所需的python包的文件。</p><p id="ce07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有两种方法生成requirements.txt文件:</p><ol class=""><li id="99b2" class="ku kv hh ig b ih ii il im ip kw it kx ix ky jb kz la lb lc bi translated">手动指定需要哪些包</li><li id="e770" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">通过在虚拟环境中执行命令，在虚拟环境中专门安装了那些包来运行项目。</li></ol><p id="1268" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我使用第二种方法来生成requirements.txt文件。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="b558" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">生成requirements.txt文件后，为了在Heroku上部署应用程序，还需要创建一个重要文件，即Procfile。</p><p id="db02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Procfile指定了应用程序在启动时要执行的命令。Procfile始终是一个没有任何扩展名的简单文本文件。所以如果Procfile是用扩展名。txt，那么我们的应用程序将不会启动，所以请确保创建没有任何扩展名的Procfile。</p><p id="302e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Procfile具有以下格式:</p><pre class="jd je jf jg fd kj kk kl km aw kn bi"><span id="0451" class="ko kp hh kk b fi kq kr l ks kt">&lt;process type&gt;: &lt;command&gt;</span></pre><p id="5f97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我在我的windows 10操作系统中使用下面的命令创建了Procfile。</p><pre class="jd je jf jg fd kj kk kl km aw kn bi"><span id="22cf" class="ko kp hh kk b fi kq kr l ks kt">echo web: gunicorn app:app &gt; Procfile</span></pre><p id="8910" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上命令将创建名为Procfile的新文件，内容为<strong class="ig hi"> web: gunicorn app:app </strong></p><p id="6d29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的命令<strong class="ig hi">中，web </strong>指定了进程类型，该进程类型指定必须通过互联网访问应用程序。而<a class="ae jo" href="https://gunicorn.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> gunicorn </strong> </a>是基于WSGI的HTTP服务器，用于并行化流量。因此，它将使用<strong class="ig hi"> gunicorn app </strong>来执行，而不是执行flask API。最后一个<strong class="ig hi">应用</strong>是将要运行的实际应用文件名。</p><p id="ca38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以在创建requirements.txt和Procfile之后，文件夹结构现在是:</p><pre class="jd je jf jg fd kj kk kl km aw kn bi"><span id="d375" class="ko kp hh kk b fi kq kr l ks kt">Malware_Prediction<br/>|- Templates<br/>    |- index.html<br/>|- app.py<br/>|- binary.npz<br/>|- categorical.npz<br/>|- highly_correlated_binary_features.npz<br/>|- highly_correlated_categorical_features.npz<br/>|- highly_correlated_numerical_features.npz<br/>|- lightgbm_best_model_after_feature_selection.pkl<br/>|- requirements.txt<br/>|- Procfile</span></pre><p id="7562" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之后，登录<a class="ae jo" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>并创建新的应用程序，您可以选择一个区域来部署您的应用程序。我选择了美国。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es li"><img src="../Images/fa16505d40b8b5efdb4d8a67db1f52df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*whCWFhG3VnhYDvkPIHxSUQ.png"/></div></div></figure><p id="0ffd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建应用程序后，我们可以将此应用程序添加到pipeline，或者使用各种其他选项(如Heroku CLI、GITHUB和容器注册表)部署此应用程序。我使用Heroku CLI部署了这个应用程序。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ln"><img src="../Images/fe5929c78be0d33e713516d40e6e44f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOUxatUuGOT5wo6cCDYEWA.png"/></div></div></figure><p id="5c81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于要使用Heroku CLI部署的app，Git是一个先决条件，需要安装Git才能将本地repo推送到远程。</p><p id="9489" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是Heroku CLI和GIT的链接，可以下载不同的操作系统。</p><div class="jp jq ez fb jr js"><a href="https://git-scm.com/downloads" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hi fi z dy jx ea eb jy ed ef hg bi translated">下载</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">Git是软件自由保护协会的成员，该协会处理该项目的法律和财务需求。保护…</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">git-scm.com</p></div></div><div class="kb l"><div class="lo l kd ke kf kb kg ji js"/></div></div></a></div><div class="jp jq ez fb jr js"><a href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hi fi z dy jx ea eb jy ed ef hg bi translated">Heroku CLI</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">Heroku命令行界面(CLI)使得直接从终端创建和管理您的Heroku应用程序变得非常容易…</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">devcenter.heroku.com</p></div></div><div class="kb l"><div class="lp l kd ke kf kb kg ji js"/></div></div></a></div><p id="1795" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装Git和Heroku CLI后，我通过执行Git bash中的命令创建了Git存储库。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="1be0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建git存储库之后，现在使用下面的命令登录Heroku。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="e086" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，它会要求按任意键在浏览器中打开登录提示，然后输入详细信息，之后您就可以登录并执行Heroku CLI命令了。</p><p id="d7e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成功登录后，将我创建的本地回购添加到远程回购，即我们的应用程序中。推给了heroku。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="4be4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将存储库推送到heroku需要一些时间，这取决于要安装的包。</p><p id="9a63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">推送成功后，现在app部署在Heroku上。因此，为了检查你的应用程序的工作情况，在你的Heroku仪表盘的设置中，下拉到域部分，在那里你可以找到应用程序的URL。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lq"><img src="../Images/75442a4bb29fcff34abd5990d12513a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lG8u4I8krMM9wGw0z6f_xA.png"/></div></div></figure><p id="a903" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就是我如何在heroku上部署和生产我的ML模型。这是我部署的应用程序的<a class="ae jo" href="https://malware-prediction-flask-api.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><p id="326e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里是我的<a class="ae jo" href="https://github.com/jugaloza/Malware-prediction-Heroku" rel="noopener ugc nofollow" target="_blank">仓库</a>，在这里你可以找到在Heroku上部署我的ML模型的代码和必要文件。</p></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="f27c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你喜欢我的博客，别忘了鼓掌并关注我的更多更新。</p><p id="9608" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">欢迎提出改进这个博客的建议。</p><p id="a9a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以在<a class="ae jo" href="https://www.linkedin.com/in/jugal-oza-974048109/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上和我联系。</p><p id="8f7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>