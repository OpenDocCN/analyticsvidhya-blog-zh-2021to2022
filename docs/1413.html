<html>
<head>
<title>Jazz Music Improv With LSTM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LSTM爵士音乐即兴表演</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/jazz-music-improv-with-lstm-205db2c4ed3c?source=collection_archive---------17-----------------------#2021-02-28">https://medium.com/analytics-vidhya/jazz-music-improv-with-lstm-205db2c4ed3c?source=collection_archive---------17-----------------------#2021-02-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="04a1" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">背景:</h1><p id="1494" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">利用长短期记忆(LSTM)创作新颖的爵士乐独奏。</p><p id="6fad" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">该数据集是使用78个值的一代爵士乐的语料库。在这种情况下，价值观可以被认为是音符。</p><h1 id="56c3" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">构建和训练模型:</h1><p id="994c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这个模型被提议用来学习音乐模式，所以LSTM被设定了64维隐藏状态。然后为网络创建输入和输出层。</p><p id="7a78" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">接下来是创建一个djmodel()函数，它:</p><ol class=""><li id="f4ea" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">创建了空的输出列表，在每一步保存LSTM输出单元格。</li><li id="479a" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">使用for循环遍历LSTM层。其中包括:</li></ol><p id="c00a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">a.创建自定义lambda层。</p><p id="df8f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">b.使用reshapor图层重塑x变量。</p><p id="eccd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">c.执行LSTM单元的一个步骤</p><p id="7463" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">d.将densor应用于LSTM单元的隐藏状态输出。</p><p id="d0d1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Densor通过dense和softmax的组合传播LSTM输出激活值。</p><p id="1321" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">e.将预测值附加到输出列表。</p><p id="3902" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">3.已创建模型实例。</p><p id="7c46" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">我使用Adam optimizer和分类交叉熵损失定义并编译了该模型。然后使用100个时期来拟合和训练模型。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kt"><img src="../Images/0ccc7512eab439b488a29f2a001750b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EESVIa6J1OBQQZzb"/></div></div></figure><h1 id="da86" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">预测和采样:</h1><p id="b26f" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">使用经过训练的模式，我通过创建一个函数来合成新的音乐，该函数在每一步采样，将输入来自先前LSTM的激活和细胞状态，并向前传播一步，并获得新的输出和细胞状态。然后，可以使用densor使用这个新的激活来生成输出。</p><p id="8789" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">接下来，我定义了我的推理模型，它被硬编码以生成50个值，然后创建了用于初始化x和LSTM状态变量的零值向量。</p><p id="41d7" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">然后，我实现了predict_and_sample函数，该函数将输入作为其参数的一部分。为了预测对应于该输入的输出，I:</p><ol class=""><li id="cbb2" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">使用您的推理模型来预测我的输入集给出的输出，该输入集的输出变量“pred”是一个长度为20的列表，其中每个元素都是一个numpy数组。</li><li id="ab3b" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">已将“pred”转换为索引的numpy数组，每个对应的索引都是通过获取“pred”列表中某个元素的argmax来计算的。</li><li id="ca82" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">将索引转换成它们的独热向量表示。</li></ol><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lf"><img src="../Images/75a2443375827056732a54835265805d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LqGbhfdWhk6n3Yc_"/></div></div></figure><p id="7f70" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">最后，我使用调用generate music函数的变量out_stream生成了我的音乐，并将其保存到我的out_stream中。</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lg"><img src="../Images/acb5f87884cf9c15f943a2ac53ee853e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e31mh5XksUd835Xc"/></div></div></figure><p id="3651" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">生成的音乐是一个midi文件，我不得不使用在线文件转换器将其转换为mp3文件。这个文件被命名为my-music.mp3，可以在输出文件夹中找到。</p><h1 id="0de6" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">结论:</h1><p id="3d52" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这段代码最好在google colab上运行，由于一些依赖问题，我使用了tensor flow 1 . x . x版和Keras 2 . x . x版。这是我在数据科学和机器学习之旅中的一门课程中做的一个项目。存放所有需求的文件夹可以在我的<a class="ae lh" href="https://github.com/Nwosu-Ihueze/Music_improv" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到。可以通过<a class="ae lh" href="https://www.linkedin.com/in/rosemary-nwosu-ihueze/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae lh" href="https://twitter.com/adaihueze" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我。感谢您的阅读。</p></div></div>    
</body>
</html>