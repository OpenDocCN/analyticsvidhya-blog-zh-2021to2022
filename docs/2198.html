<html>
<head>
<title>Unraveling Statistics Behind Floyd-Steinberg Dithering in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开弗洛伊德-斯坦伯格抖动背后的统计数字</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/unraveling-statistics-behind-floyd-steinberg-dithering-in-r-ca4467cbde3f?source=collection_archive---------18-----------------------#2021-04-11">https://medium.com/analytics-vidhya/unraveling-statistics-behind-floyd-steinberg-dithering-in-r-ca4467cbde3f?source=collection_archive---------18-----------------------#2021-04-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5d32d8993dc5339458a326a84f939332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YuXwklIM6XDaJbkE"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">巴德·赫利松在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><blockquote class="iu iv iw"><p id="806c" class="ix iy iz ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated"><em class="hh">un</em><strong class="ja hi"><em class="hh"/></strong><em class="hh">rav</em><strong class="ja hi"><em class="hh"/></strong><em class="hh">El</em>(ŭn-răv'əl)v .<strong class="ja hi"><em class="hh">un rav eled un rav El ing un rav els</em></strong><em class="hh">~</em><strong class="ja hi"><em class="hh"/></strong><em class="hh">阐明神秘或令人困惑的事物的要素</em></p></blockquote><p id="a947" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">自从我的第一篇<a class="ae it" rel="noopener" href="/swlh/exploiting-the-floyd-steinberg-algorithm-for-image-dithering-in-r-c19c8008fc99">文章</a>以来，我已经有一段时间了，我选择写关于相对不熟悉的弗洛伊德-斯坦伯格抖动算法。如果我的帖子叫做<em class="iz">我如何利用深度学习成为一名成功的投资者</em>之类的话，很可能会有更多的人阅读我的帖子……为了吸引至少一些读者，我决定尽可能地让《抖动》面向实际、易于理解，这似乎奏效了！观众统计远远好于预期，所以可能我的下一篇文章应该是贝叶斯的东西。然而，在我真诚地热情向你们展示罗伯特·w·弗洛伊德和路易斯·斯坦伯格算法的优雅时，我确实跳过了一些非常有趣的统计细节。太可惜了！在这篇文章中，我真的希望通过解释排列以及我们如何利用它们来挑选最佳调色板来弥补这一缺陷。让我们来揭开谜底！</p></div><div class="ab cl jz ka go kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ha hb hc hd he"><h2 id="3a5f" class="kg kh hh bd ki kj kk kl km kn ko kp kq jw kr ks kt jx ku kv kw jy kx ky kz la bi translated">图像抖动:快速回顾</h2><p id="756e" class="pw-post-body-paragraph ix iy hh ja b jb lb jd je jf lc jh ji jw ld jl jm jx le jp jq jy lf jt ju jv ha bi translated">概括来说，这里是我之前帖子的一个超级小总结:我们利用弗洛伊德-斯坦伯格算法创建了一个有吸引力的Quokka Quinten表示，尽管只使用了3位调色板。从图形上看，结果是这样的:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lg"><img src="../Images/0392f041d9da5b23751b9c7860338eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPud1M9Ymcf1nvgSsKdEzQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">完整与3位与3位抖动Quokka Quinten。多酷啊！</figcaption></figure><p id="d917" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">毫无疑问，抖动算法提供了一种极大地改善普通3位表示的方法。尤其是表面看的时候，结果还挺刺眼的！然而，仔细观察会发现相当多的人工制品，我们甚至可以看到一些绿色和红色的点。一个可能的解决方案是将我们的调色板扩展到例如6位，这意味着能够从2⁶ = 64种颜色中进行选择。毫无疑问，我们极大地改善了图像，因为我们有八倍多的颜色可以使用。既然一张图胜过千言万语，下面就用图形来描绘这个故事:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es ll"><img src="../Images/8cc61352d1bf69c4f0624b584ca67b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*hgL43oZS3nMG9bFGfKoIxw.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">3位抖动与6位抖动</figcaption></figure><p id="19fa" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">不言而喻，使用越来越广泛的调色板也会产生越来越漂亮的图像，但它以一定的成本(例如，计算时间、数据存储)为代价，这不会让你感到惊讶。嗯，听起来我们遇到了一个有趣的交易！一种可能的策略是，只观察一些使用不同大小调色板抖动的图像，查看它们的存储大小，并决定要使用的最佳颜色数量。当然有更好的——也是最重要的:统计上更合理的——方法来解决这个问题。为此，我们利用了对三个概念的基本理解:损失函数、排列和“成本”的客观标准——缺口统计量。</p><h2 id="8980" class="kg kh hh bd ki kj kk kl km kn ko kp kq jw kr ks kt jx ku kv kw jy kx ky kz la bi translated">构建损失函数</h2><p id="f3ea" class="pw-post-body-paragraph ix iy hh ja b jb lb jd je jf lc jh ji jw ld jl jm jx le jp jq jy lf jt ju jv ha bi translated">当我们谈论任何优化问题时，首先想到的是损失函数的概念。机器学习中最著名的损失函数之一是回归问题的均方误差(MSE)和分类任务的交叉熵。对于Floyd-Steinberg算法，我们不能使用现有的函数，所以我们必须更有创造性。振作起来…</p><p id="0851" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">设<strong class="ja hi"> R </strong>为一幅图像的行指示符集合(除第一行外)<strong class="ja hi"> C </strong>为列指示符集合(除第一列和最后一列外)。像素<strong class="ja hi"> x </strong> ᵢⱼ的扩散误差<strong class="ja hi"> e </strong> ᵢⱼ <strong class="ja hi"> </strong>现在可以定义为</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es lm"><img src="../Images/cf5ce21cc6e771e5e876171cb65504ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*B3qCaYI3ktR_yZvf6d93BA.png"/></div></figure><p id="ffd5" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">用<strong class="ja hi"> 1 </strong> ( <em class="iz"> ij </em>)指示器功能对行(<strong class="ja hi"> R </strong>)或列(<strong class="ja hi"> C </strong>)和<strong class="ja hi"> c </strong> ₖ从<em class="iz"> K </em>调色板中选择一种特定颜色。现在，随着扩散误差<strong class="ja hi"> e </strong> ᵢⱼ变得显式，我们将<strong class="ja hi"> ĉ </strong> ₖᵢⱼ定义为像素<strong class="ja hi"> x </strong> ᵢⱼ的对应颜色，其最小化了<strong class="ja hi"> e </strong> ᵢⱼ.的欧几里德范数在公式中:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/e37ef8a1587b8b6ba994c285330e1071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MRxCj69ZEcjVwB-HzlhGwA.png"/></div></div></figure><p id="deff" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">如果你不遵循数学，不要担心！到目前为止，我们只是用一种奇特的方式写下了<strong class="ja hi"> ĉ </strong> ₖᵢⱼ是调色板中像素<strong class="ja hi"> x </strong> ᵢⱼ.最接近的颜色这种形式化，再加上我们可以在计算<strong class="ja hi"> e </strong> ᵢⱼ的公式中使用<strong class="ja hi"> ĉ </strong> ₖᵢⱼ而不是<strong class="ja hi"> c </strong> ₖ的事实，产生了我们的损失函数:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es lo"><img src="../Images/9a383456e4c4cbfe7fc5e2d86aedb55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*mkTytSkW-4mfLKt9vud0tw.png"/></div></figure><p id="ad0c" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">其中x代表所有像素的集合，c代表 ₖ，a代表<em class="iz"> K </em> ×3矩阵，其中每行存储一个<em class="iz"> K </em>颜色向量。换句话说，总损耗定义为误差平方和！</p><p id="8f1b" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">好了，现在让我们休息一下，让数学沉淀下来……是时候把我们的注意力转向一个更容易理解的话题了:排列。</p><h2 id="73a8" class="kg kh hh bd ki kj kk kl km kn ko kp kq jw kr ks kt jx ku kv kw jy kx ky kz la bi translated">排列</h2><p id="2036" class="pw-post-body-paragraph ix iy hh ja b jb lb jd je jf lc jh ji jw ld jl jm jx le jp jq jy lf jt ju jv ha bi translated">从全局意义上来说，排列是对象的(随机)重新排列，在统计学中广泛用于执行例如显著性测试。现在，在这个特定的图像抖动上下文中，我们可以假设Quokka Quinten是像素的随机重排。这导致了相当嘈杂的画面:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/2f670afe7ae454a4bdcb8496403de6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9we9Jxlr0nVUTNt5H5ycig.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">阔卡昆腾图像的置换版本。</figcaption></figure><p id="e92b" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">这种图像可能有用的原因是，它作为另一种工具，将优化形式化为统计上明确定义的问题。假设我们将这个随机的像素集合称为零假设(<em class="iz"> H₀ </em>)。在这种假设下，我们闪闪发光的昆腾图片就像所有其他<em class="iz"> N </em>一样有可能！图片的置换版本，像素数量为<em class="iz"> N </em>。对于我们选择的任何调色板，我们也可以在<em class="iz"> H₀ </em>下的置换图片上应用弗洛伊德-斯坦伯格算法，并计算损失函数的值。通过重复这个过程数百次并对结果取平均，我们获得了平均损失价值的估计，或者像统计学家喜欢说的:我们获得了在<em class="iz"> H₀.下<strong class="ja hi">预期</strong> <em class="iz"> </em>损失的估计</em>现在我们真的有所进展了，所以让我们把最后缺失的部分放回原位，完成我们的拼图吧！</p><h2 id="af00" class="kg kh hh bd ki kj kk kl km kn ko kp kq jw kr ks kt jx ku kv kw jy kx ky kz la bi translated">差距统计</h2><p id="e3c6" class="pw-post-body-paragraph ix iy hh ja b jb lb jd je jf lc jh ji jw ld jl jm jx le jp jq jy lf jt ju jv ha bi translated">排列允许我们获得不同调色板在<em class="iz"> H₀ </em>下的预期损失的估计值。问题的关键在于这一预期损失与我们观察到的Quokka Quinten图像的损失值的比较。对于更大的<em class="iz"> K </em>(记住，<em class="iz"> K </em>是我们调色板中的颜色数量)，损失值会降低，这并不奇怪，但是对于预期损失和观察到的损失之间的<em class="iz">差异</em>来说，这不一定是真的。正是这种差异定义了差距统计:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es lq"><img src="../Images/69cb140574864a3d22f9d0a22426827b.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*AoyMDDVcZMI0o4B-mgw0Og.png"/></div></figure><h2 id="6364" class="kg kh hh bd ki kj kk kl km kn ko kp kq jw kr ks kt jx ku kv kw jy kx ky kz la bi translated">选择最佳调色板</h2><p id="83d9" class="pw-post-body-paragraph ix iy hh ja b jb lb jd je jf lc jh ji jw ld jl jm jx le jp jq jy lf jt ju jv ha bi translated">有了这个间隙统计，在调色板中选择最佳颜色数量的问题可以公式化为使这个间隙统计最大化的<em class="iz"> K </em>的值:</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es lr"><img src="../Images/4d26546628cac96ff90da0a2a8a5798a.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/1*x03yIPpzEL7OItWJgiLEkQ.png"/></div></figure><p id="103d" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">唯一剩下的事情是通过绘制损失值和差距统计数据与调色板中的颜色数量来可视化结果。下图展示了这个想法。我们清楚地看到损失值的下降趋势(左窗格)，以及缺口统计的非线性曲线。显然，Floyd-Steinberg抖动算法比相同像素的随机重新排列更好地表现了结构化的图片，如我们的Quokka Quinten。</p><figure class="lh li lj lk fd ii er es paragraph-image"><div class="er es ls"><img src="../Images/eb078683a1e0cedeeee6e40c44ac76ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*-pbYbKra7bYIMpvcNgLJWg.png"/></div></figure><p id="7568" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">pfieuw……重新表述我们的问题是一个艰难的过程，这样我们就能够选择最佳的颜色数量。我真诚地希望它没有分散我们的注意力，我们可以用这种迷人的方式将统计数据应用到工作中，并帮助我们解决复杂的问题！</p></div><div class="ab cl jz ka go kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="ha hb hc hd he"><p id="b1ae" class="pw-post-body-paragraph ix iy hh ja b jb jc jd je jf jg jh ji jw jk jl jm jx jo jp jq jy js jt ju jv ha bi translated">完整源代码:<a class="ae it" href="https://github.com/justinkraaijenbrink/imagedithering" rel="noopener ugc nofollow" target="_blank">https://github.com/justinkraaijenbrink/imagedithering</a></p></div></div>    
</body>
</html>