<html>
<head>
<title>Solution Architectures for Computer Vision Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">计算机视觉项目的解决方案架构</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/solution-architectures-for-computer-vision-projects-31754b4dad09?source=collection_archive---------3-----------------------#2021-08-13">https://medium.com/analytics-vidhya/solution-architectures-for-computer-vision-projects-31754b4dad09?source=collection_archive---------3-----------------------#2021-08-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="e5ff" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">关于可用于部署计算机视觉解决方案的各种工程架构的文章</h2></div><p id="2c63" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最近，一位同事与我讨论了他可以用来部署计算机视觉解决方案的各种架构。我们坐下来，创建了一个列表，我觉得在这里分享会很好。请分享你的想法。</p><p id="c078" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">我们正在讨论部署基于深度学习的计算机视觉解决方案的最佳方式。有许多利弊需要考虑，这里列出了可供工程师使用的各种架构。</em></p><h1 id="96c1" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">介绍</h1><p id="ea6f" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated">计算机视觉技术可以大致分为各种不同的用例，如图像分类、对象检测、深度感知、图像生成等。像OCR、人脸识别这样的需求通常可以归入这些模块中的一个。本文档列出了可用于部署这些用例的解决方案的各种体系结构。</p><p id="3760" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一般来说，可以使用以下方法之一来设计解决方案。每个解决方案都有成本与性能的权衡，并选择适合您的解决方案。</p><ol class=""><li id="d7c0" class="kq kr hh iy b iz ja jc jd jf ks jj kt jn ku jr kv kw kx ky bi translated">在PC上运行</li></ol><ul class=""><li id="9559" class="kq kr hh iy b iz ja jc jd jf ks jj kt jn ku jr kz kw kx ky bi translated">CPU与GPU</li></ul><p id="6014" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">2.视频流的集中处理</p><ul class=""><li id="4d57" class="kq kr hh iy b iz ja jc jd jf ks jj kt jn ku jr kz kw kx ky bi translated">专用服务器</li><li id="e876" class="kq kr hh iy b iz la jc lb jf lc jj ld jn le jr kz kw kx ky bi translated">云CPU、云GPU、云vpu</li><li id="8348" class="kq kr hh iy b iz la jc lb jf lc jj ld jn le jr kz kw kx ky bi translated">现成的解决方案</li></ul><p id="c907" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">3.边缘计算选项</p><ul class=""><li id="73ae" class="kq kr hh iy b iz ja jc jd jf ks jj kt jn ku jr kz kw kx ky bi translated">英特尔OpenVino</li><li id="4f1c" class="kq kr hh iy b iz la jc lb jf lc jj ld jn le jr kz kw kx ky bi translated">高通·SNPE</li></ul><p id="1d82" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，我将把计算机视觉的整个过程分成两部分。一个是模型训练，一个是模型推理。最有趣的方面发生在这两个领域。我在这里的讨论大部分限于推理。我也将简单地谈一下培训。</p><p id="ab7e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">范围之外:关于单个算法/模型的优点/缺点的讨论超出了本次讨论的范围。除非这样的模型/算法不适合特定的架构，否则我将远离任何关于模型/算法比较的讨论。换句话说，如果你想知道《盗梦空间》和《Resnet》的对比，那么这篇文章不适合你。</p><h1 id="c91d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">术语的歧义消除</h1><p id="edb9" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated">经典的计算机视觉算法:我把所有非深度学习算法都包括进来了。无论是用于改变颜色空间还是用于模式识别，如果它不是基于深度学习，我会将它们包括在“经典”的定义中</p><p id="eb0d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">深度学习模型:不管用于构建它们的框架是什么(如Pytorch、Tensorflow或plain C++)，如果模型使用基于感知器和CNN的方法，我将把它们称为深度学习模型。无论是你从零开始写的浅网络还是超深网络，对我来说都是深度学习的典范。</p><h1 id="87da" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">建筑流程</h1><p id="b142" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated">训练和推理的架构组件可以描述如下。类似于任何软件项目，训练ala开发在时间上与推理ala生产分开。</p><p id="a0a0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">基于经典算法的系统</p><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lf"><img src="../Images/059fc0e158442866336cd9ed3c344e9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OSom33GxPS5v4Zcoi7Fpdw.jpeg"/></div></div></figure><p id="7f89" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是大多数软件开发人员所习惯的。在这种架构中，部署意味着将代码部署到生产环境中。</p><h2 id="de5e" class="lr ju hh bd jv ls lt lu jz lv lw lx kd jf ly lz kf jj ma mb kh jn mc md kj me bi translated">基于深度学习的系统</h2><figure class="lg lh li lj fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lf"><img src="../Images/ff4a7508bb39c4047e446aab74b1fe8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5poiwk-ZlBE2GeIeOtgjQ.jpeg"/></div></div></figure><p id="77ce" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意到区别了吗？</p><h1 id="3602" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">模特培训</h1><h1 id="b77c" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">经典算法</h1><p id="217d" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated">这种方法中的训练是所有开发人员都觉得最自然的古老方法。在这种架构中，模型是在启发式地识别算法的参数之后建立的。训练的人工制品是代码，(无论是Python还是Java，还是优秀的C语言)。</p><h1 id="9e96" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">深度学习模型</h1><p id="2bb2" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated">这种情况下的训练也相当简单。无论您是执行迁移学习还是从头构建网络，您都可以在本地或云的高性能机器上训练模型。利用GPU可以显著减少训练时间。参考这篇论文进行研究。[https://web . Stanford . edu/~ rezab/classes/CME 323/S16/projects _ reports/hedge _ us mani . pdf]</p><p id="4889" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有研究论文探索深度学习的并行和分布式计算方法。但这还不是主流。因此，我不在这里进一步讨论它们。此外，本文的重点是推理。</p><h1 id="9f96" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">模型推理</h1><p id="d07a" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated">无论我们使用什么技术，都有一个地方可以捕捉图像并将其转换成色彩空间矩阵。(RGB、CMY等)。这是一个数字表示，使监视器能够显示捕获的信息。推理就是要理解这些数字。</p><p id="e1ff" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有多种方法可以对计算机视觉解决方案进行推理。硬件架构的选择对解决方案的资本支出、运营支出和质量有重大影响。仔细评估这些参数对于理解消费者的价值收益至关重要。</p><p id="bc19" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看一下图像数据需要如何推理。离线图像处理(照片上传到云驱动器等。)并在以后处理，或者实时处理，其中来自摄像机的视频帧被连续处理。无论您的业务需求是什么，您都需要评估交付成功产品的成本影响。</p><p id="b3fa" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有多种方法来设计产品。每种方法都有技术和财务影响。我在这里捕捉了一些。</p><h1 id="4d4a" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">风景</h1><h2 id="b5b3" class="lr ju hh bd jv ls lt lu jz lv lw lx kd jf ly lz kf jj ma mb kh jn mc md kj me bi translated">经典图像处理技术</h2><p id="51d4" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated"><strong class="iy hi">本地推理</strong></p><p id="58d2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这种情况下，摄像机直接连接到运行代码的机器。这在控制硬件和软件方面提供了很大的灵活性，但不可避免地受到主机硬件能力的限制。出于实际考虑，摄像机不能离主机太远。想象一下，运行200/300米长的摄像机线，以便可以对乘客进行面部识别。通过互联网流式传输视频帧解决了这个问题，但增加了额外的复杂性。此外，当有多个摄像机输入需要分析时，它不能很好地缩放。CPU限制总是很快达到。</p><p id="c170" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">云</strong></p><p id="e15a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">与本地机器相比，云提供了极大的简化。然而，云并不是“免费”的。这当然是负担得起的，但不是免费的。甚至可能不便宜。你必须仔细构建你的lamba函数等，以确保最佳的响应时间。</p><p id="fd1e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，在处理视频帧时，还必须考虑网络延迟。您的摄像头可能位于您的保时捷车头。但是，如果云服务器运行在几百英里以外的数据中心，那么您的解决方案就必须考虑网络延迟。</p><p id="4fab" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">深度学习技术</strong></p><p id="8818" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一般来说，基于深度学习的模型可以为您的模型提供更好的准确性。然而，深度学习模型也很慢，CPU饥饿和内存猪。业内有多种方法来解决这些问题，并提出一个漂亮的解决方案。</p><p id="f02f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">本地CPU</strong></p><p id="ccd9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">深度学习解决方案可以在相机连接的同一台机器上运行。这对于图像不允许离开计算机(可能出于法律或隐私原因)的特殊活动来说是非常好的。在这种情况下，扩展成为一个挑战。随着深度学习模型的CPU大量数据处理，添加第二个和第三个摄像头将成倍增加成本。</p><p id="733a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">本地GPU</strong></p><p id="7f42" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">GPU非常适合减少深度学习模型的计算时间。它们几乎神奇地提高了运行时性能。请注意，GPU不会影响算法的性能。它们只会影响运行时性能。</p><ul class=""><li id="c46b" class="kq kr hh iy b iz ja jc jd jf ks jj kt jn ku jr kz kw kx ky bi translated">NVIDIA GPUs:所有GPU中最著名的。使用CUDA编程，您可以利用GPU的强大功能。但是，CUDA仅限于NVIDIA GPUs。</li><li id="3dd0" class="kq kr hh iy b iz la jc lb jf lc jj ld jn le jr kz kw kx ky bi translated">英特尔GPU:许多最新的笔记本电脑都在主板上集成了英特尔GPU。唉，没人用。我参加了一个关于OpenVINO使用的英特尔培训项目，培训师承认“他们中的大多数可能都闲置在你的系统中”。这大约是2020年初。从那时起，英特尔已经投资了数百万美元来改变这一局面。</li></ul><p id="7c1b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">云</strong></p><p id="47f9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">云CPU和GPU与我上面描述的本地CPU是一样的。除此之外，我从未听说过云中有英特尔GPU。除了NVIDIA GPUs，云上还有视觉处理单元和张量处理单元，它们将执行与GPU相同的功能，并减少您的延迟时间。</p><p id="04d5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">边缘计算</strong></p><p id="6187" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">无论你是在本地网络还是云端处理深度学习，都不可避免地受到机器CPU能力的制约。增加CPU能力的成本是指数级的。此外，网络成本也会推高您的运营支出。有没有一种方法可以在不倾家荡产的情况下实现你的目标？</p><p id="9a5e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">答案是像英特尔Movidius(神经计算棒)，高通骁龙等专用设备。在这种情况下，推理处理被卸载到这些连接到计算机的专用设备上。它们有各种形状和设计，从集成到主板到即插即用USB接口棒。</p><p id="38ea" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用一些特殊的编码，可以将深度神经网络的推理处理卸载到这些设备上，并保持CPU空闲。这些设备便宜、便携，更重要的是，提供了边缘计算设施。所以，与其把你的整个视频帧发送到云中的CPU，不如在边缘设备上处理帧，只把推断结果发送到主服务器。因此，服务器不是处理整个图像，而是简单地处理图像中有一辆汽车、一只猫和一只老鼠的信息。这是非常简单的，也很容易控制你的预算。如果边缘设备损坏，更换它们也不会太贵。</p><p id="2c58" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是，有一个问题。这些边缘设备无法处理你可能想到的任何随机神经网络。它们支持预定义的网络列表，如Inception、YOLO等。作为开发人员，你可以自由地进行迁移学习，并针对你选择的对象对它们进行训练。但是如果你想从头开始构建一个定制的网络，你可能需要在激活功能、层的类型等方面做出一些妥协。也就是说，这是一个动态发展的领域，竞争正在推动公司更快地创新。就个人而言，这是我对计算机视觉领域将如何发展的打赌。</p><h1 id="87e4" class="jt ju hh bd jv jw jx jy jz ka kb kc kd in ke io kf iq kg ir kh it ki iu kj kk bi translated">常见的权衡</h1><p id="575d" class="pw-post-body-paragraph iw ix hh iy b iz kl ii jb jc km il je jf kn jh ji jj ko jl jm jn kp jp jq jr ha bi translated"><strong class="iy hi">响应速度与成本</strong></p><p id="423f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">无论您选择哪种体系结构，总会有一个关于响应性与成本的权衡决策。我看到很多人都没有意识到这一点。所以，我就写在这里吧。</p><p id="634a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">视频流是一系列图像。每个摄像机都有帧率。帧速率是每秒捕获的图像数量。帧速率越高，对象在屏幕上的移动就越真实。每秒24帧，你会得到我们在电视和电影中看到的真实动作。这对你来说意味着，当处理视频帧时，我们必须每秒处理24幅图像。现在，深度学习网络非常需要CPU，处理一帧需要3-4秒。因此，当您处理一个帧时，队列中已经有24 * 3–1 = 71个帧。在几秒钟内，您正在处理一个已经过时几分钟的帧。你的解决方案不再是实时的了。迁移到GPU会让你的处理时间减少到一秒以内，但不是1/24秒(至少在写这篇文章的时候是这样)。无论你选择CPU、GPU、VPU、TPU还是Edge设备，这个问题依然存在。一种方法是仅处理每n个帧中的1个帧，并跳过剩余的帧。如果您正确选择了您的架构(考虑到上述所有选项)，您的n可以非常小，并且几乎是实时的。</p><p id="3337" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">硬件的选择</strong></p><p id="e1de" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您选择的硬件将在更大程度上影响您的解决方案，而不仅仅是成本。GPU vs CPU vs Cloud Vs Edge的选择也涉及到产品经理。为什么？在关于边缘计算的部分，我提到了涉及算法选择的妥协。这些选择会影响模型的准确性和有效性。这就是产品经理必须介入并权衡多少准确度损失是可接受的。</p><p id="7504" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有一个问题。一旦你选择了你的平台(CPU或GPU或VPU)，很难把它移植到另一个平台上。平台、语言和内部结构显然是互不兼容的。OpenCL声称引入了互操作性，但尚未兑现承诺。在做出架构决策时，必须仔细考虑这些细微差别。</p></div></div>    
</body>
</html>