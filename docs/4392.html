<html>
<head>
<title>Unlocking Resnets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解锁资源网</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/opening-resnets-46bb28f43b25?source=collection_archive---------9-----------------------#2021-10-04">https://medium.com/analytics-vidhya/opening-resnets-46bb28f43b25?source=collection_archive---------9-----------------------#2021-10-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="196c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">一步一步探索在一张残影网上发生了什么</em> </strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/de9e7cd7d539fc4f9abe21aa8deab373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnoNVpj7uCNMOFOj1DQBQA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Resnet34网摘自<a class="ae ju" href="https://arxiv.org/pdf/1512.03385.pdf" rel="noopener ugc nofollow" target="_blank">原创论文</a></figcaption></figure><p id="5976" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软研究院的、何、、、任和在他们的开创性论文——<a class="ae ju" href="https://arxiv.org/pdf/1512.03385.pdf" rel="noopener ugc nofollow" target="_blank">图像识别的深度残差学习</a>中介绍了残差网络。Resnets有效地解决了深度网络的消失梯度问题，并且从那时起，他们引入的思想已经被用于多种架构中。</p><p id="ef0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最近的一次任务中，我的任务是理解Resnets是如何工作的，并展示同样的内容。我很好奇，想知道Resnet中的一幅图像到底发生了什么，并试图找出同样的答案。这篇博客文章是这个实验的结果，并试图说明Resnet架构内部发生的各种计算。</p><blockquote class="jv jw jx"><p id="60e7" class="if ig jd ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">在我们开始之前，我几乎可以肯定这篇文章会有错误。我已经尽力去消除它们了。然而，如果你发现任何错误，请让我在评论中知道，或者亲自发邮件到这里<a class="ae ju" href="mailto:anup20joseph@gmail.com" rel="noopener ugc nofollow" target="_blank"/>，我会尽快改正。</p></blockquote><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kb"><img src="../Images/6b6e7e04fd2cfbaefb2056ee5692dcd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*40mfiWhVCFh1gRSvOtIbMA.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Resnet架构</figcaption></figure><p id="1d0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Resnet论文很有帮助地提供了将网络分成块并显示每个块的输出大小的图表。然而，这张图可能会让人认为，从块2到块5，stride在网络中是常见的，但事实并非如此。我们还需要看看论文中给出的Resnet 34网络。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kc"><img src="../Images/44ac4881a207c970cc32421cd113d43f.png" data-original-src="https://miro.medium.com/v2/resize:fit:172/format:webp/1*Gj17mue5m4taW4OgsusNYw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">具有剩余连接的Resnet 34架构</figcaption></figure><p id="98ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此图像添加了早期图像中缺失的关于步幅的重要信息。然而，这没有早期图像的简洁的块结构，所以我建议将它们都放在手边。在计算图像尺寸时，还有一个更重要的有用信息。该论文将此表述为</p><p id="bdee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我们对所有快捷方式使用身份映射，对增加的维度使用零填充。</em></p><p id="a75a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我觉得Resnet的(旧)Tensorflow实现中的这一点Python更有帮助。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kd ke l"/></div></figure><p id="ee29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个很好的规则，用于在块1之后通过架构进行计算，而不必每次都考虑它。想知道什么是<em class="jd"> padding="SAME" </em>和<em class="jd"> padding="VALID" </em>的人可以试试这个<a class="ae ju" href="https://stackoverflow.com/questions/37674306/what-is-the-difference-between-same-and-valid-padding-in-tf-nn-max-pool-of-t" rel="noopener ugc nofollow" target="_blank">链接</a>。有了这些信息，让我们开始工作吧。</p><p id="2e07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输入图像尺寸— (224，224，3)</p></div><div class="ab cl kf kg gp kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hb hc hd he hf"><h1 id="092f" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">模块1: conv1</h1><p id="9f1c" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">第1层:卷积(过滤器=64，内核大小=7x7，步长=2)</p><p id="0b08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要计算卷积图层中的输出大小，我们使用以下公式:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lp"><img src="../Images/a4ad439e4f7ed5552530f41f667644f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dU2lO1xbuoQwxRGNX2chVw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">卷积输出公式</figcaption></figure><p id="7952" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于第一个输入，上述规则不适用，填充为2。</p><p id="2ab0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(224–7+2 * 2)/2+1 = 111.5≈112。</p><p id="838d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该块的最终输出大小= (112x112x64)</p><h1 id="777c" class="km kn hi bd ko kp lq kr ks kt lr kv kw kx ls kz la lb lt ld le lf lu lh li lj bi translated">模块2: conv2_x</h1><p id="97ba" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">第1层:最大池(内核大小=3x3，步长=2)</p><p id="f353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要计算最大池层中的输出大小，我们使用以下公式</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lv"><img src="../Images/e48f4413cb02fe591c114a60da16e5b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*35h6s7hsri1W_rNWCxC7nA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">最大池公式</figcaption></figure><p id="079b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(112–3)/2+1 = 56</p><p id="0ab7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出尺寸= (56x56x64)</p><p id="3a45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2层:卷积(过滤器=64，内核大小=3x3，步长=1)</p><p id="b7ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(56–3+2 x 1)/1+1 = 55.5≈56</p><p id="d0cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小= (56x6x64)</p><p id="1523" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有5个卷积层(过滤器=64，内核大小= 3×3，步长=1)。从上面的计算中可以看出，这不会对图像进行缩减像素采样，因此输出大小保持不变。因此，该模块的输出为(56x56x64)。</p><h1 id="d001" class="km kn hi bd ko kp lq kr ks kt lr kv kw kx ls kz la lb lt ld le lf lu lh li lj bi translated">模块3: conv3_x</h1><p id="6175" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">第1层:卷积(过滤器=128，内核大小= 3×3，步长=2)</p><p id="89f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(56–3+2 x 0)/2+1 = 27.5≈28</p><p id="f107" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出尺寸= (28x28x128)</p><p id="f481" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2层:卷积(过滤器=128，内核大小= 3×3，步长=1)</p><p id="39cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(28–3+2 x 1)/1+1 = 28</p><p id="2291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出尺寸= (28x28x128)</p><p id="a8f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有6个卷积层(过滤器=128，内核大小= 3×3，步长=1)。同样，这不会对图像进行缩减采样，因此输出大小保持不变。因此，这个块的输出是(28x28x128)。</p><h1 id="5502" class="km kn hi bd ko kp lq kr ks kt lr kv kw kx ls kz la lb lt ld le lf lu lh li lj bi translated">模块4: conv4_x</h1><p id="8e4a" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">第1层:卷积(过滤器=256，内核大小=3x3，步长=2)</p><p id="8dd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(28–3+2 x 0)/2+1 = 13.5≈14</p><p id="1f2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小= (14x14x256)</p><p id="85b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2层:卷积(过滤器=256，内核大小=3x3，步长=1)</p><p id="92b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(14–3+2 x 1)/1+1 = 14</p><p id="1a4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小= (14x14x256)</p><p id="ef74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有10个卷积层(过滤器=256，内核大小= 3×3，步长=1)。和上面一样，输出大小保持不变。所以最终输出大小= (14x14x256)。</p><h1 id="dc80" class="km kn hi bd ko kp lq kr ks kt lr kv kw kx ls kz la lb lt ld le lf lu lh li lj bi translated">模块5: conv5_x</h1><p id="fd6f" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">第1层:卷积(过滤器=512，内核大小=3x3，步长=2)</p><p id="fb13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(14–3+2 x 0)/2+1 = 6.5≈7</p><p id="8581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小= (7x7x512)</p><p id="09e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第2层:卷积(过滤器=512，内核大小=3x3，步长=1)</p><p id="9861" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小=(7–3+2 x1)/1+1 = 7</p><p id="fc13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出大小= (7x7x512)</p><p id="e089" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有4个卷积层(过滤器=512，内核大小= 3×3，步长=1)。和上面一样，输出大小保持不变。所以最终输出大小= (7x7x512)。</p><h1 id="df6c" class="km kn hi bd ko kp lq kr ks kt lr kv kw kx ls kz la lb lt ld le lf lu lh li lj bi translated">模块5: conv5_x</h1><p id="975c" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">Global average pool本质上是一个大型分类器，它将7x7x512层转换为1x1x1000，因为Resnet是在具有一千个类的ImageNet数据集上训练的。</p><p id="8736" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你有了一个完整的Resnet34结果。希望你能从这些数学中得到乐趣。如果你有问题，请随意发表评论。祝你今天开心！玩的开心！</p><blockquote class="jv jw jx"><p id="27f1" class="if ig jd ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">让我们在<a class="ae ju" href="https://www.linkedin.com/in/anup-joseph/" rel="noopener ugc nofollow" target="_blank"> Linkedln </a>见面</p></blockquote></div></div>    
</body>
</html>