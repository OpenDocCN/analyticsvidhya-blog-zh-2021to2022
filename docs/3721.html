<html>
<head>
<title>Image Search Engine using Image Hashing technique in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中使用图像哈希技术的图像搜索引擎</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/image-search-engine-using-image-hashing-technique-in-python-e6749dacc8f7?source=collection_archive---------2-----------------------#2021-07-20">https://medium.com/analytics-vidhya/image-search-engine-using-image-hashing-technique-in-python-e6749dacc8f7?source=collection_archive---------2-----------------------#2021-07-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a30da9fbeabf9d971bedafd94035f5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8cDAkO_z-J2x5eAEfqlUg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">从<a class="ae iu" href="https://unsplash.com/photos/afW1hht0NSs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">开始，不飞溅</a></figcaption></figure><p id="43e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi jt translated"><span class="l ju jv jw bm jx jy jz ka kb di"> I </span>图像搜索是一种信息检索方法，基于同样是图像的查询来检索相似的图像。图像搜索广泛应用于取证、监控等领域。</p><p id="e38c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个现代浏览器都提供图像搜索功能，以检索在查询中具有相似图像的网站。这些搜索引擎由每天处理和索引数十亿张图像的深度学习模型驱动。这些搜索引擎首先通过从深度学习模型中提取特征来索引图像，为了检索图像，它们计算查询图像的特征，并显示基于相似率排序的相似图像。此外，一些引擎通过基于元数据和图像内容来索引图像，从而使用混合方法来搜索图像。</p><p id="01d2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在深度学习流行之前，一些搜索引擎使用哈希技术来索引图像。在本教程中，我们将讨论如何使用图像哈希技术实现图像搜索。</p><p id="ca08" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要构建一个搜索引擎，我们必须实现以下步骤</p><ol class=""><li id="86c0" class="kc kd hi ix b iy iz jc jd jg ke jk kf jo kg js kh ki kj kk bi translated">建立一个图像数据库。</li><li id="44a7" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">使用散列法索引图像。</li><li id="99f5" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js kh ki kj kk bi translated">通过比较查询图像和数据库中图像的哈希值来获取相似的图像。基于散列的相似性分数来获取相似的图像。</li></ol><h1 id="f585" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">1.设置图像数据库</h1><p id="b20c" class="pw-post-body-paragraph iv iw hi ix b iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo ls jq jr js hb bi translated">图像数据库包含世界上最高的五座<a class="ae iu" href="https://en.wikipedia.org/wiki/List_of_tallest_buildings" rel="noopener ugc nofollow" target="_blank">建筑的图像</a>图像。对于每个建筑物(迪拜塔、上海中心大厦、Abraj Al-Bait钟楼、平安金融中心和乐天世界大厦)，图像数据库包含该建筑物的5个不同图像，并且数据库中总共有25个图像。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/a28e6d73737a64d8529cdc479a0942c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boC-I0490UP0EX0xhTDLuQ.jpeg"/></div></div></figure><h1 id="ed15" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">2.图像索引</h1><p id="cc70" class="pw-post-body-paragraph iv iw hi ix b iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo ls jq jr js hb bi translated">为了索引图像，我们使用图像哈希值并将它们存储在数据库中以比较图像。</p><h2 id="467d" class="ly kr hi bd ks lz ma mb kw mc md me la jg mf mg le jk mh mi li jo mj mk lm ml bi translated">图像哈希</h2><blockquote class="mm"><p id="555d" class="mn mo hi bd mp mq mr ms mt mu mv js dx translated">图像哈希是为图像提供唯一哈希代码的过程。</p></blockquote><p id="dec6" class="pw-post-body-paragraph iv iw hi ix b iy mw ja jb jc mx je jf jg my ji jj jk mz jm jn jo na jq jr js hb bi translated">因为我们可以将图像编码成唯一的代码，所以该代码可以用于索引图像。所以我们通过比较哈希码和它们的相似性来检索相似的图像。</p><p id="3024" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有各种各样的图像散列算法来对图像进行散列，并且大多数算法都是简单而快速的。一些流行的算法是</p><ul class=""><li id="2a47" class="kc kd hi ix b iy iz jc jd jg ke jk kf jo kg js nb ki kj kk bi translated">平均散列法</li><li id="fe2a" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">中值散列法</li><li id="23d2" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">感知哈希(pHash)</li><li id="6591" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">差异散列法</li><li id="1500" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">块散列法</li><li id="9cc5" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">小波散列(wHash)</li><li id="c876" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">彩色矩散列法</li></ul><p id="1698" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你不熟悉图像哈希的概念，可以在这个著名的<a class="ae iu" href="http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html" rel="noopener ugc nofollow" target="_blank">博客</a>中学习图像哈希。</p><p id="5946" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">目前，我们使用<a class="ae iu" href="https://en.wikipedia.org/wiki/Perceptual_hashing" rel="noopener ugc nofollow" target="_blank">感知哈希</a> (pHash)算法来哈希图像，该算法在将数据从空间域转换到频率域的<a class="ae iu" href="https://en.wikipedia.org/wiki/Discrete_cosine_transform" rel="noopener ugc nofollow" target="_blank">离散余弦变换</a> (DCT)的基础上计算哈希。</p><h2 id="3d63" class="ly kr hi bd ks lz ma mb kw mc md me la jg mf mg le jk mh mi li jo mj mk lm ml bi translated">感知散列法</h2><p id="9389" class="pw-post-body-paragraph iv iw hi ix b iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo ls jq jr js hb bi translated">pHash是一种基于图像的DCT值计算图像散列的简单算法。该算法包括以下步骤</p><ul class=""><li id="fde9" class="kc kd hi ix b iy iz jc jd jg ke jk kf jo kg js nb ki kj kk bi translated">重新缩放图像—将图像重新缩放到4的倍数，如8*8、32*32等。</li><li id="d5b2" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">转换成灰度图像。</li><li id="ab94" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">计算8*8或32*32图像的DCT块。</li><li id="8157" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">计算平均DCT值，不包括(0，0)处的值，因为它会影响计算平均值时的较大偏差。</li><li id="e940" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">通过比较平均值将条目设置为0或1来计算二进制DCT块(如果值&gt;平均值，则1否则为0)。</li><li id="5df9" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">通过从左到右和从上到下遍历二进制DCT块来构造散列。因为值只有0或1，所以对于8*8 DCT块，散列可以存储在64位整数中。</li></ul><p id="a0a8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于每个图像，我们从上面的pHash算法计算图像散列，并将这些散列存储为图像的索引。</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="fb73" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上面的代码片段中，<strong class="ix hj"> image_names </strong>包含了images目录中的所有图像路径，对于每个图像，我们计算哈希值并将其存储在<strong class="ix hj"> image_hash_dict </strong>中以备将来使用。</p><pre class="lu lv lw lx fd ne nf ng nh aw ni bi"><span id="cd13" class="ly kr hi nf b fi nj nk l nl nm">Image names</span><span id="507a" class="ly kr hi nf b fi nn nk l nl nm">images/abraj-al-bait-1.jpg<br/>images/abraj-al-bait-2.jpg<br/>images/abraj-al-bait-3.jpg<br/>images/abraj-al-bait-4.jpg<br/>images/abraj-al-bait-5.jpg<br/>images/burj-khalifa-1.jpg<br/>images/burj-khalifa-2.jpg<br/>images/burj-khalifa-3.jpg<br/>images/burj-khalifa-4.jpg<br/>images/burj-khalifa-5.jpg<br/>images/lotte-1.jpg<br/>images/lotte-2.jpg<br/>images/lotte-3.jpg<br/>images/lotte-4.jpg<br/>images/lotte-5.jpg<br/>images/ping-an-1.jpg<br/>images/ping-an-2.jpg<br/>images/ping-an-3.jpg<br/>images/ping-an-4.jpg<br/>images/ping-an-5.jpg<br/>images/shanghai-tower-1.jpg<br/>images/shanghai-tower-2.jpg<br/>images/shanghai-tower-3.jpg<br/>images/shanghai-tower-4.jpg<br/>images/shanghai-tower-5.jpg</span></pre><p id="7d67" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"><em class="no">hash _ array _ to _ hash _ hex()</em></strong>将1D二进制数组转换为十六进制字符串值<strong class="ix hj"><em class="no">hash _ hex _ to _ hash _ array()</em></strong>将十六进制字符串值转换为数据类型为float的1D二进制数组。</p><p id="93ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">字符串哈希值占用较少的空间，可以灵活地存储在文本或csv文件中。这些值可用于索引数据库中的图像。</p><p id="f2a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"><em class="no">" images/Shanghai-tower-1 . jpg "</em></strong>的哈希值为<strong class="ix hj"> 0xb1934cf40a79140b </strong></p><p id="7e53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有用于计算图像散列的python库，如<a class="ae iu" href="https://github.com/JohannesBuchner/imagehash" rel="noopener ugc nofollow" target="_blank"> ImageHash </a>和<a class="ae iu" href="https://github.com/thorn-oss/perception" rel="noopener ugc nofollow" target="_blank"> Perception </a>，它们提供了不同的散列方法和其他工具来实现图像散列。</p><h1 id="d4d7" class="kq kr hi bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">3.获取相似的图像</h1><p id="3585" class="pw-post-body-paragraph iv iw hi ix b iy lo ja jb jc lp je jf jg lq ji jj jk lr jm jn jo ls jq jr js hb bi translated">现在，对于查询图像，类似的图像被提取为</p><ul class=""><li id="a097" class="kc kd hi ix b iy iz jc jd jg ke jk kf jo kg js nb ki kj kk bi translated">计算查询图像的图像哈希值。</li><li id="f709" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">因为我们已经在数据库中存储了图像的哈希值，所以将它们的哈希值与查询图像的哈希值进行比较。像汉明距离这样的度量函数可以用来比较哈希值。</li><li id="efb6" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">现在根据度量分数对图像进行分类。</li><li id="bbef" class="kc kd hi ix b iy kl jc km jg kn jk ko jo kp js nb ki kj kk bi translated">显示指标分数高于阈值的图像。</li></ul><p id="9ec6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因为我们已经计算了图像散列，所以我们可以通过将散列值与查询图像散列值进行比较来检索相似的图像。</p><p id="64d9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果查询图像是“images/burj-khalifa-3.jpg ”,为了获得相似的图像，计算所有图像散列相对于查询散列的汉明距离，如</p><figure class="lu lv lw lx fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="6499" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这给出图像的距离分数如下</p><pre class="lu lv lw lx fd ne nf ng nh aw ni bi"><span id="098b" class="ly kr hi nf b fi nj nk l nl nm">images/abraj-al-bait-1.jpg     0.46875<br/>images/abraj-al-bait-2.jpg     0.609375<br/>images/abraj-al-bait-3.jpg     0.640625<br/>images/abraj-al-bait-4.jpg     0.578125<br/>images/abraj-al-bait-5.jpg     0.5</span><span id="23d9" class="ly kr hi nf b fi nn nk l nl nm">images/burj-khalifa-1.jpg      0.53125<br/>images/burj-khalifa-2.jpg      0.453125<br/>images/burj-khalifa-3.jpg      0.0<br/>images/burj-khalifa-4.jpg      0.390625<br/>images/burj-khalifa-5.jpg      0.4375</span><span id="1dd3" class="ly kr hi nf b fi nn nk l nl nm">images/lotte-1.jpg             0.453125<br/>images/lotte-2.jpg             0.53125<br/>images/lotte-3.jpg             0.625<br/>images/lotte-4.jpg             0.4375<br/>images/lotte-5.jpg             0.375</span><span id="611b" class="ly kr hi nf b fi nn nk l nl nm">images/ping-an-1.jpg           0.453125<br/>images/ping-an-2.jpg           0.609375<br/>images/ping-an-3.jpg           0.484375<br/>images/ping-an-4.jpg           0.484375<br/>images/ping-an-5.jpg           0.453125</span><span id="29ae" class="ly kr hi nf b fi nn nk l nl nm">images/shanghai-tower-1.jpg    0.4375<br/>images/shanghai-tower-2.jpg    0.328125<br/>images/shanghai-tower-3.jpg    0.515625<br/>images/shanghai-tower-4.jpg    0.359375<br/>images/shanghai-tower-5.jpg    0.453125</span></pre><p id="8508" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些分数指示图像与查询图像的相似性。分数越低，它就越类似于查询图像。哈利法塔图像的得分在0.3-0.5之间，其他一些图像也在此范围内，因为建筑物具有相似的结构，很难区分结构。</p></div><div class="ab cl np nq gp nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="hb hc hd he hf"><p id="0ce1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">图像哈希结果可能没有深度学习方法准确，但它们实现起来非常快，并且需要更少的存储。图像哈希方法可用于检测大型数据库中的严格重复图像。通过对图像进行一些预处理，并调整pHash算法，我们可以获得更好的检索相似图像的结果。</p></div></div>    
</body>
</html>