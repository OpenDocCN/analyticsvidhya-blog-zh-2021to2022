<html>
<head>
<title>Cats vs Dogs Classifier using fastai and flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用fastai和flask的猫和狗分类器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/cats-vs-dogs-classifier-using-fastai-and-flask-44bba2f3889f?source=collection_archive---------9-----------------------#2021-08-26">https://medium.com/analytics-vidhya/cats-vs-dogs-classifier-using-fastai-and-flask-44bba2f3889f?source=collection_archive---------9-----------------------#2021-08-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b562" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在fastai上读了很多东西，尤其是在过去的几周里，我不得不说，这个图书馆里有一些非常有趣的东西。感谢<strong class="ig hi">杰米·霍华德</strong>和<strong class="ig hi">拉切尔托马斯</strong>和fastai社区将材料和最先进的技术公之于众，让每个人都可以使用<strong class="ig hi">让神经网络再次变得不酷</strong>😉<strong class="ig hi">。</strong></p><p id="30b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个特别的博客(许多博客中的第一个)从头开始创建一个狗和猫的分类器。构建任何数据科学应用程序最困难的部分之一是收集训练和测试数据集。当然，有标准数据集样本，如Titanic、iris、Mnist等，可用于测试不同模型的性能。但是，当您想要为现实世界中的特定用例从头开始构建模型时，这可能是最困难和最耗时的部分。幸运的是，我们有构建通用应用程序的完美解决方案，从人类的角度来看，它也非常直观。假设你想让一个孩子明白一只猫或一只狗是什么样子，你会怎么做呢？最自然的答案是用谷歌搜索猫和狗的图片，然后给孩子看，向他们解释将它们归类到各自标签的思维过程。我们，在这个博客中，将遵循完全相同的东西来建立一个分类器。我们将从搜索引擎中提取图像结果，并将其存储为输入数据，稍后将用于训练我们的分类器。</p><p id="7f5d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于这个特殊的用例，我们将使用bing作为我们的搜索引擎。你需要注册azure cognitive services(如果你是学生，它是完全免费的，如果不是，你需要输入你的信用卡信息，但第一年左右不会收费)，之后你就可以访问bing搜索关键字。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="10ca" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">必应搜索图片API</h1><p id="386a" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">以下是Bing seach api的定价层。如你所见，它可以让你每月免费拨打1K电话，这比任何人在这种情况下所需要的都要多。(点击<a class="ae km" href="https://docs.microsoft.com/en-gb/rest/api/cognitiveservices-bingsearch/bing-images-api-v7-reference" rel="noopener ugc nofollow" target="_blank">此处</a>查看api文档)</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kn"><img src="../Images/17f7f53cb99f4e154dfbb4be9d49a665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O_zPxS4WjBfGaaFGFA6qOg.png"/></div></div></figure><p id="680e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦我们有了密钥，我们就可以进入如何使用这个API提取图像的编码部分。我们将使用关键字<strong class="ig hi"> <em class="kz">猫</em> </strong>和<strong class="ig hi"> <em class="kz">狗来</em> </strong>抓取搜索结果。</p><p id="01f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们应该做的第一件也是最重要的事情是从fast ai导入所有预定义的助手函数。</p><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="abe2" class="lf jk hh lb b fi lg lh l li lj">pip install -Uqq fastbook<br/>import fastbook<br/>fastbook.setup_book()</span><span id="7522" class="lf jk hh lb b fi lk lh l li lj">import requests<br/>from fastai.vision.all import *<br/>from fastai.vision.widgets import *<br/>from pathlib import Path</span></pre></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="ea19" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">使用Bing下载图像</strong></h1><p id="e1ca" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">然后我们使用bing的API为我们的模型下载所有的猫和狗的图片。幸运的是，<strong class="ig hi"> <em class="kz">请求</em> </strong>是这里唯一有用的库。fastai有自己的搜索bing图片的功能，但由于某种原因，它有一些错误(最新版本已经修复了这个问题)。所以我做了一些研究，并创建了自己的助手函数来实现这个功能。</p><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="2bd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的函数返回一个dict，其中包含了使用给定关键字进行搜索的所有信息。我们最感兴趣的部分是这些图片的url。这可以使用<strong class="ig hi">results . attr got(' content URL ')</strong>来访问，其中<strong class="ig hi"> results </strong>是函数<strong class="ig hi"> custom_search_images_bing的输出。</strong></p><p id="9d99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我做了一些助手函数，创建一个名为<strong class="ig hi"> DATA </strong>的文件夹，以类别名称(<strong class="ig hi"> animals) </strong>和子文件夹作为标签名称(<strong class="ig hi"> cat </strong>和<strong class="ig hi"> dog </strong>)根据标签将图像下载到各自的子文件夹中。</p><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="0104" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">功能<strong class="ig hi">download _ relevant _ images</strong>将图像下载到这些子文件夹中，并且<strong class="ig hi"> clean_label_images </strong>检查文件夹中损坏的图像并将其从文件夹中删除。</p><p id="10f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">瞧吧！我们现在已经准备好了训练/微调我们的模型所需的数据，并准备好了！</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="9b16" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">数据处理和训练模型。</h1><p id="07d5" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">为了使用fastai库训练一个模型，我们需要给一个<strong class="ig hi">数据加载器</strong>对象<strong class="ig hi"> </strong>作为模型的输入。<strong class="ig hi">数据加载器</strong>本质上是一个存储<strong class="ig hi">数据加载器</strong>对象(<strong class="ig hi">训练</strong>和<strong class="ig hi">有效</strong>)的类，它帮助模型在<strong class="ig hi">训练</strong>子集上训练，并通过使用有效子集进行交叉验证来检查性能。如果我们要在没有fastai的情况下这样做，我们通常会使用</p><p id="5475" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ln lo lp lb b"><strong class="ig hi">from sklearn.model_selection import train_test_split</strong></code></p><p id="3104" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是fastai有预定义的库，这些库在创建一个<strong class="ig hi">数据加载器</strong>对象时自动完成所有这些工作。那么我们如何创建一个<strong class="ig hi">数据加载器</strong>对象呢？</p><p id="2a11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要将我们下载的数据转换成一个<code class="du ln lo lp lb b">DataLoaders</code>对象，我们至少需要告诉fastai四件事:</p><p id="b172" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们正在处理哪些类型的数据？</p><p id="051b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如何获取物品清单？</p><p id="2dc5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些物品怎么贴标签？</p><p id="8343" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如何创建验证集？</p><p id="c912" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用数据块API来指定上述内容，以创建一个<strong class="ig hi">数据加载器</strong>对象。</p><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="f235" class="lf jk hh lb b fi lg lh l li lj">db = DataBlock( <br/>blocks=(ImageBlock, CategoryBlock), <br/>get_items = get_image_files, <br/>splitter = RandomSplitter(valid_pct=0.2, seed=42), <br/>get_y = parent_label, <br/>item_tfms=Resize(128))</span></pre><p id="0726" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">块:</strong>将输入作为元组(数据结构(表格、图像等)，数据类型(分类、连续) )</p><p id="c392" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> get_items </strong>:用来告诉数据块如何访问我们创建的数据。<strong class="ig hi"> get_image_files </strong>是一个预定义的fastai函数，它将输入作为<strong class="ig hi"> Path </strong>变量，输出一个包含图像位置的<strong class="ig hi"> Path </strong>变量列表。</p><p id="da52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">拆分器:</strong>用于指定列车有效拆分</p><p id="9831" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> get_y : </strong>我们到底要如何映射带有标签的图像<strong class="ig hi">？</strong> parent_label是另一个将标签作为parent_folder名称的函数</p><p id="a77e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> item_tfms : </strong>用于将所有下载的图像转换为128x128像素，以保持一致性。</p><p id="a1ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们有了一个数据块，可以将其转换为dataloaders对象，并输入到模型中进行训练。</p><p id="58a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，等等，我们还可以对图像做些什么来提高模型的性能吗？</p><h1 id="aac8" class="jj jk hh bd jl jm lq jo jp jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg bi translated"><strong class="ak">数据扩充</strong></h1><p id="c089" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">不同的图像可能在不同的位置包含图片中的主要项目。</p><div class="ko kp kq kr fd ab cb"><figure class="lv ks lw lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/9a53f7086b463ff0f50d5b437cdd7265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*214zgqTmUMADjYZTff6JwA.png"/></div></figure><figure class="lv ks mb lx ly lz ma paragraph-image"><img src="../Images/909f3fbe2c20370483e793b39977a48b.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*K5tV-VKsF4BRhLTRfezDaQ.png"/><figcaption class="mc md et er es me mf bd b be z dx mg di mh mi translated">猫图片</figcaption></figure></div><p id="9081" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面是两张不同的猫的照片。左边的那只猫位于左侧，右边的那只稍微偏向右侧。由于这些变化大部分出现在图像中，因此随机裁剪图像以让模型知道不管猫出现在哪里都是有意义的，图片仍然应该被标记为猫。这也有助于我们用有限的数据创造更多的数据点。这是通过<strong class="ig hi"> RandomResizedCrop </strong>实现的</p><div class="ko kp kq kr fd ab cb"><figure class="lv ks mj lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/ba2f04eaa5ec13668065c255c009a7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*MRgWvW8RD6C8p4MOsnYISQ.png"/></div></figure><figure class="lv ks mk lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/23cc6c3ecacc28ced80daec74100adf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*Rh2eUTM_lLHD4210BVkjbw.png"/></div></figure><figure class="lv ks ml lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/4fc2a8b23f119224c1cf799ecce8d4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*0wLD-UnYWnwKvB5HnOkkDA.png"/></div></figure></div><div class="ab cb"><figure class="lv ks mm lx ly lz ma paragraph-image"><img src="../Images/41f2bc494e1cab82bfe4854c654bb6ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*mvZesXMsqrpjd6RSihWhvg.png"/></figure><figure class="lv ks mn lx ly lz ma paragraph-image"><img src="../Images/909f3fbe2c20370483e793b39977a48b.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*K5tV-VKsF4BRhLTRfezDaQ.png"/><figcaption class="mc md et er es me mf bd b be z dx mo di mp mi translated">RandomResizedCrop的示例</figcaption></figure></div><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="4442" class="lf jk hh lb b fi lg lh l li lj">db = db.new(        <br/>item_tfms=RandomResizedCrop(224, min_scale=0.5),        batch_tfms=aug_transforms()<br/>)</span><span id="5d40" class="lf jk hh lb b fi lk lh l li lj">dls = db.dataloaders(path)</span></pre><p id="1163" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">aug _ transforms</strong>指的是创建我们输入数据的随机变量，使它们看起来不同，但实际上并不改变数据的含义。常见的图像数据增强技术的例子有旋转、翻转、透视扭曲、亮度变化和对比度变化。事实证明，这些东西在为模型提供信息方面帮助很大。</p><p id="1ea2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦我们指定了如何创建dataloaders对象所需的细节，我们需要做的就是指定存储输入数据的路径。</p><h1 id="a4e4" class="jj jk hh bd jl jm lq jo jp jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg bi translated"><strong class="ak">建立模型</strong></h1><p id="9451" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">对于新手或刚刚开始深度学习的人来说，只使用特定用例的数据从头训练模型有很多误解。</p><p id="5df7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">原来有一种更简单的方法来训练一个模特。</p><p id="d764" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您建立一个模型时，我们使用随机权重初始化，定义一个损失函数，并通过使用我们通过微分损失函数获得的梯度改变权重来保持训练模型。随着时间的推移，这需要花费大量时间来建立准确性，并且在使用小数据集时也可能容易出错。相反，我们可以使用<strong class="ig hi">迁移学习</strong>的概念，使用为类似目的制作的模型所使用的架构和权重，用适合我们用例的标签替换最后一层，并针对<strong class="ig hi"> n个时期再次训练它。</strong>历元使模型能够根据从损失函数获得的梯度和输入的学习率更新权重。</p><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="764e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> cnn_learner </strong>:预定义的fastai函数，用于使用imagetype数据训练模型(使用卷积神经网络的概念)。这里使用的预训练模型是resnet18。</p><p id="a834" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里的<strong class="ig hi"> process_and_train.py中，</strong>我们创建一个datalaoders对象，并将其输入到模型中(<strong class="ig hi"> learn </strong>)。然后，我们使用learn.fine_tune(4)使用4个时期的新数据再次训练模型，然后以“animals_prediction.pkl”的名称保存模型。请注意，对于这个特定的用例，我们有一个度量= error_rate，它基本上是我们在输入的所有图像中出错的分类数。在运行时，我们得到了超过99%的准确率，这是非常好的。</p><h1 id="9b1c" class="jj jk hh bd jl jm lq jo jp jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg bi translated">评估模型</h1><p id="64a6" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">我们还可以通过使用以下命令构建混淆矩阵来评估模型。</p><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="cd3a" class="lf jk hh lb b fi lg lh l li lj">interp = ClassificationInterpretation.from_learner(learn)<br/>interp.plot_confusion_matrix()</span></pre><p id="319d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中learn是函数<strong class="ig hi"> train_model的输出。</strong>使用以下命令，我们还可以看到模型感到难以判断或损失最大的图像。</p><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="e5eb" class="lf jk hh lb b fi lg lh l li lj">interp.plot_top_losses(5, nrows=1)</span></pre><p id="faa8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">基于这些，你可以选择删除这些图像，如果这些看起来没有增加我们的模型创建的价值。您还可以检查图像的错误分类(因为它是直接从搜索引擎中选取的)并手动纠正它们。在这个过程中，ImageClassifierCleaner(learn)可能会非常方便。</p><h1 id="6f42" class="jj jk hh bd jl jm lq jo jp jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg bi translated"><strong class="ak">模型到应用</strong></h1><p id="9f19" class="pw-post-body-paragraph ie if hh ig b ih kh ij ik il ki in io ip kj ir is it kk iv iw ix kl iz ja jb ha bi translated">我们现在已经建立了一个模型，可以成功地区分猫和狗。但是工作只完成了一半。</p><p id="97bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你如何让你的同事也能看到你所做的工作？</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mq"><img src="../Images/4cd121719ca3dc07147103ffb68aa0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcIciJCF0xivRXo25PDmcA.png"/></div></div></figure><p id="1a1f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当然是通过互联网！我们现在必须制作一个web应用程序，它可以托管在一个网站上，每个人都可以在那里上传一张猫/狗的照片，我们输出带有所需指标的预测标签。</p><p id="e324" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将模型存储为“animals_prediction.pkl”。这是预测图片类别所需的主要信息。您可以使用以下命令预测任何图像的类别。</p><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="1e0c" class="lf jk hh lb b fi lg lh l li lj">learn_inf = load_learner('animals_prediction.pkl')<br/>learn_inf.predict(path_to_img)</span></pre><p id="f3f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> load_learner : </strong>加载存储的模型，稍后使用<strong class="ig hi"> learn_inf.predict() ( </strong>输出预测的标签和概率度量)来预测上传图像的标签</p><p id="aa5f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有很多方法可以将模型转化为应用程序。在本练习中，我们使用了flask，这是一个用于构建web应用程序的python库。</p><figure class="ko kp kq kr fd ks"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="0e7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该应用中使用了3个函数(其中2个与<code class="du ln lo lp lb b">@app.route()</code>相关)</p><p id="1085" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> model_predict() : </strong>这个函数非常简单，简单地将输入作为img_path和model_path，输出一个带有标签<code class="du ln lo lp lb b">pred</code>和概率值为<code class="du ln lo lp lb b">prob_value</code>的字符串。</p><p id="cea0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我们正在构建的网站的主起始页(姑且称之为<strong class="ig hi">基页</strong>),由html文件<strong class="ig hi">index.html支持。</strong>该网页提供了一个上传按钮，用户可以将自己系统中的图像上传到网络服务器以使用该应用程序。一旦用户点击按钮<code class="du ln lo lp lb b">Predict!</code>，它会将用户重定向到<strong class="ig hi">基页/预测</strong>以及输入的图像。这就是<strong class="ig hi"> upload()函数</strong>发挥作用的地方。</p><p id="9b5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> upload() : </strong>它接收输入的图像，将其本地存储在服务器中(以test.jpg的名字命名)，然后使用该图像作为<strong class="ig hi"> model_predict()的输入，</strong>获取带有标签和概率的输出字符串，并将其打印在<strong class="ig hi"> basepage </strong>中的上传图像下。</p><p id="ef49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您在终端中运行以下文件，您可以在浏览器中的链接(<a class="ae km" href="http://127.0.0.1:5000/')" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:5000/')</a>下签出本地托管的应用程序。</p><p id="0a9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于静态和html文件，检查我的git repo <a class="ae km" href="https://github.com/rama96/animals_prediction/tree/production" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="d93b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要在全球范围内托管它，你必须把这个库上传到Github上(如果你没有的话就注册)。您可以通过图片中标记的添加文件选项来上传存储库。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mr"><img src="../Images/b6daf5a389d2d167422bb9fda09f4c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gIEUYkamlmQT_lulWmGahA.png"/></div></div></figure><p id="2806" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦将文件上传到git中，您就必须通过使用命令使用<code class="du ln lo lp lb b">pipreqs</code>来冻结需求</p><pre class="ko kp kq kr fd la lb lc ld aw le bi"><span id="e38a" class="lf jk hh lb b fi lg lh l li lj">pipreqs path/to/python_project</span></pre><p id="7482" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将创建一个requirements.txt文件，该文件将让服务器(用于创建网站)知道在运行应用程序之前需要安装哪些库。您还应该创建名为<code class="du ln lo lp lb b"><strong class="ig hi">Procfile</strong></code> <strong class="ig hi"> </strong>的文件，该文件用于与包含应用程序的web服务器通信。</p><p id="3483" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在剩下的就是在heroku中进行部署(如果您没有heroku帐户，请创建一个)。</p><p id="b32b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击heroku仪表盘上的<code class="du ln lo lp lb b">create new app</code>并为其命名。打开你创建的应用程序，点击<code class="du ln lo lp lb b">Deploy</code>选项。您应该能够看到将您的git repo与heroku链接的选项。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ms"><img src="../Images/79612dfa50ea80164a67d9b589e8b9bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hQV-oEGJ_vB0O5GtIFsHw.png"/></div></div></figure><p id="7a75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我建议进行手动部署，只是因为我不想让我的提交直接反映在我的应用程序上，除非我允许它这样做，或者说，如果你未经检查就提交了错误的代码，在部署后很难恢复。一旦部署完成，<em class="kz">瞧！你可以在<a class="ae km" href="https://animals-classifier.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://your-app-name.herokuapp.com/</a>查看你的应用。</em></p><div class="ko kp kq kr fd ab cb"><figure class="lv ks mt lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/ff9e3bdf6cb19d04a2513888050b996a.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*OxjGZy68o55A81GxOls2EA.png"/></div></figure><figure class="lv ks mu lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/edd36f71ffe8661ed378bd3ebebf400a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1FUbIdosjsbCwHRkDeTzUQ.png"/></div></figure><figure class="lv ks mv lx ly lz ma paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><img src="../Images/0dfc652d6a64835cf95a90f210ff4b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lHT5rEeqJeqq0twDoxPJiA.png"/></div><figcaption class="mc md et er es me mf bd b be z dx mw di mx mi translated">关于Web应用程序如何工作的演示。</figcaption></figure></div><p id="0a91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以在这里查看我为博客<a class="ae km" href="https://animals-classifier.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">开发的应用程序</a>。</p><p id="131b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望这篇文章对你有所帮助。在我未来的博文中，我们将深入探讨不同的概念和改进。</p><p id="d72b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">—等等，更多有趣的内容即将推出。直到那时再见😉</p><p id="b9b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你喜欢读这篇文章，请喜欢并分享这个回购和博客。</p><p id="801f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kz">附注——如果你感兴趣，请在此处查看代码</em><a class="ae km" href="https://github.com/rama96/animals_prediction/tree/production" rel="noopener ugc nofollow" target="_blank"><em class="kz"/></a><em class="kz">(</em><em class="kz">如果你觉得有用，别忘了to⭐回购</em>😉)</p></div></div>    
</body>
</html>