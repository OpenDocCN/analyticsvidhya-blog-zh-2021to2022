<html>
<head>
<title>An end to end case study on Crowd Flower Search results relevance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">人群鲜花搜索结果相关性的端到端案例研究</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/an-end-to-end-case-study-on-crowd-flower-search-results-relevance-7229243f4d12?source=collection_archive---------18-----------------------#2021-01-25">https://medium.com/analytics-vidhya/an-end-to-end-case-study-on-crowd-flower-search-results-relevance-7229243f4d12?source=collection_archive---------18-----------------------#2021-01-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4b8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个简单的NLP数据集，可以让你快速进行文本清理、预处理和训练。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/a2462392c889e1b92e40da74859e59bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xykFR6dHMbAc6bhTtx1MsQ@2x.jpeg"/></div></div></figure><p id="3d4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你是机器学习的初学者，并且想在一个简单的NLP数据集上工作，我绝对推荐你去看看这个Kaggle <a class="ae jo" href="https://www.kaggle.com/c/crowdflower-search-relevance" rel="noopener ugc nofollow" target="_blank">挑战</a>，并在进一步阅读之前尝试自己解决它。</p><p id="9911" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个挑战中，我接触了清理HTML标签、分析直方图、构建自定义W2V、用于矢量化的TFIDF-W2V、处理有序目标标签、生成n元语法、使用SVD进行降维、部署在云服务器中。</p><h2 id="649e" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">目录:</h2><ol class=""><li id="647a" class="kk kl hh ig b ih km il kn ip ko it kp ix kq jb kr ks kt ku bi translated">引言。</li><li id="9288" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">探索性数据分析。</li><li id="a917" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">绩效指标。</li><li id="dfec" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">第一种方法。</li><li id="741f" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">文本清理</li><li id="58b7" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">文本矢量化。</li><li id="17d6" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">高级特征工程。</li><li id="ea4f" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">建模。</li></ol><h2 id="a5a0" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">1.简介:</h2><p id="078a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">为了评估搜索相关性，CrowdFlower让他们的用户评估了一些电子商务网站的搜索结果。总共生成了261个搜索词，CrowdFlower整理了一个产品及其对应搜索词的列表。人群中的每个评价人被要求给产品搜索词打1、2、3、4分，其中4分表示该商品完全满足搜索查询，1分表示该商品不匹配搜索词。给出搜索词以及相应的产品标题和产品描述，如果组合合适，则给出4分，否则给出1分。</p><h2 id="a894" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated"><strong class="ak"> 2。探索性数据分析:</strong></h2><p id="bd00" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">比赛中给出的训练数据不到5MB，有10156个数据点。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ld"><img src="../Images/b329508316c376cd4e0cc783a5a690dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qzJtk56MCp2LDCc9JkCOGg.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">训练文件样本数据点</figcaption></figure><p id="efa2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 2.1了解列车数据:</em> </strong></p><p id="4360" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.<strong class="ig hi"> <em class="li"> Id </em> </strong> —行的唯一标识符。<br/> 2。<strong class="ig hi"> <em class="li">查询</em> </strong> —关于查询的文本。<br/> 3。<strong class="ig hi"> <em class="li">产品_标题</em> </strong> —关于产品标题的文本。<br/> 4。<strong class="ig hi"> <em class="li">产品_描述</em> </strong> —关于产品描述的文字。<br/> 5。<strong class="ig hi"><em class="li">Median _ relevance</em></strong>—3位评分者给出的中值关联分数<br/> 6。<strong class="ig hi"><em class="li">relevance _ Variance</em></strong>—这三位评分者给出的相关分数的方差。</p><p id="45f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们将目标值分布可视化:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="ab fe cl ll"><img src="../Images/b88726844c4e834e4ddb6569055fb6e3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*6gn46_mT3HK8tTIEQd_d_g.png"/></div></figure><p id="b3de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">观察:</p><ul class=""><li id="4398" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb lp ks kt ku bi translated">数据非常不平衡。大多数数据点来自第4类。非常少的数据点属于1类</li></ul><p id="a0a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 2.2检查NAN值。</em> </strong></p><p id="1dd4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我真的很喜欢missingo库，它以可视化的方式识别缺失的值。</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="294a" class="jp jq hh lr b fi lv lw l lx ly">ax = missingno.matrix(df)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lz"><img src="../Images/18225b946aa5b3b9e0b3bac05a656f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lrC12O3hl6hwumzmqxb2AA.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">在product_description列中观察到许多空格，表示缺少值</figcaption></figure><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="6db0" class="jp jq hh lr b fi lv lw l lx ly">print('Percentage of points that are having missing values',round(sum(df.product_description.isna())/df.shape[0]*100,2),'%')</span></pre><p id="a7d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">缺失值点的百分比为24.06 %</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="22d9" class="jp jq hh lr b fi lv lw l lx ly"># I cannot just drop the 24.06% of the points randomly.<br/># I will fill the missing values with an empty string<br/>df.product_description.fillna('',inplace=True)</span></pre><p id="2204" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 2.3数据分析的功能【查询】</em> </strong></p><p id="23f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们检查一下查询列中是否有重复的文本:</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="d940" class="jp jq hh lr b fi lv lw l lx ly">df['query'].value_counts()</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ma"><img src="../Images/22eb438cb5ae73ebc729dfea104df8cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*dQoajS78GjHa9ZpfxB96ig.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">列查询中的唯一类别</figcaption></figure><p id="fdc5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">想象查询句子的长度:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="ab fe cl ll"><img src="../Images/3c13a75ad753a178ae237580a3e9db23.png" data-original-src="https://miro.medium.com/v2/format:webp/1*7pf8Dp6BvFbktNWmOvsnYQ.png"/></div></figure><p id="8bc8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="li">查询文本分析:</em></p><ul class=""><li id="b934" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb lp ks kt ku bi translated">总共261个独特的类别→我们可以在此列上进行任何分类编码。</li><li id="de22" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">大多数类别会重复30-50次</li><li id="bd98" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">无线鼠标是最常见的查询，在数据中出现了113次，玩偶之家浴缸在数据中出现的次数最少，为8次</li></ul><p id="16b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 2.4特征‘产品_标题’的数据分析</em> </strong></p><p id="578d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们来看一些关于product_title特性的统计数据</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mb"><img src="../Images/3012592bd9abf0475d077442f0836a45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*87hEwrfaWtWtTplHYX4-gQ.png"/></div></figure><p id="a905" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">想象句子的长度:</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="f80f" class="jp jq hh lr b fi lv lw l lx ly">product_title_len = df.product_title.str.len()<br/>plt.plot(sorted(product_title_len))</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mc"><img src="../Images/fc796fdd00a68cc1eedc868bbd5c8cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*YiBrXOnR3FIndr6EsSkWvw.png"/></div></figure><p id="a887" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再深入一步，</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es md"><img src="../Images/5dbb25e304d2e4be1bcf068e782be198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZN-Yg9ADgGdwQdKJ6OoXFw.png"/></div></div></figure><p id="f0cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">句子的长度和目标变量有关系吗？</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="891e" class="jp jq hh lr b fi lv lw l lx ly">sns.histplot(data = df, x = 'product_title_len', y = 'median_relevance')</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es me"><img src="../Images/bce3d84a690a211bdbe5b18a5a0e88ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*RDwdkC-zuvteBauCRdIv3g.png"/></div></figure><p id="4b50" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与查询中的常用词、产品标题、目标分数有关系吗？</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mf"><img src="../Images/5a841a27b20c74409e6ec75f30a674d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*XEzsxbIx_Aht0YTBFR20OQ.png"/></div></figure><p id="8085" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="li">分析</em>:</p><ul class=""><li id="ce89" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb lp ks kt ku bi translated">查询和产品标题之间的常用词越多，获得强评级的机会就越高。</li><li id="4a74" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">我们不能仅基于产品标题长度进行任何分析，因为所有类别都是重叠的。</li><li id="e1a8" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">简单的文本数据→我们可以在这个栏目上做TFIDF，W2V，TFIDF_W2V。</li></ul><p id="092c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 2.5 EDA产品描述:</em> </strong></p><p id="9156" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们想象一下句子的长度</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mg"><img src="../Images/cc4a73816eb9e1f4fd1e426d69802d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*R71ILopt-ycSWau65iPhHw.png"/></div></figure><p id="249e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再深入一步，</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="e63a" class="jp jq hh lr b fi lv lw l lx ly">start = 99.9<br/>for i in range(10):    <br/>    print('{:.2f}th percentile value is {:.1f}'.format(start,np.percentile(df.product_description_len,start)))<br/>    start+=0.01<br/>out= sum(df.product_description_len&gt;10**3)<br/>print('{} product titles have length&gt;145 i.e greater than 99.96 percentile'.format(out))</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mh"><img src="../Images/40a59e7995636cbe6b4564958613c00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJ5C16ULfDhmO6vfWT0v6Q.png"/></div></div></figure><p id="2604" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们看到product_description和product_title中的常用词计数时，即使有超过40个常用词，中值相关性也几乎是平均分布的。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mi"><img src="../Images/6a352200193f4448e9d2e4df6580b0c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9WxsxgLjkyESEOaE3zlcQ.png"/></div></div></figure><blockquote class="mj mk ml"><p id="8214" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">注意:类别4的数据点数非常多，因此只需查看上面的图表，就可以得出结论:product_title和product_description中的常用词越多，相关性就越好，这是不正确的，因为类别之间的计数相差不大。</p></blockquote><p id="b401" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 2.6检查HTML值:</em> </strong></p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="9b2b" class="jp jq hh lr b fi lv lw l lx ly">check_html(df[‘query’])<br/># Output<br/>Time take to run is 0:00:00.861348<br/>Number of rows with html code 0</span><span id="a8d0" class="jp jq hh lr b fi mp lw l lx ly">check_html(df[‘product_title’])<br/># Output<br/>Time take to run is 0:00:01.067391<br/>Number of rows with html code 0</span><span id="f327" class="jp jq hh lr b fi mp lw l lx ly">check_html(df[‘product_description’])<br/># Output <br/>Time take to run is 0:00:00.730124<br/>Number of rows with html code 94</span></pre><p id="8ed1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查文本数据中是否存在HTML标记很重要，更重要的是哪一列有HTML标记。因此，我们只能从特定的列中删除HTML标签。如果您正在处理大型数据集，这肯定会节省一些时间。</p><p id="0681" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7理解测试数据:</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mq"><img src="../Images/245ced52e4be62117eecf7f7c296155c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f79wyw3HMTRrLi_FUJYeyg.png"/></div></div></figure><blockquote class="mj mk ml"><p id="dc2c" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">Kaggle给出的测试数据很大，有22513个数据点，并且可能有许多在评估过程中被忽略的人为值。测试数据中没有<strong class="ig hi"> relevance_variance </strong>列。</p></blockquote><h2 id="d152" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated"><strong class="ak"> 3。绩效指标:</strong></h2><p id="531e" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">这里的目标变量本质上是有序的。我们不能使用简单的分类指标，如准确度或F1分数。如下图所示:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mr"><img src="../Images/37f43e77923cc2926558f7a5e12eedac.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*_EalULG94XshHFFuS7EJ6w.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">上述代码的结果</figcaption></figure><p id="835a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，准确性需要更高分数的准确类别标签，因此，即使类别标签接近实际数据，它也会给我们相同的结果。</p><p id="adaf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是如果预测的类接近实际的训练数据，kappa分数将给出更好的结果。关于如何实现二次kappa评分的更多细节，我推荐查看这个漂亮的Kaggle <a class="ae jo" href="https://www.kaggle.com/carlolepelaars/understanding-the-metric-quadratic-weighted-kappa" rel="noopener ugc nofollow" target="_blank">内核</a>。</p><p id="52bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可能会想为什么不是MSE。仅供参考，情况1的MSE将返回7.5，情况2的MSE将返回1。要提高Kappa分数，你可以做两件事:</p><ol class=""><li id="fbcb" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb kr ks kt ku bi translated">建立降低MSE的回归模型，观察到降低的MSE给出更好的Kappa分数。训练后，我们可以四舍五入到最接近的整数，以获得类标签。</li></ol><blockquote class="mj mk ml"><p id="23fe" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated"><em class="hh">选择阈值:</em></p><p id="2f75" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">由于回归可以取从0到无穷大的任何值，所以可以说低于0.5的值为0级，介于0.5和1.5之间的值为1级，介于1.5和2.5之间的值为2级，介于2.3和3.5之间的值为3级，高于3.5的值为4级。</p><p id="c9c8" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">因此，系数是:[0.5，1.5，2.5，3.5]</p><p id="2141" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">这些系数可能是也可能不是最佳的。请记住，我们正试图获得最佳系数，从而提高评估指标。你可以使用这个<a class="ae jo" href="https://www.kaggle.com/c/petfinder-adoption-prediction/discussion/76107" rel="noopener ugc nofollow" target="_blank">内核</a>得到最好的系数。</p></blockquote><p id="2d2f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.直接用Kappa评分作为损失函数。(这可能很难做到)</p><h2 id="c19e" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated"><strong class="ak"> 4。第一次切割方法:</strong></h2><p id="c4b8" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">现在，我们对数据有了更多的了解。最简单的方法是使用一次性编码将查询转换为向量，将文本数据(product_title和product_description)转换为数字形式，并拟合像逻辑回归这样的基线模型。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/0f2e1b61594f18604e8cfc890c842a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56fgzRqnVP5Sv1r7gEgf0w.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">最简单的训练模型</figcaption></figure><p id="fe53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您也可以尝试线性回归，将结果四舍五入到最接近的整数。</p><h2 id="c5e4" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated"><strong class="ak"> 5。文本预处理:</strong></h2><p id="eae4" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 5.1清理HTML </em> </strong></p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="832e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Beautiful soup让生活变得简单，只需两行代码就可以从字符串中移除HTML标签。</p><p id="959a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 5.2字替换:</em> </strong></p><p id="837f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">意思相近的词用常用词代替，例如:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mt"><img src="../Images/4ede523250cd15fcdeb8f0d71caec34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGriWdW81ch-9Nx6Uu0iRg.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">有相似意思并且将被替换的单词的简短列表。</figcaption></figure><p id="29b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个列表摘自本次竞赛的获奖答案，感谢作者花时间在数据中寻找这些细微的差异。</p><p id="4166" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 5.3去词干、去收缩和去停用词:</em> </strong></p><p id="ccd4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些是你在任何NLP问题中会用到的常用技巧，你可以在下面找到代码:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="3578" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 5.4总结加工步骤:</em> </strong></p><p id="45b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">HTML标签删除→单词替换→词干提取→去收缩→删除标点符号→停止单词删除</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">所有预处理步骤</figcaption></figure><h2 id="cf24" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">预处理有必要吗，会给我们带来什么？</h2><p id="2533" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">下面是预处理前后查询和标题100%匹配的数据点的百分比。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mu"><img src="../Images/8bf23346e98fe8b814c4f10c21a72407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlBkEgN6KeLDIGSUJHxwlA.png"/></div></div></figure><blockquote class="mv"><p id="23f8" class="mw mx hh bd my mz na nb nc nd ne jb dx translated">正如您所注意到的，在没有预处理的情况下，有41%的数据点在查询中的所有单词都出现在标题中，但是在预处理之后，这一比例增加到49%(在中值相关度为4的数据点中)。</p></blockquote><h2 id="8802" class="jp jq hh bd jr js nf ju jv jw ng jy jz ip nh kb kc it ni ke kf ix nj kh ki kj bi translated"><strong class="ak"> 6。文本矢量化:</strong></h2><p id="a13d" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">在开始此步骤之前，请确保您已经正确分割了培训数据。</p><p id="0ad5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 6.1处理查询数据:</em> </strong></p><p id="d7cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请确保用' _ '替换所有空格，以创建一个类别。</p><pre class="jd je jf jg fd lq lr ls lt aw lu bi"><span id="d0f6" class="jp jq hh lr b fi lv lw l lx ly"># Replacing space with underscore to make it a single word.<br/>df['cleaned_query'] = df.apply(lambda x : x['query'].replace(' ','_'),axis = 1)</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nk"><img src="../Images/d12c7737c68ca91066307fb373c821a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*q0fYBaaYVh1DgU9cO8OGnA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">用下划线替换后</figcaption></figure><p id="f436" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对<em class="li"> cleaned_query </em>列进行一次性编码的代码。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="7cb0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果没有用下划线替换空格，那么计数矢量器</p><ol class=""><li id="3c53" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb kr ks kt ku bi translated">将每个单词视为一个独特的功能，比如在数据点“无线鼠标”，我们不希望“无线”是一个功能，“鼠标”是单独的一个功能，我们希望组合应该是独特的。</li></ol><p id="ea8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.不必要地增加了数据的维度。</p><p id="ad6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 6.2使用TFIDF矢量器</em> </strong>处理产品标题和产品描述</p><p id="eb1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于这两个数据点，我们将进行简单的TFIDF矢量化，这是product_title的代码，您可以遵循product_description的相同方法。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="fdf0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 6.3使用平均W2V处理产品_标题和产品_描述:</em> </strong></p><p id="1b1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本节中，我们将为我们的文本数据创建一个单词到矢量的模型，预训练的单词嵌入可以从这个<a class="ae jo" href="https://nlp.stanford.edu/projects/glove/" rel="noopener ugc nofollow" target="_blank">链接</a>下载。</p><p id="0c30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在下面的代码中，我们首先加载glove向量，现在对于每个句子中的每个单词，如果单词embedding存在于glove文件中，则获取向量(model.get( <word>))。基于存在的嵌入数目，我们计算平均值。</word></p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><blockquote class="mj mk ml"><p id="29fc" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">注意:确保在使用单词到向量时没有做词干处理，因为词干处理会导致单词的不同形式，并且这个单词可能是非英语单词。例如，词干(' batteries ')会给我' batteri '，而这个单词不会出现在单词嵌入文件中。</p><p id="66c4" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">有其他解决方法吗？</p><p id="ae81" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">是的，你可以做词汇化来解决这个问题，因为它返回一个实际的英语单词。</p></blockquote><p id="3984" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 6.4使用TFIDF-W2V处理文本数据:</em> </strong></p><p id="1ade" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将乘以相应的TFIDF值，然后取单词嵌入的平均值，而不是取单词嵌入的简单平均值。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h2 id="5546" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">7.高级特征工程。</h2><p id="dfa1" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">设C —查询、标题和描述的所有组合—(查询、标题)、(标题、描述)、(描述、查询)。</p><ul class=""><li id="023d" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb lp ks kt ku bi translated">每个文本特征中的总字数。</li><li id="500f" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">c语言中的常用字数。</li><li id="ee51" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">c #中唯一的常用字数。</li><li id="850c" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">标准化常用字数-将常用字数除以两列之间的最大字数。</li></ul><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><ul class=""><li id="aad4" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb lp ks kt ku bi translated">C语言中常见的二元模型计数，唯一的二元模型计数以及C语言特性中所有可能的比率。</li><li id="f9b1" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">C中常见的三元组计数，唯一的二元组计数和C中所有可能的比率特征。</li><li id="dc9c" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb lp ks kt ku bi translated">统计查询、描述、查询中的位数。</li></ul><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h2 id="097b" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">8.建模:</h2><p id="f48e" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated"><strong class="ig hi"> <em class="li"> 8.1基线模型:</em> </strong></p><p id="f584" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们尝试第一种方法:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es nl"><img src="../Images/50246c088d2c7f5a861964ecf2287329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*aHj34ezjpPVGSuWrQRL4uA.png"/></div><figcaption class="le lf et er es lg lh bd b be z dx translated">基线模型的结果。</figcaption></figure><p id="1a12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="li">型号— 2: </em> </strong></p><ol class=""><li id="267f" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb kr ks kt ku bi translated">我使用截断奇异值分解来减少维数，主要是为了避免过度拟合和训练更快。</li><li id="56a5" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">标准化SVD输出。</li><li id="c087" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">对标准化数据应用核SVM(RBF)。</li></ol><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mh"><img src="../Images/a2e3e14e0e0739922b92c59d18551474.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yos8tCr25Fj5N3JZBdpXRw.png"/></div></div></figure><blockquote class="mj mk ml"><p id="f58c" class="ie if li ig b ih ii ij ik il im in io mm iq ir is mn iu iv iw mo iy iz ja jb ha bi translated">我得到了0.614作为测试数据的Kappa分数，但这个分数可以通过堆叠更复杂的模型来显著提高。</p></blockquote><p id="7595" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">未来工作:</p><ol class=""><li id="1f13" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb kr ks kt ku bi translated">训练更复杂的模型并堆叠它们以克服过度拟合问题。</li><li id="22a6" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">实现基于距离的特征—余弦相似性、Jaccard距离、所有组合之间的骰子距离。</li></ol><p id="61e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">博客中使用的所有代码都有清晰的文档记录，可以在这个<a class="ae jo" href="https://github.com/GowthamChowta/30daysofNLP" rel="noopener ugc nofollow" target="_blank">资源库</a>中找到。也可以在<a class="ae jo" href="https://www.linkedin.com/in/gauthamchowta/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我。</p><p id="4f99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">参考文献:</strong></p><ol class=""><li id="dd50" class="kk kl hh ig b ih ii il im ip lm it ln ix lo jb kr ks kt ku bi translated"><a class="ae jo" href="https://github.com/ChenglongChen/kaggle-CrowdFlower/blob/master/Doc/Kaggle_CrowdFlower_ChenglongChen.pdf" rel="noopener ugc nofollow" target="_blank">本次比赛的第一名方案。</a></li><li id="17a0" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated"><a class="ae jo" href="https://www.appliedaicourse.com/" rel="noopener ugc nofollow" target="_blank">应用人工智能课程。</a></li><li id="c744" class="kk kl hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated"><a class="ae jo" href="https://www.kaggle.com/c/crowdflower-search-relevance/discussion/15299" rel="noopener ugc nofollow" target="_blank">第二名进场和代码。</a></li></ol><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nm"><img src="../Images/3af1db94d84644a633a0bdfa3aee20b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FhIr37BjOBUDqJeg.gif"/></div></div></figure><p id="95de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你觉得这个博客有用，请点击拍手按钮，让我的一天更快乐..:)</p></div></div>    
</body>
</html>