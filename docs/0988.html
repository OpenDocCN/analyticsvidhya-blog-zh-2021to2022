<html>
<head>
<title>NeuralProphet: A Neural Network based Time-Series Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NeuralProphet:基于神经网络的时间序列模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/neuralprophet-a-neural-network-based-time-series-model-3c74af3b0ec6?source=collection_archive---------5-----------------------#2021-02-09">https://medium.com/analytics-vidhya/neuralprophet-a-neural-network-based-time-series-model-3c74af3b0ec6?source=collection_archive---------5-----------------------#2021-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="89f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">NeuralProphet是一个python库，用于基于神经网络对时序数据进行建模。它建立在PyTorch之上，并受到脸书先知和AR-Net库的极大启发。时间序列数据基本上是在一段时间内通过重复测量获得的观察值的集合。例如，天气数据、污染水平数据等。</p><p id="7cd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了理解NeuralProphet，我们来看一个简单的例子，用NeuralProphet软件包来预测澳大利亚的<a class="ae jd" href="https://www.kaggle.com/jsphyg/weather-dataset-rattle-package" rel="noopener ugc nofollow" target="_blank">降雨数据集的温度。</a></p><p id="9081" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤如下-</p><ol class=""><li id="26c6" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">安装和导入Neural Prophet</li><li id="2f00" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">读取和预处理气象数据</li><li id="abd5" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">训练神经营养模型</li><li id="51bb" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">使用NeuralProphet生成预测</li><li id="b0a9" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">保存模型以备将来使用</li></ol></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="a03d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak"> 1。安装和导入neural propht</strong></h1><p id="66e4" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">要在Windows上安装NeuralProphet，请打开命令提示符并输入以下pip命令-</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b13d" class="ll ka hi lh b fi lm ln l lo lp">pip install neuralprophet</span></pre><p id="e3d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正在导入所有依赖项-</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="40c7" class="ll ka hi lh b fi lm ln l lo lp">import pandas as pd <br/>from neuralprophet import NeuralProphet<br/>from matplotlib import pyplot as plt<br/>import pickle</span></pre><p id="7101" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们导入pandas、neuralprophet、matplotlib进行数据可视化，并导入pickle库保存我们训练好的模型以备将来使用。</p><h1 id="c4df" class="jz ka hi bd kb kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw bi translated"><strong class="ak"> 2。读取并预处理气象数据</strong></h1><p id="72a4" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">现在，我们需要做的下一件事是导入我们的数据，我们将使用的数据集是这个weatherAUS.csv文件。我们使用python库pandas将它读入数据框。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="450c" class="ll ka hi lh b fi lm ln l lo lp">df = pd.read_csv('weatherAUS.csv')<br/>df.head()</span></pre><p id="e260" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">df.head()命令有助于显示数据集的前5行。</p><p id="883f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集列值如下—</p><p id="15e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">日期'，'位置'，'最小温度'，'最大温度'，'降雨量'，'蒸发'，<br/>，'阳光'，'风阵风'，'风风速' 9am '，'风风向3pm '，'风速9am '，'湿度9am '，'湿度3pm '，<br/>，'压力9am '，'压力3pm '，'云9am '，'云3pm '，'温度9am '，<br/>，'温度3pm '，'今天下雨'，'明天下雨'</p><p id="6e2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为简单起见，我们将选择“墨尔本”作为地点，并预测“下午3点”的温度。</p><p id="1ecb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在分析数据帧的数据类型时，我们看到日期属于“对象”类型，为了更容易处理，我们将其转换为“日期时间”类型。</p><p id="b938" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们只过滤出“墨尔本”位置的数据集，并转换“日期”列的数据类型。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="c8c2" class="ll ka hi lh b fi lm ln l lo lp">melb = df[df[‘Location’]==’Melbourne’]<br/>melb[‘Date’] = pd.to_datetime(melb[‘Date’])<br/>melb.head()</span></pre><figure class="lc ld le lf fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es lv"><img src="../Images/1d4ab92d8b276a81ec77b500ec2713bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wKv_MXMiQUmV6PpQ8GaQDw.png"/></div></div></figure><p id="edfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用matplotlib可视化数据，并找到天气模式。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="2efd" class="ll ka hi lh b fi lm ln l lo lp">plt.plot(melb[‘Date’], melb[‘Temp3pm’])<br/>plt.show()</span></pre><figure class="lc ld le lf fd lw er es paragraph-image"><div class="er es md"><img src="../Images/3b74141925d786ecd59912fcbba0f2ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*yQDa8ki4_xZlBl1ooQTMgQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">从2009年到2015年的垂直/垂直温度3pm图</figcaption></figure><p id="dc3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当我们将数据传递给neuralprophet时，它只需要两列——一列是代表日期的“ds ”,另一列是代表我们要预测的值的“y ”,所以我们要将日期列设置为等于ds，将temp3pm设置为等于y，然后去掉所有其他列。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="9d5e" class="ll ka hi lh b fi lm ln l lo lp">data = melb[[‘Date’, ‘Temp3pm’]] <br/>data.dropna(inplace=True)<br/>data.columns = [‘ds’, ‘y’] <br/>data.head()</span></pre><figure class="lc ld le lf fd lw er es paragraph-image"><div class="er es mi"><img src="../Images/dc50bb841fbb7d01f37597ff2a98bd40.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*ofbKn064DBNe7X-DHUJHAQ.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">用于神经营养疗法培训的更新数据集</figcaption></figure><h1 id="0823" class="jz ka hi bd kb kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw bi translated">3.训练神经营养模型</h1><p id="b967" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">在所有繁琐的预处理之后，我们开始训练模型。我们创建一个新的neuralprophet模型的未训练实例，并使用fit()方法来训练该模型。最终模型将存储在变量“m”中。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="f912" class="ll ka hi lh b fi lm ln l lo lp">m = NeuralProphet()<br/>model = m.fit(data, freq=’D’, epochs=1000)</span></pre><p id="abef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拟合方法采用3个参数-数据帧、数据频率(即天数)和时期(算法在训练期间必须完成的次数)。</p><p id="9499" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成训练后，我们最终得到的平均绝对误差为3，这意味着我们的预测将会精确到正负3度。这完全取决于数据集的大小和历元的数量。</p><p id="972f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在模型已经准备好并训练好了，我们现在可以预测未来的温度。</p><h1 id="a1b9" class="jz ka hi bd kb kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw bi translated">4.使用NeuralProphet生成预测</h1><p id="9d30" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">我们将首先制作一个为期500天的“未来”数据框架，并使用predict方法来预测未来的气温。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="5738" class="ll ka hi lh b fi lm ln l lo lp">future = m.make_future_dataframe(data, periods=500)<br/>forecast = m.predict(future)<br/>forecast.head()</span></pre><p id="ce40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一行中，make_future_dataframe()方法获取参数——数据、数据帧和500天的时间段，即未来500天的温度。</p><figure class="lc ld le lf fd lw er es paragraph-image"><div class="er es mj"><img src="../Images/efc41c3e0da3e66072b1ae941657599d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*x7mpgQIOt75_KNkABbMIpA.png"/></div><figcaption class="me mf et er es mg mh bd b be z dx translated">最终预测数据</figcaption></figure><p id="1601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过改变周期参数，我们可以如我们所愿预测未来一天的温度。</p><p id="b859" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更好地理解结果，我们可以把结果画出来-</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b7a3" class="ll ka hi lh b fi lm ln l lo lp">plot1 = m.plot(forecast)</span></pre><figure class="lc ld le lf fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mk"><img src="../Images/3f73091e5b43bdd56785cc342aff4817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWrSkiS1R-24SbhBoaiPYQ.png"/></div></div><figcaption class="me mf et er es mg mh bd b be z dx translated">2015年至2017年的预测图—日期(x轴)v/s温度(y轴)</figcaption></figure><p id="9c84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们为详细的分析生成组件图-</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="e440" class="ll ka hi lh b fi lm ln l lo lp">plt2 = m.plot_components(forecast)</span></pre><figure class="lc ld le lf fd lw er es paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="er es mk"><img src="../Images/b7646ba3cd0e0d35ac17e6bee5b73ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wCAmn_qb8YuSEcw_XT8wmQ.png"/></div></div></figure><p id="526f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总体趋势显示气温正在上升。</p><p id="d1d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是如何使用NeuralProphet库生成时间序列预测。</p><h1 id="92ce" class="jz ka hi bd kb kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw bi translated">5.保存模型以备将来使用</h1><p id="45f0" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">对于大多数机器学习程序，使用pickle库保存训练模型，以保存训练模型供将来使用。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b943" class="ll ka hi lh b fi lm ln l lo lp">with open('neuralprophet_model.pkl', "wb") as f:<br/>    pickle.dump(m, f)</span></pre><p id="c40a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们打开一个文件“neuralprophet_model.pkl ”,它将包含保存的模型，我们在“wb ”(写二进制)中打开它；作为f。</p><p id="bb98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们把模型m转储到f。</p><p id="890c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的模型被保存起来以备将来使用。</p><h1 id="bdb8" class="jz ka hi bd kb kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw bi translated">参考</h1><ol class=""><li id="9bf5" class="je jf hi ih b ii kx im ky iq ml iu mm iy mn jc jj jk jl jm bi translated"><a class="ae jd" href="https://pypi.org/project/neuralprophet/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/neuralprophet/</a></li><li id="ca97" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">https://neuralprophet.com/<a class="ae jd" href="https://neuralprophet.com/" rel="noopener ugc nofollow" target="_blank"/></li><li id="0e67" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">【https://github.com/ourownstory/neural_prophet T4】</li></ol><h1 id="1f0c" class="jz ka hi bd kb kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw bi translated">感谢您的阅读！</h1><p id="90d2" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">如果你想支持这个页面，这里是我的<a class="ae jd" href="https://www.paypal.me/saandman" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">小费罐💰</strong> </a>，真的很欣赏。</p><p id="4d91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(不属于中型合作伙伴计划。)</p><p id="9ced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给我留个便条询问。</p></div></div>    
</body>
</html>