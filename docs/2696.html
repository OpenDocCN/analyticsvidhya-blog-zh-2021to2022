<html>
<head>
<title>Implementation of RAPIDS + Google Colabority for a set of open data corresponding to hospital discharges in Ecuador in 2019</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对厄瓜多尔2019年医院出院对应的一组开放数据实施RAPIDS + Google Colabority</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/implementation-of-rapids-google-colabority-for-a-set-of-open-data-corresponding-to-hospital-5b84d49077ab?source=collection_archive---------5-----------------------#2021-05-13">https://medium.com/analytics-vidhya/implementation-of-rapids-google-colabority-for-a-set-of-open-data-corresponding-to-hospital-5b84d49077ab?source=collection_archive---------5-----------------------#2021-05-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/6b212c6d1b5e5cf7f18b0d49c8869ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*ykPRVIRKcTqOkN8KLT6erA.png"/></div></figure><figure class="im in io ip fd ii er es paragraph-image"><div class="er es il"><img src="../Images/7ffc37a02c428ed4d79147424e7436b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*491wf8mK3DdGt6kDFmNJGg.png"/></div></figure><p id="52fa" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">这个博客的想法是了解RAPIDS图书馆和Google Colabority (Colab)平台的一部分是如何工作的，以便能够使用专注于数据科学的新技术，以及我们如何利用它们。</p><p id="2001" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Google Colabority是一个基于Jupyter Notebook的免费Google环境平台，允许在像Google Chrome这样的浏览器中编写和执行python代码，它不需要任何所需的配置，它具有免费的GPU访问和代码共享的便利性，并预装了linux操作系统。</p><p id="4352" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Google Colabority允许创建数据科学、机器学习和深度学习的模型，它将个人机器从过于繁重、耗时耗力的工作中解放出来。</p><p id="793b" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">RAPIDS开源库提供了在GPU上运行端到端分析和数据管道的能力，专注于常见的数据科学和数据准备任务。包括一个熟悉的dataframe API，它集成了各种机器学习算法，用于端到端流水线加速，而无需支付典型的序列化成本</p><p id="7740" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">RAPIDS大大加快了对更大规模数据集的处理和训练，使数据科学家在解决最复杂的业务挑战方面实现了巨大的性能飞跃，例如预测信用卡欺诈、预测零售库存和了解客户行为等。</p><p id="ca0c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">对于RAPIDS的安装，执行环境必须启用GPU，进行这种更改对使用库很重要，因为它与GPU一起工作。</p><figure class="im in io ip fd ii er es paragraph-image"><div class="er es jo"><img src="../Images/056852e96a52e6c62b6e79cf61aba1d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*MoBXiOgjGXQMZhO654xgbQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">GPU Google Colabority运行时环境</figcaption></figure><p id="9090" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">通过编写下面一行代码来验证Colab正在使用的GPU的类型；通常最适合的预装GPU是特斯拉T4。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="4676" class="jy jz hh ju b fi ka kb l kc kd">!nvidia-smi</span></pre><figure class="im in io ip fd ii er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es ke"><img src="../Images/0cb01ac38ae9235cba37699fef101361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mky6myGT1FqV2HCLLv3wng.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Colab中的GPU类型</figcaption></figure><p id="5e2a" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">接下来，它使用以下代码行安装完整的RAPIDS库，它对应于与Colab的Python版本兼容的Miniconda的最新版本，并安装RAPIDS stable 0.19库，其中包括cuDF、cuML、cuSpatial、cuSignal和xgboost。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="88bc" class="jy jz hh ju b fi ka kb l kc kd"><em class="kj"># Install RAPIDS</em><br/>!git clone https://github.com/rapidsai/rapidsai-csp-utils.git<br/>!bash rapidsai-csp-utils/colab/rapids-colab.sh stable<br/><br/><strong class="ju hi">import</strong> <strong class="ju hi">sys</strong>, <strong class="ju hi">os</strong>, <strong class="ju hi">shutil</strong><br/><br/>sys.path.append('/usr/local/lib/python3.7/site-packages/')<br/>os.environ['NUMBAPRO_NVVM'] = '/usr/local/cuda/nvvm/lib64/libnvvm.so'<br/>os.environ['NUMBAPRO_LIBDEVICE'] = '/usr/local/cuda/nvvm/libdevice/'<br/>os.environ["CONDA_PREFIX"] = "/usr/local"<br/><strong class="ju hi">for</strong> so <strong class="ju hi">in</strong> ['cudf', 'rmm', 'nccl', 'cuml', 'cugraph', 'xgboost', 'cuspatial']:<br/>  fn = 'lib'+so+'.so'<br/>  source_fn = '/usr/local/lib/'+fn<br/>  dest_fn = '/usr/lib/'+fn<br/>  <strong class="ju hi">if</strong> os.path.exists(source_fn):<br/>    print(f'Copying <strong class="ju hi">{</strong>source_fn<strong class="ju hi">}</strong> to <strong class="ju hi">{</strong>dest_fn<strong class="ju hi">}</strong>')<br/>    shutil.copyfile(source_fn, dest_fn)<br/><em class="kj"># fix for BlazingSQL import issue</em><br/><em class="kj"># ImportError: /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.26' not found (required by /usr/local/lib/python3.7/site-packages/../../libblazingsql-engine.so)</em><br/><strong class="ju hi">if</strong> <strong class="ju hi">not</strong> os.path.exists('/usr/lib64'):<br/>    os.makedirs('/usr/lib64')<br/><strong class="ju hi">for</strong> so_file <strong class="ju hi">in</strong> os.listdir('/usr/local/lib'):<br/>  <strong class="ju hi">if</strong> 'libstdc' <strong class="ju hi">in</strong> so_file:<br/>    shutil.copyfile('/usr/local/lib/'+so_file, '/usr/lib64/'+so_file)<br/>    shutil.copyfile('/usr/local/lib/'+so_file, '/usr/lib/x86_64-linux-gnu/'+so_file)</span></pre><p id="7435" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在这个例子中，我们将只使用RAPIDS cuDF库，它将允许我们执行ETL过程(提取、转换和加载),以便理解我们正在处理的数据并对其进行整形，同时使其对一般用户来说是可理解的。</p><p id="2bb5" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">首先，我们开始在Colab中添加数据，这几行代码对于添加CSV、JSON等文件是必不可少的，数据大小为136 MB，包含1048576行信息，这显然是很大的数据，因此我们可以更好地利用RAPIDS进行ETL过程。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="a7de" class="jy jz hh ju b fi ka kb l kc kd"><strong class="ju hi">from</strong> <strong class="ju hi">google.colab</strong> <strong class="ju hi">import</strong> files</span><span id="1551" class="jy jz hh ju b fi kk kb l kc kd">dataEgresos = files.upload()</span></pre><p id="851b" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">导入用于ETL的RAPIDS cuDF库，并加入各自的特性，允许读取CSV文件和sep函数，用“；”分隔每一列并对信息留下印象，以确定它是否能够脱颖而出。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="d434" class="jy jz hh ju b fi ka kb l kc kd"><strong class="ju hi">import</strong> <strong class="ju hi">cudf</strong><br/><br/>gdfData = cudf.read_csv('dataEgresos.csv', sep=';')</span><span id="3f2a" class="jy jz hh ju b fi kk kb l kc kd"><em class="kj">#Data information</em><br/>print(gdfData) #Data information<br/>print(gdfData.shape) #How many rows and columns of the data<br/>print(gdfData.ndim) #Data dimension</span></pre><figure class="im in io ip fd ii er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kl"><img src="../Images/dbd5e6b0ccd318f24416472f7f760180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UIzXqxoLrlCpkkxEoY7dXA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据信息</figcaption></figure><p id="86bd" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">它所处理的数据对应于厄瓜多尔2019年的医院出院人数，由<a class="ae km" href="https://www.ecuadorencifras.gob.ec/institucional/home/" rel="noopener ugc nofollow" target="_blank">国家统计和人口普查研究所提供。</a></p><p id="849b" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在这种情况下，它总是取决于您正在处理的数据的类型，以确定一个可行的结论，允许您给予数据最大的重要性。</p><p id="e894" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">现在，我们继续转换数据，即清除空值，如果信息是可理解的，则消除重复值。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="24b5" class="jy jz hh ju b fi ka kb l kc kd"><em class="kj">#Start to carry out the data transformation process</em><br/><br/><em class="kj">#Remove columns of the data that have no relevance</em><br/>gdfNewEgresos = gdfData.drop(columns=['prov_ubi', 'cant_ubi', 'parr_ubi', 'area_ubi', 'clase', 'tipo', 'entidad', 'sector', 'mes_inv', 'nac_pac', 'cod_pais', 'etnia', 'prov_res', 'cant_res', 'parr_res', 'area_res', 'fecha_ingr','dia_estad', 'fecha_egr', 'con_egrpa', 'esp_egrpa', 'cau_cie10','causa3', 'cap221rx', 'cau221rx', 'cau298rx'])<br/><br/><em class="kj">#View the data again and print two rows of information</em><br/>gdfNewEgresos.head(2)</span></pre><figure class="im in io ip fd ii er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kn"><img src="../Images/ebf240f92f2b68c0307f268aa84b23a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KUf1mJmWNbHGie6FA2rbAw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><em class="ko">再次查看数据并打印两行信息</em></figcaption></figure><p id="a6e6" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">使用cuDF特性:dtypes和notnull检查每一列的数据类型，并详细说明数据中是否有null值。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="ad72" class="jy jz hh ju b fi ka kb l kc kd"><em class="kj">#verify the data type of the data</em><br/>print(gdfNewEgresos.dtypes)<br/><br/><em class="kj">#check for null or empty values</em><br/>print(gdfNewEgresos.notnull)</span></pre><figure class="im in io ip fd ii er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kp"><img src="../Images/4e5aa5ca8092ba6e809a5a41cdde0611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Z5iYcszQV5pQKoi_iV03g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据类型和空值</figcaption></figure><p id="6690" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我强调，就空值和每列的数据类型而言，数据是正确的，因此没有进行修改，但当发现不清楚的数据时，这些是验证我们正在处理的内容以及未来可以做什么的主要步骤。</p><p id="83db" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">现在我们可以做的是消除重复值，这样我就可以看到数据中有重复值，所以有必要完成这一步并重置索引(不要取数据的一般值，如果不重新开始从0到最后一行进行计数)。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="3470" class="jy jz hh ju b fi ka kb l kc kd"><em class="kj">#Delete rows with duplicate values</em><br/>gdfNewEgresos = gdfNewEgresos.drop_duplicates()<br/><br/><em class="kj">#reset the index</em><br/>gdfNewEgresos = gdfNewEgresos.reset_index()<br/>gdfEgresos =  gdfNewEgresos.drop('index', axis=1)</span></pre><p id="31b2" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在这种情况下，由于我们已经完成了数据转换过程，我们要做的是再次探索信息并验证结果。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="a19c" class="jy jz hh ju b fi ka kb l kc kd"><em class="kj">#Explore the already transformed data</em><br/>print(gdfEgresos.columns) #data columns<br/>print(gdfEgresos.shape) #How many rows and columns of the data<br/>print(gdfEgresos.dtypes) #data type of each column<br/>print(gdfEgresos.head(4)) #data information only with 4 rows</span></pre><figure class="im in io ip fd ii er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es kq"><img src="../Images/8ea27c71d5ffa89497077d0e986337d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tsMl8tixirmEmnYp5uHpA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据探索</figcaption></figure><p id="5343" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我强调，cuDF库有许多功能可以使用和探索，它类似于熊猫，如果你熟悉这个库，cuDF会让你很容易学会。</p><p id="47bb" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">最后，我们要做的是将转换后的数据加载到一个新的数据集(CSV)中。在这一步中，我们使用cuDF to_csv特性完成了ETL过程，该特性允许我们将数据转换为新的csv文件，并继续将该文件下载到我们的个人计算机上。</p><pre class="im in io ip fd jt ju jv jw aw jx bi"><span id="48de" class="jy jz hh ju b fi ka kb l kc kd"><em class="kj">#Load the data to a new CSV</em><br/>Egresos_Data = 'Ecuador_Egresos.csv'<br/>gdfEgresos.to_csv(Egresos_Data)</span><span id="fa50" class="jy jz hh ju b fi kk kb l kc kd"><em class="kj">#Download the data</em><br/><strong class="ju hi">from</strong> <strong class="ju hi">google.colab</strong> <strong class="ju hi">import</strong> files<br/><br/>files.download('Ecuador_Egresos.csv')</span></pre><h1 id="e6be" class="kr jz hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ak">结论</strong></h1><p id="028f" class="pw-post-body-paragraph iq ir hh is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn ha bi translated">目前，数据科学的一个关键部分是数据探索，随着信息的增加，在CPU上运行的ETL(提取、转换、加载)过程变得缓慢而繁琐。RAPIDS为用户提供了一种简化的方法，在这种方法中，数据最初被加载到GPU上，计算任务可以直接在其上执行，随着数据的增长，该库获得了用户体验和性能的重要组合。Colab是一个出色的平台，允许在云中使用GPU的能力，这使得那些在个人计算机上没有GPU的开发人员更容易使用它，到目前为止，Colab我正在使用它来翻译一些项目以及练习数据科学。</p><p id="a0a7" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">一些参考资料:</p><p id="099e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><a class="ae km" href="https://rapids.ai/index.html" rel="noopener ugc nofollow" target="_blank">激流</a>，<a class="ae km" href="https://colab.research.google.com/notebooks/intro.ipynb?hl=es-419" rel="noopener ugc nofollow" target="_blank">协作室</a>。RAPIDS开源库，Google合作实验室</p><p id="1abf" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">GitHub:</p><p id="3adb" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">【https://github.com/JoseGuarnizo/RAPIDS-COLAB T4】</p></div></div>    
</body>
</html>