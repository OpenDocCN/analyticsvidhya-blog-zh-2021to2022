<html>
<head>
<title>All about it : Time Series Analysis — Exponential smoothing example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">全部内容:时间序列分析—指数平滑示例</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/all-about-it-time-aeries-analysis-exponential-smoothing-example-e62057768bc1?source=collection_archive---------7-----------------------#2021-02-02">https://medium.com/analytics-vidhya/all-about-it-time-aeries-analysis-exponential-smoothing-example-e62057768bc1?source=collection_archive---------7-----------------------#2021-02-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/30fe90a694598f08f66b7666c0df2e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IWKTDXElpzLDMMnFLdn4Zw.jpeg"/></div></div></figure><p id="abab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated"><span class="l jp jq jr bm js jt ju jv jw di">大家好</span> <strong class="is hj">大家好！</strong>在本文中，我将使用python中的指数平滑法来解释时间序列预测。如果你正在阅读这篇文章，我敢肯定你知道指数平滑法的基础知识。如果没有，你可以在这里阅读<a class="ae jx" href="https://sreeramkashyap.medium.com/all-about-it-time-series-analysis-box-jenkins-holt-winter-methods-fe19724ab884" rel="noopener">。</a></p><p id="7fc0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个例子中，我们将使用yfinance API下载股票市场数据，并了解简单的指数平滑是如何工作的。我用微软的数据作为例子。可以换成自己喜欢的股票。</p><p id="7e67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们开始吧。</p><p id="abfa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简而言之，指数平滑:它对历史数据使用平滑因子，并为数据分配权重。然后用它来预测未来。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="1d4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kf">数据:</em>我们将使用雅虎财经API使用1个月的股市数据。</p><p id="ff05" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kf">语言:</em> Python</p><p id="0828" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kf">库:</em> statmodels，pandas，matplotlib，datetime。</p><p id="0ba6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kf"> API: </em> yfinance</p><p id="e2d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先安装库。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e4e5" class="kp kq hi kl b fi kr ks l kt ku">!pip install pandas, matplotlib<br/>!pip install statmodels</span></pre><p id="63f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们准备开始了。我们需要导入以下库</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e482" class="kp kq hi kl b fi kr ks l kt ku">import pandas as pd<br/>import yfinance as yf<br/>import datetime<br/>import matplotlib.pyplot as plt<br/>from statsmodels.tsa.api import SimpleExpSmoothing</span></pre><p id="f64d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要从yfinance下载数据。yfinance API每天更新股票市场数据。它需要三个主要参数，即tickers、period和interval。Period是我们要下载的数据的总周期，interval是两次记录之间的间隔或每个时间步长的大小。Tickers将我们想要的股票的符号列在股票市场上。你可以从纽约证券交易所或标准普尔500指数列表中查看你喜欢的股票的代码。</p><p id="3bf4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下命令下载数据。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9937" class="kp kq hi kl b fi kr ks l kt ku">data = yf.download(tickers=’MSFT’, period=’1mo’, interval=’1d’)</span></pre><p id="98f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以使用head()命令查看下载的数据</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="70fc" class="kp kq hi kl b fi kr ks l kt ku">data.head(3)</span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/05685f811fe4ea69b8f7d80fcb3ebaec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6Hb5Wtk9ClLvobcX6bUBA.png"/></div></div></figure><p id="02c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们首先绘制下载的数据，看看它是什么样子</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3680" class="kp kq hi kl b fi kr ks l kt ku">today = datetime.date.today()<br/>plt.figure()<br/>plt.title(‘ MICROSOFT STOCK FOR LAST 1 MONTH AS ON ‘+ str(today))<br/>plt.plot(data[‘Close’])</span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/680793616791f4355f22aa6cc33fb103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*HVmWD95igcTvfqPVW8_tIQ.png"/></div></figure><p id="e967" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在绘制的图中，您可以观察到一段时间内的增长趋势以及每个时间步长的一些变化。这就是典型的股价图的样子。</p><p id="ce3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们来预测一下。我们将使用statsmodels库的内置<a class="ae jx" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.holtwinters.SimpleExpSmoothing.html" rel="noopener ugc nofollow" target="_blank"> SimpleExpSmoothing </a>函数进行预测。为此，我们需要指定平滑系数(α)。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6aa1" class="kp kq hi kl b fi kr ks l kt ku">SimpleExpSmoothing(data”).fit(smoothing_level=0.1)</span></pre><p id="7a63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在此详细了解<a class="ae jx" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.holtwinters.SimpleExpSmoothing.html" rel="noopener ugc nofollow" target="_blank">功能和参数</a></p><p id="0bc9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个函数还需要其他参数，但这足以让我们理解。</p><p id="d122" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们首先定义输入。该函数需要由值和索引组成的一系列输入。在我们的例子中，值是股票在每个时间步的收盘价，指数是日期。</p><p id="1174" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里要做的另一个决定是预测的时间步长。这定义了我们要预测未来多少时间步长的值。在本例中，我们将选择2天的时间步长。请记住，时间步长应与下载数据时定义的间隔单位相同。在我们的例子中，两者都是以天为单位的。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="1c3f" class="kp kq hi kl b fi kr ks l kt ku">data = data[‘Close’].tolist()<br/>index= pd.date_range(start=’2021–01–05', end=’2021–02–01', freq=’B’)<br/>stock_data = pd.Series(data, index)<br/>forecast_timestep = 2</span><span id="4a0f" class="kp kq hi kl b fi kx ks l kt ku">#CHANGE DATA to period of 30 DAYS FROM THE DATE WHEN YOU ARE RUNNING THIS CODE</span></pre><p id="79fa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们将首先使用SimpleExpSmoothing函数来拟合曲线，然后对每个时间步长进行预测。</p><p id="cd0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们需要指定alpha值。我们在上一篇文章中讨论过，alpha值是在反复试验的基础上设置的。所以我们先用三个不同的α值做实验。然后，我们将使用内置函数来选择alpha的最佳值。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="129a" class="kp kq hi kl b fi kr ks l kt ku">fit_1 = SimpleExpSmoothing(stock_data, initialization_method=”heuristic”).fit(smoothing_level=0.1,optimized=False)<br/>forecast1 = fit_1.forecast(forecast_timestep).rename(r’$\alpha=0.1$’)<br/>plt.plot(stock_data, color=’black’)<br/>plt.plot(fit_1.fittedvalues, color=’cyan’)<br/>line1, = plt.plot(forecast1, color=’cyan’)</span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/84e8a9199c18335a5c9583354cb4b506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*_mhiw7mipjTDcuaRpZ9C5g.png"/></div></figure><p id="bce1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以很容易地看到预测值与实际值相差甚远。所以我们知道我们必须改变这个值。</p><p id="055f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在来试试0.4。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="fc01" class="kp kq hi kl b fi kr ks l kt ku">fit_2 = SimpleExpSmoothing(stock_data, initialization_method=”heuristic”).fit(smoothing_level=0.4,optimized=False)<br/>forecast2 = fit_2.forecast(forecast_timestep).rename(r’$\alpha=0.4$’)<br/>plt.plot(fit_2.fittedvalues, color=’red’)<br/>line2, = plt.plot(forecast2, color=’red’)</span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/cc05c7192ac88b05e65ac6dcc587bf60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*HYXK2Qq2ZDPbZaNNimGzuQ.png"/></div></figure><p id="2cb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以观察到预测值越来越接近实际值。所以现在我们知道我们需要进一步增加alpha值。</p><p id="1d43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看所有的值，以及选择阿尔法值的内置函数。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="cb26" class="kp kq hi kl b fi kr ks l kt ku">plt.figure(figsize=(16,10))<br/>plt.plot(stock_data,  color='black')<br/>plt.plot(fit_1.fittedvalues,  color='cyan')<br/>line1, = plt.plot(forecast1,  color='cyan')<br/>plt.plot(fit_2.fittedvalues,  color='red')<br/>line2, = plt.plot(forecast2, color='red')<br/>plt.plot(fit_3.fittedvalues,  color='green')<br/>line3, = plt.plot(forecast3, color='green')<br/>plt.plot(fit_4.fittedvalues,  color='blue')<br/>line4, = plt.plot(forecast4, color='blue')<br/>plt.legend([line1, line2, line3,line4], [forecast1.name, forecast2.name, forecast3.name,forecast4.name])<br/>plt.show()</span></pre><figure class="kg kh ki kj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/908f9a2899d097c27aee9cc38c775d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d92kJ-_2hoyZ_44w_OVLtQ.png"/></div></div></figure><p id="86cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你现在可以清楚地看到预报了。内置函数为alpha选择了0.810的值，正如您所观察到的，与其他值相比，它给出了很好的预测。但是如前所述，简单的指数平滑法并不是一个非常精确的方法。你可以看到αa =的最佳选择值也有一些偏差。</p><p id="d5bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整代码</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="57f2" class="kp kq hi kl b fi kr ks l kt ku">import numpy as np<br/>import pandas as pd<br/>import yfinance as yf<br/>import datetime <br/>import matplotlib.pyplot as plt<br/>from statsmodels.tsa.api import SimpleExpSmoothing</span><span id="3cc5" class="kp kq hi kl b fi kx ks l kt ku">data = yf.download(tickers=’MSFT’, period=’1mo’, interval=’1d’)</span><span id="4f1d" class="kp kq hi kl b fi kx ks l kt ku">data.head(3)</span><span id="e1e7" class="kp kq hi kl b fi kx ks l kt ku">today = datetime.date.today()<br/>plt.figure(figsize=(10,6))<br/>plt.title(‘ MICROSOFT STOCK FOR LAST 1 MONTH AS ON ‘+ str(today))<br/>plt.plot(data[‘Close’])<br/>plt.show()</span><span id="6769" class="kp kq hi kl b fi kx ks l kt ku">data = data[‘Close’].tolist()<br/>index= pd.date_range(start=’2021–01–05', end=’2021–02–01', freq=’B’)#CHANGE DATA FOR 30 DAYS FROM THE DATE WHEN YOU ARE RUNNING THIS CODE<br/>stock_data = pd.Series(data, index)<br/>forecast_timestep = 2</span><span id="ed1c" class="kp kq hi kl b fi kx ks l kt ku">fit_1 = SimpleExpSmoothing(stock_data, initialization_method=”heuristic”).fit(smoothing_level=0.1,optimized=False)<br/>forecast1 = fit_1.forecast(forecast_timestep).rename(r’$\alpha=0.1$’)</span><span id="05cc" class="kp kq hi kl b fi kx ks l kt ku">fit_2 = SimpleExpSmoothing(stock_data, initialization_method=”heuristic”).fit(smoothing_level=0.4,optimized=False)<br/>forecast2 = fit_2.forecast(forecast_timestep).rename(r’$\alpha=0.4$’)</span><span id="5138" class="kp kq hi kl b fi kx ks l kt ku">fit_3 = SimpleExpSmoothing(stock_data, initialization_method=”heuristic”).fit(smoothing_level=0.6,optimized=False)<br/>forecast3 = fit_3.forecast(forecast_timestep).rename(r’$\alpha=0.8$’)</span><span id="3908" class="kp kq hi kl b fi kx ks l kt ku">fit_4 = SimpleExpSmoothing(stock_data, initialization_method=”estimated”).fit()<br/>forecast4 = fit_4.forecast(forecast_timestep).rename(r’$\alpha=%s$’%fit_4.model.params[‘smoothing_level’])<br/></span><span id="a3dc" class="kp kq hi kl b fi kx ks l kt ku">plt.figure(figsize=(16,10))<br/>plt.plot(stock_data, color=’black’)<br/>plt.plot(fit_1.fittedvalues, color=’cyan’)<br/>line1, = plt.plot(forecast1, color=’cyan’)<br/>plt.plot(fit_2.fittedvalues, color=’red’)<br/>line2, = plt.plot(forecast2, color=’red’)<br/>plt.plot(fit_3.fittedvalues, color=’green’)<br/>line3, = plt.plot(forecast3, color=’green’)<br/>plt.plot(fit_4.fittedvalues, color=’blue’)<br/>line4, = plt.plot(forecast4, color=’blue’)<br/>plt.legend([line1, line2, line3,line4], [forecast1.name, forecast2.name, forecast3.name,forecast4.name])<br/>plt.show()</span></pre><p id="506b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在以后的文章中讨论其他方法。</p><h2 id="105c" class="kp kq hi bd la lb lc ld le lf lg lh li jb lj lk ll jf lm ln lo jj lp lq lr ls bi translated">………… <strong class="ak"> <em class="lt">敬请期待……..</em>T3】</strong></h2></div></div>    
</body>
</html>