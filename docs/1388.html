<html>
<head>
<title>File uploads with Amazon S3 in a Django Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Django项目中使用亚马逊S3上传文件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/file-uploads-with-amazon-s3-in-a-django-project-54fb989e992d?source=collection_archive---------3-----------------------#2021-02-27">https://medium.com/analytics-vidhya/file-uploads-with-amazon-s3-in-a-django-project-54fb989e992d?source=collection_archive---------3-----------------------#2021-02-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/6b72b83c570ab06fb4ad9d2fb5f9b322.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*8j73n2I5K60kH4CuXT65qA.png"/></div></figure><p id="f2c1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在一个Django项目中，我们将展示一个示例，它允许您安全可靠地将文件上传到作为外部存储的<strong class="io hj"> AWS S3 </strong>。不幸的是，没有免费的解决方案，我的<a class="ae jk" href="https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj">亚马逊免费层</strong> </a>已经过期。此外，如果您想要一个生产就绪的系统，您可以使用<a class="ae jk" href="https://min.io/?utm_source=lyapustin" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj"> MinIO </strong> </a>。</p><h1 id="3044" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">开始吧！</h1><p id="63e0" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">如果想快速设置Django项目，可以访问Django <a class="ae jk" href="https://docs.djangoproject.com/en/2.2/intro/tutorial01/" rel="noopener ugc nofollow" target="_blank"> <strong class="io hj"> doc </strong> </a>。首先，我们在您的<code class="du ko kp kq kr b">models.py</code>文件中创建一个<strong class="io hj">产品</strong>模型，并确保将其保存在您的<strong class="io hj"> admin.py </strong>文件中。因此，您可以从Django管理页面访问<strong class="io hj">产品</strong>型号<strong class="io hj"> </strong>。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="5338" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是一个简单的Django模型，可以用来存储<strong class="io hj">产品照片</strong>。Django admin允许使用模型上的文件字段上传文件。现在，我们将使用UI到Django管理页面。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es ky"><img src="../Images/9405aee74017c7801dbd9f5bfed82044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QvNlCUA7WozPhdyfvVxmsA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">Django管理页面</figcaption></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lh"><img src="../Images/bb99d6e08e797ee004756e788e41d4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h00Z6nvtR-KrUgjj3yDWLA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">产品列表页面</figcaption></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es li"><img src="../Images/b73a5ac68f491982381b1eabe209bc7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AE3fLq4qp9Hqk8_gRan8hw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">产品添加页面</figcaption></figure><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es lj"><img src="../Images/3d9079b4011560c04b2fbf7d4633e3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVvBz0N9tcyOiGO5IOIIWQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">添加产品后的产品列表页面</figcaption></figure><h1 id="b794" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">文件上传到哪里了？</h1><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/fece0d56452f0db3568b7ba0cc6d8b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*LEkOUUJ3aPOtvtohQa7qqg.png"/></div></figure><p id="635d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="ll">如你所见，文件被上传到app的根目录。</em></p><p id="38b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以在您的应用程序的<strong class="io hj">设置文件</strong>中更改<strong class="io hj"> MEDIA_ROOT </strong>属性。在<strong class="io hj"> MEDIA_ROOT </strong>中给定的路径将存储媒体文件。</p><pre class="ks kt ku kv fd lm kr ln lo aw lp bi"><span id="e3d3" class="lq jm hi kr b fi lr ls l lt lu">MEDIA_ROOT = os.path.join(BASE_DIR, 'path/to/store/my/files/')<!-- --> </span></pre><p id="1bf6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，如果我们再次上传文件，就会为上传的照片创建一个新的文件路径。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/b60eff63b00a51ab5fa2d54b60805a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*P4XlgPJv3DeCd439r-a2qQ.png"/></div></figure><h1 id="39e1" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">计划</h1><p id="e368" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">亚马逊S3提供了一个安全、可靠和可扩展的存储系统。我们可以从<strong class="io hj">设置文件中删除<strong class="io hj"> MEDIA_ROOT </strong>属性。</strong>现在，请按照以下步骤登录您的AWS帐户，轻松创建S3存储桶:</p><ul class=""><li id="add4" class="lw lx hi io b ip iq it iu ix ly jb lz jf ma jj mb mc md me bi translated">登录AWS帐户。</li><li id="778b" class="lw lx hi io b ip mf it mg ix mh jb mi jf mj jj mb mc md me bi translated">从AWS控制台的S3部分创建存储桶。</li><li id="6568" class="lw lx hi io b ip mf it mg ix mh jb mi jf mj jj mb mc md me bi translated">从IAM控制台创建具有编程访问权限的用户，并授予对S3的完全访问权限。如果创建了用户，则生成访问密钥和秘密访问密钥。然后你应该在你的<strong class="io hj"> settings.py </strong>文件中设置它们，如下所示:</li></ul><pre class="ks kt ku kv fd lm kr ln lo aw lp bi"><span id="a1c8" class="lq jm hi kr b fi lr ls l lt lu">AWS_ACCESS_KEY_ID = 'YOUR_ACCESS_KEY_HERE'<br/>AWS_SECRET_ACCESS_KEY = 'YOUR_SECRET_ACCESS_KEY_HERE'</span></pre><p id="cbdf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">此外，您还可以访问<a class="ae jk" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html#walkthrough1-add-users" rel="noopener ugc nofollow" target="_blank"><strong class="io hj">AWS</strong><strong class="io hj">doc</strong></a><strong class="io hj"/>来创建IAM用户和组。</p><h1 id="d9d8" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">助手库</h1><p id="3365" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">我们需要安装2个python库:</p><ul class=""><li id="034a" class="lw lx hi io b ip iq it iu ix ly jb lz jf ma jj mb mc md me bi translated"><a class="ae jk" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="io hj">boto 3</strong></a><strong class="io hj">:</strong>我们可以从您的代码内部管理AWS服务。</li><li id="fe1c" class="lw lx hi io b ip mf it mg ix mh jb mi jf mj jj mb mc md me bi translated"><a class="ae jk" href="https://django-storages.readthedocs.io/en/latest/backends/amazon-S3.html" rel="noopener ugc nofollow" target="_blank"><strong class="io hj">django-storages</strong></a><strong class="io hj">:</strong>我们通过<strong class="io hj"> django-storages使用亚马逊S3功能。</strong>你还需要在设置文件的<strong class="io hj"> INSTALLED_APPS </strong>中添加“存储”。</li></ul><p id="6345" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们可以在您的终端中运行以下命令。</p><pre class="ks kt ku kv fd lm kr ln lo aw lp bi"><span id="8255" class="lq jm hi kr b fi lr ls l lt lu">$ pip install boto3<br/>$ pip install django-storages</span></pre><p id="b217" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">以下是您应该提供的设置:</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div></figure><p id="8b03" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们用一个非常简单的工具快速轻松地进行设置。您应该能够轻松地将它添加到您的Django项目中。</p><p id="8569" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您也可以访问下面的文档获取更多信息。</p><ul class=""><li id="f5b5" class="lw lx hi io b ip iq it iu ix ly jb lz jf ma jj mb mc md me bi translated"><a class="ae jk" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingBucket.html" rel="noopener ugc nofollow" target="_blank">使用水桶。</a></li><li id="31fd" class="lw lx hi io b ip mf it mg ix mh jb mi jf mj jj mb mc md me bi translated"><a class="ae jk" href="https://docs.aws.amazon.com/general/latest/gr/sigv4-signed-request-examples.html" rel="noopener ugc nofollow" target="_blank">签约实例</a>。</li></ul></div></div>    
</body>
</html>