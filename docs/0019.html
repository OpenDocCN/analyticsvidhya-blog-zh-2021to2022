<html>
<head>
<title>Find Container Size for Multi tenant application using Azure Data Bricks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure数据块查找多租户应用程序的容器大小</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/find-container-size-for-multi-tenant-application-using-azure-data-bricks-bc58a14b146?source=collection_archive---------18-----------------------#2021-01-01">https://medium.com/analytics-vidhya/find-container-size-for-multi-tenant-application-using-azure-data-bricks-bc58a14b146?source=collection_archive---------18-----------------------#2021-01-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="3a75" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">用例</h1><ul class=""><li id="2186" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">数据被加载到Azure数据湖</li><li id="ce55" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在多租户模型中，我们可以将每个应用租户存储到相应的容器中</li><li id="8567" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在，当这个ADLS gen2被共享时，我们需要一个机制来计算容器的大小</li><li id="a397" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">这可用于内部计费，甚至用于了解使用了多少数据</li></ul><h1 id="1f1b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用python记事本读取容器尺寸的步骤</h1><h1 id="9a18" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="782b" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="ffb4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创造蔚蓝ADLS第二代</li><li id="ed87" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建Azure数据块</li><li id="e47b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将azure-storage-blob安装为pypi包</li><li id="8ec7" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建Azure密钥库</li><li id="b6be" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">为运行时创建具有最新版本的集群</li><li id="d741" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将Azure数据块连接到范围的密钥库</li><li id="b965" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在是创建笔记本的时候了</li><li id="9a71" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">让我们从Azure Key vault中获取存储秘密</li><li id="6bc3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">从密钥库中获取连接字符串</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="94a1" class="ki if hh ke b fi kj kk l kl km">conn_str = dbutils.secrets.get(scope = "allsecrects", key = "bstoreconnstr")</span><span id="d685" class="ki if hh ke b fi kn kk l kl km">from azure.storage.blob import BlobServiceClient<br/><br/>conn_str = dbutils.secrets.get(scope = "allsecrects", key = "bstoreconnstr")<br/>blob_service_client = BlobServiceClient.from_connection_string(conn_str=conn_str)</span><span id="9e3e" class="ki if hh ke b fi kn kk l kl km"># List all containers<br/>   all_containers = blob_service_client.list_containers(include_metadata=True)<br/>   for container in all_containers:<br/>       #print(container['name'], container['metadata'])<br/>       containername = container['name']<br/>       #print("Container Name: " , container['name'])<br/>       container_client = blob_service_client.get_container_client(container['name'])<br/>       properties = container_client.get_container_properties()<br/>       #print(properties)<br/>       try:<br/>            bsize = 0<br/>            for blob in container_client.list_blobs():<br/>                #print("Found blob: ", blob.name , " - " , blob.size)<br/>                bsize += blob.size<br/>                <br/>            print(" Total Size: ",containername , (bsize/1024/1024), " MB")<br/>       except ResourceNotFoundError:<br/>            print("Container not found.")</span></pre><figure class="jz ka kb kc fd kp er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es ko"><img src="../Images/9a992ca75e8b11d98e332e6b1b3b9405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sJYBe4AUGbPmcDoI.jpg"/></div></div></figure></div><div class="ab cl kw kx go ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ha hb hc hd he"><p id="4b40" class="pw-post-body-paragraph ld le hh je b jf lf lg lh jh li lj lk jj ll lm ln jl lo lp lq jn lr ls lt jp ha bi translated"><em class="lu">最初发表于</em><a class="ae lv" href="https://github.com/balakreshnan/Accenture/blob/master/cap/ADLScontainerSize.md" rel="noopener ugc nofollow" target="_blank"><em class="lu">【https://github.com】</em></a><em class="lu">。</em></p></div></div>    
</body>
</html>