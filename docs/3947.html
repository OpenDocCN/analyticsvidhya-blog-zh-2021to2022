<html>
<head>
<title>How to find most used and least used tables in SQL Server.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SQL Server中找到最常用和最少使用的表？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-find-most-used-and-least-used-tables-in-sql-server-944102c65926?source=collection_archive---------1-----------------------#2021-08-12">https://medium.com/analytics-vidhya/how-to-find-most-used-and-least-used-tables-in-sql-server-944102c65926?source=collection_archive---------1-----------------------#2021-08-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b25a4c282b4b9b993a582e95c4b647c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJGOl0yUSPVZokCIY3prgg.jpeg"/></div></div></figure><p id="98e1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们将解决如何在SQL Server中找到最常用和最少使用的表这一最常见的问题。这将有助于我们清理数据库，组织我们使用的表，删除不必要的表。</p><p id="4a7d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们在SQL Server中有一个默认视图<strong class="ir hi">sys . DM _ db _ index _ usage _ stats</strong>，它存储表的使用信息。但是，当SQL Server重新启动时，这将丢失其数据。所以为了解决这个问题，我想出了周边工作。</p><p id="6f65" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我创建了一个每3小时运行一次的SQL作业来备份上述视图，并使用新数据增量加载临时表。在这种方法中，即使视图数据丢失，我们在临时表中仍有备份数据。大约一个月后，我们有足够的数据来识别最近使用的表以及它们的最后访问和修改日期。</p><p id="93e1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，我们将创建一个具有类似列的临时表，如view<strong class="ir hi">sys . DM _ db _ index _ usage _ stats</strong>，我们将加载临时表。</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es jn"><img src="../Images/3b3ea6dbf65b365b2c44dd9edada03bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*0YEYLCBYu7Vohdllb2sm0w.png"/></div></figure><p id="486f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在加载之前，我们需要创建一个唯一的聚集索引，这将停止插入冗余数据并避免重复。</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/39eee5a23609bc8cd60df2d65148e980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLWz23xsr2-CBTxsVVgXAw.png"/></div></div></figure><p id="2d84" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们准备将数据插入临时表中。我们将使用下面的代码连接两个表。</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jt"><img src="../Images/f7d27a14a6aaf250f9fca153927f043d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lgJ-5RSD4tJGWbH6-jgsZg.png"/></div></div></figure><p id="873b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，我们需要指定我们关注哪个数据库，以便只记录那些数据库的表信息。现在将它作为存储过程，并按照指定的频率安排运行。</p><p id="1fc8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们可以使用这个临时表创建一个视图，通过使用这个函数将DB_ID和OBJECT_ID分别解析为数据库名和表名，从而使这个视图更有意义。数据库名称(数据库标识)，对象名称(对象标识)。</p><p id="9910" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们还可以将这个表与<strong class="ir hi"> sys.indexes、sys.partitions、sys.allocation_units、sys.schemas、sys.objects视图连接起来，找出以GB/MB为单位的已用空间。</strong></p><p id="efe2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我已经使用了这个查询，并在PowerBI中创建了一个仪表板来检查表的使用情况。希望这有所帮助，如果有任何更正，请给我建议。</p><p id="bdfe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果有任何错误/疑问，请分享或评论。我希望你们都喜欢阅读这篇文章。</p><p id="ae88" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">谢谢你。</p></div></div>    
</body>
</html>