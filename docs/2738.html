<html>
<head>
<title>Using Deep Learning for Mammography Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习进行乳腺摄影分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/using-convolutional-neural-networks-for-mammogram-classification-6e67ed4e0cad?source=collection_archive---------4-----------------------#2021-05-15">https://medium.com/analytics-vidhya/using-convolutional-neural-networks-for-mammogram-classification-6e67ed4e0cad?source=collection_archive---------4-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a85f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首次亮相中级和深度学习:)💻</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="aa3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我对图像分类很感兴趣，这是一次非常丰富的经历，特别是这个主题的重要性。这个小项目是我在Awari数据科学学院进行毕业设计的灵感来源。</p><p id="c40c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">获取数据</strong></p><p id="3939" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Mias乳房造影数据集可从Kaggle网站下载，网址为:</p><div class="jk jl ez fb jm jn"><a href="https://www.kaggle.com/kmader/mias-mammography" rel="noopener  ugc nofollow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">MIAS乳房x线摄影</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">寻找乳腺癌</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">www.kaggle.com</p></div></div></div></a></div><p id="bd3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">MIAS数据集</strong></p><p id="f494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据集最初有332张大小为1024x1024的灰度乳房x光照片。有6类异常，按严重程度分为良性(B)或恶性(M)。正常扫描，即不存在异常的扫描，出于分类目的被任意地赋予值(A)。</p><p id="774c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里找到这个项目<a class="ae jw" href="https://github.com/cpoles/data_science/tree/main/projects/deep_learning/mias_mammography" rel="noopener ugc nofollow" target="_blank">的代码和需要的文件。</a></p><p id="1f1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">项目文件夹结构</strong></p><p id="9670" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">├──全mias <br/> ├──笔记本<br/> └── src <br/> └──模块</p><p id="7b6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jx">all-mias</em></strong><em class="jx">:原始扫描<br/> </em> <strong class="ih hj"> <em class="jx">笔记本</em> </strong> <em class="jx"> : jupyter笔记本<br/></em><strong class="ih hj"><em class="jx">src/modules</em></strong><em class="jx">:自定义库和类</em></p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="aa69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">库</strong></p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="5311" class="kh ki hi kd b fi kj kk l kl km"># system related<br/>import os<br/>import sys</span><span id="f030" class="kh ki hi kd b fi kn kk l kl km">sys.path.append('../src/')</span><span id="bbc5" class="kh ki hi kd b fi kn kk l kl km"># import custom modules<br/>import helpers as hp<br/>import mammoscan as ms</span><span id="eb5e" class="kh ki hi kd b fi kn kk l kl km"># path manipulation</span><span id="6a36" class="kh ki hi kd b fi kn kk l kl km">from pathlib import Path</span><span id="9c9c" class="kh ki hi kd b fi kn kk l kl km"># regex<br/>import re</span><span id="fe4c" class="kh ki hi kd b fi kn kk l kl km"># plotting<br/>import matplotlib.pyplot as plt<br/>import matplotlib.image as mpimg<br/>from matplotlib.patches import Circle</span><span id="734c" class="kh ki hi kd b fi kn kk l kl km"># data manipulation / preparation<br/>import numpy as np<br/>import pandas as pd<br/>from sklearn.model_selection import train_test_split<br/>from tensorflow.keras.preprocessing.image import ImageDataGenerator</span><span id="f703" class="kh ki hi kd b fi kn kk l kl km"># image manipulation<br/>from PIL import Image<br/>from IPython.display import Image</span><span id="bb7a" class="kh ki hi kd b fi kn kk l kl km"># metrics<br/>from sklearn.metrics import confusion_matrix, classification_report</span><span id="eb18" class="kh ki hi kd b fi kn kk l kl km"># keras<br/>from tensorflow.keras.models import Sequential</span><span id="f8c1" class="kh ki hi kd b fi kn kk l kl km">from tensorflow.keras.layers import Conv2D, Dense, Flatten, MaxPool2D, Dropout</span><span id="9877" class="kh ki hi kd b fi kn kk l kl km">from tensorflow.keras.utils import plot_model</span><span id="60cf" class="kh ki hi kd b fi kn kk l kl km">from tensorflow.keras.callbacks import EarlyStopping, ModelCheckpoint</span><span id="b9b4" class="kh ki hi kd b fi kn kk l kl km">from tensorflow.keras.optimizers import Adam</span></pre><p id="fe59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为扫描信息创建数据帧</strong></p><p id="9ef0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jx">create _ mias _ dataset(path:)</em></strong>函数为实验创建必要的数据帧。它将包含扫描数据的文本文件(' scan_file_data.txt ')的路径作为参数。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="f291" class="kh ki hi kd b fi kj kk l kl km">mammo = hp.create_mias_dataset('../scan_file_data.txt')</span></pre><p id="1e6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据框列描述:</strong></p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="484a" class="kh ki hi kd b fi kj kk l kl km">1st column:<br/>MIAS database reference number.</span><span id="a70e" class="kh ki hi kd b fi kn kk l kl km">2nd column:<br/>Character of background tissue:<br/>F Fatty<br/>G Fatty-glandular<br/>D Dense-glandular</span><span id="26a3" class="kh ki hi kd b fi kn kk l kl km">3rd column:<br/>Class of abnormality present:<br/>CALC Calcification<br/>CIRC Well-defined/circumscribed masses<br/>SPIC Spiculated masses<br/>MISC Other, ill-defined masses<br/>ARCH Architectural distortion<br/>ASYM Asymmetry<br/>NORM Normal</span><span id="f7d0" class="kh ki hi kd b fi kn kk l kl km">4th column:<br/>Severity of abnormality;<br/>B Benign<br/>M Malignant</span><span id="f2a8" class="kh ki hi kd b fi kn kk l kl km">5th, 6th columns:<br/>x,y image-coordinates of centre of abnormality.</span><span id="43c4" class="kh ki hi kd b fi kn kk l kl km">7th column:<br/>Approximate radius (in pixels) of a circle enclosing the abnormality.</span></pre><p id="b949" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">玛莫斯坎级</strong></p><p id="c46b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Mammoscan类封装了扫描图像及其相应的数据。该类提供了一个API来访问它的属性和方法，以便为模型绘制和生成缩小的裁剪图像。可以通过导入'<strong class="ih hj"><em class="jx">/SCR/modules/Mammoscan . py '</em></strong>文件来使用Mammoscan类。</p><p id="c695" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据准备</strong></p><p id="9f99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些扫描包含不可用的数据，因此最初必须移除，因为它们缺少异常的位置。在<strong class="ih hj"> <em class="jx"> helpers.py </em> </strong>模块中，有一个用于删除此类扫描的功能:</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="b344" class="kh ki hi kd b fi kj kk l kl km">def clean_ds_files(df: pd.DataFrame) -&gt; pd.DataFrame:<br/> ‘’’Removes records with invalid data<br/> and cast x and y to float’’’<br/> new_df = df.copy()<br/> # search for invalid x values for removal<br/> indices = new_df.x[lambda x: x == ‘*NOTE’].index<br/> <br/> for idx in indices:<br/> n_idx = new_df.index.get_loc(idx)<br/> # drop from dataset<br/> new_df.drop(new_df.index[n_idx], inplace=True)<br/> # delete from directory<br/> delete_image(idx)</span><span id="9097" class="kh ki hi kd b fi kn kk l kl km"># make x and y float values<br/> new_df.x = new_df.x.astype(float)<br/> new_df.y = new_df.y.astype(float)<br/> <br/> return new_df</span></pre><p id="f676" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据<strong class="ih hj"> <em class="jx"> Gregory等人</em> </strong>的说法，用小尺寸图像拟合CNN将提高计算性能和每个异常的召回率。此外，创建原始图像的子集也将改善分类结果。这个过程被称为数据扩充，旨在利用CNN在数据集最初提供的扫描样本如此之少的情况下的性能。</p><p id="fcb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">策略是在扫描中创建异常的旋转和镜像缩小版本。这些乳房x光片包含(x，y)坐标和异常的半径，指示潜在肿瘤(良性(B)或恶性(M ))可能在哪里。至于正常扫描，决定随机选择图像中心周围的一个点，并按照Gregory等人的建议进行48x48的裁剪。</p><p id="9563" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">图像变换</strong></p><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es ko"><img src="../Images/00bfb4f53b5e2c915ca091fd95b22e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*PhdNJ_MteGN_-60-gESJOw.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">原始扫描</figcaption></figure><figure class="jy jz ka kb fd kp er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kw"><img src="../Images/0154ea3b7476ce5baa207b041648ee4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*QButQ7gmrs9yRN0oeL_2ew.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">裁剪旋转版本示例(上下镜像)</figcaption></figure><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es ko"><img src="../Images/7754dfa629574569590969e458b339de.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*PNnblrISvU1cfmEa-nD5CA.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">原始扫描</figcaption></figure><figure class="jy jz ka kb fd kp er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kw"><img src="../Images/df474ebb2656317c74009ce6105b1dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*tsDgDSwkQWrr92OKOh0NQw.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">裁剪旋转版本示例(上下镜像)</figcaption></figure><p id="4d37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">helpers模块有一个名为<strong class="ih hj"><em class="jx">generate _ sub samples(path:，df:) </em> </strong>的函数，它执行所有必要的图像转换，并将它们保存到<em class="jx"> subsamples </em>文件夹中。它还输出包含扫描数据的数据框，包括图像的矩阵版本以及图像在子样本文件夹中的位置。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="9af5" class="kh ki hi kd b fi kj kk l kl km">mias = hp.generate_subsamples('../all-mias/', mias)</span></pre><figure class="jy jz ka kb fd kp er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lb"><img src="../Images/fa35bc12354a217f6734c362c4b21224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzp5hMVpEXjXnDe3TW5qdQ.png"/></div></div></figure><p id="139e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在数据扩充过程之后，我们有3828个48×48的图像。这表示图像数量增加了1100%以上。</p><p id="6c92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">异常数据分布</strong></p><p id="2f82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大约65%的数据集是正常扫描。至于异常类，数据更平衡，但不理想。理想情况下，在拟合模型之前，我们需要每个类别相同数量的良性(B)和恶性(M)样本。每当用任何异常类别的不平衡扫描样本进行训练时，该模型表现不佳。</p><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es lc"><img src="../Images/3079430b3005043f80258959a56b9210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*6b3-LtAU9HEvR11DWNgEJA.png"/></div></figure><p id="424e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用了两种数据集平衡方法:</p><ul class=""><li id="8b33" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj">完全平衡</strong>:所有类别按照严重程度平均分布，并且基于最不频繁的类别具有相同的样本大小。</li><li id="b2f1" class="ld le hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated"><strong class="ih hj">类别平衡</strong>:每个类别按照严重性和原始样本量平均分配</li></ul><p id="1be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用辅助函数<strong class="ih hj"><em class="jx">balance _ df _ by _ severity(df:，ab_class:) </em> </strong>进行类平衡，或者使用<strong class="ih hj"><em class="jx">full _ balance _ df _ by _ severity(df:，ab_class:) </em> </strong>进行完全同质数据集。</p><p id="5829" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">钙化——等级平衡示例</strong></p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="3166" class="kh ki hi kd b fi kj kk l kl km">calcifications_unbalanced = mias[mias.ab_class == 'CALC']</span><span id="4fac" class="kh ki hi kd b fi kn kk l kl km">calcifications_unbalanced.severity.value_counts().plot(kind='bar')</span></pre><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es lr"><img src="../Images/f6e123315da9f8b897bea223493a1a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*puLcDZs8IjJEmeje8jbEvg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">平衡前的钙化</figcaption></figure><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="c2de" class="kh ki hi kd b fi kj kk l kl km">calcifications_balanced = hp.balance_by_severity(mias, 'CALC')</span><span id="7953" class="kh ki hi kd b fi kn kk l kl km">calcifications_balanced.severity.value_counts().plot(kind='bar')</span></pre><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es lr"><img src="../Images/fe60e6d1d54f49206c6095428e9cfafd.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*yy91E6ZD432Yt7QKVlShLg.png"/></div><figcaption class="ks kt et er es ku kv bd b be z dx translated">平衡后的钙化</figcaption></figure><p id="9998" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Mias —类平衡示例</strong></p><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es ls"><img src="../Images/a4b425a91e2e370f85c4c9d617c3c02e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*leaDK-_Bq0tZR0_di5EDrw.png"/></div></figure><p id="3428" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Mias —完全平衡示例</strong></p><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es ls"><img src="../Images/ebbfdfa3b47e5f512554cdb8fb74fcdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*uVr5tjI2Kk-gFP5_QKJ-lQ.png"/></div></figure></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="94f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">卷积神经网络</strong></p><p id="8140" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模型是使用谷歌的TensorFlow建立的，并使用RELU作为卷积层的激活函数。决定输出的激活功能是softmax。还在每个卷积后添加了最大汇集，并且下降率为0.25。</p><p id="af9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输入层是具有32个内核滤波器大小(3x3)的卷积层。然后，添加了一个额外的卷积层，具有64个内核过滤器大小(3×3)和一个最大池大小(2×2)。</p><p id="f51c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用softmax激活函数的全连接层(密集层)返回一个元组，该元组具有用于推断异常类别的概率。元组的第一个元素说明良性(B)样本，第二个元素说明恶性(M)样本。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="a95b" class="kh ki hi kd b fi kj kk l kl km">cnn_calc = Sequential()<br/># first layer<br/>cnn_calc.add(Conv2D(32, kernel_size=(3, 3),activation='relu',input_shape=(48, 48, 1)))<br/>cnn_calc.add(Conv2D(64, kernel_size=(3,3),activation='relu'))<br/>cnn_calc.add(MaxPool2D(pool_size=(2, 2)))</span><span id="5e1e" class="kh ki hi kd b fi kn kk l kl km">cnn_calc.add(Conv2D(64, kernel_size=(3,3),activation='relu'))<br/>cnn_calc.add(MaxPool2D(pool_size=(2, 2)))<br/>cnn_calc.add(Dropout(0.25))<br/># Add dense layer to reduce the number of features<br/>cnn_calc.add(Dense(64, activation='relu'))<br/>cnn_calc.add(Dropout(0.25))<br/># flattening results<br/>cnn_calc.add(Flatten())<br/># Dense layer to produce final output<br/>cnn_calc.add(Dense(2, activation='softmax'))<br/># print summary<br/>mass_calc.summary()</span></pre><figure class="jy jz ka kb fd kp er es paragraph-image"><div class="er es lt"><img src="../Images/d113e273cef9a2c56f579ee1859ac896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*Mh73oNMT92dTyjImICjG-A.png"/></div></figure><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="b403" class="kh ki hi kd b fi kj kk l kl km">Model: "sequential"<br/>_________________________________________________________________<br/>Layer (type)                 Output Shape              Param #   <br/>=================================================================<br/>conv2d (Conv2D)              (None, 46, 46, 32)        320       <br/>_________________________________________________________________<br/>conv2d_1 (Conv2D)            (None, 44, 44, 64)        18496     <br/>_________________________________________________________________<br/>max_pooling2d (MaxPooling2D) (None, 22, 22, 64)        0         <br/>_________________________________________________________________<br/>conv2d_2 (Conv2D)            (None, 20, 20, 64)        36928     <br/>_________________________________________________________________<br/>max_pooling2d_1 (MaxPooling2 (None, 10, 10, 64)        0         <br/>_________________________________________________________________<br/>dropout (Dropout)            (None, 10, 10, 64)        0         <br/>_________________________________________________________________<br/>dense (Dense)                (None, 10, 10, 64)        4160      <br/>_________________________________________________________________<br/>dropout_1 (Dropout)          (None, 10, 10, 64)        0         <br/>_________________________________________________________________<br/>flatten (Flatten)            (None, 6400)              0         <br/>_________________________________________________________________<br/>dense_1 (Dense)              (None, 2)                 12802     <br/>=================================================================<br/>Total params: 72,706<br/>Trainable params: 72,706<br/>Non-trainable params: 0<br/>_________________________________________________________________</span></pre><p id="91c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">训练模型</strong></p><p id="4e68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于测试，当以0.001的学习率训练10，000个时期时，所有情况下都获得了最佳结果。目的是提高所有班级的召回率。这意味着我们希望改善与假阴性和假阳性案例相关的结果，并增加对真阴性和真阳性案例的自信。</p><p id="dde4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">换句话说，我们需要优化模型预测良性(B)而实际上是恶性(M)异常的情况，反之亦然。从错误诊断的角度来看，患者可能被给予不必要的治疗(假阳性)或没有及时接受治疗(假阴性)。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="1041" class="kh ki hi kd b fi kj kk l kl km"># compiling the model<br/>adam = Adam(0.001)<br/>cnn_calc.compile(optimizer=adam,<br/>            loss='categorical_crossentropy',<br/>            metrics=['accuracy'])</span><span id="8c8f" class="kh ki hi kd b fi kn kk l kl km"># training and evaluating the model<br/>early_stopping = EarlyStopping(patience=3000, restore_best_weights=True)</span><span id="0a0e" class="kh ki hi kd b fi kn kk l kl km">model_check_point = ModelCheckpoint(filepath= './', <br/>                                    monitor='val_loss', verbose=1, <br/>                                    save_best_only=True,<br/>                                    save_weights_only=False, <br/>                                    mode='auto', save_freq='epoch')</span><span id="4537" class="kh ki hi kd b fi kn kk l kl km"># fit the model<br/>hist = cnn_calc.fit(train_data, <br/>                    validation_data=test_data, <br/>                    epochs=10000,<br/>                    callbacks=[early_stopping, model_check_point])</span></pre><p id="727f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">进行预测并评估结果</strong></p><p id="adce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据结果，当模型达到其最低验证损失或最高验证准确性时，情况会有所不同。一些CNN需要至少1000个步骤来产生一致的结果。尽管如此，当仅用钙化训练时，可以用较少的时期获得相对满意的结果。</p><p id="afc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的测试中，该模型对于恶性钙化病例实现了97%的召回率和100%的精确度。这是最好的结果，它是在Google的Collab上使用GPU运行时运行的。</p><pre class="jy jz ka kb fd kc kd ke kf aw kg bi"><span id="f381" class="kh ki hi kd b fi kj kk l kl km"># get predictions<br/>y_pred = cnn_calc.predict(test_data)<br/>predicted = [np.argmax(w) for w in y_pred] # highest probabilities<br/>expected = test_data.labels</span><span id="e37a" class="kh ki hi kd b fi kn kk l kl km">print(classification_report(expected, predicted))</span><span id="712e" class="kh ki hi kd b fi kn kk l kl km">                   precision    recall  f1-score   support<br/><br/>           0       0.97      1.00      0.98        31<br/>           1       1.00      0.97      0.98        29<br/><br/>    accuracy                           0.98        60<br/>   macro avg       0.98      0.98      0.98        60<br/>weighted avg       0.98      0.98      0.98        60</span></pre><p id="3211" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">据观察，硬件不仅影响运行速度，而且影响整个模型的性能。该模型在MacBook Pro i7 16 GB内存、Mac mini i5 8GB内存和谷歌的Collab默认运行时上进行训练。当运行一个超过1000步的模型时，我会建议在谷歌的Collab GPU运行时上运行笔记本。</p><p id="35e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最终结果图——恶性病例</strong></p><figure class="jy jz ka kb fd kp er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lu"><img src="../Images/cb0bc558381fef017aab7d2cb109f1c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-SEKM1qMpAngzznH3gwHgA.png"/></div></div></figure><p id="1c21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尚不清楚为什么该模型在预测钙化时表现更一致。这是从初始测试中观察到的，既没有应用数据集平衡，也没有应用数据扩充。钙化点必须有一个清晰的可识别的模式，这样只有275个时期的模型将达到几乎90%的准确度、精确度和召回率。</p><p id="520e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至于质量，使用类平衡方法的模型也表现得更好。对肿块的检测几乎和对钙化的检测一样好。如果我们考虑质量包括三种不同类型的异常，模型的整体性能相当好。与钙化相反，通过训练模型至少1000步，可以获得显著的结果。</p><p id="bbb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用所有类别训练该模型，结果显示对于类别平衡和完全平衡方法，在恶性病例上的模型性能稍好。</p><figure class="jy jz ka kb fd kp er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lu"><img src="../Images/41604a7982698aff286640f024443879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBw_CQ7FMIN2Blia1AamLw.png"/></div></div></figure><p id="37a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用数据扩充技术后的结果强化了最初的策略，即使用数据扩充技术作为增强模型学习和预测能力的手段。实验还表明，当使用类平衡方法时，该模型比完全平衡方法产生稍好的结果。此外，从严重性的角度来看，该模型在恶性病例上表现稍好。</p><p id="a0da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读！</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="4663" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[1] Gregory等人，<a class="ae jw" href="https://ehnree.github.io/documents/papers/mammogram_conv_net.pdf" rel="noopener ugc nofollow" target="_blank">使用卷积神经网络进行乳房x线照片分类</a></p><p id="d0ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">[2] Deitel，数据科学和计算机科学的Python介绍</p></div></div>    
</body>
</html>