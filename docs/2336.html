<html>
<head>
<title>How to send many custom emails with pdf attachments using python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用python发送许多带有pdf附件的自定义电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-send-many-custom-emails-with-pdf-attachments-using-python-ba86bfd757f3?source=collection_archive---------2-----------------------#2021-04-19">https://medium.com/analytics-vidhya/how-to-send-many-custom-emails-with-pdf-attachments-using-python-ba86bfd757f3?source=collection_archive---------2-----------------------#2021-04-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0ef2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以把你自己放在一个地方，你必须发送带有pdf附件的个人电子邮件，但每个pdf都是不同的，因为它是为每个人定制的。所以python有一个简单的方法来解决这个问题，并且会让你的生活变得容易很多。</p><p id="e10a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">寻找方法来解决我面临的问题，我确实找到了许多用python发送电子邮件的方法，每个代码的逻辑都是一样的，但有一个人解释得非常好，所以他的名字叫Corey，你可以关注他的youtube频道:</p><p id="2167" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://www.youtube.com/channel/UCCezIgC97PvUuR4_gbFUs5g" rel="noopener ugc nofollow" target="_blank"> (50)科里·斯查费——YouTube</a></p><p id="933f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们学习如何发送电子邮件的基础知识之前，在你的谷歌账户中做一件特定的事情是很重要的。我们需要打开不太安全的应用程序..</p><p id="7299" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更改此设置的链接如下:</p><p id="7f79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">https://www.google.com/settings/security/lesssecureapps<a class="ae jc" href="https://www.google.com/settings/security/lesssecureapps" rel="noopener ugc nofollow" target="_blank"/></p><h2 id="f0b1" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">解释什么是SMTP服务器</h2><p id="27bc" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">SMTP是什么意思？SMTP意味着简单的消息传输协议，它是以发送和接收电子邮件为主要目的的协议。打个比方，它就像足球中的中场，接收球，并与前锋联系。</p><ul class=""><li id="7c0c" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated"><strong class="ig hi">它是如何工作的？</strong></li></ul><p id="17c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦你点击发送电子邮件，你的电子邮件被转换成一个字符串代码，并被发送到一个SMTP服务器，将处理代码和发送邮件给收件人，如果它不存在，电子邮件将在翻译中丢失。</p><ul class=""><li id="9a38" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated"><strong class="ig hi">我们将如何使用</strong></li></ul><p id="4b3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">SMTP有不同的服务器，所以我们将使用smtp@gmail.com，因为我们使用gmail帐户，SMTP有不同的端口，我们将使用465端口，它有SSL加密(我稍后会尝试解释SSL的意思*)。</p><h2 id="56b8" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">让我们来看看代码:</h2><p id="4104" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">对于这段代码，我使用google colab来运行。我确实开始使用jupyter笔记本，但我在一次尝试中遇到了一些输出问题，所以一个人推荐我使用google colab，我真的很喜欢它。</p><p id="6fef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第一步</strong>您需要创建一个excel文件，我建议您使用excel，而不是python中的直接列表，我的意思是它会工作，但当我编码时，我在我的空间中找到了一些/xa0，这在读取pdf文件时会影响您的代码，尽管您可以通过列表中的一次迭代来解决这个问题。在你的<strong class="ig hi">第一页</strong>中应该是你将要发送给接收者的文件的名称，在<strong class="ig hi">第二页</strong>中，你需要放置接收者的电子邮件。</p><p id="90ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里需要注意的一点是，我们将使用pandas data frame来读取我们的excel文件，因此我建议excel表中的第一行是列的名称，以使您的工作更容易，例如，对于第一个表，您可以写“文件名”。</p><ul class=""><li id="014b" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated"><strong class="ig hi">导入文件</strong></li></ul><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="f59e" class="jd je hh kr b fi kv kw l kx ky">from google.colab import files<br/>uploaded = files.upload()</span></pre><p id="d34f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您必须导入将要发送的文件(pdf文件)和将要使用的excel文件。</p><ul class=""><li id="e712" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated"><strong class="ig hi">导入库</strong></li></ul><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="5d08" class="jd je hh kr b fi kv kw l kx ky">import pandas as pd<br/>import smtplib<br/>from email.message import EmailMessage</span></pre><p id="95e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">库导入后，我们必须将数据框架转换成列表，以使其能够迭代，因此代码如下:</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="d195" class="jd je hh kr b fi kv kw l kx ky">#Sheet4 is where the emails are located<br/>data = pd.read_excel('EXCELFILE.xlsx', sheet_name='Sheet4')<br/>#Sheet3 is the name of the pdf files<br/>data1 = pd.read_excel('EXCELFILE.xlsx', sheet_name='Sheet3')<br/>#translating into lists<br/>emails = data.values.tolist()<br/>pdf_file = data1.values.tolist()</span></pre><ul class=""><li id="c7a3" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated"><strong class="ig hi">启动邮件代码</strong></li></ul><p id="0cfe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于<strong class="ig hi">的电子邮件代码</strong>，我将分成两种代码，第一种是简单的带有pdf附件的电子邮件，第二种是HTML代码，以使它看起来更好，更专业(注意:我以前从未接触过HTML，所以目前我写这个代码时我不太擅长)。</p><h2 id="3ff6" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">没有HTML部分的简单电子邮件</h2><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="f6db" class="jd je hh kr b fi kv kw l kx ky">sender = 'SENDEREMAIL'<br/>password = 'yourpassword'</span><span id="b046" class="jd je hh kr b fi kz kw l kx ky"><br/>count = 1</span><span id="1692" class="jd je hh kr b fi kz kw l kx ky">for i in range(len(emails)):<br/>   receiver = emails[i][0]<br/>   msg = EmailMessage()<br/>   msg['Subject'] = 'Course Book - GMF Unicamp'<br/>   msg['From'] = sender<br/>   msg['To'] = receiver<br/>   msg.set_content('Good Night, \n Here it is your course book from                 our investment course. \n Att, \n Team GMF')</span><span id="b06f" class="jd je hh kr b fi kz kw l kx ky">   file = pdf_file[i][0]<br/>   with open(file,'rb') as f:<br/>      file_data = f.read()<br/>      file_name = f.name<br/>      msg.add_attachment(file_data, maintype='application', subtype = 'octet-stream', filename=file_name)</span><span id="564b" class="jd je hh kr b fi kz kw l kx ky">   with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp:<br/>      smtp.login(sender, password)<br/>      smtp.send_message(msg)<br/>      print(count)<br/>      count = count+1</span></pre><p id="24f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">稍微解释一下代码:</p><ol class=""><li id="ae5a" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb la kj kk kl bi translated">第一步是定义谁在发送电子邮件，以及您的密码。</li><li id="ad6f" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">然后，我们用一个简单的“for”打开一个迭代，其范围覆盖列表中的所有电子邮件。</li><li id="d298" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">现在我们定义电子邮件变量和文件变量。</li><li id="46f4" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">“With open”表示我们允许打开pdf，“rb”表示读取和二进制，“msg.add_attachment”表示将我们的pdf添加到我们的电子邮件中。</li><li id="5a7b" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">最后，我们打开与SMTP服务器的联系，输入我们的登录名和密码，最后发送电子邮件。</li></ol><p id="1df1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:我创建了变量count，以便在发生错误时知道我的代码在列表中的位置。</p><p id="fe07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">*SSL是一种加密协议，我们使用端口465，因为加密会在SMTP通信之前自动开始，以确保我们的消息在到达收件人之前不会被拦截或更改。</p><h2 id="33aa" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">用HTML发送更“专业”的电子邮件</h2><p id="7901" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">好的，上面的代码是有效的，它已经可以帮助发送邮件给多人，但是你可以做得更好。我不得不说，我不太擅长设计，所以实际上我试图让它变得漂亮。HTML很容易操作，所以首先我会展示基本代码，显示HTML将进入的地方，然后我会解释HTML代码。</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="bf91" class="jd je hh kr b fi kv kw l kx ky">from email.message import EmailMessage<br/>sender = "SENDEREMAIL"<br/>password = "PASSWORD"<br/>for i in range(2):<br/>   receiver = emails[i][0]<br/>   msg = EmailMessage()<br/>   msg['Subject'] = 'Course Book - GMF Unicamp'<br/>   msg['From'] = sender<br/>   msg['To'] = receiver<br/>   msg.set_content('This is a plain text email')<br/>   msg.add_alternative("""\<br/>   <strong class="kr hi">HTML code will be here</strong><br/>   """, subtype='html')<br/>   file = pdf_file[i][0]<br/>   with open(file,'rb') as f:<br/>      file_data = f.read()<br/>      file_name = f.name<br/>      msg.add_attachment(file_data, maintype='application', subtype = 'octet-stream', filename=file_name)<br/>   with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp:<br/>   smtp.login(sender, password)<br/>   smtp.send_message(msg)</span></pre><p id="7ddd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于我的电子邮件，我希望它看起来简单而漂亮。所以为了让它看起来更好，我决定把我是会员的金融俱乐部的标志，地址和两个超链接，一个是我们的instagram页面，一个是我们的网站。</p><p id="7eac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用一张图片，我发现了一种快速获取你想要的图片的方法，你必须在谷歌图片中搜索图片，然后用右键单击并复制html代码，这使我的生活更容易。此外，使用HTML你可以把超链接放在你的网站/instagram和任何你想要的链接上，这很酷。</p><p id="73f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是<strong class="ig hi">的HTML代码</strong>:</p><pre class="km kn ko kp fd kq kr ks kt aw ku bi"><span id="f298" class="jd je hh kr b fi kv kw l kx ky">&lt;!DOCTYPE html&gt;</span><span id="607e" class="jd je hh kr b fi kz kw l kx ky">&lt;html&gt;</span><span id="2b2c" class="jd je hh kr b fi kz kw l kx ky">&lt;body&gt;<br/>   &lt;tr&gt;<br/>      &lt;td&gt;<br/>         &lt;table&gt;<br/>         &lt;tr&gt;<br/>            &lt;p&gt;Good Night,&lt;/p&gt;<br/>            &lt;p&gt;Here it's your course book from the investment course that you attended this semester!&lt;/p&gt;<br/>            &lt;p&gt;Enjoy your studies !&lt;/p&gt;<br/>            &lt;p&gt;att, GMF&lt;/p&gt;<br/>         &lt;/tr&gt;<br/>         &lt;/table&gt;<br/>      &lt;/td&gt;<br/>   &lt;/tr&gt;</span><span id="1807" class="jd je hh kr b fi kz kw l kx ky">&lt;table&gt;<br/>   &lt;td align = 'left'&gt;<br/>      &lt;th&gt;&lt;img  align="left" alt="Grupo de Mercado Financeiro - Unicamp | Brasil" class="n3VNCb" src="https://static.wixstatic.com/media/d22a2d_1503a6de185c3fc7394cb28196c5591a.png/v1/fill/w_280,h_128,al_c,q_85,usm_0.66_1.00_0.01/d22a2d_1503a6de185c3fc7394cb28196c5591a.webp" data-noaft="1" jsname="HiaYvf" jsaction="load:XAeZkd;" style="width: 93px; height: 43px;"&gt;&lt;/th&gt;<br/>   &lt;/td&gt;<br/>&lt;/table&gt;</span><span id="b666" class="jd je hh kr b fi kz kw l kx ky">&lt;table&gt;<br/>   &lt;table&gt;<br/>      &lt;tr&gt;<br/>         &lt;td align="left"&gt;<br/>            &lt;b&gt;Adress here&lt;/b&gt;<br/>            &lt;p&gt;&lt;a href="https://www.gmfunicamp.com/"&gt;View in Browser&lt;/a&gt; | &lt;a href="https://www.instagram.com/gmf_unicamp/"&gt;Instagram&lt;/a&gt;&lt;/p&gt;<br/>         &lt;/td&gt;<br/>      &lt;/tr&gt;<br/>&lt;/table&gt;</span><span id="1a70" class="jd je hh kr b fi kz kw l kx ky">&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h2 id="a00c" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">HTML的基础</h2><p id="bec4" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">HTML与表格一起工作，所以想象你的屏幕是一个空白页，你可以创建一些表格，你可以在这些表格中写东西。</p><ol class=""><li id="3b13" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb la kj kk kl bi translated">是定义单据正文内容。</li><li id="f18c" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated"><tr>定义行“tr =表格行”</tr></li><li id="d006" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated"><td>定义数据“td =表格数据”</td></li><li id="08e8" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">对于写作，你可以用<p>打开，用<br/>换行(我没有用这些)。</p></li><li id="16a6" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">要使文本加粗，请使用<b/></li><li id="9ff8" class="kd ke hh ig b ih lb il lc ip ld it le ix lf jb la kj kk kl bi translated">要使用链接，请使用“href”。</li></ol><p id="a9fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如你所看到的，这很简单，但这是一种很好的编码语言，我会努力把它学得更好。</p><p id="f5da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将HTML代码放入python代码后，您的电子邮件应该看起来像这样，注意您的电子邮件在手机和笔记本上看起来是否相似，因为当我测试时，我必须修复一些东西。</p><figure class="km kn ko kp fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lg"><img src="../Images/298b6e41fe9e94b863443e63292dd63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wPuSw8qzLnNdC4ccgd_Ycw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">我不使用IMAC，但我在这个网站上找不到同样尺寸的笔记本</figcaption></figure><p id="eb33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:我不知道你想要发送多少封电子邮件，但是为了让你有一个感觉，当我在工作的时候，我发送了大约180封电子邮件，花了大约1个半小时，这需要很长时间，但是如果你自己发送的话会更快，也不会那么无聊。我记得你每天最多能发500封邮件。</p><p id="f64d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢您的阅读，如果您对我的解释有任何意见，请在下面留下，我会尽力回答。</p></div></div>    
</body>
</html>