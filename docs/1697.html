<html>
<head>
<title>How To Post And Fetch Data Using React-query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React-query发布和获取数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-post-and-fetch-data-using-react-query-4c3280c0ef96?source=collection_archive---------0-----------------------#2021-03-14">https://medium.com/analytics-vidhya/how-to-post-and-fetch-data-using-react-query-4c3280c0ef96?source=collection_archive---------0-----------------------#2021-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0982cb8c28c34d9f3dbecfac07504d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6idjkHx1P7uV1ZFBHbhVg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马库斯·斯皮斯克在<a class="ae iu" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="002d" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h2><p id="d872" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在本文中，您将了解如何设置react-query，以便在用typescript/javascript编写的应用程序和react功能组件中获取和发送数据。此外，您将了解什么是react-query及其优势。</p><h2 id="319e" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">什么是react-query？</strong></h2><p id="1e94" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">React-query是一个很棒的库，它解决了应用程序中管理服务器状态和缓存的问题，根据官方文档“React Query经常被描述为React缺少的数据获取库，但用更专业的术语来说，它使React应用程序中的<strong class="jv hj">获取、缓存、同步和更新服务器状态</strong>变得轻而易举。”更多信息请参见<a class="ae iu" href="https://react-query.tanstack.com/overview" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">反应-查询</strong> </a> <strong class="jv hj">。</strong></p><h2 id="af39" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">使用react-query的优势</strong></h2><p id="5ea0" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">通过数据缓存提高应用程序性能。此外，只要有更新(后台更新)，就允许在后台提取数据，当窗口重新聚焦时重新提取数据，并且还提供了默认设置，在出现错误的情况下重试失败的查询请求三(3)次。</p><p id="9865" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">首先，让我们用npm或yarn安装react-query <strong class="jv hj">版本3.5.12 </strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="54a0" class="iv iw hi ky b fi lc ld l le lf">npm i react-query</span><span id="81bb" class="iv iw hi ky b fi lg ld l le lf"><em class="lh">or</em></span><span id="4e10" class="iv iw hi ky b fi lg ld l le lf">yarn add react-query</span></pre><p id="0e2b" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">安装将用于样式、列表和表单验证的材料ui、mui-datatables和react-hook-form，有关更多信息，请访问相应的文档。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="fd4f" class="iv iw hi ky b fi lc ld l le lf">npm install @material-ui/core<br/>npm install mui-datatables --save<br/>npm install react-hook-form</span></pre><p id="161d" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">用下面的代码片段安装React Query Devtools，这是可选的。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="2d4b" class="iv iw hi ky b fi lc ld l le lf">yarn add react-query-devtools</span></pre><h2 id="3964" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">配置客户端提供商</strong></h2><p id="760d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">现在让我们通过包装QueryClientProvider来配置app.tsx组件，因为它需要位于负责获取数据的组件之上。QueryClientProvider应采用QueryClient的实例，QueryClient可用于配置QueryCache和MutationCache实例并与之交互。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><h2 id="31c9" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">用axios发布数据</strong></h2><p id="dd38" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">让我们开始创建负责发布数据的组件employeeForm.tsx，我们将使用一个名为beeceptor的虚拟rest api来处理axios的post请求。了解<a class="ae iu" href="https://beeceptor.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jv hj">bee ceptor</strong></a><strong class="jv hj">。</strong></p><p id="72c7" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">创建一个包含post请求的函数，如下面的代码片段所示。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="5f5c" class="iv iw hi ky b fi lc ld l le lf">const createEmployee = async (data: Employee) =&gt; {</span><span id="2482" class="iv iw hi ky b fi lg ld l le lf">const { data: response } = await axios.post('https://employee.free.beeceptor.com/create', data);</span><span id="c890" class="iv iw hi ky b fi lg ld l le lf">return response.data;</span><span id="fdb8" class="iv iw hi ky b fi lg ld l le lf">};</span></pre><p id="ac11" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">现在创建一个任意数量字段的雇员接口。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="3947" class="iv iw hi ky b fi lc ld l le lf">interface Employee{<br/>    name:string;<br/>    job:string;<br/>    id:string;<br/>}</span></pre><p id="6d36" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在我们的功能组件中，我们将从react-query导入一个名为<strong class="jv hj"> useQueryClient </strong>的钩子，它返回一个<strong class="jv hj"> QueryClient </strong>实例。useQueryClient挂钩将用于使查询无效，在这种情况下，查询被认为是陈旧的，如果当前正在通过相关挂钩呈现，也可以在后台重新提取。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="ba7a" class="iv iw hi ky b fi lc ld l le lf">import {useQueryClient} from 'react-query'<br/>const queryClient = useQueryClient()</span></pre><p id="5220" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">接下来，我们导入useMutation挂钩，用于应用程序中任何CRUD操作。我们将从useMutation钩子中析构mutate和isLoading，钩子将带一个负责发布的函数参数和几个选项。将使用的选项有onSuccess、onError和onSettled。</p><p id="b3b9" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">每次变异成功都会触发onSuccess，变异过程中出现错误会触发onError，变异成功与否都会触发onSettled。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="e5c4" class="iv iw hi ky b fi lc ld l le lf">const { mutate, isLoading } = useMutation(createEmployee, {<br/>   onSuccess: data =&gt; {<br/>      console.log(data);<br/>      const message = "success"<br/>      alert(message)<br/>},<br/>  onError: () =&gt; {<br/>       alert("there was an error")<br/>},<br/>  onSettled: () =&gt; {<br/>     queryClient.invalidateQueries('create')<br/>}<br/>});</span></pre><p id="1369" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">完成上述步骤后，您的emloyeeForm组件将类似于下面的代码片段。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="li lj l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">员工表单</figcaption></figure><h2 id="d4d0" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">使用axios获取数据</h2><p id="53c3" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">创建一个名为employeeList的功能组件，它将获取和列出数据。获取简单直接，react-query提供了一个名为<strong class="jv hj"> useQuery </strong>的钩子，它接受一个负责获取数据的键和函数。从react-query导入名为useQuery的钩子。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="a3d7" class="iv iw hi ky b fi lc ld l le lf">import { useQuery } from 'react-query';</span></pre><p id="1373" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">创建一个函数，负责从一个名为restapiexample的伪rest api获取数据。了解<a class="ae iu" href="http://dummy.restapiexample.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jv hj">restaper示例</strong> </a> <strong class="jv hj">。</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="e741" class="iv iw hi ky b fi lc ld l le lf">const getEmployee = async () =&gt; {</span><span id="a6f9" class="iv iw hi ky b fi lg ld l le lf">const { data } = await axios.get('http://dummy.restapiexample.com');</span><span id="6cb3" class="iv iw hi ky b fi lg ld l le lf">return data.data;</span><span id="d137" class="iv iw hi ky b fi lg ld l le lf">};</span></pre><p id="be36" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">析构由钩子返回的数据，以及从useQuery钩子返回的其他几个数据。useQuery提供了几个选项供选择。了解<a class="ae iu" href="https://react-query.tanstack.com/reference/useQuery#_top" rel="noopener ugc nofollow" target="_blank"> <strong class="jv hj">使用查询选项</strong> </a> <strong class="jv hj">。</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="286f" class="iv iw hi ky b fi lc ld l le lf">const { data } = useQuery('create', getEmployee);</span></pre><p id="f887" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">完整的employeeList应该类似于下面的代码片段。</p><figure class="kt ku kv kw fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="abf8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">查看一下git<a class="ae iu" href="https://github.com/Big-Zude/post-and-fetching-with-react-query.git" rel="noopener ugc nofollow" target="_blank"><strong class="jv hj"><em class="lh">repo</em></strong></a>的其他配置，我们没有重点讨论，但是在文章中出现了。欢迎在推特<a class="ae iu" href="https://twitter.com/Big_Zude" rel="noopener ugc nofollow" target="_blank"><strong class="jv hj"/></a>上问我任何问题，我可以帮助你开始。</p></div></div>    
</body>
</html>