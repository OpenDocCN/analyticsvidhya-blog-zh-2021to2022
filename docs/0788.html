<html>
<head>
<title>Analyzing e-scooter trips in Chicago with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python分析芝加哥的电动滑板车出行</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/analyzing-e-scooter-trips-in-chicago-with-python-c985611a33e1?source=collection_archive---------9-----------------------#2021-01-31">https://medium.com/analytics-vidhya/analyzing-e-scooter-trips-in-chicago-with-python-c985611a33e1?source=collection_archive---------9-----------------------#2021-01-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8119" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天，共享电动滑板车(或电动滑板车)已经成为世界上大多数大城市的常见景观，因为许多人使用这些滑板车进行运输和休闲。最终用户可以轻松地使用任何运营商的应用程序来找到最近的可用滑板车，解开滑板车并骑到他们想去的地方。这些服务的设计方式导致产生了大量关于如何以及在哪里使用服务的数据。<br/> <br/>在本文中，我将通过探索2019年芝加哥电动滑板车试点项目，展示分析用户模式是多么容易。数据集可以在芝加哥市的网站上获得(在<a class="ae jc" href="https://data.cityofchicago.org/Transportation/E-Scooter-Trips-2019-Pilot/2kfw-zvte" rel="noopener ugc nofollow" target="_blank">这个链接</a>)，可以通过他们的API访问或者直接以许多不同的文件格式导出。我选择以CSV格式下载。</p><h2 id="af3e" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">数据集</h2><p id="d202" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">现在您已经下载了数据，让我们更深入地了解它的结构和包含的内容。幸运的是，芝加哥市在记录数据集方面做得很好。从上面的链接我们可以看到总共有711K行和18列。每一行代表一次旅行。我们特别感兴趣的数据点是开始时间、结束时间、行程距离(以米为单位)、行程持续时间(以秒为单位)、坐标(行程的开始和结束)以及行程开始和结束的社区区域。</p><p id="3465" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">出于隐私方面的考虑，该数据集被略微处理过，并不完全准确。例如，开始和结束时间被四舍五入到最接近的小时。关于地理位置，没有提供确切的纬度和经度。取而代之的是，给出了旅行开始的普查区域的中心位置。如果人口普查区域不可用于该行，则将位置设置为社区区域的中心。换句话说，位置和起止时间是不准确的。就本文而言，准确性本身并不重要，但重要的是要意识到数据集的局限性。</p><h2 id="079e" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated"><strong class="ak">用Python探索和分析数据</strong></h2><p id="d5dc" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">大多数操作都是通过熊猫图书馆完成的。Matplotlib和Seaborn用于显示数据的图形表示，而我选择使用Kepler.gl来可视化地图中的地理数据。与JSON、CSV、Datetime和Numpy相关的其他库也用于较小的任务。包含数据探索所有步骤的笔记本可在<a class="ae jc" href="https://github.com/loksoy/chicago_e_scooter_trips/blob/main/Scooter_trips_data_exploration.ipynb" rel="noopener ugc nofollow" target="_blank">此链接</a>处获得，文章末尾的地图可视化笔记本可在<a class="ae jc" href="https://github.com/loksoy/chicago_e_scooter_trips/blob/main/Scooter_trip_map_visualization.ipynb" rel="noopener ugc nofollow" target="_blank">此处</a>处获得。</p><p id="80ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如前所述，数据集总共包含711K行。很可能并非所有这些行都是实际的行程。例如，可能会有这样的情况，最终用户已经开始了一次旅行，但由于踏板车没有完全发挥作用(例如，轮胎被扎破或刹车失灵)而很快结束了旅行。我们将把数据集限制在我们认为是真实旅行的情况下。我们创建以下规则:</p><ol class=""><li id="4395" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated">一次旅行至少需要一分钟。</li><li id="bc9a" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">一次旅行的长度至少需要100米。</li></ol><p id="910c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将数据集转换为数据帧后，我们根据这些规则过滤数据集。为了执行这些规则，我们首先需要确保包含“旅行距离”和“旅行持续时间”的列是数字格式的。Pandas to _ numeric-函数是一种将字符串值转换成数字格式的简单方法。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="86ca" class="jd je hh kw b fi la lb l lc ld">#Converting columns to numeric format</span><span id="61e0" class="jd je hh kw b fi le lb l lc ld">scooter_trips_df['Trip Distance'] = pd.to_numeric(scooter_trips_df['Trip Distance'])</span><span id="4d87" class="jd je hh kw b fi le lb l lc ld">scooter_trips_df['Trip Duration'] = pd.to_numeric(scooter_trips_df['Trip Duration'])</span><span id="86b4" class="jd je hh kw b fi le lb l lc ld">#Filtering dataset based on rules: Dropping rows where distance is less than 100 meters or time is less than 60 seconds</span><span id="951e" class="jd je hh kw b fi le lb l lc ld">trips_df = trips_df.drop(&lt;trips_df[(trips_df['Trip Distance'] &lt; 100) | (trips_df['Trip Duration'] &lt; 60)].index)</span></pre><p id="839c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们检查数据集的长度时，我们可以看到旅行的次数已经大大减少了。我们现在总共有53万次旅行。</p><h2 id="7d44" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">用户模式概述</h2><p id="c316" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">我们想做的下一件事是获得整个数据集的概览，以查看每天有多少次旅行被注册。这将给我们一个指示，如果有一个上升或下降的旅行次数。为此，我们为每行添加一个计数值为1的列，并根据行的日期对数据帧进行分组。计数行将向我们显示每个日期有多少个实例。</p><p id="0102" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还希望看到试验项目的整个时间段内每天的平均出行次数。这可以通过使用计数列上的均值函数来计算:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e995" class="jd je hh kw b fi la lb l lc ld">#Creating a DataFrame that can be used for showing amount of trips per date</span><span id="4734" class="jd je hh kw b fi le lb l lc ld">trips_by_date = analysis_data.groupby(pd.Grouper(key='Start Time', freq='D')).sum().reset_index()<br/> <br/>#Calculating average line</span><span id="db36" class="jd je hh kw b fi le lb l lc ld">daily_average_pilot = trips_by_date['count'].mean()</span><span id="dc19" class="jd je hh kw b fi le lb l lc ld">daily_average_pilot</span></pre><p id="c697" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于图形绘制，我们使用Seaborn和Matplotlib。这种设置非常容易理解，可以在以后的可视化中重复使用。我们或多或少只是根据我们想要看到的图(例如，是线形图、条形图等)来改变代码的第二部分。)代码如下图所示，第二张图是代码的输出。</p><figure class="kr ks kt ku fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lf"><img src="../Images/fe9e33c50b9a477fa403f5575dadc818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukQtkQR4-uIl1i4sCCs0gw.png"/></div></div></figure><figure class="kr ks kt ku fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ln"><img src="../Images/037010aa7a7bc672e42a9deef2fb5a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*az2368lYEeBWjLdEmS4uig.png"/></div></div></figure><p id="8fe8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面的可视化中，我们看到了两件事:</p><ol class=""><li id="8a77" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated"><strong class="ig hi">试点期间出行次数减少。</strong></li><li id="cc33" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">在9月30日之后，有一段时间根本没有旅行，直到10月15日。</li></ol><p id="50e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们从试点项目描述中知道试点项目从6月15日运行到10月15日，这意味着有一些数据丢失(并且我们的日平均值受到这一事实的影响)。为了以后比较试点的前30天和后30天，我们需要确保将截止日期设置在9月30日之后。</p><p id="dca4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，我们使用groupby函数来汇总每个工作日的旅行次数和一天中的时间，并将它们绘制成图表。</p><figure class="kr ks kt ku fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lo"><img src="../Images/c2308a49a636d057e652376491c53f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a1b4Q-Kk3OGhVz0gvVhrwg.png"/></div></div></figure><figure class="kr ks kt ku fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lp"><img src="../Images/97007abd94bf1704921267acd9289b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGR6vBc4X30AmJK7dPqy6g.png"/></div></div></figure><p id="f18d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些图表告诉我们，最活跃的日子是星期五和星期六，从一天开始到下午6点，出行次数逐渐增加。</p><h2 id="3d64" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated"><strong class="ak">用户行为会随着时间而改变吗？</strong></h2><p id="3d47" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">我们希望通过比较前30天和后30天来了解用户行为是否会随着时间的推移而改变。使用查询功能，我们通过过滤掉前30天和后30天来创建新的数据框架。两个数据帧中都添加了一个名为“时间段”的新列。该列包含字符串值“前30天”或“后30天”，这取决于它所适合的时间段。我们将两个数据帧连接成一个。这个新的数据框架只包含第一天和最后30天的乘车记录。我们可以使用这个新创建的数据框架来查看一周中每一天的旅行次数，以及一天中每一小时的旅行次数——针对这两个时间段。</p><figure class="kr ks kt ku fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lq"><img src="../Images/c84e73999aa2b73b93ad031bf0baab97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1rywNIw0hiWYsR8qW5Q3Jw.png"/></div></div></figure><figure class="kr ks kt ku fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lr"><img src="../Images/36acd30e149f90cf53639007a09a493f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I5vjPnntCj9Y_fA4cuOwlw.png"/></div></div></figure><p id="e8ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从这些图表中，我们可以看到一些有趣的趋势。首先，对于一周中的所有日子，从第一时段到第二时段，旅行的次数已经减少。然而，周一出行的减少并不像一周中其他几天那么显著。在第二张图中，我们可以看到每小时的旅行次数。该图显示，与前30天相比，最近30天早上6-9点之间的出行次数实际上更高。</p><p id="dec6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一个有趣的方面是旅行距离和持续时间。我们再次使用groupby函数按照时间段列的平均值对数据帧进行分组。这给了我们两个时间段的平均行程距离和行程持续时间。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="3164" class="jd je hh kw b fi la lb l lc ld">#Calculating average Trip Distance and Trip duration</span><span id="8ead" class="jd je hh kw b fi le lb l lc ld">first_last_month_average = first_last_month.groupby('Time Period').mean().reset_index()</span></pre><figure class="kr ks kt ku fd lg er es paragraph-image"><div class="er es ls"><img src="../Images/90868f3b5ff22fdc59b19d9b0e531aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*aLapycp-B4Mg39PbKUwFzA.png"/></div></figure><p id="2d7e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从输出中，我们可以看到第一个月的平均旅行持续时间为939秒，而过去30天为669秒，减少了40.3%。然而，平均出行距离增加了35.4%，从5065米增加到6859米。</p><p id="68e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">总的来说，我们看到清晨的出行次数实际上增加了，出行持续时间减少了，而出行距离增加了。所有这些发现表明，用户模式已经从休闲转向更多地使用电动滑板车作为一种交通方式。</p></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><h2 id="ff9d" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">地理空间虚拟化</h2><p id="5e24" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">对于地理空间可视化，我选择使用kepler.gl的Python库。根据我在地理空间数据方面的短暂经验，这是在漂亮的交互式地图中可视化大量数据的最简单的方法——您只需要几行代码就可以创建强大的可视化效果。一旦创建了包含您的数据的地图，您就可以直接在笔记本中与它进行交互。创建开普勒地图的几个步骤如下所示。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="857c" class="jd je hh kw b fi la lb l lc ld">import keplergl</span><span id="6aba" class="jd je hh kw b fi le lb l lc ld">#Creating base map<br/>map1 = keplergl.KeplerGl(height=600, widht=800)</span><span id="a636" class="jd je hh kw b fi le lb l lc ld">#Adding layer containing community boundary-polygons<br/>map1.add_data(data=boundaries, name="Community Boundaries")</span><span id="97b4" class="jd je hh kw b fi le lb l lc ld">#Adding second layer containing e-scooter trips<br/>map1.add_data(data=all_trips, name="Trip Data")</span><span id="b2a3" class="jd je hh kw b fi le lb l lc ld">#Display map<br/>map1</span></pre><p id="3931" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，如果你想保存你的地图可视化显示给他人，开普勒让你保存你的HTML格式的地图。我们还需要将配置保存到我们的地图中，以便在打开文件时，其他人能够看到与我们完全相同的地图。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="f27b" class="jd je hh kw b fi la lb l lc ld">#Saving configuration<br/>my_config= map1.config</span><span id="9bdd" class="jd je hh kw b fi le lb l lc ld">#Saving map to html<br/>map1.save_to_html(config=my_config, file_name="chicago_electric_scooters.html")</span></pre><p id="4748" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">地图的最终结果如下所示。尽管只涉及了几行代码，但最终结果很好地概括了电动滑板车旅行，并且易于交互。</p><figure class="kr ks kt ku fd lg er es paragraph-image"><div class="er es ma"><img src="../Images/e39c10e4942f3cadac9a79b42dc2e9ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*2gZ9HbRmLGv6h69QKkp0Gg.gif"/></div></figure></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><h2 id="72d0" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">结论</h2><p id="811a" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">通过对芝加哥2019年电动滑板车试点项目的数据探索，我们看到，在实施后，开始时有大量的电动滑板车出行。试点期间，出行次数慢慢减少。每天的旅行次数似乎在下午5-6点达到高峰，这是大多数人结束工作的时间。一周中出行最多的日子是周末、周五、周六和周日。尽管每日出行的次数随着时间的推移而减少，但用户模式显示，与试点开始时相比，在试点结束时，用户在更短的时间内行驶了更远的距离。这表明用途已经从休闲和娱乐变成了从一个地方到另一个地方的明确的运输方式。通过地图可视化，很明显，这些行程中的大部分位于芝加哥的西侧、北侧和西北侧。</p></div></div>    
</body>
</html>