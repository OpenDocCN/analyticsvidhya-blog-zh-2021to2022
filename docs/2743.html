<html>
<head>
<title>Deeper look at fat tails — 15 year NSE — Nifty EDA in python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入了解厚尾——15年NSE——python中漂亮的EDA</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deeper-look-at-fat-tails-15-year-nse-nifty-eda-in-python-20c897390ca8?source=collection_archive---------9-----------------------#2021-05-15">https://medium.com/analytics-vidhya/deeper-look-at-fat-tails-15-year-nse-nifty-eda-in-python-20c897390ca8?source=collection_archive---------9-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0e595908e2298176fefb6400f1c44386.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E2tKuI7SO5PieI1P"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@theblowup?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上放大</a></figcaption></figure><p id="f1f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">于是<a class="ae iu" href="https://fourweekmba.com/fat-tailed-distribution/" rel="noopener ugc nofollow" target="_blank">的大祭司胖尾巴事件</a>和<a class="ae iu" href="https://www.amazon.in/Incerto-Box-Set-Antifragile-Randomness/dp/0141985208/ref=sr_1_2?dchild=1&amp;keywords=incerto+taleb&amp;qid=1620620295&amp;sr=8-2" rel="noopener ugc nofollow" target="_blank">的黑天鹅；埃斯特雷米斯坦共和国总统</a>开设了一个<a class="ae iu" href="https://www.youtube.com/channel/UC8uY6yLP9BS4BUc9BSc0Jww" rel="noopener ugc nofollow" target="_blank"> YouTube频道</a>关于概率和统计的一些常见话题，如果你对金融市场感兴趣，你应该看看。这些主题与机器学习有很多共同点，所以如果你是数据科学家，请注意。</p><p id="1ecb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">他关于厚尾事件的视频让我开始思考股票市场200-500点左右的大幅波动可能是也可能不是厚尾事件。所以我决定利用NSE Nifty过去15年的数据来探索这个问题。以下分析的所有源代码都在<a class="ae iu" href="https://github.com/gurdeep101/fattailgain/tree/main/eda_nifty_15yr" rel="noopener ugc nofollow" target="_blank">GitHub repo</a>中。</p><p id="1f0b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">数据下载</strong></p><p id="54ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然您可以从NSE历史数据部分获得数据；获取数据是一件痛苦的事情，因为它将搜索请求限制在365天的期限内。我发现了一个<a class="ae iu" href="https://nsepy.xyz/" rel="noopener ugc nofollow" target="_blank"> python包NSEPy </a>，可以让我下载历史数据；你可以从这里得到它。</p><p id="6817" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我下载了从2005年1月到2020年12月的过去15年的数据，保存在一个CSV文件中，以供进一步分析。该文件被保存为csv格式，并加载到一个单独的jupyter笔记本中以供进一步分析。</p><p id="7c19" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是在一些基本的预处理和计算期初投资的100卢比的累积日回报后数据的样子。熊猫函数的价值转移，百分比变化和累积产品使这成为一个简单的任务。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="815c" class="kc kd hi jy b fi ke kf l kg kh"># convert Date column from object to datetime to avoid problems later on<br/>nifty['Date'] = pd.to_datetime(nifty['Date'])<br/># nifty.set_index('Date', inplace = True)<br/>nifty.dtypes</span><span id="d2f2" class="kc kd hi jy b fi ki kf l kg kh"># add year column for groupby later on<br/>nifty1['year'] = nifty1['Date'].dt.year<br/>nifty1.columns</span><span id="85bc" class="kc kd hi jy b fi ki kf l kg kh"># add column for daily return<br/>nifty1['pct_change'] = nifty1['Close'].pct_change(periods = 1)<br/>nifty1['daily_return_100rs'] = (1+nifty1['pct_change']).cumprod()*100<br/>nifty1.tail(n=3)</span></pre></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="1dce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">简单的指数投资——忽略肥尾</p><p id="4604" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们认为波动性会随着时间的推移自行解决，我们会发现100卢比的投资已经增长了近7倍。694也就是31%的CAGR！！我觉得很好。代码和结果如下</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="88cc" class="kc kd hi jy b fi ke kf l kg kh">title_size = 15<br/>tick_size = 13<br/>label_size = 15</span><span id="eba1" class="kc kd hi jy b fi ki kf l kg kh">fig, axes = plt.subplots(figsize = (15,15), nrows = 2, ncols = 1, squeeze = False)<br/># plt.style.use('basic')<br/>axes[0][0].plot(nifty1['Date'], nifty1['Close'], lw = 2, alpha = 0.9, c = 'g')<br/>axes[0][0].set_title('15 year Nifty Closing', fontsize = title_size)<br/>axes[0][0].tick_params(axis = 'x', labelsize = tick_size)<br/>axes[0][0].tick_params(axis = 'y', labelsize = tick_size)<br/>axes[0][0].set_xlabel('Date', fontsize = label_size)<br/>axes[0][0].set_ylabel('Closing Value', fontsize = label_size);</span><span id="6269" class="kc kd hi jy b fi ki kf l kg kh">axes[1][0].plot(nifty1['Date'], nifty1['daily_return_100rs'], lw = 2, alpha = 0.9)<br/>axes[1][0].set_title('Value of 100 invested in Nifty', fontsize = title_size)<br/>axes[1][0].set_xlabel('Date', fontsize = label_size)<br/>axes[1][0].set_ylabel('Investment Value', fontsize = label_size)<br/>axes[1][0].tick_params(axis = 'x', labelsize = tick_size)<br/>axes[1][0].tick_params(axis = 'y', labelsize = tick_size)</span><span id="9c94" class="kc kd hi jy b fi ki kf l kg kh">fig.savefig(save_path + 'data_output/nifty_15yr_results.jpg', dpi = 700)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/e6759c3f945402bc3770e659120c6ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1Vs7THUpPZ-whRphpiGRg.jpeg"/></div></div></figure><p id="131d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些长期回报预测的问题是，你的回报对进场和出场的时间非常敏感。比方说，如果你在2008年市场处于6000点水平时投资，并不得不忍受随后崩盘的痛苦。假设你不会发誓投资股票，并相信未来12年的长期投资，但却看到市场因2020年3月的COVID危机而暴跌至7000点。受到惊吓并在3月份赎回，你的年化收益率可能会比银行定期存款低2.5%。</p><p id="ea8b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这意味着——市场的波动不容忽视。</p><p id="54e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">市场到底有多不稳定？</strong></p><p id="4452" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://www.mathsisfun.com/data/standard-deviation.html" rel="noopener ugc nofollow" target="_blank">标准差(SD) </a>是世界上最简单也是最常被(误)教授的波动性度量方法。又被Taleb堵<a class="ae iu" href="https://www.youtube.com/watch?v=iKJy2YpYPe8" rel="noopener ugc nofollow" target="_blank">这个视频</a>。简单地计算15年期间收盘值的标准差会产生误导，因为该指数在15年期间已经上涨，并且没有标准值或平均值可供我们计算偏差。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/1078f04202d21fec5f5b316713a05760.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/0*B1NMeZ3KkPD_R7ly.png"/></div></figure><p id="2604" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一个更好的方法是观察收盘价的变化。我们观察1天、2天和3天期间收盘价的每日变化，并根据时间和变化量绘制它们(直方图)。我们以1天、2天和3天为周期进行变化，因为当极端事件发生时，它们通常会在几天内发生。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="826d" class="kc kd hi jy b fi ke kf l kg kh"># visualise this over a histogram and line plot<br/># 6 plots for 1day, 2day and 3day changes - histogram and line plot</span><span id="b078" class="kc kd hi jy b fi ki kf l kg kh">fig, ax = plt.subplots(3,2, figsize = (25,15))<br/>ax[0][0].plot(nifty1['Date'], nifty1['daily_change'], alpha = 0.9)<br/>ax[0][0].set_title('Daily Change by date', fontsize = title_size)<br/>ax[0][0].tick_params(axis = 'y', labelsize = label_size)<br/>ax[0][0].tick_params(axis = 'x', labelsize = label_size)</span><span id="dd09" class="kc kd hi jy b fi ki kf l kg kh">ax[0][1].hist(nifty1['daily_change'], bins = 60, alpha = 0.9)<br/>ax[0][1].set_title('Daily Change histogram', fontsize = title_size)<br/>ax[0][1].tick_params(axis = 'y', labelsize = label_size)<br/>ax[0][1].tick_params(axis = 'x', labelsize = label_size)</span><span id="612e" class="kc kd hi jy b fi ki kf l kg kh">ax[1][0].plot(nifty1['Date'], nifty1['2day_change'], alpha = 0.9)<br/>ax[1][0].set_title('2 day Change by date', fontsize = title_size)<br/>ax[1][0].tick_params(axis = 'y', labelsize = label_size)<br/>ax[1][0].tick_params(axis = 'x', labelsize = label_size)</span><span id="13f9" class="kc kd hi jy b fi ki kf l kg kh">ax[1][1].hist(nifty1['2day_change'], bins = 60, alpha = 0.9)<br/>ax[1][1].set_title('2 Day Change histogram', fontsize = title_size)<br/>ax[1][1].tick_params(axis = 'y', labelsize = label_size)<br/>ax[1][1].tick_params(axis = 'x', labelsize = label_size)</span><span id="bfd2" class="kc kd hi jy b fi ki kf l kg kh">ax[2][0].plot(nifty1['Date'], nifty1['3day_change'], alpha = 0.9)<br/>ax[2][0].set_title('3 Day Change by date', fontsize = title_size)<br/>ax[2][0].tick_params(axis = 'y', labelsize = label_size)<br/>ax[2][0].tick_params(axis = 'x', labelsize = label_size)</span><span id="8ea8" class="kc kd hi jy b fi ki kf l kg kh">ax[2][1].hist(nifty1['3day_change'], bins = 60, alpha = 0.9)<br/>ax[2][1].set_title('3 Day Change histogram', fontsize = title_size)<br/>ax[2][1].tick_params(axis = 'y', labelsize = label_size)<br/>ax[2][1].tick_params(axis = 'x', labelsize = label_size)</span><span id="c735" class="kc kd hi jy b fi ki kf l kg kh">fig.savefig(save_path + 'data_output/nifty_change.jpg', dpi = 600)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/d3628e6be76ecd96631fa9d3c0b784f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pdpOLUNq-NLWPGdHdHPUlQ.jpeg"/></div></div></figure><p id="c408" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们看到了每日回报的波动性，以及这些值与标准正态分布的相似性。为了真正了解这些变化有多不稳定，我们将这些变化与标准正态分布的预期值进行比较。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="818c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">标准正态分布的<a class="ae iu" href="https://en.wikipedia.org/wiki/68%E2%80%9395%E2%80%9399.7_rule" rel="noopener ugc nofollow" target="_blank">68–95–99.7规则</a>是分别位于平均值的1、2和3个标准偏差内的正态分布值的百分比。如果你更倾向于数学，这篇文章对这背后的基本原理有很好的解释。</p><p id="392c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们根据下面的标准正态分布，将NSE Nifty每日收盘变化的实际天数与预期天数进行比较。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/a7aec75d111fb85aafdbe0f746ccac2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/0*lVjMfrWkIQft4UGK.png"/></div></figure><p id="d328" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的每一列是正态分布和1天、2天和3天变化的天数；而每一行是标准偏差的数量。</p><p id="4a78" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们预计有1290天(1–68%)的天数超过每日变化的1个标准差(1SD ),而1天、2天和3天变化的实际值分别为876、906和927天。</p><p id="b344" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">真正令人惊讶的是，虽然正态分布会告诉我们，在15年(4030天)的时间里，我们预计只有12天会大于平均值的±3倍；实际值在50天的范围内！这差不多是5倍。虽然这个值本身相当大；它没有显示在上面的图中。</p><p id="a487" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对我这个怀疑论者来说，这似乎好得不像是真的。我怀疑这仍然是因为Nifty在过去15年中上涨了7倍，如此大范围的平均值可能会影响标准差的计算。另一个要问的问题是一年中到底有多少这样的日子？在过去的15年里，肥尾事件是增加了还是减少了？</p><p id="f4d1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们每年重复上述计算；分别计算每年的平均值、标准差和正态分布的偏差。为此，我们编写了一个函数来计算所需的值，并分别针对1天、2天和3天的变化运行该函数。下面显示了1天更改的结果和代码示例，而笔记本上有所有时间段的代码和结果。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="b367" class="kc kd hi jy b fi ke kf l kg kh"># function to call in the loop<br/>def sd_count(nifty_yr):<br/>    yr_values = [] # empty list to store values<br/>    sd_mad_ratio = np.sqrt(np.pi/2)# = ~1.25 for std normal distbn<br/>    <br/>    yr_count = len(nifty_yr)<br/>    yr_mean = np.mean(nifty_yr)<br/>    yr_sd = np.std(nifty_yr)# ; print(yr_sd)<br/>    yr_mad = mad_calc(nifty_yr) # call the function for MAD calculation<br/>    yr_sd_mad_ratio = yr_sd/yr_mad # sd to MAD ratio<br/>    yr_sd_mad_delta = yr_sd_mad_ratio &gt; sd_mad_ratio # value 1 if ratio is greater than for Std Normal <br/>    <br/>    yr_days_1sd = np.sum(np.where(abs(nifty_yr) &gt; yr_sd, 1, 0)) # num days where change &gt; 1SD<br/>    yr_days_2sd = np.sum(np.where(abs(nifty_yr) &gt; 2*yr_sd, 1, 0)) # num days where change &gt; 2SD<br/>    yr_days_3sd = np.sum(np.where(abs(nifty_yr) &gt; 3*yr_sd, 1, 0)) # num days where change &gt; 3SD<br/>    <br/>    yr_values = yr_values + [yr_count, yr_mean, yr_sd, yr_mad, yr_sd_mad_ratio, yr_sd_mad_delta, yr_days_1sd, yr_days_2sd, yr_days_3sd]<br/>    return yr_values</span><span id="49b9" class="kc kd hi jy b fi ki kf l kg kh"># loop over all years<br/>for yr in yr_list:<br/>    # print(type(yr))<br/>    temp_df = nifty_data[nifty_data['year'].isin([yr])]<br/>    # print(temp_df.year.unique())<br/>    delta_1day[yr] = sd_count(temp_df['daily_change'])</span><span id="0c59" class="kc kd hi jy b fi ki kf l kg kh">delta_1day.set_index('value', inplace = True)<br/>delta_1day # 1 day change across 15 years</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/10a6775429db84b3f9680b6aec693e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*wlEIbASy5zk1cYgv.png"/></div></figure><p id="e1a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2005年，一天变化的年度标准差为47点，到2020年已上升至318点。我们之前怀疑Nifty增加7倍会对平均值和SD计算产生影响。</p><p id="11e8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们看到每年超过1SD、2SD和3SD的天数或多或少是恒定的。<a class="ae iu" href="https://www.physicsforums.com/threads/mean-absolute-deviation-standard-deviation-ratio.199764/" rel="noopener ugc nofollow" target="_blank">SD-MAD比率</a>略高于其预期值1.25，这意味着每日收益的分布肯定不正常。如果你看过上面的塔勒布视频，你会很清楚这一点。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="cd68" class="kc kd hi jy b fi ke kf l kg kh">fig, ax = plt.subplots(4,1, figsize = (20,20), squeeze = False)</span><span id="00ca" class="kc kd hi jy b fi ki kf l kg kh">ax[0][0].plot(delta_1sd['1day_change'], color = 'r')<br/>ax[0][0].plot(delta_1sd['2day_change'], color = 'g')<br/>ax[0][0].plot(delta_1sd['3day_change'], color = 'b')<br/>ax[0][0].set_title('Days greater than 1 SD', fontsize = title_size)<br/>ax[0][0].legend(['1day change', '2day change', '3day change'], loc = 'lower center', fontsize = label_size)<br/>ax[0][0].tick_params(axis = 'x', labelsize = label_size)<br/>ax[0][0].tick_params(axis = 'y', labelsize = label_size)<br/>ax[0][0].set_ylim(0,100)</span><span id="d3fe" class="kc kd hi jy b fi ki kf l kg kh">ax[1][0].plot(delta_2sd['1day_change'], color = 'r')<br/>ax[1][0].plot(delta_2sd['2day_change'], color = 'g')<br/>ax[1][0].plot(delta_2sd['3day_change'], color = 'b')<br/>ax[1][0].set_title('Days greater than 2 SD', fontsize = title_size)<br/>ax[1][0].legend(['1day change', '2day change', '3day change'], loc = 'center', fontsize = label_size)<br/>ax[1][0].tick_params(axis = 'x', labelsize = label_size)<br/>ax[1][0].tick_params(axis = 'y', labelsize = label_size)<br/>ax[1][0].set_ylim(0,50)</span><span id="ff41" class="kc kd hi jy b fi ki kf l kg kh">ax[2][0].plot(delta_3sd['1day_change'], color = 'r')<br/>ax[2][0].plot(delta_3sd['2day_change'], color = 'g')<br/>ax[2][0].plot(delta_3sd['3day_change'], color = 'b')<br/>ax[2][0].set_title('Days greater than 3 SD', fontsize = title_size)<br/>ax[2][0].legend(['1day change', '2day change', '3day change'], loc = 'upper center', fontsize = label_size)<br/>ax[2][0].tick_params(axis = 'x', labelsize = label_size)<br/>ax[2][0].tick_params(axis = 'y', labelsize = label_size)<br/>ax[2][0].set_ylim(0,50);</span><span id="7d5e" class="kc kd hi jy b fi ki kf l kg kh">ax[3][0].plot(mad_sad_df['1day_ratio'], color = 'r')<br/>ax[3][0].plot(mad_sad_df['2day_ratio'], color = 'g')<br/>ax[3][0].plot(mad_sad_df['3day_ratio'], color = 'b')<br/>ax[3][0].set_title('SD to MAD ratio over time', fontsize = title_size)<br/>ax[3][0].legend(['1day change', '2day change', '3day change'], loc = 'upper center', fontsize = label_size)<br/>ax[3][0].tick_params(axis = 'x', labelsize = label_size)<br/>ax[3][0].tick_params(axis = 'y', labelsize = label_size)</span><span id="11c5" class="kc kd hi jy b fi ki kf l kg kh">fig.savefig(save_path + 'data_output/annual_sd_comp.jpg', dpi = 600)</span></pre><p id="9eca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看天数的变化如何随超过1SD、2SD和3SD的天数而变化，以及15年期间SD-MAD比率的总变化</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/4afb16239c5d693c4f7e66475b9c9238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMlNuhpBk8iDeZxn5b0_Vw.jpeg"/></div></div></figure><p id="1fd1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们从上面的图表中看到，对于1天、2天和3天的变化，回报超过特定SD的天数是相似的。这将意味着，虽然突然的变化发生在2-3天内，但大量的变化发生在一天左右，这使得人们没有太多的时间做出反应。</p><p id="cfeb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">SD-MAD比率的范围在1.25和1.52之间，1日变化趋势的值高于其他值。</p><p id="ef5e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设上述图中的值彼此非常接近；我们取平均值，并与标准正态分布中的预期值进行比较。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/b46dfe6c5e4c9c2db9df81ea821d5917.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/0*xWga2eQkN5OTxcmQ.png"/></div></figure><p id="c213" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每年，我们平均有2天的回报超过Nifty中平均回报的3SD，而每年的预期是0.75天。我们在此确认交易所回报的非正态性，因为我们已经考虑了价值的变化，并查看了价值中正确的分子和分母！</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="68bf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">非正态性——正还是负？</p><p id="7117" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们通常会将黑天鹅事件与市场崩溃和黑暗日子联系在一起。作为研究人员和寻求真理的人，我们不遵循传统智慧，而是让数据自己说话。让我们比较一下2SD的一天收益中正负变化的数量。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="50e6" class="kc kd hi jy b fi ke kf l kg kh">val = 2 # plug for calculating deviations greater than 1, 2 or 3 SD<br/>sd_1day = pd.DataFrame(delta_1day.loc['SD',:].transpose().reset_index())<br/>sd_1day['SD'] = val*sd_1day['SD']<br/>sd_1day.columns = ['year', 'SD']<br/>d = dict(zip(sd_1day['year'], sd_1day['SD'])); d</span><span id="ee05" class="kc kd hi jy b fi ki kf l kg kh">nifty1['pos_sd_1day'] = nifty1['year'].map(d) # add SD value to column<br/>nifty1['pos_delta'] = np.where(nifty1['daily_change'] &gt; nifty1['pos_sd_1day'], 1, 0)<br/>nifty1['neg_delta'] = np.where(nifty1['daily_change'] &lt; (-val*nifty1['pos_sd_1day']), 1, 0)<br/>nifty1.head()</span><span id="42ab" class="kc kd hi jy b fi ki kf l kg kh"># group total of positive and nengative values by year<br/>pos_delta = nifty1.groupby(['year']).agg({'pos_delta': 'sum'}); print(pos_delta)<br/>neg_delta = nifty1.groupby(['year']).agg({'neg_delta' : 'sum'}); print(neg_delta)</span><span id="5c09" class="kc kd hi jy b fi ki kf l kg kh"># plot both on graph<br/>plt.figure(figsize = (15,5))<br/>plt.plot(pos_delta, lw = 3, alpha = 0.6, color = 'g')<br/>plt.plot(neg_delta, lw = 3, alpha = 0.6, color = 'b')<br/>plt.legend(['positive change', 'negative change'],loc = 'upper right', fontsize = tick_size)<br/>plt.title(f'Yearly count of positive and negative changes in daily returns over {val} SD', fontsize = label_size)<br/>plt.tick_params(axis = 'x', labelsize = label_size)<br/>plt.tick_params(axis = 'y', labelsize = label_size)</span><span id="c5ba" class="kc kd hi jy b fi ki kf l kg kh">plt.savefig(save_path + 'data_output/pos_neg_delta.jpg', dpi = 900)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/a238cb1f6cb893fd6876ca60380326ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tpSaAkNT5jXwJ3OtGraMIw.jpeg"/></div></div></figure><p id="513a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在任何一年中，积极事件的数量都远远高于消极事件的数量！这意味着在厚尾中有下行保护和上行捕捉的空间。</p><p id="5b0c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">上行捕捉&amp;下行保护</strong></p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ky"><img src="../Images/6cd6283fc82451b615ed1cfbdbea926b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*huBuPicxHUMTBTHT"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡洛斯·穆扎</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3a6a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以现在我们知道金融市场在左边和右边都有厚尾。我们来玩“如果”吧</p><p id="1a40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们抓住一部分上升空间，比如说50%,保护我们自己免受50%的下降空间，在理想的世界里，两者兼而有之！！</p><p id="097f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在上述每种情况下，我们15年前投资的100卢比今天会是什么样子？</p><p id="88d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们在下面看到的明显更高的a；尽管真正的收益来自于长期积累的复利。</p><p id="9a08" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">保护下跌和从上涨中获取额外的alpha值是很重要的，但这本身不会产生惊天动地的回报，除非你能够将额外的收益重新投资到市场中，以获得复利回报。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4ec5" class="kc kd hi jy b fi ke kf l kg kh">plt.figure(figsize = (15,5))<br/>plt.plot(nifty1['Date'], nifty1['daily_return_100rs'], lw = 2, alpha = 0.9, c = 'r', label = 'Simple Indexing')<br/>plt.plot(nifty1['Date'], nifty1['pos_retrn_100rs'], lw = 2, alpha = 0.9, c = 'g', label = '50pct upside over 2SD - 1day change')<br/>plt.plot(nifty1['Date'], nifty1['neg_retrn_100rs'], lw = 2, alpha = 0.9, c = 'b', label = '50pct_downside over 2SD - 1day change')<br/>plt.plot(nifty1['Date'], nifty1['pos_neg_retrn_100rs'], lw = 2, alpha = 0.9, c = 'm', label = '50pct upside downside - 1day change')<br/>plt.title('Value of Rs 100 invested in different scenarios in Nifty', fontsize = title_size)<br/>plt.tick_params(axis = 'x', labelsize = label_size)<br/>plt.tick_params(axis = 'y', labelsize = label_size)<br/>plt.legend(loc = 'best')</span><span id="65d1" class="kc kd hi jy b fi ki kf l kg kh">plt.savefig(save_path + 'data_output/upside_downside.jpg', dpi = 600)</span></pre><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/363a593799ca24066f2dc22f6e78e516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVqEP5qpcAiUE2sQf3y5DA.jpeg"/></div></div></figure></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="3be2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">这有多真实？</strong></p><p id="8346" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经看到了大量关于厚尾的存在、黑天鹅事件的影响以及捕捉上行和下行保护的好处的分析。</p><p id="e3d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">能够做到这一点实际上是一个完全不同的世界，因为在现实世界中，我们需要考虑人类情感、市场时机、交易成本以及不提前预定利润而是保持投资的能力。</p><p id="70f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在极端事件中，我们需要考虑期权溢价、下滑和流动性。我们将在以后的文章中探讨这些问题。</p><p id="9379" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用于分析的所有代码都在这个<a class="ae iu" href="https://github.com/gurdeep101/fattailgain/tree/main/eda_nifty_15yr" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>中。</p><p id="66a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过<a class="ae iu" href="https://www.linkedin.com/in/gurdeep101/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae iu" href="https://twitter.com/gurdeep101" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae iu" href="https://gurdeepsinghs.medium.com/" rel="noopener"> Medium </a>与我联系，了解最新消息。那都是乡亲们！</p><p id="e6a1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注:所有内容均为研究目的，非投资建议。我建议你不要在没有咨询注册财务顾问的情况下尝试同样的做法，然后再做投资决定。</p></div></div>    
</body>
</html>