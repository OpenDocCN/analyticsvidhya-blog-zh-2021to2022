<html>
<head>
<title>Multiple column output from row wise operations.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">行方式操作的多列输出。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/multiple-column-output-from-row-wise-operations-422921ae5dbf?source=collection_archive---------22-----------------------#2021-02-23">https://medium.com/analytics-vidhya/multiple-column-output-from-row-wise-operations-422921ae5dbf?source=collection_archive---------22-----------------------#2021-02-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ea05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我想谈谈在熊猫身上做大量数据工程和分析时经常出现的一个场景。</p><p id="494c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们都知道，Pandas的一大优势是能够向整个数据阵列广播功能，并轻松转换大量数据。除了像mean()、sum()等内置函数之外，pandas还允许您在几行代码中对整个数组应用自定义函数。这是通过对数据帧应用()方法来实现的。</p><p id="5b5a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经通过对现有列应用函数生成了新的pandas列。我发现自己不止一次地想要从一个函数中生成多个列。这样，我可以一次完成多个计算或操作。</p><p id="f7ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我举个具体的例子。最近，我发现自己在做一个项目，涉及评估“新闻”文章，以确定它们的准确性、政治倾向以及它们是否包含仇恨言论。针对仇恨言论，我使用CountVectorizer将我的数据集中每篇文章中已知的仇恨词汇和短语的数量制成表格。</p><p id="261c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您还记得的话，CountVectorizer会生成一个术语矩阵，以及它们在输入到其中的每个文本体中的出现次数(然后您可以将其连接回原始数据集)。我想接下来做一些事情。我想将每个短语的点击数乘以与仇恨言论相关的已知概率，然后将这些相加，得出一个“仇恨得分”。我还想要一个点击总数，以及一个包含每个找到的短语和它被找到的次数的字典。</p><p id="4507" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的最终数据集将有三个新列:“仇恨得分”、“仇恨计数”和“仇恨术语”。最好的方法是在数据帧上使用apply函数，并让它逐行运行。我发现最好的方法是在apply方法中使用lambda函数和自定义函数。</p><p id="8671" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是应用函数的样子:</p><blockquote class="jc jd je"><p id="f8e3" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">df _ vectors = df _ vectors . apply(<em class="hh">lambda</em>row:tally _ counts _ doc(row)，axis=1，result_type='expand ')</p></blockquote><p id="344b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是如何工作的。如果您将一个lambda函数传递给apply()，它会将它逐个应用到行中。传递给lambda函数的是整行，它是作为熊猫系列传递的。此序列的索引是原始表中的列名，值是这些列中每一列的行中的值。然后，您可以对该系列进行切片、读取和修改。注意，我们必须将apply方法中的“axis”参数指定为“1”。这是为了确保它逐行通过。如果我们想遍历列，我们可以将axis指定为“0 ”,这将把列作为一个序列返回。</p><p id="23da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我发现这是一个强大的功能。尤其是与在行序列上操作的自定义函数结合使用时。例如，在上面的代码中，lambda函数将行(作为一个序列)传递给“tally_counts_doc”。让我们来看看这个函数:</p><blockquote class="jc jd je"><p id="5ada" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated"><em class="hh"> def </em> tally_counts_doc( <em class="hh">行</em>):</p><p id="fd13" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">row2 = row[row &gt; 0]</p><p id="758b" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">分数= 0</p><p id="128c" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">点击数= {}</p><p id="c839" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">对于index，row2.items()中的val:</p><p id="79b3" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">点击数[索引]=值</p><p id="98e3" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">hit = dict _ hate weights[index]* val</p><p id="145f" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">得分+=命中</p><p id="f8f0" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">row['仇恨分数'] =分数</p><p id="83c4" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">row['仇恨_点击'] =点击</p><p id="3110" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">返回行</p></blockquote><p id="aff2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如我们所料，这个函数接受一行作为输入(同样，以序列的形式)。回想一下，这个数据框架由原始文章和短语计数向量矩阵组成。因此，大多数列都是0或null，毕竟我们是从稀疏矩阵中得到这部分DF的。我们只对那些值大于0的列感兴趣。多亏了lambda函数，这很容易，因为我们可以简单地将整行作为一个序列，然后用基本的序列过滤语法(row2 = row[row &gt; 0])对其进行过滤。</p><p id="c1be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，一旦我们将行作为一个系列获得，回想一下我们想要对它执行多个操作并获得多个输出，我们想要将每个输出添加为第二列。由于在apply方法中使用了lambda函数，这就像向row-Series添加一个新项目一样简单。序列中代表原始行的新行，例如:</p><blockquote class="jc jd je"><p id="f330" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">row['仇恨分数'] =分数</p><p id="ca19" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">row['仇恨_点击'] =点击</p></blockquote><p id="f180" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦函数对行执行了操作并向其中添加了“列”(实际上是表示原始行的序列的行)，它就可以简单地将新行返回给lambda函数，然后lambda函数将它传递回原始数据帧。这里再说明一点；除了apply方法中的axis参数之外，还必须将关键字参数“result_type”指定为“expanded”。这给了Pandas一个提示，它将获得一个包含新列的行，并需要将它们添加到原始数据帧中。</p><p id="10d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">简单。通过这种方式，您可以一次对一行运行多个操作，而不是重复地将它加载到内存中。希望这将有助于更快更干净的代码。</p><p id="0e62" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望你觉得这有用！</p></div></div>    
</body>
</html>