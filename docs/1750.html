<html>
<head>
<title>Can LSTMs Predict Stock Prices? — A Complete Analysis (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LSTMs能预测股价吗？—完整的分析(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/can-lstms-predict-stock-prices-a-complete-analysis-part-1-d9409451216d?source=collection_archive---------0-----------------------#2021-03-16">https://medium.com/analytics-vidhya/can-lstms-predict-stock-prices-a-complete-analysis-part-1-d9409451216d?source=collection_archive---------0-----------------------#2021-03-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8a7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对随机游走理论的透彻分析以及随后使用LSTMs进行股票价格预测的有效性。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/e2f9bcdb535bac3020f0334eb8be3938.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jlfUPZmsPBd1xDBy"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated"><a class="ae js" href="https://earlyretirementnow.com/2018/01/24/random-walk/" rel="noopener ugc nofollow" target="_blank">信用</a></figcaption></figure><p id="4d48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在<a class="ae js" rel="noopener" href="/analytics-vidhya/no-lstms-cant-predict-stock-prices-11f10dcb35d6">之前的一篇文章</a>是关于由于市场价格随时间的随机游走特性，试图使用LSTMs进行股票预测的常见做法是徒劳的。对于这篇文章的深度和论点有一些批评，因此这个计划的3部分系列致力于给出一个相对完整和更深入的主题。</p><p id="0287" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该系列将涵盖:</p><ul class=""><li id="5cd9" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated"><strong class="ig hi">第一部分:</strong>对股票市场价格性质的单独统计分析。我们将使用各种测试进行彻底和无偏见的统计分析，这些测试将用于支持或拒绝股票价格的零假设。</li><li id="8ee4" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated"><strong class="ig hi">第二部分:</strong>与附加数据相关的股票市场价格性质的统计分析。我们将使用各种测试进行彻底和公正的统计分析，这些测试将支持或拒绝使用与股票价格相关的额外数据的有效性。</li><li id="486c" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated"><strong class="ig hi">第3部分:</strong>基于经验的分析，将使用和测试各种不同的模型实现，目标是实现高于基线的显著回报百分比。</li></ul><h1 id="fcf6" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">随机行走假设</h1><p id="8830" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">股票在很大程度上是随机的这一信念被称为r <em class="lk">和随机游走理论</em>，它声称股票价格的变化具有相同的分布，并且相互独立。随机游走理论认为，股票采取随机和不可预测的路径，使得所有持续预测股价的方法都无效。因此，任何以前的股票价格、趋势或信息都不能用来预测未来的走势。</p><h1 id="326a" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">问题是</h1><p id="d44c" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">长短期记忆(LSTM)网络是一种非常流行的递归神经网络，主要用于学习序列和顺序依赖性。</p><p id="586e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用LSTMs的大多数股票价格预测问题似乎是这样建立的，即模型仅使用孤立的股票价格作为进行预测的唯一信息来源。通过这种方式，LSTM试图仅在与它们自身相关的过去价格的背景下学习任何形式的结构和/或序列相关性。然而在理论上，如果每天的股票市场价格遵循随机游走，那么它们将完全相互独立，显然，试图使用LSTM来学习任何类型的结构都是完全徒劳的。</p><h1 id="79ef" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">第一部分的目标</h1><p id="3482" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">这种分析的目的是在孤立的资产价格背景下找到支持或反对RWH的证据。如果有大量证据表明，股票数据中不存在相关性、依赖性或结构，我们就可以得出结论，弱市场假说是正确的。</p><p id="291e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">弱市假说:</strong>弱市假说认为，今天的股票价格反映了过去价格的所有数据，对过去资产价格或趋势的任何形式的技术分析都不能有效地用来帮助投资者做出交易决策。</p><h1 id="2976" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">统计分析</h1><p id="ef62" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">我们将试图确定股票价格是否遵循随机游走。如果一个时间序列的<em class="lk">第一差</em>是<em class="lk">平稳</em>和<em class="lk">随机</em>，则称该时间序列遵循随机游走过程。我们将应用各种统计测试来支持或拒绝随机漫步假说。</p><p id="2ad5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将对4个测试窗口进行相同的统计测试:</p><ul class=""><li id="6ebc" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">空前:统计测试将使用历史上每一天的每日收盘价。</li><li id="34af" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">1年:统计测试将使用最近1年窗口中每天的每日收盘价。</li><li id="981d" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">100天:统计测试将使用最近100天窗口中每天的每日收盘价</li><li id="638b" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">1个月:统计测试将使用最近1个月内每天的每日收盘价。出于一致性目的，“1个月”窗口将被视为30天。</li></ul><h2 id="e19a" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">评估过程</h2><p id="3ee4" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">评估过程如下:</p><p id="e0b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于每个测试窗口，总共进行6次统计测试，以收集支持或拒绝随机漫步假设(RWH)的证据。</p><p id="5326" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">出于可视化、教育性和解释性的目的，我们将遵循IBM股票数据的整个统计过程。</p><p id="33da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IBM股票的4个测试窗口如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lz"><img src="../Images/dde40989816dc5bd591ed03f262b0b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jEhliK6iPQdjTv7lxBUn7w.jpeg"/></div></div></figure><p id="db65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">左上角和右上角窗口分别是完整的历史价格和最近1年的价格。左下角和右下角的窗口分别是最近100天和30天的价格。</p><h2 id="cab2" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated"><strong class="ak">重要提示</strong></h2><p id="03ac" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">尽管统计演练仅以IBM股票为例，但评估过程将适用于标准普尔500指数中的每只股票。</p><p id="5320" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后将结果汇编成最终报告。</p><h2 id="c754" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">额外信息</h2><p id="92ba" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">几乎所有的统计实现和后续测试都将使用Python中的<a class="ae js" href="https://www.statsmodels.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> statsmodels </a>库进行，而可视化将使用<a class="ae js" href="https://matplotlib.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>。数据加载将通过<a class="ae js" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a>进行，并保存在<a class="ae js" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫<em class="lk">数据帧</em> </a>中。假设您熟悉以上所有内容和Python语言。</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="eb00" class="ll ki hh mb b fi mf mg l mh mi">import pandas as pd<br/><br/>import matplotlib.pyplot as plt</span></pre><p id="437a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">statsmodels函数和类将在需要时导入。</p><p id="c68c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为大多数统计概念在每个窗口中都是相同的，所以解释和可视化只能在完整的历史股票价格窗口中进行。所有窗口的结果仍将显示在最后。</p><p id="2340" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设IBM股票数据保存在这个变量中:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="e872" class="ll ki hh mb b fi mf mg l mh mi">data = pd.read_csv('../data/IBM.csv')['Close']</span></pre><p id="4034" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所有matplotlib图形也将使用尺寸<em class="lk"> (16，10) </em>:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="d790" class="ll ki hh mb b fi mf mg l mh mi">plt.figure(<br/>    figsize=(16, 10)<br/>)</span></pre><h2 id="5e24" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">平稳性</h2><p id="977e" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">时间序列平稳性是指时间序列的<em class="lk">统计特性</em>不随时间变化。这不要与更一般意义上的“变化”相混淆，因为许多静态时间序列事实上确实表现出某种程度的视觉变化。相反，这个系列本身的变化方式不会随着时间的推移而改变。换句话说，给定时间序列的均值、方差和自相关结构必须保持不变。</p><p id="7a48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">平稳性在时间序列统计领域非常重要，因为许多统计测试和过程只处理平稳数据。因此，任何非平稳数据必须首先通过称为<em class="lk">差分的过程转换为平稳数据。</em></p><p id="1b43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">求差:</strong>求差是寻找一个时间序列中两个连续观测值之间变化的过程。差异消除了趋势和季节性成分，并将时间序列转换为平稳序列。</p><p id="5c2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些时间序列必须被差分多次，以便完全成为平稳的。这就是所谓的<em class="lk">积分顺序</em>，表示为<em class="lk"> I(d) </em>，其中<em class="lk"> d </em>是时间序列稳定之前的差值数量。值得注意的是，时间序列<em class="lk"> d </em>时间的差值是通过计算<em class="lk"> d </em>时间差值的差值来计算的。</p><p id="80dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随机游走是不稳定的，必须加以区分。随机游走的积分顺序是<em class="lk">I(1)</em>——在一轮差分后它变得稳定。推而广之，如果一个时间序列遵循一个随机游走过程，那么它的积分阶也一定是<em class="lk"> I(1)。</em>有多种统计测试可以帮助识别时间序列是否是平稳的。</p><p id="5f29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回想一下我们的IBM股票数据，我们可以看到下面的Python代码实现和示例:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="7b12" class="ll ki hh mb b fi mf mg l mh mi">plt.plot(data.diff().dropna())  # Computing first differences<br/>plt.show()</span></pre><p id="7079" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是IBM有史以来的股票数据:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/fe21a55df30b7da621f443065aaeea7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8LDcd9M-R22EOEeA76rfig.png"/></div></div></figure><p id="5022" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是第一个区别:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/aa8ab17197446d647a1fe0bde5360e55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtBk9hxXQIyNu8j76vTw7Q.png"/></div></div></figure><p id="2a7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在的目标是评估订单整合，以及第一个差异是否是一个随机过程。</p><h2 id="3fd8" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">扩充迪基-富勒试验</h2><p id="9cf1" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">增强的Dickey-Fuller测试(ADF)可以说是识别平稳性最流行的测试。它的工作原理是试图测试一个<em class="lk">单位根的存在。</em></p><p id="fac1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">单位根:</strong>单位根是随机过程的一个特征。去除单位根是通过差分实现的，并使时间序列平稳。如果一个时间序列有<em class="lk"> d </em>个单位根，那么它必须被微分<em class="lk"> d </em>次，直到序列稳定。因此，任何具有1个单位根的时间序列都可能遵循随机游走过程。</p><p id="b765" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们将获取每个测试窗口的原始股票数据。如果原始时间序列是非平稳的，并且有一个单位根，我们将差分时间序列。测试和差分将不断重复，直到时间序列达到平稳状态。这将帮助我们确定整合的顺序，并评估我们是否支持零假设。</p><p id="dc02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回想一下IBM的数据，我们将首先确定原始价格是否是稳定的:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="957d" class="ll ki hh mb b fi mf mg l mh mi">from statsmodels.tsa.stattools import adfuller</span><span id="ec25" class="ll ki hh mb b fi mk mg l mh mi">adfuller_results = adfuller(data)</span></pre><p id="7074" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ADF测试将返回以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="eb2d" class="ll ki hh mb b fi mf mg l mh mi">(-1.0702735595579473, 0.7267797486383903, 39, 14846)</span><span id="da29" class="ll ki hh mb b fi mk mg l mh mi">{<br/>     '1%': -3.4307905517334856, <br/>     '5%': -2.861734704659594, <br/>     '10%': -2.566873636616544<br/>}</span><span id="4c62" class="ll ki hh mb b fi mk mg l mh mi">(49428.8527942435)</span></pre><p id="268e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据statsmodels文档，前4个值分别是ADF统计、p值、使用的滞后数和nob。最后两个数字可以忽略不计。</p><p id="c6d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了便于分析，可以忽略最后一个数字(49428.8……)。</p><p id="ac87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">括号中的值称为<em class="lk">临界值</em>。临界值代表ADF统计量必须至少达到的值，以便获得时间序列不包含单位根的某种置信度。在这种情况下，ADF统计值必须小于或等于-2.566，以表明我们有90%的把握不包含单位根。</p><p id="b513" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果ADF统计量低于任何临界值，我们可以拒绝这个时间序列的零假设，并且不存在单位根的可能性更大。本质上，ADF统计值越负，我们就越确定时间序列不包含单位根。如果ADF高于临界值，时间序列有单位根的概率——因此不是平稳的——会增加，因此我们可以<em class="lk">而不是</em>拒绝零假设。</p><p id="9211" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个例子中，ADF根本没有那么负，甚至比10%的临界值高得多。因此，单位根存在的可能性很大，因此这个时间序列不是平稳的，不能拒绝零假设。</p><p id="36c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将对时间序列进行区分，并对差异进行重新测试:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="9b74" class="ll ki hh mb b fi mf mg l mh mi">adfuller_results = adfuller(data.diff().dropna())</span></pre><p id="e0c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对差异数据的ADF测试将返回以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="36ea" class="ll ki hh mb b fi mf mg l mh mi">(-21.367408355579464, 0.0, 38, 14846)<br/> <br/>{<br/>     '1%': -3.4307905517334856, <br/>     '5%': -2.861734704659594, <br/>     '10%': -2.566873636616544<br/>} </span><span id="5554" class="ll ki hh mb b fi mk mg l mh mi">(49425.674742881965)</span></pre><p id="e259" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">差分时间序列的ADF统计量是令人难以置信的负值，其值为-21.367，远远低于任何临界值。因此，这种差分时间序列包含单位根的可能性极低。IBM股票数据的一阶差分时间序列是平稳的。</p><p id="a7ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">重要提示:</strong>通常最常用的临界值是5%(无单位根95%置信)，然而，我们将使用更自由的10%临界值，以尽可能有利于替代假设。</p><p id="f76b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于使IBM股票数据稳定需要1个差值，我们可以得出结论，它的积分顺序为<em class="lk"> I(1) </em>。这支持了随机漫步假说。</p><p id="b34b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果:</strong>在这里可以看到所有4个测试窗口的ADF结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ml"><img src="../Images/7e91e4b3649205599e8a0e6fadc309a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQIjZ13dijMRhLyewjGCbg.png"/></div></div></figure><p id="6561" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>原始时间序列只有1个单位根，因此有一个<em class="lk"> I(1)的积分阶。</em>尽管使用了10%的临界值，ADF测试仍支持除1年窗口之外的所有RWH<em class="lk">。</em></p><h2 id="5505" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">WALD-沃尔福威茨试验</h2><p id="619c" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">Wald-Wolfowitz测试(WW)是RWH的完美测试，因为它是专门设计来测试序列中的元素是否相互独立，以及是否独立地来自同一分布。这实际上是RWH的字面定义。</p><p id="b0db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">WW测试只接受二进制值，因此“运行”将由一系列的回报是正还是负组成。因此，WW将测试各个返回值之间是否存在任何顺序相关性。</p><p id="6482" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回想IBM数据，我们需要首先计算系列的百分比变化，然后根据它们的符号将它们二进制化。</p><p id="f278" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这可以在Python中实现为:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="4c7c" class="ll ki hh mb b fi mf mg l mh mi">from statsmodels.sandbox.stats.runs import runstest_1samp</span><span id="32b7" class="ll ki hh mb b fi mk mg l mh mi"><br/>pct_change = data.pct_change().dropna()</span><span id="a166" class="ll ki hh mb b fi mk mg l mh mi">binarized = list(map(lambda x: 1.0 if x &gt; 0.0 else 0.0, pct_change))<br/><br/>ww_results = runstest_1samp(binarized)</span></pre><p id="202d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">WW测试将返回以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="e8e5" class="ll ki hh mb b fi mf mg l mh mi">(0.5207017802858459, 0.6025745340209065)</span></pre><p id="6fff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些数字分别称为<em class="lk"> z-stat </em>和<em class="lk"> p-value </em>。</p><p id="c8cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果p值低于0.05的α值(5%误差)，我们拒绝零假设。</p><p id="0220" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">Alpha:</strong>Alpha表示当零假设为真时，错误拒绝零假设的概率。</p><p id="2668" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种情况下，p值是alpha值的12倍，因此有60%的可能性我们会错误地拒绝零假设。因此，我们绝对不能拒绝零假设。然而，我们将在测试中使用更宽松的10%。</p><p id="0a19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果:</strong>这里可以看到所有4个测试窗口的WW结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mm"><img src="../Images/0da1281b405410bf19ac4a80871f169f.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*jVVNcm7GIJkzZnxWEUH5sw.png"/></div></figure><p id="2faf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>IBM股票的百分比变化只支持一半窗口的RWH。然而，100天的窗口是有争议的，因为p值低于10%，但仍然在更普遍使用的5% alpha之外。1年的测试窗口具有更低的p值，因此我们可以更安全地拒绝零假设。</p><h2 id="a5fe" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">ACF和PACF图</h2><p id="ae7e" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">ACF(自相关函数)和PACF(偏自相关函数)图是时间序列分析中最常用的工具。</p><ul class=""><li id="778b" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated"><strong class="ig hi"> ACF: </strong>自相关函数计算给定时间序列的自相关。自相关是由<em class="lk"> k </em>时间步长分隔的时间序列的观测值之间的相关性。</li><li id="a001" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated"><strong class="ig hi"> PACF: </strong>偏相关函数计算关系的强度，同时考虑任何中间滞后。</li></ul><p id="9bfe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随机漫步通常有一些颇具象征性的ACF和PACF图。举例来说，我们将首先为Python生成的随机游走绘制ACF和PACF:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/5da548ae6b9cbe170ec1ad6265801103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Nglo2Ybomkut4aH5s8AKg.png"/></div></div></figure><p id="dda3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面是初始值为零的随机行走，每一步都是均匀分布[-2.5和2.5]之间的随机百分比变化。行走进行了1000个时间步。</p><p id="55b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在将绘制ACF和PACF的随机游走图:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/f8c2d6da6a08fcaedac1bf22e612c0a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*pHdelzaJ4bTGdP-iCEG1FQ.png"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/8be6843d4e3d5bccd543c27b88a505c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*-n6jiDPCN2swQR4ZRQ9IOw.png"/></div></figure><p id="198d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们可以观察到具有单位根的时间序列的一些关键特征:</p><ul class=""><li id="cd69" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">ACF图中的相关性随着滞后次数的减少而慢慢衰减。</li><li id="ea27" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">PACF具有突然和/或立即的截止。</li></ul><p id="cd83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们对随机游走求差，我们应该期待一个随机过程，因此无论如何都没有序列自相关:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/4c132d40244b514d66b575e56252deea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NENI18LR_5HQKmguCau9Ng.png"/></div></div></figure><p id="90e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">差分随机游走的ACF和PACF图；</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/1f775ab5648242aa2f7bd345018a3815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*pddSPCCW2Igdd46Fdus_5w.png"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/5072b813382bc3d9672b6689ad6656f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*DoVSLwkdkcjbs0eiYc-Mdg.png"/></div></figure><p id="6feb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如预期的那样，在随机漫步的第一个差异中不存在显著的相关性。</p><p id="4fdb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在来看看IBM数据示例的相应的ACF和PACF图。在Python中，这被实现为:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="a9b5" class="ll ki hh mb b fi mf mg l mh mi">from statsmodels.graphics.tsaplots import plot_acf<br/>from statsmodels.graphics.tsaplots import plot_pacf</span><span id="a5b2" class="ll ki hh mb b fi mk mg l mh mi"><br/>plt.plot(data.pct_change().dropna())<br/>plt.plot(data.pct_change().dropna())</span><span id="78e8" class="ll ki hh mb b fi mk mg l mh mi">plt.show()</span></pre><p id="8160" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是原始的IBM示例股票数据图:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/2b2c235fc4a336527693fc8e467b122e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*YErJWohfJslT9MVsx03opg.png"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/6fa919b66ae72cd16033cffc6a8ec6e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ZuvMPguTQXICWvO1TIVHgw.png"/></div></figure><p id="10d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些图清楚地显示了与原始随机行走时间序列相同的行为，当然，两者都有一个单位根。</p><p id="5b46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IBM股票的第一个差异图:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/4493a0cf8f6964d79f0974ee63d3f70a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*YQI5_lhoXMDLZpmF1kXblQ.png"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/61073d4f8f913a038bd9c026dad25def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*waKOBSS6YDfLHTHD0xIz6Q.png"/></div></figure><p id="5f66" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IBM股票的第一个差异没有显著的相关性。</p><p id="bf4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这同样适用于股票的百分比变化。下面是IBM股票收益的ACF和PACF图:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/3a3641159ca34e8daa6a041d557d08fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bMcQfWDWLCJItxrKg4Iphw.png"/></div></div></figure><p id="d81c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ACF和PACF图:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/8a5467244d2b710f7dc4d1c0add675b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Ywl3g5ltjJ79T_xt97G6MA.png"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mn"><img src="../Images/d254238060088518581b515e418fb9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*tVxLm3hHTWjZhZucmSadRQ.png"/></div></figure><p id="52a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>返回值的任何滞后之间没有显著的相关性，这反过来支持RWH。</p><h2 id="5189" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">德宾-沃森试验</h2><p id="16c8" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">Durbin-Watson检验(DW)是一种统计检验，用于识别回归模型残差中是否存在自相关。在拟合回归模型之后，残差项之间相关性的存在将指示回归模型中未考虑的附加数据的存在。随机过程应该在误差项之间没有相关性，因为序列当然是随机的，因此不存在可以帮助更好地模拟序列的剩余额外数据。</p><p id="9e2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将使用<em class="lk">普通最小二乘法</em>作为我们的回归模型。然后，将使用DW测试评估滞后-1时的残差序列相关性。</p><p id="f529" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">DW测试可以实现为:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="32a6" class="ll ki hh mb b fi mf mg l mh mi">from statsmodels.regression.linear_model import OLS<br/>from statsmodels.stats.stattools import durbin_watson<br/></span><span id="0313" class="ll ki hh mb b fi mk mg l mh mi">model = OLS(data.diff().dropna(), list(range(len(data.values) - 1)))<br/>fitted = model.fit()<br/><br/>dw_results = durbin_watson(fitted.resid)</span></pre><p id="bd96" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">DW测试将返回以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="a71e" class="ll ki hh mb b fi mf mg l mh mi">2.060815605898576</span></pre><p id="deaa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这被称为德宾-沃森统计，它在0-4的范围内测量系列相关性。统计值越接近0，正序列相关的证据就越多。越接近4，负序列相关性的证据越多。约为2的DW统计值将表明根本没有相关性。由于我们的测试返回的DW统计值实际上为2，我们可以得出结论，OLS残差之间没有序列相关性，因此时间序列很可能遵循随机游走。此外，我们将尝试评估实际的每日百分比变化本身是否有随机的证据。</p><p id="3930" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果:</strong>这里可以看到所有4个测试窗口的DW结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mo"><img src="../Images/ed861e2a6f28f1284a4653ff723831ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qInRhdteLB0pMQjNmNVnZQ.png"/></div></div></figure><p id="8de2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>在4个测试窗口中的每一个的第一差异和回报上训练的回归模型的残差都具有接近2的DW统计量，因此没有相关性的证据。我们可以结束对RWH的支持。</p><h2 id="1f7d" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">永盒试验</h2><p id="d83e" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">Ljung-Box检验(LB)类似于Durbin-Watson检验，它检验来自拟合回归模型的残差的<em class="lk"> n </em>自相关。这里，在将<em class="lk"> ARMA(p，q) </em>模型拟合到数据之后，将测试应用于时间序列的残差。</p><p id="43d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">LB测试可以实施为:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="1957" class="ll ki hh mb b fi mf mg l mh mi">from statsmodels.stats.diagnostic import acorr_ljungbox</span><span id="fe2e" class="ll ki hh mb b fi mk mg l mh mi">model = ARMA(data.pct_change().dropna(), (1, 1))<br/>fitted = model.fit()</span><span id="33fd" class="ll ki hh mb b fi mk mg l mh mi"># p-values for every lag up to 20<br/>lb_results = acorr_ljungbox(fitted.resid, <br/>                            lags=min(20, len(fitted.resid) - 1))[1]</span></pre><p id="a85d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">LB测试将返回以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="ccca" class="ll ki hh mb b fi mf mg l mh mi">[9.13195073e-01 7.97214509e-01 7.07961633e-01 8.38881515e-01<br/> 2.72909791e-01 6.68844143e-02 1.37431528e-02 3.41379708e-04<br/> 2.55141455e-06 3.49588704e-08 4.69947324e-08 6.53618880e-08<br/> 1.07531420e-07 6.86744750e-10 6.00615669e-10 1.25531032e-09<br/> 8.04833275e-10 2.92999778e-11 8.71485315e-12 1.11609206e-11]</span></pre><p id="52ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然它看起来很复杂，但它只是每个滞后时间步长的一个<em class="lk"> p值</em>列表。在这种情况下，我们调查多达20个滞后。</p><p id="24bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们看到每个相应滞后的许多<em class="lk"> p值</em>都远低于所需的5% alpha，这意味着我们可以拒绝IBM有史以来数据的零假设。</p><p id="3da7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果:</strong>这里可以看到所有4个测试窗口的LB测试结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mp"><img src="../Images/a1b935602c926596bc0c59286df12305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*zbh8-W-WKUUqzH3pjwzgxg.png"/></div></div></figure><p id="e6c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于LB测试返回了所有滞后值的<em class="lk"> p值</em>直到20，它们没有全部包含在最终结果的图表中。相反，如果任何一个滞后的p值低于alpha值(0.05)，那么我们将拒绝该窗口的零假设。</p><p id="7783" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>ARMA(1，1)模型的残差对4个测试窗口中的每一个的百分比收益率进行训练，主要显示了反对RWH的证据。除了30天之外，所有的RWH都被拒绝。</p><h2 id="e3fd" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">布-戈二氏试验</h2><p id="0f75" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">与Ljung-Box检验类似，Breusch-Godfrey检验(BG)评估回归模型残差之间的自相关性。通常，它被认为比永盒或德宾-沃森测试更有效。</p><p id="107b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Python中，这可以实现为:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="64f4" class="ll ki hh mb b fi mf mg l mh mi">from statsmodels.regression.linear_model import OLS<br/>from statsmodels.stats.diagnostic import acorr_breusch_godfrey</span><span id="113b" class="ll ki hh mb b fi mk mg l mh mi"># Fitting OLS model<br/>model = OLS(data.pct_change().dropna(), list(range(len(data) - 1)))<br/>fitted = model.fit()</span><span id="5d10" class="ll ki hh mb b fi mk mg l mh mi">bg_results = accor_breusch_godfrey(fitted)</span></pre><p id="52c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">血糖测试将返回以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="7848" class="ll ki hh mb b fi mf mg l mh mi">(<br/>      79.18848606710982,<br/>      0.0003179577084246699, <br/>      1.9362777484912146, <br/>      0.000310375595822454<br/>)</span></pre><p id="2c9a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个值是拉格朗日乘数检验统计量，第二个值是拉格朗日乘数检验统计量的相应p值，最后两个值分别是F检验的F统计量和F检验的p值。</p><p id="9c32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里，我们看到拉格朗日乘数统计的p值远低于0.05的alpha值，因此，我们拒绝了IBM历史数据的零假设。</p><p id="e927" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果:</strong>这里可以看到所有4个窗口的血糖测试结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mq"><img src="../Images/0366de2077fdc8d637e1392f5c13c92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*l-dDkZBo8YfY5ns06yxgNQ.png"/></div></figure><p id="4b6d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>在对每个测试窗口的百分比回报进行训练后，对OLS模型残差进行的BG测试产生了大于alpha的p值，这表明我们不能<em class="lk">而不是</em>拒绝零假设。因此，血糖测试提供了支持RWH的证据。</p><h2 id="7bbc" class="ll ki hh bd kj lm ln lo kn lp lq lr kr ip ls lt kv it lu lv kz ix lw lx ld ly bi translated">单尾检验</h2><p id="fd0b" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">为了使RWH是真实的，给定股票的百分比变化应该在两个方向上大致相等地波动。从本质上讲，负回报和正回报的数量之间应该有一个大约一半一半的比率。</p><p id="8361" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">给定一个返回次数为<em class="lk"> n </em>的序列，正负返回次数应该大致为n/2，标准差为√n/2。</p><p id="b332" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通常，通过使用5%的常用临界值来建立一些偏差，这意味着每组运行的数量不应偏离n/2平均值超过1.64 (z得分为0.05)的标准偏差。</p><p id="8ab2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Python中，这可以实现为:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="2c30" class="ll ki hh mb b fi mf mg l mh mi">pct_changes = data.pct_change().dropna()</span><span id="171d" class="ll ki hh mb b fi mk mg l mh mi">critical_value = 1.64 * (np.sqrt(len(pct_changes) / 2))<br/><br/>num_positive = len([<br/>    *filter(lambda x: x &gt; 0.0, pct_changes)<br/>])</span></pre><p id="a6a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将产生以下结果:</p><pre class="jd je jf jg fd ma mb mc md aw me bi"><span id="67f4" class="ll ki hh mb b fi mf mg l mh mi">141.4874298303563  # Critical value</span><span id="3e09" class="ll ki hh mb b fi mk mg l mh mi">7287  # Number of positive runs</span></pre><p id="eee7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IBM历史数据中的总回报数是14886，这意味着7287次正运行非常接近预期的一半。然而，它实际上偏离一半(14886/2)比141.48允许的临界偏差更大，因此我们拒绝了IBM有史以来数据的随机游走假设。</p><p id="f1b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果:</strong>在这里可以看到所有4个测试窗口的结果:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mr"><img src="../Images/e58c429108b926c49fe0bb4516d70b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*noE3sTCMelrH88EsRj7m_Q.png"/></div></figure><p id="a163" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong>对于3个测试窗口，正回报的数量大约是所有回报的一半，因此我们无法拒绝这3个窗口的零假设。因此，小于历史数据的所有3个窗口都支持RWH。这些观察确实反映了一件有趣的事情:</p><ul class=""><li id="5909" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">对于RWH在发达市场(如美国)的有效性，人们有着相当强烈的共识。然而，一些研究发现，新兴市场或不完全有效，至少在弱式意义上。将此与IBM的数据联系起来，我们看到空前是唯一不支持RWH的窗口，因为它的正运行与负运行的比率更高。作为前所未有的数据，这当然反映了IBM历史初期的最初增长和发展时期。这样一个时期可能具有发展中市场的“非随机漫步”性质。然而，正如我们将看到的，这不一定是所有公司的客观事实。</li></ul><h1 id="04f6" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">统计分析结果</h1><p id="a015" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">前面提到的统计“评估过程”的结果可以在下面看到。该表包括股票的名称，以及对给定股票执行的每个测试是否支持RWH:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/40731b8c6e0343a53ad3e36e6dd9a8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pDOA2bR-Yqq87HxiD7p42g.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/82ef03fba72b092650339dba774ee82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ygkAiAF8cGpwfjV_E09BMg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/fd735eedc94276f051ec78804d60fa05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9nVjF2q98hUUyu1pCgyprA.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/4dada2f9797e40c111857139519f2b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AkO2Hp-90d9lm8vd13GVog.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mt"><img src="../Images/85ae29dfcf68f914f19c4490390e09f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NkaXQNbdbmrPC6-zZq0WLQ.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mu"><img src="../Images/99ddb0c12ef229f643097a41a4e6ee13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MrWDQWqAWou6p8gfgiseIg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ms"><img src="../Images/25695203fcbf89fb91675bc130e52d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htuR102_QK57SMcwrBUhIA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">FALSE表示不支持RWH，而TRUE表示支持RWH</figcaption></figure><p id="4100" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们是否认为某一特定股票是随机游走的决定因素如下:</p><ul class=""><li id="b248" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">确定所有测试窗口的特定测试是否显示随机游走的有力证据。在这种情况下，如果特定统计测试的2(半)个或更多测试窗口为假，那么我们将该测试视为一个整体，拒绝该特定股票的RWH。对每一个测试都重复这一过程，直到我们对每一个测试的整体都有一个大致的真或假。</li><li id="fbbe" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">如果每个测试中有3(一半)或更多的一般结论是错误的，则该股票不被视为随机游走。</li></ul><blockquote class="mv mw mx"><p id="4813" class="ie if lk ig b ih ii ij ik il im in io my iq ir is mz iu iv iw na iy iz ja jb ha bi translated"><strong class="ig hi">每只股票都是按照随机漫步的方式成交的</strong></p></blockquote><p id="dadc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">至少，我们可以得出这样的结论，任何一只被分析的股票的4个测试窗口，1年，100天和30天，都有强有力的证据支持RWH。</p><h1 id="ecdf" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">结论</h1><p id="2175" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">仅基于统计分析，我们就有强有力的证据得出结论，股票市场价格遵循随机游走。因此，在数据中找不到顺序相关性或可学习的结构。因此，我们证明了弱市场假说是正确的。</p></div></div>    
</body>
</html>