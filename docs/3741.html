<html>
<head>
<title>Multi seasonal time series analysis: decomposition and forecasting with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多季节时间序列分析:用Python进行分解和预测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/multi-seasonal-time-series-analysis-decomposition-and-forecasting-with-python-609409570007?source=collection_archive---------0-----------------------#2021-07-21">https://medium.com/analytics-vidhya/multi-seasonal-time-series-analysis-decomposition-and-forecasting-with-python-609409570007?source=collection_archive---------0-----------------------#2021-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">通过未观测成分模型分析具有100，000+个数据点的复杂季节性时间序列的实例</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/5e69bbcd40c1f4a4bfd899e23f08ca8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YC7BlVzYCdED6yz1"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">照片由<a class="ae ju" href="https://unsplash.com/@orwhat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">理查德·霍瓦特</a>在<a class="ae ju" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="2593" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">范围</strong></h1><p id="dca0" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi ky translated">预测是商业中常见的统计任务。它非常重要，因为它影响管理决策和管理资源的企业活动。第一个统计方法是在100年前首次开发的，ARIMA模型仍然在其他现代机器学习和深度学习技术中频繁使用。尽管很受欢迎，ARIMA模型也有一些严重的缺点:</p><ol class=""><li id="6800" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">模型的系数不容易解释或需要详细解释</li><li id="e335" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">对于小数据集是有效的，但是计算量很大</li><li id="6590" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">假设数据是稳定的，否则输入应该被转换。因此，预测指的是转换后的数据，而不是原始时间序列。除了可解释性之外，相对于没有变换的平稳序列，该属性增加了置信区间</li></ol><p id="b11e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更好地解释季节性时间序列，开发了其他方法，如未观测成分模型(UCM)。作为一种所谓的“状态空间”模型，UCM将原始时间序列分解为其个体水平、趋势、周期、季节成分，并通过建模和取这些成分的总和来预测未来值。</p><p id="e80a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章是出于实用目的，关于<a class="ae ju" href="https://otexts.com/fpp3/ets.html" rel="noopener ugc nofollow" target="_blank">状态空间模型</a>的更多信息，特别是<a class="ae ju" href="https://www.lexjansen.com/nesug/nesug04/an/an03.pdf" rel="noopener ugc nofollow" target="_blank"> UCM </a>，请跟随带下划线的链接。<code class="du lv lw lx ly b">Statsmodels</code>用户指南也可以在<a class="ae ju" href="https://www.statsmodels.org/dev/examples/notebooks/generated/statespace_structural_harvey_jaeger.html" rel="noopener ugc nofollow" target="_blank">这里</a>获得，但是我将该方法应用于一个更具说明性和更大的数据集。</p><p id="be0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分析的目标是利用过去的可用值预测未来一年的能源需求。可选地，可以使用外生变量来改进模型。一些这样的变量被选择、收集并输入模型。</p><p id="2fa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">注:代码是逐步嵌入的，完整代码可在</em> <a class="ae ju" href="https://jovian.ai/danielandthelions/hourly-energy-consumption-final" rel="noopener ugc nofollow" target="_blank"> <em class="jd">这里</em> </a> <em class="jd">。出于演示的目的，偶尔会先嵌入输出，然后再嵌入输入。这些作品旨在让非专业观众也能理解。你觉得是吗？是不是少了什么？欢迎发表意见。</em></p><h1 id="f1dd" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">关于数据集</strong></h1><p id="0162" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi ky translated"><span class="l kz la lb bm lc ld le lf lg di"> T </span>他选择的数据集是来自<a class="ae ju" href="https://www.kaggle.com/robikscube/hourly-energy-consumption" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的‘每小时能耗’。该源包含美国几个服务区每小时报告的以兆瓦为单位的能量需求值。出于演示目的，我选择了从2004年1月10日01:00:00到2018年8月3日的美国电力(AEP)时间序列。00:00:00.</p><p id="4a4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有些日期缺失，有些重复。这些问题已在下文讨论和介绍。</p><h1 id="0bc2" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">方法</strong></h1><p id="a6e7" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi ky translated"><span class="l kz la lb bm lc ld le lf lg di"> D </span>数据集被拆分为训练和测试子集(持续8766小时作为测试)。应用对象和功能的简要概述:</p><ol class=""><li id="04a2" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">使用<code class="du lv lw lx ly b">pandas</code>和Python的<code class="du lv lw lx ly b">datetime</code>类加载和清理数据帧</li><li id="ffd1" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">通过<code class="du lv lw lx ly b">seaborn</code>设置定制的<code class="du lv lw lx ly b">matplotlib.pyplot</code>绘制时间序列进行探索性数据分析</li><li id="261e" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">通过<code class="du lv lw lx ly b">statsmodels.tsa</code>类的<code class="du lv lw lx ly b">seasonal_decompose()</code>功能手动分解单个组件</li><li id="e077" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">通过<code class="du lv lw lx ly b">scipy.optimize()</code>和<code class="du lv lw lx ly b">numpy</code>逼近单个组件</li><li id="a1a7" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">通过<code class="du lv lw lx ly b">statsmodels.tsa</code>的<code class="du lv lw lx ly b">UnobservedComponents</code>类自动分解单个组件并执行剩余诊断</li><li id="26e6" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">使用<code class="du lv lw lx ly b">sklearn.metrics</code> (MAE —平均绝对误差，RMSE —均方根误差)的模型评估，以及观察值积分和预测值积分的比较(以兆瓦时为单位的年绝对能源需求)</li></ol><h1 id="ba41" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">结果</strong></h1><p id="f284" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated"><strong class="ih hj">加载并清理数据帧</strong></p><p id="ffb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先加载上述库:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="db76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据帧从Kaggle提供的csv格式加载。事实证明，这些指数并不是按顺序排列的:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="bb4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快速可视化揭示了数据集的复杂性。还绘制了一个更窄的时间框架，用于检查细微的模式:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="19d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">索引不是<code class="du lv lw lx ly b">datetime</code>格式。对于模型类输入来说，这是必须的，所以它们要被转换。通过检查与数据框索引具有相同开始和结束日期的生成日期列表的相等性来获得测试:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="dade" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出为假。进一步的调查显示，存在重复项，并且缺少一些值，因为:</p><p id="0dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">索引集合中的元素数量&lt;索引数量&lt;完整列表中的元素数量</em></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="c7a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转换为<code class="du lv lw lx ly b">datetime</code>格式后，算法会显示重复或缺失的索引:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b448" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">异常情况的补救措施如下:</p><ol class=""><li id="5188" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">通过将提取的索引的字符串格式改变为<code class="du lv lw lx ly b">datetime</code>格式来转换数据帧索引</li><li id="f01e" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">用平均值填补指数缺口</li><li id="0e1c" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">删除重复项，保留重复值的平均值</li></ol><p id="21a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对索引排序并再次测试生成列表的相等性最终成功了:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="7250" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">频率是固定的，尽管如果指数一致，建模类可以推断频率。</p><p id="ae6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">探索性数据分析</strong></p><p id="0ae6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择五个随机时间窗口，并以不同的比例绘制，以检查任何季节模式:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="3cdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些模式暗示至少有每日、每周和每年的季节性成分。为了获得更好的分辨率，可疑的季节性成分被单独标绘。这一次，垂直虚线有助于视觉:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="e50d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">手动分解单个组件</strong></p><p id="f6e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">时间序列被拆分为训练和测试数据。去年(365.25天或8766小时)预留用于测试。使用移动平均值通过<code class="du lv lw lx ly b">seasonal_decompose</code>函数进行分解。该函数接受一个句点参数，因此应该多次应用。首先提取日部分(对于每小时数据，周期=24)，下一步提取周部分(周期=168)，最后提取年部分(周期=8766小时，365.25天，考虑闰年)。</p><p id="9669" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每周分解应在减去每日成分后应用，而每年分解应在从列车数据中减去所有其他季节性成分后应用。请参见流程图，了解该过程的简要概述。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mb"><img src="../Images/3b7e7e7405f8111adf00a06d675da840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3-O27pc30Qbnd3wTyb5XQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated"><em class="mc">泳道时间序列手动分解流程图(来源:作者)</em></figcaption></figure><p id="4f40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">流程的代码:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="5554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">添加了注释的输出是可视化的(代码位于图像下方)。如上所述，分解是用移动平均法进行的。人们可以为这个过程找到更好的方法，这些方法可以在<code class="du lv lw lx ly b">statsmodels</code>库中找到，所以在这一点上，结果取决于程序员的考虑。出于演示的目的，我坚持使用这种方法。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="ada4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">样本内(训练数据时间间隔)预测很容易通过对没有残差的单个分量求和来获得。然而，样本外预测(预测)目前是不可能的:趋势组件不可避免地需要建模来预测未来值。至于季节成分，它们已经泄露了日历效应，并且在一个月的同一天的每周和每年成分的情况下，相位也不同，因为一年由52.14至52.29周(平均52.179周)或8760至8784小时(平均8766小时)组成，取决于闰年。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="1724" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">单个组件的近似值</strong></p><p id="7818" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在对单个组件建模后，可以进行预测。趋势分量在下降趋势区域内进行线性建模，也通过使用<code class="du lv lw lx ly b">numpy</code>多项式建模函数在整个训练数据集内进行三次多项式建模。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="1973" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">季节成分由三角函数近似表示。使用<code class="du lv lw lx ly b">scipy.optimize</code>寻找最佳近似是自动过程，但需要手动构造函数。在调用<code class="du lv lw lx ly b">scipy</code>方法寻找正则化函数的真最小值之前，手动近似也是不可避免的。各个近似值如下所示(首先是输出):</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="6876" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终，可以从建模的组件中构建预测序列。模型的可视化真实地展示了数据集的复杂性和分解的能力，提供了可解释的组件:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="dd97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模型通过平均绝对误差(MAE)和均方根误差(RMSE)进行评估。前者提供了观测值的平均偏差，更直观，而后者(如果显著大于MAE)表明异常值的存在，并可能暗示残差的分布不符合正态分布。可以观察到一个细微的差别:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="2bea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您将看到的，<code class="du lv lw lx ly b">UnobservedComponents</code>类将具有诊断绘图功能，这将提供额外的见解。</p><p id="2121" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模型的第三种评估方法非常准确。这意味着建模的趋势分量是有效的，并且残差在整个序列中变化，平均值接近于零。正如你将看到的，所有的模型精确地(</p><p id="f067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">自动分解单个组件并执行残差诊断</strong></p><p id="4aa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有上述过程都可以通过<code class="du lv lw lx ly b">UnobservedComponents</code>类实现，带有一个随时可用的诊断功能和计算指标的结果类。考虑到从探索性分析中获得的见解，具有相对较少代码行的单个单元格描述了必要的过程，并产生以下汇总表和指标:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="cea6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑到MAE和RMSE度量标准，该模型本质上等同于上述手动方法。请注意，样本内预测的指标也是可用的。这为程序员提供了利用k-fold交叉验证和改进模型参数以获得更好结果的灵活性。你所要做的就是不仅将原始时间序列分成两个子集(训练和测试)，还要将训练集进一步分成k个区间(折叠)。该模型通过在开始时将超参数设置为默认值来初始化，然后执行优化。在k重交叉验证的情况下，初始训练的模型在每一重之后通过用从先前重获得的参数重新初始化而被改进，然后计算度量(使用<code class="du lv lw lx ly b">UnobservedComponentsResults</code>类<code class="du lv lw lx ly b">append()</code>方法)。模型的评估基于每个折叠的平均选择度量值。</p><p id="5099" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果以结果类<code class="du lv lw lx ly b">plot_components</code>函数格式的样式绘制(缺少一些关键信息，因此被忽略):</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="7533" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，<code class="du lv lw lx ly b">plot_diagnostics</code>叫做:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="6499" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于有意义的预测置信区间，残差分布偏离正态分布是可以容忍的。坦率地说，置信区间在几个月后暴涨(我只可视化了点预测)，但模型的可行性由以下内容显示:</p><ol class=""><li id="f682" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">年度总需求的准确性和</li><li id="6995" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">RMSE-基本上是残差的标准差-大约在。平均需求水平的10%</li><li id="926c" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">提前一年的点位预报非常准确，比观测值高2.08%。</li></ol><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="a79c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随后的UC模型与前一个模型的不同之处在于利用外生变量建立模型，对残差进行实际回归，并通过季节模型消除无法解释的方差。观察到的每日模式的变化(见EDA)可能源于温度变化。空调通常在夏季使用，每日模式显示一个峰值，并且夏季需求相对高于例如春季需求。温度数据是从美国国家环境信息中心(NCEI，见资料来源)下载的，其中包含缺失值。填补空白需要另一篇博文来呈现，所以请把它视为理所当然。ARIMA模型填补了这些空白。数据本身来自圣安杰洛，这只是AEP业务的一部分。尽管德克萨斯被认为是AEP人口最稠密、工业化程度最高的服务区，但它的解释力有限，但我仍然将其用于演示目的。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="bc73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模型利用温度数据作为附加输入，并计算度量:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b6b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从指标上看，这显然是一个微小的改进。然而，这证明了该模型的潜力。与第一次UCM相比，观察到的跷跷板模式显示了一些与温度变化相关的变化:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="4376" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">残留诊断:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="1604" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几乎观察不到，但自相关图移向零。精心选择的外生变量将显著降低残差的自相关性，因为它只是随机噪声。</p><p id="1bfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决这个问题，更多的变量被添加到分析中:用于模拟照明的净太阳通量和太阳天顶角(假设用于模拟人工照明的额外能源需求)。数据是从CERES数据库下载的(参见参考资料)。在这种特殊情况下，不需要执行数据清理。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="a78a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我准备了一个纯回归分析作为基准，使用同一个类:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="9651" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如预期的那样，模式建模比纯回归(使用给定的外生变量)产生更好的结果。模型的样本内预测的可视化:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b577" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">绘图诊断显示自相关性增加，正态分布和残差分布之间的相似性降低:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b1be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终模型利用所有给定变量和三角模型:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="97fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和残差分析:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="2db2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">模型评估</strong></p><p id="e4b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如前所述，评估基于三个指标:</p><ol class=""><li id="0642" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">平均绝对误差</li><li id="34a8" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">RMSE(均方根误差)</li><li id="bca8" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">年度总能源需求(TYD)，自定义指标</li></ol><p id="12a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有的模型都准确地预测了趋势。因此，兆瓦时的能源需求预测误差相对接近于零(|2.4%|)。然而，更好的模型更有能力再现季节变化，从而产生更低的MAE。RMSE也以同样的速度下降，这意味着异常值仍然存在于所有的模型中(否则它会比MAE下降得更快)。为最终比较设置了数据框和图形:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="2598" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重要提示:Hyndman &amp; Athanasopoulos建议使用AIC或AICc(修正的AIC)来评估模型。</p><p id="cd46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管UCM模型的调整对指标的影响很小，但结果表明，复杂的多季节时间序列可以用UCM来处理，甚至可以用于长期预测。为了达到精密和准确，必须小心:</p><ol class=""><li id="a2e3" class="lh li hi ih b ii ij im in iq lj iu lk iy ll jc lm ln lo lp bi translated">选择分解方法</li><li id="105b" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">建模单个组件</li><li id="2146" class="lh li hi ih b ii lq im lr iq ls iu lt iy lu jc lm ln lo lp bi translated">选择适当的外生变量</li></ol><p id="52a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者按照手动分解方法，如果可以获得工业知识，可以通过任意复杂的函数来模拟单个组件。</p><p id="c4c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请在我的木星简介<a class="ae ju" href="https://jovian.ai/danielandthelions/hourly-energy-consumption-final" rel="noopener ugc nofollow" target="_blank">这里</a>看完整的代码。</p><p id="d845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">消息来源</strong></p><div class="md me ez fb mf mg"><a href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.statespace.structural.UnobservedComponents.html?highlight=unobserved%20components#statsmodels.tsa.statespace.structural.UnobservedComponents" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hj fi z dy ml ea eb mm ed ef hh bi translated">stats models . TSA . statespace . structural . unobserved components-stats models</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">单变量未观测成分时间序列模型这些也称为结构时间序列模型，并分解…</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">www.statsmodels.org</p></div></div></div></a></div><p id="d81b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">原始数据集</em><br/><a class="ae ju" href="https://www.kaggle.com/robikscube/hourly-energy-consumption" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/robikscube/hourly-energy-consumption</a></p><p id="e2e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Hyndman，R.J .，&amp; Athanasopoulos，G. (2021) <em class="jd">预测:原则与实践</em>，第三版，原文:澳大利亚墨尔本。OTexts.com/fpp3.于2021年7月21日登陆。</p><p id="1402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">动画指南:普罗克·UCM(未观察组件模型)<br/>拉斯·拉威利，ASG公司的承包商。</p><p id="22c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">更详细的UCM <br/> </em>时间序列建模指南，Rajesh Selukar，SAS Institute Inc .，Cary，NC<br/><a class="ae ju" href="https://forecasters.org/wp-content/uploads/gravity_forms/7-621289a708af3e7af65a7cd487aee6eb/2016/07/Selukar_Rajesh_ISF2016.pdf" rel="noopener ugc nofollow" target="_blank">https://forecasts . org/WP-content/uploads/gravity _ forms/7-621289 A 708 af 3 e 7 af 65 A 7 CD 487 aee 6 EB/2016/07/selu kar _ Rajesh _ ISF 2016 . pdf</a></p><p id="bda2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">太阳净通量和太阳天顶角数据</em> <br/> Wielicki，B. A .，B. R. Barkstrom，E. F. Harrison，R. B. Lee III，G. L. Smith和J. E. Cooper，1996:云和地球辐射能系统(CERES):一个地球观测系统实验，Bull。阿米尔。流星。社会主义者, 77, 853–868.2.0.CO餐饮服务公司；2</p><p id="1d95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">圣安杰洛<br/><a class="ae ju" href="https://www.ncei.noaa.gov/" rel="noopener ugc nofollow" target="_blank">https://www.ncei.noaa.gov/</a>的<em class="jd">气温数据</em></p></div></div>    
</body>
</html>