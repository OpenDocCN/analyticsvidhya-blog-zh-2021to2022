<html>
<head>
<title>Futures Trading with python-binance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用python-币安进行期货交易</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/futures-trading-with-python-binance-d738c71e17b5?source=collection_archive---------0-----------------------#2021-07-01">https://medium.com/analytics-vidhya/futures-trading-with-python-binance-d738c71e17b5?source=collection_archive---------0-----------------------#2021-07-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0467" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">温和的介绍</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/bd86ff8b7d6bc68627b005433f20ac99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jTGFaueXLQUm8xRy"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@executium?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">行政长官</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">广场</a>拍照</figcaption></figure><p id="811f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">朋友们好。最近，我一直试图使用python-币安包装器来构建我自己的专有加密算法交易软件。我的策略中很大一部分是交易期货(美元-百万美元)，为了运用杠杆，做多-做空等等。所以我根据我对这个优秀图书馆的了解(向作者Sam McHardy大喊),整理了这个(希望如此)方便的小指南，特别关注未来。我们开始吧！</p><p id="d651" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">请注意:</strong></p><p id="5cbe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">1)我假设我亲爱的读者至少对这个库有点熟悉，因此理解并拥有币安API密匙(对于那些不熟悉的读者，请参见下面的链接)。</p><p id="cb53" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">2)正如麦克哈迪先生自己否认的那样，这是一个非官方的库，意味着它不被币安公司支持。仅支持实际的API链接，这可能会经常发生变化。因此，我们必须自担风险使用图书馆。</p><p id="91dd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">3)还有，也是最重要的，请不要从这篇文章中以任何方式推断投资建议！这在很大程度上是一个“如何做”的指南，所以在市场上执行任何实时交易之前，请保持理智并仔细思考。</p><div class="kk kl ez fb km kn"><a href="https://github.com/sammchardy/python-binance" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">萨姆哈迪/python-币安</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">2021年5月11日更新这是币安交易所REST API v3的非官方Python包装器。我绝不是…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">github.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb jh kn"/></div></div></a></div><div class="kk kl ez fb km kn"><a href="https://www.binance.com/en/support/faq/360002502072" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">如何创建API |币安，API，创建</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">创建一个API可以让你通过几种编程语言连接到币安的服务器。数据可以从…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">www.binance.com</p></div></div><div class="kw l"><div class="lc l ky kz la kw lb jh kn"/></div></div></a></div><p id="75ff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">首先，我们将安装库:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="b4a1" class="li lj hi le b fi lk ll l lm ln"># In a terminal, environment (virtual or otherwise) activated<br/>pip install python-binance</span></pre><p id="b55f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">然后按照下面的方法将其导入Python使用我们的API键实例化一个客户端:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="5498" class="li lj hi le b fi lk ll l lm ln">from binance.client import Client</span><span id="6896" class="li lj hi le b fi lo ll l lm ln">user_key = **********************<br/>secret_key = **********************</span><span id="3849" class="li lj hi le b fi lo ll l lm ln">binance_client = Client(user_key, secret_key)</span></pre><h2 id="c103" class="li lj hi bd lp lq lr ls lt lu lv lw lx jx ly lz ma kb mb mc md kf me mf mg mh bi translated">市场数据</h2><p id="f093" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">在深入交易方面之前，我们可能首先希望检索我们正在交易的合约的一些市场数据。对于这个例子，让我们保持简单，并选择BTC/USDT永久未来的工作。如果我们希望获得合同的<strong class="jq hj">当前</strong>价格:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="1722" class="li lj hi le b fi lk ll l lm ln">binance_client.futures_symbol_ticker(symbol='BTCUSDT')</span></pre><p id="1aa1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">产出:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="c98d" class="li lj hi le b fi lk ll l lm ln"># {'symbol': 'BTCUSDT', 'price': '48057.72', 'time': 1630312116135}</span></pre><p id="f628" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">编辑:</strong>我最初引用了‘期货_硬币_符号_报价器’方法；上面使用的替代方法具有更大的仪器覆盖范围。</p><p id="d442" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">假设我们现在希望为我们的合同检索OHLCV市场数据，以便对<strong class="jq hj">历史</strong>数据进行一些数据分析。我们可以使用以下方法:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="e9bc" class="li lj hi le b fi lk ll l lm ln">binance_client.futures_historical_klines(<br/>    symbol='BTCUSDT',<br/>    interval='1d',  # can play with this e.g. '1h', '4h', '1w', etc.<br/>    start_str='2021-06-01',<br/>    end_str='2021-06-30'<br/>)</span></pre><p id="bc34" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">默认情况下，输出将以列表格式返回给我们，但是我们可以非常容易地将其转换为pandas数据框架，使其更适合于分析目的:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="1323" class="li lj hi le b fi lk ll l lm ln">import pandas as pd</span><span id="abad" class="li lj hi le b fi lo ll l lm ln">df = pd.DataFrame(binance_client.futures_historical_klines(<br/>    symbol='BTCUSDT',<br/>    interval='1d',<br/>    start_str='2021-06-01',<br/>    end_str='2021-06-30'<br/>))</span><span id="b339" class="li lj hi le b fi lo ll l lm ln">df.head()</span></pre><p id="db32" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">产出:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="9b38" class="li lj hi le b fi lk ll l lm ln"># <strong class="le hj">           </strong>   0         1         2   ...          9                  10 11<br/>#0  1622505600000  37244.36  37893.76  ...  291774.994  10673866023.68145  0<br/>#1  1622592000000  36694.37  38232.99  ...  223993.314   8358143926.28754  0<br/>#2  1622678400000  37570.00  39470.00  ...  254932.483   9843247414.77212  0<br/>#3  1622764800000  39247.40  39297.35  ...  345357.923  12774740375.75271  0<br/>#4  1622851200000  36828.03  37900.49  ...  314764.238  11449282806.42592  0<br/>#[5 rows x 12 columns]</span></pre><p id="277c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如您所见，我们的列中的数据类型并不是我们想要的(即时间戳而不是日期，OHLCV之外的多余列)。因此，我们将执行数据争论的一个片段，pandas使它变得如此简单:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="f36c" class="li lj hi le b fi lk ll l lm ln"># crop unnecessary columns<br/>df = df.iloc[:, :6]</span><span id="606c" class="li lj hi le b fi lo ll l lm ln"># ascribe names to columns<br/>df.columns = ['date', 'open', 'high', 'low', 'close', 'volume']</span><span id="6a3e" class="li lj hi le b fi lo ll l lm ln"># convert timestamp to date format and ensure ohlcv are all numeric<br/>df['date'] = pd.to_datetime(df['date'], unit='ms')<br/>for col in df.columns[1:]:<br/>    df[col] = pd.to_numeric(df[col])</span><span id="ad50" class="li lj hi le b fi lo ll l lm ln">df.head()</span></pre><p id="a0c9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">产出:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="c804" class="li lj hi le b fi lk ll l lm ln">#         date      open      high       low     close      volume<br/>#0 2021-06-01  37244.36  37893.76  35500.00  36693.41  590822.540<br/>#1 2021-06-02  36694.37  38232.99  35905.00  37569.99  441719.806<br/>#2 2021-06-03  37570.00  39470.00  37150.15  39247.40  507429.005<br/>#3 2021-06-04  39247.40  39297.35  35552.51  36828.03  700625.866<br/>#4 2021-06-05  36828.03  37900.49  34800.00  35498.62  631028.448</span></pre><p id="4e13" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好多了！好了，前戏到此为止——让我们开始交易吧。</p><h2 id="6bf7" class="li lj hi bd lp lq lr ls lt lu lv lw lx jx ly lz ma kb mb mc md kf me mf mg mh bi translated">贸易</h2><p id="e9ab" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">有趣的部分是:首先，让我们ping一个测试订单，看看服务器是否接收到它。如果不是，那么可能需要对帐户API特权进行一些调查。</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="5fb9" class="li lj hi le b fi lk ll l lm ln">binance_client.create_test_order(<br/>    symbol='<!-- -->BTCUSDT<!-- -->',<br/>    type='MARKET',<br/>    side='BUY',<br/>    quantity=0.001<br/>)</span></pre><p id="68c0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果一切正常，我们应该会收到一个空字典:“{}”。</p><p id="8d25" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">接下来，在进行实际交易之前，我们将快速浏览一下订单簿，以了解市场深度:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="57d3" class="li lj hi le b fi lk ll l lm ln"># into a pandas DataFrame for neater output <br/>df = pd.DataFrame(<br/>    binance_client.futures_order_book(symbol='BTCUSDT')<br/>)</span><span id="b865" class="li lj hi le b fi lo ll l lm ln">print(df[['bids', 'asks']].head())</span></pre><p id="ba9c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">产出:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="54d0" class="li lj hi le b fi lk ll l lm ln">#bids               asks<br/>#0  [36261.99, 0.005]  [36262.22, 0.041]<br/>#1  [36261.98, 0.100]  [36262.46, 0.099]<br/>#2  [36261.84, 0.277]  [36262.60, 0.066]<br/>#3  [36261.83, 0.005]  [36262.62, 0.001]<br/>#4  [36261.79, 0.186]  [36262.74, 0.711]</span></pre><p id="c8f0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，在我们下真正的期货订单之前，最重要的是设置<strong class="jq hj">杠杆</strong>。我们必须<strong class="jq hj">非常非常小心</strong>在确定我们的杠杆率时不要犯任何错误，因为一个小小的错误可能会导致我们承担比我们愿意(或能够)承担的风险大得多的风险！)来给定策略。这就是为什么在每次交易之前，我总是用下面的方法来确定我的杠杆:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="6e7c" class="li lj hi le b fi lk ll l lm ln">binance_client.futures_change_leverage(symbol='BTCUSDT', leverage=1)</span></pre><p id="042b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这将确保您在终端时段<strong class="jq hj">为指定符号</strong>执行的所有交易都采用上面设置的杠杆。如果你比我更有冒险精神，希望提高杠杆，那么你只需确保自己做好了承担额外风险的充分准备，了解风险是如何运作的，并在你的保证金账户中有足够的资金来弥补任何潜在的损失。</p><p id="c6a8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要下达期货<strong class="jq hj">限价</strong>订单:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="6375" class="li lj hi le b fi lk ll l lm ln">binance_client.futures_create_order(<br/>    symbol='BTCUSDT',<br/>    type='LIMIT',<br/>    timeInForce='GTC',  # Can be changed - see link to API doc below<br/>    price=30000,  # The price at which you wish to buy/sell, float<br/>    side='BUY',  # Direction ('BUY' / 'SELL'), string<br/>    quantity=0.001  # Number of coins you wish to buy / sell, float<br/>)</span></pre><p id="b813" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">下达期货<strong class="jq hj">市场</strong>订单:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="a96e" class="li lj hi le b fi lk ll l lm ln">binance_client.futures_create_order(<br/>    symbol='BTCUSDT',<br/>    type='MARKET',<br/>    timeInForce='GTC',<br/>    side='BUY',<br/>    quantity=0.001<br/>)</span></pre><p id="664d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">瞧啊。该头寸应在您的币安账户视图中填充，如下所示(我的是在撰写本文时执行的市价单):</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/ac011c3268863953c71bdba5d6e76515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UfQ0nmxzUeuf9fZRgkr7SQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">0.001 BTC/USDT永久市场订单</figcaption></figure><p id="d501" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果交易尚未完成，可以非常简单地查看当前未完成的订单:</p><pre class="iy iz ja jb fd ld le lf lg aw lh bi"><span id="fd4d" class="li lj hi le b fi lk ll l lm ln">binance_client.futures_get_open_orders(symbol='BTCUSDT')</span></pre><h2 id="4843" class="li lj hi bd lp lq lr ls lt lu lv lw lx jx ly lz ma kb mb mc md kf me mf mg mh bi translated">结论</h2><p id="5291" class="pw-post-body-paragraph jo jp hi jq b jr mi ij jt ju mj im jw jx mk jz ka kb ml kd ke kf mm kh ki kj hb bi translated">希望这对大家有所帮助，请随意查看我的Github页面上的全部源代码，另外，我肯定会鼓励大家查看并拼凑一些python-币安文档，以及币安API文档，因为可能还有我在这里没有介绍的其他功能:</p><div class="kk kl ez fb km kn"><a href="https://github.com/jpstephens93" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">jpstephens93 -概述</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">github.com</p></div></div><div class="kw l"><div class="mo l ky kz la kw lb jh kn"/></div></div></a></div><div class="kk kl ez fb km kn"><a href="https://python-binance.readthedocs.io/en/latest/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">欢迎使用python-币安版本1 . 0 . 12-python-币安版本0.2.0文档</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">2021年5月11日更新这是币安交易所REST API v3的非官方Python包装器。我绝不是…</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">python-binance.readthedocs.io</p></div></div></div></a></div><div class="kk kl ez fb km kn"><a href="https://binance-docs.github.io/apidocs/futures/en/#change-log" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">币安API文件</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">在stream @compositeIndex REST更新端点中添加了用于报价资产和指数价格的WEBSOCKET新字段“q”和“I”……</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">币安文件. github.io</p></div></div></div></a></div><p id="d7ba" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一如既往，我们非常欢迎建设性的反馈，所以请让我知道你认为我做得对还是错。我们也鼓励对未来的主题提出建议，以及任何问题，所以请不要犹豫发表评论，我会尽力尽快回复。</p></div></div>    
</body>
</html>