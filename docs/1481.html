<html>
<head>
<title>The City Spire Experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">城市塔尖体验</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-cityspire-experience-588ec2198d9d?source=collection_archive---------18-----------------------#2021-03-03">https://medium.com/analytics-vidhya/the-cityspire-experience-588ec2198d9d?source=collection_archive---------18-----------------------#2021-03-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="4c71" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">起跑线</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/357768880bfe125a508cb992fb9b9f38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c65oQ0sAVGHjFpKrrsbiJQ.png"/></div></div></figure><p id="1042" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我在高中选修的一门课之外唯一的编程经验是在Lambda学校的时候。Lambda School是一个数据科学/编码训练营，在那里他们模拟行业中的真实工作环境，为你从事软件工程职业做准备。当我在Lambda学校的时候，我们被指示创建一个应用程序，一旦用户输入了城市的位置，这个应用程序就会将城市的度量返回给用户。我们的目标是为用户创建一站式资源，以接收最准确的城市信息。这就是CitySpire的用武之地；我们的应用程序将返回未来12个月的预计租金、该地区的犯罪率(分为暴力犯罪和财产犯罪)、该地区的步行指数、人口规模以及该地区与全国平均水平相比的生活成本。我对此有很多担忧，因为我们有很多方法可以应对这一挑战，而且在处理这一问题时，很多事情都可能出错。其中一个问题是决定我将使用什么样的模型进行预测。最终，我选择使用FBprophet库中的Prophet模型进行预训练，而不是从头开始训练模型。这样做的好处是Prophet已经根据季节变化进行了调整，并且对NaN值非常稳健。</p><h2 id="4307" class="ke kf hh bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky bi translated">挑战</h2><p id="a1fa" class="pw-post-body-paragraph ji jj hh jk b jl kz ii jn jo la il jq jr lb jt ju jv lc jx jy jz ld kb kc kd ha bi translated">我和我的团队面临的挑战之一是找到我们可以使用的数据。我和我的团队遇到的一些数据集有很多有用的信息，但我们没有办法将它们索引到我们所有的其他数据集。出现这种情况的原因之一是因为数据集缺少一个我们可以用来关联其他数据集的特征。我们克服这个问题的一个方法就是简单地找到另一个数据集。有一些我们能够使用，因为我们能够对其执行一些特征工程，以便我们在所有数据集之间有匹配的特征。</p><div class="le lf ez fb lg lh"><a href="https://github.com/Lambda-School-Labs/cityspire-b-ds/tree/main/data/raw" rel="noopener  ugc nofollow" target="_blank"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">lambda-学校-实验室/城市塔-b-ds</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">这是City Spire b .-Lambda-School-Labs/City Spire-b-ds的数据科学库</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">github.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jg lh"/></div></div></a></div><p id="846b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们面临的另一个挑战是利用FBProphet库中的Prophet模型。作为一个团队，我们决定使用Pipenv作为我们的环境变量，因为每个人都熟悉它，并且它可以很容易地在每个人的本地机器上复制。然而问题是FBProphet库无论如何都不是pip友好的。因为我决定在我们的项目中使用Prophet模型，所以我必须做出选择。要么我想办法让Prophet在我这边本地工作并创建一个临时缺口，要么我必须从头开始训练一个新模型并完全放弃Prophet模型。这两种方法各有利弊。如果我要从头开始训练一个模型，我将不得不缩小和清理我们的数据集，甚至更简单，因为我们在模型应该处理的数据上有相当大量的NaN值。这样做的好处是，它允许我的团队中的每个人都可以利用该模型，而不用担心丢失特定库中的包。</p><div class="le lf ez fb lg lh"><a href="https://facebook.github.io/prophet/docs/installation.html" rel="noopener  ugc nofollow" target="_blank"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hi fi z dy lm ea eb ln ed ef hg bi translated">装置</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">Prophet有两个实现:R和Python。请注意Python包的名称略有不同。先知是一个…</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">facebook.github.io</p></div></div><div class="lq l"><div class="lw l ls lt lu lq lv jg lh"/></div></div></a></div><p id="20dc" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">而不是通过进一步清理我们的数据集来丢失宝贵的信息。我选择使用stop gap方法，因为它在技术上可以使我们的应用程序更快，因为结果已经预先生成，我们所要做的就是创建一个方法来从我们的数据库中提取数据。为了实现这一点，我必须使用以下代码行来Conda安装FBProphet包，而不是Pip安装:</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="b432" class="ke kf hh ly b fi mc md l me mf"># Make sure you update all your base packages beforehand first.<br/>conda update --all<br/>conda install -c anaconda ephem<br/>conda install -c conda-forge pystan<br/>conda install -c conda-forge fbprophet</span></pre><p id="0c4c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">停止间隙的实际创建比3行代码稍微复杂一些。我必须重新格式化我们的数据集，以便Prophet模型能够接收数据来生成预测。然后，我必须将我们的预测与我们的原始数据集合并，这样我们就可以显示当年以及未来12个月的租赁价格。整个过程需要大约5-6个小时完成，其中大部分时间用于模型接收数据和生成预测。</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="ce72" class="ke kf hh ly b fi mc md l me mf"><strong class="ly hi">from</strong> <strong class="ly hi">fbprophet</strong> <strong class="ly hi">import</strong> Prophet<br/><strong class="ly hi">for</strong> x <strong class="ly hi">in</strong> range(2263):<br/>    df1 = rent3.loc[rent3['index'] == x][['ds', 'yhat']]<br/>    df2 = rent3.loc[rent3['index'] == x][['RegionID', 'RegionName', 'SizeRank', 'MsaName']]<br/>    df1.columns = ['ds','y']<br/>    df1['ds'] = pd.to_datetime(df1['ds'])<br/>    m = Prophet(interval_width=.95)<br/>    m.fit(df1)<br/>    future = m.make_future_dataframe(freq='MS', periods=12)<br/>    forecast = m.predict(future)<br/>    predictions = forecast[['ds', 'yhat']]<br/>    predictions['yhat'] = predictions.yhat.round()<br/>    predictions['RegionID'] = df2['RegionID'].iloc[0]<br/>    predictions['RegionName'] = df2['RegionName'].iloc[0]<br/>    predictions['SizeRank'] = df2['SizeRank'].iloc[0]<br/>    predictions['MsaName'] = df2['MsaName'].iloc[0]<br/>    predictions = predictions[['RegionID', 'RegionName', 'SizeRank', 'MsaName', 'ds', 'yhat']]<br/>    predictions.to_csv('zip_predictions.csv', mode='a', index=<strong class="ly hi">False</strong>)</span></pre><p id="aa85" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">创建停止间隙后，我们只需创建一个方法来获取已经存储在数据库中的信息:</p><pre class="ix iy iz ja fd lx ly lz ma aw mb bi"><span id="fc98" class="ke kf hh ly b fi mc md l me mf">def fetch_zip_rent():</span><span id="2830" class="ke kf hh ly b fi mg md l me mf"># List of all months in 2020 and 2021</span><span id="8d11" class="ke kf hh ly b fi mg md l me mf">rent_dates = [‘2020–01–01’, ‘2020–02–01’, ‘2020–03–01’, ‘2020–04–01’, ‘2020–05–01’, ‘2020–06–01’, ‘2020–07–01’, ‘2020–08–01’, ‘2020–09–01’, ‘2020–10–01’, ‘2020–11–01’, ‘2020–12–01’, ‘2021–01–01’, ‘2021–02–01’, ‘2021–03–01’, ‘2021–04–01’, ‘2021–05–01’, ‘2021–06–01’, ‘2021–07–01’, ‘2021–08–01’, ‘2021–09–01’, ‘2021–10–01’, ‘2021–11–01’, ‘2021–12–01’]</span><span id="6392" class="ke kf hh ly b fi mg md l me mf"># First attempt to fetch 1 record from fetch_zip_rent table with only ZIPcode values</span><span id="41f5" class="ke kf hh ly b fi mg md l me mf">SQL = f’’’SELECT “{‘“, “‘.join(rent_dates)}” FROM zip_rent WHERE “RegionName” = ‘{ZIPcode}’;’’’ results = list(conn.execute(SQL)) if len(results) == 1: return {key: value for key, value in list(zip(rent_dates, results[0]))}</span><span id="5037" class="ke kf hh ly b fi mg md l me mf"># Next attempt to fetch 1 record from zip_rent table with only City and State values</span><span id="aaa8" class="ke kf hh ly b fi mg md l me mf">SQL = f’’’SELECT “{‘“, “‘.join(rent_dates)}” FROM zip_rent WHERE “MsaName” = ‘{city+”, “+state}’;’’’ results = list(conn.execute(SQL)) if len(results) == 1: return {key: value for key, value in list(zip(rent_dates, results[0]))}</span><span id="8714" class="ke kf hh ly b fi mg md l me mf"># Finally attempt to fetch 1 record from zip_rent table with City and State and ZIPcode values</span><span id="5b40" class="ke kf hh ly b fi mg md l me mf">SQL = f’’’SELECT “{‘“, “‘.join(rent_dates)}” FROM zip_rent WHERE “MsaName” = ‘{city+”, “+state}’ AND “RegionName” = ‘{ZIPcode}’’;’’’ if len(results) == 1: return {key: value for key, value in list(zip(rent_dates, results[0]))}</span><span id="9a54" class="ke kf hh ly b fi mg md l me mf"># If the above fails then return None</span><span id="799b" class="ke kf hh ly b fi mg md l me mf">return None</span></pre><h2 id="b11a" class="ke kf hh bd kg kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky bi translated">该产品</h2><p id="bd82" class="pw-post-body-paragraph ji jj hh jk b jl kz ii jn jo la il jq jr lb jt ju jv lc jx jy jz ld kb kc kd ha bi translated">我们产品的最终结果是一款满足利益相关者期望的应用。尽管它没有我们想象的那么宏伟。它返回与用户在这类应用程序中想要的相关的所有城市指标。我们的前端和后端web开发人员制作了一个令人惊叹的用户界面，其中包括我们应用程序的地图组件以及收藏夹，允许任何用户保存他们感兴趣的特定位置。这使得我们的应用程序为用户提供了更多的视觉效果，同时也为用户提供了记录他们最喜欢的搜索的功能。总的来说，我们的应用功能包括:</p><p id="5aec" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">租赁价格(当前和未来)</p><p id="5cb2" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">犯罪率(暴力犯罪和财产犯罪)</p><p id="c4d8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">群体大小</p><p id="170e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">步行能力得分</p><p id="7c5f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">生活费用</p><p id="1d5b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">地图</p><p id="fc2a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">收藏夹选项卡</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mh mi l"/></div><figcaption class="mj mk et er es ml mm bd b be z dx translated">数据科学API演示</figcaption></figure><p id="1fa8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">截至目前，我们的应用程序是功能性的，它的工作是为任何潜在用户提供美国任何地方最重要的指标。然而，我们的应用程序仍有很大的改进空间。用于生成预测的Prophet模型可以进一步优化，以产生更准确的结果。我们还可以实现额外的功能，如空气质量和每个位置的COVID病例数。我所看到的实现这些的技术挑战将类似于我们在创建这个应用程序之初所经历的。因此，很难找到合适的数据，清理和设计数据，使其符合我们的模型，并确保您的应用程序有正确的环境变量。我从同事那里得到的一些反馈促使我有了更好的文档。这样，他们就更容易理解我想要达到的目标，这将有助于以后的扩展。这个项目教会了我很多东西，也让我对这个领域有了一个大致的了解。虽然我主要是这项任务的机器学习工程师，但我学到了从头到尾创建一个功能性应用程序的过程。这是一次宝贵的学习经历，我所共事的团队的确非常出色。</p></div></div>    
</body>
</html>