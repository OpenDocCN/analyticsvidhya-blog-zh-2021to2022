<html>
<head>
<title>Auto-Generating Chart Commentary with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python自动生成图表注释</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/auto-generating-chart-commentary-with-python-7b341515d1ab?source=collection_archive---------1-----------------------#2021-04-14">https://medium.com/analytics-vidhya/auto-generating-chart-commentary-with-python-7b341515d1ab?source=collection_archive---------1-----------------------#2021-04-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/ef96822abd9149096e5afe72349e7b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Ns7XlQWeyWs0aOOJuiMew.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">科技日报在<a class="ae it" href="https://unsplash.com/s/photos/data-chart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae it" href="https://unsplash.com/@techdailyca?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="69e7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，您已经创建了最新的漂亮的完全交互式仪表板，该仪表板将每天更新，管理层现在可以随时登录并查看他们的销售情况。然而，总有一些人讨厌图表，他们只是想在报告中得到数字，他们不会点击你的图表。那么你能做什么呢？</p><p id="d51d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">显然，我们可以每天检查并写一份关于最新变化的报告，然而，这将是非常乏味、耗时的，如果有许多图表要显示，则完全不切实际，需要大量的时间来每天更新。</p><p id="8e13" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一个简单的方法是为读者可能感兴趣的最重要的事情制定一个基本模板，然后自动从你的数据中拼凑出文本，然后可以作为“评论”添加到图表上。越是通用，就越容易做到，但是需要注意确保它实际上是相关的和有用的，否则你将不得不定期地重写这些代码。</p><p id="4498" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了证明这一点，我获得了作为简单时间序列的每日Covid19疫苗接种数据。我将它导入到一个熊猫数据框架中，并查看了前几行。在处理时间序列时，确保正确解析日期很重要(在这种情况下，使用read_csv中的‘parse _ dates’参数很容易做到)。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div class="er es jy"><img src="../Images/77e40a66f18a53a5ea7dd54a9da99375.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*gcAYDG8yf3rKlMRDkFB7jg.jpeg"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">每个国家的每日疫苗接种数据</figcaption></figure><p id="7d5e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，我将疫苗接种数字转换为百万单位，四舍五入到两位，以便稍后在图表中更具吸引力，然后通过查看并按降序排序来查找最大的国家。我们正在寻找的评论是针对最相关的数据点，我们可以即时计算这些数据点，但在这个例子中，我将只寻找最大的4个国家。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div class="er es jz"><img src="../Images/345aa2fe6bc88bf9133860d4e71b3a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*Wr9PaueAr7IZcGqCUg3odg.jpeg"/></div></figure><p id="de7f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">正如您所料，最大的国家是美国、中国、印度和英国(英国的组成部分也单独列出，因为您可以从列表中的下一个英格兰看到)，所以这些是我们将集中关注的国家，我将数据限制在2021年3月28日之前，因为这是数据集中最近的完整数字。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div class="er es ka"><img src="../Images/99e26c870e02f77fb36922648728494a.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*F5xJ-3pniGDzhIXjhaTDwA.jpeg"/></div></figure><p id="c590" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，我们需要透视数据，使每个国家都有自己的列，表中有“vaxmil”值，索引中有日期。我们还使用“fillna”方法用零替换丢失的值，这是一种假设，但这是目前我们能做到的最好的方法。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div class="er es kb"><img src="../Images/b8611f42ae910274e3b96f045b0e2211.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*lM2Edi-Bh968e73gVgoPRQ.jpeg"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">完成的数据透视表</figcaption></figure><p id="e947" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用Plotly，我们现在可以很容易地创建一个很好的时间序列图。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div class="er es kc"><img src="../Images/d8e25b0d964f4478ff083ef84b334fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*Hj25V2RLzyIg0lCNawi5BA.jpeg"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一段时间内各国每日疫苗接种数量</figcaption></figure><p id="4048" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在我们有了图表，但是我们希望生成注释来解释在过去24小时内发生了什么(在其他情况下，您可能希望与前一周的同一天、前一个月或与您的数据最相关的任何时间进行比较)。</p><p id="02bb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为此，我们需要设置一些函数。首先，我们需要从数据中找到并提取最近的行进行比较，在本例中，Timedelta是一天，但这可以根据需要进行调整。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="e544" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，我们希望能够计算每一行的总值，以及自前一天以来的变化。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="2f28" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">提取每列的当前值和先前值，并计算两者之间的差异。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="f255" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为我们的总体变更摘要创建文本。这只是一个简单的if/else语句，它查看总变化是正的、负的还是没有变化，然后将一段适当的文本附加到我们的列表中。它还将添加到我们的介绍文本中，我们将在稍后定义。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="1685" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为我们希望评论的每个国家生成文本，确保列表中最后一个国家的语法和标点正确。同样，这是一个简单的if/else语句，用于查看每个国家是增加了还是减少了。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="bbe6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我们可以在透视数据上运行我们的函数，给出一段相关的文本来开始我们的注释，并生成所需的文本。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kd"><img src="../Images/d6b5d5e5449917075035e2d7e3ec7ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2r6mEfocJWaxWLNmGpHyg.jpeg"/></div></div></figure><p id="271b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于我们的函数是通过将每个相关的文本片段追加到一个列表中来工作的，所以我们现在只需要使用join方法将它们全部合并到一个字符串中，在每个文本片段之间放置一个空格。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><figure class="js jt ju jv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ke"><img src="../Images/da3df35e41de8cba5f6a4760c4f1c145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zI6oxorSIa5o08SPvtUdA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">我们的最终文本</figcaption></figure><p id="9056" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们已经看到，使用一些简单的Python代码，我们可以生成一段有意义的文本，总结数据中最重要的变化。这可以进一步发展，使其更加灵活和强大，例如，关于增加/减少是积极的还是消极的，变化是大还是小，重要还是不重要，等等。这将需要一些工作来设置，但希望节省每天手动编写评论来总结变化的时间。</p></div></div>    
</body>
</html>