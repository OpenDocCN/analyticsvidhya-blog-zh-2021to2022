<html>
<head>
<title>CloudSQL to BigQuery — Federated Queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CloudSQL到BigQuery —联邦查询</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/cloudsql-to-bigquery-federated-queries-e2b595179abc?source=collection_archive---------6-----------------------#2021-06-18">https://medium.com/analytics-vidhya/cloudsql-to-bigquery-federated-queries-e2b595179abc?source=collection_archive---------6-----------------------#2021-06-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/53a102ee5e13ffeb56f16d636eb8a813.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*csaO5Hkx6rrEf2AQ0BE3FQ.jpeg"/></div></figure><p id="a23c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">无论您是开发BI仪表板还是分析数据以做出关键的业务决策，您都需要从各种数据集市、数据仓库或事务数据库中访问数据，以便根据需要执行聚合或导出统计数据以生成报告。</p><p id="9ef7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您使用BigQuery作为数据仓库，使用CloudSQL作为RDBMS，那么您通常需要确定一种方法来访问数据以满足您的分析需求。</p><p id="d4a3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一种方法是通过编写来自BigQuery的<strong class="io hj">联邦查询</strong>，其中CloudSQL被视为数据的<strong class="io hj">外部源</strong>，并且您将查询包含在函数<code class="du jk jl jm jn b">EXTERNAL_QUERY.</code>中</p><p id="a713" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是一个示例联邦查询的样子:</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="44ea" class="jw jx hi jn b fi jy jz l ka kb">SELECT * FROM EXTERNAL_QUERY <br/>("test-fedquery-mysql", "SELECT customer_id, MIN(order date) AS first_order_date<br/> FROM orders<br/> GROUP BY customer_id;");</span></pre><ul class=""><li id="9ca0" class="kc kd hi io b ip iq it iu ix ke jb kf jf kg jj kh ki kj kk bi translated">我在函数<code class="du jk jl jm jn b">EXTERNAL_QUERY</code>中包含了我的查询</li><li id="743d" class="kc kd hi io b ip kl it km ix kn jb ko jf kp jj kh ki kj kk bi translated"><code class="du jk jl jm jn b">test-fedquery-mysql</code>是我们在BigQuery中创建的用于访问CloudSQL的<strong class="io hj">connection _ id(or)connection _ name</strong>。</li></ul><p id="286a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">在创建连接之前:</strong></p><ol class=""><li id="f355" class="kc kd hi io b ip iq it iu ix ke jb kf jf kg jj kq ki kj kk bi translated">请确保启用了BigQuery连接API。</li><li id="925f" class="kc kd hi io b ip kl it km ix kn jb ko jf kp jj kq ki kj kk bi translated">为您的CloudSQL实例配置<strong class="io hj">公共IP连接</strong>。这使得BigQuery能够根据需要访问实例和查询数据。</li></ol><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kr"><img src="../Images/148da3a227ede16edb9f361a6e3755af.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*GbCRPeVo1Cb8UjucxOMZHA.png"/></div></figure><p id="48d9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">使用控制台从BigQuery创建连接:</strong></p><ol class=""><li id="ecbb" class="kc kd hi io b ip iq it iu ix ke jb kf jf kg jj kq ki kj kk bi translated">导航到BigQuery，单击“添加数据”并选择“外部数据源”</li></ol><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/180140b3356f6ad1df6f2a16e612bb2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*zgjH72i19WqDvICrT3zmOg.png"/></div></figure><p id="8037" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.在适当的字段中输入正确的信息。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/49be4549de2eb0869a955a0af0b8848d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*AV4XM4rm5Nj9bXwUOqOiMg.png"/></div></figure><p id="f7a0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可以从SQL实例页面复制<strong class="io hj">云SQL实例ID </strong>。寻找<strong class="io hj">连接名称。</strong></p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ku"><img src="../Images/e89557d850dbcf2d5e54b8a9bb1ba7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6n-GFyOg3Cbn3V01pRk3Q.png"/></div></div></figure><p id="f853" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">创建实例后，它会出现在固定项目中的“外部连接”下。</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/f7057e3dca47c1e362c7fc3d087fcd83.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*ACA7wrJhD5BlN4GBGkCcmQ.png"/></div></figure><p id="32b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">瞧啊。！现在可以从BigQuery对云SQL运行联邦查询。</p><p id="7058" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">使用CLI创建连接</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="af9c" class="jw jx hi jn b fi jy jz l ka kb">bq mk \<br/> — connection \<br/> — connection_type=’CLOUD_SQL’ \<br/> — properties=’{“instanceId”:”famous-vista-310604:us-central1:trans-int-sub-us1b”,”database”:”transactiondb”,”type”:”MYSQL”}’ \<br/> — connection_credential=’{“username”:”trans-db-analytical”, “password”:”*******”}’ \<br/> — project_id=famous-vista-310604 \<br/> — location=US \<br/> test-fedquery-mysql</span></pre><p id="bd29" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下面是一个列出数据库<code class="du jk jl jm jn b">transactiondb</code>中所有表格的例子</p><pre class="jo jp jq jr fd js jn jt ju aw jv bi"><span id="bf8c" class="jw jx hi jn b fi jy jz l ka kb">SELECT * FROM EXTERNAL_QUERY<br/>(“test-fedquery-mysql”,”select * from information_schema.tables;”);</span></pre><p id="7ecb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">记住:</strong></p><ol class=""><li id="0fca" class="kc kd hi io b ip iq it iu ix ke jb kf jf kg jj kq ki kj kk bi translated">联邦查询只能在同时支持云SQL和BigQuery的区域中执行。</li><li id="b6a8" class="kc kd hi io b ip kl it km ix kn jb ko jf kp jj kq ki kj kk bi translated">通过向特定用户授予权限，可以限制对连接的访问。</li><li id="8afa" class="kc kd hi io b ip kl it km ix kn jb ko jf kp jj kq ki kj kk bi translated">BigQuery通常预测编写查询时处理的数据量。这在查询CloudSQL时是不可用的。</li><li id="7d89" class="kc kd hi io b ip kl it km ix kn jb ko jf kp jj kq ki kj kk bi translated">联合查询的计费方式与本地查询相同(按需定价或按使用量付费)。</li><li id="a8a6" class="kc kd hi io b ip kl it km ix kn jb ko jf kp jj kq ki kj kk bi translated">您可以像调度本地查询一样调度联邦查询。</li></ol></div></div>    
</body>
</html>