<html>
<head>
<title>Out from the Cold — A Simple Guide To Avoiding Cold Boots by Warming Your AWS Lambda Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">远离寒冷——通过加热AWS Lambda功能避免寒冷的简单指南</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/out-from-the-cold-a-simple-guide-to-avoiding-cold-boots-by-warming-your-aws-lambda-functions-66af38f286a0?source=collection_archive---------10-----------------------#2021-02-03">https://medium.com/analytics-vidhya/out-from-the-cold-a-simple-guide-to-avoiding-cold-boots-by-warming-your-aws-lambda-functions-66af38f286a0?source=collection_archive---------10-----------------------#2021-02-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/dd38d16ae679fe1451199d816c2ade12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*piHox7Pi5Wsxykf5OiYLAQ.jpeg"/></div></div></figure><p id="d9e9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">已经有很多文章讨论了如何优化AWS Lambda函数，使其运行得更快，并避免可怕的“冷启动”场景。尽管亚马逊技术支持者报告说<a class="ae jn" href="https://www.jeremydaly.com/lambda-warmer-optimize-aws-lambda-function-cold-starts/" rel="noopener ugc nofollow" target="_blank">极少数的函数调用实际上是冷启动的(大约0.2%)。也就是说，我遇到过很多情况，在这些情况下，你肯定会遇到很多冷门，最好还是避开它们:</a></p><ol class=""><li id="e915" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">小项目或有几个功能的原型，所有这些都可以在不同的间隔时间调用。即使你修补的东西永远不会见天日，等待Lambdas旋转起来会很快变得乏味。</li><li id="c63b" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">你已经建立了一个作品集或演示网站，你正在申请一份工作。如果你想用你做的一些很酷的东西给人留下一个好印象，最好通过长时间展示一个负载微调器来避免破坏它。</li><li id="1bca" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">人们经常提到冷启动等待时间只有几秒钟，但我从来没有这样的经历。对我来说，我经常花5-6秒钟等待我的Lambda从床上滚下来，然后去工作。</li></ol><p id="1446" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">记住这些相当轻量级的场景，让我们深入到一个简单、直接的方法来温暖你的羔羊。</p><h1 id="9780" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">强制性的开场白</h1><p id="40a9" class="pw-post-body-paragraph ip iq hh ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm ha bi translated">简单地说，“冷启动”是Lambda函数的第一次缓慢启动。</p><p id="fb62" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在该功能最初“启动”后，它可以在更快的基础上可用，直到Lambda长时间未被使用(或者数据中心被小行星撞击)。在这段延长的时间(或不幸的天体之怒)之后，Lambda功能被破坏，因此整个冷启动过程必须再次启动。</p><p id="32a8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">“预热”一个函数就是按照设定的时间表以编程方式调用它，这样你就不会让驱动Amazon Lambda基础设施的小精灵破坏你的Lambda环境。这使功能保持在快速响应的状态，所以你的应用程序，网站，或任何东西保持活力。</p><h1 id="f721" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">保暖守则</h1><p id="68af" class="pw-post-body-paragraph ip iq hh ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm ha bi translated">在我们深入研究代码之前，首先让我们了解一些简单而优秀的暖羊基本规则:</p><ol class=""><li id="f36d" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated"><strong class="ir hi">不要调用整个函数</strong>——你应该直接在你的函数中编写一个非常短、快速的逻辑路径来预热函数。如果你有一个带有DB调用的Lambda，对其他Lambda的后续调用，或者任何繁重的事情，节省计算时间，尽可能高效和廉价地进行更温暖的调用。</li><li id="eee6" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">尽可能稀疏地预热</strong> —如果您将预热间隔设置为大约5分钟，您将确保您的功能始终为准时响应做好准备，但您也不会不必要地增加基础设施的负担。</li><li id="e497" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">靠近源</strong>——如果你有一个Lambda，它被调用到它上面的其他基础设施的栈下(最常见的例子是API网关)，避免调用栈顶的函数。任何像这样的循环作业都应该调用尽可能接近Lambda本身的函数。</li></ol><p id="f6a3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首要任务是如何告诉你的功能你只是在升温。如果你的功能不知道什么时候只是预热而不是完全运行，你就不能遵守我们的第一条基本原则。最简单的方法是将一个布尔或位传递给所有Lambdas接收的事件对象。通过这种方式，该功能知道如何短路其完整运行，并尽可能快地返回，以保持您的微服务活跃和温暖。我们一会儿将讨论这将如何工作的细节。</p><p id="37c8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好了，代码时间！下面是一个非常简单的例子，您接收一个小部件ID，然后返回一个相关的小部件列表:</p><figure class="lf lg lh li fd ii"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="db3b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如您所见，在第4行，我们立即处理了预热逻辑，以防止任何潜在的高成本操作被执行。鉴于云技术在很大程度上是基于I/O操作或计算时间，这可能会在未来为我们节省大量资金或成本。如果我们没有传入一个预热调用，那么该函数将正常执行。</p><p id="7925" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我假设你已经知道了如何部署和测试Lambda的基本知识。但是因为我说过这是一个简单的指南，所以我想尽可能简单地修改我的例子。如果我想在本地测试这个函数以确保逻辑正常工作，我可以简单地在函数的底部添加以下内容:</p><pre class="lf lg lh li fd ll lm ln lo aw lp bi"><span id="4216" class="lq kd hh lm b fi lr ls l lt lu">context= ''</span><span id="d6be" class="lq kd hh lm b fi lv ls l lt lu">event={'warmer': 1 }</span><span id="597d" class="lq kd hh lm b fi lv ls l lt lu">print(getWidgets(event, context))</span></pre><p id="715b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">类似地，更改我的事件字典使warmer等于0将调用完整的函数(在您的情况下，这将失败，除非您绝对<em class="lw">喜欢</em>设置DynamoDB实例，在这种情况下，金星🌟).</p><h1 id="b329" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">让我们加热一个λ</h1><p id="25b1" class="pw-post-body-paragraph ip iq hh ir b is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji le jk jl jm ha bi translated">现在是时候在AWS中实际设置升温机制，并触及我们的最后两条基本规则。我将假设您已经知道如何以多种可用的方式部署Lambda。如果你不知道，那就留言说“嘿，肖恩，你的穴居人大脑和6年级的写作能力对我来说有点意义——请写一篇关于部署Lambdas的文章。”</p><p id="d9c1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们已经部署了我们的功能，让我们对它进行测试，以确保我们可以在没有AWS基础设施设置的情况下预热它。如果我们的代码或lambda部署有问题，这可以让我们省去很多麻烦，但我们可以在没有测试的情况下开始其他基础设施。让我们进入AWS控制台上的Lambda并设置一个新的测试，只粘贴这个简单的JSON。</p><pre class="lf lg lh li fd ll lm ln lo aw lp bi"><span id="74ad" class="lq kd hh lm b fi lr ls l lt lu">{ “warmer”: 1 }</span></pre><p id="249d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设运行正常，函数返回“warmed”——让我们配置真实的东西。为此，我们需要前往云观察&gt;事件&gt;规则。现在让我们创建一个新规则。这里有很多内容需要填充和讨论，但我会尽量简短。确保您选择了一个Lambda函数作为您的目标，并将您刚刚粘贴的JSON提供给它，以进行我们的测试。你可以选择你的API网关或者你的Lambda栈中更高的东西，但是以免我们忘记前面提到的规则3。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/6c78208effa271b23b540b3d7c704101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hA01uQeu-UjZQxBHAc7g7w.png"/></div></div></figure><p id="5199" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">除此之外，其余的设置应该相当简单。根据规则2，我们只想在5分钟内热身。这应该足够频繁，并保存您的活动，确保它是活跃的…祝贺！你现在正在加热你的λ。</p></div><div class="ab cl ly lz go ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ha hb hc hd he"><p id="470d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="lw">感谢阅读！请在下面留下改进建议、评论或批评。如果你觉得特别书呆子气，</em> <a class="ae jn" href="https://www.linkedin.com/in/sean-drummy-a6b6774/" rel="noopener ugc nofollow" target="_blank"> <em class="lw">在LinkedIn </em> </a> <em class="lw">上联系我。</em></p></div></div>    
</body>
</html>