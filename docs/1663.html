<html>
<head>
<title>How To Deploy Digit Recognition Model Into Drawing App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将数字识别模型部署到绘图应用中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-deploy-digit-recognition-model-into-drawing-app-6e59f82a199c?source=collection_archive---------6-----------------------#2021-03-12">https://medium.com/analytics-vidhya/how-to-deploy-digit-recognition-model-into-drawing-app-6e59f82a199c?source=collection_archive---------6-----------------------#2021-03-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="f029" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用flask将您的Python数字识别神经网络模型部署到web HTML5绘图应用程序中</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/14fa7e6e25b7f4537fb60b97a9062451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5LpVmISSiaUAQnfd"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">由<a class="ae jm" href="https://unsplash.com/@cgower?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯多夫·高尔</a>在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="065b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你好。在这篇文章中，我将指导你如何创建人工智能来检测手写数字，并创建web绘图应用程序作为用户界面。做这篇文章的直觉是因为我在网上找到了很多教我如何创建一个人工智能模型的教程，但直到创建了一个应用程序。我希望这篇文章能对你寻找全面的指南有所帮助。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kj"><img src="../Images/adb1227487410ce50669867185248f3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*iAOMuPMGqsLATlW4ZZXJUg.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">应用演示</figcaption></figure><h2 id="8f95" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">为什么要创建应用程序？</h2><p id="ee23" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">人工智能最终的结果应该是一个产品。在这种情况下，我们的产品是一个绘图应用程序，具有使用人工智能模型本身检测手写数字的功能。这将是不现实的项目，如果我们的最终产品使用终端作为界面，所以使一个应用程序将是一个有效的投资组合。</p><h2 id="0be0" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">应用程序工作流程</h2><p id="bc84" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">我们将建立后端和前端应用程序。解释复杂过程的最佳方式是通过可视化。为了更好地交流，我制作了这些工作流程图。我们将在客户端使用javascript构建绘图应用程序，在后端使用python进行处理和预测。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es lk"><img src="../Images/984ef1a1646ddeb3ad361612770a5f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*VMInTcEqy4GXtpItov49Fw.jpeg"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">应用程序工作流程图</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es ll"><img src="../Images/a71a0e8331b830f0697e26c1ee1d92ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*yLP-7f4H5PVArLZGMDJ2ww.jpeg"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">后端工作流程图</figcaption></figure><p id="3d62" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">Tensorflow，Flask，Opencv，sklearn和numpy都是我们在这个项目中需要的python库。我建议使用虚拟环境，如venv或virtualenv，因为我们的计算机中可能有不同版本的库用于不同的项目。</p></div><div class="ab cl lm ln go lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ha hb hc hd he"><h2 id="1bd1" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">步骤#1:创建模型</h2><p id="b236" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">第一步是使用Keras创建分类模型。MNIST手写是许多神经网络入门教程中常用的数据集。使用顺序API，你可以很容易地创建神经网络(NN)。没有必要创建复杂的神经网络，但如果你想获得最大的性能，那么使用卷积神经网络(CNN)这是很好的图像分类。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lt lu l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">MNIST手写数字分类模型的建立</figcaption></figure><p id="5a09" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在序列神经网络中，我使用输入形状为(28，28，)的展平层。<strong class="jp hi">一定要在最后一个元组加逗号，而不仅仅是(28，28) </strong>。因为(28，28)是图像大小，最后一个元组中的逗号将是我们的训练数据量。如果您尝试使用<code class="du lv lw lx ly b">print(x_train.shape)</code>，形状将会是(60000，28，28 ),因为我们有60000个大小为28 x 28的训练图像。</p><p id="85d4" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你可以把上面的代码复制粘贴到google colab，jupyter notebook，或者pycharm。<code class="du lv lw lx ly b">model.save(filename.h5)</code>将把模型存储在这个程序运行的同一个目录中，但是如果你使用google colab，你应该下载. h5模型。您可以随意命名该文件，但它应该以. h5文件扩展名结尾。如果你对模型表现满意，那么你可以进入下一步。</p><h2 id="52bd" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">步骤2:创建烧瓶应用程序</h2><p id="1b8f" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">创建flask应用程序来处理来自前端的用户请求，并使用模板引擎呈现html。创建新的文件夹应用程序，并在其中创建名为<code class="du lv lw lx ly b">main.py</code>的新文件。另外，将您的model .h5文件移动到app文件夹中。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="fe50" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">从前端接收base64数据后，我们需要将图像从3通道转换为1通道(在第30行),因为我们在1通道图像上训练模型。我们从前端收到的图像有3个通道(RBG)，形状为(280，280，3)，我们将其转换为(280，280)。</p><p id="145b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们需要将图像的大小调整为28 x 28(在第33行)。我们需要调整图像的大小，因为我们的原始尺寸是280 x 280。您可以检查宽度和高度为280的canvas标签(在第43行)。请记住，我们的模型是使用28 x 28的图像训练的，所以如果我们想要预测任何图像，我们需要将大小调整为28 x 28。还要将数组维数从(28，28)扩展到(1，28，28)，因为数字1意味着我们有1个大小为28 x 28的图像。</p><h2 id="8649" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">步骤3:创建绘图应用程序</h2><p id="9f20" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">我们将使用HTML5画布来创建一个简单的工作绘图应用程序，它可以用来用鼠标写数字。然后我们可以将base64图像数据发送到我们的服务器。在应用程序文件夹中创建名为templates的新文件夹，然后创建名为drawing.html的新文件</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="1a39" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">请看一下html文件中的<code class="du lv lw lx ly b">{% %}</code>和<code class="du lv lw lx ly b">{{ }}</code>标签。这是flask的模板引擎，可以用来为用户视图添加逻辑。我们使用这些逻辑来显示来自后端的预测结果。</p><p id="9a8a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">HTML文件中的script标签是一个客户端javascript，用于通过监听鼠标与canvas进行交互，并进行绘制和擦除。此外，当用户单击检测按钮时，javascript会将画布转换为base64图像</p><h2 id="8283" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">步骤4:部署</h2><p id="9967" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">现在我们的应用程序运行良好，下一步是将应用程序部署到heroku。转到heroku dashboard，用您想要的名称创建新应用程序。转到设置，复制git的网址，并按照这些步骤。</p><ol class=""><li id="0d56" class="lz ma hh jp b jq jr jt ju jw mb ka mc ke md ki me mf mg mh bi translated">使用<code class="du lv lw lx ly b">git init</code>在项目目录中初始化git，</li><li id="37cf" class="lz ma hh jp b jq mi jt mj jw mk ka ml ke mm ki me mf mg mh bi translated">使用<code class="du lv lw lx ly b">git add .</code>然后<code class="du lv lw lx ly b">git commit -m “Your message”</code>提交您的更改</li><li id="936c" class="lz ma hh jp b jq mi jt mj jw mk ka ml ke mm ki me mf mg mh bi translated">使用<code class="du lv lw lx ly b">git branch -M master</code>将主分支设置为主控</li><li id="9099" class="lz ma hh jp b jq mi jt mj jw mk ka ml ke mm ki me mf mg mh bi translated">使用<code class="du lv lw lx ly b">git remote add heroku your_heroku__git_app_url</code>将heroku remote添加到您的git存储库中</li></ol><blockquote class="mn mo mp"><p id="db80" class="jn jo mq jp b jq jr ii js jt ju il jv mr jx jy jz ms kb kc kd mt kf kg kh ki ha bi translated"><strong class="jp hi">注:</strong>master分支的最新名称是main，但heroku仍然使用master作为主分支的名称。你可以随意命名主分支</p></blockquote><p id="e90f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在主/根项目目录中创建<code class="du lv lw lx ly b">wsgi.py</code></p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="ad89" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在主/根项目目录中创建<code class="du lv lw lx ly b">Procfile</code>。请注意，该文件没有扩展名，并以大写字符开头。这是Procfile中的内容。</p><pre class="ix iy iz ja fd mu ly mv mw aw mx bi"><span id="e31e" class="kk kl hh ly b fi my mz l na nb">web: gunicorn wsgi:app</span></pre><h2 id="3f28" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">完整的目录树</h2><pre class="ix iy iz ja fd mu ly mv mw aw mx bi"><span id="68a9" class="kk kl hh ly b fi my mz l na nb">Digit Recognition Application<br/>│<br/>│   Procfile<br/>│   wsgi.py<br/>│<br/>├───app<br/>│   │   ai.h5<br/>│   │   main.py<br/>│   │<br/>│   └───templates<br/>│          drawing.html<br/>│          home.html<br/>│<br/>└───static<br/>        script.js<br/>        style.css</span></pre><p id="d667" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">现在你已经设置好了，首先通过运行你的wsgi文件<code class="du lv lw lx ly b">pthon wsgi.py</code>或者运行<code class="du lv lw lx ly b">flask run</code>，开始在你的本地应用中测试你的应用。该应用程序第一次启动时可能会很慢，特别是因为tensorflow需要相当长的时间。一旦启动，您应该会看到类似这样的内容。</p><pre class="ix iy iz ja fd mu ly mv mw aw mx bi"><span id="5b1f" class="kk kl hh ly b fi my mz l na nb">* Running on <a class="ae jm" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/</a> (Press CTRL+C to quit)</span></pre><p id="7dbb" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在你的浏览器中找到那个网址，你应该会看到你的应用程序。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nc"><img src="../Images/bb4671b549072822487b751b75ead3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIE19KFo8lcnBn0SH3qWZw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">数字识别器应用程序演示</figcaption></figure><p id="c4e5" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在确保本地主机一切正常后，我们可以将我们的项目部署到heroku以供公众在线访问。<code class="du lv lw lx ly b">git add .</code>跟踪存储库中的所有内容，然后由<code class="du lv lw lx ly b">git commit -m "your commit message"</code>提交。最后使用<code class="du lv lw lx ly b">git push heroku master</code>将你的代码推入heroku，因为主分支是你的主分支，而heroku是你的heroku远程url。如果该过程成功并且没有显示错误，这意味着您的网站已成功部署。</p></div><div class="ab cl lm ln go lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ha hb hc hd he"><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nd"><img src="../Images/ade0fb91118558597d76220fd71d51cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WDBgwBwEXhWGvK2W"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">布鲁斯·马尔斯在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="6ccc" class="kk kl hh bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">解决</h2><p id="906b" class="pw-post-body-paragraph jn jo hh jp b jq lf ii js jt lg il jv jw lh jy jz ka li kc kd ke lj kg kh ki ha bi translated">祝贺您，您的网站已成功部署，在与您的同事分享之前，请访问该网站以确保一切正常。这就是全部，你有完全使用人工智能的绘图应用程序。请注意，您仍然可以通过添加额外的功能来改进应用程序，如使其实时检测。您还可以使用可视化库在前端创建预测概率的可视化。</p><p id="e5f8" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你也可以访问我的Github库来获取材料和例子<a class="ae jm" href="https://github.com/PhilipPurwoko/NumberRecognition" rel="noopener ugc nofollow" target="_blank">https://github.com/PhilipPurwoko/NumberRecognition</a></p><p id="7299" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">也可以阅读我的另一篇文章来获得更多的资料和教程</p><div class="ne nf ez fb ng nh"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/how-to-make-mask-detection-ai-using-python-in-6-steps-157696e84871"><div class="ni ab dw"><div class="nj ab nk cl cj nl"><h2 class="bd hi fi z dy nm ea eb nn ed ef hg bi translated">如何用6个步骤用Python制作掩膜检测AI</h2><div class="no l"><h3 class="bd b fi z dy nm ea eb nn ed ef dx translated">使用keras一步一步创建面具检测人工智能的综合指南</h3></div><div class="np l"><p class="bd b fp z dy nm ea eb nn ed ef dx translated">medium.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv jg nh"/></div></div></a></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nw"><img src="../Images/6ae3a71791a7594e4264c9430e529168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*MWjKxkgnI_CXEfZRx-GO8Q.jpeg"/></div></figure></div></div>    
</body>
</html>