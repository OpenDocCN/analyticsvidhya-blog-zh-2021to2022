<html>
<head>
<title>Web Scraping NBA Data with Pandas, BeautifulSoup, and RegEx (Pt. 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用熊猫、BeautifulSoup和RegEx (Pt。2)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/web-scraping-nba-data-with-pandas-beautifulsoup-and-regex-pt-2-fa0e4c1a16fa?source=collection_archive---------10-----------------------#2021-01-08">https://medium.com/analytics-vidhya/web-scraping-nba-data-with-pandas-beautifulsoup-and-regex-pt-2-fa0e4c1a16fa?source=collection_archive---------10-----------------------#2021-01-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/bd3dc262cf25e24d4fd50896ad750222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EM5dASMdqM5NkAGq.png"/></div></div></figure><p id="785d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在开始阅读这篇文章之前，如果你还没有阅读过，我推荐你阅读一下这个系列的第一部分。在第一部分中，我解释了我从<a class="ae jn" href="https://www.basketball-reference.com/" rel="noopener ugc nofollow" target="_blank"> Basketball-Reference </a>中为2020–2021华盛顿奇才队收集数据并将其重组为Python中可操作的数据框架的过程。下面是我结束时的代码和输出:</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ju"><img src="../Images/ff991412ff7254bc1a1b1e6925b0e93f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*02HBaomPpdNKnjdK.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">上述代码的输出—2020–2021华盛顿奇才队的熊猫数据框架</figcaption></figure><p id="6135" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇文章中，我将扩展上述数据框架，以包括所有现役NBA球员。然后，我将创建一个函数，用户输入年份，该函数输出该赛季所有NBA球员的数据帧。最后，我将对我们的新数据进行一些探索性的数据分析。</p><p id="68fa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">第一步是将必要的库导入Python，如下所示(我在<a class="ae jn" href="https://gabe-cano.medium.com/web-scraping-nba-data-with-pandas-beautifulsoup-and-regex-pt-1-e3d73679950a" rel="noopener">第一部分</a>中简要解释了这些库的功能)。</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="cafe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了获得每个NBA球队的球员数据，而不仅仅是奇才队，我需要每个球队网页的URL结尾。幸运的是，这些URL结尾可以在<a class="ae jn" href="https://www.basketball-reference.com/" rel="noopener ugc nofollow" target="_blank"> Basketball-Reference主页</a>的一个名为“Select Team Page”的下拉菜单中找到，如下图所示。人们可以从HTML(在第一个绘制的红色框内)中看到，团队名称在带有<code class="du jz ka kb kc b">id="teams"</code>的<code class="du jz ka kb kc b">div</code>标签下。</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kd"><img src="../Images/64ef91cfa23d957ed2f3eede6568949b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pf7d-husFks7rKzAuwrhg.png"/></div></div></figure><p id="8c70" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了分离出我想要关注的HTML文本，我将使用<code class="du jz ka kb kc b">requests</code>和<code class="du jz ka kb kc b">BeautifulSoup</code>从主页获取并解析所有的HTML。然后我将创建一个变量<code class="du jz ka kb kc b">select_team</code>，用<code class="du jz ka kb kc b">id = "teams"</code>将HTML缩小到<code class="du jz ka kb kc b">div</code>，如下面的代码所示。</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="a57f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<code class="du jz ka kb kc b">select_team</code>中，每个团队都包含在一个<code class="du jz ka kb kc b">option</code>标签中，我们想要的URL结尾在<code class="du jz ka kb kc b">value</code>属性中(参考上面截图中的红框)。为了获得所有这些URL结尾，我将创建一个名为<code class="du jz ka kb kc b">team_list</code>的列表，并从选项2到31迭代追加<code class="du jz ka kb kc b">value</code>属性(第一个选项只是下拉菜单的‘Choose a team’标题)。</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="63dd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du jz ka kb kc b">team_list[0:3]</code>(列表中的前三个元素)的输出如下所示:</p><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es ke"><img src="../Images/4a17dc850d53d84485f0f59823a56ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*Z_-bMyvIj6hLy33tlHh04w.png"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">亚特兰大老鹰队，波士顿凯尔特人队和布鲁克林篮网队篮球的URL结尾-参考页面</figcaption></figure><p id="9dc4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">回想一下我们在上一篇<a class="ae jn" rel="noopener" href="/analytics-vidhya/web-scraping-nba-data-with-pandas-beautifulsoup-and-regex-pt-1-e3d73679950a">帖子</a>中留下的代码，它涉及到从Basketball-Reference的向导URL中抓取数据，隔离每场比赛的表格(名为<code class="du jz ka kb kc b">wiz_per_game</code>)，并在一个<code class="du jz ka kb kc b">for</code>循环中迭代地添加每个球员的数据。要包含所有NBA球队，我们所要做的就是将这个<code class="du jz ka kb kc b">for</code>循环嵌套在另一个<code class="du jz ka kb kc b">for</code>循环中，该循环遍历每个球队的URL。一种进一步发展这一概念的方法是将代码变成一个函数，用户输入年份，函数输出该特定赛季的球员信息。</p><p id="e2f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在下面的代码中，第一个<code class="du jz ka kb kc b">for</code>循环为<code class="du jz ka kb kc b">team_url</code>分配了<a class="ae jn" href="https://www.basketball-reference.com/" rel="noopener ugc nofollow" target="_blank"> Basketball-Reference </a>基本URL，只是现在它插入了以<code class="du jz ka kb kc b">team_list</code>结尾的球队URL，以及函数中的<code class="du jz ka kb kc b">year</code>参数。接下来的嵌套<code class="du jz ka kb kc b">for</code>循环添加了每个玩家的信息，就像之前向导代码所做的一样。一旦嵌套的<code class="du jz ka kb kc b">for</code>循环完成了一次迭代，函数就从最初的<code class="du jz ka kb kc b">for</code>循环开始，继续下一个团队。</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="840a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用' 2021 '调用上面的函数应该会输出下面的数据帧，其中包含当前赛季网站上列出的所有442名NBA球员的数据:</p><p id="c5a9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du jz ka kb kc b">all_nba_players_2021 = get_stats(2021)<br/>all_nba_players_2021</code></p><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kf"><img src="../Images/d4b9f42d7e7607fa295c74a19bd46d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJdTYDdvKihUY_qre5xBJQ.png"/></div></div></figure><p id="58b3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">太神奇了！在我们对所有这些统计数据进行数据分析之前，需要将数字列从<code class="du jz ka kb kc b">object</code>类型更改为<code class="du jz ka kb kc b">float</code>或<code class="du jz ka kb kc b">int</code>类型。运行下面的函数为我们完成了这一转换工作，并打印出每一列的dtype，以确保它得到了适当的更改。</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kg"><img src="../Images/4cb903f56aec813f805c3a30db974996.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*o0fjD4wW_Zbl_nPurabFdg.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">根据格式，高度是一个对象，即“6–10”。人们可以创建一个函数，将符号转换成只有英寸或厘米的整数。</figcaption></figure><h1 id="4b49" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated"><strong class="ak">探索性数据分析</strong></h1><p id="c447" class="pw-post-body-paragraph ip iq hh ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">现在我们已经有了2020-2021赛季每一位NBA球员的信息，我们可以检查一些数据了！<code class="du jz ka kb kc b">pandas</code>、<code class="du jz ka kb kc b">matplotlib</code>和<code class="du jz ka kb kc b">seaborn</code>是强大的数据操作/可视化工具，提供了本质上无限的探索途径。下面是一些将它们用于<code class="du jz ka kb kc b">all_nba_players_2021</code>的例子。</p><p id="aebf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用一些简单的<code class="du jz ka kb kc b">pandas</code>过滤，我可以找到所有活塞球员投篮命中率在40%或以下的信息:</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/c1cd7bef1460f911b848bda9c2d7f68b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uwoct78X2O9r1QMqCTZEUQ.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">现在说基利安·海耶斯破产还为时过早吗？？</figcaption></figure><p id="55aa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">比方说，我想根据球员的总重量以及球队的总重量，找出前十名最轻的NBA球队。来自<code class="du jz ka kb kc b">pandas</code>的<code class="du jz ka kb kc b">groupby</code>方法完成了这个请求:</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es ll"><img src="../Images/399207c9baa183b5a35fb92337f52d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:294/format:webp/1*Cyt3ewiv-Z6fBQ8uIk_8Tg.png"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">火箭喜欢他们的小球阵容！</figcaption></figure><p id="ef8b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了更好地了解联盟中玩家每场比赛的上场时间，我可以使用<code class="du jz ka kb kc b">seaborn</code>和<code class="du jz ka kb kc b">matplotlib</code>用直方图来可视化这个指标:</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/b4f8a172fb8dddb63a3dc991040b9e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*RJWv_YpiWgONBiPBIr6I2A.png"/></div></div></figure><p id="8abe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，<code class="du jz ka kb kc b">seaborn</code>还包括一个散点图，有助于观察不同变量之间的关系。让我们试着用“最小PG”和“失误PG”做一个散点图:</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><figure class="jo jp jq jr fd ii er es paragraph-image"><div class="er es ln"><img src="../Images/b3f641ffa990107039d1ef9102966f98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*H3p-sNDKme99xmDYcIc_ZA.png"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">这两个变量之间有一个稍微正的线性关系，这在直觉上是有一定道理的——一个人上场时间越长，失误的机会就越多。请注意，存在某些异常值！</figcaption></figure><p id="07fb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">显然，我只是触及了在<code class="du jz ka kb kc b">all_teams_2021</code>上利用这些Python库所能获得的洞察力的表面。人们还可以使用我的<code class="du jz ka kb kc b">get_stats</code>功能来制作多个NBA赛季的数据帧，并将它们合并在一起，以确定多年的趋势，甚至创建一些预测模型。</p><p id="ce0c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">除了<a class="ae jn" href="https://www.basketball-reference.com/" rel="noopener ugc nofollow" target="_blank">篮球参考</a>之外，互联网显然掌握着深不可测的大量数据。配备了现代网络抓取和数据分析/建模工具，数据科学家真正受到限制的只是他们的好奇心和创造力的天花板。</p></div></div>    
</body>
</html>