<html>
<head>
<title>Python Code on Holt-Winters Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">霍尔特-温特斯预测的Python代码</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/python-code-on-holt-winters-forecasting-3843808a9873?source=collection_archive---------0-----------------------#2021-01-05">https://medium.com/analytics-vidhya/python-code-on-holt-winters-forecasting-3843808a9873?source=collection_archive---------0-----------------------#2021-01-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f440" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">耐心是这里唯一的先决条件。</p><p id="f1cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你在这里，我很高兴，如果你对霍尔特-温特斯指数平滑一无所知，请在这里查看这篇文章，</p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/@etqadkhan23/holt-winters-forecasting-13c2e60d983f"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">霍尔特-温特斯预测</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">昨天是一个寒冷的冬夜，我在Brooklyn99上大吃大喝，那时我想我可以写一篇简短的…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="c485" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将是一个很好的起点，可以帮助你理解它的基本概念。去吧，读吧，我会等你的。如果你想让我停止追逐开始编码，你的祈祷已经得到了回应。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="9a10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们采用了1949年1月至1960年12月间国际航线乘客数量(以千计)的时间序列数据。人们可以在这里找到数据集，</p><div class="jd je ez fb jf jg"><a href="https://www.kaggle.com/ternaryrealm/airlines-passenger-data" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">航空公司乘客数据</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">Kaggle是世界上最大的数据科学社区，拥有强大的工具和资源来帮助您实现您的数据…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">www.kaggle.com</p></div></div><div class="jp l"><div class="kd l jr js jt jp ju jv jg"/></div></div></a></div></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="ddd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从导入库开始</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="18f8" class="kn ko hi kj b fi kp kq l kr ks"># dataframe opertations - pandas<br/>import pandas as pd</span><span id="c709" class="kn ko hi kj b fi kt kq l kr ks"># plotting data - matplotlib<br/>from matplotlib import pyplot as plt</span><span id="89c8" class="kn ko hi kj b fi kt kq l kr ks"># time series - statsmodels <br/># Seasonality decomposition<br/>from statsmodels.tsa.seasonal import seasonal_decompose</span><span id="6074" class="kn ko hi kj b fi kt kq l kr ks">from statsmodels.tsa.seasonal import seasonal_decompose </span><span id="cc3c" class="kn ko hi kj b fi kt kq l kr ks"># holt winters <br/># single exponential smoothing<br/>from statsmodels.tsa.holtwinters import SimpleExpSmoothing   </span><span id="4a01" class="kn ko hi kj b fi kt kq l kr ks"># double and triple exponential smoothing<br/>from statsmodels.tsa.holtwinters import ExponentialSmoothing</span></pre><p id="ea63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们快速导入数据，看看它是什么样子。我们还将检查数据框和一些数据点的形状。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="e68f" class="kn ko hi kj b fi kp kq l kr ks">airline = pd.read_csv('airline_passengers.csv',index_col='Month', parse_dates=True)</span><span id="a6e3" class="kn ko hi kj b fi kt kq l kr ks">airline = pd.read_csv('airline_passengers.csv',index_col='Month', parse_dates=True)</span><span id="85f5" class="kn ko hi kj b fi kt kq l kr ks"># finding shape of the dataframe<br/>print(airline.shape)</span><span id="771a" class="kn ko hi kj b fi kt kq l kr ks"># having a look at the data<br/>print(airline.head())</span><span id="2379" class="kn ko hi kj b fi kt kq l kr ks"># plotting the original data<br/>airline[['Thousands of Passengers']].plot(title='Passengers Data')</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/e7fe6d8e535e6d4a37187e2a13e01827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AuHdvae7bYoI7OYG2AcylA.png"/></div></div></figure><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lb"><img src="../Images/cf07ea2700d46ce141b7ed8be04c2303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2baqtAxJwYK-DlCIYUaZg.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="40c0" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">分解时间序列</h2><p id="78fb" class="pw-post-body-paragraph if ig hi ih b ii lv ik il im lw io ip iq lx is it iu ly iw ix iy lz ja jb jc hb bi translated">现在我们将分解时间序列，并在数据中寻找水平、趋势和季节性，</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="3222" class="kn ko hi kj b fi kp kq l kr ks">decompose_result = seasonal_decompose(airline[‘Thousands of Passengers’],model=’multiplicative’)<br/>decompose_result.plot();</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ma"><img src="../Images/decf1da0141713f3fe35399163ab46f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebQPHc7cbwMpBxU5YGRp1A.png"/></div></div></figure><p id="b605" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以很清楚地看到，数据有三个层次，趋势，季节性。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="8d27" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">用霍尔特-温特斯指数平滑法拟合数据</h2><p id="d354" class="pw-post-body-paragraph if ig hi ih b ii lv ik il im lw io ip iq lx is it iu ly iw ix iy lz ja jb jc hb bi translated">现在我们将分别用单指数平滑法、双指数平滑法和三指数平滑法来拟合这些数据，看看效果如何。</p><p id="06f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在开始模型之前，我们将首先定义权重系数α和时间段。我们还将日期时间频率设置为每月一次。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="e44f" class="kn ko hi kj b fi kp kq l kr ks"># Set the frequency of the date time index as Monthly start as indicated by the data<br/>airline.index.freq = ‘MS’</span><span id="3933" class="kn ko hi kj b fi kt kq l kr ks"># Set the value of Alpha and define m (Time Period)<br/>m = 12<br/>alpha = 1/(2*m)</span></pre><p id="e481" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将对数据进行单指数平滑拟合，</p><h2 id="0a91" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">单HWES</h2><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5750" class="kn ko hi kj b fi kp kq l kr ks">airline[‘HWES1’] = SimpleExpSmoothing(airline[‘Thousands of Passengers’]).fit(smoothing_level=alpha,optimized=False,use_brute=True).fittedvalues</span><span id="115a" class="kn ko hi kj b fi kt kq l kr ks">airline[[‘Thousands of Passengers’,’HWES1']].plot(title=’Holt Winters Single Exponential Smoothing’);</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es mb"><img src="../Images/9aa162dfc25f96cb49611d9bca66e078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdAv4WfrDz6bbK7_MLBOLA.png"/></div></div></figure><p id="a43d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如预期的那样，它并不十分合适，这是理所当然的，因为如果我们记得的话，单一ES不适用于具有趋势和季节性的数据。</p><h2 id="bf44" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">双HWES</h2><p id="e09b" class="pw-post-body-paragraph if ig hi ih b ii lv ik il im lw io ip iq lx is it iu ly iw ix iy lz ja jb jc hb bi translated">所以，我们将数据拟合在双ES上，在加法和乘法趋势上，</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="8729" class="kn ko hi kj b fi kp kq l kr ks">airline[‘HWES2_ADD’] = ExponentialSmoothing(airline[‘Thousands of Passengers’],trend=’add’).fit().fittedvalues</span><span id="eae5" class="kn ko hi kj b fi kt kq l kr ks">airline[‘HWES2_MUL’] = ExponentialSmoothing(airline[‘Thousands of Passengers’],trend=’mul’).fit().fittedvalues</span><span id="ecbf" class="kn ko hi kj b fi kt kq l kr ks">airline[[‘Thousands of Passengers’,’HWES2_ADD’,’HWES2_MUL’]].plot(title=’Holt Winters Double Exponential Smoothing: Additive and Multiplicative Trend’);</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es mc"><img src="../Images/b0cf4bd27098388359944b3922422a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBKAFHakXjzlBXkB_uY4SQ.png"/></div></div></figure><p id="c625" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，这看起来稍微好一点，但因为我们知道有季节性，我们将进入三倍，看看它是如何拟合的。</p><h2 id="8d0f" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">三小时</h2><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="db80" class="kn ko hi kj b fi kp kq l kr ks">airline[‘HWES3_ADD’] = ExponentialSmoothing(airline[‘Thousands of Passengers’],trend=’add’,seasonal=’add’,seasonal_periods=12).fit().<br/>fittedvalues</span><span id="da1a" class="kn ko hi kj b fi kt kq l kr ks">airline[‘HWES3_MUL’] = ExponentialSmoothing(airline[‘Thousands of Passengers’],trend=’mul’,seasonal=’mul’,seasonal_periods=12).fit().<br/>fittedvalues</span><span id="95be" class="kn ko hi kj b fi kt kq l kr ks">airline[[‘Thousands of Passengers’,’HWES3_ADD’,’HWES3_MUL’]].plot(title=’Holt Winters Triple Exponential Smoothing: Additive and Multiplicative Seasonality’);</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es md"><img src="../Images/745a66a59bcc7e83c6c50aa70776993d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*znmhUTuJ5i__ImC4A1qK6g.png"/></div></div></figure><p id="f102" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这看起来很有希望！这里我们绘制了加性和倍增性季节性。</p><h2 id="6dc9" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">霍尔特-温特斯指数平滑法预测</h2><p id="66cf" class="pw-post-body-paragraph if ig hi ih b ii lv ik il im lw io ip iq lx is it iu ly iw ix iy lz ja jb jc hb bi translated">让我们尝试预测序列，让我们从将数据集划分为训练集和测试集开始。我们将120个数据点作为训练集，将最后24个数据点作为测试集。</p><p id="c894" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">forecast _ data = PD . read _ CSV(' airline _ passengers . CSV '，index_col='Month '，<br/> parse_dates=True)</p><p id="e506" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">forecast_data.index.freq = 'MS '</p><p id="b04f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">#分成训练和测试集<br/>train _ airline = forecast _ data[:120]<br/>test _ airline = forecast _ data[120:]</p><p id="8b75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还在等什么，让我们适应和预测，</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="f48b" class="kn ko hi kj b fi kp kq l kr ks">fitted_model = ExponentialSmoothing(train_airline[‘Thousands of Passengers’],trend=’mul’,seasonal=’mul’,seasonal_periods=12).fit()<br/>test_predictions = fitted_model.forecast(24)</span><span id="8210" class="kn ko hi kj b fi kt kq l kr ks">train_airline[‘Thousands of Passengers’].plot(legend=True,label=’TRAIN’)<br/>test_airline[‘Thousands of Passengers’].plot(legend=True,label=’TEST’,figsize=(6,4))<br/>test_predictions.plot(legend=True,label=’PREDICTION’)</span><span id="b686" class="kn ko hi kj b fi kt kq l kr ks">plt.title(‘Train, Test and Predicted Test using Holt Winters’)</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ma"><img src="../Images/2d7a3cd93fb035aa9470d7a682e8931a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZYpUOFVrLKWnN8e21zrng.png"/></div></div></figure><p id="d404" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着我们接近预测的细分市场，该模型似乎总体上做得不错。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="5502" class="kn ko hi kj b fi kp kq l kr ks">test_airline[‘Thousands of Passengers’].plot(legend=True,label=’TEST’,figsize=(9,6))</span><span id="4453" class="kn ko hi kj b fi kt kq l kr ks">test_predictions.plot(legend=True,label=’PREDICTION’,xlim=[‘1959–01–01’,’1961–01–01']);</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es me"><img src="../Images/02e35e5451f865ff2b95a29cc2552751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3a7AiKTnujW5H9xTc4rM5A.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><h2 id="f699" class="kn ko hi bd lc ld le lf lg lh li lj lk iq ll lm ln iu lo lp lq iy lr ls lt lu bi translated">评估指标</h2><p id="0fe3" class="pw-post-body-paragraph if ig hi ih b ii lv ik il im lw io ip iq lx is it iu ly iw ix iy lz ja jb jc hb bi translated">让我们看看该模型在误差项计算方面的表现。我们将使用MAE(平均绝对误差)和MSE(均方误差)作为衡量标准。</p><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="e4a4" class="kn ko hi kj b fi kp kq l kr ks">from sklearn.metrics import mean_absolute_error,mean_squared_error</span><span id="9cd2" class="kn ko hi kj b fi kt kq l kr ks">print(f’Mean Absolute Error = {mean_absolute_error(test_airline,test_predictions)}’)</span><span id="d8f3" class="kn ko hi kj b fi kt kq l kr ks">print(f’Mean Squared Error = {mean_squared_error(test_airline,test_predictions)}’)</span></pre><figure class="ke kf kg kh fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es mf"><img src="../Images/4b8eaef9ce260d98aebaf3430dafb478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V98tR2zCNYIiRKcoYqSYZA.png"/></div></div></figure></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="97e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，这是我所有的了。我认为这将有助于您进行单变量预测。霍尔特-温特斯指数平滑的基础在这里完成。再次见到大家(希望很快)。保持水分！</p></div></div>    
</body>
</html>