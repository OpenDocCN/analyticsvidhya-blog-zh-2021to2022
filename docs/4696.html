<html>
<head>
<title>Oracle 19c “library cache load lock”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle 19c“库缓存加载锁定”</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/oracle-19c-library-cache-load-lock-e22adbe70eb?source=collection_archive---------1-----------------------#2022-01-07">https://medium.com/analytics-vidhya/oracle-19c-library-cache-load-lock-e22adbe70eb?source=collection_archive---------1-----------------------#2022-01-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b248" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始之前，我想向我的两位老师(大师)道歉，他们是费哈特·森古尔和T2。因为我不想使用他们教给我的科学方法，我只想用简单的方法。当然，这让我得出了错误的结果。然后使用正确的方法，我能够达到涅槃(这是什么样的涅槃？).</p><p id="da45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的问题是在警报日志文件中有很多“ORA-00018:超过最大会话数”条目。乍一看，这可能被视为错误的配置问题，我们需要更改最大会话数。然而，惊喜来了。当我为我的监控用户检查v$session时，我列出了许多“库缓存加载锁定”错误。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/355f235fc64eaef4794d1ed85d7c6742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpjmy9YdB45pxWQzSadSxw.png"/></div></div></figure><p id="f4c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我尝试通过使用(<a class="ae jd" href="https://smarttechways.com/2021/02/24/library-cache-load-lock-in-oracle/" rel="noopener ugc nofollow" target="_blank">https://smarttechways . com/2021/02/24/library-cache-load-lock-in-Oracle/</a>)找到锁定的对象:</p><blockquote class="jq jr js"><p id="5e5d" class="if ig jt ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><strong class="ih hj"> select to_char(SESSION_ID，' 999') sid，<br/> substr(LOCK_TYPE，1，30) Type，<br/> substr(lock_id1，1，23) Object_Name，<br/>substr(mode _ hold，1，4)hold，substr(mode_requested，1，4) REQ，<br/>LOCK _ id2 LOCK _ addr<br/>from DBA _ LOCK _ internal<br/>其中<br/> mode_requested = 'None '【无】</strong></p></blockquote><p id="295e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我的查询也被同一个“库缓存加载锁定”事件阻塞了。那么，是哪个会话导致了这个问题呢？为了指出这一点，我刚刚使用了(有一个很好的递归查询，通过它们的关系列出了会话(我从<a class="ae jd" href="https://www.linkedin.com/in/tugrul-tekin-doyuk-3806961" rel="noopener ugc nofollow" target="_blank">图格鲁·泰京·多尤克</a>那里得到的)，但是由于会话数量很少，我将使用原始方式):</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jx"><img src="../Images/df0ea27cde2579e464c226a38da8adfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_X4iMSi7yXDlHiUof47OaA.png"/></div></div></figure><p id="9b3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我没有考虑sid = 45的会话，因为这是我的一个会话，问题不是死锁。因此，我需要检查sid =153的sessiod。</p><p id="892a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个会话在做什么，被另一个会话阻塞了吗？希望不会:)。然后我查了sql_id:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jy"><img src="../Images/8dda9935d32b4d90e3ed20af149258b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cz5Fbibvda7JEwi04hAQWw.png"/></div></div></figure><p id="fcac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们臭名昭著的sql_id，0za9fv0j1vgkk(当然是为了我:)。让我们试着找出sql_text。</p><blockquote class="jq jr js"><p id="4be5" class="if ig jt ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><strong class="ih hj">从v$sql中选择SQL_FULLTEXT，其中SQL _ id = ' 0 za 9 Fv 0j 1 vgkk '；</strong></p></blockquote><p id="f1f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想猜猜结果:)？没什么，它也被相同的“库缓存加载锁定”事件阻止。此外，该会话属于“SYS”，即Oracle本身。我不能(不能(不应该))杀死它:)。</p><p id="e7b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我检查sqltext时，实例崩溃了:</p><p id="cc3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> MMON (ospid: 1726):由于ORA错误472 </strong>而终止实例</p><p id="4b61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">2022–01–07t 10:49:07.791280+01:00</strong></p><p id="8a1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">原因—‘由于致命进程PMON死亡，实例被终止。’</strong></p><p id="dd90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">2022–01–07t 10:49:08.196524+01:00</strong></p><p id="9946" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> ORA-1092:奥皮茨克中止进程</strong></p><p id="631b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">2022–01–07t 10:49:08.212204+01:00</strong></p><p id="2581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实例打开后，我能够检查什么是sqltext，它开始:</p><blockquote class="jq jr js"><p id="b010" class="if ig jt ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><strong class="ih hj">WITH MONITOR _ DATA AS(SELECT * FROM TABLE(GV $(CURSOR(SELECT USERENV(' instance ')AS ID，KEY，NVL2(PX_QCSID，NULL，STATUS) STATUS，FIRST_REFRESH_TIME，LAST_REFRESH_TIME，REFRESH_COUNT，PROCESS_NAME，SID，SQL_ID，SQL_EXEC_START，SQL_EXEC_ID，DBOP_NAME，DBOP_EXEC_ID，SQL_PLAN_HASH_VALUE，SQL_FULL_PLAN_HASH_VALUE，SESSION_SERIAL#</strong></p></blockquote><p id="577c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还检查了相关的跟踪文件并找到了堆栈:</p><blockquote class="jq jr js"><p id="36b1" class="if ig jt ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><strong class="ih hj">ksedsts()+426&lt;-kspol _ 12751 _ dump()+168&lt;-dbgdaExecuteAction()+354&lt;-dbgerRunAction()+83&lt;-dbgerRunActions()+1352&lt;</strong></p></blockquote><p id="162a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我搜索sql_id、sqltext和stacks时，我发现了这三个结果:</p><p id="91f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">文件ID 1912230.1- </strong></p><p id="a804" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1418384640342726&amp;id=1912230.1&amp;displayIndex=2&amp;_afrWindowMode=0&amp;_adf.ctrl-state=kmx63y5eg_4#SYMPTOM" rel="noopener ugc nofollow" target="_blank">https://support.oracle.com/epmos/faces/DocumentDisplay?_ AFR loop = 1400044062885045&amp;id = 1912230.1&amp;display index = 2&amp;_ AFR window mode = 0&amp;_ ADF . ctrl-state = ibohbk 7 rz _ 391 #症状</a></p><p id="a4ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">文件ID 2253323.1- </strong></p><p id="748b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=1418385898987017&amp;id=2253323.1&amp;displayIndex=1&amp;_afrWindowMode=0&amp;_adf.ctrl-state=kmx63y5eg_45#SYMPTOM" rel="noopener ugc nofollow" target="_blank">https://support.oracle.com/epmos/faces/DocumentDisplay?_ AFR loop = 1418385898987017&amp;id = 2253323.1&amp;display index = 1&amp;_ AFR window mode = 0&amp;_ ADF . ctrl-state = kmx 63y 5 eg _ 45 #症状</a></p><p id="c729" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">文件编号2102131.1- </strong></p><p id="9d1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=3040295085757&amp;id=2102131.1&amp;displayIndex=6&amp;_afrWindowMode=0&amp;_adf.ctrl-state=n2lnumlv7_4#SYMPTOM" rel="noopener ugc nofollow" target="_blank">https://support.oracle.com/epmos/faces/DocumentDisplay?_ AFR loop = 1399635969835598&amp;id = 2102131.1&amp;display index = 6&amp;_ AFR window mode = 0&amp;_ ADF . ctrl-state = ibohbk 7 rz _ 173 #症状</a></p><p id="26b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，我的老队友，在银行工作的Ferhat Gülerce告诉我，他们比我先犯了这个错误。正在执行:</p><blockquote class="jq jr js"><p id="2e73" class="if ig jt ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><strong class="ih hj">alter system set " _ report _ capture _ cycle _ time " = 0；/*默认为60秒*/ </strong></p></blockquote><p id="7429" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决这个错误(至少到目前为止:)。</p><p id="2e6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果有什么问题，请让我知道！</p><p id="8830" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢！</p></div></div>    
</body>
</html>