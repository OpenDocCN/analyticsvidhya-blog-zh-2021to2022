<html>
<head>
<title>Setting Up TensorFlow 2 GPU on Windows in 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2021年在Windows上设置TensorFlow 2 GPU</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-setup-tensorflow-2-gpu-on-windows-in-2021-db9ca411f1df?source=collection_archive---------3-----------------------#2021-07-04">https://medium.com/analytics-vidhya/how-to-setup-tensorflow-2-gpu-on-windows-in-2021-db9ca411f1df?source=collection_archive---------3-----------------------#2021-07-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="ddae" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">机器学习<strong class="ak">很复杂——但是安装不应该是最简单的部分吗？</strong></h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/614f1c4d09aa6148c394049e284d99ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxExSBYSDVzLyttQ-FwC1g.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">照片由来自Pexels的Nana Dua拍摄</figcaption></figure><p id="2446" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我对<a class="ae ki" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>有一种又爱又恨的关系，但我想这些年来，这种关系随着每一个新版本的发布而增长和改善。TensorFlow是一个非常强大的机器学习平台，这就是为什么我真的很喜欢他们正在做的事情。当我第一次尝试在有GPU支持的Windows上安装我的本地TensorFlow V1环境时，我的关系中令人讨厌的部分出现了，我花了一天多的时间让它有点工作。我明白，机器学习<strong class="jo hi">很复杂——但是安装不应该是最简单的部分吗？</strong></p><p id="4e96" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在本指南中，我将努力使这个过程尽可能无痛，这样你就可以从一开始就与TensorFlow建立爱的关系！</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><p id="ceb7" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><a class="ae ki" href="#cb51" rel="noopener ugc nofollow"> <strong class="jo hi"> TensorFlow 2(仅限CPU)</strong></a><br/>∘<a class="ae ki" href="#7ab0" rel="noopener ugc nofollow">anaconda for python安装</a><br/>∘<a class="ae ki" href="#bfec" rel="noopener ugc nofollow">tensor flow 2 in anaconda安装</a><br/><a class="ae ki" href="#e4d4" rel="noopener ugc nofollow"><strong class="jo hi">tensor flow 2 with GPU支持</strong> </a> <br/> ∘ <a class="ae ki" href="#8ebb" rel="noopener ugc nofollow">检查兼容性</a> <br/> ∘ <a class="ae ki" href="#6357" rel="noopener ugc nofollow"> Nvidia CUDA工具包安装</a> <br/> ∘ <a class="ae ki" href="#da91" rel="noopener ugc nofollow"> Nvidia </a></p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="cb51" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">TensorFlow 2(仅限CPU)</h1><h2 id="7ab0" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated">Python安装的Anaconda:</h2><p id="b514" class="pw-post-body-paragraph jm jn hh jo b jp lw ii jr js lx il ju jv ly jx jy jz lz kb kc kd ma kf kg kh ha bi translated">如果您还没有安装Anaconda，我强烈推荐您安装它，因为它在管理软件包和创建虚拟环境方面非常出色，这对于下一步安装Tensorflow非常重要。</p><ol class=""><li id="8f04" class="mb mc hh jo b jp jq js jt jv md jz me kd mf kh mg mh mi mj bi translated"><strong class="jo hi">下载</strong> <a class="ae ki" href="https://www.anaconda.com/products/individual" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hi">蟒蛇个人版</strong> </a></li><li id="bae6" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">运行可执行安装程序，浏览各个步骤← </strong>默认设置通常就足够了。如果您的PC上还没有安装python的冲突发行版，您可以“将Anaconda3添加到我的路径环境变量中”。</li></ol><h2 id="bfec" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated">Anaconda安装中的TensorFlow 2:</h2><ol class=""><li id="f499" class="mb mc hh jo b jp lw js lx jv mp jz mq kd mr kh mg mh mi mj bi translated"><strong class="jo hi">打开一个</strong> <code class="du ms mt mu mv b"><strong class="jo hi">Anaconda Prompt (Anaconda3)</strong></code> <strong class="jo hi">终端← </strong>在开始菜单中搜索“Anaconda Prompt”会弹出窗口并读取<code class="du ms mt mu mv b">(base) C:\Users\name&gt;</code></li><li id="8dbe" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">运行:</strong> <code class="du ms mt mu mv b">conda create -n tf pip python=3.9</code> ←告诉Anaconda创建一个名为“tf”的新虚拟环境，该环境将使用Python版本</li><li id="fe0c" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">运行:</strong> <code class="du ms mt mu mv b">activate tf</code> ←告诉Anaconda在虚拟环境“tf”中运行，并将读取<code class="du ms mt mu mv b">(tf) C:\Users\name&gt;</code></li><li id="8a47" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">运行:</strong> <code class="du ms mt mu mv b">pip install --ignore-installed --upgrade tensorflow==2.5.0</code> ←安装TensorFlow版本2.5.0包，现在也包括GPU支持(查看最新的<a class="ae ki" href="https://www.tensorflow.org/versions" rel="noopener ugc nofollow" target="_blank">稳定版本</a>)</li></ol><h1 id="e4d4" class="kq kr hh bd ks kt mw kv kw kx mx kz la in my io lc iq mz ir le it na iu lg lh bi translated">支持GPU的TensorFlow 2</h1><p id="4af9" class="pw-post-body-paragraph jm jn hh jo b jp lw ii jr js lx il ju jv ly jx jy jz lz kb kc kd ma kf kg kh ha bi translated">到目前为止，这份指南与互联网上的其他指南非常相似，而且非常简单明了。我们现在有一个Tensorflow环境安装，如果你只想用你的CPU训练你的机器学习模型，它就足够好了。对于一些人来说，这可能没问题，但众所周知，机器学习在使用GPU进行训练时效果最好，因为它比只使用CPU快得多。</p><p id="292b" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">有鉴于此，我们将在下一节中介绍为TensorFlow 2启用GPU支持的过程。</p><h2 id="8ebb" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated">检查兼容性:</h2><p id="d694" class="pw-post-body-paragraph jm jn hh jo b jp lw ii jr js lx il ju jv ly jx jy jz lz kb kc kd ma kf kg kh ha bi translated"><a class="ae ki" href="https://www.tensorflow.org/install/source_windows#gpu" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hi"> TensorFlow GPU兼容性列表</strong> </a> <strong class="jo hi"> </strong> ← TensorFlow有特定的软件兼容性要求，因此确保您在接下来的步骤中下载正确的版本非常重要。</p><p id="344c" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">对于<code class="du ms mt mu mv b"><strong class="jo hi">TF 2.5.0</strong></code>，<code class="du ms mt mu mv b"><strong class="jo hi">CUDA 11.2</strong></code>和<code class="du ms mt mu mv b"><strong class="jo hi"> cuDNN 8.1</strong></code>已经通过TensorFlow验证。</p><h2 id="6357" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated">Nvidia CUDA工具包安装:</h2><ol class=""><li id="973c" class="mb mc hh jo b jp lw js lx jv mp jz mq kd mr kh mg mh mi mj bi translated"><strong class="jo hi">下载</strong><a class="ae ki" href="https://developer.nvidia.com/cuda-11.2.2-download-archive?target_os=Windows&amp;target_arch=x86_64&amp;target_version=10&amp;target_type=exenetwork" rel="noopener ugc nofollow" target="_blank"><strong class="jo hi">CUDA Toolkit 11.2</strong></a>←如果需要针对不同TensorFlow版本的不同版本的CUDA，可以在<a class="ae ki" href="https://developer.nvidia.com/cuda-toolkit-archive" rel="noopener ugc nofollow" target="_blank"> CUDA Toolkit档案</a>中找到</li><li id="f569" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">运行可执行安装程序，浏览各个步骤← </strong>默认值通常就足够了</li></ol><h2 id="da91" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated"><strong class="ak"> Nvidia cuDNN设置:</strong></h2><ol class=""><li id="011d" class="mb mc hh jo b jp lw js lx jv mp jz mq kd mr kh mg mh mi mj bi translated"><strong class="jo hi">为下载cuDNN所需的</strong><a class="ae ki" href="https://developer.nvidia.com/login" rel="noopener ugc nofollow" target="_blank"><strong class="jo hi">Nvidia Developer Progam Membership</strong></a>←创建一个帐户</li><li id="4cb9" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">登录并下载</strong><a class="ae ki" href="https://developer.nvidia.com/compute/machine-learning/cudnn/secure/8.1.0.77/11.2_20210127/cudnn-11.2-windows-x64-v8.1.0.77.zip" rel="noopener ugc nofollow" target="_blank"><strong class="jo hi">cuDNN 8.1 for Windows</strong></a>←如果您需要不同版本的cud nn用于不同的TensorFlow版本，请在<a class="ae ki" href="https://developer.nvidia.com/rdp/cudnn-archive#a-collapse810-111" rel="noopener ugc nofollow" target="_blank"> cuDNN存档</a>中找到</li><li id="dbdb" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">提取</strong> <code class="du ms mt mu mv b"><strong class="jo hi">C:\Users\name\Downloads\cudnn-11.2-windows-x64-v8.1.0.77.zip\cuda</strong></code> <strong class="jo hi">文件夹到</strong> <code class="du ms mt mu mv b"><strong class="jo hi">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2</strong></code> <strong class="jo hi">文件夹</strong></li></ol><h2 id="0a8c" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated">Nvidia GPU驱动程序更新:</h2><ol class=""><li id="29e0" class="mb mc hh jo b jp lw js lx jv mp jz mq kd mr kh mg mh mi mj bi translated"><strong class="jo hi">打开Nvidia的Geforce Experience </strong> ←你只要在开始搜索栏输入“Geforce Experience”就会弹出一个app</li><li id="3f8b" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">点击“驱动程序”选项卡</strong></li><li id="3c8c" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">在“可用”下，一个驱动程序可能准备好安装</strong>，如果没有，点击“检查更新”,然后查看是否有任何驱动程序更新</li></ol><h2 id="3a69" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated">环境变量设置:</h2><ol class=""><li id="2e7d" class="mb mc hh jo b jp lw js lx jv mp jz mq kd mr kh mg mh mi mj bi translated"><strong class="jo hi">打开“系统属性”</strong> ←从开始菜单中搜索“编辑系统环境变量”</li><li id="22ac" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">点击右下角“高级”标签下的“环境变量…”</strong>←</li><li id="2745" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">在“系统变量”部分下找到并编辑</strong> <code class="du ms mt mu mv b"><strong class="jo hi">Path</strong></code> <strong class="jo hi">变量</strong> ←</li><li id="0784" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">添加以下五个新的</strong> <code class="du ms mt mu mv b"><strong class="jo hi">Path</strong></code> <strong class="jo hi">值:</strong></li></ol><pre class="ix iy iz ja fd nb mv nc nd aw ne bi"><span id="5383" class="li kr hh mv b fi nf ng l nh ni">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2\bin</span><span id="63e5" class="li kr hh mv b fi nj ng l nh ni">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2\libnvvp</span><span id="87cc" class="li kr hh mv b fi nj ng l nh ni">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2\include</span><span id="9c64" class="li kr hh mv b fi nj ng l nh ni">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2\cuda\bin</span><span id="b42e" class="li kr hh mv b fi nj ng l nh ni">C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.2\extras\CUPTI\lib64</span></pre><h2 id="6f99" class="li kr hh bd ks lj lk ll kw lm ln lo la jv lp lq lc jz lr ls le kd lt lu lg lv bi translated"><strong class="ak">验证全张量流安装:</strong></h2><ol class=""><li id="e3b9" class="mb mc hh jo b jp lw js lx jv mp jz mq kd mr kh mg mh mi mj bi translated"><strong class="jo hi">打开新的</strong> <code class="du ms mt mu mv b"><strong class="jo hi">Anaconda Prompt (Anaconda3)</strong></code> <strong class="jo hi">端子</strong></li><li id="0323" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">运行:</strong>T5】</li><li id="b085" class="mb mc hh jo b jp mk js ml jv mm jz mn kd mo kh mg mh mi mj bi translated"><strong class="jo hi">正确的输出应该有“成功打开动态库”和“已创建张量流设备”标志，看起来如下:</strong></li></ol><pre class="ix iy iz ja fd nb mv nc nd aw ne bi"><span id="d691" class="li kr hh mv b fi nf ng l nh ni">(tf) C:\Users\name&gt;<strong class="mv hi">python -c "import tensorflow as tf;print(tf.reduce_sum(tf.random.normal([1000, 1000])))"</strong><br/>2021-07-02 20:19:44.622280: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cudart64_110.dll<br/>2021-07-02 20:19:48.037812: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> nvcuda.dll<br/>2021-07-02 20:19:48.158677: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1733] Found device 0 with properties:<br/>pciBusID: 0000:2d:00.0 name: NVIDIA GeForce RTX 2070 SUPER computeCapability: 7.5<br/>coreClock: 1.785GHz coreCount: 40 deviceMemorySize: 8.00GiB deviceMemoryBandwidth: 417.29GiB/s<br/>2021-07-02 20:19:48.158984: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cudart64_110.dll<br/>2021-07-02 20:19:48.632718: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cublas64_11.dll<br/>2021-07-02 20:19:48.632851: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cublasLt64_11.dll<br/>2021-07-02 20:19:48.939031: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cufft64_10.dll<br/>2021-07-02 20:19:48.971598: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> curand64_10.dll<br/>2021-07-02 20:19:49.202579: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cusolver64_11.dll<br/>2021-07-02 20:19:49.416235: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cusparse64_11.dll<br/>2021-07-02 20:19:50.335902: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] <strong class="mv hi">Successfully opened dynamic library</strong> cudnn64_8.dll<br/>2021-07-02 20:19:50.336366: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1871] Adding visible gpu devices: 0<br/>2021-07-02 20:19:50.338899: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2<br/>To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. <br/>2021-07-02 20:19:50.341514: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1733] Found device 0 with properties:<br/>pciBusID: 0000:2d:00.0 name: NVIDIA GeForce RTX 2070 SUPER computeCapability: 7.5<br/>coreClock: 1.785GHz coreCount: 40 deviceMemorySize: 8.00GiB deviceMemoryBandwidth: 417.29GiB/s<br/>2021-07-02 20:19:50.341677: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1871] Adding visible gpu devices: 0<br/>2021-07-02 20:19:51.176159: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1258] Device interconnect StreamExecutor with strength 1 edge matrix:<br/>2021-07-02 20:19:51.176333: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1264]      0<br/>2021-07-02 20:19:51.177492: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1277] 0:   N<br/>2021-07-02 20:19:51.179734: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1418] <strong class="mv hi">Created TensorFlow device</strong> (/job:localhost/replica:0/task:0/device:GPU:0 with 5973 MB memory) -&gt; physical GPU (device: 0, name: NVIDIA GeForce RTX 2070 SUPER, pci bus id: 0000:2d:00.0, compute capability: 7.5)<br/>tf.Tensor(1009.2107, shape=(), dtype=float32)</span></pre><p id="9119" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">…我们完成了！这就是设置TensorFlow 2所需要做的全部工作！每当您想使用这个环境时，只需打开一个新的<code class="du ms mt mu mv b">Anaconda Prompt (Anaconda3)</code>终端并运行:<code class="du ms mt mu mv b">activate tf</code></p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="2d10" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">下一步是什么？</h1><p id="07b3" class="pw-post-body-paragraph jm jn hh jo b jp lw ii jr js lx il ju jv ly jx jy jz lz kb kc kd ma kf kg kh ha bi translated">在我的下一篇文章中，我将介绍使用TensorFlow的对象检测API创建您自己的自定义对象检测模型的安装和设置。我会仔细检查我需要解决的所有代码修正和调整，这样你就不用这么做了！</p><p id="4c4a" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我强烈推荐看<a class="ae ki" href="https://tensorflow-object-detection-api-tutorial.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> TensorFlow 2对象检测API教程</a>，因为它有一些更深入的解释，是我迄今为止找到的最好的资源之一。在这一系列文章中，我将经历与他们的教程相似的步骤，但是在这个过程中会帮助修复一些关键的代码。</p></div></div>    
</body>
</html>