<html>
<head>
<title>Deploy Ruby on Rails 6 application to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Ruby on Rails 6应用程序部署到Heroku</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-ruby-on-rails-6-application-to-heroku-3d07a8d7428c?source=collection_archive---------7-----------------------#2021-03-04">https://medium.com/analytics-vidhya/deploy-ruby-on-rails-6-application-to-heroku-3d07a8d7428c?source=collection_archive---------7-----------------------#2021-03-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1101" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，您将了解如何将现有的应用程序部署到Heroku。</p><h1 id="2172" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">设置您的本地:</strong></h1><p id="a8d5" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">首先创建一个heroku帐户，它是免费的。</p><p id="ecf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的开发机器上安装<a class="ae kf" href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install" rel="noopener ugc nofollow" target="_blank"> Heroku CLI </a>。</p><p id="1eab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦安装完毕，<code class="du kg kh ki kj b">heroku</code>命令可从您的终端使用。使用您的Heroku帐户的电子邮件地址和密码登录:</p><figure class="kk kl km kn fd ko er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es et"><img src="../Images/eecf8370b9b47b5b808340500b6c8ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTNSljh4jTJ5BY-GwPbY9w.png"/></div></div></figure><p id="e537" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在提示符下按Enter键，上传您现有的<code class="du kg kh ki kj b">ssh</code>键或创建一个新的键，用于稍后推送代码。—如果你需要</p><p id="6b51" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它将在您的浏览器上打开一个新标签，输入您的Heroku帐户凭证并登录，然后您将成功登录。</p><h2 id="87b0" class="kv jd hh bd je kw kx ky ji kz la lb jm ip lc ld jq it le lf ju ix lg lh jy li bi translated">数据库. yml</h2><p id="e35c" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">确保您的<code class="du kg kh ki kj b">config/database.yml</code>文件正在使用<code class="du kg kh ki kj b">postgresql</code>适配器。您的<code class="du kg kh ki kj b">config/database.yml</code>文件的开发部分应该是这样的:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="bfae" class="kv jd hh kj b fi ln lo l lp lq">$cat config/database.yml<br/># PostgreSQL. Versions 9.3 and up are supported.<br/>#<br/># Install the pg driver:<br/>#   gem install pg<br/># On macOS with Homebrew:<br/>#   gem install pg -- --with-pg-config=/usr/local/bin/pg_config<br/># On macOS with MacPorts:<br/>#   gem install pg -- --with-pg-config=/opt/local/lib/postgresql84/bin/pg_config<br/># On Windows:<br/>#   gem install pg<br/>#       Choose the win32 build.<br/>#       Install PostgreSQL and put its /bin directory on your path.<br/>#<br/># Configure Using Gemfile<br/># gem 'pg'<br/>#<br/>default: &amp;default<br/>  adapter: postgresql<br/>  encoding: unicode<br/>  # For details on connection pooling, see Rails configuration guide<br/>  # https://guides.rubyonrails.org/configuring.html#database-pooling<br/>  pool: &lt;%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %&gt;<br/><br/>development:<br/>  &lt;&lt;: *default<br/>  database: myapp_development<br/><br/>  # The specified database role being used to connect to postgres.<br/>  # To create additional roles in postgres see `$ createuser --help`.<br/>  # When left blank, postgres will use the default role. This is<br/>  # the same name as the operating system user running Rails.<br/>  #username: myapp<br/><br/>  # The password associated with the postgres role (username).<br/>  #password:<br/><br/>  # Connect on a TCP socket. Omitted by default since the client uses a<br/>  # domain socket that doesn't need configuration. Windows does not have<br/>  # domain sockets, so uncomment these lines.<br/>  #host: localhost<br/><br/>  # The TCP port the server listens on. Defaults to 5432.<br/>  # If your server runs on a different port number, change accordingly.<br/>  #port: 5432<br/><br/>  # Schema search path. The server defaults to $user,public<br/>  #schema_search_path: myapp,sharedapp,public<br/><br/>  # Minimum log levels, in increasing order:<br/>  #   debug5, debug4, debug3, debug2, debug1,<br/>  #   log, notice, warning, error, fatal, and panic<br/>  # Defaults to warning.<br/>  #min_messages: notice<br/><br/># Warning: The database defined as "test" will be erased and<br/># re-generated from your development database when you run "rake".<br/># Do not set this db to the same as development or production.<br/>test:<br/>  &lt;&lt;: *default<br/>  database: myapp_test<br/><br/># As with config/credentials.yml, you never want to store sensitive information,<br/># like your database password, in your source code. If your source code is<br/># ever seen by anyone, they now have access to your database.<br/>#<br/># Instead, provide the password or a full connection URL as an environment<br/># variable when you boot the app. For example:<br/>#<br/>#   DATABASE_URL="postgres://myuser:mypass@localhost/somedatabase"<br/>#<br/># If the connection URL is provided in the special DATABASE_URL environment<br/># variable, Rails will automatically merge its configuration values on top of<br/># the values provided in this file. Alternatively, you can specify a connection<br/># URL environment variable explicitly:<br/>#<br/>#   production:<br/>#     url: &lt;%= ENV['MY_APP_DATABASE_URL'] %&gt;<br/>#<br/># Read https://guides.rubyonrails.org/configuring.html#configuring-a-database<br/># for a full overview on how database connection configuration can be specified.<br/>#<br/>production:<br/>  &lt;&lt;: *default<br/>  database: myapp_production<br/>  username: myapp<br/>  password: &lt;%= ENV['MYAPP_DATABASE_PASSWORD'] %&gt;</span></pre><p id="f318" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了让数据库连接在生产环境中工作，Heroku使用了自己的策略。</p><h2 id="e1d4" class="kv jd hh bd je kw kx ky ji kz la lb jm ip lc ld jq it le lf ju ix lg lh jy li bi translated">指定您的Ruby版本</h2><p id="40cf" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Rails 6需要Ruby 2.5.0或以上版本。Heroku默认安装了最新版本的Ruby，但是您可以通过使用您的<code class="du kg kh ki kj b">Gemfile</code>中的<code class="du kg kh ki kj b">ruby</code> DSL来指定一个确切的版本。根据您当前运行的Ruby版本，它可能如下所示:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="1110" class="kv jd hh kj b fi ln lo l lp lq">ruby "2.7.2"</span></pre><h2 id="55d4" class="kv jd hh bd je kw kx ky ji kz la lb jm ip lc ld jq it le lf ju ix lg lh jy li bi translated">推送至git:</h2><p id="01f9" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">现在，在您的Rails应用程序目录中运行这些命令，初始化您的代码并提交给Git:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="49f5" class="kv jd hh kj b fi ln lo l lp lq">$ git init<br/>$ git add .<br/>$ git commit -m "init"</span></pre><p id="635f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以通过运行以下命令来验证所有内容都已正确提交:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="ff17" class="kv jd hh kj b fi ln lo l lp lq">$ git status<br/>On branch main<br/>nothing to commit, working tree clean</span></pre><p id="9284" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在您的应用程序已经提交给Git，您可以部署到Heroku。</p><h2 id="b0f3" class="kv jd hh bd je kw kx ky ji kz la lb jm ip lc ld jq it le lf ju ix lg lh jy li bi translated">部署到Heroku:</h2><p id="c338" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">确保您位于包含您的Rails应用程序的目录中，然后在Heroku上创建一个应用程序:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="aaa1" class="kv jd hh kj b fi ln lo l lp lq">$ heroku create<br/>Creating app... done, aqueous-sierra-44713<br/>https://ashokavanam-44713.herokuapp.com/ | <a class="ae kf" href="https://git.heroku.com/aqueous-sierra-44713.git" rel="noopener ugc nofollow" target="_blank">https://git.heroku.com/</a>ashokavanam<a class="ae kf" href="https://git.heroku.com/aqueous-sierra-44713.git" rel="noopener ugc nofollow" target="_blank">-44713.git</a></span></pre><p id="b448" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以通过运行以下命令来验证遥控器是否已添加到您的项目中:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="8684" class="kv jd hh kj b fi ln lo l lp lq">$ git config --list --local | grep heroku<br/>remote.heroku.url=https://git.heroku.com/ashokavanam-44713.git<br/>remote.heroku.fetch=+refs/heads/*:refs/remotes/heroku/*</span></pre><h2 id="7690" class="kv jd hh bd je kw kx ky ji kz la lb jm ip lc ld jq it le lf ju ix lg lh jy li bi translated">部署您的代码:</h2><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="ad13" class="kv jd hh kj b fi ln lo l lp lq">$ git push heroku master</span></pre><blockquote class="lr ls lt"><p id="60ce" class="ie if lu ig b ih ii ij ik il im in io lv iq ir is lw iu iv iw lx iy iz ja jb ha bi translated">如果您的git repo使用main作为头分支，那么用上面命令中的main替换master</p></blockquote><h2 id="cca6" class="kv jd hh bd je kw kx ky ji kz la lb jm ip lc ld jq it le lf ju ix lg lh jy li bi translated">迁移您的数据库</h2><p id="7909" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">如果您在应用程序中使用数据库，则需要通过运行以下命令来手动迁移数据库:</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="57b4" class="kv jd hh kj b fi ln lo l lp lq">$ heroku run rake db:migrate</span></pre><p id="6539" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以检查应用程序动态的状态。<code class="du kg kh ki kj b">heroku ps</code>命令列出了您的应用程序正在运行的dynos:</p><p id="741c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就是这样！！！</p><p id="7254" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在可以使用<code class="du kg kh ki kj b">heroku open</code>在浏览器中访问应用程序。</p><pre class="kk kl km kn fd lj kj lk ll aw lm bi"><span id="2a06" class="kv jd hh kj b fi ln lo l lp lq">$ heroku open</span></pre><p id="5c38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编码快乐！！！！！:)</p></div></div>    
</body>
</html>