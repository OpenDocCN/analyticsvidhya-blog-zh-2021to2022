<html>
<head>
<title>Deploy a Fast.ai trained model using Binder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Binder部署Fast.ai训练模型</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-a-fast-ai-trained-model-using-binder-ce717a2ca66c?source=collection_archive---------16-----------------------#2021-01-10">https://medium.com/analytics-vidhya/deploy-a-fast-ai-trained-model-using-binder-ce717a2ca66c?source=collection_archive---------16-----------------------#2021-01-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="fd94" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">将您的笔记本变成真正的应用程序，并使用binder进行部署</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/7b3ea5c74ae6bc669d32f6eae8fca8bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1f71lHnTqxiLgDyE"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">照片由<a class="ae jm" href="https://unsplash.com/@wocintechchat?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜@ wocintechchat.com</a>在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5a8a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这是“<strong class="jp hi">了解模型部署的数据源和准备流程</strong>”系列的第3部分。在系列的这一部分，我们将使用binder部署我们训练过的深度学习模型。</p><p id="e0b0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">查看最终部署的app:<a class="ae jm" href="https://mybinder.org/v2/gh/emmakodes/malaria_parasite_voila/HEAD?urlpath=%2Fvoila%2Frender%2Fmalaria_species_classifier.ipynb" rel="noopener ugc nofollow" target="_blank">https://my binder . org/v2/GH/Emma Michael/malaria _寄生虫_voila/HEAD？URL path = % 2f voila % 2f fronder % 2f malaria _ species _ classifier . ipynb</a></p><p id="e983" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">该过程将按以下顺序实施:</p><ol class=""><li id="1e97" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">创建Github存储库</li></ol><p id="8a97" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">添加:</p><p id="9e5e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">2.export.pkl文件</p><p id="f6ae" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">3.requirements.txt文件。</p><p id="7ce3" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">4.将笔记本变成应用程序</p><p id="a823" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">5.添加、提交并推送到Github</p><p id="28a8" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">6.发布到活页夹。</p><h1 id="8c45" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">创建Github存储库</h1><p id="45fe" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">转到Github并创建一个新的存储库。我会把我的叫做<a class="ae jm" href="https://github.com/emmamichael/malaria_parasite_voila" rel="noopener ugc nofollow" target="_blank">疟疾_寄生虫_瞧啊</a></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lp"><img src="../Images/f17f05ba6e67ffd59659ea4ea9a9c2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMT-EvwBEKOdx5GExG3L2Q.png"/></div></div></figure><h1 id="ae78" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">将export.pkl文件添加到项目</h1><p id="37ea" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">将存储库克隆到IDE(Pycharm)。</p><p id="77e4" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">将创建并下载的export.pkl文件添加到我们的克隆项目中。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lq"><img src="../Images/88f725b0ebd190231d04f966a1fc4d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUXWqIvrDbx9ui6ESeGAZg.png"/></div></div></figure><h1 id="b6c7" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">添加requirements.txt文件</h1><p id="ee68" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">在我们的项目中创建一个requirements.txt文件，并编写:</p><pre class="ix iy iz ja fd lr ls lt lu aw lv bi"><span id="b484" class="lw kt hh ls b fi lx ly l lz ma">voila<br/>fastai&gt;=2<br/>pillow&lt;7<br/>packaging<br/>ipywidgets==7.5.1</span></pre><h1 id="74d2" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">将笔记本变成应用程序</h1><p id="21d6" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">我们将把我们用来训练模型的jupyter笔记本变成一个应用程序。为此，我们将使用Voilà和ipywidgets(来创建小部件)。</p><p id="0632" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">从Kaggle创建一个新的Jupyter笔记本，我们将只向这个笔记本添加创建和显示我们需要的小部件所需的代码，并对我们希望出现的任何文本进行标记。</p><pre class="ix iy iz ja fd lr ls lt lu aw lv bi"><span id="e951" class="lw kt hh ls b fi lx ly l lz ma">#import fastai.vision.all and vision.widgets to create widgets<strong class="ls hi"><br/>from fastai.vision.all import *<br/>from fastai.vision.widgets import *</strong></span><span id="52de" class="lw kt hh ls b fi mb ly l lz ma">#Make the two text comments below a markdown in your notebook</span><span id="6898" class="lw kt hh ls b fi mb ly l lz ma">#Malaria Parasite Species Classifier</span><span id="a677" class="lw kt hh ls b fi mb ly l lz ma">#You need to know the species of malaria for effective treatment? #Then upload an image of malaria parasite.</span><span id="9865" class="lw kt hh ls b fi mb ly l lz ma">#declare path and load our export.pkl file<br/><strong class="ls hi">path = Path()<br/>learn_inf = load_learner(path/'export.pkl', cpu=True)</strong></span><span id="00da" class="lw kt hh ls b fi mb ly l lz ma">#declare a button,output,label widget<br/><strong class="ls hi">btn_upload = widgets.FileUpload()<br/>out_pl = widgets.Output()<br/>lbl_pred = widgets.Label()</strong></span><span id="66f3" class="lw kt hh ls b fi mb ly l lz ma">#define an on_data_change function which execute when an image is #uploaded.It gets the image uploaded,display the image,make a #prediction of the image and output prediction, probability of #predictions</span><span id="173d" class="lw kt hh ls b fi mb ly l lz ma"><strong class="ls hi">def on_data_change(change):    <br/>    lbl_pred.value = ''     <br/>    img = PILImage.create(btn_upload.data[-1])     <br/>    out_pl.clear_output()     <br/>    with out_pl: display(img.to_thumb(128,128))     <br/>    pred,pred_idx,probs = learn_inf.predict(img)    <br/>    lbl_pred.value = f'Prediction: {pred}; Probability:{probs[pred_idx]:.04f}'</strong></span><span id="fb28" class="lw kt hh ls b fi mb ly l lz ma">#button to click to upload image<br/><strong class="ls hi">btn_upload.observe(on_data_change, names=['data'])</strong></span><span id="7640" class="lw kt hh ls b fi mb ly l lz ma">#display label,btn_upload,out_pl,lbl_pred vertically<br/><strong class="ls hi">display(VBox([widgets.Label('Select an Image of Malaria Parasite!'), btn_upload, out_pl, lbl_pred]))</strong></span></pre><p id="046f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">瞧，这是我们的requirements.txt文件中的一个包，它将删除所有的单元格输入，只显示输出(包括ipywidgets)以及我们的Markdown单元格。当我们部署我们的应用程序时，您会看到这一点。</p><p id="58d9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">从Kaggle下载笔记本并将其添加到我们的克隆项目中。</strong></p><h1 id="ae53" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">添加、提交并推送到Github</h1><p id="1e7e" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">在项目的终端中运行以下命令，将我们的项目添加、提交并推送到我们的远程存储库中。</p><pre class="ix iy iz ja fd lr ls lt lu aw lv bi"><span id="9d7b" class="lw kt hh ls b fi lx ly l lz ma">git add .</span><span id="3832" class="lw kt hh ls b fi mb ly l lz ma">git commit -m “first commit”</span><span id="b789" class="lw kt hh ls b fi mb ly l lz ma">git push — set-upstream origin master</span></pre><p id="85d7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果收到<strong class="jp hi">检测到大文件的错误。你可能想尝试Git大文件存储。</strong>然后我们需要设置Git大文件存储，使我们能够上传大文件或模型到Github。</p><p id="912e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">对于Debian和Ubuntu: </strong></p><p id="958a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在您的终端中运行以下命令，下载并安装git lfs:</p><ol class=""><li id="0ca7" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated"><code class="du mc md me ls b">curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash</code></li><li id="97aa" class="kj kk hh jp b jq mf jt mg jw mh ka mi ke mj ki ko kp kq kr bi translated"><code class="du mc md me ls b">sudo apt-get install git-lfs</code></li><li id="98b5" class="kj kk hh jp b jq mf jt mg jw mh ka mi ke mj ki ko kp kq kr bi translated"><code class="du mc md me ls b">git lfs install</code></li></ol><p id="a768" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">其他系统用户，可以查看这个链接:【https://github.com/git-lfs/git-lfs/wiki/Installation<a class="ae jm" href="https://github.com/git-lfs/git-lfs/wiki/Installation" rel="noopener ugc nofollow" target="_blank"/></p><p id="5f2e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后在项目的终端中运行以下命令:</p><ol class=""><li id="cdaa" class="kj kk hh jp b jq jr jt ju jw kl ka km ke kn ki ko kp kq kr bi translated">git lfs音轨" *。pkl "</li><li id="2d19" class="kj kk hh jp b jq mf jt mg jw mh ka mi ke mj ki ko kp kq kr bi translated">git添加。gitattributes</li><li id="1f7e" class="kj kk hh jp b jq mf jt mg jw mh ka mi ke mj ki ko kp kq kr bi translated">git添加export.pkl</li><li id="d143" class="kj kk hh jp b jq mf jt mg jw mh ka mi ke mj ki ko kp kq kr bi translated">git commit -m“添加模型”</li><li id="e2fe" class="kj kk hh jp b jq mf jt mg jw mh ka mi ke mj ki ko kp kq kr bi translated">git push -u原始主机</li></ol><p id="b4b2" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们已经成功地将我们的大型模型推送到我们的远程回购。</p><p id="89c1" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你最后的回购应该是这样的:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mk"><img src="../Images/93076798488a7dd18608393408680b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEDz9qewxBH0piuyYHSX_A.png"/></div></div></figure><p id="f9a4" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">您可以查看我的Github资源库:</p><p id="6c08" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">【https://github.com/emmakodes/malaria_parasite_voila T4】</p><h1 id="129f" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">发布到活页夹</h1><p id="8949" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">Binder有助于将git repo转化为一系列交互式笔记本。</p><p id="2163" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">要在Binder上发布我们的web应用程序，我们需要遵循以下步骤:</p><p id="be99" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">1.转到<a class="ae jm" href="https://mybinder.org/" rel="noopener ugc nofollow" target="_blank">https://mybinder.org/</a>将该回购的URL粘贴到活页夹的URL字段。<br/> 2。更改“启动”按钮旁边的文件下拉列表，改为选择URL。<br/> 3。在“要打开的URL”栏中，输入/voila/render/name.ipynb(用您的笔记本名称替换名称)。</p><p id="4aa4" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在我们的例子中，它将是/voila/render/malaria_species_classifier . ipynb，因为“malaria _ species _ classifier”是上面上传到Github的笔记本的名称。</p><p id="3495" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">4.点击右下角的剪贴板按钮复制URL并粘贴到安全的地方<br/>。<br/> 5。单击启动。</p><p id="e5eb" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">第一次这样做时，Binder大约需要5分钟来构建您的站点。在幕后，它是找到一个可以运行您的应用程序的虚拟机，分配存储空间，并收集Jupyter、您的笔记本以及将您的笔记本呈现为web应用程序所需的文件。</p><p id="b06d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">最后，一旦应用程序开始运行，它会将您的浏览器导航到您的新web应用程序。您可以共享您复制的URL，以允许其他人也访问您的应用程序。</p><p id="f772" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">最终结果:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ml"><img src="../Images/c0d806bd8db5bd0b787a79d1f1200e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SUlbTGlOqB-fP0IAEBhyyw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">App正确预测卵圆形疟原虫的png图像</figcaption></figure><p id="d004" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">在这里查看最后的app:</strong><a class="ae jm" href="https://mybinder.org/v2/gh/emmakodes/malaria_parasite_voila/HEAD?urlpath=%2Fvoila%2Frender%2Fmalaria_species_classifier.ipynb" rel="noopener ugc nofollow" target="_blank">https://my binder . org/v2/GH/Emma Michael/malaria _寄生虫_voila/HEAD？URL path = % 2f voila % 2f fronder % 2f malaria _ species _ classifier . ipynb</a></p><p id="7a46" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">在twitter上关注我</strong> <a class="ae jm" href="https://twitter.com/emmakodes" rel="noopener ugc nofollow" target="_blank"> @emmakodes </a></p><p id="8642" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">领英:</strong>T22】https://www.linkedin.com/in/emmanuelonwuegbusi/</p><h1 id="7617" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">结论</h1><p id="66b0" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw lm jy jz ka ln kc kd ke lo kg kh ki ha bi translated">我们已经成功地将我们的模型部署到binder中。如果您遵循了该系列，您就已经了解了获取数据以构建深度学习模型以及将应用程序部署到Binder等平台的过程。</p><p id="079d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">第1部分:<a class="ae jm" href="https://emmamichaelo.medium.com/learn-the-process-of-data-sourcing-and-preparation-to-model-deployment-4936c3b1f7b8" rel="noopener">了解模型部署的数据来源和准备流程</a></p><p id="ecb7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">第二部分:<a class="ae jm" href="https://emmamichaelo.medium.com/malaria-parasite-species-classification-using-fast-ai-4255b7ac1bff" rel="noopener">利用Fast.ai进行疟原虫种类分类</a></p><p id="926b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">参考文献</strong></p><p id="1af3" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">[1]杰瑞米·霍华德和西尔万·古格，Fastai和Pytorch的程序员深度学习(奥莱利媒体公司，2020年)</p><p id="2fae" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">PS:为了测试应用程序上传一个png图像。</p></div></div>    
</body>
</html>