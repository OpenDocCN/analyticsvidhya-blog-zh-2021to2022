<html>
<head>
<title>Music Generation with LSTM Based RNN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LSTM RNN的音乐一代</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/music-generation-with-lstm-based-rnn-3fa967bc1f37?source=collection_archive---------24-----------------------#2021-04-03">https://medium.com/analytics-vidhya/music-generation-with-lstm-based-rnn-3fa967bc1f37?source=collection_archive---------24-----------------------#2021-04-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d8a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大家好。在这篇文章中，我将尝试解释我所知道的基于LSTM(长短期记忆)的RNN(递归神经网络)的音乐生成。让我们首先检查我在模型的训练阶段使用的数据集包含什么样的信息。</p><h2 id="09ae" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">关于数据集</h2><p id="c37e" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">众所周知，音乐是用音符来表现的。我更喜欢在数据集中使用另一种音符系统，称为ABC符号，而不是Do、Re、Mi等风格的经典音符。在ABC符号中，数字和特殊字符与字母符号A到G一起用来表示给定的音符。每个字母对应古典音符中的Do、Re、Mi等古典音符。除了组成旋律的音符，其他单位作为附加信息；参考号、作曲家、出处、音符长度、速度、节奏键、装饰音等。这些值中的每一个都构成了我们数据集的特征。ABC记谱法经常被用来表现传统的民间音乐。我使用的数据集是从<a class="ae kc" href="https://cobb.ece.wisc.edu/irish/Tunebook.html" rel="noopener ugc nofollow" target="_blank">科布的爱尔兰民间音乐</a>【1】中编译而来的。下面你会看到数据集中用ABC符号表达的音乐样本。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="0de9" class="jc jd hh ki b fi km kn l ko kp">X:1 <br/>T:Alexander's <br/>Z: id:dc-hornpipe-1 <br/>M:C| <br/>L:1/8 <br/>K:D Major<br/>(3ABc|dAFA DFAd|fdcd FAdf|gfge fefd|(3efe (3dcB A2 (3ABc|! dAFA DFAd|fdcd FAdf|gfge fefd|(3efe dc d2:|! AG|FAdA FAdA|GBdB GBdB|Acec Acec|dfaf gecA|! FAdA FAdA|GBdB GBdB|Aceg fefd|(3efe dc d2:|!</span></pre><p id="112c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里，我们面临一个问题:我们的计算机能从包含字母和特殊字符的数据中理解吗？既然我们要用权重值乘以特征，那么B x 0.23将是一个不合逻辑的运算，这似乎不太可能，不是吗？为此，我们必须把数据转换成计算机能理解的格式。就像计算机把图像表示成包含像素值的矩阵一样，我们会给数据集中的每个音符赋予一个数值，不管是字母还是特殊字符。这种操作在文献中被称为编码。</p><p id="638e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了执行编码过程，我们首先借助下面的代码片段将所有歌曲收集到一个列表中。把这个列表中的每个原始字符提取出来，从小到大排序后，我们把它扔进<code class="du kq kr ks ki b">vocab</code>变量。<code class="du kq kr ks ki b">vocab</code>变量包含独特的字符，它们携带信息并代表我们的歌曲。然后我们定义允许我们给这些唯一的字符赋值的操作，也就是执行编码过程:<code class="du kq kr ks ki b">char2id</code>，它把字符映射到数字，还有，<code class="du kq kr ks ki b">idx2char</code>，它把数字映射到字符。</p><figure class="kd ke kf kg fd kt"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="76b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面您可以看到数据集中的每个独特的字符及其相应的数值。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="e724" class="jc jd hh ki b fi km kn l ko kp">{   <br/>   '\n':   0,<br/>   ' ' :   1,<br/>   '!' :   2,<br/>   '"' :   3,<br/>   '#' :   4,<br/>   "'" :   5,<br/>   '(' :   6,<br/>   ')' :   7,<br/>   ',' :   8,<br/>   '-' :   9,<br/>   '.' :  10,<br/>   '/' :  11,<br/>   '0' :  12,<br/>   '1' :  13,<br/>   '2' :  14,<br/>   '3' :  15,<br/>   '4' :  16,<br/>   '5' :  17,<br/>   '6' :  18,<br/>   '7' :  19,<br/>   ... <br/>}</span></pre><p id="faa0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们将上述操作合并成一个函数，以便更加模块化和有组织性。</p><figure class="kd ke kf kg fd kt"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="cdcf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">按照前面指定的字符编码过程，我们的样本数据包括字母、数字和特殊字符，如下所示。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="0f8b" class="jc jd hh ki b fi km kn l ko kp">'X:1\nT:Alex' &lt;---encoding---&gt; [49 22 13  0 45 22 26 67 60 79]</span></pre><p id="af63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这样，在对数据集执行预处理操作之后，我们现在就可以使用数据集了。</p><p id="39f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的下一步是将包含歌曲的文本分解成我们将在实际训练中使用的样本批次。我们提供给模型的每个输入字符串都包含与<code class="du kq kr ks ki b">seq_length</code>一样多的文本字符。此外，为了预测下一个字符，我们需要为每个输入序列定义一个目标序列，用于模型的训练。对于每个输入字符串，对应的目标字符串将包含相同长度的字符，除非有一个字符被向右移动。</p><p id="e3ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要做到这一点，我们必须将文本分成<code class="du kq kr ks ki b">seq_length + 1</code>。假设变量<code class="du kq kr ks ki b">seq_length</code>是3，我们的文本是“赫尔辛基”，我们的输入字符串将是“Hel ”,目标字符串将是“els”。</p><p id="69a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个函数，它的定义可以在下面看到，允许我们将这个字符串流转换成所需大小的数组。</p><figure class="kd ke kf kg fd kt"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="155e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为试验目的创建的批量样本输入系列，然后是预期值；</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="4f48" class="jc jd hh ki b fi km kn l ko kp">Step   0   input: 18 ('6')   expected output: 0 ('\n') <br/>Step   1   input: 0 ('\n')   expected output: 45 ('T') <br/>Step   2   input: 45 ('T')   expected output: 22 (':') <br/>Step   3   input: 22 (':')   expected output: 32 ('G') <br/>Step   4   input: 32 ('G')   expected output: 73 ('r')</span></pre><p id="2635" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是时候设计我们的模型了。我们可以在我们的模型中使用经典的人工神经网络，但由于我们称为音乐的旋律由一系列重复的音符组成，使用前馈技术的经典人工神经网络在这个问题上有些功能障碍。因为组成我们音乐的音符并不是相互独立的，相反，它们是以适应前一个的方式一个接一个地排列的。这就是为什么在我们的模型中，我们将使用RNN，这是一种更先进的人工神经网络算法，它为这种序列和重复问题提供了一个非常好的解决方案。除了经典的神经网络之外，该算法还可以将前一个节点的输出作为输入，同时将其输出作为并行和后一个节点的输入。下面您可以找到一个图表，从中可以看出前馈神经网络和递归神经网络(RNNs)之间的区别。</p><figure class="kd ke kf kg fd kt er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kw"><img src="../Images/8d75167d78d1dfda4abd001300a4d9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xu3Kg282H1n2KKwe.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">前馈NN vs递归NN(图片来源:<a class="ae kc" href="https://www.researchgate.net/figure/Feed-forward-and-recurrent-ANN-architecture_fig1_315111480" rel="noopener ugc nofollow" target="_blank">https://www . research gate . net/figure/Feed-forward-and-Recurrent-ANN-architecture _ fig 1 _ 315111480</a>)</figcaption></figure><p id="8e38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然它为一些问题提供了一个很好的解决方案，但是rnn也有一些缺失。其中之一是将数组元素的信息携带到某个过去的点以进行下一步的能力，换句话说，它们的内存非常短，当使用前面的元素时，算法开始变得困难。作为对此的解决方案，已经开发了旨在解决这种问题的门单元。有几种类型的门细胞，例如，LSTM(长短期记忆)和GRU。我们将使用其中的LSTM，我避免进入细节，因为它涉及一些复杂的数学运算，这些不是我们现在的重点。但是出于某种直觉，我在下面留下了一个可视化的LSTM门细胞。</p><figure class="kd ke kf kg fd kt er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lh"><img src="../Images/627942cacf9192dff59f7af68a4fc3b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k6TQJrYrBARnCjsr.gif"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">LSTM·萨尔马·普伦西比(gif来源:<a class="ae kc" href="https://becominghuman.ai/long-short-term-memory-part-1-3caca9889bbc" rel="noopener ugc nofollow" target="_blank">https://becoming human . ai/long-short-short-memory-part-1-3c ACA 9889 BBC</a></figcaption></figure><figure class="kd ke kf kg fd kt"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="2e28" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在下面看到我们模型摘要的输出。</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="6679" class="jc jd hh ki b fi km kn l ko kp">Model: "sequential" _________________________________________________________________ Layer (type)                 Output Shape              Param #    ================================================================= embedding (Embedding)        (32, None, 256)           21248      _________________________________________________________________ lstm (LSTM)                  (32, None, 1024)          5246976    _________________________________________________________________ dense (Dense)                (32, None, 83)            85075      ================================================================= Total params: 5,353,299 Trainable params: 5,353,299 Non-trainable params: 0 _________________________________________________________________</span></pre><p id="c790" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">训练结束后，模特会将LSTM RNN模特公司制作的音乐以弦乐的形式呈现给我们。我们复制这个序列，并将其粘贴到笔记本上，我们将在计算机上打开它，并将其保存为<code class="du kq kr ks ki b">.abc</code>扩展名。经过这个过程，你就可以听音乐曲目了。请记住，模型可能不会每次都产生成功的结果，可能需要产生多次才能产生声音好听的旋律。祝你尝试愉快。</p><p id="3449" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">培训结束时出现的独特音乐作品:</p><figure class="kd ke kf kg fd kt"><div class="bz dy l di"><div class="li kv l"/></div></figure><figure class="kd ke kf kg fd kt"><div class="bz dy l di"><div class="li kv l"/></div></figure><p id="2e97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我不想在这里分享所有的代码，因为这篇文章太长了。但是我在GitHub上分享了数据集和笔记本给大家体验，你可以在下面找到。下一篇文章再见。</p><div class="lj lk ez fb ll lm"><a href="https://github.com/erd3muysal/Music_Generation_with_LSTM_Based_RNN" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hi fi z dy lr ea eb ls ed ef hg bi translated">erd 3 muysal/Music _ Generation _ with _ LSTM _总部_RNN</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">通过在GitHub上创建帐户，为erd 3 muysal/Music _ Generation _ with _ Based _ RNN的发展做出贡献。</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">github.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma lb lm"/></div></div></a></div><h2 id="a4a5" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">资源</h2><p id="d504" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">[1]<a class="ae kc" href="https://cobb.ece.wisc.edu/irish/Tunebook.html" rel="noopener ugc nofollow" target="_blank">https://cobb.ece.wisc.edu/irish/Tunebook.html</a></p><p id="951c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[2]<a class="ae kc" href="https://machinelearningmastery.com/how-to-prepare-categorical-data-for-deep-learning-in-python/" rel="noopener ugc nofollow" target="_blank">https://machine learning mastery . com/how-to-prepare-categorial-data-for-deep-learning-in-python/</a></p><p id="b5b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kc" href="http://introtodeeplearning.com/" rel="noopener ugc nofollow" target="_blank">http://introtodeeplearning.com/</a></p><p id="4380" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[4]<a class="ae kc" href="https://stanford.edu/~shervine/l/tr/teaching/cs-230/cheatsheet-recurrent-neural-networks" rel="noopener ugc nofollow" target="_blank">https://Stanford . edu/~ sher vine/l/tr/teaching/cs-230/cheat sheet-recurrent-neural-networks</a></p></div></div>    
</body>
</html>