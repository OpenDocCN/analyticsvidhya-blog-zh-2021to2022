<html>
<head>
<title>Introduction to Pandas DataFrame.query() function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫DataFrame.query()函数介绍</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/introduction-to-pandas-dataframe-query-function-60b5408ae58b?source=collection_archive---------3-----------------------#2021-02-08">https://medium.com/analytics-vidhya/introduction-to-pandas-dataframe-query-function-60b5408ae58b?source=collection_archive---------3-----------------------#2021-02-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="7a1c" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">概观</h1><ul class=""><li id="f99c" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">有时，在EDA(探索性数据分析)过程中，选择或过滤数据框可能是一项乏味的任务</li><li id="71e4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Pandas DataFrame query()使用户能够像SQL中的where子句一样分析和过滤数据</li></ul><h1 id="feb7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="f50e" class="pw-post-body-paragraph jz ka hh je b jf jg kb kc jh ji kd ke jj kf kg kh jl ki kj kk jn kl km kn jp ha bi translated">Python是数据科学家主要使用的编程语言之一。这种语言激增的原因是它易于使用，并享有强大的社区支持，具有用于数据分析和预测建模的专用库。Pandas就是这样一个库，它被数据科学界广泛接受，用于执行数据清理和分析。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ko"><img src="../Images/d0fd0afc993d33643b625f8b6669a9aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NnpIntHfRdxl5hgn.jpg"/></div></div></figure><p id="da55" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">有时，在EDA(探索性数据分析)过程中，选择或过滤数据框可能是一项单调乏味的任务。因此，pandas提供了一些功能，即使对于初学者来说，这也是一件轻而易举的事情。查询是一个非常有用的功能。它使用户能够像SQL中的where子句一样分析和过滤数据。此外，它有助于以内存高效的方式同时编译几个条件，因为它不使用临时变量。</p><p id="df74" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">在本文中，我们将看到一个非常有趣的pandas数据框函数<a class="ae lf" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.query.html" rel="noopener ugc nofollow" target="_blank">查询。</a></p><h1 id="bc18" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">目录</h1><ol class=""><li id="1fe4" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp lg jr js jt bi translated">句法</li><li id="3b6b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp lg jr js jt bi translated">过滤IT部门的员工</li><li id="e8bf" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp lg jr js jt bi translated">不居住在印度的IT部门员工</li><li id="1429" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp lg jr js jt bi translated">OR条件的实现</li><li id="c80f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp lg jr js jt bi translated">使用环境变量</li><li id="ed8d" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp lg jr js jt bi translated">为什么使用查询？</li></ol><h1 id="112d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">句法</h1><p id="363b" class="pw-post-body-paragraph jz ka hh je b jf jg kb kc jh ji kd ke jj kf kg kh jl ki kj kk jn kl km kn jp ha bi translated">在开始查询之前，让我们先看一下语法。</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="d8d3" class="lm if hh li b fi ln lo l lp lq"><strong class="li hi">pandas.DataFrame.query(expr,inplace=false,**kwargs) <br/>expr:The condition to filter the data. <br/>inplace: weather the query modify the original data or return a modified copy. <br/>**kwargs: Any other keyword argument you want to pass</strong></span></pre><p id="398a" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">现在我们来看一些例子，看看这个神奇的函数如何简化您的分析。</p><p id="2d2e" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">让我们首先为演示创建一个数据帧</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="dec8" class="lm if hh li b fi ln lo l lp lq">import pandas as pd <br/>import numpy as np <br/>df= pd.DataFrame({'Name':['Vikram','John', 'Alex','Paul','Andrew','Rafel' ], <br/>'Age':[28,39,21,50,35,43], <br/>'Department':['HR', 'Finance','IT','HR','IT','IT'], <br/>'Country':['USA','India','Germany','USA','India','India'] }) print(df.head())</span></pre><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es lr"><img src="../Images/ebf71508e74a0b891b334ddc5ed29430.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/0*mpIoc2J_VwCB2KNC.png"/></div></figure><p id="113a" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">现在，让我们使用pandas为其DataFrame对象提供的查询函数来过滤数据集。</p><p id="e3ef" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">在本例中，我们只想选择为IT部门工作的员工。</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="6799" class="lm if hh li b fi ln lo l lp lq">import pandas as pd<br/>import numpy as np <br/>df= pd.DataFrame({'Name':['Vikram','John', 'Alex','Paul','Andrew','Rafel' ], <br/>'Age':[28,39,21,50,35,43],<br/>'Department':['HR', 'Finance','IT','HR','IT','IT'], <br/>'Country':['USA','India','Germany','USA','India','India'] }) print(df.query('Department == "IT"'))</span></pre><p id="f783" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">这是需要的结果。数据集中有所有IT部门的员工。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es ls"><img src="../Images/1f192bc0510c1dfb99f6ba1f2944e7f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/0*67oilJ5ubwZ2meMC.png"/></div></figure><p id="d85a" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">让我们再举一个用‘and’同时满足两个条件的例子。</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="57b0" class="lm if hh li b fi ln lo l lp lq">import pandas as pd <br/>import numpy as np <br/>df= pd.DataFrame({'Name':['Vikram','John', 'Alex','Paul','Andrew','Rafel' ], <br/>'Age':[28,39,21,50,35,43], 'Department':['HR', 'Finance','IT','HR','IT','IT'], <br/>'Country':['USA','India','Germany','USA','India','India'] }) print(df.query('Department == "IT" and Country != "India" '))</span></pre><p id="ef82" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">在数据集中，只有一个雇员同时满足这两个要求。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es lt"><img src="../Images/d4faff9661fc58b8b3e4998162e0a0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/0*3FyH63AysikKX422.png"/></div></figure><p id="f772" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">这里我们给出另一个例子来说明如何实现“OR”子句。这意味着选择满足第一个条件或另一个条件的记录。</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="819c" class="lm if hh li b fi ln lo l lp lq">import pandas as pd <br/>import numpy as np <br/>df= pd.DataFrame({'Name':['Vikram','John', 'Alex','Paul','Andrew','Rafel' ], <br/>'Age':[28,39,21,50,35,43], 'Department':['HR', 'Finance','IT','HR','IT','IT'], <br/>'Country':['USA','India','Germany','USA','India','India'] }) print(df.query('Age&gt;= 40 or Country =="India"'))</span></pre><h2 id="4d91" class="lm if hh bd ig lu lv lw ik lx ly lz io jj ma mb is jl mc md iw jn me mf ja mg bi translated">输出</h2><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es mh"><img src="../Images/2a3a87a346e0f93bd0b957e838dd8513.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/0*xjrYgPoqyh0YyJdH.png"/></div></figure><h1 id="d144" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用环境变量</h1><p id="c06b" class="pw-post-body-paragraph jz ka hh je b jf jg kb kc jh ji kd ke jj kf kg kh jl ki kj kk jn kl km kn jp ha bi translated">有时我们想在表达式中使用环境变量，我们可以在变量名前使用@。就像SQL一样，您可以使用子查询引用来选择满足条件的行。<em class="mi"> '@' </em>方法保存要比较的值。如下例所示。</p><p id="7f10" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">在示例中，Location是一个局部变量。要在查询表达式中使用它，你只需要在它前面加上@就可以了。</p><pre class="kp kq kr ks fd lh li lj lk aw ll bi"><span id="45ca" class="lm if hh li b fi ln lo l lp lq">import pandas as pd <br/>import numpy as np <br/>df= pd.DataFrame({'Name':['Vikram','John', 'Alex','Paul','Andrew','Rafel' ], <br/>'Age':[28,39,21,50,35,43], <br/>'Department':['HR', 'Finance','IT','HR','IT','IT'], <br/>'Country':['USA','India','Germany','USA','India','India'] } Location= " India" print(df.query( Country == @Location'))</span></pre><h2 id="de8e" class="lm if hh bd ig lu lv lw ik lx ly lz io jj ma mb is jl mc md iw jn me mf ja mg bi translated">输出</h2><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es lt"><img src="../Images/ce1783a781b106b1a4d3a573ca88ac40.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/0*ynShSZeoQOIJzSIS.png"/></div></figure><p id="5a84" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated"><strong class="je hi">注意</strong>:始终记住你的列名中是否有空格，但是在表达式中使用时在一对反斜杠(")之间，或者用" _ "替换空格</p><h1 id="01ad" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">为什么使用查询？</h1><p id="a344" class="pw-post-body-paragraph jz ka hh je b jf jg kb kc jh ji kd ke jj kf kg kh jl ki kj kk jn kl km kn jp ha bi translated">对于时间和空间的数据科学家或软件程序员来说，在考虑执行任务的方式时，复杂性是重要的方面。该查询方法对于较大的数据集非常有效。因为它节省了内存，也为用户提供了更清晰的语法。</p><h1 id="4f8b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">结束注释</h1><p id="82e0" class="pw-post-body-paragraph jz ka hh je b jf jg kb kc jh ji kd ke jj kf kg kh jl ki kj kk jn kl km kn jp ha bi translated">总之，这里我们看到了pandas.query，这是一个非常有用的函数，可以对数据帧进行切片和切块。如果你是python的绝对初学者，我会推荐你参加我们的<a class="ae lf" href="https://courses.analyticsvidhya.com/courses/introduction-to-data-science" rel="noopener ugc nofollow" target="_blank"> Python课程(免费)</a>，以增强你的Python基础。</p><p id="9bcd" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">最后，我有个任务给你。只需选择一个数据集，尝试不同的数据过滤方法，并比较它们的时间和内存效率。如果你想在评论中分享你的发现，那就太好了。</p><p id="a4e8" class="pw-post-body-paragraph jz ka hh je b jf la kb kc jh lb kd ke jj lc kg kh jl ld kj kk jn le km kn jp ha bi translated">另外，如果你有任何疑问，请在下面评论。</p></div></div>    
</body>
</html>