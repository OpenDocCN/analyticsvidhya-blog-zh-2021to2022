<html>
<head>
<title>Azure Data Factory — Access Microsoft Graph API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure数据工厂—访问Microsoft Graph API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-data-factory-access-microsoft-graph-api-3bbab165eb40?source=collection_archive---------4-----------------------#2021-05-30">https://medium.com/analytics-vidhya/azure-data-factory-access-microsoft-graph-api-3bbab165eb40?source=collection_archive---------4-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="6c28" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用服务主体访问Microsoft Graph API</h1><h1 id="4760" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步伐</h1><h1 id="0302" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建服务主体帐户</h1><ul class=""><li id="497a" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">创建新的服务主体</li><li id="f500" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated"><a class="ae ka" href="https://docs.microsoft.com/en-us/azure/azure-sql/database/authentication-aad-service-principal-tutorial" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/azure-SQL/database/authentic ation-aad-service-principal-tutorial</a></li><li id="e24a" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">分配Microsoft Graph -&gt;用户-&gt;用户。阅读。全部</li><li id="f36c" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创造一个秘密</li><li id="1d21" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">将客户端id和密码存储在Azure Keyvault中</li></ul><h1 id="0eea" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">Azure数据工厂</h1><ul class=""><li id="d7a4" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">在microsoft graph api中查看所有用户的整个流程</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/2f23b86d4f9709af9f87cc160f5e3359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hz0VoyPP63zxdWncPWYm-g.jpeg"/></div></div></figure><ul class=""><li id="51a2" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">首先，我们需要从密钥库中获取客户端id和密码</li><li id="cb6c" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">使用Web Acitivity获取秘密并分配给变量</li><li id="938c" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建新的管道</li><li id="aa7a" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建名为</li><li id="ac23" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">clientid</li><li id="352e" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">客户端秘密</li><li id="e009" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">代币</li><li id="67c0" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">现在登录azure门户网站</li><li id="9e14" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">转到Azure keyvault</li><li id="7363" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">转到机密并复制URL以访问</li><li id="a9a2" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">确保ADF管理的身份在keyvault中有参与者</li><li id="6a5f" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">还提供获取权限以读取azure keyvault中的密钥</li><li id="93df" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">现在让我们获取客户端id</li><li id="329b" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">拖动web活动</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ks"><img src="../Images/c58376aa862dfc138713130d2b9567ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DxrhghOODMHlziCE1DAbNw.jpeg"/></div></div></figure><ul class=""><li id="4c37" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">转到高级选项</li><li id="06d6" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">选择托管身份</li><li id="84eb" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">在URL框中粘贴以下内容</li></ul><pre class="kc kd ke kf fd kt ku kv kw aw kx bi"><span id="cb95" class="ky ig hi ku b fi kz la l lb lc"><a class="ae ka" href="https://vault.azure.net" rel="noopener ugc nofollow" target="_blank">https://vault.azure.net</a></span></pre><ul class=""><li id="b156" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">将输出分配给变量</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ld"><img src="../Images/d026fd2a9bedb5dca8dacd1a46b77d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVYS3Oc9W9JlKa9V3izoSA.jpeg"/></div></div></figure><ul class=""><li id="caee" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">现在让我们带来客户的秘密</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es le"><img src="../Images/a3ad36cb94af314b9a6cc8bda44f0467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLQXbTViOeeEWKRqoEB03w.jpeg"/></div></div></figure><ul class=""><li id="4f9b" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">转到高级选项</li><li id="904a" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">选择托管身份</li><li id="1d3a" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">在URL框中粘贴以下内容</li></ul><pre class="kc kd ke kf fd kt ku kv kw aw kx bi"><span id="4875" class="ky ig hi ku b fi kz la l lb lc">https://vault.azure.net</span></pre><ul class=""><li id="481b" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">分配给clientsecret变量</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lf"><img src="../Images/5f4a60fe84eeac703e0b04f48f2e1b47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YE2sRIT9utwbLYeBXzzDPQ.jpeg"/></div></div></figure><ul class=""><li id="350c" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">现在是时候获取用于microsoft graph的授权令牌了</li><li id="8ceb" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">在URL字段中</li></ul><pre class="kc kd ke kf fd kt ku kv kw aw kx bi"><span id="a7dc" class="ky ig hi ku b fi kz la l lb lc">https://login.microsoftonline.com/tenantid/oauth2/v2.0/token</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lg"><img src="../Images/5b7c93a8d812b0766d29acff2d59915e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ma2f4iGF1Mvug5HFmDDpTQ.jpeg"/></div></div></figure><ul class=""><li id="956d" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">下面是请求体的代码</li><li id="38cf" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">正文由客户机id和机密与租户id和范围连接而成</li></ul><pre class="kc kd ke kf fd kt ku kv kw aw kx bi"><span id="dbab" class="ky ig hi ku b fi kz la l lb lc">@concat(concat('tenant=tenantid&amp;client_id=',variables('clientid'),'&amp;client_secret='),variables('clientsecret'),'&amp;grant_type=client_credentials&amp;scope=https://graph.microsoft.com/.default')</span></pre><ul class=""><li id="eb2d" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">将令牌分配给名为token的变量</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lh"><img src="../Images/ad8822e8ab346bd610bfb15267ce2db5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xf65LG16unr4qDYHf_QGkg.jpeg"/></div></div></figure><ul class=""><li id="0877" class="jd je hi jf b jg kn ji ko jk kp jm kq jo kr jq jr js jt ju bi translated">现在调用Microsoft graph来检索数据</li><li id="e259" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">需要令牌进行授权</li></ul><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es li"><img src="../Images/2ebe0dacea8b1d54995c864037517f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjhHJ1qvKUfaE3zHRY5Ngw.jpeg"/></div></div></figure></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="709c" class="pw-post-body-paragraph lq lr hi jf b jg kn ls lt ji ko lu lv jk lw lx ly jm lz ma mb jo mc md me jq hb bi translated">原文—【github.com】samples 2021/graphapiaccess . MD at main balakreshnan/samples 2021</p></div></div>    
</body>
</html>