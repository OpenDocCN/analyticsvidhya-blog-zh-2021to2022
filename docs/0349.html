<html>
<head>
<title>How to create your own Question and Answering API(Flask+Docker +BERT) using haystack framework — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用haystack框架创建自己的问答API(Flask+Docker+BERT)——第一部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-your-question-and-answering-flask-api-using-haystack-e97205a240d1?source=collection_archive---------6-----------------------#2021-01-13">https://medium.com/analytics-vidhya/how-to-create-your-question-and-answering-flask-api-using-haystack-e97205a240d1?source=collection_archive---------6-----------------------#2021-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/920afc2ea2854408018232e6c0e53b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XvVnjCdgiQ4ckjuDaS4_g.jpeg"/></div></div></figure><blockquote class="iq ir is"><p id="8bca" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">作者说明:</strong></p><p id="e95b" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="hi">在这篇文章中，我们将学习如何使用python、flask和带有docker的</em> <a class="ae js" href="https://github.com/deepset-ai/haystack" rel="noopener ugc nofollow" target="_blank"> <em class="hi"> haystack </em> </a> <em class="hi">框架创建自己的问答(QA) API。haystack框架将提供完整的QA特性，它是高度可扩展和可定制的。在本文中</em> <a class="ae js" href="https://policy.medium.com/medium-rules-30e5502c4eb4" rel="noopener"> <em class="hi">中等规则</em> </a> <em class="hi">文本将被用作目标文档并对模型进行微调。</em></p><p id="1650" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">所需基础知识:</strong>弹性搜索&amp; Docker</p><p id="01bf" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="hi">这篇文章包含可以使用docker直接构建的工作代码。</em></p></blockquote><p id="0df6" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">文章内容</p><ol class=""><li id="f9fe" class="jw jx hi iw b ix iy jb jc jt jy ju jz jv ka jr kb kc kd ke bi translated">文档库设置—安装Elasticsearch</li><li id="22fc" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">API代码解释</li><li id="1ff9" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">在docker中构建Flask API</li><li id="45cf" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">从API加载数据</li><li id="ec67" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">API的演示</li><li id="fb18" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">微调模型</li><li id="0cec" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">代码调整(已培训/预培训)</li><li id="d7a5" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated">总结结果</li></ol><h1 id="e63d" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak"> 1。建立文档库</strong></h1><p id="73a7" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">Haystack rise对DocumentStore中提供的文档进行查询。haystack中包含了各种文档存储，分别是<strong class="iw hj">ElasticsearchDocumentStore</strong>、<strong class="iw hj"> SQLDocumentStore </strong>和<strong class="iw hj"> InMemoryDocumentStore </strong>。在这篇文章中，我将使用推荐的Elasticsearch。它提供了预加载的功能，如全文查询、BM25检索和文本嵌入的矢量存储。</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ln"><img src="../Images/5f8c298b3af1af5b35209bbb1bdaaac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuB8fP3aHrRnJcnMLISKJg.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">干草堆组件</figcaption></figure><p id="4af8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">运行以下命令安装Elasticsearch</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/568e025e0f14aad7938ff1651cb444d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*djDetbFKTFNtWK2zaeC14A.png"/></div></div></figure><p id="97ca" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">通过浏览下面的url验证安装。如果安装成功，它将显示如下:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/964df4507b2fe65409a86fc9a8fdf34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xyrFi-QIGa0oubO2WjjoFw.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">Elasticsearch服务器已启动</figcaption></figure><h1 id="854f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">2.API代码解释</h1><p id="1761" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">Haystack框架有3个主要的基本组件文档存储、检索器和阅读器，我们必须根据我们的需求来选择。</p><p id="d6e1" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj"> DocumentStore : </strong>作为推荐<strong class="iw hj"> <em class="iv">本文将使用ElasticsearchDocumentStore</em></strong><em class="iv">。它</em>预装了诸如全文查询、BM25检索和文本嵌入矢量存储等功能。在建立索引之前，应该将文档分成更小的单元(例如段落),以使检索器返回的结果更加精确。</p><p id="b30d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">检索器:</strong>答案需要根据嵌入的相似性显示。因此<strong class="iw hj"> DensePassageRetriever </strong>是对文本相似性评分的有力替代。</p><p id="0ffe" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">读者:</strong>如果您希望使用Transformer阅读器，本文将使用Farm阅读器。为了更准确，读者将使用“蒸馏-基础-无壳-蒸馏-小队”模型</p><p id="96bf" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">app结构如下所示:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/25104292ef0b1519f0b9b89096ba5f94.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*5eI_gtGPtJlTppdN-fGhSA.png"/></div></figure><p id="1dfb" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj">main . py的代码解释</strong></p><p id="3612" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">在本文中，我们将使用ElasticSearch文档。应用程序配置声明如下:</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="fc13" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">让我们实现上传PDF文档的端点。pdf文档将以提供的索引名称上传到ElasticSearch中。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b21f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">让我们实现查询的端点，并将从ElasticSearch文档中获得相关的(n)答案。需要在搜索查询期间提供索引。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="3bfe" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj"> requirement.txt </strong></p><p id="6ded" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">烧瓶<br/> gunicorn <br/>期货<br/>农场干草堆</p><p id="1cb8" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><strong class="iw hj"> Docker文件</strong></p><p id="9b98" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">QNA API将在端口8777可用。</p><figure class="lo lp lq lr fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><h1 id="f46d" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">4.在docker中构建Flask API</h1><p id="dd5b" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">让我们运行下面的命令来构建docker映像:</p><blockquote class="iq ir is"><p id="39f0" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">docker build -t qna:v1。</p></blockquote><p id="0b4d" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">使用以下命令在docker容器中构建并运行flask API:</p><blockquote class="iq ir is"><p id="a98e" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">码头运行-名称qna_app -d -p 8777:8777 xxxxxxxxx</p></blockquote><p id="3256" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated"><em class="iv">注意:</em> xxxxxxxxx是图像id</p><p id="697a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">使用以下命令确认docker容器:</p><blockquote class="iq ir is"><p id="3155" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">docker ps</p></blockquote><p id="9964" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">它将显示所有的过程如下:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/73ded7561812c1662ded869aadebd7d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qP0IJr9gSSnaU4_P0GqNyw.jpeg"/></div></div></figure><p id="6efb" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">现在QNA API已经成功运行@<a class="ae js" href="http://localhost:8777" rel="noopener ugc nofollow" target="_blank">http://localhost:8777</a></p><h1 id="5d2d" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">4.从API加载数据</h1><p id="6499" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">让我们从<a class="ae js" href="https://policy.medium.com/medium-rules-30e5502c4eb4" rel="noopener"> <em class="iv">介质规则</em> </a> <em class="iv"> </em>准备pdf文档，该文档应该上传到弹性搜索文档中。准备好pdf文档后，使用API上传，如下图所示:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/6e8cd2ab201506792cb42458bda10863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2gVdurWAKIaHAFTNO7prHw.jpeg"/></div></div></figure><p id="3b34" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">验证以下快照中的上传文档:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/f1a3780c7b352e0099f3b98485f720d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ja2uE_F3IgP2GVdKhLUaFA.jpeg"/></div></div></figure><h1 id="4c04" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">5.API的演示</h1><p id="1843" class="pw-post-body-paragraph it iu hi iw b ix li iz ja jb lj jd je jt lk jh ji ju ll jl jm jv lm jp jq jr hb bi translated">让我们使用qna_pretrain端点问一个问题。目前，我们仅使用预训练模型“<strong class="iw hj">蒸馏-基础-无壳-蒸馏-小队”</strong>，它提供了良好的准确性。在下一篇文章中，我将演示如何注释和改进模型。要查询问题，请使用API，如下图所示:</p><figure class="lo lp lq lr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/6a4e1aa1efd5be32c65236f2ce753a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_c6dCNktxm7_mhoTd5jlfw.png"/></div></div></figure><blockquote class="iq ir is"><p id="7532" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://kohinoor-soubam.medium.com/how-to-create-your-own-question-and-answering-api-flask-docker-bert-using-haystack-framework-7084208c2e7e" rel="noopener">如何使用haystack框架创建自己的问答API(Flask+Docker+BERT)——第二部分</a></p></blockquote><p id="738b" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je jt jg jh ji ju jk jl jm jv jo jp jq jr hb bi translated">完整的源代码可从<a class="ae js" href="https://github.com/Kohimax/qna-api" rel="noopener ugc nofollow" target="_blank">这里</a>获得</p><h1 id="a480" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">参考文献</strong></h1><ol class=""><li id="31b4" class="jw jx hi iw b ix li jb lj jt me ju mf jv mg jr kb kc kd ke bi translated"><a class="ae js" href="https://github.com/deepset-ai/haystack" rel="noopener ugc nofollow" target="_blank">https://github.com/deepset-ai/haystack</a></li><li id="3b78" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated"><a class="ae js" href="https://github.com/deepset-ai/haystack/tree/master/annotation_tool" rel="noopener ugc nofollow" target="_blank">https://github . com/deepset-ai/haystack/tree/master/annotation _ tool</a></li><li id="10ab" class="jw jx hi iw b ix kf jb kg jt kh ju ki jv kj jr kb kc kd ke bi translated"><a class="ae js" href="https://github.com/deepset-ai/haystack/blob/master/tutorials/Tutorial2_Finetune_a_model_on_your_data.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/deepset-ai/haystack/blob/master/tutoria L2 _ fine tune _ a _ model _ on _ your _ data . ipynb</a></li></ol><h1 id="30ef" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">如果这篇文章有帮助，请点击拍手👏按钮下面几下，以示支持！⬇⬇</h1></div></div>    
</body>
</html>