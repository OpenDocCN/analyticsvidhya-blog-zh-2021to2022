<html>
<head>
<title>Pandas: Group time series data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫:分组时间序列数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pandas-group-time-series-data-d889e4bc0657?source=collection_archive---------4-----------------------#2021-03-10">https://medium.com/analytics-vidhya/pandas-group-time-series-data-d889e4bc0657?source=collection_archive---------4-----------------------#2021-03-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/4b45a244505f0a2faf9d19b03a1006a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*idQYomQJ1W3Em8bu"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">马库斯·温克勒在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="0f94" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，我们将尝试对一个庞大的时间序列数据进行宏观分析。股票市场数据就是这种数据的一个很好的例子，这种数据每秒钟收集一次，可能长达几十年。</p><p id="f28a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了更好地理解时间序列数据，最好绘制它，这就是我将在本文中讨论的代码中使用的应用程序。</p><p id="e083" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你想了解股票在过去一年的表现，就不需要查看每小时收集的数据。可能不是每一分钟，也肯定不是每一秒钟。每天一个数据点将帮助我们了解一年中的高点和低点。</p><p id="e027" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了从每秒收集的数据集中获取每天的数据点，我们需要使用min、max或average操作将一天收集的数据点分组到一个数据集中。</p><p id="e6aa" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">python中的Pandas包提供了这样一种功能，只使用一个名为频率的参数对时间序列数据进行分组。这就是我们将在本文中探讨的内容。</p><p id="37d5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这里，我们将使用为特斯拉股票收集的数据，这些数据已经存在了大约10年。下面是显示我如何下载数据的代码。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">下载历史股票数据的Python代码</figcaption></figure><p id="82f0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用的包装是<code class="du jy jz ka kb b">yfinance</code>你可以在这里找到详细的<a class="ae it" href="https://aroussi.com/post/python-yahoo-finance" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="kc kd ez fb ke kf"><a href="https://aroussi.com/post/python-yahoo-finance" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hi fi z dy kk ea eb kl ed ef hg bi translated">可靠地从雅虎下载历史市场数据！用Python融资</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">自从雅虎！财务部门停止使用他们的历史数据API，Python开发人员寻找可靠的解决方法…</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">aroussi.com</p></div></div><div class="ko l"><div class="kp l kq kr ks ko kt in kf"/></div></div></a></div><p id="ac31" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我将使用这些数据创建类似于我们在网站上看到的显示股票市场趋势的图表。这些图将针对过去1天、5天、1个月、6个月、年初至今、1年、5年的数据以及可用的最大数据。</p><div class="kc kd ez fb ke kf"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Grouper.html" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hi fi z dy kk ea eb kl ed ef hg bi translated">熊猫。石斑鱼-熊猫1.2.3文档</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">Grouper允许用户为对象指定groupby指令。本规范将通过…选择一个列</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">pandas.pydata.org</p></div></div></div></a></div><p id="3804" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先让我们看看我将在本文中使用的来自Pandas的<code class="du jy jz ka kb b">Grouper</code>类。你可以在这里找到这个类<a class="ae it" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Grouper.html" rel="noopener ugc nofollow" target="_blank">的完整文档，但是，我们将把重点放在名为<code class="du jy jz ka kb b">freq</code>(频率)的参数上，该参数将帮助使用指定的频率对类型为<code class="du jy jz ka kb b">Datetime</code>的列进行分组，也称为</a><a class="ae it" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases" rel="noopener ugc nofollow" target="_blank">偏移别名</a>。</p><pre class="js jt ju jv fd ku kb kv kw aw kx bi"><span id="7d08" class="ky kz hh kb b fi la lb l lc ld">output = input.groupby(pd.Grouper(key='', freq='')).mean()</span></pre><p id="07ed" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du jy jz ka kb b">groupby</code>函数取类<code class="du jy jz ka kb b">Grouper</code>的一个实例，该实例又取列名<code class="du jy jz ka kb b">key</code>作为分组依据和分组频率。<code class="du jy jz ka kb b">freq</code>参数的范围可以从纳秒到一年。下表列出了我们将在本文中使用的频率子集。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="le jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">数据汇总</figcaption></figure><p id="e4a2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">作为分组依据的列成为索引。frequency参数可以只取定义频率的字符，或者在它前面加上一个数量来缩放它。示例:要按天分组，您可以使用<code class="du jy jz ka kb b">D</code>或<code class="du jy jz ka kb b">1D</code>。它们两者是等价的。要按周或7天分组，您可以使用<code class="du jy jz ka kb b">W</code>或<code class="du jy jz ka kb b">1W</code>或<code class="du jy jz ka kb b">7D</code>。</p><p id="567d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du jy jz ka kb b">subsetLastNDays</code>下面的函数是一个帮助函数，用来创建分组后的子集。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="fe41" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在下面的代码中，我遵循了4个简单的步骤。读取原始输入数据<br/> 2。分组和平均<br/> 3。根据需要对数据进行子集划分<br/> 4。保存输出数据</p><p id="0a90" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文的下一部分中，您将看到使用<a class="ae it" href="https://www.datawrapper.de/" rel="noopener ugc nofollow" target="_blank"> Datawrapper </a>根据表中提到的频率对输入数据进行分组的代码，以及从输出数据生成的图表。</p><p id="721a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">一天一分钟</strong></p><p id="8853" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下载的原始数据包含每分钟的数据。这里我只收集了前一天的数据。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一天，一分钟</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一天，一分钟</figcaption></figure><p id="b3cc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">五天三十分钟</strong></p><p id="a46f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这种情况下，我使用<code class="du jy jz ka kb b">T</code>参数按分钟分组，使用<code class="du jy jz ka kb b">30T</code>将30分钟的数据分组到一个数据点。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">五天三十分钟</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">五天三十分钟</figcaption></figure><p id="be90" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">一个月零一天</strong></p><p id="0ae4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里我们从每30分钟收集一次数据开始。为了按天分组，我使用了<code class="du jy jz ka kb b">D</code>值。不需要指定<code class="du jy jz ka kb b">1</code>按单位频率分组。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一个月，一天</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一个月，一天</figcaption></figure><p id="4a7f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">六个月零一天</strong></p><p id="f846" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里每1小时收集一次数据，但是不需要任何代码更改就可以对一天的数据进行分组。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">六个月零一天</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">六个月零一天</figcaption></figure><p id="65fe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">年初至今，某一天</strong></p><p id="ffef" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你也可以用24小时完成一天的分组。以下是方法。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">年初至今，一天</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">年初至今，一天</figcaption></figure><p id="bc0d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">一年零一天</strong></p><p id="3532" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">仅仅是为了启动另一个使用<code class="du jy jz ka kb b">B</code>的一天分组，工作日默认为周一到周五。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一年，一天</figcaption></figure><p id="db41" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你碰巧位于阿联酋，那里的典型商业周是从周日到周四。您可能希望使用<code class="du jy jz ka kb b">CB</code>自定义工作日选项，可以设置为:</p><pre class="js jt ju jv fd ku kb kv kw aw kx bi"><span id="7728" class="ky kz hh kb b fi la lb l lc ld">pd.offsets.CustomBusinessDay(weekmask='Sun Mon Tue Wed Thu')</span></pre><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">一年，一天</figcaption></figure><p id="b447" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">五年零一周</strong></p><p id="1eff" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用<code class="du jy jz ka kb b">1W</code>选项可以完成一周分组。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">五年零一周</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">五年零一周</figcaption></figure><p id="00d6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">最多一个月</strong></p><p id="942e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，对于一个月的组，使用选项<code class="du jy jz ka kb b">M</code>，将分组数据设置为该月的最后一天。将组合数据设置为一个月的最后一天来表示一个月中所有日子的平均值是有意义的。</p><p id="a733" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要将组合数据设置为每月的第一天，您可以使用<code class="du jy jz ka kb b">MS</code>偏移别名。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">最多一个月</figcaption></figure><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lf jx l"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">最多一个月</figcaption></figure><p id="2228" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有很多其他的抵消，我没有在这里讨论。我希望这篇文章能使其他频率的工作变得更容易。</p></div></div>    
</body>
</html>