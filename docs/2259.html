<html>
<head>
<title>From dogs to classifiers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从狗到分类器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/from-dogs-to-classifiers-2baf495e6a27?source=collection_archive---------21-----------------------#2021-04-14">https://medium.com/analytics-vidhya/from-dogs-to-classifiers-2baf495e6a27?source=collection_archive---------21-----------------------#2021-04-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="84a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将复杂性分解成corgi步骤</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/976f5315360aa30b93ca2c185325b50c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJJ0Qdebu_-PT29gZCJ6fw.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">照片由<a class="ae js" href="https://unsplash.com/@alvannee" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/@alvannee</a>拍摄</figcaption></figure><p id="bc2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有时候，你不必选择快乐而不是效率，在那些罕见的时刻，你会全力以赴。需要准备一个使用神经网络的顶点项目，但仍然以获得乐趣为目标？小狗来救援了！</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="10e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">问题陈述</strong></p><p id="5f26" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以首先要做的是。这个项目的目的是使用卷积神经网络(CNN)来帮助预测狗的品种。你可能会说品种不重要，重要的是蓬松度。事实上，出于许多原因，狗的品种识别被认为是必不可少的，特别是为了了解单个品种的状况、健康问题、互动行为等等。如果我创建的模型证明是成功的，它可以用于减少对大量未标记的狗图像数据进行分类所需的人工工作量。</p><p id="8a07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好消息是，有了当代的机器学习框架，如TensorFlow和用于图像识别的预训练模型，这项任务可以相当准确地完成，而无需花费太多精力和时间及资源。不过那都是理论，还是看看实践中如何吧！</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="6cf4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">解决问题的策略</strong></p><p id="ca61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我决定建立一个可以在web/app中使用的管道来处理用户拍摄的真实图像。该模型接受任何用户提供的图像作为输入。如果在图像中检测到狗，它将估计狗的品种。另一方面，如果检测到人类，它将提供一个相似的狗品种…哦，这是个阴谋！(你可以从下面判断，结果可能会变得真的令人不安，所以我正式将这个项目标记为PG-13。)</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ka"><img src="../Images/50f6a1fd20af4c45ecdf580f8033bd5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*-YqzxtTjLs1_rDrTIJo9Pg.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="4a50" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">指标</strong></p><p id="4a4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的旅程始于从零开始建立CNN，其结果是准确率低于4%。尽管结果并不令人满意，但考虑到模型过于简单，这是可以预料的。然而，需要注意的是，准确性不是一个人在训练模型时应该关注的通用指标:虽然它可能对某些目的很有用，但对其他目的来说，可能最好使用precision、recall或F1。我之所以决定使用准确度，是因为狗品种数据集的类别相对平衡，因此一个简单的准确度分数似乎就足够了。</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="99d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">数据探索和可视化</strong></p><p id="df15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Udacity给我提供了几个数据集:一个是狗的，另一个是人类的。</p><p id="7c5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">人类数据集由13，233张人脸图像组成，我用OpenCV算法检测了这些图像，<a class="ae js" href="https://docs.opencv.org/master/db/d28/tutorial_cascade_classifier.html" rel="noopener ugc nofollow" target="_blank"> Haar基于特征的级联分类器。</a></p><p id="d7ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">狗数据集由133个狗品种类别和8，351幅图像组成，其中6，680幅图像用于训练，835幅用于验证，836幅用于测试。整个小狗数据集被用来训练我的CNN模型。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kb"><img src="../Images/8c7fede1deac7dc073027f7855f0d128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vc97TyOiPDTHlra0TIn_xg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="c1ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如你从上面看到的，每个品种的狗平均有50张图片，最少的是41张，最多的是70张。虽然我以前提到过代表性相当平衡，但现在你们自己可以看到这一点。</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="d58e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">数据预处理</strong></p><p id="a197" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kc">人类图像:</em>在应用任何人脸检测算法之前，将图像转换成灰度是标准做法。因此，我使用了detectMultiScale(gray)函数，该函数执行存储在face_cascade中的Haar cascade分类器，并将灰度图像作为参数。</p><p id="99df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kc">狗图片:</em>这些图片有不同的大小和尺寸，所以作为预处理步骤的一部分，我必须将所有图片缩小到224 x 224像素，以适应我的网络架构。然后，图像被转换为4D张量，应用预处理_输入来为Keras中的任何预训练模型准备好4D张量。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kd"><img src="../Images/de96510c8d543db403713d8bec436708.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*Q1LlZq6qF4WaPfvGDngynA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="f32a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">实现&amp;建模</strong></p><p id="bcd3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用了以下能够提供最佳结果的架构:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ke"><img src="../Images/05a3cd12f6a0c05a2a6118f61dc73b85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*_lAHnB_b1N2vfMyTbYZvAw.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><ul class=""><li id="967a" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb kk kl km kn bi translated">我定义了<strong class="ig hi">四个递增大小的卷积滤波器</strong>(从8到16到32到64)。</li><li id="5e79" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">我使用2 的<strong class="ig hi">步幅，因为它跑得比1</strong>快得多(1<strong class="ig hi">跑得慢且不准确)。</strong></li><li id="6994" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">我选择了<strong class="ig hi"> GlobalAveragePooling </strong>,因为它是CNN中推荐的，以减少空间维度用于分类目的。</li><li id="9144" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">我选择了<strong class="ig hi"> 5个时期</strong>，因为这是达到&gt; 1%精度所需要的全部时间。</li><li id="0547" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">我使用了<strong class="ig hi"> MaxPooling </strong>层来减少CNN层输入图像的尺寸，这也应该抵消了过度拟合的危险。</li></ul><p id="a078" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我试着在没有池层的情况下运行CNN，但是它运行得很慢，准确性也很低。这是因为池通常用于降维。在这里使用是安全的，因为相邻像素很可能是相似的，下采样不会降低分类器检测图像的能力。</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="cc4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">细化&amp;超参数调谐</strong></p><p id="0401" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">CNN的第一版远非史诗。它的准确率低于4%！但是让我们保持乐观:它仍然比随机的要好，但是是的，还有很大的改进空间。首先，我尝试使用VGG16模型，它返回了39%的准确率。然后我换了一个不同的预训练模型，Inception V3。这就是事情变得有趣的地方…</p><p id="e340" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我从Inception V3中获得了瓶颈特性，然后为它构建了一个架构。它在使用全局平均池时表现最佳，因为该方法减少了每个特征图的维度，同时保留了最重要的信息，这使得它成为一种高效而整洁的架构。我确保添加一个下降层，这将减少过度拟合。模型的最后一层用于预测狗的品种类别。</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="0054" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">模型评估和验证</strong></p><p id="677f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回到简单的OpenCV人脸检测器，它的表现相当好:它能够识别所有人的100%；然而，它也确定了11%的狗是人类…</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kt"><img src="../Images/e1096785ec7926b1ef4ab7bf13e3cc14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2IstFT4d2ze73rkKc-_Mg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="9190" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一方面，狗检测器能够确认所有狗100%是狗。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ku"><img src="../Images/1ab96484f707310e28b1c77edce493e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*5OiJSlZB-Eacl2r4rRVprA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure><p id="d400" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用犬种分类模型，训练准确度(在50个时期之后)达到95%以上，而验证准确度低得多(85%)。此外，测试精度仅达到80%，表明该模型不幸地过度拟合。这可能是因为我们仍然使用非常小的数据集，只有133个类别和6，680幅训练图像。但是，嘿，情况可能会更糟！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kv"><img src="../Images/ee368f184fdb265d363e64c583789bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fuHq_cSbMQaeYj7xCNAPMA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">作者图片</figcaption></figure></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><div class="jd je jf jg fd ab cb"><figure class="kw jh kx ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><img src="../Images/4817f2f4a57b1f93a4bfbbdfc37b62e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*FPej00VU7uk9tNM5_0yNTQ.png"/></div></figure><figure class="kw jh lc ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><img src="../Images/5c248aeaff51e47e8491266a2218d6a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*suzFeFHiV0IVnSk6p_Kb4Q.png"/></div></figure><figure class="kw jh ld ky kz la lb paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><img src="../Images/d33d38a05fbd2dcfe73d5d9b2dcf3edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*YC7u6s7oVTnLNRKFMk-NwA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx le di lf lg translated">作者图片</figcaption></figure></div></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="97ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论</strong></p><p id="6aeb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我从一个准确率只有3.7%的CNN模型开始，使用迁移学习训练了两个准确率分别为39% (VGG-16)和80% (Inception-V3)的模型。我发现具有挑战性的是选择正确的模型以及漫长的训练时间。另一方面，我发现有趣的是，当提供一个人的图像时，模型识别出一个相似的狗品种。除了我们自己的巨蟒先生，还有谁会给我看一张人类的照片并声称它像一只獒犬？</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="f5d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">改进</strong></p><p id="14b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的模型表现如预期:很好，但不完美。该算法仍然可以改进:人们可能会改变超参数，增加训练数据集，并使用会引入图像变化的数据增强技术，因此该模型可以更好地概括其学习，并进一步提高准确性。</p></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="4f3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">资源</strong></p><p id="6c1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Udacity提供了数据集，因此不需要外部资源。实际完成的工作可以在我的Git上找到。</p></div></div>    
</body>
</html>