<html>
<head>
<title>MLOps in Azure using Python SDK — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python SDK在Azure中执行MLOps第1部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/building-ml-pipelines-in-azure-using-python-sdk-part-1-448d241d3a7c?source=collection_archive---------4-----------------------#2021-07-08">https://medium.com/analytics-vidhya/building-ml-pipelines-in-azure-using-python-sdk-part-1-448d241d3a7c?source=collection_archive---------4-----------------------#2021-07-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="4b7e" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用AzureML SDK的MLOps简介</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/0ed983e539cca4c46a57a30534f02b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9AKYPl6dT_5MtM032nZ6PQ.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">来源:<a href="’&lt;a" class="ae jm" rel="noopener ugc nofollow" target="_blank">https://www.freepik.com/vectors/design'</a>&gt;宏向量创建的设计向量——<a class="ae jm" href="http://www.freepik.com" rel="noopener ugc nofollow" target="_blank">www.freepik.com</a>&lt;/a&gt;</figcaption></figure><p id="60a9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">将机器学习项目投入生产涉及多个组件——数据工程、DevOps和机器学习。这些组件的交集是MLOps。<strong class="jp hi"> MLOps(机器学习+ DevOps)是将机器学习项目投入生产的过程——目标是自动化和提高生产模型的质量，同时也关注业务和监管要求。</strong></p><h1 id="9630" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">MLOps中的关键阶段</h1><ol class=""><li id="da7b" class="lb lc hh jp b jq ld jt le jw lf ka lg ke lh ki li lj lk ll bi translated">数据采集</li><li id="20cd" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">数据分析</li><li id="b94a" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">数据转换/清理</li><li id="a3cb" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">模型培训和开发</li><li id="7b51" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">模型验证</li><li id="c5ba" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">部署模型</li><li id="e654" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">将模型作为web应用程序或API</li><li id="45e9" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">模型再训练</li></ol><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lr"><img src="../Images/474da80056556f44b278bb9cb57221f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Akj1EnM6-Jg21cDBi2ec0g.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">MLOps管道(图片提供:<a class="ae jm" href="https://docs.microsoft.com/en-us/samples/microsoft/mlopspython/mlops-with-azure-ml/" rel="noopener ugc nofollow" target="_blank">微软Azure文档</a>)</figcaption></figure><p id="6507" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">MLOps的另一个关键特性是，我们还希望跨实验跟踪指标，例如，需要跨各种超参数跟踪模型的表现，以便我们可以选择最佳模型。</p><p id="ea01" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在MLOps中，除了DevOps中常见的测试实践(如单元测试、集成测试)之外，我们还必须测试数据模式、模型并验证数据。此外，作为持续部署的一部分，在MLOps中，培训渠道的变化也应反映在模型的部署或服务上。</p><h1 id="471c" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">Azure和一些术语的介绍</h1><p id="5bff" class="pw-post-body-paragraph jn jo hh jp b jq ld ii js jt le il jv jw ls jy jz ka lt kc kd ke lu kg kh ki ha bi translated"><a class="ae jm" href="https://www.simplilearn.com/putting-the-cloud-to-work-for-your-business-with-microsoft-azure-article" rel="noopener ugc nofollow" target="_blank"> Azure是一个云计算平台</a>和一个在线门户，允许您访问和管理微软提供的云服务和资源。这些服务和资源包括存储数据和转换数据，具体取决于您的需求。</p><p id="8b50" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">比较AWS和Azure(全球)的Google Trends向我们展示了两个云平台之间的差距正在缩小，了解至少一个云平台已经变得势在必行。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lv"><img src="../Images/8b311332b145c24caf4c5baf8b8c01db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwtp3VC4PD4XX0-_fYQkeg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">Azure和AWS之间的Google趋势比较</figcaption></figure><p id="9e6e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">虽然Azure ML Studio有一个设计工具来使用拖放组件构建ML管道，但在本文中，我们将了解如何创建工作区，连接到计算机并将数据从您的机器上传到Azure中的存储帐户。在我们深入挖掘之前，有必要看一下Azure中常用的几个关键术语</p><ol class=""><li id="e9fc" class="lb lc hh jp b jq jr jt ju jw lw ka lx ke ly ki li lj lk ll bi translated"><strong class="jp hi">资源组:</strong> Azure资源组是虚拟机、存储帐户、虚拟网络、web应用、数据库和/或数据库服务器的逻辑集合。<strong class="jp hi">例如</strong>:当你为机器学习创建一个资源组时，你会看到像KeyVault、App Insights、一个存储账户和ML Studio这样的资源被创建为资源组的一部分。</li><li id="f93a" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated"><strong class="jp hi">工作区:</strong>工作区是Azure机器学习的顶级资源，提供了一个集中的地方来处理您在使用Azure机器学习时创建的所有工件。工作区保存了所有训练运行的历史，包括日志、指标、输出和脚本的快照。</li><li id="b351" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated">计算实例:Azure机器学习计算实例是面向数据科学家的托管的基于云的工作站。Azure为我们提供了各种类型的计算实例，用于训练和推理。计算集群用于培训，而对于部署，我们可以使用Kubernetes推理集群。</li><li id="7fee" class="lb lc hh jp b jq lm jt ln jw lo ka lp ke lq ki li lj lk ll bi translated"><strong class="jp hi">存储帐户:</strong>Azure存储帐户包含所有Azure存储数据对象:blobs、文件共享、队列、表和磁盘。存储帐户为您的Azure存储数据提供了一个唯一的命名空间，您可以通过HTTP或HTTPS从世界任何地方访问该命名空间。您的存储帐户中的数据是持久的、高度可用的、安全的和可大规模扩展的。</li></ol><h1 id="4f24" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">正在安装Azure Python SDK</h1><p id="e000" class="pw-post-body-paragraph jn jo hh jp b jq ld ii js jt le il jv jw ls jy jz ka lt kc kd ke lu kg kh ki ha bi translated"><strong class="jp hi">注意:</strong>你可以创建一个免费的Azure帐户，并获得一个月200美元的免费点数</p><p id="bac2" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">创建新的Conda环境:</strong></p><pre class="ix iy iz ja fd lz ma mb mc aw md bi"><span id="5e66" class="me kk hh ma b fi mf mg l mh mi"><em class="mj">conda create -n azure_ml python=3.6</em></span></pre><p id="28dc" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">安装azureml-sdk: </strong></p><pre class="ix iy iz ja fd lz ma mb mc aw md bi"><span id="f0a9" class="me kk hh ma b fi mf mg l mh mi"><em class="mj">conda activate azure_ml</em></span><span id="c2ba" class="me kk hh ma b fi mk mg l mh mi"><em class="mj">pip install azureml-sdk[notebooks,tensorboard,interpret,automl]</em></span></pre><p id="ed92" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">要检查azureml-sdk是否已正确安装，可以使用以下代码:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">正在检查azureml sdk是否已正确安装</figcaption></figure><p id="9c63" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">创建ML工作空间</strong></p><p id="0259" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">为了使用Azure进行机器学习，我们需要创建一个ML工作空间——这意味着，我们需要创建一个包含存储帐户的资源组(用于存储日志、模型、数据等。)、一个密钥库、App Insights和ML Studio。在此之前，我们需要获得Azure的订阅id。这是机密的，最好保存为环境变量(我已经保存在配置文件中)。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mn"><img src="../Images/764ab332df2b6e185ffbc1d7889fe806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMx_aCA6aShl17zh-Giuyw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">从Azure获取订阅ID</figcaption></figure><p id="6806" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">要创建工作区，您需要现有资源组的名称或者您可以创建新的资源组、您的订阅id、需要创建服务器和虚拟机的位置、您的工作区的名称。要创建一个不存在的资源组，必须设置create_resource_group=True</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">创建新的工作空间</figcaption></figure><p id="888e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果你运行上面的代码——你会在Azure门户上看到下面创建的资源</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mo"><img src="../Images/1894d59cf5a89eae1c6521b7e67bb1c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NUkLwjIVKdS7zgxFD44vmQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">在Azure上创建的ML工作空间</figcaption></figure><p id="19fb" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">一旦我们创建了工作区，我们就可以在工作区上保存详细信息，并在以后加载它。<strong class="jp hi">如果没有提供路径，保存工作区配置会在当前目录下创建一个. azureml文件夹</strong></p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">保存和加载Azure工作区</figcaption></figure><h1 id="e8ec" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated"><strong class="ak">创建一个计算实例</strong></h1><p id="9060" class="pw-post-body-paragraph jn jo hh jp b jq ld ii js jt le il jv jw ls jy jz ka lt kc kd ke lu kg kh ki ha bi translated">在Azure上，我们可以创建一台在CPU或GPU上运行计算机。对于机器学习训练，我们使用计算集群。要创建计算目标，我们需要传递以下内容:</p><p id="ad2c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> vm_size </strong> —描述集群中使用的虚拟机类型和大小。集群中的所有机器都是同一类型。您可以从ML Studio Workspace获得CPU或GPU的虚拟机名称</p><div class="ix iy iz ja fd ab cb"><figure class="mp jb mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><img src="../Images/4d7f8abcc5d1455bdfe269c2f0f2a771.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*fuuR29_WYTTL4P_Tm7YREg.png"/></div></figure><figure class="mp jb mv mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><img src="../Images/8e13427ca7053f1da099472193265924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*BuAVyWVjM4V74Jrm9NJFAA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx mw di mx my translated">为GPU和CPU选择虚拟机名称</figcaption></figure></div><p id="bbdc" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">节点</strong> —设置集群的最小大小。如果将最小值设置为0，群集将在不使用时关闭所有节点。将该数字设置为大于0的值将允许更快的启动时间，但是当群集未被使用时，您也将被计费</p><p id="f704" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> max_nodes </strong> —设置集群的最大大小。将此值设置为一个较大的值，可以实现更高的并发性和对扩展作业更大的分布式处理。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">创建CPU计算集群(将vm_size参数更改为GPU实例名称，以便使用GPU)</figcaption></figure><h1 id="0dd9" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">将数据推送到存储帐户— Azure Blob存储</h1><p id="9cd6" class="pw-post-body-paragraph jn jo hh jp b jq ld ii js jt le il jv jw ls jy jz ka lt kc kd ke lu kg kh ki ha bi translated">Azure提供了一些样本数据集，但大多数情况下，我们需要处理自己的数据——这意味着我们需要将数据上传到存储帐户，然后对其进行处理。您可以创建不属于ML资源组的存储帐户，也可以使用在ML资源组中创建的存储帐户。这里，我使用在创建工作区时创建的存储帐户。</p><p id="50c9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">要将数据上传到存储帐户，我们需要创建一个容器并在其中上传数据——为此，您需要连接字符串</strong>(这是机密的，最好将其保存为环境变量)</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mz"><img src="../Images/30c92ad51e50927b14c8f8f6b917a843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i88Bwek9FuGCoyxqsXniVg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">获取连接字符串—您可以通过单击Show Keys来选择任一连接字符串</figcaption></figure><p id="a509" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们可以使用BlobServiceClient对象来创建容器客户端。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">创建容器</figcaption></figure><p id="f89f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">出于本教程的目的，让我们使用来自Kaggle 的<a class="ae jm" href="https://www.kaggle.com/parulpandey/palmer-archipelago-antarctica-penguin-data" rel="noopener ugc nofollow" target="_blank">帕尔默企鹅数据集。下载数据集并将其添加到文件夹中。现在，您可以使用blob_service_client对象将数据集上传到存储帐户</a></p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">将Palmer数据集上传到存储帐户</figcaption></figure><p id="491b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">成功上传数据后，您可以在Azure门户上看到数据。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es na"><img src="../Images/4c3006f2fcd5f4d9131ee950f4bc46fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ufiKeyy7J56oOPB11H_xeQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">帕尔默企鹅数据上传到Azure门户网站的容器内创建</figcaption></figure><h1 id="d7e9" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">访问ML工作区中的存储帐户数据</h1><p id="761a" class="pw-post-body-paragraph jn jo hh jp b jq ld ii js jt le il jv jw ls jy jz ka lt kc kd ke lu kg kh ki ha bi translated">要访问Azure Blob存储中上传的数据集，您需要将文件添加到一个<strong class="jp hi">数据存储库</strong>。</p><p id="b8d5" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">数据存储附加到工作区，用于存储Azure存储帐户的连接信息，以便您可以通过名称引用它们，而不必记住用于连接到存储帐户的连接信息和密钥。</p><p id="2823" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">要将Azure Blob存储注册到数据存储中，我们需要来自存储帐户的“密钥”(这是机密的)。此外，在创建数据存储之前，请连接到工作区。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">在数据存储上注册存储帐户</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nb"><img src="../Images/553f792cf7074c6412e60ff8338fba7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3PAhy_KQZs52DK4KBiKkfg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">帕尔默企鹅数据更新到数据存储</figcaption></figure><p id="2e4b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">由于它是一个CSV文件，我们可以将其作为表格数据集读取，并将其转换为pandas数据框</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">从数据存储中读取企鹅大小数据</figcaption></figure><p id="f61d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">注意:<em class="mj">一旦您使用完工作区和您创建的任何其他资源，请将其删除，否则您将被收取相同的费用</em> </strong></p><p id="1bec" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">至此，我们已经了解了如何访问Azure上的数据以及如何连接到Compute。这是在Azure中构建ML管道的基本设置。在本文的下一部分，我们将研究如何构建培训和部署管道。</p><p id="49ef" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> <em class="mj">希望这篇文章有用，非常感谢任何反馈</em> </strong></p></div></div>    
</body>
</html>