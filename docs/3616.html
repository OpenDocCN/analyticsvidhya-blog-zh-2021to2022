<html>
<head>
<title>Azure Synapse Spark logs runtime errors to Application insights</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Synapse Spark将运行时错误记录到应用洞察中</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-synapse-spark-logs-runtime-errors-to-application-insights-b3d438c400b7?source=collection_archive---------6-----------------------#2021-07-13">https://medium.com/analytics-vidhya/azure-synapse-spark-logs-runtime-errors-to-application-insights-b3d438c400b7?source=collection_archive---------6-----------------------#2021-07-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="d182" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用open census库将错误日志推送到Azure monitor</h1><h1 id="523a" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="79ad" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="0b96" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure Synapse工作区</li><li id="9cbb" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储</li></ul><h1 id="53b3" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">步伐</h1><ul class=""><li id="6657" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建一个火花簇</li><li id="c987" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">安装库</li><li id="8212" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个conda文件并上传</li><li id="bb10" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创造环境. yml</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="eee9" class="ki if hh ke b fi kj kk l kl km">name: example-environment<br/>channels:<br/>  - conda-forge<br/>dependencies:<br/>  - python<br/>  - numpy<br/>  - pip<br/>  - pip:<br/>    - opencensus-ext-azure</span></pre><ul class=""><li id="5a89" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">上传yml文件</li><li id="2f1b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建笔记本</li></ul><h1 id="b920" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">密码</h1><ul class=""><li id="66a6" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">选择python作为语言</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="689f" class="ki if hh ke b fi kj kk l kl km">import logging<br/>from opencensus.ext.azure.log_exporter import AzureLogHandler</span><span id="0bd0" class="ki if hh ke b fi ks kk l kl km">logger = logging.getLogger(__name__)</span><span id="1173" class="ki if hh ke b fi ks kk l kl km"># TODO: replace the all-zero GUID with your instrumentation key.<br/>logger.addHandler(AzureLogHandler(<br/>    connection_string='InstrumentationKey=xxxxx-xxxxxx-xxxxxx-xxxxxxx')<br/>)</span></pre><ul class=""><li id="efe3" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在记录一些示例日志</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="62bf" class="ki if hh ke b fi kj kk l kl km">logger.warning("Sample from open census test 01")<br/>logger.error("Sample from open census test 02")</span></pre><ul class=""><li id="8547" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在让我们记录一个异常</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="ec4a" class="ki if hh ke b fi kj kk l kl km">from opencensus.ext.azure.trace_exporter import AzureExporter<br/>from opencensus.trace.samplers import ProbabilitySampler<br/>from opencensus.trace.tracer import Tracer</span><span id="242b" class="ki if hh ke b fi ks kk l kl km">properties = {'custom_dimensions': {'key_1': 'value_1', 'key_2': 'value_2'}}</span><span id="5af9" class="ki if hh ke b fi ks kk l kl km"># Use properties in exception logs<br/>try:<br/>    result = 1 / 0  # generate a ZeroDivisionError<br/>except Exception:<br/>    logger.exception('Captured an exception.', extra=properties)</span></pre><ul class=""><li id="31e7" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">登录应用洞察</li></ul><figure class="jz ka kb kc fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kt"><img src="../Images/281705dd2a5765871b46241cb4067bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JlwbWki2B1HOj87H.jpg"/></div></div></figure><figure class="jz ka kb kc fd ku er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lb"><img src="../Images/fae65bdbee5fe4ab5a31350bfc04f085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Iqa2GHcBg73jTDli.jpg"/></div></div></figure><ul class=""><li id="a53a" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">以上测试完成自—<a class="ae lc" href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/opencensus-python#configure-azure-monitor-exporters" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/azure-monitor/app/open census-python # configure-azure-monitor-exporters</a></li></ul><p id="00d0" class="pw-post-body-paragraph ld le hh je b jf kn lf lg jh ko lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">【github.com】的Samples2021/opencensuslog.md</p></div></div>    
</body>
</html>