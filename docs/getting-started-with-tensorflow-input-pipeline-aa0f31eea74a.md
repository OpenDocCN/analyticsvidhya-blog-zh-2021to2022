# Tensorflow è¾“å…¥ç®¡é“å…¥é—¨

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/getting-started-with-tensorflow-input-pipeline-aa0f31eea74a?source=collection_archive---------4----------------------->

TensorFlow è¾“å…¥ç®¡é“å…¥é—¨æŒ‡å—(tf.data.dataset)

# ä»‹ç»

å˜¿å¤§å®¶å¥½ï¼Œ

è¿™æ˜¯ä¸€ç¯‡å…³äºå¦‚ä½•ä½¿ç”¨ **Tensorflow çš„è¾“å…¥ç®¡é“çš„ç›¸å¯¹å¿«é€Ÿç®€å•çš„æ–‡ç« ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªé»‘åŒ£å­ï¼Œå› ä¸ºå®ƒçš„æ–‡æ¡£ä¸å¤ªå‹å¥½ï¼Œç±»å’Œä¸åŒ API çš„å¤æ‚æ€§ä½†æ˜¯æˆ‘è§‰å¾—å®ƒç›¸å¯¹å®¹æ˜“ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸æ‰“ç®—æ¢ç©¶æœ¬è´¨å’Œç»†èŠ‚ï¼Œç›¸åï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å°†ç¼–å†™ä¸€äº›ä»£ç æ¥è·å¾—å®è·µç»éªŒ**ã€‚**æ­¤å¤–ï¼Œå¦‚æœæ‚¨æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åœ¨ä¸‹é¢çš„è¯„è®ºåŒºæé—®ï¼Œæˆ‘ä¼šå°½å¿«å›å¤ã€‚**

# è®®ç¨‹

æ–‡ç« åˆ†ä¸ºä¸¤éƒ¨åˆ†:

- ***ç†è®ºéƒ¨åˆ†*** :å¿«é€Ÿç›´è§‚åœ°æ¶µç›–æ‰€æœ‰è¦ç‚¹ï¼Œè®©æ‚¨å¿«é€Ÿå…¥é—¨

- ***ç¼–ç éƒ¨åˆ†*** :ç”¨äºä¸€äº›åŠ¨æ‰‹ç»ƒä¹ ã€‚æˆ‘ä»¬å°†åœ¨åŸºç¡€ä¸Šå·¥ä½œï¼Œå¹¶å°†å®ƒä»¬åº”ç”¨åˆ°å›¾åƒæ•°æ®é›†(çŒ«å’Œç‹—)ã€‚

**æˆ‘ä¼šæ•¦ä¿ƒä½ æŒ‰ç…§ä½ çš„ç¼–ç éƒ¨åˆ†ï¼Œå»ºç«‹æ¦‚å¿µã€‚**

# ç¬¬ 1 éƒ¨åˆ†-ç†è®º

# ä»€ä¹ˆæ˜¯å¼ é‡æµè¾“å…¥ç®¡é“

è¾“å…¥ç®¡é“æ˜¯`tf.data` *api* ä¸­æä¾›çš„ä¸€ä¸ªå¿«é€Ÿç®€å•çš„å·¥å…·ï¼Œå¯ä»¥ç”¨ç®€å•çš„å¯é‡ç”¨ä»£ç å’Œå‡ è¡Œä»£ç åˆ›å»ºå¤æ‚çš„è¾“å…¥ç®¡é“ã€‚å®ƒè¿˜å…è®¸å¤„ç†å¤§é‡æ•°æ®ï¼Œä»è€Œä½¿ä½ç«¯æœºå™¨åœ¨è®¡ç®—æ•°æ®æ–¹é¢å…·æœ‰ä¼˜åŠ¿ã€‚

å®ƒé€šè¿‡å°†æ•°æ®åŒ…è£…åˆ° `tf.data.dataset`ç±»ä¸­å¹¶å¯¹å…¶æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œæ¥å®ç°ï¼Œè¿™äº›æ“ä½œç§°ä¸º ETL - **æå–ã€è½¬æ¢ã€åŠ è½½ã€‚**

# æœ‰ä»€ä¹ˆå¥½å¤„

ä½¿ç”¨å®ƒçš„å¥½å¤„å¦‚ä¸‹:

1.**åŠ è½½æ•°æ®:**æ•°æ®ä»¥`tf.data.dataset` ç»“æ„æˆ–æ‰¹å¤„ç†çš„æ–¹å¼åˆ†å—åŠ è½½ï¼Œå…è®¸åœ¨ä¿ç•™å†…å­˜ç©ºé—´çš„åŒæ—¶ç®¡ç†å’ŒåŠ è½½å¤§é‡æ•°æ®ã€‚æ­¤å¤–ï¼Œå®ƒå…è®¸æ”¯æŒä¸åŒçš„æ•°æ®æ ¼å¼å’Œç±»å‹ï¼ŒåŒ…æ‹¬äº‘å­˜å‚¨(S3)ã€‚

2.**æ•°æ®å¤„ç†/æ‰©å……:-** ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯é€šè¿‡`Pandas, Numpy -`æ–‡æœ¬/è¡¨æ ¼/æ•°å­—æ•°æ®ï¼Œæˆ–`Keras ImageDataGenerator / OpenCV-`å›¾åƒæ•°æ®æ¥å®Œæˆçš„ã€‚**ä½†æ˜¯åœ¨è¿™é‡Œï¼Œå®ƒå¯ä»¥åœ¨è¾“å…¥ç®¡é“æœ¬èº«ä¸­æ‰§è¡Œï¼Œä»è€Œåœ¨ç¼–ç çš„åŒæ—¶å…è®¸æ›´å¿«å’Œå¿«é€Ÿçš„åŸå‹åˆ¶ä½œ**ã€‚*è¿‡æ»¤ã€è´´å›¾ã€è°ƒæ•´å¤§å°ã€è£å‰ª*ç­‰ç­‰ã€‚

3.**æœ€åä¸€è¡Œ:**æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥åœ¨ä¸€è¡Œä»£ç ä¸­å®Œæˆï¼Œä»è€ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚ä¸‹é¢æ˜¯å®ƒçš„ä¸€ä¸ªç®€çŸ­ç‰‡æ®µå’Œè§£é‡Š:

![](img/1c696074466a884f957e24b6111a8728.png)

é€šç”¨è¾“å…¥ç®¡é“

4.å®ƒæ”¯æŒä¼ä¸šçš„åˆ†å¸ƒå¼å’Œå¹¶è¡Œè®¡ç®—ï¼Œè¿™å¯¹äºäº‘è®¡ç®—å’Œå¤§æ•°æ®è‡³å…³é‡è¦ã€‚

æ³¨æ„:- Tensors æ˜¯`tf.data.dataset`èƒŒåçš„åº•å±‚æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å®ƒä¸åŒäº **NumPy æ•°ç»„æˆ– Pandas dataframeã€‚ä¸è¦å¼„é”™äº†ğŸ˜‰ã€‚**

# ç¬¬ 2 éƒ¨åˆ†-ç¼–ç 

# 1.åŸºç¡€

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›æˆ‘ä»¬éœ€è¦å¼€å§‹çš„åŸºæœ¬ææ–™ã€‚æ‰€ä»¥â€œé¦–å…ˆâ€åŠ è½½æˆ‘ä»¬çš„æ•°æ®ã€‚

# åŠ è½½æ•°æ®

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„æœ€åŸºæœ¬çš„ä¸œè¥¿æ˜¯ä½¿ç”¨`tf.data.dataset.from_tensor_slices(list)` ä» python åˆ—è¡¨ä¸­åŠ è½½æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
# importing library
**import** tensorflow **as** tf # creating a list object- monthly expenses in dollars 
dataset = [12,15,67,-56,78,90,25,-890,-45,67,90,45,34,-100,300]

# creating tf.data.dataset object  
tf_dataset = tf.data.Dataset.from_tensor_slices(dataset) tf_dataset
```

# æŸ¥çœ‹å†…å®¹

ç”±äº`tf_dataset`æ˜¯ä¸€ä¸ªå¼ é‡æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥éå†å®ƒæ¥æŸ¥çœ‹å®ƒçš„æ‰€æœ‰å†…å®¹:

```
# view the content by iterating
for i in tf_dataset:
    print(i)# retunrs
```

![](img/252a5a29a6e5c060101c7337c75c9641.png)

ä¸Šè¿°ä»£ç çš„ç»“æœ

å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªå†…å®¹è§†å›¾å¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒåŒ…å«äº†è®¸å¤šå…¶ä»–å¯¹ç”¨æˆ·ä¸å‹å¥½çš„å…ƒç´ ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšçš„ä¸€ä»¶ç®€å•çš„äº‹æƒ…å°±æ˜¯è°ƒç”¨`no.numpy()`æˆ–`tf_dataset.as_numpy_iterator()`å°†æ•°æ®è½¬æ¢æˆä¸€ä¸ª **NumPy** æ•°ç»„å¹¶åªæ‰“å°å…ƒç´ ã€‚å®ƒå¯ä»¥å®ç°ä¸º:

```
# Converting the tensor to numpy object using ```numpy()```
for i in tf_dataset:
    print(i.numpy())or # Or use tf_dataset.as_numpy_iterator  
for i in tf_dataset.as_numpy_iterator():     
    print(i)# Returns
```

![](img/4ef62a2e8dc6b7f8e51f4d13017c1968.png)

ä»…ä»¥ Numpy æ•°ç»„çš„å½¢å¼è¿”å›å€¼

å¦‚æ‚¨æ‰€è§ï¼Œä»¥è¿™ç§æ ¼å¼æŸ¥çœ‹æ•°æ®è¦æ–¹ä¾¿å¾—å¤šã€‚**æ³¨æ„è¿™åªå¯¹æ•°å­—æ•°æ®ç±»å‹æœ‰æ•ˆï¼Œå¯¹å­—ç¬¦ä¸²æ— æ•ˆï¼**

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`take(no)`æ–¹æ³•åªæŸ¥çœ‹æŒ‡å®šæ•°é‡çš„æ•°æ®ç‚¹**()ã€‚T** *ä»–çš„ä»£ç ä½çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:*

```
# Converting the tensor to numpy object using ```numpy()```
for i in tf_dataset.as_numpy_iterator():     
    print(i)# Returns
```

![](img/559432b3323a7ffba69ec356494edc96.png)

ä»…è¿”å› 3 ä¸ªå…ƒç´ 

# è¿‡æ»¤æ•°æ®

æˆ‘ä»¬åœ¨æ•°æ®é›†ä¸­æœ‰è®¸å¤š**è´Ÿå€¼(-ve)** å€¼ï¼Œæ‰€ä»¥ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„äº‹æƒ…æ˜¯åªè¿‡æ»¤ ***æ­£å€¼(+ve)*** çš„æ•°æ®ã€‚ä½¿ç”¨ i *nput ç®¡é“ api* ï¼Œå¯ä»¥ä½¿ç”¨`tf_dataset.filter(custom_fn)`æ¥å®Œæˆ:

```
# lambda x : x>0 - fn to return the positivetf_dataset = tf_dataset.filter(lambda x : x>0)for i in tf_dataset.as_numpy_iterator():
    print('$ '+str(i))#returns 
```

![](img/383df7e87410cd2c229cb0729cbe3fb9.png)

è¿”å›å¤§äº 0 çš„å€¼

å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰æ­£å€¼è¢«è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è¿‡æ»¤å™¨å·¥ä½œå¾—å¾ˆå¥½ï¼Œæ˜¯ä¸€ç§å¿«é€Ÿè¿‡æ»¤æ•°æ®é›†çš„ä¾¿æ·æ–¹å¼ã€‚

# æ˜ å°„æ•°æ®

é€šå¸¸æˆ‘ä»¬éœ€è¦**åœ¨æ•´ä¸ªæ•°æ®é›†**ä¸Šå¤„ç†æŸä¸ªè¿‡ç¨‹ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°åšæœ‰ç‚¹ä¹å‘³ã€‚æƒ³æƒ³ç”¨æˆ·çš„ tensorflow æä¾›äº†ä¸€ä¸ª`map()`æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ•°æ®é›†ä¸Šè°ƒç”¨å®ƒï¼Œå¹¶åœ¨ä¸€è¡Œä»£ç ä¸­å®Œæˆæˆ‘ä»¬çš„å·¥ä½œã€‚**è‡ªå®šä¹‰å‡½æ•°è¢«æä¾›ç»™**ï¼Œå®ƒå°†è¯¥è¿‡ç¨‹åº”ç”¨äºæ•´ä¸ªæ•°æ®é›†ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:

```
# using map fn 
# lambda x : x*72 - multiplies the value by 72for i in tf_dataset.map(lambda x : x*72):
    print('Rs '+str(i.numpy()))# returns
```

![](img/566f125716770a90e72f2a2f3a3a21bf.png)

è¿”å›å€¼ä¸º Rs

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ç­‰å¼ **â‚¹ = $*72** å°†æ•°æ®ä»ç¾å…ƒè½¬æ¢ä¸ºâ‚¹ï¼Œåœ¨`map`çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬ ***å°†æ¯ä¸ªå…ƒç´ ä¹˜ä»¥ 72*** æ¥è¿›è¡Œè½¬æ¢ã€‚

# æ´—ç‰Œæ•°æ®

åœ¨è¿›è¡Œå›¾åƒåˆ†æç”šè‡³æ•°æ®å‡†å¤‡æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ‰“ä¹±æ•°æ®é›†ã€‚è¿™å¯ä»¥é€šè¿‡`tf_dataset.shuffle()` a æ–¹æ³•æ¥å®ç°ï¼Œè¯¥æ–¹æ³•å°†**ç¼“å†²åŒº**ä½œä¸ºå‚æ•°ï¼Œå¹¶æ ¹æ®*ç¼“å†²åŒºè·å¾—çš„*ä¸ªå…ƒç´ (çª—å£)æ¥éšæœºæ´—ç‰Œã€‚

æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ´—ç‰Œï¼Œéå¸¸æ–¹ä¾¿:

```
for i in tf_dataset.shuffle(3):
    print(i.numpy())# returns
```

![](img/954a913748c3594cb624048c532d0ba8.png)

è¿”å›æ··æ´—çš„å€¼

å¯ä»¥çœ‹å‡ºï¼Œ**ä¸€äº›å€¼å·²ç»è¢«æ‰“ä¹±ï¼Œä»è€Œä½¿æˆ‘ä»¬çš„æ•°æ®é›†å…·æœ‰éšæœºæ€§ï¼Œæ²¡æœ‰è®­ç»ƒé›†æ‰€éœ€çš„å›ºå®šé¡ºåº**ã€‚

# æ‰¹å¤„ç†æ•°æ®

åœ¨è¿›è¡Œå›¾åƒåˆ†æç”šè‡³æ•°æ®å‡†å¤‡æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ‰“ä¹±æ•°æ®é›†ã€‚è¿™å¯ä»¥é€šè¿‡`tf_dataset.shuffle()`æ¥å®ç°ï¼Œè¯¥æ–¹æ³•ä»¥**ç¼“å†²åŒº**ä¸ºå‚æ•°ï¼Œå¹¶æ ¹æ®*ç¼“å†²åŒºè·å–çš„ã€çª—å£ã€‘å…ƒç´ æ•°é‡*éšæœºæ´—ç‰Œæ•°æ®é›†ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ´—ç‰Œï¼Œéå¸¸æ–¹ä¾¿:

```
for i in tf_dataset.batch(3):
    print(i.numpy())# returns
```

![](img/2aced7696d4284d099160bcd6b703702.png)

æ•°æ®åˆ†æˆå¤§å°ä¸º 2 çš„æ‰¹ï¼Œæ¯æ‰¹ 3 ä¸ªå…ƒç´ 

**å¦‚å›¾æ‰€ç¤ºï¼Œæ•°æ®é›†è¢«åˆ†æˆå¤§å°ä¸º 2 çš„æ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡åŒ…å« 3 ä¸ªå…ƒç´ **ã€‚*è¿™å…è®¸é«˜æ•ˆåœ°å¤„ç†å¤§å‹æ•°æ®é›†ï¼Œå¹¶åœ¨æ²¡æœ‰å¾ˆå¤šèµ„æºçš„æœºå™¨ä¸Šå·¥ä½œ* â€”è€ƒè™‘ä¸€ä¸ª 8Gb çš„ ramï¼ŒåŒ…å« 100 ä¸‡ä¸ªæ•°æ®æ ·æœ¬ğŸ¤“ã€‚

# é“¾æ¥å‘¼å«

å…³äº `tf.data` api çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸**é“¾æ¥**æ‰€æœ‰çš„æ–¹æ³•ï¼Œå¹¶åœ¨ä¸€è¡Œä»£ç ä¸­å®Œæˆæ‰€æœ‰ä¸Šè¿°æ­¥éª¤(*åŠ è½½ã€è¿‡æ»¤ã€æ˜ å°„ã€æ··æ’ã€æ‰¹å¤„ç†*ï¼Œç­‰ç­‰)ã€‚æˆ‘ä»¬è¿™æ ·åšçš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ª`'.'`æ“ä½œç¬¦

```
# one liner using '.
# reading + filtering + mapping + shuffling + batching in one  line
tf_dataset_new = tf.data.Dataset.from_tensor_slices(dataset).filter(lambda x: x>0).map(lambda a: a*72).shuffle(2).batch(2)for i in tf_dataset_new.as_numpy_iterator():
    print(i)#returns
```

![](img/fea7f56598d736089214f1a042f74496.png)

è¿”å›å·²å¤„ç†çš„æ•°æ®é›†

*ç”±äºæ‰¹å¤„ç†æ—¶æœ€åä¸€ä¸ªæ•°æ®ç‚¹æ˜¯å¥‡æ•°ï¼Œæ²¡æœ‰é…å¯¹ï¼Œå¯¹äº 2 çš„æ··æ´—ï¼Œå¯¹äº* ***æ¯ä¸ªçª—å£ï¼Œå³*** *ï¼Œé™¤äº†æœ€åä¸€ä¸ªä»¥å¤–ï¼Œè¿”å›å€¼ä¸º 2ã€‚æ›´å¤šä¿¡æ¯è¯·ç‚¹å‡»* æŸ¥çœ‹[](https://stackoverflow.com/questions/53514495/what-does-batch-repeat-and-shuffle-do-with-tensorflow-dataset)

*å› æ­¤ï¼Œè¿™äº›æ˜¯ä¸€äº›å¿«é€Ÿä»£ç ï¼Œæ‚¨å¯ä»¥å°è¯•ï¼Œå¹¶å¯åŠ¨å’Œè¿è¡Œå¤§å¤šæ•°è¾“å…¥ç®¡é“ä»»åŠ¡ã€‚*

*æ¥ä¸‹æ¥:é€šè¿‡ä¸º**çŒ«&ç‹—å›¾åƒæ•°æ®é›†**åˆ¶ä½œè¾“å…¥ç®¡é“æ¥åº”ç”¨æˆ‘ä»¬çš„å­¦ä¹ ã€‚*

# *å‚è€ƒ*

*å¯¹äºé‚£äº›æƒ³äº†è§£æ›´å¤šå†…å®¹çš„äººï¼Œè¿™é‡Œæœ‰ä¸€äº›å¾ˆå¥½çš„å‚è€ƒèµ„æ–™:*

**æœ‰å…³è¾“å…¥ç®¡é“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®[https://www.tensorflow.org/api_docs/python/tf/data/Dataset](https://www.tensorflow.org/api_docs/python/tf/data/Dataset)*

*   *ä»£ç ç¬”è®°æœ¬:[åŸºç¡€çŸ¥è¯†](https://colab.research.google.com/drive/11dlXiEWDGw-YEsiKo8-JUE4BehRwy-RA?usp=sharing)*
*   *æ•™ç¨‹è§†é¢‘+é€šç”¨è¾“å…¥ç®¡é“å›¾ç‰‡è‡´è°¢: [CodeBasics](https://youtu.be/VFEOskzhhbc)*

*è°¢è°¢ğŸ˜„*