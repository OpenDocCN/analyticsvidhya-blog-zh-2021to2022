<html>
<head>
<title>Explanation of PySpark and Coding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PySpark和编码的解释</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/explanation-of-pyspark-and-coding-afc4af43b3b3?source=collection_archive---------0-----------------------#2021-09-21">https://medium.com/analytics-vidhya/explanation-of-pyspark-and-coding-afc4af43b3b3?source=collection_archive---------0-----------------------#2021-09-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b0d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">阿帕奇火花:</strong></p><p id="1ab3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Apache Spark是一个强大的ETL工具，用于分析大数据。这个工具现在被业界的<strong class="ig hi">数据工程师</strong>和<strong class="ig hi">数据科学家</strong>广泛使用。火花是用<strong class="ig hi"> Scala </strong>的语言写的。Spark工具可以在各种编程语言中执行，如R、Python、Java、JavaScript、Scala和。Net，但是spark在Python、Java和Scala语言中被广泛使用。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/2ca16f4eb899b1618b355785fdd517bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6i-SgoxWg3U5yQ_4vJRmg.png"/></div></div></figure><p id="5355" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">那么PySpark是什么，无非就是用python语言<strong class="ig hi">spark</strong>都叫<strong class="ig hi"> PySpark </strong>。让我们使用Python来关注Spark。</p><p id="5813" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在python中使用spark很好，因为python是拥有更高开发人员社区的语言之一，比任何其他竞争语言都有更多的库支持，拥有超过13万个库。使用python你可以执行高级任务，比如spark streaming、Graphx、Spark SQL和MLlib(机器学习)。是的，你可以使用spark进行机器学习。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jo"><img src="../Images/0f9186b449e16b0eb95fea81111e6076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q61jdDnJQUq--sySOxBn4g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">火花核心</figcaption></figure><p id="78c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">RDD: </p><p id="bfde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代表<strong class="ig hi">弹性分布式数据集</strong>，RDD是一个只读的对象集合，跨集群中的多台机器进行分区。在一个典型的Spark程序中，一个或多个rdd作为输入被加载，并通过一系列转换被转换成一组目标rdd</p><p id="31b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">I .容错的分布式对象集合。</p><p id="fed9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">二。在spark中，每个任务都以下列方式表示:</p><ul class=""><li id="5b5d" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">创建新的<code class="du kc kd ke kf b">RDD(s)</code></li><li id="3dfc" class="jt ju hh ig b ih kg il kh ip ki it kj ix kk jb jy jz ka kb bi translated">改造现有的<code class="du kc kd ke kf b">RDD(s)</code></li><li id="5ed9" class="jt ju hh ig b ih kg il kh ip ki it kj ix kk jb jy jz ka kb bi translated">在<code class="du kc kd ke kf b">RDD(s)</code>上调用操作</li></ul><p id="2473" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">RDD只支持两种类型的操作转换和动作。</p><p id="0090" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">转换</strong>:从现有数据集创建一个新数据集，以执行映射、平面映射、过滤、联合、采样、连接、groupByKey。</p><p id="35da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">动作</strong>:在数据集上运行计算以执行收集、归约、计数、保存后，向驱动程序返回值。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kl"><img src="../Images/377ea8a3715816188210d586b1f49c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*727mQtHAmQlQaB6SxQmAYA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">RDD过程</figcaption></figure><p id="df1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如需了解更多信息，请点击链接<a class="ae km" href="https://spark.apache.org/docs/latest/rdd-programming-guide.html#rdd-operations" rel="noopener ugc nofollow" target="_blank">此处</a>。</p></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><p id="330b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> PySpark编码(动手):</strong></p><p id="6be2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要导入所需的库，请使用下面的代码。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="8cbc" class="ky kz hh kf b fi la lb l lc ld">import pyspark<br/>import pandas as pd<br/>import numpy as np <br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>from pyspark.sql import SparkSession<br/>from pyspark.sql import functions as fs</span></pre><p id="e6a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们创建一个火花会议。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="2830" class="ky kz hh kf b fi la lb l lc ld">spark = SparkSession.builder.appName(‘Medium’).getOrCreate()<br/>spark</span></pre><p id="32e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的代码将创建一个spark会话，它只是一个集群，可以监视和控制其中的任何其他操作。您可以在中给出任何名称来创建一个集群<code class="du kc kd ke kf b">appName(‘Preferred_name’).</code></p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es le"><img src="../Images/2824a66c101bd6280f6023851f0f49a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*dcJkhUloziHxgbGqvaDF6w.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">火花会议</figcaption></figure><p id="8e5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦创建了spark会话，您可以单击Spark UI，它将显示在输出中，将带您到新的Spark门户，以监控您的所有操作。</p><p id="6df8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">PySpark语法与<strong class="ig hi">熊猫</strong>非常相似，只是有一些独特的区别，现在让我们开始导入数据并做一些基本的操作。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="46ea" class="ky kz hh kf b fi la lb l lc ld">df=spark.read.csv('ramen_rating.csv',header=True,inferSchema=True)<br/>df.show()</span></pre><p id="3d69" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，我已经导入了一个名为<code class="du kc kd ke kf b">ramen_rating </code>的文件，它在Kaggle中可用。我建议用户在导入文件时给<strong class="ig hi">头</strong>和<strong class="ig hi">推断模式</strong>头是列名，推断模式是从文件中选择的数据类型。如果您没有使用inferSchema，代码将自动为该列选择任何数据类型，通常它会选择<code class="du kc kd ke kf b">string </code>作为任何列的数据类型，所以我建议您使用inferSchema。</p><p id="e801" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与Pandas不同，一旦你调用了变量<code class="du kc kd ke kf b">df </code>，spark将不会显示数据，所以我们需要给<code class="du kc kd ke kf b">df.show()</code>命令来查看存储在变量中的数据。</p><p id="603d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这段代码将帮助你找到<code class="du kc kd ke kf b">df.printSchema()</code>表中每一列的数据类型或模式</p><p id="17d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该代码用于调用单列或多列来显示<code class="du kc kd ke kf b">df.select(‘Brand’).show()</code></p><p id="cc03" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以用和我们在熊猫身上用的一样的描述</p><p id="10e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，让我们做一些算术运算。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="2056" class="ky kz hh kf b fi la lb l lc ld">df = df.withColumn(‘Stars_10’,df[‘Stars’]+5) <br/>df.show()</span></pre><p id="3e76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的代码将使用算术创建一个新列，我采用了一个星形列，其中<code class="du kc kd ke kf b">mode</code>是5，所以我添加5来创建一个新列，并将列名指定为<code class="du kc kd ke kf b">Stars_10.</code></p><p id="7c15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你也可以像我们用的熊猫一样掉柱<code class="du kc kd ke kf b">df=df.drop(‘Stars_10’)</code></p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="ac5d" class="ky kz hh kf b fi la lb l lc ld">df = df.withColumnRenamed(‘Stars’,’Stars_5')<br/>df.show()</span></pre><p id="f38e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我用上面的代码把<code class="du kc kd ke kf b">Stars</code>改成了<code class="du kc kd ke kf b">Stars_5 </code>。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="ecf6" class="ky kz hh kf b fi la lb l lc ld">df = df.withColumn('Product (Type)',fs.concat(df.Brand,fs.lit(' ('),df.Style,fs.lit(')')))<br/>df.show()</span></pre><p id="e74f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最初，它可能看起来很复杂或者与<strong class="ig hi"> Pandas语法</strong>混淆，但是一旦你<strong class="ig hi">理解并且用<strong class="ig hi"> spark </strong>练习</strong>就很容易了。这里我用<code class="du kc kd ke kf b">Brand</code>和<code class="du kc kd ke kf b">Style</code>列将<code class="du kc kd ke kf b">concat </code>列到<code class="du kc kd ke kf b">Product (Type)</code>列。在<code class="du kc kd ke kf b">withcolumn </code>中，您需要给出新的列名，后跟<code class="du kc kd ke kf b">concat </code>语法来添加两列。</p><h2 id="b2d2" class="ky kz hh bd lf lg lh li lj lk ll lm ln ip lo lp lq it lr ls lt ix lu lv lw lx bi translated">临时视图:</h2><p id="4400" class="pw-post-body-paragraph ie if hh ig b ih ly ij ik il lz in io ip ma ir is it mb iv iw ix mc iz ja jb ha bi translated">我能感觉到大多数人都在等这个。在spark中，您可以通过连接来自任何其他环境(如Hadoop、Big Query等)的数据来执行SQL语法。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="65ff" class="ky kz hh kf b fi la lb l lc ld">df.createTempView("temp")<br/>df_sql = spark.sql("SELECT *, avg(Stars_5) over(PARTITION BY Style) as Average FROM temp order by Brand asc, Country desc")</span></pre><p id="646b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，我创建了一个临时视图来使用SQL命令，然后我执行了一个<strong class="ig hi">窗口函数。</strong></p><h2 id="3dad" class="ky kz hh bd lf lg lh li lj lk ll lm ln ip lo lp lq it lr ls lt ix lu lv lw lx bi translated">过滤操作:</h2><p id="9189" class="pw-post-body-paragraph ie if hh ig b ih ly ij ik il lz in io ip ma ir is it mb iv iw ix mc iz ja jb ha bi translated">与熊猫不同，你不能通过给定任何条件来直接过滤数据。所以在Spark中，我们使用filter选项来过滤在<strong class="ig hi">范围内</strong>或通过<strong class="ig hi"> not null </strong>值或在<strong class="ig hi">任何条件下</strong>的数据。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="961d" class="ky kz hh kf b fi la lb l lc ld">df.filter("Stars_5&lt;3 and Stars_5&gt;1.5").show()</span></pre><p id="8214" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该命令用于过滤数据，在<code class="du kc kd ke kf b">Stars_5 </code>栏中指出数据应小于3，同时应大于1.5。</p><p id="1987" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">分组依据:</strong></p><p id="251f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">星火中的群聚和熊猫一样。下面的代码将根据<code class="du kc kd ke kf b">Style </code>列计算<code class="du kc kd ke kf b">mean </code>。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="00fa" class="ky kz hh kf b fi la lb l lc ld">df.groupby(‘Style’).mean().show()</span></pre><p id="8f8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您也可以在一个命令中的两列中执行两个不同的操作。</p><pre class="jd je jf jg fd ku kf kv kw aw kx bi"><span id="5133" class="ky kz hh kf b fi la lb l lc ld">df.groupby('Brand').agg({'Stars_5':"sum","Percentage":"mean"}).show()</span></pre><p id="b024" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我对<code class="du kc kd ke kf b">Stars_5 </code>列进行了相加(求和),并通过对<code class="du kc kd ke kf b">Brand</code>列进行分组来计算<code class="du kc kd ke kf b">Percentage </code>列的平均值。</p><p id="ebf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您也可以通过命令在一个组中使用多个列。</p><p id="7096" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我试图在本文中涵盖尽可能多的基础知识和广泛使用的操作。我已经在<strong class="ig hi"> GitHub、</strong>中以jupyter笔记本格式附上了我的PySpark作品，这将在编码部分向你做更多的解释。请找到这篇文章下面的链接。</p><p id="d90e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在下一篇文章<strong class="ig hi">对PySpark和编码II的解释</strong>中，请继续关注使用PySpark的RDD和机器学习。</p><p id="ade9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要继续阅读下一篇文章，请<strong class="ig hi">跟我来</strong>，如果这是一篇好文章，请<strong class="ig hi">鼓掌</strong>。<strong class="ig hi">享受！</strong>💙</p><p id="6812" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢阅读。:)</p><p id="7ffb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">GitHub:<a class="ae km" href="https://github.com/anand-lab-172/PySpark" rel="noopener ugc nofollow" target="_blank">https://github.com/anand-lab-172/PySpark</a></p></div></div>    
</body>
</html>