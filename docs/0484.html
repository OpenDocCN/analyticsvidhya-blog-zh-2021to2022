<html>
<head>
<title>Deploying Your Geospatial Machine Learning Project as a Web App Using Streamlit and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Streamlit和Heroku将地理空间机器学习项目部署为Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploying-your-geospatial-machine-learning-projects-as-web-apps-using-streamlit-and-heroku-45d64f6d5cb0?source=collection_archive---------6-----------------------#2021-01-18">https://medium.com/analytics-vidhya/deploying-your-geospatial-machine-learning-projects-as-web-apps-using-streamlit-and-heroku-45d64f6d5cb0?source=collection_archive---------6-----------------------#2021-01-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b4eb89a01ce13e514057a3e319072482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7T17oVD5HaTSNrqY6tsccw.png"/></div></div></figure><p id="5f7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你正在寻找一个简单易用的库，以网络应用的形式启动你的数据科学和机器学习项目，并且没有任何网络开发技能，那么<a class="ae jo" href="https://www.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>可能是你的最佳选择！</p><p id="311a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博客提供了对Streamlit、<em class="jp">和</em> <a class="ae jo" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>的快速介绍，这是另一个在云中构建和操作应用的常用平台。我们还将回顾<a class="ae jo" href="https://python-visualization.github.io/folium/" rel="noopener ugc nofollow" target="_blank">follow</a>，它是fleet . js的Python包装器，是一个易于使用的库，用于在Python中创建交互式地图。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jq"><img src="../Images/e4adac9e6c89d2cb890368b67daf67a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOg4j5H083GS7jZxV9eRWQ.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">预测加州奥克兰空气质量的网络应用快照。</figcaption></figure><p id="9b62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近使用Streamlit和Heroku启动了我的机器学习项目，作为一个<a class="ae jo" href="https://aq-webapp-heroku-22.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">网络应用</a>，预测东湾地区的空气浓度。该网络应用程序为用户提供了一个简单的界面，可以输入加利福尼亚州奥克兰市的地址或兴趣点，该应用程序还可以在使用follow创建的交互式传单地图上报告黑碳和二氧化氮的平均浓度。</p><h1 id="fef0" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak">细流:</strong></h1><p id="2bb3" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">Streamlit是一种快速简单的方法，可以将您的数据科学和机器学习Python脚本转换为web应用程序，而无需前端经验。Streamlit允许您在本地服务器上实施应用程序，或者从Streamlit平台部署和共享应用程序。</p><p id="5609" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，使用以下命令安装Streamlit:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="51c0" class="lh ka hi ld b fi li lj l lk ll">pip install Streamlit</span></pre><p id="0cde" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在创建应用程序之前，首先创建一个包含应用程序Python脚本的Github存储库。我们稍后还将使用这个Github存储库，通过Heroku在云中部署应用程序。创建Github存储库后，在本地克隆存储库并导航到该文件夹。我将我的repo ' <em class="jp"> aq-webapp </em>'调用。</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="f887" class="lh ka hi ld b fi li lj l lk ll">git clone<a class="ae jo" href="https://github.com/varsha2509/aq-webapp.git" rel="noopener ugc nofollow" target="_blank"> https://github.com/varsha2509/aq-webapp.git</a></span><span id="cf3f" class="lh ka hi ld b fi lm lj l lk ll">cd Varsha/aq-webapp/</span></pre><p id="4a19" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，创建一个包含web应用程序代码的Python文件。我把我的命名为'<em class="jp"> web-application.py </em>'。</p><p id="4111" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个文件中，导入您需要的库。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="5714" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我将创建两个函数来加载包含来自机器学习模型的预测值的数据集(作为. csv文件)，并创建另一个函数来加载包含奥克兰市边界的geoJSON文件。您可以定制这些函数来加载您感兴趣的数据集。我将我的两个文件都存储在我的Google Drive中，并且我正在使用Python中的<em class="jp">请求</em>和<em class="jp"> io </em>库来加载文件。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="71a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上面代码片段中的'<em class="jp"> @st.cache </em>'装饰器用于在加载和操作大型数据集[ <a class="ae jo" href="https://docs.streamlit.io/en/stable/caching.html" rel="noopener ugc nofollow" target="_blank"> Streamlit </a> ]时提高Streamlit的性能。<em class="jp"> load_data </em>函数加载csv文件并返回熊猫数据帧，<em class="jp">load _ oak _ data</em>函数返回geoJSON文件的url。</p><p id="9d89" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我将使用GeoPy的<a class="ae jo" href="https://nominatim.org/" rel="noopener ugc nofollow" target="_blank">命名工具</a>将地址或感兴趣的点转换为经纬度坐标。下面的函数<em class="jp"> convert_address </em>接受一个地址作为输入，并返回一个纬度、经度列表。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="5450" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然Streamlit确实有一个内置的<a class="ae jo" href="https://docs.streamlit.io/en/stable/getting_started.html?highlight=maps#draw-charts-and-maps" rel="noopener ugc nofollow" target="_blank"> maps函数</a>，可以用来可视化地图上的点，但我发现它的功能有限。Folium是一个简洁的地图制作工具，可以让您在交互式地图中可视化Python中操作的数据。您还可以将HTML或矢量可视化作为地图上的标记进行传递。</p><p id="96e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我将创建一个名为<em class="jp"> display_map </em>的函数，它使用follow来显示一个交互式地图。该函数接受三个输入:纬度和经度列表中的点、包含不同位置的预测值的数据框架以及奥克兰边界的geoJSON文件。然后，该函数在该位置显示一个带有标记的点，并在叶图上显示一个多边形边界。标记器通过使用<em class="jp"> KDTree </em>函数，即<em class="jp"> Scipy的</em>最近邻查找函数，显示离输入位置最近的点处黑碳和二氧化氮的预测浓度。“<em class="jp"> st.markdown </em>”用于将文本转换成HTML。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="2eab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我正在编写<em class="jp"> main </em>函数，它在执行时自动运行应用程序。在main函数中，我调用了上面讨论的所有函数，包括主页的标题和副标题。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="7fcf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用以下代码可以在本地运行Streamlit应用程序:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="9292" class="lh ka hi ld b fi li lj l lk ll">streamlit run web-application.py</span></pre><p id="5ddf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此功能将打开您的浏览器，并在本地创建一个应用程序。您可以使用此版本在部署应用程序之前对其进行调整。您可以使用Streamlit的内置方法在您的应用程序中添加更多功能，如复选框、侧栏元素或图表<a class="ae jo" href="https://docs.streamlit.io/en/stable/tutorial/create_a_data_explorer_app.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h1 id="7b28" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated"><strong class="ak"> Heroku: </strong></h1><p id="1089" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">Heroku是一个云平台，允许用户完全在云端构建和部署应用程序。在开始使用Heroku之前，先注册一个Heroku 账号(免费！).</p><p id="7d1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">T3】requirements . txtT5】</strong></p><p id="3574" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，安装允许您自动创建requirements.txt文件的<em class="jp"> pipreqs </em>库。使用以下命令安装库</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="a639" class="lh ka hi ld b fi li lj l lk ll">pip install pipreqs</span></pre><p id="bc34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导航到您的项目文件夹(如果您还不在那里),并键入以下命令来创建requirements.txt文件。</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="c9f1" class="lh ka hi ld b fi li lj l lk ll">pipreqs --force</span></pre><p id="b222" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果requirements.txt文件已经存在，force 允许您覆盖它。我的需求文件包含以下库，您的文件可能因您导入的库而异。</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="c6b3" class="lh ka hi ld b fi li lj l lk ll">streamlit==0.72.0<br/>pandas==0.25.2<br/>folium==0.10.1<br/>geopandas==0.8.0<br/>geopy==1.21.0<br/>scipy==1.4.1<br/>requests==2.22.0</span></pre><blockquote class="lp lq lr"><p id="3001" class="iq ir jp is b it iu iv iw ix iy iz ja ls jc jd je lt jg jh ji lu jk jl jm jn hb bi translated">我想指出一个你<em class="hi">可能</em>稍后在部署Heroku应用时会遇到的错误。如果您使用的是leav库，就会出现这种情况。一旦你部署你的应用程序，你可能会得到一个错误，说<strong class="is hj">‘让这个笔记本信任加载地图:文件- &gt;信任笔记本’。</strong>在Streamlit上运行fleur时会出现这种情况。发生错误是因为<em class="hi"> ' </em> Branca <em class="hi"> ' </em>包<em class="hi">的版本问题。为了避免这个错误，我手工添加了<em class="hi"> ' </em>布兰卡<em class="hi"> ' </em>包<strong class="is hj">版本0.3.1 </strong>到requirements.txt文件中。</em></p></blockquote><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="58d2" class="lh ka hi ld b fi li lj l lk ll">branca==0.3.1</span></pre><p id="c332" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jp">配置脚本和Procfile </em> </strong></p><p id="d24d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Heroku需要另外两个标准文件— <em class="jp">配置脚本和Procfile </em>。需要配置脚本来配置Streamlit，以便与Heroku一起使用。<em class="jp"> Procfile </em>包含一组应由应用程序在启动时执行的命令。由于这些是标准文件，请参考<a class="ae jo" href="https://towardsdatascience.com/how-to-deploy-your-data-science-as-web-apps-easily-with-python-955dd462a9b5" rel="noopener" target="_blank">这篇</a>博文，了解如何在您的项目文件夹中创建这些文件。</p><p id="cad5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，使用以下命令将文件推送到Github存储库:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="2a38" class="lh ka hi ld b fi li lj l lk ll">git add .<br/>git commit -m "deploying files"<br/>git push origin master</span></pre><p id="d1e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在准备在Heroku中部署应用程序。要启动Heroku，请在终端中键入以下内容:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="086b" class="lh ka hi ld b fi li lj l lk ll">heroku login</span></pre><p id="2b37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在弹出的浏览器中，使用您的凭证登录Heroku。接下来，返回到您的终端，创建一个新的Heroku应用程序，如下所示:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="be6a" class="lh ka hi ld b fi li lj l lk ll">heroku create aq-webapp</span></pre><p id="a8a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要确认已为您的应用程序设置了名为heroku的遥控器，请键入:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="9615" class="lh ka hi ld b fi li lj l lk ll">git remote -v</span></pre><p id="9d2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后将所有文件推送到Heroku master分支，如下所示:</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="d7bd" class="lh ka hi ld b fi li lj l lk ll">git push heroku master</span></pre><p id="ceb0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要运行Heroku，请键入</p><pre class="jr js jt ju fd lc ld le lf aw lg bi"><span id="c5e5" class="lh ka hi ld b fi li lj l lk ll">heroku open</span></pre><p id="b825" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的web应用程序现在将在浏览器中打开，您可以在浏览器上与任何人共享URL！</p></div></div>    
</body>
</html>