<html>
<head>
<title>Market Basket Analysis using Association Rules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用关联规则的购物篮分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/market-basket-analysis-using-association-rules-2b0f3e2a897d?source=collection_archive---------2-----------------------#2021-06-05">https://medium.com/analytics-vidhya/market-basket-analysis-using-association-rules-2b0f3e2a897d?source=collection_archive---------2-----------------------#2021-06-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/cad44973f0fe7108b36f3dc0528fdb2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*WiYikNrB55KwVj42D6GmZQ.png"/></div></figure><p id="a628" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">购物篮分析是大型零售商用来发现商品之间关联的关键技术之一。它通过寻找在交易中频繁出现的项目组合来工作。换句话说，它允许零售商识别人们购买的商品之间的关系。</p><p id="f1f2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">关联规则被广泛用于分析零售购物篮或交易数据，并且旨在基于强规则的概念，使用感兴趣的度量来识别在交易数据中发现的强规则。简单来说，这种技术的结果是一组<strong class="in hi">规则</strong>，可以理解为<strong class="in hi">“如果这样，那么那样”</strong>。</p><p id="3f19" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">关联规则的一个例子</strong></p><ul class=""><li id="8ad9" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">假设有100个客户</li><li id="eede" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">其中10人买了牛奶，8人买了黄油，6人两样都买了。</li><li id="95f6" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">买了牛奶= &gt;买了黄油</li><li id="1a4d" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">支持= P(牛奶和黄油)= 6/100 = 0.06</li><li id="bf38" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">信心=支持度/P(黄油)= 0.06/0.08 = 0.75</li><li id="fa48" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">lift =置信度/P(牛奶)= 0.75/0.10 = 7.5</li><li id="8c07" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">注意:这个例子非常小。在实践中，一个规则需要数百个事务的支持，才能被认为具有统计意义，数据集通常包含数千或数百万个事务。</li></ul><h1 id="ad43" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">关联规则</h1><p id="b899" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Apriori算法为给定的数据集生成关联规则。关联规则意味着，如果项目A出现，那么项目B也以一定的概率出现。让我们看一个例子，</p><figure class="lb lc ld le fd ii er es paragraph-image"><div class="er es la"><img src="../Images/09f1ddd53f5bcd2d042a20897adde050.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/0*rkB0NeUAeJFeG2R8.PNG"/></div></figure><p id="4d83" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在上表中，我们可以看到一家服装店的七笔交易。每笔交易都显示在那笔交易中购买的物品。我们可以将我们的项目表示为一个<strong class="in hi">项目集</strong>，如下所示:</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/b1ace88ad1acd69060bdcc7ab5653bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m3jMjItsqkgKCsFe.PNG"/></div></div></figure><p id="ffb9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在我们的例子中，它对应于:</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lk"><img src="../Images/dc6f5e595c677e89b6a57d7db67917d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Lkg1qIrsgvpBAcvZ.png"/></div></div></figure><p id="787f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一个<strong class="in hi">事务</strong>由下面的表达式表示:</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ll"><img src="../Images/4110f74d15f96c7e3a2dd8bd945d44e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xY0KUVDFKcpWO7RN.png"/></div></div></figure><p id="b0bf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">举个例子，</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lm"><img src="../Images/dcb70a487cc0a59f8689a78b7357786e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X0wT8QiRo15WHEhZ.png"/></div></div></figure><p id="d870" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后，<strong class="in hi">关联规则</strong>被定义为以下形式的蕴涵:</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/ca0b67ae57f08ba1471eb7e5a85ba5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T9g3Mb-r1yKezV2B.png"/></div></div></figure><p id="cda7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">举个例子，</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/68c21e72d173a10a15627056f2ae6b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zjbkl1RBrolHsKBZ.png"/></div></div></figure><p id="3b8b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在接下来的部分中，我们将定义四个度量标准来衡量规则的精确度。</p><h1 id="5b20" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">支持</h1><p id="ad4d" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">支持度表示项目集在数据集中出现的频率。</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/06601055a9cb28fa217f147b7f961133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MQn1zTi_WIfUDzHT.png"/></div></div></figure><p id="8ed1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">换句话说，就是同时包含X和Y的事务数除以事务总数。这些规则对于低支持值没有用。让我们使用上一个表中的服装店事务来看看不同的例子。</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lo"><img src="../Images/3e8abf641c53adcbc86a79b48a653583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NM1UgksGMOSB_t8i.png"/></div></div></figure><h1 id="5ba9" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">信心</h1><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lp"><img src="../Images/f4efe353ea800e472df047a4c0321a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8CgBPwb8dJgXb_Ln.png"/></div></div></figure><h1 id="7311" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">电梯</h1><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/2d9ae9f5c1eefd684b60aae67f0e4b76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1B2g6329V_-pF4SK.png"/></div></div></figure><h1 id="b036" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">定罪</h1><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lr"><img src="../Images/55a71ba6a9eb50415861b16851b6899d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9kmEoWzZitRxuZBw.png"/></div></div></figure><h1 id="5e6b" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">让我们编码</h1><h1 id="3fff" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">导入依赖关系</strong></h1><p id="b1e0" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">import numpy as NP<br/>import matplotlib . py plot as PLT<br/>% matplotlib inline<br/>import pandas as PD<br/>from mlx tend .预处理import transaction encoder<br/>from mlx tend . frequency _ patterns import apriori<br/>from mlx tend . frequency _ patterns import association _ rules</p><h1 id="e316" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">加载CSV文件</strong></h1><p id="8435" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">df=pd.read_csv(r '杂货. csv '，header =无)</p><p id="5c69" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">df.head()</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ls"><img src="../Images/c5ab6b56c79bafb646fc9c77b84abadf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOL6R0HuMWW1bugNAzUZbA.png"/></div></div></figure><h1 id="bbf7" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">数据准备</strong></h1><p id="1cc9" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">如果交易发生则为真，否则为假</p><p id="e7a3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">records =[]<br/>for I in range(0，9835):<br/>records . append([str(df . values[I，j]) for j in range(0，20)])</p><p id="b3ea" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">TE = transaction encoder()<br/>array = TE . fit(记录)。transform(records)<br/># building数据框行是逻辑，列是已购买的物品<br/> df1 = pd。DataFrame(array，columns = TE.columns_) <br/> df1</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lt"><img src="../Images/5747d36bfa0d6ec65583ecb15cc94ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_dfvRIRlbe_Hphmap6mBw.png"/></div></div></figure><h1 id="6a3f" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">现在想象一下前20个销售项目</h1><p id="8cd7" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">count = df_clean.loc[:，:]。sum()<br/>df2 = count . sort _ values(0，升序= False)。head(20)<br/>df2 = df2 . to _ frame()<br/>df2 = df2 . reset _ index()<br/>df2 = df2 . rename(columns = { " index ":" items "，0: "count"})</p><p id="49e8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">PLT . style . use(' dark _ background ')<br/>ax = df2 . plot . bar(x = ' items '，y = 'count') <br/> plt.title('最畅销项目')</p><figure class="lb lc ld le fd ii er es paragraph-image"><div class="er es lu"><img src="../Images/587f0db8117e57fc726754b41d97187f.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*6LAc3RY27ioF_GcrA64Vjg.png"/></div></figure><h1 id="02ff" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">现在找出项目百分比和累计百分比</strong></h1><p id="9f8a" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">tot_item = sum(df_clean.sum())</p><p id="edb5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">df2[' Item _ percent ']= df2[' count ']/Tot _ Item<br/>df2[' Tot _ percent ']= df2。item _ percent . cumsum()<br/>df2 . head(20)</p><figure class="lb lc ld le fd ii er es paragraph-image"><div class="er es lv"><img src="../Images/8ca91316886a0da9707a658fac8b0c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*ULGxHv18R5GItOINHL2JkA.png"/></div></figure><p id="d6cf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">正如我们所见，50%的售出商品都是前20名商品。因此，现在我们将删除不经常出售的项目</p><p id="578c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">def prune_dataset(olddf，len_transaction，tot_sales_percent): <br/> #删除最后一列tot _ items if if ' tot _ items in olddf . columns:<br/>del(olddf[' tot _ items '])<br/>#查找每个项目的item_count和项目总数。这与第三步<br/>中的代码相同。sort_values(升序= False)。reset _ index()<br/>tot _ items = sum(olddf . sum()。sort _ values(ascending = False))<br/>Item _ count . rename(columns = { Item _ count . columns[0]:' Item _ name '，Item _ count . columns[1]:' Item _ count ' }，inplace=True) <br/> <br/> #代码从步骤3中查找项目百分比和合计百分比。<br/>Item _ count[' Item _ percent ']= Item _ count[' Item _ count ']/Tot _ items<br/>Item _ count[' Tot _ percent ']= Item _ count。item _ percent . cumsum()<br/><br/>#取符合总销售额百分比条件/最低阈值的项目。<br/>选定项目=列表(项目计数[项目计数。Tot_percent &lt;。项目名称)<br/> olddf['总项目']= olddf[选定项目]。sum(axis = 1) <br/> <br/> #取符合条件的项目/一行交易时长或项目数的最小阈值。<br/>olddf = olddf[olddf . tot _ items&gt;= len _ transaction】<br/>del(olddf[' tot _ items '])<br/><br/>#返回修剪后的数据帧。<br/>返回olddf[selected_items]，Item_count[Item_count。tot _ percent&lt;tot _ sales _ percent]</p><p id="e228" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">output_df，item _ counts = prune _ dataset(df _ clean，<br/> 2，0.4)<br/>print(output _ df . shape)<br/>print(list(output _ df . columns))<br/>output _ df</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lw"><img src="../Images/330d28df697b4e5447cb62eb912536c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ORqq5mSJl81g2yrda44PLw.png"/></div></div></figure><p id="f7b6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在我们使用apriori算法</p><p id="756d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">frequent _ items ets = apriori(output _ df，min_support=0.01，use _ colnames = True)<br/>frequent _ items ets[' length ']= frequent _ items ets[' items ets ']。应用(λx:len(x))</p><p id="7ccf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">频繁项集=频繁项集[(频繁项集['length'] &gt;= 2)] <br/>频繁项集</p><figure class="lb lc ld le fd ii er es paragraph-image"><div class="er es lx"><img src="../Images/f9930f8672759fe62fcdf4b072463653.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*SdQWeDcwC-DQTRiO3-49nQ.png"/></div></figure><h1 id="fa31" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">关联规则</strong></h1><p id="bfc3" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">我们希望前件长度大于2，置信度大于或等于0.3，提升大于或等于1，支持度大于或等于0.04。</p><p id="4fb3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">rules _ mlx tend[" antecedent _ len "]= rules _ mlx tend[" antecedents "]。应用(λx:len(x))</p><p id="a619" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">rules _ mlx tend[(rules _ mlx tend[' antecedent _ len ']&gt; = 2)&amp;<br/>(rules _ mlx tend[' confidence ']&gt;= 0.3)&amp;<br/>(rules _ mlx tend[' lift ']&gt;= 1)&amp;<br/>(rules _ mlx tend[' support ']&gt;= 0.04)]</p><figure class="lb lc ld le fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ly"><img src="../Images/ef4bb1808d83c19cde4602bc4663b559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RyP7gMFjvpCJ5kI6S8sE8A.png"/></div></div></figure><h1 id="6957" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">结论</h1><ul class=""><li id="9f3c" class="jj jk hh in b io kv is kw iw lz ja ma je mb ji jo jp jq jr bi translated">这个数据集中最受欢迎的项目是全脂牛奶，其次是蔬菜和面包卷。</li><li id="9633" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">通过应用Apriori算法和关联规则，我们可以更好地了解哪些商品更有可能一起购买。</li></ul><p id="e0a4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">有关代码和数据集，请参见</p><div class="mc md ez fb me mf"><a href="https://github.com/Megha067/Market-Basket-Analysis-using-Association-Rules" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hi fi z dy mk ea eb ml ed ef hg bi translated">Meg ha 067/市场购物篮分析-使用关联规则</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">购物篮分析是大型零售商用来发现商品之间关联的关键技术之一。它…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">github.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt ij mf"/></div></div></a></div></div></div>    
</body>
</html>