<html>
<head>
<title>Atlantis on AWS EKS Fargate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWSä¸Šçš„äºšç‰¹å…°è’‚æ–¯EKSæ³•ç›–ç‰¹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/analytics-vidhya/atlantis-on-aws-eks-fargate-666ed21d09f4?source=collection_archive---------1-----------------------#2021-05-16">https://medium.com/analytics-vidhya/atlantis-on-aws-eks-fargate-666ed21d09f4?source=collection_archive---------1-----------------------#2021-05-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7eb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Terraformæ‹‰å¼è¯·æ±‚è‡ªåŠ¨åŒ–</p><p id="8f4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„Iaacå·¥å…·ä¹‹ä¸€ã€‚è¿™æ˜¯HashiCorpæä¾›çš„å…è´¹å¼€æºå·¥å…·ã€‚ä½¿ç”¨Terraformï¼Œä½ å¯ä»¥åœ¨AWSã€GCPå’ŒAzureç­‰å¤šä¸ªäº‘å¹³å°ä¸Šæä¾›åŸºç¡€è®¾æ–½ã€‚</p><p id="c9e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ¯ä¸ªç»„ç»‡éƒ½åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ(VCS)ä¸Šç»´æŠ¤ä»£ç ï¼Œå¦‚GitHubã€Bitbucketç­‰ã€‚æ¯å½“å¼€å‘äººå‘˜åœ¨IaaCä¸­è¿›è¡Œæ›´æ”¹æ—¶ï¼Œä»–ä»¬ä¼šæå‡ºä¸€ä¸ªæ‹‰è¯·æ±‚ï¼Œç„¶åç»è¿‡<strong class="ih hj">ã€Nã€‘</strong>æ¬¡å®¡æŸ¥å’Œè¯„è®ºåï¼Œè¯¥è¯·æ±‚è¢«æ¥å—ï¼Œåœ¨æ­¤æœŸé—´ï¼Œå¼€å‘äººå‘˜å°†ä»æœ¬åœ°ç³»ç»Ÿæˆ–è‡ªåŠ¨åŒ–å·¥ä½œç«™å¤šæ¬¡è¿è¡Œterraformå‘½ä»¤ã€‚è¿™å°±æ˜¯äºšç‰¹å…°è’‚æ–¯å‡ºç°çš„åŸå› ã€‚</p><p id="42fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.runatlantis.io/" rel="noopener ugc nofollow" target="_blank"> Atlantis </a>æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå…è®¸ä½ ç›´æ¥ä»åœ¨æ‹‰è¯·æ±‚ä¸Šåˆ›å»ºçš„æ³¨é‡Šä¸­è¿è¡Œterraformå‘½ä»¤ï¼ŒAtlantiså°†é€šè¿‡è¾“å‡ºå¯¹æ‹‰è¯·æ±‚è¿›è¡Œè¯„è®ºï¼Œå›¢é˜Ÿä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½å°†çŸ¥é“ä»€ä¹ˆå°†è¢«åˆ›å»ºæˆ–é”€æ¯ï¼Œä»¥åŠè°åœ¨åšä»€ä¹ˆã€‚ä½ å¯ä»¥åœ¨<a class="ae jd" href="https://www.runatlantis.io/guide/#why-would-you-run-atlantis" rel="noopener ugc nofollow" target="_blank">https://www . run Atlantis . io/guide/# why-you-run-Atlantis</a>ä¸Šäº†è§£æ›´å¤šä¿¡æ¯</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/66576cef5d8bb2f4956914f773deb39f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n65Xc5zm1m4NwZKLTmIGYA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">äºšç‰¹å…°è’‚æ–¯æµ</figcaption></figure><p id="a01e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰ä½ å¦‚ä½•åœ¨<a class="ae jd" href="https://docs.aws.amazon.com/eks/latest/userguide/fargate.html" rel="noopener ugc nofollow" target="_blank"> AWS EKSæ³•ç›–ç‰¹</a>ä¸Šé…ç½®Atlantis</p><h1 id="635f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">æˆ‘ä»¬å¼€å§‹å§</h1><p id="e585" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä½¿ç”¨<strong class="ih hj"> BitBucket </strong>ä½œä¸ºVCSï¼Œä½†æ˜¯æ— è®ºä½ ä½¿ç”¨å“ªä¸ªVCSï¼Œå®ç°éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="8f49" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">å…ˆå†³æ¡ä»¶</h2><ul class=""><li id="1586" class="ll lm hi ih b ii ks im kt iq ln iu lo iy lp jc lq lr ls lt bi translated">VPC</li><li id="d4b9" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">VPCçš„å­ç½‘åº”è¯¥æœ‰ä»¥ä¸‹æ ‡è®°</li></ul><p id="4007" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€ã€å…¬å…±å­ç½‘:â€”kubernetes.io/role/elb = 1</p><p id="4156" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">äºŒã€‚ä¸“ç”¨å­ç½‘:â€”kubernetes.io/role/internal-elb = 1</p><ul class=""><li id="5466" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">å…·æœ‰æ´»åŠ¨Fargateè½®å»“çš„EKSç¾¤é›†</li><li id="4853" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åº“è´ç‰¹å°”</li><li id="6325" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">ä½¿ç”¨é“¾æ¥<a class="ae jd" href="https://www.runatlantis.io/docs/access-credentials.html" rel="noopener ugc nofollow" target="_blank">https://www.runatlantis.io/docs/access-credentials.html</a>æ ¹æ®æ‚¨çš„VCSé…ç½®VCSçš„è®¿é—®å‡­è¯</li><li id="6d79" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">Web-hook Secretâ€”â€”ä½¿ç”¨é“¾æ¥<a class="ae jd" href="https://www.runatlantis.io/docs/webhook-secrets.html" rel="noopener ugc nofollow" target="_blank">https://www.runatlantis.io/docs/webhook-secrets.html</a>åˆ›å»ºweb-hook Secret(å¯¹äºBitBucketï¼Œè¿™ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºä¸åº”è¯¥è¿™æ ·åš)</li></ul><p id="f359" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å·²ç»åœ¨<strong class="ih hj"> Kubernetesç‰ˆæœ¬1.19 </strong>ä¸Šè¿›è¡Œäº†é…ç½®ï¼Œæ‰€æœ‰K8sç›¸å…³èµ„æºéƒ½åœ¨<strong class="ih hj">é»˜è®¤åç§°ç©ºé—´</strong>å’Œ<strong class="ih hj"> kube-systemåç§°ç©ºé—´</strong>ä¸­</p><h2 id="c304" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">äºšç‰¹å…°è’‚æ–¯è¿è¡Œæ—¶é—´</h2><p id="9fe9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">äºšç‰¹å…°è’‚æ–¯æ˜¯ä¸€ä¸ªç®€å•çš„<a class="ae jd" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank">å»</a>åº”ç”¨ç¨‹åºã€‚å®ƒä»æ‚¨çš„Gitä¸»æœºæ¥æ”¶webhooksï¼Œå¹¶åœ¨æœ¬åœ°æ‰§è¡ŒTerraformå‘½ä»¤ã€‚æœ‰äºšç‰¹å…°è’‚æ–¯å®˜æ–¹<a class="ae jd" href="https://hub.docker.com/r/runatlantis/atlantis/" rel="noopener ugc nofollow" target="_blank"> Dockerå½¢è±¡</a>ã€‚æˆ‘ä»¬å°†ä½¿ç”¨<strong class="ih hj"> v0.17.0 </strong></p><h2 id="9c40" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">äºšç‰¹å…°è’‚æ–¯æ•°æ®</h2><p id="ea26" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">äºšç‰¹å…°è’‚æ–¯æ²¡æœ‰å¤–éƒ¨æ•°æ®åº“ã€‚Atlantisåœ¨ç£ç›˜ä¸Šå­˜å‚¨Terraformè®¡åˆ’æ–‡ä»¶ã€‚å¦‚æœäºšç‰¹å…°è’‚æ–¯åœ¨<code class="du mc md me mf b">plan</code>å’Œ<code class="du mc md me mf b">apply</code>å‘¨æœŸä¹‹é—´ä¸¢å¤±äº†æ•°æ®ï¼Œé‚£ä¹ˆç”¨æˆ·å°†ä¸å¾—ä¸é‡æ–°è¿è¡Œ<code class="du mc md me mf b">plan</code>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä¸ºäºšç‰¹å…°è’‚æ–¯ä½¿ç”¨æ°¸ä¹…ç£ç›˜ã€‚</p><h2 id="42d4" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">äºšç‰¹å…°è’‚æ–¯ä»“åº“</h2><p id="acab" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æˆ‘ä»¬å°†ä½¿ç”¨<strong class="ih hj"> AWSå¼¹æ€§æ–‡ä»¶ç³»ç»Ÿ</strong>æ¥å­˜å‚¨æˆ‘ä»¬æ‰€æœ‰çš„Atlantisæ•°æ®ï¼Œå› ä¸ºAWS Fargateä¸æ”¯æŒEBSå·ï¼Œæ‰€ä»¥å”¯ä¸€çš„é€‰æ‹©æ˜¯ä½¿ç”¨AWS EFSä½œä¸ºæŒä¹…å­˜å‚¨ã€‚</p><h2 id="b3bd" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">åˆ›å»ºAWSå¼¹æ€§æ–‡ä»¶ç³»ç»Ÿ</h2><ul class=""><li id="0354" class="ll lm hi ih b ii ks im kt iq ln iu lo iy lp jc lq lr ls lt bi translated">è½¬åˆ°EFSæ§åˆ¶å°ï¼Œå•å‡»â€œåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿâ€</li><li id="2a4b" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">ç»™ä½ çš„æ–‡ä»¶ç³»ç»Ÿå‘½å</li><li id="5d29" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">ä¸ºæ‚¨çš„æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©VPC</li><li id="6118" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">ç‚¹å‡»åˆ›å»º</li></ul><h2 id="cc07" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿè®¿é—®ç‚¹</h2><p id="0632" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">äºšé©¬é€ŠEFS <em class="mg">è®¿é—®ç‚¹</em>æ˜¯è¿›å…¥EFSæ–‡ä»¶ç³»ç»Ÿçš„ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè¿™ä½¿å¾—ç®¡ç†åº”ç”¨ç¨‹åºå¯¹å…±äº«æ•°æ®é›†çš„è®¿é—®å˜å¾—æ›´åŠ å®¹æ˜“ã€‚å¯¹äºé€šè¿‡æ¥å…¥ç‚¹å‘å‡ºçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿè¯·æ±‚ï¼Œæ¥å…¥ç‚¹å¯ä»¥å¼ºåˆ¶å®æ–½ç”¨æˆ·èº«ä»½ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„POSIXç»„ã€‚è®¿é—®ç‚¹è¿˜å¯ä»¥å¯¹æ–‡ä»¶ç³»ç»Ÿå¼ºåˆ¶ä½¿ç”¨ä¸åŒçš„æ ¹ç›®å½•ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯åªèƒ½è®¿é—®æŒ‡å®šç›®å½•æˆ–å…¶å­ç›®å½•ä¸­çš„æ•°æ®ã€‚</p><p id="6bb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†ä½¿ç”¨<strong class="ih hj"> "/atlantis" </strong>(å°†ç”±k8sè‡ªåŠ¨æŒ‚è½½)ä½œä¸ºæˆ‘ä»¬åœ¨EFSçš„æŒ‚è½½ç‚¹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å°†å­˜å‚¨åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚Atlantisåˆ›å»ºçš„æ–‡ä»¶å°†ä½¿ç”¨<strong class="ih hj">â€œAtlantis:Atlantisâ€</strong>ä½œä¸ºç”¨æˆ·å’Œç»„ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ­¤è·¯å¾„ä»¥åŠç”¨æˆ·å’Œç»„æ¥é™åˆ¶æˆ‘ä»¬çš„æ¥å…¥ç‚¹ã€‚</p><ul class=""><li id="d26e" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">é€‰æ‹©æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿå¹¶é€‰æ‹©<strong class="ih hj">è®¿é—®ç‚¹</strong>é€‰é¡¹å¡</li><li id="0f42" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">ç‚¹å‡»åˆ›å»ºæ¥å…¥ç‚¹</li></ul><p id="02f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©æ‚¨çš„æ–‡ä»¶ç³»ç»ŸIDï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯·é€‰æ‹©æ‚¨çš„æ–‡ä»¶ç³»ç»Ÿ</p><p id="0ff4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.è¾“å…¥æ¥å…¥ç‚¹çš„åç§°</p><p id="1f57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.åœ¨æ ¹ç›®å½•è·¯å¾„ä¸­å†™ä¸‹<strong class="ih hj"> "/atlantis" </strong></p><p id="c016" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.åœ¨POSIXç”¨æˆ·ä¸­å†™ä¸‹ä»¥ä¸‹å†…å®¹</p><p id="dd02" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€ã€ç”¨æˆ·ID â€” <strong class="ih hj"> 100 </strong>(äºšç‰¹å…°è’‚æ–¯ç”¨æˆ·ID)</p><p id="8ea0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">äºŒã€‚ç»„ID â€” <strong class="ih hj"> 1000 </strong>(äºšç‰¹å…°è’‚æ–¯ç»„ID)</p><p id="c6cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e.åœ¨æ ¹ç›®å½•åˆ›å»ºæƒé™ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹</p><p id="dab5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸€ã€ä¸šä¸»ç”¨æˆ·ID â€” <strong class="ih hj"> 100 </strong></p><p id="dcd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">äºŒã€‚æ‰€æœ‰è€…ç¾¤ç»„ID â€” <strong class="ih hj"> 1000 </strong></p><p id="5b46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä¸‰ã€‚æƒé™â€” <strong class="ih hj"> 777 </strong></p><p id="eec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">f.ç‚¹å‡»åˆ›å»ºæ¥å…¥ç‚¹</p><p id="3226" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong></p><ol class=""><li id="306d" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">è®°ä¸‹<strong class="ih hj"> AWS EFS ID </strong>å’Œ<strong class="ih hj">æ¥å…¥ç‚¹ID </strong>ã€‚</li><li id="4974" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">æ‚¨éœ€è¦æ›´æ–°EFS Sgä»¥å…è®¸æ¥è‡ªEKSé›†ç¾¤çš„æµé‡ã€‚æ‚¨å¯ä»¥å°†EKSé›†ç¾¤Sg IDæ·»åŠ åˆ°å…·æœ‰æ‰€æœ‰æµé‡å’Œæ‰€æœ‰ç«¯å£çš„EFS Sgçš„å…¥ç«™è§„åˆ™ä¸­ã€‚</li></ol><h2 id="c371" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">AWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨</h2><p id="0f6b" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">AWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨ä¸ºKubernetesé›†ç¾¤ç®¡ç†AWSå¼¹æ€§è´Ÿè½½å¹³è¡¡å™¨ã€‚å½“æ‚¨åˆ›å»ºKubernetes <code class="du mc md me mf b">Ingress</code>æ—¶ï¼Œæ§åˆ¶å™¨ä¼šæä¾›ä¸€ä¸ªAWSåº”ç”¨ç¨‹åºè´Ÿè½½å¹³è¡¡å™¨(ALB)</p><p id="4a93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ä½¿ç”¨AWSç®¡ç†æ§åˆ¶å°ä¸ºæ‚¨çš„é›†ç¾¤åˆ›å»ºOIDCæä¾›è€…</strong></p><ul class=""><li id="6d61" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">æŸ¥çœ‹æ‚¨çš„ç¾¤é›†çš„OIDCæä¾›ç¨‹åºURL</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="b189" class="kx jv hi mf b fi mm mn l mo mp">aws eks describe-cluster --name &lt;cluster_name&gt; --query "cluster.identity.oidc.issuer" --output text</span></pre><ul class=""><li id="f1d6" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">æ‰“å¼€IAMæ§åˆ¶å°</li><li id="ef5e" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨å¯¼èˆªé¢æ¿ä¸­ï¼Œé€‰æ‹©èº«ä»½æä¾›è€…ã€‚å¦‚æœåˆ—å‡ºäº†ä¸æ‚¨çš„ç¾¤é›†çš„URLåŒ¹é…çš„æä¾›ç¨‹åºï¼Œé‚£ä¹ˆæ‚¨çš„ç¾¤é›†å·²ç»æœ‰äº†ä¸€ä¸ªæä¾›ç¨‹åºã€‚å¦‚æœæ²¡æœ‰åˆ—å‡ºä¸æ‚¨çš„ç¾¤é›†çš„URLåŒ¹é…çš„æä¾›ç¨‹åºï¼Œåˆ™æ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªã€‚</li><li id="665d" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">è¦åˆ›å»ºæä¾›å•†ï¼Œé€‰æ‹©<strong class="ih hj">æ·»åŠ æä¾›å•†</strong></li><li id="a0a5" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">å¯¹äº<strong class="ih hj">æä¾›è€…ç±»å‹</strong>ï¼Œé€‰æ‹©<strong class="ih hj"> OpenIDè¿æ¥</strong></li><li id="bd50" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">å¯¹äº<strong class="ih hj">æä¾›è€…URL </strong>ï¼Œç²˜è´´æ‚¨çš„é›†ç¾¤çš„OIDCå‘è¡Œè€…URLï¼Œç„¶åé€‰æ‹©<strong class="ih hj">è·å–æŒ‡çº¹</strong></li><li id="2134" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">å¯¹äº<strong class="ih hj">å—ä¼—</strong>ï¼Œè¾“å…¥<code class="du mc md me mf b">sts.amazonaws.com</code>å¹¶é€‰æ‹©<strong class="ih hj">æ·»åŠ æä¾›å•†</strong></li></ul><p id="51fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">åˆ›å»ºIAMç­–ç•¥</strong></p><ul class=""><li id="dafd" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">ä¸‹è½½AWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨çš„IAMç­–ç•¥ï¼Œå…è®¸å®ƒä»£è¡¨æ‚¨è°ƒç”¨AWS APIsã€‚å¯ä»¥åœ¨GitHubä¸ŠæŸ¥çœ‹<a class="ae jd" href="https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2_ga/docs/install/iam_policy.json" rel="noopener ugc nofollow" target="_blank">æ”¿ç­–æ–‡ä»¶</a>ã€‚</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="598a" class="kx jv hi mf b fi mm mn l mo mp">curl -o iam_policy.json <a class="ae jd" href="https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.1.3/docs/install/iam_policy.json" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.1.3/docs/install/iam_policy.json</a></span></pre><ul class=""><li id="7c5c" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">ä½¿ç”¨ä¸Šä¸€æ­¥ä¸­ä¸‹è½½çš„ç­–ç•¥åˆ›å»ºIAMç­–ç•¥</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="9ecf" class="kx jv hi mf b fi mm mn l mo mp">aws iam create-policy \<br/>    --policy-name <strong class="mf hj">AWSLoadBalancerControllerIAMPolicy</strong> \<br/>    --policy-document file://iam_policy.json</span></pre><p id="0fda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">åˆ›å»ºIAMè§’è‰²å’ŒK8sæœåŠ¡è´¦æˆ·</strong></p><p id="795a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªIAMè§’è‰²ï¼Œå¹¶ä½¿ç”¨AWSç®¡ç†æ§åˆ¶å°å’Œ<code class="du mc md me mf b">kubectl</code>ä¸ºAWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨åœ¨<code class="du mc md me mf b">kube-system</code>åç§°ç©ºé—´ä¸­æ ‡æ³¨åä¸º<code class="du mc md me mf b">aws-load-balancer-controller</code>çš„KubernetesæœåŠ¡å¸æˆ·</p><ul class=""><li id="2b23" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">æ‰“å¼€IAMæ§åˆ¶å°</li><li id="9c55" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨å¯¼èˆªé¢æ¿ä¸­ï¼Œé€‰æ‹©<strong class="ih hj">è§’è‰²</strong>ï¼Œ<strong class="ih hj">åˆ›å»ºè§’è‰²</strong></li><li id="8df9" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">é€‰æ‹©å¯ä¿¡å®ä½“ç±»å‹</strong>éƒ¨åˆ†ï¼Œé€‰æ‹©<strong class="ih hj"> Webèº«ä»½</strong></li><li id="445c" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">é€‰æ‹©webèº«ä»½æä¾›è€…</strong>éƒ¨åˆ†</li></ul><p id="7821" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I .å¯¹äº<strong class="ih hj">èº«ä»½æä¾›è€…</strong>ï¼Œé€‰æ‹©æ‚¨çš„é›†ç¾¤çš„URL</p><p id="d148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">äºŒã€‚å¯¹äº<strong class="ih hj">è§‚ä¼—</strong>ï¼Œé€‰æ‹©<code class="du mc md me mf b">sts.amazonaws.com</code></p><ul class=""><li id="0693" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">ä¸‹ä¸€æ­¥:æƒé™</strong></li><li id="8f20" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">é™„åŠ ç­–ç•¥</strong>éƒ¨åˆ†ï¼Œé€‰æ‹©æ‚¨ä¹‹å‰åˆ›å»ºçš„ç”¨äºæ‚¨çš„æœåŠ¡å¸æˆ·çš„<code class="du mc md me mf b"><em class="mg">AWSLoadBalancerControllerIAMPolicy</em></code>ç­–ç•¥</li><li id="fe28" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">ä¸‹ä¸€æ­¥:æ ‡ç­¾</strong></li><li id="230d" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">æ·»åŠ æ ‡ç­¾(å¯é€‰)</strong>å±å¹•ä¸Šï¼Œæ‚¨å¯ä»¥ä¸ºå¸æˆ·æ·»åŠ æ ‡ç­¾ã€‚é€‰æ‹©<strong class="ih hj">ä¸‹ä¸€æ­¥:æŸ¥çœ‹</strong></li><li id="ca9a" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">å¯¹äº<strong class="ih hj">è§’è‰²åç§°</strong>ï¼Œè¾“å…¥æ‚¨çš„è§’è‰²åç§°ï¼Œå¦‚<code class="du mc md me mf b"><em class="mg">AmazonEKSLoadBalancerControllerRole</em></code>ï¼Œç„¶åé€‰æ‹©<strong class="ih hj">åˆ›å»ºè§’è‰²</strong></li><li id="654b" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åˆ›å»ºè§’è‰²åï¼Œåœ¨æ§åˆ¶å°ä¸­é€‰æ‹©è§’è‰²ä»¥æ‰“å¼€å®ƒè¿›è¡Œç¼–è¾‘</li><li id="628e" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">ä¿¡ä»»å…³ç³»</strong>é€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©<strong class="ih hj">ç¼–è¾‘ä¿¡ä»»å…³ç³»</strong></li></ul><p id="2f50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‰¾åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¡Œ:</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="03a0" class="kx jv hi mf b fi mm mn l mo mp">"oidc.eks.&lt;<em class="mg">region-code</em>&gt;.amazonaws.com/id/EXAMPLED539D4633E53DE1B716D3041E:aud": "sts.amazonaws.com"</span></pre><p id="89d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°†è¯¥è¡Œæ›´æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºã€‚å°†<code class="du mc md me mf b"><em class="mg">&lt;EXAMPLED539D4633E53DE1B716D3041E&gt;</em></code>(åŒ…æ‹¬<code class="du mc md me mf b"><em class="mg">&lt;&gt;</em></code>)æ›¿æ¢ä¸ºæ‚¨çš„é›†ç¾¤çš„OIDCæä¾›å•†IDï¼Œå°†<code class="du mc md me mf b"><em class="mg">&lt;region-code&gt;</em></code>æ›¿æ¢ä¸ºæ‚¨çš„é›†ç¾¤æ‰€åœ¨çš„åœ°åŒºä»£ç </p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="b9d8" class="kx jv hi mf b fi mm mn l mo mp">"oidc.eks.<em class="mg">&lt;region-code&gt;</em>.amazonaws.com/id/<em class="mg">&lt;EXAMPLED539D4633E53DE1B716D3041E&gt;</em>:sub": "system:serviceaccount:kube-system:aws-load-balancer-controller"</span></pre><ul class=""><li id="b545" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">æ›´æ–°ä¿¡ä»»ç­–ç•¥</strong>ç»“æŸ</li><li id="9f4c" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">è®°ä¸‹è§’è‰²çš„ARNï¼Œä»¥ä¾¿åœ¨åé¢çš„æ­¥éª¤ä¸­ä½¿ç”¨</li><li id="6374" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">å°†ä»¥ä¸‹å†…å®¹ä¿å­˜åˆ°åä¸º<code class="du mc md me mf b"><em class="mg">aws-load-balancer-controller-service-account.yaml</em></code>çš„æ–‡ä»¶ä¸­</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="8037" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  labels:<br/>    app.kubernetes.io/component: controller<br/>    app.kubernetes.io/name: aws-load-balancer-controller<br/>  name: aws-load-balancer-controller<br/>  namespace: kube-system<br/>  annotations:<br/>      eks.amazonaws.com/role-arn: arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:role/&lt;YOUR_ROLE_NAME&gt;</span></pre><p id="a5e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong>ä¸è¦æ›´æ”¹æœåŠ¡å¸æˆ·åï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨IAMè§’è‰²çš„ä¿¡ä»»ç­–ç•¥ä¸­é…ç½®äº†è¯¥åç§°</p><ul class=""><li id="fb17" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">åœ¨ç¾¤é›†ä¸Šåˆ›å»ºæœåŠ¡å¸æˆ·</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="5380" class="kx jv hi mf b fi mm mn l mo mp">kubectl apply -f aws-load-balancer-controller-service-account.yaml</span></pre><p id="e6ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ä½¿ç”¨Helm V3 </strong>å®‰è£…AWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨</p><p id="2edf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º</strong>:æœ€å¥½å°†<strong class="ih hj"> Helmä¸Fargate </strong>ä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨cert-managerï¼Œåè€…æ˜¯Jetstackçš„ä¸€ä¸ªKubernetesæ’ä»¶ã€‚è¯ä¹¦ç®¡ç†å™¨å¯¹Fargateæœ‰ä¸€äº›é—®é¢˜ã€‚</p><ul class=""><li id="1185" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">å°†äºšé©¬é€ŠEKSå›¾è¡¨repoæ·»åŠ åˆ°Helmï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="5cca" class="kx jv hi mf b fi mm mn l mo mp">helm repo add eks https://aws.github.io/eks-charts</span></pre><ul class=""><li id="302b" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">å®‰è£…<strong class="ih hj"> TargetGroupBinding </strong>è‡ªå®šä¹‰èµ„æºå®šä¹‰(CRDs)ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="6f0a" class="kx jv hi mf b fi mm mn l mo mp">kubectl apply -k "github.com/aws/eks-charts/stable/aws-load-balancer-controller//crds?ref=master"</span></pre><ul class=""><li id="2c47" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">å®‰è£…èˆµå›¾ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="ffdb" class="kx jv hi mf b fi mm mn l mo mp">helm install aws-load-balancer-controller eks/aws-load-balancer-controller \<br/>    --set clusterName=YOUR_CLUSTER_NAME \<br/>    --set serviceAccount.create=false \<br/>    --set region=&lt;REGION_CODE&gt; \<br/>    --set vpcId=&lt;VPC_ID&gt; \<br/>    --set serviceAccount.name=aws-load-balancer-controller \<br/>    -n kube-system</span></pre><ul class=""><li id="bbf1" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">éªŒè¯æ§åˆ¶å™¨æ˜¯å¦å·²å®‰è£…</li></ul><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="2372" class="kx jv hi mf b fi mm mn l mo mp">kubectl get deployment -n kube-system aws-load-balancer-controller</span></pre><p id="356f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­å–œğŸ¥³ï¼Œæ‚¨å·²ç»æˆåŠŸå®‰è£…äº†AWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šç»†èŠ‚<a class="ae jd" href="https://aws.amazon.com/premiumsupport/knowledge-center/eks-alb-ingress-controller-fargate/" rel="noopener ugc nofollow" target="_blank">ï¼Œåœ¨è¿™é‡Œ</a>æ‰¾åˆ°<a class="ae jd" href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html" rel="noopener ugc nofollow" target="_blank">ã€‚</a></p><h2 id="22a1" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">AWS EFS CSIé©±åŠ¨ç¨‹åº</h2><p id="4ff1" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æˆ‘ä»¬ä¸èƒ½åœ¨EKSçš„Fargateæ¨¡å¼ä¸‹ä½¿ç”¨åŠ¨æ€é¢„é…ç½®ã€‚æˆ‘ä»¬å¿…é¡»ä½¿ç”¨é™æ€é…ç½®ã€‚å¸¦æœ‰Fargateæ¨¡å¼çš„AWS EKSå·²ç»å¸¦æœ‰EFS CSIé©±åŠ¨ç¨‹åºï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡ŒéªŒè¯</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="ccf0" class="kx jv hi mf b fi mm mn l mo mp">kubectl get csidriver</span></pre><p id="3fbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å°†çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡º</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="308a" class="kx jv hi mf b fi mm mn l mo mp">NAME              ATTACHREQUIRED   PODINFOONMOUNT   MODES        AGE<br/>efs.csi.aws.com   false            false            Persistent   1d</span></pre><p id="295f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å·²ç»å®Œæˆäº†è®¾ç½®äºšç‰¹å…°è’‚æ–¯æ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºä¸äºšç‰¹å…°è’‚æ–¯è®¾ç½®ç›¸å…³çš„èµ„æºã€‚</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><h1 id="a6d9" class="ju jv hi bd jw jx mx jz ka kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr bi translated">äºšç‰¹å…°è’‚æ–¯è®¾ç½®</h1><h2 id="d84f" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">å­˜å‚¨ç±»</h2><p id="25af" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="du mc md me mf b">atlantis-storage-class.yml</code>çš„æ–‡ä»¶ï¼Œåœ¨ä½ æœ€å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€å®ƒï¼Œæ·»åŠ ä»¥ä¸‹å‡ è¡Œ</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="d16d" class="kx jv hi mf b fi mm mn l mo mp">kind: StorageClass<br/>apiVersion: storage.k8s.io/v1<br/>metadata:<br/>  name: atlantis-sc<br/>provisioner: efs.csi.aws.com</span></pre><p id="941d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºå­˜å‚¨ç±»</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="7de7" class="kx jv hi mf b fi mm mn l mo mp">kubectl create -f atlantis-storage-class.yml</span></pre><p id="3097" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯å­˜å‚¨ç±»æ˜¯å¦å·²æˆåŠŸåˆ›å»º</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="fc9d" class="kx jv hi mf b fi mm mn l mo mp">kubectl get sc atlantis-sc</span><span id="df5d" class="kx jv hi mf b fi nc mn l mo mp">#Output</span><span id="6f49" class="kx jv hi mf b fi nc mn l mo mp">NAME          PROVISIONER       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE<br/>atlantis-sc   efs.csi.aws.com   Delete          Immediate           false                  10s</span></pre><h2 id="632e" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">æŒä¹…å·</h2><p id="7019" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">å¦‚å‰æ‰€è¿°ï¼ŒAtlantiså°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç£ç›˜ä¸Šï¼Œæˆ‘ä»¬å°†åˆ›å»ºæŒä¹…å·æ¥å­˜å‚¨æ•°æ®</p><p id="506f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="du mc md me mf b">atlantis-pv.yml</code>çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="f766" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: v1<br/>kind: PersistentVolume<br/>metadata:<br/>  name: atlantis-pv<br/>spec:<br/>  capacity:<br/>    storage: 5Gi<br/>  volumeMode: Filesystem<br/>  accessModes:<br/>    - ReadWriteMany<br/>  persistentVolumeReclaimPolicy: Retain<br/>  storageClassName: atlantis-sc<br/>  csi:<br/>    driver: efs.csi.aws.com<br/>    volumeHandle: <strong class="mf hj">&lt;YOUR_FILE_SYSTEM_ID&gt;::&lt;YOUR_FS_ACCESS_POINT_ID&gt;</strong></span></pre><p id="1758" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘å·²ç»åœ¨PVä¸­ç»™äº†5Giçš„å‚¨å¤‡ï¼Œè¿™å¯¹äºäºšç‰¹å…°è’‚æ–¯æ˜¯è¶³å¤Ÿçš„ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥æ·»åŠ æ›´å¤šå­˜å‚¨ç©ºé—´ã€‚å½“æ‚¨åˆ›å»ºæ‹‰å¼è¯·æ±‚æ—¶ï¼ŒAtlantiså°†ä»å›è´­ä¸­é™çº§ä»£ç ï¼Œä¸€æ—¦PRè¢«åˆå¹¶ï¼ŒAtlantiså°†ä»æœ¬åœ°ç³»ç»Ÿä¸­åˆ é™¤ä»£ç ã€‚</p><p id="f05f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºæ°¸ä¹…å·</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="df6f" class="kx jv hi mf b fi mm mn l mo mp">kubectl create -f <!-- -->atlantis-pv.yml</span></pre><p id="8714" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯æ˜¯å¦åˆ›å»ºäº†æ°¸ä¹…å·</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="3183" class="kx jv hi mf b fi mm mn l mo mp">kubectl get pv atlantis-pv</span></pre><p id="c4ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å°†çœ‹åˆ°æŒä¹…å·å¤„äºå¯ç”¨çŠ¶æ€ã€‚</p><p id="b15b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦:</strong></p><ol class=""><li id="e60e" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">ç¡®ä¿å†™å…¥æ­£ç¡®çš„æ–‡ä»¶ç³»ç»ŸIDå’Œæ–‡ä»¶ç³»ç»Ÿè®¿é—®ç‚¹</li><li id="e5eb" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">ä¸è¦æ›´æ”¹å­˜å‚¨ç±»åç§°ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥åˆ›å»ºå­˜å‚¨ç±»æ—¶å·²ç»ä½¿ç”¨äº†è¯¥åç§°</li></ol><h2 id="42fa" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">æŒç»­é‡ç´¢èµ”</h2><p id="117e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">å¦‚æœæ‚¨ç†Ÿæ‚‰K8sæ¦‚å¿µï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºStatefulsetæˆ–Podæˆ–éƒ¨ç½²æ—¶ï¼Œæ¯ä¸ªPVåªèƒ½ä½¿ç”¨PVCè¿›è¡Œå®‰è£…</p><p id="1653" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="du mc md me mf b">atlantis-pvc.yml</code>çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å‡ è¡Œ</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="ef43" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: atlantis-claim<br/>spec:<br/>  accessModes:<br/>    - ReadWriteMany<br/>  storageClassName: atlantis-sc<br/>  resources:<br/>    requests:<br/>      storage: 5Gi</span></pre><p id="9fd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºæ°¸ä¹…å·ç´¢èµ”</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="4361" class="kx jv hi mf b fi mm mn l mo mp">kubectl create -f <!-- -->atlantis-pvc.yml</span></pre><p id="1fc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯æ˜¯å¦åˆ›å»ºäº†æ°¸ä¹…å·å£°æ˜</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="74a1" class="kx jv hi mf b fi mm mn l mo mp">kubectl get pvc atlantis-claim</span><span id="c6ef" class="kx jv hi mf b fi nc mn l mo mp">#Output</span><span id="fada" class="kx jv hi mf b fi nc mn l mo mp">NAME             STATUS   VOLUME        CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br/>atlantis-claim   Bound    atlantis-pv   5Gi        RWX            atlantis-sc    5s</span></pre><p id="7dc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong></p><ol class=""><li id="4cbc" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">ä¸è¦æ›´æ”¹å­˜å‚¨ç±»åå’Œå­˜å‚¨å€¼ï¼Œè¿™äº›å€¼åº”è¯¥ä¸PVçš„é…ç½®ç›¸åŒ¹é…</li><li id="a6e1" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">ç¡®ä¿PVCçš„<strong class="ih hj">çŠ¶æ€</strong>ä¸º<strong class="ih hj">ç»‘å®š</strong></li></ol><h2 id="7549" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">ç§˜å¯†</h2><p id="7ec7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æˆ‘ä»¬å°†åœ¨kubernetesç§˜å¯†ä¸­å­˜å‚¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯†ç å’ŒWeb-hookä»¤ç‰Œ(BitBucketä¸éœ€è¦),ç„¶åæˆ‘ä»¬å°†è¿™ä¸ªç§˜å¯†æ³¨å…¥statefulsetï¼Œè¿™æ ·Atlantiså°±å¯ä»¥ä»repoä¸­å…‹éš†æˆ‘ä»¬çš„ä»£ç </p><p id="bc3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨BitBucket</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="9d46" class="kx jv hi mf b fi mm mn l mo mp"># Write your token in file</span><span id="87ab" class="kx jv hi mf b fi nc mn l mo mp">echo -n "yourtoken" &gt; token</span><span id="3cac" class="kx jv hi mf b fi nc mn l mo mp"># Create secret</span><span id="69e3" class="kx jv hi mf b fi nc mn l mo mp">kubectl create secret generic atlantis-vcs --from-file=token</span></pre><p id="0155" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å…¶ä»–VCS</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="7fc6" class="kx jv hi mf b fi mm mn l mo mp"># Write your token and webhook secret in file</span><span id="f0c7" class="kx jv hi mf b fi nc mn l mo mp">echo -n "yourtoken" &gt; token<br/>echo -n "yoursecret" &gt; webhook-secret</span><span id="5e6d" class="kx jv hi mf b fi nc mn l mo mp"># Create Secret</span><span id="562c" class="kx jv hi mf b fi nc mn l mo mp">kubectl create secret generic atlantis-vcs --from-file=token --from-file=webhook-secret</span></pre><p id="e231" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯æœºå¯†æ˜¯å¦å·²æˆåŠŸåˆ›å»º</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="0186" class="kx jv hi mf b fi mm mn l mo mp">kubectl get secret <!-- -->atlantis-vcs</span></pre><h2 id="43a0" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">AtlantisæœåŠ¡å™¨ç«¯é…ç½®</h2><p id="b034" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æœåŠ¡å™¨ç«¯å›è´­é…ç½®æ–‡ä»¶ç”¨äºæ§åˆ¶æ¯æ¬¡å›è´­çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦æ±‚æ‰€æœ‰(æˆ–ç‰¹å®š)å›è´­å¿…é¡»åœ¨Atlantiså…è®¸è¿è¡Œ<code class="du mc md me mf b">apply.</code>ä¹‹å‰è·å¾—æ‰¹å‡†</p><p id="a688" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªK8s ConfigMapå¯¹è±¡æ¥å­˜å‚¨Atlantisçš„æœåŠ¡å™¨ç«¯é…ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†åœ¨Atlantisä¸­ä½¿ç”¨è¿™ä¸ªé…ç½®</p><p id="52b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ³¨æ„:</strong>ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºAtlantisæœåŠ¡å™¨ç«¯é…ç½®<a class="ae jd" href="https://www.runatlantis.io/docs/server-side-repo-config.html" rel="noopener ugc nofollow" target="_blank">çš„å†…å®¹ã€‚</a></p><p id="db87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="du mc md me mf b">atlantis-repo-config-configmap.yml</code>çš„æ–‡ä»¶</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="0066" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: atlantis-repo-config<br/>data:<br/>  repos.yaml: |<br/>    repos:<br/>      # id can either be an exact repo ID or a regex.<br/>      # If using a regex, it must start and end with a slash.<br/>      # Repo ID's are of the form {VCS hostname}/{org}/{repo name}<br/>      # ex. github.com/runatlantis/atlantis.<br/>      - id: <!-- -->{VCS hostname}/{org}/{repo name}<br/>        apply_requirements: [<!-- -->approved<!-- -->]<br/>        allowed_overrides: [workflow]<br/>        allow_custom_workflows: true</span></pre><p id="cb3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ ¹æ®æ‚¨çš„å›è´­URLæ›¿æ¢<code class="du mc md me mf b">{VCS hostname}/{org}/{repo name}</code></p><p id="5612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨è¿™ä¸ªrepoé…ç½®ä¸­ï¼ŒAtlantiså°†åªå…è®¸åœ¨æ‹‰åŠ¨è¯·æ±‚è¢«æ‰¹å‡†æ—¶è¿è¡Œ<code class="du mc md me mf b">apply</code>å‘½ä»¤ã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œé…ç½®</p><p id="a441" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºé…ç½®æ˜ å°„</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="72d3" class="kx jv hi mf b fi mm mn l mo mp">kubectl create -f <!-- -->atlantis-repo-config-configmap.yml</span></pre><p id="9d37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯é…ç½®æ˜ å°„æ˜¯å¦å·²æˆåŠŸåˆ›å»º</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="d2ea" class="kx jv hi mf b fi mm mn l mo mp">kubectl get cm atlantis-repo-config</span><span id="78e2" class="kx jv hi mf b fi nc mn l mo mp"># Output</span><span id="5603" class="kx jv hi mf b fi nc mn l mo mp">NAME                   DATA   AGE<br/>atlantis-repo-config   1      10s</span></pre><h2 id="9151" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">äºšç‰¹å…°è’‚æ–¯çš„æœåŠ¡å¸æˆ·</h2><p id="0d28" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æˆ‘ä»¬çŸ¥é“Atlantiså°†è¿è¡ŒTerraformå‘½ä»¤ï¼Œå®ƒå°†åˆ›å»ºã€æ›´æ–°æˆ–é”€æ¯èµ„æºï¼Œä½†æ˜¯ä¸ºäº†å®Œæˆæ‰€æœ‰è¿™äº›äº‹æƒ…ï¼Œæˆ‘ä»¬çš„Atlantiså®¹å™¨åº”è¯¥å…·æœ‰é€‚å½“çš„IAMæƒé™æ¥åœ¨AWSä¸­åˆ›å»ºä»»ä½•èµ„æºï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸ºæœåŠ¡å¸æˆ·(IRSA)åˆ›å»ºIAMè§’è‰²</p><p id="99da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ å¿…é¡»çŸ¥é“ï¼Œæ¯ä¸ªFaragteé…ç½®æ–‡ä»¶éƒ½æœ‰Faragte Podæ‰§è¡Œè§’è‰²ï¼Œå®ƒå¯ä»¥æˆäºˆè°ƒç”¨AWS APIçš„æƒé™ã€‚ç”±äºTerraformå°†æ‹¥æœ‰æ‰§è¡Œæ‰€æœ‰æ“ä½œçš„ç®¡ç†å‘˜æƒé™ï¼Œå› æ­¤ä¸å»ºè®®åœ¨Podæ‰§è¡Œè§’è‰²ä¸­æˆäºˆç®¡ç†å‘˜æƒé™ï¼Œå› ä¸ºè¿™æ ·åšä¼šå°†ä¸å¿…è¦çš„ç®¡ç†å‘˜æƒé™æˆäºˆå…¶ä»–Podã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨IRSAæ¥æ§åˆ¶PODçº§åˆ«çš„æƒé™ã€‚</p><p id="e3fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨éƒ¨ç½²AWSè´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨æ—¶ï¼Œæˆ‘ä»¬å·²ç»ä¸ºé›†ç¾¤åˆ›å»ºäº†ä¸€ä¸ªOIDCæä¾›è€…ã€‚</p><p id="6fb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¿™åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬åˆ›å»ºå…·æœ‰å¿…è¦æƒé™çš„IAMè§’è‰²ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æˆ‘ä»¬åˆ›å»ºæœåŠ¡å¸æˆ·å¹¶å°†è¯¥SAé™„åŠ åˆ°K8sä¸­çš„POD</p><p id="3cb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">åˆ›å»ºIAMè§’è‰²</strong></p><ul class=""><li id="d0e5" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">æ‰“å¼€IAMæ§åˆ¶å°</li><li id="1881" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨å¯¼èˆªé¢æ¿ä¸­ï¼Œé€‰æ‹©<strong class="ih hj">è§’è‰²</strong>ï¼Œ<strong class="ih hj">åˆ›å»ºè§’è‰²</strong></li><li id="2ce7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">é€‰æ‹©å¯ä¿¡å®ä½“ç±»å‹</strong>éƒ¨åˆ†ï¼Œé€‰æ‹©<strong class="ih hj"> Webèº«ä»½</strong></li><li id="2c31" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">é€‰æ‹©ç½‘ç»œèº«ä»½æä¾›å•†</strong>éƒ¨åˆ†</li></ul><p id="d10d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I .å¯¹äº<strong class="ih hj">èº«ä»½æä¾›è€…</strong>ï¼Œé€‰æ‹©æ‚¨çš„é›†ç¾¤çš„URL</p><p id="5eaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">äºŒã€‚å¯¹äº<strong class="ih hj">è§‚ä¼—</strong>ï¼Œé€‰æ‹©<code class="du mc md me mf b">sts.amazonaws.com</code></p><ul class=""><li id="b4c9" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">ä¸‹ä¸€æ­¥:æƒé™</strong></li><li id="1cb7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">é™„åŠ ç­–ç•¥</strong>éƒ¨åˆ†ï¼Œé€‰æ‹©<code class="du mc md me mf b">AdministratorAccess</code>ç­–ç•¥</li><li id="3ad7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">ä¸‹ä¸€æ­¥:æ ‡ç­¾</strong></li><li id="d0a4" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åœ¨<strong class="ih hj">æ·»åŠ æ ‡ç­¾(å¯é€‰)</strong>å±å¹•ä¸Šï¼Œæ‚¨å¯ä»¥ä¸ºå¸æˆ·æ·»åŠ æ ‡ç­¾ã€‚é€‰æ‹©<strong class="ih hj">ä¸‹ä¸€æ­¥:å¤ä¹ </strong></li><li id="d394" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">å¯¹äº<strong class="ih hj">è§’è‰²åç§°</strong>ï¼Œè¾“å…¥æ‚¨çš„è§’è‰²åç§°ï¼Œå¦‚<code class="du mc md me mf b"><em class="mg">Atlantis-Admin-Role</em></code>ï¼Œç„¶åé€‰æ‹©<strong class="ih hj">åˆ›å»ºè§’è‰²</strong></li><li id="3d02" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">åˆ›å»ºè§’è‰²åï¼Œåœ¨æ§åˆ¶å°ä¸­é€‰æ‹©è§’è‰²ä»¥æ‰“å¼€å®ƒè¿›è¡Œç¼–è¾‘</li><li id="02c1" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">ä¿¡ä»»å…³ç³»</strong>é€‰é¡¹å¡ï¼Œç„¶åé€‰æ‹©<strong class="ih hj">ç¼–è¾‘ä¿¡ä»»å…³ç³»</strong></li></ul><p id="2cf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‰¾åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¡Œ:</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="5448" class="kx jv hi mf b fi mm mn l mo mp">"oidc.eks.&lt;<em class="mg">region-code</em>&gt;.amazonaws.com/id/EXAMPLED539D4633E53DE1B716D3041E:aud": "sts.amazonaws.com"</span></pre><p id="f07d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°†è¯¥è¡Œæ›´æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºã€‚å°†<code class="du mc md me mf b"><em class="mg">&lt;EXAMPLED539D4633E53DE1B716D3041E&gt;</em></code>(åŒ…æ‹¬<code class="du mc md me mf b"><em class="mg">&lt;&gt;</em></code>)æ›¿æ¢ä¸ºæ‚¨çš„é›†ç¾¤çš„OIDCæä¾›å•†IDï¼Œå°†<code class="du mc md me mf b"><em class="mg">&lt;region-code&gt;</em></code>æ›¿æ¢ä¸ºæ‚¨çš„é›†ç¾¤æ‰€åœ¨çš„åœ°åŒºä»£ç </p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="f45f" class="kx jv hi mf b fi mm mn l mo mp">"oidc.eks.<em class="mg">&lt;region-code&gt;</em>.amazonaws.com/id/<em class="mg">&lt;EXAMPLED539D4633E53DE1B716D3041E&gt;</em>:sub": "system:serviceaccount:default:atlantis-sa"</span></pre><ul class=""><li id="3911" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc lq lr ls lt bi translated">é€‰æ‹©<strong class="ih hj">æ›´æ–°ä¿¡ä»»ç­–ç•¥</strong>å®Œæˆ</li><li id="a0c7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">è®°ä¸‹è§’è‰²çš„ARNï¼Œä»¥ä¾¿åœ¨åé¢çš„æ­¥éª¤ä¸­ä½¿ç”¨</li></ul><p id="6d9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">åˆ›å»ºæœåŠ¡è´¦æˆ·</strong></p><p id="7451" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å°†ä»¥ä¸‹å†…å®¹ä¿å­˜åˆ°åä¸º<code class="du mc md me mf b"><em class="mg">atlantis-service-account.yml</em></code>çš„æ–‡ä»¶ä¸­</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="4a11" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: atlantis-sa<br/>  annotations:<br/>      eks.amazonaws.com/role-arn: arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:role/&lt;YOUR_IAM_ROLE_NAME&gt;</span></pre><p id="0e3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong>ä¸è¦æ›´æ”¹æœåŠ¡å¸æˆ·åç§°ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨IAMè§’è‰²çš„ä¿¡ä»»ç­–ç•¥ä¸­é…ç½®äº†è¯¥åç§°</p><h2 id="7b3e" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">æœ‰çŠ¶æ€é›†åˆ</h2><p id="d21f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†æ‰€æœ‰éœ€è¦çš„K8sèµ„æºï¼Œç°åœ¨æˆ‘ä»¬å‡†å¤‡åˆ›å»ºæœ‰çŠ¶æ€çš„Setï¼Œå®ƒå°†åœ¨AWS EKS Faragteé›†ç¾¤ä¸­è¿è¡ŒAtlantisæœåŠ¡å™¨</p><p id="c0ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="du mc md me mf b">atlantis-stateful-set.yml</code>çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><p id="22db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ³¨æ„:</strong>æˆ‘ä½¿ç”¨BitBucketä½œä¸ºæˆ‘çš„VCSï¼Œæ‰€ä»¥ä¸‹é¢çš„æ–‡ä»¶æœ‰åŸºäºBitBucket VCSçš„ç¯å¢ƒå˜é‡ã€‚</p><p id="7ce2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯VCSè€Œä¸æ˜¯ä½å­˜å‚¨æ¡¶ï¼Œåˆ™æ›¿æ¢<strong class="ih hj"> ###ä½å­˜å‚¨æ¡¶é…ç½®# # #</strong>â€¦â€¦â€¦â€¦<strong class="ih hj"># # # End bit bucket Config # # #</strong>æ‚¨å¯ä»¥å°†æ­¤<a class="ae jd" href="https://www.runatlantis.io/docs/deployment.html#deployment-2" rel="noopener ugc nofollow" target="_blank">é“¾æ¥</a>ç”¨äºæ‚¨çš„VCSç‰¹å®šç¯å¢ƒå˜é‡ã€‚</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="a0e3" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: apps/v1<br/>kind: StatefulSet<br/>metadata:<br/>  name: atlantis<br/>spec:<br/>  serviceName: atlantis<br/>  replicas: 1<br/>  updateStrategy:<br/>    type: RollingUpdate<br/>    rollingUpdate:<br/>      partition: 0<br/>  selector:<br/>    matchLabels:<br/>      app: atlantis<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: atlantis<br/>    spec:<br/>      serviceAccountName: atlantis-sa<br/>      securityContext:<br/>        fsGroup: 1000 # Atlantis group (1000) read/write access to volumes.<br/>      volumes:<br/>        - name: repo-config<br/>          configMap:<br/>            name: atlantis-repo-config<br/>        - name: atlantis-data<br/>          persistentVolumeClaim:<br/>            claimName: atlantis-claim<br/>      containers:<br/>      - name: atlantis<br/>        image: runatlantis/atlantis:v0.17.0 # 1. Replace &lt;VERSION&gt; with the most recent release.<br/>        env:<br/>        - name: ATLANTIS_REPO_ALLOWLIST<br/>          value: <strong class="mf hj">{VCS hostname}/{org}/{repo name}</strong> # 2. Replace this with your own repo allowlist.</span><span id="0102" class="kx jv hi mf b fi nc mn l mo mp">        - name: ATLANTIS_DEFAULT_TF_VERSION<br/>          value: <strong class="mf hj">&lt;YOUR_TF_VERSION&gt;</strong></span><span id="c777" class="kx jv hi mf b fi nc mn l mo mp">        ### Bitbucket Config ###<br/>        - name: ATLANTIS_BITBUCKET_USER<br/>          value: <strong class="mf hj">&lt;YOUR_BITBUCKET_USER&gt;</strong> # 5i. If you're using Bitbucket replace &lt;YOUR_BITBUCKET_USER&gt; with the username of your Atlantis Bitbucket user without the `@`.<br/>        - name: ATLANTIS_BITBUCKET_TOKEN<br/>          valueFrom:<br/>            secretKeyRef:<br/>              name: atlantis-vcs<br/>              key: token<br/>        ### End Bitbucket Config ###</span><span id="c3c8" class="kx jv hi mf b fi nc mn l mo mp">        - name: ATLANTIS_DATA_DIR<br/>          value: /atlantis<br/>        - name: ATLANTIS_PORT<br/>          value: "4141" # Kubernetes sets an ATLANTIS_PORT variable so we need to override.<br/>        - name: ATLANTIS_REPO_CONFIG<br/>          value: /atlantis/repos.yaml<br/>        volumeMounts:<br/>        - name: atlantis-data<br/>          mountPath: /atlantis<br/>        - name: repo-config<br/>          mountPath: /atlantis/repos.yaml<br/>          subPath: repos.yaml<br/>          readOnly: true<br/>        ports:<br/>        - name: atlantis<br/>          containerPort: 4141<br/>        resources:<br/>          requests:<br/>            memory: 256Mi<br/>            cpu: 100m<br/>          limits:<br/>            memory: 256Mi<br/>            cpu: 100m<br/>        livenessProbe:<br/>          # We only need to check every 60s since Atlantis is not a<br/>          # high-throughput service.<br/>          periodSeconds: 60<br/>          httpGet:<br/>            path: /healthz<br/>            port: 4141<br/>            # If using https, change this to HTTPS<br/>            scheme: HTTP<br/>        readinessProbe:<br/>          periodSeconds: 60<br/>          httpGet:<br/>            path: /healthz<br/>            port: 4141<br/>            # If using https, change this to HTTPS<br/>            scheme: HTTP</span></pre><p id="485b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éœ€è¦æ³¨æ„çš„è¦ç‚¹:</p><ol class=""><li id="c4f2" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨<code class="du mc md me mf b">/atlantis</code>ä½œä¸ºæ•°æ®ç›®å½•æ¥å­˜å‚¨æ‰€æœ‰äºšç‰¹å…°è’‚æ–¯ç›¸å…³çš„æ•°æ®ï¼Œæˆ‘ä»¬å·²ç»åœ¨EFSæ¥å…¥ç‚¹é…ç½®äº†ç›¸åŒçš„è·¯å¾„</li><li id="6262" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">äºšç‰¹å…°è’‚æ–¯å°†ç›‘å¬ç«¯å£<code class="du mc md me mf b">4141</code></li><li id="edf7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">æˆ‘ä»¬ä½¿ç”¨<code class="du mc md me mf b">Service Account</code>æ¥æˆäºˆè°ƒç”¨AWS APIè°ƒç”¨çš„æƒé™</li><li id="790a" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">æˆ‘ä»¬å·²ç»å®‰è£…äº†<code class="du mc md me mf b">PersistentVolumeClaim</code>ï¼Œå®ƒå°†æŠŠæˆ‘ä»¬çš„æ•°æ®å­˜å‚¨åœ¨AWSå¼¹æ€§æ–‡ä»¶ç³»ç»Ÿä¸­</li><li id="f9c9" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">æˆ‘ä»¬ç”¨çš„æ˜¯äºšç‰¹å…°è’‚æ–¯ç‰ˆæœ¬<code class="du mc md me mf b">v0.17.0</code></li><li id="c200" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">å¸¦æœ‰<code class="du mc md me mf b">v0.17.0</code>çš„Atlantisæ˜ åƒå¸¦æœ‰é»˜è®¤çš„Terraformç‰ˆæœ¬<code class="du mc md me mf b">0.15.1</code>ï¼Œå› æ­¤å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯é™¤æ­¤ä¹‹å¤–çš„Terraformç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦è®¾ç½®<code class="du mc md me mf b">ATLANTIS_DEFAULT_TF_VERSION</code> Envå˜é‡ã€‚</li><li id="0815" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">æˆ‘ä»¬å·²ç»ä»ConfigMapæŒ‚è½½äº†æˆ‘ä»¬çš„æœåŠ¡å™¨ç«¯repoé…ç½®</li></ol><p id="beb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Atlantisæä¾›äº†å¤šä¸ªæœåŠ¡å™¨å‚æ•°ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå‚è€ƒæ”¯æŒçš„å‚æ•°<a class="ae jd" href="https://www.runatlantis.io/docs/server-configuration.html" rel="noopener ugc nofollow" target="_blank">ã€‚æ¯ä¸ªæœåŠ¡å™¨å‚æ•°éƒ½å¯ä»¥åœ¨æˆ‘ä»¬çš„å®¹å™¨ä¸­è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚è®¾ç½®ç¯å¢ƒå˜é‡çš„æ ¼å¼å¯ä»¥åœ¨</a><a class="ae jd" href="https://www.runatlantis.io/docs/server-configuration.html#environment-variables" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚æˆ‘ä»¬æœ‰çŠ¶æ€è®¾ç½®æ–‡ä»¶ä¸­çš„æ¯ä¸ªç¯å¢ƒå˜é‡éƒ½ä½¿ç”¨ç›¸åŒçš„è¯­æ³•ã€‚</p><p id="ed16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæœ‰çŠ¶æ€é›†</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="7ddd" class="kx jv hi mf b fi mm mn l mo mp">kubectl create -f <!-- -->atlantis-stateful-set.yml</span></pre><p id="bed2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯æœ‰çŠ¶æ€é›†æ­£åœ¨è¿è¡Œæ‚¨çš„å®¹å™¨</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="4da4" class="kx jv hi mf b fi mm mn l mo mp">kubectl get sts atlantis</span><span id="dfe9" class="kx jv hi mf b fi nc mn l mo mp">NAME       READY   AGE<br/>atlantis   1/1     200s</span></pre><p id="a6af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯podæ­£åœ¨è¿è¡Œ</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="e672" class="kx jv hi mf b fi mm mn l mo mp">kubectl get po</span><span id="3e05" class="kx jv hi mf b fi nc mn l mo mp">NAME         READY   STATUS    RESTARTS   AGE<br/>atlantis-0   1/1     Running   0          300s</span></pre><p id="c7b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æŸ¥çœ‹äºšç‰¹å…°è’‚æ–¯å·çš„æ—¥å¿—</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="1ef1" class="kx jv hi mf b fi mm mn l mo mp">kubectl logs atlantis-0 --tail=100</span></pre><p id="ba00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">è¦è°ƒè¯•è¯¥é—®é¢˜ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æ—¥å¿—æˆ–æè¿°pod</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="1bab" class="kx jv hi mf b fi mm mn l mo mp">kubectl describe po atlantis-0</span></pre><p id="798a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ­å–œä½ ï¼ŒğŸ¥³ï¼Œä½ å·²ç»æˆåŠŸè¿è¡Œäº†äºšç‰¹å…°è’‚æ–¯æœåŠ¡å™¨</p><h2 id="2c85" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated"><strong class="ak">å…¬å¼€æœ‰çŠ¶æ€é›†åˆ</strong></h2><p id="ff7f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æˆ‘ä»¬å·²ç»æˆåŠŸé…ç½®äº†æˆ‘ä»¬çš„AtlantisæœåŠ¡å™¨ï¼Œç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªNodePortå’ŒIngressèµ„æºç±»å‹çš„æœåŠ¡æ¥å…¬å¼€æˆ‘ä»¬çš„AtlantisæœåŠ¡å™¨ã€‚</p><p id="6dc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">åˆ›å»ºæœåŠ¡</strong></p><p id="9219" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºåä¸º<code class="du mc md me mf b">atlantis-service.yml</code>çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹è¡Œ</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="44ae" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: atlantis<br/>spec:<br/>  type: NodePort<br/>  ports:<br/>  - name: atlantis<br/>    port: 80<br/>    targetPort: 4141<br/>  selector:<br/>    app: atlantis</span></pre><p id="860a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong></p><ol class=""><li id="a896" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">ä¸è¦æ›´æ”¹æœåŠ¡åï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨æœ‰çŠ¶æ€é›†ä¸­ä½¿ç”¨äº†è¿™ä¸ªåç§°</li><li id="9632" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc mh lr ls lt bi translated">å®ƒå»ºè®®ä¸è¦é€‰æ‹©ä»»ä½•ç‰¹å®šçš„èŠ‚ç‚¹ç«¯å£ï¼Œè®©K8sä¸ºæˆ‘ä»¬å†³å®šç«¯å£ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä½¿ç”¨å…¥å£æ¥æ§åˆ¶æµé‡çš„è·¯ç”±</li></ol><p id="d7d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">åˆ›å»ºå…¥å£</strong></p><p id="7eda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºå…¥å£ï¼Œå°†æµé‡è·¯ç”±åˆ°æˆ‘ä»¬çš„æœåŠ¡ã€‚å®ƒå°†åˆ›å»ºåº”ç”¨ç¨‹åºè´Ÿè½½å¹³è¡¡å™¨(ALB ),å› ä¸ºæˆ‘ä»¬å·²ç»éƒ¨ç½²äº†ALBå…¥å£æ§åˆ¶å™¨ã€‚æˆ‘è¿˜é…ç½®äº†æ³¨é‡Šæ¥è®¾ç½®æ¥è‡ªACMçš„SSLè¯ä¹¦ï¼Œå¹¶å°†HTTPé‡å®šå‘åˆ°HTTPS</p><p id="bbe0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åˆ›å»ºä¸€ä¸ªåä¸º<code class="du mc md me mf b">atlantis-ing.yml</code>çš„æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å‡ è¡Œ</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="108f" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: atlantis-ingress<br/>  annotations:<br/>    kubernetes.io/ingress.class: alb<br/>    alb.ingress.kubernetes.io/scheme: internet-facing<br/>    alb.ingress.kubernetes.io/target-type: ip<br/>    alb.ingress.kubernetes.io/certificate-arn: &lt;YOUR_ACM_ARN&gt;<br/>    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'<br/>    alb.ingress.kubernetes.io/actions.ssl-redirect: '{"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}'<br/>spec:<br/>  rules:<br/>    - http:<br/>        paths:<br/>          - path: /*<br/>            backend:<br/>              serviceName: ssl-redirect<br/>              servicePort: use-annotation<br/>          - path: /*<br/>            backend:<br/>              serviceName: atlantis<br/>              servicePort: 80</span></pre><p id="750e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">å¦‚æœæ‚¨æ²¡æœ‰åŸŸåæˆ–ä¸æƒ³ä½¿ç”¨SSLå’Œè¯ä¹¦ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å…¥å£é…ç½®</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="d45b" class="kx jv hi mf b fi mm mn l mo mp">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: ingress-resource<br/>  annotations:<br/>    kubernetes.io/ingress.class: alb<br/>    alb.ingress.kubernetes.io/scheme: internet-facing<br/>    alb.ingress.kubernetes.io/target-type: ip<br/>    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'<br/>spec:<br/>  rules:<br/>    - http:<br/>        paths:<br/>          - path: /*<br/>            backend:<br/>              serviceName: atlantis<br/>              servicePort: 80</span></pre><p id="71f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦æç¤º:</strong></p><ol class=""><li id="8a78" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">å¯¹äºEKSæ³•ç›–ç‰¹å‘å°„ç±»å‹ï¼Œ<code class="du mc md me mf b">target-type</code>å¿…é¡»æ˜¯ip</li></ol><p id="06ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºALBå…¥å£æ§åˆ¶å™¨æ”¯æŒçš„æ³¨é‡Šã€‚</p><p id="c676" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå…¥å£</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="de5f" class="kx jv hi mf b fi mm mn l mo mp">kubectl create -f <!-- -->atlantis-ing.yml</span></pre><p id="6222" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">éªŒè¯å…¥å£æ˜¯å¦å·²åˆ›å»º</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="fcb4" class="kx jv hi mf b fi mm mn l mo mp">kubectl get ing ingress-resource</span><span id="e2e1" class="kx jv hi mf b fi nc mn l mo mp">Warning: extensions/v1beta1 Ingress is deprecated in v1.14+, unavailable in v1.22+; use networking.k8s.io/v1 Ingress<br/>NAME               CLASS    HOSTS   ADDRESS                                                                   PORTS   AGE<br/>atlantis-ingress   &lt;none&gt;   *       k8s-default-xxxxxxx-xxxxxxxxx-xxxxxxxxx.&lt;your_region&gt;.elb.amazonaws.com   80      10s</span></pre><p id="ce9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">æ³¨æ„:</strong>å¦‚æœå‡ åˆ†é’Ÿåä»æœªåˆ›å»ºå…¥å£ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è´Ÿè½½å¹³è¡¡å™¨æ§åˆ¶å™¨æ—¥å¿—ã€‚è¿™äº›æ—¥å¿—å¯èƒ½åŒ…å«æœ‰åŠ©äºæ‚¨è¯Šæ–­éƒ¨ç½²é—®é¢˜çš„é”™è¯¯æ¶ˆæ¯ã€‚</p><pre class="jf jg jh ji fd mi mf mj mk aw ml bi"><span id="5de6" class="kx jv hi mf b fi mm mn l mo mp">kubectl logs -n kube-system deployment.apps/aws-load-balancer-controller</span></pre><h2 id="a616" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">åœ¨Route53ä¸­åˆ›å»ºåˆ«å</h2><p id="5363" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">ä¸€æ—¦ä½¿ç”¨SSLè¯ä¹¦åˆ›å»ºäº†å…¥å£ï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡åœ¨è·¯ç”±53ä¸­åˆ›å»º<strong class="ih hj">åˆ«åè®°å½•é›†</strong>æ¥å°†ALBçš„URLæ˜ å°„åˆ°è·¯ç”±53</p><h2 id="e89f" class="kx jv hi bd jw ky kz la ka lb lc ld ke iq le lf ki iu lg lh km iy li lj kq lk bi translated">é…ç½®Webhooks</h2><p id="8fd8" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Atlantiséœ€è¦ä»æ‚¨çš„Gitä¸»æœºæ¥æ”¶Webhooksï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿå“åº”pullè¯·æ±‚äº‹ä»¶</p><p id="e645" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¯ä»¥ä½¿ç”¨é“¾æ¥<a class="ae jd" href="https://www.runatlantis.io/docs/configuring-webhooks.html" rel="noopener ugc nofollow" target="_blank">https://www.runatlantis.io/docs/configuring-webhooks.html</a>æ ¹æ®æ‚¨çš„VCSé…ç½®Webhooks</p><p id="b437" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">é‡è¦:</strong></p><ol class=""><li id="d131" class="ll lm hi ih b ii ij im in iq lz iu ma iy mb jc mh lr ls lt bi translated">å†™å…¥URLæ—¶ï¼Œè¯·ç¡®ä¿å†™å…¥Route 53è®°å½•åç§°æˆ–K8så…¥å£èµ„æºåœ°å€ã€‚</li></ol><h1 id="eaec" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">æ­å–œä½ ï¼</h1><p id="8175" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">æ‚¨å·²ç»æˆåŠŸåœ°å®Œæˆäº†é…ç½®AtlantisæœåŠ¡å™¨çš„æ‰€æœ‰æ­¥éª¤ï¼Œç°åœ¨æ‚¨å¯ä»¥æµ‹è¯•å®ƒäº†ã€‚</p><p id="8f14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">åœ¨æ‚¨çš„repoä¸­åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œè¿›è¡Œä¸€äº›ä»£ç æ›´æ”¹ï¼Œå°†æ‚¨çš„ä»£ç æ¨é€åˆ°Repoä¸­ï¼Œè€Œä¸æ˜¯ä»æœ¬åœ°æˆ–è‡ªåŠ¨åŒ–æœåŠ¡å™¨è¿è¡ŒTerraformï¼Œåˆ›å»ºä¸€ä¸ªpullè¯·æ±‚ï¼Œä¸€æ—¦æ‚¨åˆ›å»ºäº†å®ƒï¼ŒAtlantiså°†å¼€å§‹å¯¹å®ƒè¿›è¡Œæ“ä½œï¼Œå®ƒå°†ä½¿ç”¨<code class="du mc md me mf b">plan</code>å¯¹æ‚¨çš„PRè¿›è¡Œè¯„è®ºã€‚Atlantiséœ€è¦ä¸€äº›æ—¶é—´å¯¹æ‚¨çš„PRè¿›è¡Œè¯„è®ºï¼Œå› ä¸ºå®ƒå°†åœ¨å†…éƒ¨è¿è¡Œå‘½ä»¤ï¼Œä¸€æ—¦å®Œæˆï¼Œå®ƒå°†å¯¹PRè¿›è¡Œè¯„è®º</p><p id="9d4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">æ‚¨å¯ä»¥ä»å®¹å™¨ä¸­æŸ¥çœ‹æ—¥å¿—æ¥è°ƒè¯•ä»»ä½•é—®é¢˜ã€‚å®ƒå¯¹æˆ‘æ¥è¯´ä¹Ÿæ˜¯æ–°çš„ï¼Œä½†æ˜¯å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–è€…ä½ é¢ä¸´ä»»ä½•é—®é¢˜ï¼Œä½ å¯ä»¥è”ç³»æˆ‘ã€‚</p><p id="db64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="mg">è°¢è°¢ï¼</em> </strong></p><h1 id="b086" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">å‚è€ƒ</h1><ul class=""><li id="24d8" class="ll lm hi ih b ii ks im kt iq ln iu lo iy lp jc lq lr ls lt bi translated"><a class="ae jd" href="https://aws.amazon.com/premiumsupport/knowledge-center/eks-alb-ingress-controller-fargate/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/premium support/knowledge-center/eks-ALB-ingress-controller-fargate/</a></li><li id="4501" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/eks/latest/user guide/AWS-load-balancer-controller . html</a></li><li id="ac8f" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/eks/latest/user guide/al b-ingress . html</a></li><li id="c3c9" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/eks/latest/user guide/iam-roles-for-service-accounts . html</a></li><li id="e37b" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/ingress/annotations/" rel="noopener ugc nofollow" target="_blank">https://kubernetes-sigs . github . io/AWS-load-balancer-controller/v 2.2/guide/ingress/annotations/</a></li><li id="6cf7" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.2/guide/tasks/ssl_redirect/" rel="noopener ugc nofollow" target="_blank">https://kubernetes-sigs . github . io/AWS-load-balancer-controller/v 2.2/guide/tasks/SSL _ redirect/</a></li><li id="ad9b" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://aws.amazon.com/blogs/containers/running-stateful-workloads-with-amazon-eks-on-aws-fargate-using-amazon-efs/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/containers/running-stateful-workloads-with-Amazon-eks-on-AWS-fargate-using-Amazon-EFS/</a></li><li id="85de" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://dev.to/k8sdev/deploying-statefulset-on-private-eks-on-fargate-cluster-with-efs-4gph" rel="noopener ugc nofollow" target="_blank">https://dev . to/k8s dev/deploying-stateful set-on-private-eks-on-fargate-cluster-with-EFS-4gph</a></li><li id="eb9a" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">ã€https://www.runatlantis.io/docs/server-configuration.html T4ã€‘</li><li id="6019" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://www.runatlantis.io/docs/deployment.html#deployment-2" rel="noopener ugc nofollow" target="_blank">https://www . run Atlantis . io/docs/deployment . html # deployment-2</a></li><li id="e29b" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://www.runatlantis.io/docs/server-side-repo-config.html#do-i-need-a-server-side-repo-config-file" rel="noopener ugc nofollow" target="_blank">https://www . run Atlantis . io/docs/server-side-repo-config . html # do-I-need-a-server-side-repo-config-file</a></li><li id="f106" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://www.runatlantis.io/docs/apply-requirements.html" rel="noopener ugc nofollow" target="_blank">https://www.runatlantis.io/docs/apply-requirements.html</a></li><li id="583e" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://www.runatlantis.io/docs/custom-workflows.html#use-cases" rel="noopener ugc nofollow" target="_blank">https://www . run Atlantis . io/docs/custom-workflows . html #ç”¨ä¾‹</a></li><li id="c29f" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html" rel="noopener ugc nofollow" target="_blank">https://www . run Atlantis . io/docs/repo-level-Atlantis-YAML . html</a></li><li id="f3ce" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://github.com/runatlantis/helm-charts/blob/main/charts/atlantis/templates/statefulset.yaml" rel="noopener ugc nofollow" target="_blank">https://github . com/run Atlantis/helm-charts/blob/main/charts/Atlantis/templates/stateful set . YAML</a></li><li id="36f1" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://github.com/runatlantis/atlantis/issues/910" rel="noopener ugc nofollow" target="_blank">https://github.com/runatlantis/atlantis/issues/910</a></li><li id="b3ee" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://github.com/runatlantis/atlantis/issues/982" rel="noopener ugc nofollow" target="_blank">https://github.com/runatlantis/atlantis/issues/982</a></li><li id="c43e" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated"><a class="ae jd" href="https://github.com/runatlantis/atlantis/issues/794" rel="noopener ugc nofollow" target="_blank">https://github.com/runatlantis/atlantis/issues/794</a></li></ul></div></div>    
</body>
</html>