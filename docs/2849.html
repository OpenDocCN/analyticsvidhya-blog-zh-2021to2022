<html>
<head>
<title>Scikit-Learn Pipeline Transformers — The hassle of transforming target variables (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">sci kit-学习管道转换器——转换目标变量的麻烦(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scikit-learn-pipeline-transformers-the-hassle-of-transforming-target-variables-part-1-6dfb714e2aad?source=collection_archive---------1-----------------------#2021-05-20">https://medium.com/analytics-vidhya/scikit-learn-pipeline-transformers-the-hassle-of-transforming-target-variables-part-1-6dfb714e2aad?source=collection_archive---------1-----------------------#2021-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ef1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用Scikit-Learn对时间序列预测进行了相当长一段时间的工作后，我遇到了一个与标准化管道的实现相关的主要问题:在生产环境中创建可以将目标变量转换为特征(例如滞后、移动平均)的整个管道。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/612d1b5252a549565bc67f933e1da0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YyI68OQMVGqu-mB_Z5k-tw.png"/></div></div></figure><p id="b391" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在对该主题进行了一些广泛而徒劳的研究后，我决定尝试解决这个问题，而不必求助于混乱且有些硬编码的预处理函数，这些函数必须在实际模型之前调用。</p><p id="1a6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文第1部分的想法是介绍我如何使用一个简单而优雅的解决方案来克服这个问题。</p><h2 id="5daa" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">通常的方法</h2><p id="a9ad" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">每当您遇到关于时间序列预测问题的文章或故事时，总会有“转换为监督的”函数，在该函数中，您将传递一个数据帧或数组以及一些参数，以将一维时间序列转换为监督的学习数据集。</p><p id="f163" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的例子摘自<a class="ae kp" href="https://machinelearningmastery.com/convert-time-series-supervised-learning-problem-python/" rel="noopener ugc nofollow" target="_blank">机器学习大师</a>描述了这样一个函数</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="fdd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用这个函数进行原型设计或测试绝对没有错。主要的缺点是<strong class="ih hj">它不能用在Sklearn变压器里面。</strong></p><p id="0288" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从现在开始，我将假设您知道变压器是如何工作的，并且还知道如果您在管道上链接变压器，唯一要传递的参数是您的<em class="ks"> X </em>(特性数组)而不是您的目标变量<em class="ks"> y. </em>唯一的例外是标签transformers或<strong class="ih hj"> TransformedTargetRegressors。</strong></p><p id="bb61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">底线是:你不能使用一个将你的目标变量数组的一部分转换成你的X数组的一部分的转换器。你要么改变一个，要么改变另一个。</p><p id="30b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您不确定我在说什么，请自己尝试下面的代码并检查结果:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="f49d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您尝试运行此代码，将会出现以下错误:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="3dad" class="jp jq hi ku b fi ky kz l la lb"><strong class="ku hj">TypeError</strong>: unsupported operand type(s) for +: 'int' and 'NoneType'</span></pre><p id="7fcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是因为转换函数的<em class="ks"> y </em>参数没有通过管道传递。</p><p id="1f2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正是因为这个原因，您不能让您的数据转换都发生在一个单一的、整洁的管道中，而可以作为工件存储在任何MLOps平台上。这里唯一的选择是在创建模型之前进行特征转换。</p><h2 id="a2b2" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">好的，知道了！那么…我们该怎么办？</h2><p id="1ec1" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">首先，首先:变压器实际上是做什么的？</p><p id="4b7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据定义，它在实例化期间接受任意数量的参数，然后接受一个对象，对其进行转换，并返回转换后的对象。通常这些对象是我们的数据帧或numpy数组，然而，这里的技巧是理解这些对象实际上可以是任何东西！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/7512273bd3b903683f3df0a5ecb819e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/1*go_nvsKOycyVZHxwFwbS7g.gif"/></div></figure><p id="8a8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑到这一点，我们为什么不创建一个包含X和y的简单对象，并对其进行变换呢？</p><p id="5682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们试试上面的同一个例子，但是使用这个小技巧:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="4421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就对了。现在你有了一个转换器，可以毫不费力地转换X和y。请注意，这种策略可以进一步扩展到极其复杂的管道，并且仍然有效。</p><p id="92c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您需要调试输出数据，并且不希望到处编写打印语句和在转换中设置断点，您甚至可以使用例如列表将中间步骤中的数据分配给对象。</p><h2 id="aa17" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">结束语</h2><p id="9d3e" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">在这个故事中，我们从如何使用特性和目标变量来欺骗Scikit-Learn管道来转换我们的数据的基础开始。现在我们有了数据转换管道，这个故事的第2部分将演示我们如何将这个对象传递给我们的模型，而不必创建中间步骤，允许我们直接使用<code class="du ld le lf ku b"><strong class="ih hj">fit()</strong></code>和<code class="du ld le lf ku b"><strong class="ih hj">predict()</strong></code> <strong class="ih hj"> </strong>方法。</p><h2 id="0585" class="jp jq hi bd jr js jt ju jv jw jx jy jz iq ka kb kc iu kd ke kf iy kg kh ki kj bi translated">第二部分:</h2><p id="5788" class="pw-post-body-paragraph if ig hi ih b ii kk ik il im kl io ip iq km is it iu kn iw ix iy ko ja jb jc hb bi translated">https://Carlos-schwabe-44885 . medium . com/sci kit-learn-pipeline-transformers-the-less-of-transforming-target-variables-part-2-EC 8546 c 33 AC 6</p></div></div>    
</body>
</html>