<html>
<head>
<title>Dev 101: text versus bytes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dev 101:文本与字节</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/dev-101-text-versus-bytes-70548216409b?source=collection_archive---------12-----------------------#2021-03-06">https://medium.com/analytics-vidhya/dev-101-text-versus-bytes-70548216409b?source=collection_archive---------12-----------------------#2021-03-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="751e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在<em class="jk"> Dev 101 </em>系列中，我为广大读者讲述了一些计算机编程的基本概念。我想这是我自己在寻找的解释，当我刚开始做程序员的时候…</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es jl"><img src="../Images/408ec69111b712c4eb3d3f9e3bd83ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*iHISfT_t3GUTJEE6WFkn2g.jpeg"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">照片由<a class="ae jx" href="https://unsplash.com/@hope_house_press_leather_diary_studio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">希望之家出版社——皮革日记工作室</a>在<a class="ae jx" href="https://unsplash.com/s/photos/binary?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="2bdc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jk">TL；DR:没有所谓的</em>文本<em class="jk">，只有基于</em>编码<em class="jk">可以显示为</em>字符<em class="jk">的</em>字节<em class="jk">集合。</em></p><h1 id="996b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1和0</h1><p id="4ab2" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">电脑是一种电子设备，真的只“懂”开和关。想想当你扳动开关时，灯是如何开关的。在某种程度上，计算机基本上是一个巨大的电灯开关的集合。</p><p id="a6f0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这就是为什么计算机的处理器只能对<code class="du lb lc ld le b">0</code>和<code class="du lb lc ld le b">1</code>，或者<strong class="io hj">位</strong>进行运算，这些位可以组合起来表示二进制数，例如<code class="du lb lc ld le b">100</code> = <code class="du lb lc ld le b">4</code>。正是这些二进制数被处理器用作数据和指令(也称为“机器代码”)。</p><p id="f7e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">将比特分组为单元是有意义的；否则，我们只会得到一长串的1和0，没有办法把它分割成有意义的部分。一组八个二进制数字被称为一个<strong class="io hj">字节</strong>，但是历史上该字节的大小并没有严格的定义。不过，一般来说，现代计算机体系结构使用8位字节。</p><h1 id="4aa9" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">字节</h1><p id="9a33" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">计算机的这种二进制性质意味着，从根本上来说，所有数据都只是字节的集合。以文件为例。本质上，文本文件、图像或可执行文件之间没有区别。因此，当人们谈论“二进制”文件时，实际上有点令人困惑，即，相对于人类可读的“文本”，人类不可读。</p><p id="9ef2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们来看一个例子<code class="du lb lc ld le b">myfile</code>:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="7b06" class="lj jz hi le b fi lk ll l lm ln">$ xxd -b myfile<br/>00000000: 01101000 01100101 01101100 01101100 01101111 00100000  <br/>00000006: 01110111 01101111 01110010 01101100 01100100 00001010</span></pre><p id="a6ed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">指令<code class="du lb lc ld le b">xxd -b</code>要求<code class="du lb lc ld le b">myfile</code>的二进制“转储”。我们看到它包含12个8位字节。因为二进制表示在视觉上很难，所以字节通常显示为十六进制数:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="2fd0" class="lj jz hi le b fi lk ll l lm ln">$ xxd -g 1 myfile <br/>00000000: 68 65 6c 6c 6f 20 77 6f 72 6c 64 0a</span></pre><p id="4a13" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">或者(不经常)用十进制数表示:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="0e6c" class="lj jz hi le b fi lk ll l lm ln">$ od -t d1 myfile <br/>0000000  104  101  108  108  111   32  119  111  114  108  100   10</span></pre><p id="df45" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在小数中，8位字节高达256，这在2⁸ = 256时是有意义的，即8个位置可以保存0或1，这等于256种组合。</p><p id="6f4d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是我们怎么知道这些字节代表什么呢？</p><h1 id="2915" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">编码</h1><p id="65ef" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">为了以有意义的方式解释字节，例如将它们显示为文本或图像，我们需要给计算机附加信息。这有几种方法，其中一种是用可识别的字节序列预先确定文件结构。</p><p id="76b5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">另一个是指定一个<strong class="io hj">编码</strong>，你可以把它想象成一个查找表，把意义和它对应的数字表示联系起来。说到文本，我们称之为“字符编码”。把字符变成代码称为“编码”，把代码解释为字符称为“解码”。</p><p id="74e6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">最早的字符编码标准之一是<a class="ae jx" href="https://en.wikipedia.org/wiki/ASCII" rel="noopener ugc nofollow" target="_blank"> ASCII </a>，规定字符<code class="du lb lc ld le b">a</code>用字节<code class="du lb lc ld le b">61</code>(十六进制)或<code class="du lb lc ld le b">97</code>(十进制)或<code class="du lb lc ld le b">01100001</code>(二进制)表示。然而，由于8位字节只给你256种可能性，今天使用多字节编码。过去，世界上不同的地区使用不同的编码，这是软件的巴别塔，导致了一堆沟通问题，直到今天。幸运的是，今天<a class="ae jx" href="https://en.wikipedia.org/wiki/UTF-8" rel="noopener ugc nofollow" target="_blank"> UTF-8 </a>或多或少是国际标准——例如，占所有网页的97%。UTF-8能够使用一到四个单字节单元对<a class="ae jx" href="https://en.wikipedia.org/wiki/Unicode" rel="noopener ugc nofollow" target="_blank"> Unicode </a>中的所有1112064个有效字符<a class="ae jx" href="https://en.wikipedia.org/wiki/Code_point" rel="noopener ugc nofollow" target="_blank">码点</a>进行编码。</p><h1 id="fd60" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">作为文本的字节</h1><p id="6efe" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">回到我们的文件，我们现在可以要求计算机将这些字节解释为文本。重要的是要认识到，任何时候我们将字节显示为文本，无论是在终端、文字处理器、编辑器还是浏览器中，我们都需要字符编码。通常，我们不知道所使用的编码，但总是可以做出选择，无论是通过默认设置还是通过一些试图识别编码的智能软件。</p><p id="62e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例如，终端有一个默认的字符设置——我的设置是UTF-8。所以当我们要求打印<code class="du lb lc ld le b">myfile</code>时，我们看到了这个:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="7bd1" class="lj jz hi le b fi lk ll l lm ln">$ cat myfile <br/>hello world</span></pre><p id="ba02" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这意味着我们之前讨论的字节是字符串<code class="du lb lc ld le b">hello world</code>的UTF-8表示。对于本例，其他字符编码，如ASCII或ISO-Latin-1，也会产生相同的结果。但是当看另一个例子时，这种差别很快就变得清晰了。</p><p id="c13e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们将UTF-8编码的文本字符串<code class="du lb lc ld le b">El Niño</code>保存为一个文件，然后打印它。我们可以在终端中这样做——记住，它默认设置为UTF-8显示:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="b737" class="lj jz hi le b fi lk ll l lm ln">$ echo "El Niño" &gt; myfile<br/>$ cat myfile<br/>El Niño</span></pre><p id="c066" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们将终端的编码改为<a class="ae jx" href="https://en.wikipedia.org/wiki/Windows-1252" rel="noopener ugc nofollow" target="_blank"> CP-1252 </a>，看看当我们打印相同的文件时会发生什么:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="7c72" class="lj jz hi le b fi lk ll l lm ln">$ cat myfile<br/>El NiÃ±o</span></pre><p id="cf30" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们称这个<a class="ae jx" href="https://en.wikipedia.org/wiki/Mojibake" rel="noopener ugc nofollow" target="_blank">moji bake</a>；我相信你经常在通用替换的形式下看到的乱码。但是你明白为什么会这样吗？因为<code class="du lb lc ld le b">myfile</code>包含作为UTF-8编码文本输入的字节，以另一种编码显示相同的字节不会给出我们期望的结果。</p><p id="9e9c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这也解释了为什么像<code class="du lb lc ld le b">cat</code>这样的命令对所谓的二进制文件不起作用，或者在编辑器中打开它们只会显示出乱码:它们没有被编码成文本。</p><h1 id="4de4" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">以字节表示的文本</h1><p id="a37f" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated"><code class="du lb lc ld le b">El Niño</code>的例子表明，我们也可以获取文本——在终端中输入的字符串——并将其用作字节。例如，当我们将编辑器中的文本保存在文件中时。起初，这可能是一个让你难以理解的概念。字节可以是字符串，字符串就是字节。重要的是要记住，无论何时处理文本或字符，都有一种(显式或隐式)编码在起作用。</p><p id="3a99" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当你想到这一点时，代码也是文本，所以一些编程语言也做出某些编码假设。其他的只是将文本作为字节处理，并将编码留给其他应用程序(如浏览器或终端)。</p><p id="dd50" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例如，Golang本身就是UTF 8，这意味着您可以这样做:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="043e" class="lj jz hi le b fi lk ll l lm ln">package main</span><span id="18e0" class="lj jz hi le b fi lo ll l lm ln">import "fmt"</span><span id="c708" class="lj jz hi le b fi lo ll l lm ln">func main() {<br/> fmt.Println("Hello, 世界")<br/>}</span></pre><p id="c746" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Python 3也是UTF 8，但是Python 2以前是ASCII。因此，不管您的代码编辑器是否能够显示这样的字符串，如果您试图在Python 2上使用<code class="du lb lc ld le b">print</code>函数，Python 2都会报错。记住，print告诉设备显示字节。所以如果你把这个放在一个文件里<code class="du lb lc ld le b">test.py</code></p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="be3f" class="lj jz hi le b fi lk ll l lm ln">print "Hello, 世界"</span></pre><p id="a55b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">并用Python 2执行它，它将抛出下面的错误。</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="deee" class="lj jz hi le b fi lk ll l lm ln">py2 test.py <br/>File “test.py”, line 1<br/>SyntaxError: Non-ASCII character ‘\xe4’ in file test.py on line 1, but no encoding declared; see <a class="ae jx" href="http://python.org/dev/peps/pep-0263/" rel="noopener ugc nofollow" target="_blank">http://python.org/dev/peps/pep-0263/</a> for details</span></pre><p id="e4f1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">底线是，在处理文本时应该始终小心，当有疑问时使用显式编码或解码机制。</p><h1 id="cbb8" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">处理多字节字符</h1><p id="cfa1" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">关于字符编码还有很多要说的，但我将用一个关于多字节字符的观察来总结，这可能会促使您更深入地研究这个主题。</p><p id="fcf1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">代码面试中一个很流行的问题是让应聘者写(伪)代码来反转一个字符串。例如，在Python中，有一个很好的oneliner，它从头到尾(<code class="du lb lc ld le b">::</code>)使用一个切片，然后后退(<code class="du lb lc ld le b">-1</code>):</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="2181" class="lj jz hi le b fi lk ll l lm ln">&gt;&gt;&gt; print("Hello World"[::-1])<br/>dlroW olleH</span></pre><p id="7ac8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi">Yet think about what happens under the hood. Apparently, there is a mechanism that iterates over the bytes that make up the string and reverses their order. But what happens when a character is represented by more than one byte? For instance, 界 , is four bytes in UTF-8 (<code class="du lb lc ld le b">e7 95 8c 0a</code> in hex). The first of these is a <em class="jk">leader</em> byte, a byte reserved to start a specific multibyte sequence, the other three are <em class="jk">continuation</em> bytes, which are only valid when preceded by a leader. So when you reverse these bytes, you end up with a different byte sequence, which is actually invalid UTF-8!</p><p id="b94f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">幸运的是，Python(记住，它本来就是UTF 8)能够处理这个问题:</p><pre class="jm jn jo jp fd lf le lg lh aw li bi"><span id="e86c" class="lj jz hi le b fi lk ll l lm ln">&gt;&gt;&gt; print("Hello, 世界"[::-1])<br/>界世 ,olleH</span></pre><p id="8ba7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是，在其他编程语言中，您必须编写一个函数来识别字符串中的字节单元，然后颠倒它们的顺序，而不是字节本身。这意味着知道字符串的编码…</p><h1 id="8355" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="ee99" class="pw-post-body-paragraph im in hi io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj hb bi translated">文本与字节的对比是一个复杂的问题，即使是高级程序员也很难解决，或者在他们的大部分职业生涯中都试图避免。然而，它令人着迷地提醒我们计算的本质，并且理解它，或者至少是基本原理，对于任何软件开发人员来说都是不可或缺的。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="297e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你正在寻找另一个阅读这方面资料的来源，你可以从<a class="ae jx" href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/" rel="noopener ugc nofollow" target="_blank">开始，这是每个软件开发人员绝对、肯定必须知道的关于Unicode和字符集的绝对最低要求(没有借口！由</a><a class="ae jx" href="https://www.joelonsoftware.com/about-me/" rel="noopener ugc nofollow" target="_blank">乔尔·斯波尔斯基</a>创作。</p></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="e4e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jk">嗨！</em>👋我是汤姆。我是一名软件工程师、技术作家和IT倦怠教练。如果想取得联系，可以查看<a class="ae jx" href="https://tomdeneire.github.io/" rel="noopener ugc nofollow" target="_blank"><em class="jk">https://tomdeneire . github . io</em></a></p></div></div>    
</body>
</html>