<html>
<head>
<title>MediaPipe Object Detection &amp; Box Tracking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">媒体管道对象检测和盒子跟踪</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mediapipe-object-detection-and-box-tracking-82926abc50c2?source=collection_archive---------3-----------------------#2021-04-12">https://medium.com/analytics-vidhya/mediapipe-object-detection-and-box-tracking-82926abc50c2?source=collection_archive---------3-----------------------#2021-04-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="c4bf" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">Android中的MediaPipe对象检测和盒子跟踪入门</p></blockquote><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/0a81f961e6012b8d50e14fb1c2dd2ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HE6kBD-sYU5qIkcNixTC4w.png"/></div></div></figure><p id="1811" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">在从事几个个人项目后，我意识到大规模部署机器学习(ML)模型是愿意通过人工智能创造价值的学生开发人员面临的最重要挑战之一，随着模型变得越来越复杂，这只会变得越来越困难。根据最近的一项研究，ML项目中只有很小一部分能够进入生产阶段，而其余的可能只能在Jupyter笔记本xD上完成。媒体管道框架的作用来了…</p><p id="0f06" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">“MediaPipe是构建管道<strong class="ik hi"/><strong class="ik hi"/>对任意感官<strong class="ik hi"> </strong>数据<strong class="ik hi"> </strong>如<em class="ij"> </em>图像、音频流和视频流<em class="ij">进行推理的框架。”</em> MediaPipe提供跨平台的统一解决方案，可在Android、iOS、桌面/云、web和物联网等设备上运行。</p><p id="795b" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">使用MediaPipe，感知管道可以构建为模块化组件的图形，包括模型推理、媒体处理算法和数据转换。MediaPipe是谷歌自2012年以来在内部用于其产品的东西，并于2019年6月在CVPR开源。要了解更多关于MediaPipe框架的概念，您可以访问这里的<a class="ae jv" href="https://google.github.io/mediapipe/framework_concepts/framework_concepts.html" rel="noopener ugc nofollow" target="_blank"><strong class="ik hi"><em class="ij"/></strong></a><strong class="ik hi"><em class="ij">。</em> </strong></p><h2 id="d05f" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated"><strong class="ak"> <em class="kr">我们今天要学什么？</em>T25】</strong></h2><p id="78ed" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">我们将实现由MediaPipe提供的对象检测和跟踪Android解决方案。我已经在<strong class="ik hi"> Ubuntu 18.04 </strong>中完成了这个实现，如果你正在使用任何其他操作系统，请按照这个<a class="ae jv" href="https://google.github.io/mediapipe/getting_started/install.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">链接</em> </strong> </a>中相应的安装方法。</p><h2 id="6be2" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤1 —安装Bazel</h2><p id="18be" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">为了构建这个应用程序，我们将使用Mediapipe和bazel。为了在Ubuntu中安装bazel，我们将使用以下命令。</p><h2 id="e1ab" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">a)添加Bazel分发URL作为包源</h2><p id="9b7e" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated"><strong class="ik hi">注:</strong>这是一次性设置步骤。</p><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="bc7c" class="jw jx hh ky b fi lc ld l le lf">sudo apt install apt-transport-https curl gnupg<br/>curl -fsSL https://bazel.build/bazel-release.pub.gpg | gpg --dearmor &gt; bazel.gpg<br/>sudo mv bazel.gpg /etc/apt/trusted.gpg.d/<br/>echo "deb [arch=amd64] https://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list</span></pre><h2 id="7e2d" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">b)安装和更新Bazel</h2><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="a787" class="jw jx hh ky b fi lc ld l le lf">sudo apt update &amp;&amp; sudo apt install bazel</span></pre><h2 id="a71a" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤2-签出MediaPipe存储库</h2><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="387e" class="jw jx hh ky b fi lc ld l le lf">$ cd $HOME<br/>$ git clone https://github.com/google/mediapipe.git<br/><br/># Change directory into MediaPipe root directory<br/>$ cd mediapipe</span></pre><h2 id="1883" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤3-安装OpenCV和FFmpeg</h2><p id="ddfa" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">使用包管理器工具安装预编译的OpenCV库。FFmpeg将通过libopencv-video-dev安装。</p><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="13f9" class="jw jx hh ky b fi lc ld l le lf">$ sudo apt-get install libopencv-core-dev libopencv-highgui-dev \<br/>                       libopencv-calib3d-dev libopencv-features2d-dev \<br/>                       libopencv-imgproc-dev libopencv-video-dev</span></pre><h2 id="73c8" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤4-用C++运行Hello World示例</h2><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="e3c7" class="jw jx hh ky b fi lc ld l le lf">$ export GLOG_logtostderr=1<br/><br/># if you are running on Linux desktop with CPU only</span><span id="3ca2" class="jw jx hh ky b fi lg ld l le lf">$ bazel run --define MEDIAPIPE_DISABLE_GPU=1 \<br/>    mediapipe/examples/desktop/hello_world:hello_world<br/><br/># If you are running on Linux desktop with GPU support enabled (via mesa drivers)</span><span id="e791" class="jw jx hh ky b fi lg ld l le lf">$ bazel run --copt -DMESA_EGL_NO_X11_HEADERS --copt -DEGL_NO_X11 \<br/>    mediapipe/examples/desktop/hello_world:hello_world</span><span id="c255" class="jw jx hh ky b fi lg ld l le lf"># It should print:-<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!<br/># Hello World!</span></pre><p id="1ca4" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">如果您在获取上述Hello World输出时遇到任何问题，请访问此链接查看<a class="ae jv" href="https://google.github.io/mediapipe/getting_started/troubleshooting.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">故障排除。</em> </strong> </a></p><p id="b3a5" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">现在我们已经完成了MediaPipe的常规安装，接下来的步骤是安装Android studio及其工具。</p><h2 id="4524" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤5-安装Java</h2><p id="708f" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">在android studio中开发应用程序需要Java开发套件，您可以参考此<strong class="ik hi"> <em class="ij"> </em> </strong> <a class="ae jv" href="https://www.youtube.com/watch?v=PpDSz9zJVYI" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">链接</em> </strong> </a>在您的Ubuntu OS中安装Java。</p><h2 id="42f8" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤6-安装Android Studio</h2><p id="290c" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">在Ubuntu OS中安装android studio可以参考这个<a class="ae jv" href="https://www.youtube.com/watch?v=x3nVHXv3oyw" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">链接</em> </strong> </a></p><h2 id="df00" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated"><strong class="ak">步骤7-安装必要的软件包(SDK和NDK) </strong></h2><p id="4485" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">MediaPipe建议必须通过Android Studio设置Android SDK和NDK。在Android Studio中</p><ol class=""><li id="633d" class="lh li hh ik b il im ip iq js lj jt lk ju ll jf lm ln lo lp bi translated">点击<strong class="ik hi">工具</strong> &gt; <strong class="ik hi"> SDK </strong>管理器</li><li id="c896" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">在<strong class="ik hi"> SDK </strong>平台选项卡中，选择<strong class="ik hi"> Android </strong> API级别28或29，然后点击安装。</li><li id="9d20" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">在<strong class="ik hi"> SDK工具</strong>选项卡中，选择<strong class="ik hi"> Android SDK </strong> Build- <strong class="ik hi">工具</strong> 28或29</li><li id="b018" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">选择Android SDK <strong class="ik hi">平台-工具</strong> 28或29</li><li id="b40a" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">选择Android SDK工具26.1.1</li><li id="e039" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">选择安卓NDK 17或以上版本</li><li id="cd42" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">安装它们</li></ol><h2 id="ce8f" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤Android SDK和NDK的设置路径</h2><p id="24a1" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated">安装安卓SDK和NDK(由安卓工作室)后，设置$安卓_HOME和$安卓_NDK_HOME，用于指向已安装的SDK和NDK。您将在SDK管理器的最上面的栏中获得这些路径。</p><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="a088" class="jw jx hh ky b fi lc ld l le lf">export ANDROID_HOME= &lt;path to the Android SDK&gt;<br/>export ANDROID_NDK_HOME= &lt;path to the Android NDK&gt;</span></pre><p id="3e69" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">在第8步之前，我们已经设置了从MediaPipe构建Android示例的依赖关系，现在我们可以在下列步骤的帮助下构建任何示例。</p><p id="3348" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">在这篇博客中，我们正在用盒子跟踪机器人的例子来构建物体检测。它使用的是已经训练好的Tflite模型，该模型位于<a class="ae jv" href="https://github.com/google/mediapipe/blob/master/mediapipe/models/ssdlite_object_detection.tflite" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">这里</em> </strong> </a></p><p id="0b02" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">媒体管道盒跟踪可以与ML推理配对，从而产生有价值且高效的管道。例如，框跟踪可以与基于ML的对象检测配对，以创建对象检测和跟踪管道。通过跟踪，该流水线提供了优于每帧运行检测(例如<a class="ae jv" href="https://google.github.io/mediapipe/solutions/object_detection.html" rel="noopener ugc nofollow" target="_blank">媒体管道对象检测</a>)的几个优点:</p><ul class=""><li id="04c5" class="lh li hh ik b il im ip iq js lj jt lk ju ll jf lv ln lo lp bi translated">它提供基于实例的跟踪，即跨帧维护对象ID。</li><li id="ca61" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lv ln lo lp bi translated">检测不必在每一帧都运行。这使得能够运行更精确的更重的检测模型，同时保持管道在移动设备上的轻量级和实时性。</li><li id="d242" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lv ln lo lp bi translated">在跟踪的帮助下，对象定位在时间上是一致的，这意味着跨帧可观察到更少的抖动。</li></ul><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es lw"><img src="../Images/46f6c4d67ac01a3da5248db57cfeaf54.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*6hKHAFhQlHmY4vuUJ2exRw.gif"/></div><figcaption class="lx ly et er es lz ma bd b be z dx translated"><a class="ae jv" href="https://google.github.io/mediapipe/solutions/box_tracking.html" rel="noopener ugc nofollow" target="_blank"> <em class="kr">方框跟踪</em> </a> <em class="kr">配合基于ML的物体检测。</em></figcaption></figure><h2 id="40ff" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated">步骤9-构建Android应用程序</h2><p id="88cc" class="pw-post-body-paragraph ih ii hh ik b il ks in io ip kt ir is js ku iv iw jt kv iz ja ju kw jd je jf ha bi translated"><strong class="ik hi">选项A)在命令行中使用Bazel构建</strong></p><p id="d17d" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">要构建一个Android示例应用程序，需要根据相应的<code class="du mb mc md ky b">android_binary</code>构建目标进行构建。例如，对于媒体管道对象跟踪，目标是<a class="ae jv" href="https://github.com/google/mediapipe/tree/master/mediapipe/examples/android/src/java/com/google/mediapipe/apps/handtrackinggpu/BUILD" rel="noopener ugc nofollow" target="_blank">构建</a>文件中的<code class="du mb mc md ky b">objecttrackinggpu</code>:</p><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="81aa" class="jw jx hh ky b fi lc ld l le lf">#Use this command to build the APK for Object Tracking GPU<br/>bazel build -c opt --config=android_arm64 <a class="ae jv" href="https://github.com/google/mediapipe/tree/master/mediapipe/examples/android/src/java/com/google/mediapipe/apps/objecttrackinggpu/BUILD" rel="noopener ugc nofollow" target="_blank">mediapipe/examples/android/src/java/com/google/mediapipe/apps/objecttrackinggpu:objecttrackinggpu</a></span><span id="8bb8" class="jw jx hh ky b fi lg ld l le lf"># On successfully building the APK, it prints<br/>INFO: Elapsed time: 1499.898s, Critical Path: 753.09s<br/>INFO: 2002 processes: 1849 linux-sandbox, 1 local, 152 worker.<br/>INFO: Build completed successfully, 2140 total actions</span></pre><p id="8244" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">首次构建时，这大约需要20-30分钟，因为它会下载构建的所有外部依赖项。但是下一次它将使用缓存的依赖项，所以它构建得更快。</p><p id="7029" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">现在，我们准备运行APK并测试它。</p><p id="2143" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated"><strong class="ik hi">安装APK </strong></p><p id="89d5" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">在安装APK之前，请确保您的android设备已与系统连接，并且<em class="ij"> USB调试</em>已打开。</p><pre class="jh ji jj jk fd kx ky kz la aw lb bi"><span id="1c48" class="jw jx hh ky b fi lc ld l le lf">adb install bazel bin/<a class="ae jv" href="https://github.com/google/mediapipe/tree/master/mediapipe/examples/android/src/java/com/google/mediapipe/apps/objecttrackinggpu/BUILD" rel="noopener ugc nofollow" target="_blank">mediapipe/examples/android/src/java/com/google/mediapipe/apps/objecttrackinggpu/objecttrackinggpu</a>.apk</span></pre><p id="1b39" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">我在我的<a class="ae jv" href="https://gadgets.ndtv.com/redmi-note-7s-price-in-india-13068" rel="noopener ugc nofollow" target="_blank"> Note 7S </a>手机上测试了这个应用程序，它以0.6-0.8 FPS的速度运行，并用ID跟踪我的笔记本电脑及其键盘。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es me"><img src="../Images/eba1d9d983c8a6a528fb6d2da0107005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwC9m0Lur4oYmvXdVL7teA.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">Android中的对象检测和跟踪应用程序(Note 7s)</figcaption></figure><p id="59f3" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">在这里，我们成功地在Android中构建了对象检测和盒子跟踪的MediaPipe示例。以类似的方式，我们也可以从MediaPipe现有的例子中实现分割和手部跟踪。</p><p id="c7cb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is js iu iv iw jt iy iz ja ju jc jd je jf ha bi translated">在这个MediaPipe博客系列的下一部分中，我们将讨论如何使用我们自己定制的Tflite模型进行MediaPipe对象检测和盒子跟踪。<br/>敬请期待。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mf"><img src="../Images/16816b7a3cdf3692101d1159ab4c19f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*FZFDufUCQaYPPAcyBWmWlQ.gif"/></div></figure><h2 id="3aca" class="jw jx hh bd jy jz ka kb kc kd ke kf kg js kh ki kj jt kk kl km ju kn ko kp kq bi translated"><strong class="ak">参考文献</strong></h2><ol class=""><li id="6840" class="lh li hh ik b il ks ip kt js mg jt mh ju mi jf lm ln lo lp bi translated">MediaPipe Android <a class="ae jv" href="https://google.github.io/mediapipe/getting_started/android.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">文档</em></strong>T5】</a></li><li id="3ea1" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">MediaPipe安装<a class="ae jv" href="https://google.github.io/mediapipe/getting_started/install.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">指南</em> </strong> </a></li><li id="ba59" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">具有自定义Tflite模型的media pipe-<a class="ae jv" href="https://blog.gofynd.com/mediapipe-with-custom-tflite-model-d3ea0427b3c1" rel="noopener ugc nofollow" target="_blank"><strong class="ik hi"><em class="ij">博客</em> </strong> </a></li><li id="3018" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">MediaPipe <a class="ae jv" href="https://google.github.io/mediapipe/solutions/object_detection.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">物体检测</em></strong></a><a class="ae jv" href="https://google.github.io/mediapipe/solutions/box_tracking.html" rel="noopener ugc nofollow" target="_blank"><strong class="ik hi"><em class="ij">盒子跟踪</em> </strong> </a>文档</li><li id="640f" class="lh li hh ik b il lq ip lr js ls jt lt ju lu jf lm ln lo lp bi translated">Google开发者<a class="ae jv" href="https://developers.googleblog.com/2019/12/object-detection-and-tracking-using-mediapipe.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ik hi"> <em class="ij">博客</em></strong></a>——使用MediaPipe进行物体检测和跟踪</li></ol></div></div>    
</body>
</html>