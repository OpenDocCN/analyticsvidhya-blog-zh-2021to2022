<html>
<head>
<title>Find a location for opening a restaurant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">找一个开餐馆的地点</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/find-a-location-for-opening-a-restaurant-fc7790e30d1?source=collection_archive---------8-----------------------#2021-06-26">https://medium.com/analytics-vidhya/find-a-location-for-opening-a-restaurant-fc7790e30d1?source=collection_archive---------8-----------------------#2021-06-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f195" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated">用机器学习的K-mean算法对位置进行聚类。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es jm"><img src="../Images/fcabac86a79cb52aeb9b3aa36f0422be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*y9F6lmIyvypxUTK3_nk-hw.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">由<a class="ae jy" href="https://cdn4.iconfinder.com/data/icons/food-3-7/65/136-512.png" rel="noopener ugc nofollow" target="_blank"> Iconfinder </a>拍摄</figcaption></figure><h2 id="e8f5" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">简介:业务问题</h2><p id="c429" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在这个项目中，我们将试图找到一个餐馆的最佳位置。具体来说，本报告将针对有意在乌兹别克斯坦塔什干<strong class="ih hj"/><strong class="ih hj">开设<strong class="ih hj">土耳其餐厅(</strong>因为我是<strong class="ih hj"> </strong>土耳其料理的超级粉丝)的利益相关方。</strong></p><p id="6af4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于塔什干有许多餐馆，我们将尝试检测尚未挤满餐馆的<strong class="ih hj">位置(尤其是城市的南部)</strong>。我们还对附近没有土耳其餐馆的地区特别感兴趣。假设前两个条件都满足，我们也希望位置<strong class="ih hj">尽可能靠近市中心</strong>。</p><p id="0bad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将利用我们的数据科学力量，根据这一标准生成几个最有前途的社区。每个区域的优势将被清楚地表达出来，以便利益相关者可以选择最佳的最终位置。</p><h2 id="ec3b" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">关于数据</h2><p id="2e18" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">根据我们问题的定义，影响我们决策的因素有:</p><ul class=""><li id="74b8" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">附近现有餐馆的数量(任何类型的餐馆)</li><li id="afa1" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">附近土耳其餐馆的数量和距离(如果有)</li><li id="e1ba" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">社区离市中心的距离</li></ul><p id="8497" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们决定使用以市中心为中心的规则空间网格来定义我们的社区。</p><p id="7803" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提取/生成所需信息需要以下数据源:</p><ul class=""><li id="eea1" class="kz la hi ih b ii ij im in iq lb iu lc iy ld jc le lf lg lh bi translated">候选区域的中心将通过算法生成，这些区域中心的大致地址将使用<strong class="ih hj">谷歌地图API反向地理编码</strong>获得</li><li id="0f05" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">使用<strong class="ih hj"> Foursquare API </strong>将获得每个街区的餐馆数量及其类型和位置</li><li id="8dba" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc le lf lg lh bi translated">塔什干中心的坐标将使用众所周知的塔什干位置的<strong class="ih hj">谷歌地图API地理编码</strong>获得</li></ul><h2 id="cd5b" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">邻居候选人</h2><p id="40e5" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">让我们为候选邻域的质心创建纬度和经度坐标。我们将创建一个覆盖我们感兴趣的区域的网格。以塔什干市中心为中心的12x12公里。</p><p id="c5a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们首先找到塔什干中心的纬度和经度，使用特定的、众所周知的地址和谷歌地图地理编码API:</p><pre class="jn jo jp jq fd ln lo lp lq aw lr bi"><span id="3cd9" class="jz ka hi lo b fi ls lt l lu lv">import requests</span><span id="02dd" class="jz ka hi lo b fi lw lt l lu lv">def get_coordinates(api_key, address, verbose=False):<br/>    try:<br/>        url = '<a class="ae jy" href="https://maps.googleapis.com/maps/api/geocode/json?key={}&amp;address={}'.format(api_key," rel="noopener ugc nofollow" target="_blank">https://maps.googleapis.com/maps/api/geocode/json?key={}&amp;address={}'.format(api_key,</a> address)<br/>        response = requests.get(url).json()<br/>        if verbose:<br/>            print('Google Maps API JSON result =&gt;', response)<br/>        results = response['results']<br/>        geographical_data = results[0]['geometry']['location'] # get geographical coordinates<br/>        lat = geographical_data['lat']<br/>        lon = geographical_data['lng']<br/>        return [lat, lon]<br/>    except:<br/>        return [None, None]<br/>    <br/>address = 'Tashkent, Uzbekistan'<br/>tashkent_center = get_coordinates(google_api_key, address)<br/>print('Coordinate of {}: {}'.format(address, tashkent_center))</span></pre><p id="3088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们创建一个候选区域网格，以市中心为中心，距离塔什干约6公里。我们的邻居将被定义为半径为300米的圆形区域，因此我们的邻居中心将相距600米。</p><p id="78f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了精确计算距离，我们需要在笛卡尔2D坐标系中创建我们的位置网格，这允许我们以米(而不是纬度/经度)来计算距离。然后，我们将这些坐标投射回经纬度，以显示在follow地图上。因此，让我们创建在WGS84球面坐标系(纬度/经度)和UTM笛卡尔坐标系(以米为单位的X/Y坐标)之间进行转换的函数。</p><pre class="jn jo jp jq fd ln lo lp lq aw lr bi"><span id="e1ad" class="jz ka hi lo b fi ls lt l lu lv">!pip install shapely<br/>import shapely.geometry</span><span id="93e4" class="jz ka hi lo b fi lw lt l lu lv">!pip install pyproj<br/>import pyproj</span><span id="fc35" class="jz ka hi lo b fi lw lt l lu lv">import math</span><span id="3cdc" class="jz ka hi lo b fi lw lt l lu lv">def lonlat_to_xy(lon, lat):<br/>    proj_latlon = pyproj.Proj(proj='latlong',datum='WGS84')<br/>    proj_xy = pyproj.Proj(proj="utm", zone=33, datum='WGS84')<br/>    xy = pyproj.transform(proj_latlon, proj_xy, lon, lat)<br/>    return xy[0], xy[1]</span><span id="ab70" class="jz ka hi lo b fi lw lt l lu lv">def xy_to_lonlat(x, y):<br/>    proj_latlon = pyproj.Proj(proj='latlong',datum='WGS84')<br/>    proj_xy = pyproj.Proj(proj="utm", zone=33, datum='WGS84')<br/>    lonlat = pyproj.transform(proj_xy, proj_latlon, x, y)<br/>    return lonlat[0], lonlat[1]</span><span id="fbce" class="jz ka hi lo b fi lw lt l lu lv">def calc_xy_distance(x1, y1, x2, y2):<br/>    dx = x2 - x1<br/>    dy = y2 - y1<br/>    return math.sqrt(dx*dx + dy*dy)</span><span id="af32" class="jz ka hi lo b fi lw lt l lu lv">print('Coordinate transformation check')<br/>print('-------------------------------')<br/>print('Tashkent center longitude={}, latitude={}'.format(tashkent_center[1], tashkent_center[0]))<br/>x, y = lonlat_to_xy(tashkent_center[1], tashkent_center[0])<br/>print('Tashkent center UTM X={}, Y={}'.format(x, y))<br/>lo, la = xy_to_lonlat(x, y)<br/>print('Tashkent center longitude={}, latitude={}'.format(lo, la))</span></pre><p id="81dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个单元格的<strong class="ih hj">六边形网格:我们每隔一行偏移，并调整垂直行间距，以便<strong class="ih hj">每个单元格中心到所有邻居</strong>的距离相等。</strong></p><pre class="jn jo jp jq fd ln lo lp lq aw lr bi"><span id="3567" class="jz ka hi lo b fi ls lt l lu lv">tashkent_center_x, tashkent_center_y = lonlat_to_xy(tashkent_center[1], tashkent_center[0]) # City center in Cartesian coordinates</span><span id="1971" class="jz ka hi lo b fi lw lt l lu lv">k = math.sqrt(3) / 2 # Vertical offset for hexagonal grid cells<br/>x_min = tashkent_center_x - 6000<br/>x_step = 600<br/>y_min = tashkent_center_y - 6000 - (int(21/k)*k*600 - 12000)/2<br/>y_step = 600 * k</span><span id="60f5" class="jz ka hi lo b fi lw lt l lu lv">latitudes = []<br/>longitudes = []<br/>distances_from_center = []<br/>xs = []<br/>ys = []<br/>for i in range(0, int(21/k)):<br/>    y = y_min + i * y_step<br/>    x_offset = 300 if i%2==0 else 0<br/>    for j in range(0, 21):<br/>        x = x_min + j * x_step + x_offset<br/>        distance_from_center = calc_xy_distance(tashkent_center_x, tashkent_center_y, x, y)<br/>        if (distance_from_center &lt;= 6001):<br/>            lon, lat = xy_to_lonlat(x, y)<br/>            latitudes.append(lat)<br/>            longitudes.append(lon)<br/>            distances_from_center.append(distance_from_center)<br/>            xs.append(x)<br/>            ys.append(y)</span><span id="efbc" class="jz ka hi lo b fi lw lt l lu lv">print(len(latitudes), 'candidate neighborhood centers generated.')</span></pre><p id="f8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将目前的数据可视化:市中心位置和候选社区中心:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/e642171c48ee019b6363c71db68d201a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gqzxek3-XoGIAP2x4SVm4Q.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">好了，我们现在有了待评估的邻域/区域中心的坐标，这些坐标等距分布(每个点到其相邻点的距离完全相同),距离塔什干中心约6公里。</figcaption></figure><p id="3868" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们使用Google Maps API来获取这些位置的大概地址:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/cfa34f1c920b68648aec5d6962e6d037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2qikDXrRetil-8Vy2iAfA.png"/></div></div></figure><p id="8ac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们把所有这些放到一个熊猫数据框架中:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mc"><img src="../Images/bbefc5a07204e030a1284a3270101011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WzI81aZUy0WYZSwQEZuDbw.png"/></div></div></figure><h2 id="d268" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">坚定的</h2><p id="bd2e" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">现在我们有了候选位置，让我们使用Foursquare API来获取每个街区的餐馆信息。</p><p id="e6ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们对“食物”类的场所感兴趣，但只对那些真正的餐馆感兴趣——咖啡店、比萨饼店、面包店等。不是直接竞争对手，所以我们不关心这些。因此，我们将在我们的列表中只包括类别名称中有“餐厅”的场所，我们将确保检测并包括特定“土耳其餐厅”类别的所有子类别，因为我们需要附近土耳其餐厅的信息。</p><pre class="jn jo jp jq fd ln lo lp lq aw lr bi"><span id="3908" class="jz ka hi lo b fi ls lt l lu lv"># Category IDs corresponding to Turkish restaurants were taken from Foursquare web site (<a class="ae jy" href="https://developer.foursquare.com/docs/resources/categories" rel="noopener ugc nofollow" target="_blank">https://developer.foursquare.com/docs/resources/categories</a>):</span><span id="b940" class="jz ka hi lo b fi lw lt l lu lv">food_category = '4d4b7105d754a06374d81259' # 'Root' category for all food-related venues</span><span id="c683" class="jz ka hi lo b fi lw lt l lu lv">turkish_restaurant_categories = ['4f04af1f2fb6e1c99f3db0bb','530faca9bcbc57f1066bc2f3','530faca9bcbc57f1066bc2f4',<br/>                                 '5283c7b4e4b094cb91ec88d8','5283c7b4e4b094cb91ec88d9','5283c7b4e4b094cb91ec88db',<br/>                                 '5283c7b4e4b094cb91ec88d6','56aa371be4b08b9a8d573535','56aa371be4b08b9a8d5734bd',<br/>                                 '5283c7b4e4b094cb91ec88d5','5283c7b4e4b094cb91ec88da','530faca9bcbc57f1066bc2f2',<br/>                                 '58daa1558bbb0b01f18ec1df','58daa1558bbb0b01f18ec1dc','56aa371be4b08b9a8d5734bf',<br/>                                 '56aa371be4b08b9a8d5734c1','5283c7b4e4b094cb91ec88d4','58daa1558bbb0b01f18ec1e2']</span><span id="45c6" class="jz ka hi lo b fi lw lt l lu lv">def is_restaurant(categories, specific_filter=None):<br/>    restaurant_words = ['restaurant', 'diner', 'doner', 'steakhouse']<br/>    restaurant = False<br/>    specific = False<br/>    for c in categories:<br/>        category_name = c[0].lower()<br/>        category_id = c[1]<br/>        for r in restaurant_words:<br/>            if r in category_name:<br/>                restaurant = True<br/>        if 'fast food' in category_name:<br/>            restaurant = False<br/>        if not(specific_filter is None) and (category_id in specific_filter):<br/>            specific = True<br/>            restaurant = True<br/>    return restaurant, specific</span><span id="0ed4" class="jz ka hi lo b fi lw lt l lu lv">def get_categories(categories):<br/>    return [(cat['name'], cat['id']) for cat in categories]</span><span id="8345" class="jz ka hi lo b fi lw lt l lu lv">def format_address(location):<br/>    address = ', '.join(location['formattedAddress'])<br/>    address = address.replace(', Uzbekistan', '')<br/>    address = address.replace(', Uzbekistan', '')<br/>    return address</span><span id="70be" class="jz ka hi lo b fi lw lt l lu lv">def get_venues_near_location(lat, lon, category, client_id, client_secret, radius=500, limit=100):<br/>    version = '20180605'<br/>    url = '<a class="ae jy" href="https://api.foursquare.com/v2/venues/explore?client_id={}&amp;client_secret={}&amp;v={}&amp;ll={},{}&amp;categoryId={}&amp;radius={}&amp;limit={}'.format(" rel="noopener ugc nofollow" target="_blank">https://api.foursquare.com/v2/venues/explore?client_id={}&amp;client_secret={}&amp;v={}&amp;ll={},{}&amp;categoryId={}&amp;radius={}&amp;limit={}'.format(</a><br/>        client_id, client_secret, version, lat, lon, category, radius, limit)<br/>    try:<br/>        results = requests.get(url).json()['response']['groups'][0]['items']<br/>        venues = [(item['venue']['id'],<br/>                   item['venue']['name'],<br/>                   get_categories(item['venue']['categories']),<br/>                   (item['venue']['location']['lat'], item['venue']['location']['lng']),<br/>                   format_address(item['venue']['location']),<br/>                   item['venue']['location']['distance']) for item in results]        <br/>    except:<br/>        venues = []<br/>    return venues</span><span id="1ed5" class="jz ka hi lo b fi lw lt l lu lv"># Let's now go over our neighborhood locations and get nearby restaurants; we'll also maintain a dictionary of all found restaurants and all found turkish restaurants</span><span id="b209" class="jz ka hi lo b fi lw lt l lu lv">import pickle</span><span id="39b5" class="jz ka hi lo b fi lw lt l lu lv">def get_restaurants(lats, lons):<br/>    restaurants = {}<br/>    turkish_restaurants = {}<br/>    location_restaurants = []</span><span id="6852" class="jz ka hi lo b fi lw lt l lu lv">print('Obtaining venues around candidate locations:', end='')<br/>    for lat, lon in zip(lats, lons):<br/>        # Using radius=350 to meke sure we have overlaps/full coverage so we don't miss any restaurant (we're using dictionaries to remove any duplicates resulting from area overlaps)<br/>        venues = get_venues_near_location(lat, lon, food_category, client_id, client_secret, radius=350, limit=100)<br/>        area_restaurants = []<br/>        for venue in venues:<br/>            venue_id = venue[0]<br/>            venue_name = venue[1]<br/>            venue_categories = venue[2]<br/>            venue_latlon = venue[3]<br/>            venue_address = venue[4]<br/>            venue_distance = venue[5]<br/>            is_res, is_turkish = is_restaurant(venue_categories, specific_filter=turkish_restaurant_categories)<br/>            if is_res:<br/>                x, y = lonlat_to_xy(venue_latlon[1], venue_latlon[0])<br/>                restaurant = (venue_id, venue_name, venue_latlon[0], venue_latlon[1], venue_address, venue_distance, is_turkish, x, y)<br/>                if venue_distance&lt;=300:<br/>                    area_restaurants.append(restaurant)<br/>                restaurants[venue_id] = restaurant<br/>                if is_turkish:<br/>                    turkish_restaurants[venue_id] = restaurant<br/>        location_restaurants.append(area_restaurants)<br/>        print(' .', end='')<br/>    print(' done.')<br/>    return restaurants, turkish_restaurants, location_restaurants</span></pre><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es md"><img src="../Images/dca2a20cea8f5faf9961182a6fd38de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ZeXcaR1A17KJC4SQgQ2Tw.png"/></div></div></figure><p id="5621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们在地图上查看我们感兴趣区域内收集的所有餐馆，并以不同颜色显示土耳其餐馆:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/dffaa036bcb1e658c138c841e6c5d7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T62cOC4K8UcFWARgBLFG4w.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">土耳其餐馆标为红色，其他餐馆标为蓝色</figcaption></figure><p id="e602" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来不错。所以现在我们有了塔什干中心几公里范围内的所有餐馆，我们知道哪些是土耳其餐馆！我们还知道哪些餐馆正好在每个邻近候选中心的附近。</p><p id="ea39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据收集阶段到此结束——我们现在准备使用这些数据进行分析，以生成关于新土耳其餐厅最佳位置的报告！</p><h2 id="219c" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">方法学</h2><p id="984e" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在这个项目中，我们将致力于检测塔什干的餐馆密度低的区域，特别是那些土耳其餐馆数量少的区域。我们将分析限制在市中心周围约6公里的区域。</p><p id="af8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一步中，我们已经收集了所需的<strong class="ih hj">数据:距离塔什干市中心</strong>6公里以内的每家餐厅的位置和类型(类别)。我们还<strong class="ih hj">确定了土耳其餐馆</strong>(根据Foursquare的分类)。</p><p id="0690" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们分析的第二步将是计算和探索塔什干不同区域的'<strong class="ih hj">餐厅密度</strong>——我们将使用<strong class="ih hj">热图</strong>来确定一些靠近市中心的有希望的区域，这些区域一般餐厅数量较少(<em class="mf">和</em>附近没有土耳其餐厅)，并将我们的注意力集中在这些区域。</p><p id="93a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第三步也是最后一步，我们将关注最有前景的区域，并在这些区域内创建符合与利益相关方讨论确定的一些基本要求的<strong class="ih hj">地点群:我们将考虑半径为250米</strong>的<strong class="ih hj">不超过两家餐馆的地点，我们希望半径为400米</strong>的地点<strong class="ih hj">没有土耳其餐馆。我们将展示所有此类位置的地图，但也会创建这些位置的聚类(使用<strong class="ih hj"> k-means聚类</strong>)以确定一般区域/街区/地址，这些区域/街区/地址应该是利益相关方最终“街道级别”探索和搜索最佳场馆位置的起点。</strong></p><h2 id="de7e" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">分析</h2><p id="1926" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">让我们执行一些基本的解释性数据分析，并从原始数据中获得一些额外的信息。首先让我们来数一数每个候选区域的<strong class="ih hj">餐馆数量</strong>:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mg"><img src="../Images/11e0ab6ab5dfc1760e77f95689b704e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98RNok6wyRespZvFo9LznA.png"/></div></div></figure><p id="a9f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的，现在计算从每个候选区域中心到最近的土耳其餐馆的<strong class="ih hj">距离</strong>(不仅仅是300米内的那些，我们想要到最近的一个的距离，不管它有多远)。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mg"><img src="../Images/c0587d9c0edb4d3224f440c542cb0f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BN-2XmtrrDn1EtE6c7GLw.png"/></div></div></figure><p id="3ea9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以平均来说，每个候选区域中心2公里内都可以找到土耳其餐馆。这相当接近，所以我们需要仔细过滤我们的区域！</p><p id="0609" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个显示<strong class="ih hj">热图/餐馆密度</strong>的地图，并尝试从中提取一些有意义的信息:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/d8cd02882228bab9727f4c48a2de88fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ajZPp5yyUSFGDK0GAG5thQ.png"/></div></div></figure><p id="21b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建另一个热图，仅显示<strong class="ih hj">土耳其餐馆的热图/密度</strong>。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/c7e0fe7db38df7289fd142e4402ca477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7u68P6HbTDiCQCJA-luAJg.png"/></div></div></figure><p id="d3d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这张地图不是很“热门”(土耳其餐馆代表塔什干所有餐馆的约4%的子集)，但它也显示了塔什干市中心以西和东南的现有土耳其餐馆的一些密度，最近的<strong class="ih hj">低土耳其餐馆密度口袋位于市中心的东南和以南</strong>。</p><p id="3a59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于此，我们现在将分析重点放在塔什干中心以南、东南和以西的区域<em class="mf">—我们将移动感兴趣区域的中心，并将其缩小到半径为<strong class="ih hj">2.5公里</strong>。这使得我们的选址主要集中在市中心东南面餐厅密度较低的行政区，但是利益相关者对这个行政区不太感兴趣，因为它主要是住宅区，不太受游客欢迎。</em></p><p id="26bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义新的、更窄的感兴趣区域，该区域将包括离塔什干中心最近的餐馆数量较少的部分:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/e5ad7f191801e0954ae1a8c41a725501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BcDS8kqfa_Rnd5odQ14m3Q.png"/></div></div></figure><p id="8611" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还要创建新的、更密集的位置候选网格，将其限制在我们新的感兴趣区域内(让我们将候选位置相隔100米)。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mh"><img src="../Images/079f72bb6e1e3d3f009877c8898b25d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lx5xYWnRtusQulMwMII3PQ.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">生成了2261个候选邻域中心</figcaption></figure><p id="f013" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的。现在让我们为每个候选位置计算两个最重要的事情:<strong class="ih hj">附近的餐馆数量</strong>(我们将使用<strong class="ih hj"> 250米</strong>的半径)和<strong class="ih hj">到最近的土耳其餐馆的距离:</strong></p><pre class="jn jo jp jq fd ln lo lp lq aw lr bi"><span id="4a3d" class="jz ka hi lo b fi ls lt l lu lv">def count_restaurants_nearby(x, y, restaurants, radius=250):    <br/>    count = 0<br/>    for res in restaurants.values():<br/>        res_x = res[7]; res_y = res[8]<br/>        d = calc_xy_distance(x, y, res_x, res_y)<br/>        if d&lt;=radius:<br/>            count += 1<br/>    return count</span><span id="e3cd" class="jz ka hi lo b fi lw lt l lu lv">def find_nearest_restaurant(x, y, restaurants):<br/>    d_min = 100000<br/>    for res in restaurants.values():<br/>        res_x = res[7]; res_y = res[8]<br/>        d = calc_xy_distance(x, y, res_x, res_y)<br/>        if d&lt;=d_min:<br/>            d_min = d<br/>    return d_min</span><span id="ee26" class="jz ka hi lo b fi lw lt l lu lv">roi_restaurant_counts = []<br/>roi_turkish_distances = []</span><span id="3f7a" class="jz ka hi lo b fi lw lt l lu lv">print('Generating data on location candidates... ', end='')<br/>for x, y in zip(roi_xs, roi_ys):<br/>    count = count_restaurants_nearby(x, y, restaurants, radius=250)<br/>    roi_restaurant_counts.append(count)<br/>    distance = find_nearest_restaurant(x, y, turkish_restaurants)<br/>    roi_turkish_distances.append(distance)<br/>print('done.')</span></pre><p id="7c25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们把它放进数据框:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mi"><img src="../Images/e29529c6e6f20885005778df82a9e2fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ra3TKnGRXmEorsF3_6tXaQ.png"/></div></div></figure><p id="b1a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们<strong class="ih hj">过滤</strong>这些位置:我们只对半径250米内不超过两家餐馆的<strong class="ih hj">位置</strong>感兴趣，对半径400米内没有土耳其餐馆的<strong class="ih hj">位置感兴趣:</strong></p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mj"><img src="../Images/cf25c740b92dadfa93a7ef0d98d459cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FYRQa8JNXSXrlejJZE8r_g.png"/></div></div></figure><p id="79c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看它在地图上的样子:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mk"><img src="../Images/7e2abd4b35849a1b8dd3cd0abf591914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A0kTQH7F7o47UST7-WO-oA.png"/></div></div></figure><p id="fd67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来不错。我们现在有一些离塔什干中心相当近的地点，我们知道这些地点的每一个在大约2公里的半径内都不超过两家餐馆，并且在小于2公里的范围内也没有土耳其餐馆。这些地方都是新土耳其餐厅的潜在候选地，至少从附近的竞争来看是这样。</p><p id="3fc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们<strong class="ih hj">聚集</strong>这些位置，以创建包含好位置的区域的<strong class="ih hj">中心。这些区域、它们的中心和地址将是我们分析的最终结果。</strong></p><pre class="jn jo jp jq fd ln lo lp lq aw lr bi"><span id="405f" class="jz ka hi lo b fi ls lt l lu lv">from sklearn.cluster import KMeans</span><span id="42cf" class="jz ka hi lo b fi lw lt l lu lv">number_of_clusters = 15</span><span id="8ccd" class="jz ka hi lo b fi lw lt l lu lv">good_xys = df_good_locations[['X', 'Y']].values<br/>kmeans = KMeans(n_clusters=number_of_clusters, random_state=0).fit(good_xys)</span><span id="f502" class="jz ka hi lo b fi lw lt l lu lv">cluster_centers = [xy_to_lonlat(cc[0], cc[1]) for cc in kmeans.cluster_centers_]</span><span id="3884" class="jz ka hi lo b fi lw lt l lu lv">map_tashkent = folium.Map(location=roi_center, zoom_start=14)<br/>folium.TileLayer('cartodbpositron').add_to(map_tashkent)<br/>HeatMap(restaurant_latlons).add_to(map_tashkent)<br/>folium.Circle(roi_center, radius=2500, color='white', fill=True, fill_opacity=0.4).add_to(map_tashkent)<br/>folium.Marker(tashkent_center).add_to(map_tashkent)<br/>for lon, lat in cluster_centers:<br/>    folium.Circle([lat, lon], radius=500, color='green', fill=True, fill_opacity=0.25).add_to(map_tashkent) <br/>for lat, lon in zip(good_latitudes, good_longitudes):<br/>    folium.CircleMarker([lat, lon], radius=2, color='blue', fill=True, fill_color='blue', fill_opacity=1).add_to(map_tashkent)<br/>map_tashkent</span></pre><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ml"><img src="../Images/7f9547c05bc6ccb4d43fa5dca3c04e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IMPv6i-P_sqRIY26Uq9A4Q.png"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx translated">聚类代表大多数候选位置的分组，聚类中心恰好位于候选位置“丰富”的区域的中间。</figcaption></figure><p id="372f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，让我们<strong class="ih hj">对这些候选区域中心进行反向地理编码，以获得可以呈现给利益相关者的地址</strong>:</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mm"><img src="../Images/f396ba28c06f35c77cfa08095c5940c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEP6-lXH2kdyzfvOB2UoTw.png"/></div></div></figure><p id="67eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的分析到此结束。我们创建了15个代表区域中心的地址，这些区域包含餐馆数量较少且附近没有土耳其餐馆的位置，所有区域都离市中心相当近(所有区域距离塔什干中心不到4公里，其中大约一半距离塔什干中心不到2公里)。虽然地图上显示的区域半径约为500米(绿色圆圈)，但它们的形状实际上非常不规则，它们的中心/地址仅应被视为搜索潜在餐厅位置时探索邻近区域的起点。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ml"><img src="../Images/240b0e30064214e331403a73927e9dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QoJDHEz_4zrm9K08BvzCGg.png"/></div></div></figure><h2 id="37ea" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">结果和讨论</h2><p id="e2b2" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">我们的分析表明，尽管塔什干有大量餐馆(在塔什干中心周围12x12km的初始感兴趣区域中有大约200家)，但在靠近市中心的地方仍有一些餐馆密度较低的区域。塔什干市中心的北部和西部是餐馆最集中的地方，因此我们将注意力集中在南部、东南部和东部地区，与行政区相对应。</p><p id="ae24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将我们的注意力引向这一更为狭窄的兴趣领域(涵盖大约。距塔什干中心东南5x5km)我们首先创建了候选位置的密集网格(间距290m然后对这些位置进行过滤，这样那些在600米半径范围内有两家以上餐馆的位置和那些在820米范围内有一家土耳其餐馆的位置就被删除了。</p><p id="df03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些候选位置然后被聚类以创建包含最大数量的候选位置的感兴趣区域。还使用反向地理编码生成了这些区域的中心地址，以用作基于其他因素的更详细的本地分析的标记/起点。</p><p id="f61b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这一切的结果是，根据现有场地的数量和距离，15个区域包含了最多的潜在新餐厅位置，包括一般餐厅和土耳其餐厅。当然，这并不意味着这些区域就是新餐馆的最佳位置！本分析的目的是仅提供塔什干市中心附近但现有餐馆(尤其是土耳其餐馆)不多的区域的信息—完全有可能在这些区域中的任何一个区域有少量餐馆，这些原因会使它们不适合新餐馆，尽管该区域缺乏竞争。因此，建议的区域应仅被视为更详细分析的起点，该分析最终会得出不仅没有邻近竞争，而且考虑了其他因素并满足所有其他相关条件的位置。</p><h2 id="befd" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">结论</h2><p id="236b" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">该项目的目的是确定塔什干市中心附近餐馆(尤其是土耳其餐馆)数量较少的区域，以帮助利益相关方缩小寻找新土耳其餐馆最佳位置的范围。通过从Foursquare数据中计算餐厅密度分布，我们首先确定了证明进一步分析合理的一般行政区，然后生成了满足一些关于现有附近餐厅的基本要求的大量位置集合。然后对这些位置进行聚类，以创建主要的感兴趣区域(包含最大数量的潜在位置),并创建这些区域中心的地址，作为利益相关方最终勘探的起点。</p><p id="043a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最佳餐厅位置的最终决定将由利益相关方根据每个推荐区域的社区和位置的具体特征做出，同时考虑其他因素，如每个位置的吸引力(靠近公园或水域)、噪音水平/靠近主要道路、房地产可用性、价格、每个社区的社会和经济动态等。</p><h2 id="30c9" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">参考</h2><ol class=""><li id="13eb" class="kz la hi ih b ii ku im kv iq mn iu mo iy mp jc mq lf lg lh bi translated">Foursquare API </li><li id="3d28" class="kz la hi ih b ii li im lj iq lk iu ll iy lm jc mq lf lg lh bi translated"><a class="ae jy" href="https://developers.google.com/maps" rel="noopener ugc nofollow" target="_blank">谷歌地图API </a></li></ol></div></div>    
</body>
</html>