<html>
<head>
<title>Pivot table: Practical Use for Data Analyse in Pandas.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据透视表:熊猫数据分析的实际应用。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/pivot-table-practical-use-for-data-analyse-in-pandas-188e4a11ab4a?source=collection_archive---------13-----------------------#2021-02-08">https://medium.com/analytics-vidhya/pivot-table-practical-use-for-data-analyse-in-pandas-188e4a11ab4a?source=collection_archive---------13-----------------------#2021-02-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6370" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个项目都会给数据科学家带来很多问题和挑战。当我们面对一个新的数据集时，我们不知道如何清晰地描述它，哪些特征相互关联，我们有多少离群值，以及更多的问题。我们从快速探索性数据分析(EDA)开始理解数据集，在那里我们应该总结数百行和列。对于这一步，最好有一个简单而强大的工具。<br/>帮助我们节省时间和避免挫折的工具之一是<strong class="ig hi"> <em class="jc">透视表</em> </strong>。这对于以查询速度对数据进行切片、筛选和分组非常有用。此外，它以视觉上吸引人的方式表示信息。在这篇博客中，我想展示你用熊猫的数据透视表做的工作。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es et"><img src="../Images/ee5c18d7b07d86376550b3386cfd5882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aBnNf92KWkWzrMha9871gw.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">一群熊猫。</figcaption></figure><h2 id="9f0a" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">数据透视表的最简单定义</h2><p id="8a38" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">数据透视表是汇总原始表中数据的统计表。这听起来像是简单的按功能分组，但有一个不同之处。</p><blockquote class="ks kt ku"><p id="bbb4" class="ie if jc ig b ih ii ij ik il im in io kv iq ir is kw iu iv iw kx iy iz ja jb ha bi translated">数据透视表将简单的列式数据作为输入，并将条目分组到一个二维表中，该表提供了数据的多维汇总。</p><p id="8605" class="ie if jc ig b ih ii ij ik il im in io kv iq ir is kw iu iv iw kx iy iz ja jb ha bi translated">—Jake Vander plas《Python数据科学手册》中的定义</p></blockquote><p id="ed99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了说明pivot_table如何工作，我使用了Kaggle的一个<a class="ae ky" href="https://www.kaggle.com/c/titanic" rel="noopener ugc nofollow" target="_blank"> Titanic </a>数据集。这个数据集有足够的列用于分析实践，并且非常容易理解。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kz"><img src="../Images/8d23446fdd975daa2e095eec55bf8bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zjlMpAPSGjjacc_fRTy37g.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">Titanic数据集的列定义</figcaption></figure><p id="3ba3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们找出这个数据集的问题，帮助我们了解pivot_table实际上是如何工作的。</p><blockquote class="la"><p id="86d9" class="lb lc hh bd ld le lf lg lh li lj jb dx translated">不同类型的群体存活率有多高？</p></blockquote><h2 id="04d5" class="js jt hh bd ju jv lk jx jy jz ll kb kc ip lm ke kf it ln kh ki ix lo kk kl km bi translated">1.数据透视表的简单示例</h2><p id="32b9" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">如果我们检查文档中的<code class="du lp lq lr ls b"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html" rel="noopener ugc nofollow" target="_blank">groupby</a></code>和<code class="du lp lq lr ls b"><a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html" rel="noopener ugc nofollow" target="_blank">pivot_table</a></code>，我们可以创建一个查询并比较语法。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lt"><img src="../Images/0e62a99df9ef5b4194492802e35d3c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Si6COY1VROvuFgTBEgyaqg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">代码示例</figcaption></figure><p id="976c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先想到的是<strong class="ig hi">以“性别”一栏来统计存活率</strong>。我们可以看到，<code class="du lp lq lr ls b">groupby</code>和<code class="du lp lq lr ls b">pivot_table</code>给出了相同的结果。语法简单易读。数据透视表的行可以更改为:</p><pre class="jd je jf jg fd lu ls lv lw aw lx bi"><span id="6785" class="js jt hh ls b fi ly lz l ma mb">df.pivot_table(‘Survived’, index=’Sex’, aggfunc =’mean’)<br/><strong class="ls hi"><em class="jc"># because default function for result is default numpy.mean()</em></strong></span></pre><blockquote class="ks kt ku"><p id="9e9b" class="ie if jc ig b ih ii ij ik il im in io kv iq ir is kw iu iv iw kx iy iz ja jb ha bi translated"><em class="hh">因此，对于这两个函数，我们可以使用所有统计函数，如sum()、mean()、median()、min()、max()、quantile()等。</em></p></blockquote><p id="ec20" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，两个结果表都告诉我们，船上四分之三的女性幸存了下来！只有五分之一的雄性存活下来。</p><p id="51ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步，我们将深入研究数据。<strong class="ig hi">如果这个存活率取决于票级？</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mc"><img src="../Images/587a643e5d07ec43dedfc849ae4eb617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x-1mfCh6A5ISneETCtEptA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">用两个变量分割数据帧。</figcaption></figure><p id="2602" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我为<code class="du lp lq lr ls b">groupby</code>和<code class="du lp lq lr ls b">pivot_table</code>函数写了两行代码。我们可以看到它们给我们的结果是一样的，但是<code class="du lp lq lr ls b">pivot_table</code>更具可读性。</p><h2 id="fcf8" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">2.对数据透视表使用不同的聚合函数</h2><p id="f021" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我们可以对数据透视表使用不同的聚合函数。<code class="du lp lq lr ls b">aggfunc</code>关键字控制应该应用哪个功能。比如说，我们来统计一下幸存的人。</p><pre class="jd je jf jg fd lu ls lv lw aw lx bi"><span id="8fca" class="js jt hh ls b fi ly lz l ma mb">df.pivot_table('Survived', index = 'Sex', columns = 'Pclass', aggfunc = sum)</span></pre><p id="83d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们有相同的数据框，但每个类中的单元格都填充了一定数量的幸存者。除了一个函数，我们还可以使用函数列表:</p><pre class="jd je jf jg fd lu ls lv lw aw lx bi"><span id="bb8e" class="js jt hh ls b fi ly lz l ma mb">df.pivot_table(‘Survived’, index=’Sex’, columns=’Pclass’, aggfunc = [sum, ‘mean’])</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es md"><img src="../Images/6c74cdef0c9afd0af2db642eddba298d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FUV-9j7AAZzTXXO_-LUOg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx translated">使用聚合函数列表时我们会看到什么</figcaption></figure><p id="4a7e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">聚合函数的更多魔力！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/00d003ba63bcd5e8cf22eae6abd1595a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lgC9BHPisaxdt3G704Nx3g.png"/></div></div></figure><p id="faf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以将结果列指定为将列映射到任何选项的字典。例如，我使用sum函数计算幸存人数，使用mean函数计算乘客票价。</p><h2 id="c8fe" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">3.数据透视表总计</h2><p id="64ba" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated"><code class="du lp lq lr ls b">margins</code>关键字计算每个分组的总数。它自动给我们关于总数的信息，我们不需要创建额外的列或函数。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mf"><img src="../Images/0bcf8204d0a0a297a333e183c7f06c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqjFPLwPtrDh2oiOX7faKA.png"/></div></div></figure><h2 id="d69d" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">摘要</h2><p id="a44d" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">我试图通过简单的例子展示如何使用pivot_table。你可以和我争论使用一些函数(比如unstack)。但是它们提供了更好的视觉效果来将所有结果显示到数据框中。此外，我计划创建一个关于SQL表的pivot函数的博客。</p></div></div>    
</body>
</html>