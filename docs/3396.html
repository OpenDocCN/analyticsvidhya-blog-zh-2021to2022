<html>
<head>
<title>Spotting Anomalies in Chest X Ray Scans using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习发现胸部X射线扫描中的异常</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/spotting-anomalies-in-chest-x-ray-scans-using-deep-learning-4b8195a7b7bb?source=collection_archive---------14-----------------------#2021-06-28">https://medium.com/analytics-vidhya/spotting-anomalies-in-chest-x-ray-scans-using-deep-learning-4b8195a7b7bb?source=collection_archive---------14-----------------------#2021-06-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f376" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用卷积神经网络将扫描分类为“渗出”或“正常”。</p><p id="7154" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将要处理的数据集是胸部x光的灰度(黑白)图像。您可以从这里下载数据集:</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="b8bf" class="jl jm hh jh b fi jn jo l jp jq"><a class="ae jr" href="https://www.kaggle.com/shaitender/cxr-dataset" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/shaitender/cxr-dataset</a></span></pre><p id="313d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在这里查看完整的项目:</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="01f3" class="jl jm hh jh b fi jn jo l jp jq"><a class="ae jr" href="https://github.com/Adhithia/XRay_Classification_CNN" rel="noopener ugc nofollow" target="_blank">https://github.com/Adhithia/XRay_Classification_CNN</a></span></pre><p id="fefa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">肺部<em class="js">积液</em>是什么？</p><p id="34ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">积液是肺部周围不寻常的液体量。胸膜是一层薄膜，位于肺部表面和胸壁内部。当你有胸腔积液时，液体会在你的胸膜层之间积聚。正常情况下，胸膜腔中只有几茶匙的水样液体，这使得你呼吸时，你的肺可以在胸腔中顺利移动。您可以在此了解更多信息:</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="b3f2" class="jl jm hh jh b fi jn jo l jp jq"><a class="ae jr" href="https://www.webmd.com/lung/pleural-effusion-symptoms-causes-treatments" rel="noopener ugc nofollow" target="_blank">https://www.webmd.com/lung/pleural-effusion-symptoms-causes-treatments</a></span></pre><h1 id="1250" class="jt jm hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">1.数据准备</h1><p id="d0f4" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们将加载数据集并指定放置它们的路径。记得把两个文件夹分开放。</p><figure class="jc jd je jf fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kv"><img src="../Images/e1ad4a718e578e3015051b4606638b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0rsFtrJK23HkAVnQxgBoog.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">加载数据集并指定路径</figcaption></figure><p id="5b36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以从每个类中看到一个样本图像。左图左肺有一些空白，标记为“<em class="js">积液</em>”。另一幅图像是“<em class="js">无发现</em>或<em class="js">正常</em>。</p><p id="aa25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里你可能还想注意到另一件事——图像是灰度的。这里没有RGB颜色，这意味着图像是单通道的。并且通常X射线扫描是高分辨率图像。虽然我没有在代码中提到它——它们是1024x1024。(那就是<strong class="ig hi">巨大！</strong>)</p></div><div class="ab cl lh li go lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ha hb hc hd he"><h1 id="90e6" class="jt jm hh bd ju jv lo jx jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp bi translated">2.数据预处理</h1><figure class="jc jd je jf fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/b5357d00e52072006506ade959655555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHjXymDGs0e8gTFKO30fHg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">数据生成程序</figcaption></figure><p id="50d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们已经加载了数据集，我们需要看看不同的预处理方法。从<em class="js"> tensorflow.keras .预处理</em>中，我们导入了一个名为“<em class="js"> ImageDataGenerator </em>的东西。</p><p id="7457" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以从这里查看该类的所有参数:</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="969c" class="jl jm hh jh b fi jn jo l jp jq"><a class="ae jr" href="https://keras.io/api/preprocessing/image/" rel="noopener ugc nofollow" target="_blank">https://keras.io/api/preprocessing/image/</a></span></pre><p id="1bdd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在'<em class="js"> ImageDataGenerator </em>中，我们提供了数据扩充的参数。例如，我们已经提到<em class="js"> rotation_range </em>为10——这是图像在放大时可以随机旋转的范围。在胸部X射线的情况下，旋转90度或任何超过20度的扫描是非常不可能的。</p><blockquote class="lu lv lw"><p id="47ba" class="ie if js ig b ih ii ij ik il im in io lx iq ir is ly iu iv iw lz iy iz ja jb ha bi translated">类似地，我们将<em class="hh">垂直翻转</em>指定为<em class="hh">假</em>。<em class="hh">该参数用于随机垂直翻转图像。同样，获得垂直翻转的X射线图像是非常不可能的。</em></p><p id="9ce7" class="ie if js ig b ih ii ij ik il im in io lx iq ir is ly iu iv iw lz iy iz ja jb ha bi translated">如果你真的有一个这样的，你可能会问那个家伙喝了什么。</p></blockquote><p id="0be1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">参数<em class="js"> width_shift_range </em>和<em class="js"> height_shift_range </em>也被设置为0。这些参数指定了增强过程中高度和宽度的随机变化。再说一次，你永远不会在X射线扫描中看到明显的变化。他们总是将整个图像居中。</p><figure class="jc jd je jf fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ma"><img src="../Images/2cb5c7630a321223ec36f19c611fefea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dTnBGewOpp4H3H38SE-uoQ.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">但是如果你做了一个只有右肺<strong class="bd ju"><em class="mb"/></strong>的扫描呢？</figcaption></figure><p id="a9f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，一旦我们指定了我们想要<em class="js"> ImagDataGenerator </em>做的所有事情，我们就继续进行预处理功能。在这里，我们首先将图像归一化，然后将其缩放到0.25，即缩小到原始大小的1/4。所以图像现在将是256x256。这对于一个普通的系统来说要容易得多。</p><p id="8307" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，在这里的<em class="js">归一化</em>期间，我们使用了图像像素的最大值和最小值，而不是0和255。这是因为这个图像不是一个“<em class="js">自然图像</em>”。(不是3通道图像)</p></div><div class="ab cl lh li go lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ha hb hc hd he"><h1 id="7c03" class="jt jm hh bd ju jv lo jx jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp bi translated">3.数据生成</h1><figure class="jc jd je jf fd kw"><div class="bz dy l di"><div class="mc md l"/></div><figcaption class="ld le et er es lf lg bd b be z dx translated">数据生成器类</figcaption></figure><p id="ed61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">数据生成器</em>类是完全可定制的。这个类为我们做的是批量发送数据。一次性发送整个数据集是无效的。因此，我们在这里定义批量大小，类为我们批量生成数据。</p></div><div class="ab cl lh li go lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ha hb hc hd he"><h1 id="a749" class="jt jm hh bd ju jv lo jx jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp bi translated">4.模型评估方法</h1><p id="72bf" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">这里我们应该注意的一件事是<em class="js">阶级不平衡。渗出</em>仅占10%,而<em class="js">无发现</em>类在数据集中占90%。由于大部分数据只属于一个类别，这种情况下的训练将不起作用，因为模型将主要学习和分类大部分数据为'<em class="js">'没有发现</em>'从而导致高精度。</p><p id="859c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了开发一个模型，我们在这里使用了<em class="js"> ResNet </em>。</p><figure class="jc jd je jf fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es me"><img src="../Images/ab968a7745f1ebde86a97fb6e1912e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m77AwTXJYmAUX3RPQnhbGg.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx translated">ResNet18结构</figcaption></figure><p id="59f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个数据集上评估模型性能的方式必须稍有不同。我们使用所谓的<em class="js">加权交叉熵损失。损失是这样计算的，低流行率类别的错误分类比其他类别受到更重的惩罚。</em></p><p id="a136" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，每当我们的模型在异常类上出错时，我们就通过将损失乘以一个高权重值来对其进行严厉惩罚。这增加了错误分类类别的损失，因此由于反向传播造成的权重变化更大。因此，对错误分类负责的权重的学习曲线更多。</p><p id="0168" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设“<em class="js">无发现</em>”为0级，“<em class="js">积液</em>”为1级。</p><p id="70c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一、实际类— 0，预测类— 0:结果— <strong class="ig hi">无罚</strong>，权重<strong class="ig hi"> 1。</strong></p><p id="8ff6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">二。实际类— 1，预测类— 1:结果— <strong class="ig hi">无惩罚</strong>，权重<strong class="ig hi"> 1。</strong></p><p id="e73b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">三。实际类— 1，预测类— 0:结果<strong class="ig hi"> —惩罚，</strong>权重<strong class="ig hi"> 5。</strong></p><p id="c0cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">四。实际等级— 0，预测等级— 1:结果<strong class="ig hi"> —惩罚，</strong>权重<strong class="ig hi"> 5。</strong></p></div><div class="ab cl lh li go lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ha hb hc hd he"><h1 id="7985" class="jt jm hh bd ju jv lo jx jy jz lp kb kc kd lq kf kg kh lr kj kk kl ls kn ko kp bi translated">5.最后一步</h1><p id="ea08" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">既然您已经准备好了<em class="js">数据生成器</em>以及模型评估指标，那么是时候训练模型并测试它了。您可以通过多种方式训练模型。您可以手动更改所有hyper参数并执行测试运行。你可以尝试改变批量大小，图像分辨率或增加一些数据增强策略。我们在这里使用了<em class="js"> ResNet18 </em>，但是你可以建立你自己的定制CNN模型。</p></div><div class="ab cl lh li go lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="ha hb hc hd he"><p id="031d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是<em class="js">使用深度学习</em>在胸部X射线扫描中发现异常的终结。你可以在这里查看完整的项目:<a class="ae jr" href="https://github.com/Adhithia/XRay_Classification_CNN" rel="noopener ugc nofollow" target="_blank">https://github.com/Adhithia/XRay_Classification_CNN</a></p></div></div>    
</body>
</html>