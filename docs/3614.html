<html>
<head>
<title>Azure Databricks log runtime errors to Application insights</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure数据块将运行时错误记录到应用洞察</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-databricks-log-runtime-errors-to-application-insights-699586e23d15?source=collection_archive---------4-----------------------#2021-07-13">https://medium.com/analytics-vidhya/azure-databricks-log-runtime-errors-to-application-insights-699586e23d15?source=collection_archive---------4-----------------------#2021-07-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="cf8b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用open census库将错误日志推送到Azure monitor</h1><h1 id="19f8" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="b731" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="678a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure数据块</li><li id="8cb5" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储</li></ul><h1 id="f936" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">步伐</h1><ul class=""><li id="bcd6" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建数据块集群</li><li id="c22e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">安装库</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="5da7" class="ki if hh ke b fi kj kk l kl km">opencensus-ext-azure</span></pre><figure class="jz ka kb kc fd ko er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es kn"><img src="../Images/d6824a39b648b11cb9fc38328abbe7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nHl218oZcOSC8qkp.jpg"/></div></div></figure><figure class="jz ka kb kc fd ko er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es kv"><img src="../Images/7ef4af6b8d40d9f8533508378439fbe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sj4kEZ2Z_YH8StUv.jpg"/></div></div></figure><ul class=""><li id="04b8" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">创建笔记本</li></ul><h1 id="a431" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">密码</h1><ul class=""><li id="e3de" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">选择python作为语言</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="7e25" class="ki if hh ke b fi kj kk l kl km">import logging<br/>from opencensus.ext.azure.log_exporter import AzureLogHandler</span><span id="316a" class="ki if hh ke b fi lb kk l kl km">logger = logging.getLogger(__name__)</span><span id="4941" class="ki if hh ke b fi lb kk l kl km"># TODO: replace the all-zero GUID with your instrumentation key.<br/>logger.addHandler(AzureLogHandler(<br/>    connection_string='InstrumentationKey=xxxxx-xxxxxx-xxxxxx-xxxxxxx')<br/>)</span></pre><ul class=""><li id="2adc" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">现在记录一些示例日志</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="2fca" class="ki if hh ke b fi kj kk l kl km">logger.warning("Sample from open census test 01")<br/>logger.error("Sample from open census test 02")</span></pre><ul class=""><li id="a171" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">现在让我们记录一个异常</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="df52" class="ki if hh ke b fi kj kk l kl km">from opencensus.ext.azure.trace_exporter import AzureExporter<br/>from opencensus.trace.samplers import ProbabilitySampler<br/>from opencensus.trace.tracer import Tracer</span><span id="26c6" class="ki if hh ke b fi lb kk l kl km">properties = {'custom_dimensions': {'key_1': 'value_1', 'key_2': 'value_2'}}</span><span id="d142" class="ki if hh ke b fi lb kk l kl km"># Use properties in exception logs<br/>try:<br/>    result = 1 / 0  # generate a ZeroDivisionError<br/>except Exception:<br/>    logger.exception('Captured an exception.', extra=properties)</span></pre><ul class=""><li id="3420" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">登录应用洞察并转到日志</li></ul><figure class="jz ka kb kc fd ko er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lc"><img src="../Images/1d8abd4b9834d0a4951f29c2fe4854df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pcHGPxsoU1LFT_nFc7HR4g.jpeg"/></div></div></figure><figure class="jz ka kb kc fd ko er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ld"><img src="../Images/5211eaab39ed8d91e25b88d40de98c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OycSqHb88751j_qPyabGJg.jpeg"/></div></div></figure><ul class=""><li id="33f4" class="jc jd hh je b jf kw jh kx jj ky jl kz jn la jp jq jr js jt bi translated">以上测试完成自—<a class="ae le" href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/opencensus-python#configure-azure-monitor-exporters" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/azure-monitor/app/open census-python # configure-azure-monitor-exporters</a></li></ul></div><div class="ab cl lf lg go lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ha hb hc hd he"><p id="d246" class="pw-post-body-paragraph lm ln hh je b jf kw lo lp jh kx lq lr jj ls lt lu jl lv lw lx jn ly lz ma jp ha bi translated"><em class="mb">最初发表于</em><a class="ae le" href="https://github.com/balakreshnan/Samples2021/blob/main/adb/opencensusapplog.md" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="mb">。</em></p></div></div>    
</body>
</html>