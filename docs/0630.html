<html>
<head>
<title>Plot Stock Prices with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用R绘制股票价格</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/plot-stock-prices-with-r-6bdbaebc8ec1?source=collection_archive---------1-----------------------#2021-01-25">https://medium.com/analytics-vidhya/plot-stock-prices-with-r-6bdbaebc8ec1?source=collection_archive---------1-----------------------#2021-01-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ac6701d7decf3ff3a3a84e3acf366cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijb1xIwHWcLB6537G49XPQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="http://www.financialtipsor.com/" rel="noopener ugc nofollow" target="_blank">http://www.financialtipsor.com/</a></figcaption></figure><p id="90a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">Github:</em><a class="ae iu" href="https://github.com/qyaan/stock-price-2020-big-tech" rel="noopener ugc nofollow" target="_blank">T5】https://github.com/qyaan/stock-price-2020-big-tech</a></p><p id="ca13" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">文章旨在用r绘制2020年三大科技公司(苹果、谷歌、微软)和S&amp;P500的股价走势</p><p id="9416" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">分析分为三个部分。</p><ul class=""><li id="f70e" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js jz ka kb kc bi translated"><strong class="ix hj">准备环境</strong></li><li id="2f28" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj">获取数据</strong></li><li id="9006" class="ju jv hi ix b iy kd jc ke jg kf jk kg jo kh js jz ka kb kc bi translated"><strong class="ix hj">剧情</strong></li></ul><ol class=""><li id="379e" class="ju jv hi ix b iy iz jc jd jg jw jk jx jo jy js ki ka kb kc bi translated"><strong class="ix hj"> <em class="jt">准备环境</em> </strong></li></ol><p id="8aa9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">软件包“quantmod”经常用于财务分析，软件包“ggplot2”用于绘图。</p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="76a4" class="ks kt hi ko b fi ku kv l kw kx">install.packages("quantmod")<br/>install.packages("broom"))</span><span id="0463" class="ks kt hi ko b fi ky kv l kw kx">library(quantmod)<br/>library(ggplot2)<br/>library(magrittr)<br/>library(broom)</span></pre><p id="c0e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">②<em class="jt">。</em>获取数据</strong></p><p id="0bf2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt"> a .时间范围</em></p><p id="4cb2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在从yahoo finance加载数据之前，需要首先定义时间范围。</p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="7dd2" class="ks kt hi ko b fi ku kv l kw kx">start = as.Date("2020-01-01") <br/>end = as.Date("2021-01-22")</span></pre><p id="f1f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">b .获取股票价格</p><p id="cf98" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过使用函数“getSymbols ”,可以检索到所需的股票价格。有三个参数需要定义:tickers、sources和time range。</p><p id="be92" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，需要的tickers是“AAPL”(苹果)、“GOOGL”(谷歌)、“MSFT”(微软)、“^GSPC"(S&amp;P500).来源是雅虎财经。</p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="5564" class="ks kt hi ko b fi ku kv l kw kx">getSymbols(c("AAPL", "GOOGL", "MSFT","^GSPC"), src = "yahoo", from = start, to = end)</span></pre><p id="16f1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将检索到的股票价格组织为一个数据框架。</p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="cf10" class="ks kt hi ko b fi ku kv l kw kx">stocks = as.xts(data.frame(A = AAPL[, "AAPL.Adjusted"], <br/>B = GOOGL[, "GOOGL.Adjusted"], C = MSFT[, "MSFT.Adjusted"], <br/>E = GSPC[,"GSPC.Adjusted"]))</span><span id="0fa8" class="ks kt hi ko b fi ky kv l kw kx">names(stocks) = c("Apple", "Google", "Microsoft","S&amp;P 500")<br/>index(stocks) = as.Date(index(stocks))</span></pre><p id="545b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<strong class="ix hj"> <em class="jt">剧情</em> </strong></p><p id="db4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt"> a .第一个情节</em></p><p id="d1e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一个图是没有图层的图表。这个想法是为了了解三大科技的发展如何影响标准普尔500的发展。</p><p id="fe72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但第一张图表的问题是，微软和苹果的走势看不清楚，因为它们的股价远低于标准普尔500和谷歌。因此，在3b)下方创建了第二个图表，以单独查看变动情况。</p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="77ab" class="ks kt hi ko b fi ku kv l kw kx">stocks_series = tidy(stocks) %&gt;% <br/>  <br/>  ggplot(aes(x=index,y=value, color=series)) +<br/>  labs(title = "Top Three US Tech Comany and S&amp;P 500: Daily Stock Prices January 2020 - January 2021 (1)",<br/>       <br/>       subtitle = "End of Day Adjusted Prices",<br/>       caption = " Source: Yahoo Finance") +<br/>  <br/>  xlab("Date") + ylab("Price") +<br/>  scale_color_manual(values = c("Red", "Black", "DarkBlue","Orange"))+<br/>  geom_line()</span><span id="419d" class="ks kt hi ko b fi ky kv l kw kx">stocks_series</span></pre><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kz"><img src="../Images/23ae7f75c9e3678dfe751d6dbc39a5a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kn2K_6r1D9bkn0TUu2QWNw.png"/></div></div></figure><p id="73cc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt"> b .第二个情节</em></p><p id="2ce6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二个图是一个有刻面的图表。而这一次，个股价格的走势就清晰多了。</p><pre class="kj kk kl km fd kn ko kp kq aw kr bi"><span id="5f90" class="ks kt hi ko b fi ku kv l kw kx">stocks_series2 = tidy(stocks) %&gt;% <br/>  <br/>  ggplot(aes(x=index,y=value, color=series)) + <br/>  geom_line() +<br/>  facet_grid(series~.,scales = "free") + <br/>  labs(title = "Top Three US Tech Comany and S&amp;P 500: Daily Stock Prices January 2020 - January 2021 (2)",<br/>                                              <br/>                                              subtitle = "End of Day Adjusted Prices",<br/>                                              caption = " Source: Yahoo Finance") +<br/>  <br/>  xlab("Date") + ylab("Price") +<br/>  scale_color_manual(values = c("Red", "Black", "DarkBlue","Orange"))</span><span id="1b94" class="ks kt hi ko b fi ky kv l kw kx">stocks_series2</span></pre><figure class="kj kk kl km fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es la"><img src="../Images/c3a8f952691df1ef7554041e56e1fcde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7f6XJ5MedXzcEkQszXSxg.png"/></div></div></figure></div></div>    
</body>
</html>