<html>
<head>
<title>Emotion classification on Twitter Data Using Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用变形金刚对Twitter数据进行情感分类</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/emotion-classification-on-twitter-data-using-transformers-baa941772f31?source=collection_archive---------22-----------------------#2021-01-13">https://medium.com/analytics-vidhya/emotion-classification-on-twitter-data-using-transformers-baa941772f31?source=collection_archive---------22-----------------------#2021-01-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/4ffe56c866b385667870a2f08fdbfc04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/0*Ivke3uu-BEd0i6u8.jpeg"/></div></div></figure><h1 id="8a58" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="c2e5" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">自然语言处理的世界最近被变形金刚的发明超越了。变压器与传统的基于序列的网络完全无关。rnn是用于基于序列的任务如文本生成、文本分类等的初始武器。但是随着LSTM和GRU细胞的出现，在文本中捕捉长期依赖性的问题得到了解决。但是学习LSTM细胞模型是一项艰巨的任务，因为我们不能让它并行学习。</p><p id="c454" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">变换器类似于基于编码器-解码器的网络，在末端具有关注层，以使模型有效地学习文本的相关上下文。让我们看看如何使用这个令人敬畏的python包装器<a class="ae kq" href="https://simpletransformers.ai/" rel="noopener ugc nofollow" target="_blank">简单的变形金刚</a>以简单的方式实现它们</p><p id="ca9a" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">你需要创建一个Twitter开发者账户，这样你就可以访问它的API，并使用许多令人难以置信的功能。请通过<a class="ae kq" href="https://developer.twitter.com/en" rel="noopener ugc nofollow" target="_blank">这个</a>了解更多。</p><h1 id="c11c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">先决条件</h1><p id="a5ac" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">简单的Transformer模型是根据特定的自然语言处理(NLP)任务构建的。每个这样的型号都配备了专门设计的特性和功能，最适合它们要执行的任务。使用简单变压器模型的高级过程遵循相同的模式。我们将使用库中的文本分类模块来构建情感分类器模型。通过下面的代码安装简单的transformers库。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="8727" class="la iq hh kw b fi lb lc l ld le">pip install simpletransfomers</span></pre><p id="8c8b" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">最好创建一个虚拟环境并安装它。安装包后，按照下面的<a class="ae kq" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank">链接</a>中提到的步骤组织你的Twitter开发者账户。建立帐户后，获取您帐户的不记名令牌，并将其保存在YAML文件中，如下所示:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="4377" class="la iq hh kw b fi lb lc l ld le">search_tweets_api: <br/> bearer_token: xxxxxxxxxxxxxxxxxxxxxxx</span></pre><h1 id="71e4" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">建模</h1><p id="f56b" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">对于该任务，我们将使用来自Kaggle的以下数据集:<a class="ae kq" href="https://www.kaggle.com/ishantjuyal/emotions-in-text" rel="noopener ugc nofollow" target="_blank">文本中的情感</a>。数据集有两列，一列有文本，另一列有相应的情感。让我们可视化数据集及其类分布。</p><p id="c58d" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">数据集包含以下情感类别:<em class="lf">悲伤、愤怒、爱、惊讶、恐惧、快乐，而</em>你可以在下图中看到它的分布</p><p id="e73f" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">在对数据集建模之前，我们可以做一些基本的预处理步骤，如清理文本、用数字对类进行编码等，这样最终的数据帧看起来就像下图。</p><p id="d05d" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我将以下内容定义为模型训练的输入配置。我使用XL-Net来建模数据集，因为它是transformers的高级版本，能够捕捉更长序列的上下文。max_seq_length保持为64，因为在数据集中找到的最大标记数是66，如果您想为更大的文本输入训练模型，可以根据需要将它增加到更大的值。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="d8ee" class="la iq hh kw b fi lb lc l ld le">from simpletransformers.classification import ClassificationModel, ClassificationArgs </span><span id="b4fe" class="la iq hh kw b fi lg lc l ld le">model_args = ClassificationArgs() <br/>model_args.num_train_epochs = 4 <br/>model_args.reprocess_input_data = True <br/>model_args.save_best_model = True model_args.save_optimizer_and_scheduler = False model_args.overwrite_output_dir = True <br/>model_args.manual_seed = 4 <br/>model_args.use_multiprocessing = True <br/>model_args.train_batch_size = 16 <br/>model_args.eval_batch_size = 8 <br/>model_args.max_seq_length = 64 <br/>model = ClassificationModel("xlnet", "xlnet-base-cased", num_labels=6, args=model_args, use_cuda=True)</span></pre><p id="8571" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">一旦模型定型，您就可以获得验证数据集的指标并评估其性能。如果您之前没有进行任何配置，模型权重将保存在输出/目录中。接下来是我们使用Twitter API获取推文的部分。您可以使用API的最大tweets数是100，通过使用高级帐户可以进一步增加。您可以使用下面的代码片段来获取特定句柄的tweets。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="c24d" class="la iq hh kw b fi lb lc l ld le">def create_twitter_url(handle, max_results): <br/> mrf = "max_results={}".format(max_results) <br/> q = "query=from:{}".format(handle) url = "https://api.twitter.com/2/tweets/search/recent?{}&amp;{}".format( mrf, q ) <br/> return url<br/> <br/>def process_yaml(): <br/> with open("keys.yaml") as file: <br/>  return yaml.safe_load(file) </span><span id="0c68" class="la iq hh kw b fi lg lc l ld le">def create_bearer_token(data): <br/> return data["search_tweets_api"]["bearer_token"] </span><span id="b756" class="la iq hh kw b fi lg lc l ld le">def twitter_auth_and_connect(bearer_token, url): <br/> headers = {"Authorization": "Bearer {}".format(bearer_token)}<br/> response = requests.request("GET", url, headers=headers) <br/> return response.json() </span><span id="4efd" class="la iq hh kw b fi lg lc l ld le">url = create_twitter_url('user',10) <br/>data = process_yaml() <br/>bearer_token = create_bearer_token(data) <br/>response = twitter_auth_and_connect(bearer_token, url) <br/>text_list = [x['text'] for x in response['data']] <br/>cleaned_text = [re.findall(regex, x)[0] for x in text_list]</span></pre><p id="1b28" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">上面的代码获取了一个句柄“user”的Twitter响应，并将获取相应句柄发出的最近10条tweets。推文被清理以移除任何表情符号、链接等。例如，让我们看看一些著名的社交媒体链最近20条推文的情绪，以及他们的情绪如何。</p><p id="1fdf" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">和其他人相比，脸书似乎这周过得不太好。</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/2d54d97bf65d573f8a901f6bb3739868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t3qKh8pqNLb8rkrh7z8m9Q.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">著名推特账号的情感分析</figcaption></figure><p id="d8f6" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">因此，我们使用Twitter API和transformers构建了一个简单的情绪分类应用程序，您也可以实时完成它，并进一步扩展这个用例，以分析任何人的任何暴力或悲伤的推文。感谢您在这上面花费宝贵的时间，同时也欢迎您提出建议。</p><p id="21c9" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi"> <em class="lf">本文中显示的媒体不归Analytics Vidhya所有，由作者自行决定使用。</em>T3】</strong></p><h1 id="288b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">关于作者</h1><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es lm"><img src="../Images/06d29b56a395c0311973edd3c857a49f.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/0*ES1Q6Ap3YOfTs-dh.png"/></div></figure><p id="460c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">毗湿奴·恩库马尔</strong></p><p id="5d32" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">机器学习工程师，在创新解决方案方面拥有丰富的知识，能够改善各个领域的业务决策。在Python、Docker、API框架等方面有丰富的实践知识，并在云中部署了许多可重用的解决方案。在编排使用开源服务或云中平台服务部署解决方案的架构方面拥有丰富的知识</p><p id="082c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">您也可以在我们的移动应用程序上阅读这篇文章</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/39e60088e41a143e2141713d23dff95b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/0*bwlMl4_W-p3lgt_t.png"/></div></div></figure><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es lo"><img src="../Images/a655a59db0bd0f4bf5377999e0437e7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:354/format:webp/0*4e6PcQPoUhjiEuuy.png"/></div></figure></div><div class="ab cl lp lq go lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ha hb hc hd he"><p id="592b" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="lf">原载于2021年1月13日https://www.analyticsvidhya.com</em><em class="lf"/><a class="ae kq" href="https://www.analyticsvidhya.com/blog/2021/01/emotion-classification-on-twitter-data-using-transformers/" rel="noopener ugc nofollow" target="_blank"><em class="lf">。</em></a></p></div></div>    
</body>
</html>