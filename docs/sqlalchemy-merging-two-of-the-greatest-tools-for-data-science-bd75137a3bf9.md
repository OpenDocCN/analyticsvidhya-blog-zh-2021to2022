# SQLAlchemy:融合数据科学的两大工具

> 原文：<https://medium.com/analytics-vidhya/sqlalchemy-merging-two-of-the-greatest-tools-for-data-science-bd75137a3bf9?source=collection_archive---------7----------------------->

## 如何正确使用 SQL 和 Python！

![](img/f1b4dd162f3ab34ba242bfdaf1c5e5d7.png)

到目前为止，我越来越多地研究如何使用一些工具来获得数据科学入门工作，我发现，将大量技术堆积到课程中最重要的事情是学习如何协同使用它们。换句话说，如果你知道很多 Python 和很多 SQL，你如何一起使用这两种技术来使你的想法更好地流动。

考虑到这一点，我开始学习更多关于 SQL 的知识，并最终得到了一个非常重要和有用的工具包，将简历上的这两个必备工具结合起来，SQLAlchemy。在这篇文章中，您将学习如何设置运行它的环境，它是如何工作的，以及为什么这是最佳选择。

# 对象关系映射

首先，我们需要更多地了解 SQLAlchemy 的本质，对象关系映射(ORM)是一种基于面向对象编程的技术，可以在两个系统之间转换数据。这对于数据科学来说很有趣，因为您必须在不基于您想要进行处理的语言的地方挑选一些数据，就像在本例中，从基于 SQL 的数据库到 Python 处理。

这个目标是通过使用对象来实现的，对象可以是变量、函数，或者在这个例子中是数据结构，因为，我希望你已经猜到了，这就是你在 SQL 数据库中的内容。通过这种方式，SQLAlchemy 可以在 Python 环境中进行翻译并使其可用。

# 很好，那我该怎么开始？

因此，我将基于 PostgreSQL 服务器制作本教程，但它也可用于其他 SQL 程序，如 MySQL、Microsoft SQL Server 以及任何基于 SQL 构建的存储数据的程序。

这是可能的，因为 SQLAlchemy 是一个后端不可知的系统，这意味着它不依赖于单个系统工作，只要您正确设置系统并知道如何访问它。这肯定是真的，因为当您开始使用 SQL 处理特定的数据库时，您需要知道如何访问它。

# 右脚并线

首先，你需要创建一个对象来设置服务器的路径，这个对象就是你要进行操作的对象，因为它是一个路径，所以你必须能够在服务器中找到你所有的数据结构，就像这样:

```
from sqlalchemy import create_engineengine = create_engine('dialect+driver://username:password@host:port/database')
```

好吧，这不是你现在脑子里想的信息，对吧？你能在哪里找到它？在 Postgres 中，只需在 pgAdmin 软件中右键单击服务器，进入属性，您必须在“连接”选项卡下立即找到这些信息。

# 现在，让我们运行一些操作

所以现在您可能渴望通过您的代码在 SQL server 上运行一些查询，对吗？所以让我们再多了解一点关于方法`execute()`的知识。

因此，在开始一个新表之前(或者如果您第一次搞砸了)，您可能希望在这里和那里删除一个表，因此您可能会请求:

```
engine.execute('DROP TABLE IF EXISTS public.teachers_add')
```

这里重要的一点是，你必须参考你的模式，否则引擎将无法正常工作。这类工作值得注意的是，你的主要对象是一条*路径*，所以你从事的任何操作都必须有一条思维路径。

但是，那不是你唯一想做的事，对吗？您希望由经过仔细考虑的请求组成的表成为 Python 代码的工作结构。因此，事情真正成为一体的部分来了，与熊猫一起工作，产生可行的变量，它可以像这样简单:

```
import pandas as pdsql = 'SELECT * FROM public.subjects_add'
data_db1 = pd.read_sql_query((sql), engine)
data_db1
```

瞧！现在你在数据库中请求的是一个漂亮的熊猫数据框，你可以像这样使用它。使用 SQLAlchemy 中的请求的另一种方法是将其放在 NumPy 数组中，但是如果您马上需要它，一种快速解决方法是将其转换为 DataFrame，然后转换为 NumPy 数组，这种快速解决方法是一种两步解决方案，无论如何您最终都会这样做，另一种方法是使用 list comprehension 创建一个列表，然后将其转换为 NumPy 数组，如您所愿。

所以你在你的分析上努力工作，并且在一天结束的时候你想在服务器上发布你的结果或修改，但是它是你代码中的一个数据帧，你也可以通过 Python 把它上传到服务器上！片段是这样的:

```
data_db1.to_sql('subjects_add', engine)
```

这个方法有一个非常有用的参数，如果您已经有一个名为“subjects_add”的表，那么您可以选择如何处理“if_exists”参数，它接受值['fail '，' replace '，' append']，后两个是不言自明的，但是如果服务器上已经有一个相等的表，第一个将会引发一个错误，并且如果您忘记了这个值，默认为' fail '，所以它将引发一个值错误。

虽然这很容易使用，但这里还有最后一个危险信号要处理，而且可能会很麻烦，比如说你想把它追加到一个现有的表中，很好，你打算怎么追加呢？你不想在你公司的桌子上结束一个弗兰肯斯坦的怪物，它可以与数据工程师的人变得真实。因此，您可能希望使用“method”参数，如果您不传递任何值，它将使用公共的 insert 子句逐行写入，它接受值“multi”，每次将多个条目插入到一个 INSERT 子句中。但是，你的条目是棘手的，当然，因为你生活在现实世界中，所以你可以调用一个签名方法，一个根据你自己的条件附加的函数。

# psycopg2 呢？

这是一个很好的问题，实际上 SQLAlchemy 通过 psycop 2 与 PostgreSQL 接口，如果您要做一个自定义方法来在数据库内的表上追加信息，您将需要 psycop 2 方面的知识。

但是我可以做一个关于如何使用 psycopg2 的完整教程，对吗？是的，这就是想法，为一个教程做两个工具，因为它们是互补的，但是，我一直在阅读，有时 psycopg2 在某些环境中行为不端，你需要对工具有深入的理解来解决其中的一些问题，即使据我所知有些没有任何解决方案。

# 就是这样，男孩女孩们

我发现这些信息真的很有用，而且在互联网上不是很容易获得，这就是为什么我决定做这个小教程来帮助你，所以如果你想留下评论，你觉得哪个 SQLAlchemy 或 psycopg2 更好，或者如果你觉得这个教程有用，我会很感激。

当然，这只是为了确保您将从正确的方面开始，如果您需要关于该工具的更深入的信息，请查看[文档](https://www.sqlalchemy.org/)以了解更多信息。

谢谢，保重！