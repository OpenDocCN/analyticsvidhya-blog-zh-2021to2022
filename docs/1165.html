<html>
<head>
<title>How To Think Tableau Level of Detail Expressions as Writing SQL Group By</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何看待Tableau细节层次表达式编写SQL Group By</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/think-tableau-level-of-expression-in-sql-way-998fdc6df0f0?source=collection_archive---------7-----------------------#2021-02-17">https://medium.com/analytics-vidhya/think-tableau-level-of-expression-in-sql-way-998fdc6df0f0?source=collection_archive---------7-----------------------#2021-02-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="6d69" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">三个例子来展示我如何处理不同的商业问题</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/e7f72f88998145e81e9782c1ebc836af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jR0EvlrD3wRJfzKO"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated"><a class="ae jm" href="https://unsplash.com/@coffeegeek?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">咖啡极客</a>在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="2189" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">细节层次表达是Tableau计算领域的一个重要概念。</p><blockquote class="kj kk kl"><p id="55ff" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">固定详细等级表达式使用指定的尺寸计算值，而不参考视图中的尺寸。<a class="ae jm" href="https://help.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields_lod_fixed.htm" rel="noopener ugc nofollow" target="_blank">固定细节层次表情</a></p></blockquote><p id="4a22" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在学习如何写LOD的时候，我纠结了很多。我不知道我应该把哪一栏放在固定从句后面。有一天，我想到了一个主意。LOD就像SQL的group by function。</p><p id="6c35" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我决定测试一下，我想分享一下我是如何用SQL方式思考LOD的，它确实帮助我更快地在Tableau中编写LOD计算。</p><p id="a413" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">对于这个演示，我想使用Tableau超级商店数据集，并且我已经将该文件导入到我的本地SQL数据库中。</p><h2 id="042d" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">1.区域销售</h2><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ll"><img src="../Images/7cf63627165db6b5b7344934942b0390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pk3eQdRQUWi_6zPc2o4O1g.png"/></div></div></figure><p id="3339" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在编写SQL查询时，我使用“region”作为group by column。至于tableau，region列用作固定子句。</p><p id="98c3" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">结构化查询语言</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="b159" class="kq kr hh ln b fi lr ls l lt lu">SELECT "Region", SUM("Sales")<br/>FROM store<br/>GROUP BY 1<br/>ORDER BY SUM("Sales") DESC</span></pre><p id="90e7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">（舞台上由人扮的）静态画面</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="44b8" class="kq kr hh ln b fi lr ls l lt lu">{ FIXED [Region] : SUM([Sales])}</span></pre><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lv"><img src="../Images/614f55d023d97da2d81592a28b7543f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jYv94mwdr1XCbl1wT3R8dw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">对于tableau表，Region Sales列使用LOD，而Sales使用表视图</figcaption></figure><h2 id="8653" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">2.客户最早订单日期群组</h2><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lw"><img src="../Images/f373395740123b6af76af5df520bb3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ij7VKoqeCx--9KmesQhpig.png"/></div></div></figure><p id="115f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">对于这个问题，请看看子查询。“客户id”按每个客户ID的最早订单年度分组。至于tableau，我使用客户id作为固定子句。</p><p id="844a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">结构化查询语言</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="08fd" class="kq kr hh ln b fi lr ls l lt lu">SELECT year, COUNT(DISTINCT customer) as num_customer<br/>FROM<br/>(SELECT "Customer ID" as customer, MIN(RIGHT("Order Date",2)) AS year<br/>FROM store GROUP BY "Customer ID")tmp<br/>GROUP BY 1</span></pre><p id="671c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">（舞台上由人扮的）静态画面</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="e836" class="kq kr hh ln b fi lr ls l lt lu">{ FIXED [Customer ID]: MIN(([Order Date]))}</span></pre><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lx"><img src="../Images/05ee1b7f68b02e5d3dd696a18a349f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9wUSpc1MZY7t8Dp2HrY9A.png"/></div></div></figure><p id="c452" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">2017年，有595个客户下了第一笔订单。新客户的数量逐年大幅下降。</p><h2 id="5ca4" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">3.地区和类别对照表</h2><p id="52de" class="pw-post-body-paragraph jn jo hh jp b jq ly ii js jt lz il jv jw ma jy jz ka mb kc kd ke mc kg kh ki ha bi translated">结构化查询语言</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="8aa7" class="kq kr hh ln b fi lr ls l lt lu">WITH cte AS(SELECT "Region","Category", ROUND(AVG("Sales")) AS category_average<br/>FROM store<br/>GROUP BY 1,2<br/>ORDER BY "Region", "Category"),</span><span id="5068" class="kq kr hh ln b fi md ls l lt lu">cte2 AS(SELECT "Region", ROUND(AVG("Sales")) AS Region_average<br/>FROM store<br/>GROUP BY 1)</span><span id="5055" class="kq kr hh ln b fi md ls l lt lu">SELECT cte."Region", cte."Category", category_average, Region_average<br/>FROM cte<br/>JOIN cte2 USING("Region")</span></pre><p id="c677" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">（舞台上由人扮的）静态画面</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="c974" class="kq kr hh ln b fi lr ls l lt lu">{ FIXED [Region1]: AVG([Sales])}</span></pre><p id="959a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">至于类别平均销售额，我使用表视图来过滤结果。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es me"><img src="../Images/9d1deb00bf6a0fd3a58c83b8cf5258eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y63XdGcyxe3V5D3JW9vMkw.png"/></div></div></figure><h2 id="e470" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">主要外卖</h2><p id="c8be" class="pw-post-body-paragraph jn jo hh jp b jq ly ii js jt lz il jv jw ma jy jz ka mb kc kd ke mc kg kh ki ha bi translated"><em class="km">想想SQL，当你想把一列作为group by列时，你把该列作为Tableau固定子句。</em></p><p id="9167" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这是我思考细节层次表达的方式，当我陷入困境时，我发现这对我很有好处。希望这对您有所帮助:)</p></div></div>    
</body>
</html>