<html>
<head>
<title>Making Colored Country Maps with Real Data Using Matplotlib and Geopandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Matplotlib和Geopandas制作彩色国家地图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/making-colored-country-maps-with-real-data-using-matplotlib-and-geopandas-2d10687ca7ac?source=collection_archive---------4-----------------------#2021-07-17">https://medium.com/analytics-vidhya/making-colored-country-maps-with-real-data-using-matplotlib-and-geopandas-2d10687ca7ac?source=collection_archive---------4-----------------------#2021-07-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/ebb618996ff38b4710d356dcd6f45770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Akt654qplpJoLZfR4Kpqgg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">用Matplotlib和<a class="ae it" href="https://koordinates.com/layer/3824-nz-police-district-boundaries/" rel="noopener ugc nofollow" target="_blank">新西兰警区数据制作的新西兰Choropleth地图</a></figcaption></figure><p id="4d87" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们将扩展小王的教程<a class="ae it" href="https://towardsdatascience.com/plot-choropleth-maps-with-shapefiles-using-geopandas-a6bf6ade0a49" rel="noopener" target="_blank">如何使用熊猫、Geopandas和Matplotlib </a>绘制新西兰的警区地图——如果你是用Python创建地图的新手，这是一个很好的开始。<strong class="iw hi">在本教程中，</strong>您将更进一步，使用来自<a class="ae it" href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz" rel="noopener ugc nofollow" target="_blank">新西兰警方网站</a>的数据，制作一张显示新西兰枪支许可证总数的地图。</p><p id="6db9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些彩色地图被称为“<a class="ae it" href="https://en.wikipedia.org/wiki/Choropleth_map" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> choropleth地图</strong></a><strong class="iw hi">”</strong>(希腊文意为“许多地区”)。它们就像<a class="ae it" href="https://en.wikipedia.org/wiki/Heat_map" rel="noopener ugc nofollow" target="_blank">热图</a>，除了它们显示实际的州、国家等等。</p><p id="c4ed" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意:<em class="js">如果你想在Plotly中做同样的事情，在你的浏览器中显示地图而不是一个单独的图像，</em> <a class="ae it" href="https://towardsdatascience.com/plot-choropleth-maps-with-shapefiles-using-geopandas-a6bf6ade0a49" rel="noopener" target="_blank"> <em class="js">王的教程</em> </a> <em class="js">有一些很好的Plotly例子。</em></p><h1 id="32de" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">熊猫、Matplotlib、Geopandas是什么？</h1><p id="24bd" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated"><a class="ae it" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> Pandas </strong> </a>是一个Python库，可以帮助你处理数据集，比如CSV和Excel表中的数据集。如果你曾经试图把一个CSV放入一个巨大的2D数组，放入一个Python列表或字典，却发现不可能从中取出一列，Pandas可以解决这个问题。例如，你把你的CSV读入一个熊猫的“数据帧”，然后做<code class="du kw kx ky kz b">column = dataframe["column"]</code>)。</p><p id="0744" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Matplotlib </p><p id="793b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://geopandas.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> Geopandas </strong> </a>是添加了地理/GIS功能的熊猫。没有它，处理州和国家的坐标将是不可能的。</p><h1 id="50ab" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">TL；博士，实际步骤是什么？</h1><p id="fab1" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们将找到一些关于新西兰的坐标数据，找到一些关于新西兰的常规数据(例如，每个地区有多少人居住)，合并这些数据集，然后用合并后的数据制作地图。</p><p id="60ad" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">步骤分解如下:</p><ol class=""><li id="0f19" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr lf lg lh li bi translated">找到一些新西兰的地理信息系统数据，这些数据包含了新西兰的区域边界(我们将使用<a class="ae it" href="https://koordinates.com" rel="noopener ugc nofollow" target="_blank">Koordinates.com</a>)</li><li id="a3cf" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">将GIS数据输入Geopandas</li><li id="2ae0" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">查找一些关于新西兰警区的数据(我们将使用<a class="ae it" href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz" rel="noopener ugc nofollow" target="_blank"> police.govt.nz </a>)</li><li id="494a" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">将这些数据输入普通熊猫体内</li><li id="bfbc" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">只要Geopandas和pandas的地区列匹配，就组合它们的数据框架</li><li id="e82c" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">将合并的数据帧交给Matplotlib，以制作实际的地图</li><li id="010f" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">润色地图</li><li id="b30a" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">关于新西兰，这告诉了我们什么？</li></ol><h1 id="ed7f" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤0:让Python准备就绪</h1><p id="672a" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们假设你<a class="ae it" href="https://www.python.org/about/gettingstarted/" rel="noopener ugc nofollow" target="_blank">已经知道Python并安装了它</a>。</p><p id="d910" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了使用Pandas、Geopandas和Matplotlib，我们需要从互联网上下载它们，然后将它们放到我们的代码中。它们没有附带基本的Python。要下载它们，在您的终端中键入下面的<a class="ae it" href="https://realpython.com/what-is-pip/" rel="noopener ugc nofollow" target="_blank"> Pip </a>命令(Pip是一个下载和管理Python库的工具，它将<a class="ae it" href="https://realpython.com/what-is-pip/" rel="noopener ugc nofollow" target="_blank">使您的生活更加轻松</a>):</p><p id="88aa" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du kw kx ky kz b">pip install pandas geopandas matplotlib</code></p><p id="adbe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这将一次安装所有三个。或者你可以在自己的<code class="du kw kx ky kz b">pip install &lt;library&gt; </code>行单独写下每一个。安装需要一两分钟。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/8fd0f5fe8f18045fe8e4890facc45d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rnehqsn5ETlvNsGDLhPUFQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">使用终端在macOS上安装Pandas、Geopandas和Matplotlib。我们只需输入第一行%后面的内容。剩下的是安装程序的输出。</figcaption></figure><h1 id="35ad" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤1:获取新西兰的GIS数据</h1><p id="89f2" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们将使用小王在<a class="ae it" href="https://koordinates.com/" rel="noopener ugc nofollow" target="_blank">Koordinates.com</a>上找到的<a class="ae it" href="https://towardsdatascience.com/plot-choropleth-maps-with-shapefiles-using-geopandas-a6bf6ade0a49" rel="noopener" target="_blank">原始教程</a>中的相同GIS数据。<a class="ae it" href="https://koordinates.com/layer/3824-nz-police-district-boundaries" rel="noopener ugc nofollow" target="_blank">数据集链接在这里</a>，或者你可以去Koordinates搜索“新西兰警区”</p><p id="9744" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些数据是一个<a class="ae it" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank"> shapefile </a>的格式，这是一个在GIS程序员之间共享地图和坐标数据的标准。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/64c14ce0f10396bead4c6b9fd3e0d5dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*foIdz9ZLd2pa1exZ1M8I5g.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">来自<a class="ae it" href="https://koordinates.com" rel="noopener ugc nofollow" target="_blank">Koordinates.com</a>的新西兰警区边界数据集的信息页面</figcaption></figure><p id="47bc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们必须在Koordinates上创建一个免费帐户。有了帐户后，我们可以通过点击绿色的<strong class="iw hi">导出</strong>按钮来获取数据。下载内容将包含一个ZIP文件，我们可以解压缩该文件以获得包含坐标数据的<code class="du kw kx ky kz b">.shx</code>文件。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/b44693c11aafa6a229bcab51273ed8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HxVH_DOXcV2AaLBzVEF36A.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">来自Koordinates.com<a class="ae it" href="https://koordinates.com" rel="noopener ugc nofollow" target="_blank">的新西兰警区数据的压缩和解压缩文件</a></figcaption></figure><p id="10c5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们将整个<code class="du kw kx ky kz b">kx-nz-police-district-boundaries-SHP</code>文件夹移动到与<code class="du kw kx ky kz b">main.py</code>文件相同的文件夹中。这样，我们的脚本可以更容易地找到我们的数据。我将文件夹重命名为<code class="du kw kx ky kz b">data</code>,以避免稍后在代码中输入长文件夹名。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lv"><img src="../Images/d78621b191ec63d6834b3e2b5ed37dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VGpnj3u3M0R1ycywTAYagA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">我们的“main.py”项目文件夹和最近从<a class="ae it" href="https://koordinates.com" rel="noopener ugc nofollow" target="_blank">Koordinates.com</a>下载的新西兰警区数据</figcaption></figure><p id="e779" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">重要提示:把这7份<code class="du kw kx ky kz b">nz-police-station-boundaries</code>文件放在一起。我们将只告诉我们关于<code class="du kw kx ky kz b">.shx</code>文件的代码，但是Geopandas <a class="ae it" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank">需要几个这样的文件</a>才能工作(保存<code class="du kw kx ky kz b">.txt</code>文档是一个很好的实践)。否则，您会得到如下错误:</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/7cf85420e53a728a47adcef6748cf239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZoEnsUXC69mvFES3b3FkA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">由代码找不到shapefile导致的错误</figcaption></figure><h1 id="b1e9" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步骤2:将坐标加载到Geopandas中</h1><p id="c379" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们将把坐标从<code class="du kw kx ky kz b">nz-police-district-boundaries.shx</code>文件加载到代码中的Geopandas中。</p><p id="e62c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用以下内容创建一个新的Python文件<code class="du kw kx ky kz b">main.py</code>:</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="d6c5" class="mb ju hh kz b fi mc md l me mf">import geopandas as gpd</span><span id="b299" class="mb ju hh kz b fi mg md l me mf">map_df = gpd.read_file("data/nz-police-district-boundaries.shx")</span></pre><p id="a38c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">只用了两行。我们<code class="du kw kx ky kz b">import</code> ed Geopandas，然后使用Geopandas <code class="du kw kx ky kz b">read_file()</code>函数加载<code class="du kw kx ky kz b">.shx</code>文件。现在，我们有了一个名为<code class="du kw kx ky kz b">map_df</code>的数据框架(具体来说是一个<a class="ae it" href="https://geopandas.org/docs/reference/api/geopandas.GeoDataFrame.html" rel="noopener ugc nofollow" target="_blank">地理数据框架</a>),它保存了我们的坐标数据，我们可以使用Geopandas函数对其进行操作，并最终将其转换为地图。</p><p id="2e34" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我们想看看到目前为止我们有什么数据，我们可以在<code class="du kw kx ky kz b">main.py</code>的末尾加上<code class="du kw kx ky kz b">print(map_df)</code>。当我们运行它时，我们得到这个:</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/3d95cb2cd5bf508c40de7cec9a6b1cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lemIk5A-idFLaDLJcHHAqw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">map_df地理数据框架的内容，其中包含新西兰警区的坐标。来源:<a class="ae it" href="https://koordinates.com" rel="noopener ugc nofollow" target="_blank">Koordinates.com</a></figcaption></figure><p id="ae6e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这将显示以下列:</p><ul class=""><li id="40b4" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr mi lg lh li bi translated">索引(0–11)—也称为行号</li><li id="bf6a" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated"><code class="du kw kx ky kz b">DISTRICT_I</code> —每个区的索引</li><li id="beee" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated"><code class="du kw kx ky kz b">DISTRICT_N</code> —各区的名称</li><li id="a758" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated"><code class="du kw kx ky kz b">geometry</code> —该区边界的坐标。数据被一个<code class="du kw kx ky kz b">...</code>截断，但是几何列中的每一行实际上有1000个左右的坐标。要查看到底有多少，将<code class="du kw kx ky kz b">print(map_df["geometry"][1])</code>加到<code class="du kw kx ky kz b">main.py</code>并再次运行。</li></ul><h1 id="2664" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">第三步:找一些关于新西兰的真实数据</strong></h1><p id="c557" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">王的原始教程()在一个12行的CSV文件中有一些任意的数据，这些数据为12个区中的每一个分配了一个犯罪率——像<code class="du kw kx ky kz b">66</code>或<code class="du kw kx ky kz b">118</code>这样的基本整数可能真的意味着任何事情(例如66起抢劫)。那个教程给了我们一张有12个彩色区域的地图。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/e21cfe9edf41e6f30e89ce824693fcf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivuxGa7wbzbafSHp6tIRFw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">使用<a class="ae it" href="https://towardsdatascience.com/plot-choropleth-maps-with-shapefiles-using-geopandas-a6bf6ade0a49" rel="noopener" target="_blank">小王的choropleth地图教程制作的新西兰地图</a></figcaption></figure><p id="c3dd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是真实数据呢？我们如何描述新西兰的警区？互联网上有这些地区的数据吗？我们必须自己去发现。</p><p id="c30d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">寻找正确的数据并不总是一帆风顺的，但这是成为一名优秀数据科学家的一大任务。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mk"><img src="../Images/190929fba68a359ed86ba3ade8a04c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAJszb0Sq_ulAeL9mwEEWA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated"><a class="ae it" href="https://twitter.com/sethrosen" rel="noopener ugc nofollow" target="_blank"> @sethrosen </a>在<a class="ae it" href="https://twitter.com/" rel="noopener ugc nofollow" target="_blank">推特</a></figcaption></figure><p id="4327" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们开始谷歌搜索。如果我们搜索<code class="du kw kx ky kz b">new zealand police district data</code>，会弹出一些资源。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ml"><img src="../Images/e1f06b5a31bd9c69c7988fa77eaefb1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbdOajYb06GdjdN10r8emA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">截图来自<a class="ae it" href="https://www.google.com/search?client=firefox-b-1-d&amp;q=new+zealand+police+district+data" rel="noopener ugc nofollow" target="_blank">谷歌搜索</a></figcaption></figure><p id="092e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些看起来都是可靠的数据来源，尤其是因为它们直接来自相关国家。<strong class="iw hi">理想情况下，我们想要已经按地区分类的数据</strong>或者我们可以通过合理的工作量合并到不同地区的数据。我们看看<a class="ae it" href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz" rel="noopener ugc nofollow" target="_blank">第一个环节</a>有没有类似这样的。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mm"><img src="../Images/092f0984cf79b3dd687c626f537ed16b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zm6X4YRyd_ONNLX6JiXsiA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated"><a class="ae it" href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz" rel="noopener ugc nofollow" target="_blank">新西兰警方的数据存储库</a>具有开放数据集</figcaption></figure><p id="6cb2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">经过调查，我们发现了一些关于新西兰枪支所有权的数据。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mn"><img src="../Images/b56aeb9bc844b2e6a9389ba0d77f30cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTpvvfLotwp4kZgy4id3lA.png"/></div></div></figure><p id="9a13" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们来看看<strong class="iw hi">枪械数据</strong> doc。在蓝色<strong class="iw hi">文件名称</strong>栏下点击其名称，然后在下一页下载XLSX文件。(如果没有Excel打开XLSX文件，<a class="ae it" href="https://raw.githubusercontent.com/aero-man/choropleth-map-tutorial/master/data/nz_firearm_licenses.csv" rel="noopener ugc nofollow" target="_blank">可以从这个项目的Github repo </a>中复制粘贴你需要的数据。)</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mo"><img src="../Images/82fd030bd4f52a2abc3f029a2e18b740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xw3jy0sbXDKnN39K2BWySg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">来自<a class="ae it" href="https://www.police.govt.nz/about-us/publication/firearms-data" rel="noopener ugc nofollow" target="_blank">纽西兰警方</a>的枪械数据Excel表格。</figcaption></figure><p id="4e5c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当我们打开Excel文件时，我们看到其中一个选项卡<strong class="iw hi">按地区划分的活动标准许可证</strong>，有一个清晰的按地区划分的数据表。这是我们坐标数据使用的12个区。这很方便。为了简洁起见，我们将使用这些数据。</p><p id="b922" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们将这个包含12个地区的小表格保存到一个CSV文件中(我们将把我们的命名为<code class="du kw kx ky kz b">nz_firearm_licenses.csv</code>)，以便在我们的项目中使用它。(<a class="ae it" href="https://raw.githubusercontent.com/aero-man/choropleth-map-tutorial/master/data/nz_firearm_licenses.csv" rel="noopener ugc nofollow" target="_blank">或者从这里复制/粘贴CSV</a>)。)把这个CSV文件放在<code class="du kw kx ky kz b">data</code>文件夹中(或者你给它取的任何名字)。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div class="er es mp"><img src="../Images/c7a2af064d8d13413d202323f34ed710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*UfUruqE0s97acN2QrLto1Q.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">来自<a class="ae it" href="https://www.police.govt.nz/about-us/publication/firearms-data" rel="noopener ugc nofollow" target="_blank">新西兰警方</a>的枪支许可证数据CSV</figcaption></figure><p id="0bcf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">这个CSV和原来的Excel表格的一些区别:</strong></p><ul class=""><li id="5d43" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr mi lg lh li bi translated">我们在每个地区名称周围加上“引号”,这样CSV就知道带有空格的地区都是一个名称的一部分。</li><li id="cfd5" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">我们使地区名称与地理数据框架的格式相匹配(例如:<code class="du kw kx ky kz b">Counties/Manukau</code>对<code class="du kw kx ky kz b">COUNTIES/MANUKAU</code>)。</li><li id="ab23" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">我们去掉了数字中的逗号。(我们可以稍后在代码中这样做，但是现在就做。)</li><li id="8bb9" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">第二列从有两个Cs的<code class="du kw kx ky kz b">Licences</code>改为有两个Ss的<code class="du kw kx ky kz b">Licenses</code>。<a class="ae it" href="https://en.wiktionary.org/wiki/licence#Usage_notes" rel="noopener ugc nofollow" target="_blank">新西兰使用“许可证”拼写</a>。您可以使用任何拼写，只要确保它在您的CSV文件和您的代码之间是一致的。</li></ul><p id="acf0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">我们为什么选择这个数据集？</strong>网站上的其他数据集同样有趣，但这个Excel文件很简单，其他数据以Tableau仪表板的形式呈现，下载选项被禁用。我们可以手动复制我们看到的数据，或者想办法<a class="ae it" href="https://stackoverflow.com/questions/62095206/how-to-scrape-a-public-tableau-dashboard" rel="noopener ugc nofollow" target="_blank">收集仪表板数据</a>。但是深入讨论Tableau会使文章偏离主题，而且没有人需要关于如何一起复制和添加数字的教程，所以我们现在跳过它。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mq"><img src="../Images/d05de2cbec4af22b683f7bf1d1ada427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NL-V1EF-lTynFduxT7dmKg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">来自新西兰警方的警区数据图表<a class="ae it" href="https://www.police.govt.nz/about-us/publications-statistics/data-and-statistics/policedatanz/victimisations-demographics" rel="noopener ugc nofollow" target="_blank">“受害者(人口统计)”Tableau dashboard </a>。如果你想尝试的话，这是其他项目的绝佳数据！</figcaption></figure><p id="aba8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从这一步得到的重要教训是，我们必须自己找到数据。在网站上点击下载按钮很容易，但难的是找到数据，决定它是否适合你的项目，并将其转换成适合你的格式。</p><h1 id="cc0e" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第四步:将我们刚刚发现的数据加载到Pandas中</h1><p id="3cd2" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">还记得我们写了两行的<code class="du kw kx ky kz b">main.py</code>文件吗？让我们再次打开它，添加我们在步骤3中新发现的枪支数据。</p><p id="5c35" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">给<code class="du kw kx ky kz b">main.py</code>添加以下几行。我们所要做的就是告诉它我们新的CSV文件的路径(我们也把它放在了<code class="du kw kx ky kz b">data</code>文件夹中)并使用<code class="du kw kx ky kz b">read_csv(file)</code>，就像我们在上面对Geopandas所做的一样。</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="cde9" class="mb ju hh kz b fi mc md l me mf">import pandas as pd<br/>...<br/>licenses_df = pd.read_csv("data/nz_firearm_licenses.csv")</span></pre><p id="c58f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">整个<code class="du kw kx ky kz b">main.py</code>文件现在应该看起来像这样:</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="d7cc" class="mb ju hh kz b fi mc md l me mf">import pandas as pd<br/>import geopandas as gpd</span><span id="f901" class="mb ju hh kz b fi mg md l me mf">map_df = gpd.read_file("data/nz-police-district-boundaries.shx")<br/>licenses_df = pd.read_csv("data/nz_firearm_licenses.csv")</span></pre><p id="8a00" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">到目前为止，我们所做的只是找到数据并将其读入Python。虽然不多，但是业界确实说<a class="ae it" href="https://www.datanami.com/2020/07/06/data-prep-still-dominates-data-scientists-time-survey-finds/" rel="noopener ugc nofollow" target="_blank">一半的数据分析是用来准备你的数据</a>的。线数少不代表作品少。现在，让我们用它来制作一些地图。</p><h1 id="5601" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">第五步:将数据合并成一个数据帧</strong></h1><p id="aff5" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们有两个数据帧，一个带有地区坐标，另一个带有这些坐标所画出的每个地区的枪支数据。让我们把它们放在一起，这样我们就可以给每个地区分配一些枪支许可证。</p><p id="5cff" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du kw kx ky kz b">merge()</code>函数将沿着包含地区名称的任何列组合数据帧，并输出单个数据帧(<code class="du kw kx ky kz b">merged_df</code>)。</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="6774" class="mb ju hh kz b fi mc md l me mf">merged_df = map_df.merge(licenses_df, left_on=["DISTRICT_N"], right_on=["Residence District"])</span></pre><p id="5361" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">参数<code class="du kw kx ky kz b">left_on</code>和<code class="du kw kx ky kz b">right_on</code>告诉<code class="du kw kx ky kz b">merge()</code>哪些列应该在两个数据帧之间匹配，它们是地区列(<code class="du kw kx ky kz b">DISTRICT_N</code>和<code class="du kw kx ky kz b">Residence District</code>)。为了记住哪一列应该是<code class="du kw kx ky kz b">left_on</code>或<code class="du kw kx ky kz b">right_on</code>，请注意在语句<code class="du kw kx ky kz b">map_df.merge(licenses_df...)</code>中，<code class="du kw kx ky kz b">map_df</code>在左边，<code class="du kw kx ky kz b">licenses_df</code>在右边。因此来自<code class="du kw kx ky kz b">map_df</code>的地区列就是我们给<code class="du kw kx ky kz b">left_on</code>的，反之亦然。</p><p id="6511" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦我们将其添加到<code class="du kw kx ky kz b">main.py</code>，我们的数据看起来就像这样。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mr"><img src="../Images/8b24f8a2beeaff921364d057a79e82b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E8HMk7zGM4ztNn2PZKC1-A.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">最终的组合数据帧。有两个带有地区名称的重复列，但这不会影响我们的最终地图。</figcaption></figure><p id="7fa7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里是<code class="du kw kx ky kz b">main.py</code>迄今为止:</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="3dcd" class="mb ju hh kz b fi mc md l me mf">import pandas as pd<br/>import geopandas as gpd</span><span id="8773" class="mb ju hh kz b fi mg md l me mf">map_df = gpd.read_file("data/nz-police-district-boundaries.shx")<br/>licenses_df = pd.read_csv("data/nz_firearm_licenses.csv")</span><span id="037d" class="mb ju hh kz b fi mg md l me mf">merged_df = map_df.merge(licenses_df, left_on=["DISTRICT_N"], right_on=["Residence District"])</span></pre><p id="af65" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这就是我们准备数据所需要做的一切:加载数据并将其合并。</p><h1 id="8e69" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第六步:制作实际的地图</h1><p id="15ca" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们到了！是时候绘制地图了。只需要3条线。</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="a0dc" class="mb ju hh kz b fi mc md l me mf">import matplotlib.pyplot as plt<br/>...<br/>merged_df.plot(column="Licenses", cmap="Blues", legend=True)<br/>plt.show()</span></pre><p id="909f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们正在做的是:</p><ul class=""><li id="b981" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr mi lg lh li bi translated">导入Matplotlib(在你的职业生涯中你会经常看到精确的线条<code class="du kw kx ky kz b">import matplotlib.pyplot as plt</code></li><li id="396b" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">直接在数据框架<code class="du kw kx ky kz b">merged_df</code>(它仍然是地理数据框架，因此能够处理地图坐标)上运行<code class="du kw kx ky kz b">plot()</code>，并告诉它执行以下操作:使用<code class="du kw kx ky kz b">“Licenses”</code>列中的数字来决定颜色，<a class="ae it" href="https://matplotlib.org/stable/gallery/color/colormap_reference.html" rel="noopener ugc nofollow" target="_blank">将颜色设为蓝色</a>，并显示色标，也称为<code class="du kw kx ky kz b">legend</code>。</li><li id="c503" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">告诉Matplotlib用<code class="du kw kx ky kz b">plt.show()</code>向我们展示结果</li></ul><p id="a01a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是现在的<code class="du kw kx ky kz b">main.py</code>的全部内容:</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="ac17" class="mb ju hh kz b fi mc md l me mf">import pandas as pd<br/>import geopandas as gpd<br/>import matplotlib.pyplot as plt</span><span id="8837" class="mb ju hh kz b fi mg md l me mf">map_df = gpd.read_file("data/nz-police-district-boundaries.shx")<br/>licenses_df = pd.read_csv("data/nz_firearm_licenses.csv")</span><span id="6326" class="mb ju hh kz b fi mg md l me mf">merged_df = map_df.merge(licenses_df, left_on=["DISTRICT_N"], right_on=["Residence District"])</span><span id="45ec" class="mb ju hh kz b fi mg md l me mf">merged_df.plot(column="Licenses", cmap="Blues", legend=True)<br/>plt.show()</span></pre><p id="a577" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">回到您的终端，运行添加了这些新代码行的<code class="du kw kx ky kz b">python main.py</code>。</p><p id="c0f7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">新西兰地图应该会出现在你的桌面上！</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ms"><img src="../Images/fbadc17d50e77bad3ffc1be053f74a67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*955Llrbme0jJsgWX0697dQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">新西兰每个警区的枪支许可证地图。数据来源:<a class="ae it" href="https://www.police.govt.nz/about-us/publication/firearms-data" rel="noopener ugc nofollow" target="_blank">纽西兰警方</a></figcaption></figure><p id="f1e8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">如果弹出然后消失，或者根本不显示，</em> <a class="ae it" href="https://stackoverflow.com/questions/23405728/matplotlib-figure-window-disappears-when-in-interactive-mode" rel="noopener ugc nofollow" target="_blank"> <em class="js">用</em> <code class="du kw kx ky kz b"><em class="js">plt.ion()</em></code> <em class="js">和</em> <code class="du kw kx ky kz b"><em class="js">plt.ioff()</em></code> <em class="js">试试这些故障排除技巧</em> </a> <em class="js">。</em></p><p id="6042" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就是这样！地图已经做好了。</p><h1 id="1a1d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第七步:润色地图</h1><p id="130e" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们有了基本的地图。标题呢？那些乱七八糟的东西怎么办？</p><p id="1e00" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在<code class="du kw kx ky kz b">merged_df.plot(…)</code>之后和<code class="du kw kx ky kz b">plt.show()</code>之前，我们将添加后面的所有代码。</p><p id="d5af" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们加上标题<code class="du kw kx ky kz b">“Firearm Licenses by Police District in New Zealand (July 2021)”</code>，因为根据新西兰警方的网站，该数据截至2021年7月<a class="ae it" href="https://www.police.govt.nz/about-us/publications-statistics" rel="noopener ugc nofollow" target="_blank">是真实的。</a></p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="1b2f" class="mb ju hh kz b fi mc md l me mf">plt.title("Firearm Licenses by Police District in New Zealand (July 2021)")</span></pre><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mt"><img src="../Images/3fb612bd20883f020ab02800ef2dc715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vtbg-KjcjKsuauLejd-1EA.png"/></div></div></figure><p id="dce8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">X轴和Y轴上的刻度线和标签都是无用的，并且妨碍了标题，所以让我们通过在<code class="du kw kx ky kz b">tick_params()</code>中将所有内容设置为false来消除它们。</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="19a0" class="mb ju hh kz b fi mc md l me mf">plt.tick_params(<br/>    axis="both",        # affect both the X and Y axes<br/>    which="both",       # get rid of both major and minor ticks<br/>    top=False,          # get rid of ticks on top/bottom/left/right<br/>    bottom=False,<br/>    left=False,<br/>    right=False,<br/>    labeltop=False,     # get rid of labels on top/bottom/left/right<br/>    labelbottom=False,<br/>    labelleft=False,<br/>    labelright=False)</span></pre><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mu"><img src="../Images/08ed72648041df73c9dd1583680df989.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ywCywv2doM-siedhoIBHQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">没有刻度线或标签的新西兰Matplotlib地图</figcaption></figure><p id="25bf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了进一步清理，我们将:</p><ul class=""><li id="fbae" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr mi lg lh li bi translated">用<code class="du kw kx ky kz b">plt.axis("off")</code>去掉新西兰周边的边框</li><li id="bc4e" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">将国家向左推一点(矛盾的是使用<code class="du kw kx ky kz b">plt.subplots_adjust(right=0.85)</code>中的<code class="du kw kx ky kz b">right</code>选项)</li><li id="8fc8" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">通过将<code class="du kw kx ky kz b">y=1.04</code>添加到<code class="du kw kx ky kz b">plt.title(...)</code>来上移标题</li></ul><p id="fd01" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从上到下，我们所有的绘图代码现在看起来都像这样(而<code class="du kw kx ky kz b">main.py</code> <a class="ae it" href="https://github.com/aero-man/choropleth-map-tutorial/blob/master/main.py" rel="noopener ugc nofollow" target="_blank">看起来像这样</a>):</p><pre class="lp lq lr ls fd lx kz ly lz aw ma bi"><span id="4c36" class="mb ju hh kz b fi mc md l me mf">merged_df.plot(column="Licenses", cmap="Blues", legend=True)</span><span id="fa97" class="mb ju hh kz b fi mg md l me mf">plt.title("Firearm Licenses by Police District in New Zealand (July 2021)", y=1.04)<br/>plt.tick_params(<br/>    axis="both",        # affect both the X and Y<br/>    which="both",       # get rid of both major and minor ticks<br/>    top=False,          # get rid of ticks top/bottom/left/right<br/>    bottom=False,<br/>    left=False,<br/>    right=False,<br/>    labeltop=False,     # get rid of labels top/bottom/left/right<br/>    labelbottom=False,<br/>    labelleft=False,<br/>    labelright=False)<br/>plt.axis("off")<br/>plt.subplots_adjust(right=0.85)<br/>plt.show()</span></pre><p id="9848" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">而这就是最终的结果！</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mu"><img src="../Images/507128287f39723bc0ed721a13f0e447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aqwxNR5snWlliGApn76hA.png"/></div></div></figure><p id="7104" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们的结果是一个坚实的新西兰2D地图，最少的装饰和干扰。您的<code class="du kw kx ky kz b">main.py</code>文件<a class="ae it" href="https://github.com/aero-man/choropleth-map-tutorial/blob/master/main.py" rel="noopener ugc nofollow" target="_blank">应该看起来像这样</a>(没有注释)。</p><p id="8917" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你想使用本文顶部显示的地图颜色，将<code class="du kw kx ky kz b">merged_df.plot(...cmap="Blues"...)</code>改为<code class="du kw kx ky kz b">cmap="plasma_r"</code>或<code class="du kw kx ky kz b">cmap="YlGnBu"</code>。<a class="ae it" href="https://matplotlib.org/stable/gallery/color/colormap_reference.html" rel="noopener ugc nofollow" target="_blank">点击此处查看Matplotlib颜色列表</a>。</p><p id="4861" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以使用Matplotlib中的<code class="du kw kx ky kz b">margins</code>、<code class="du kw kx ky kz b">padding</code>和其他参数、函数和选项对此进行进一步调整。还有更多的事情要做。如果你正在寻找制作很酷的Matplotlib图表的想法，<a class="ae it" href="https://matplotlib.org/devdocs/gallery/" rel="noopener ugc nofollow" target="_blank">这里有100个Matplotlib图表以及如何创建它们的图库</a>。</p><p id="7228" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要保存这个图像，你可以在<code class="du kw kx ky kz b">plt.show()</code>的正上方添加<code class="du kw kx ky kz b">plt.savefig("nz_map.png")</code>，它会保存到和其他所有东西相同的文件夹中。如果结果过于像素化，将参数<code class="du kw kx ky kz b">dpi=300</code>添加到<code class="du kw kx ky kz b">plt.show(...)</code>。<a class="ae it" href="https://en.wikipedia.org/wiki/Dots_per_inch" rel="noopener ugc nofollow" target="_blank">更高的DPI </a>意味着更细致的图像。</p><h1 id="2489" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">第八步:关于新西兰，这告诉了我们什么？</h1><p id="1e2d" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">我们新的枪械地图意味着什么？看起来南部地区发放的枪支许可证比北部地区多。在北部地区，尤其是像奥克兰和惠灵顿这样的大城市，发放的执照数量是一半，甚至是三分之一。</p><figure class="lp lq lr ls fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mv"><img src="../Images/0e6b730154ce7a22e7a2c8454398e2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFwWrvYeOTbnDRWJvpeRiQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">这里显示的人口密度在我们刚刚制作的地图中显示枪支许可证数量较低的许多地区看起来确实很暗。这张图表来自Chartsbin.com T21和新西兰统计局，并使用了2006年新西兰人口普查的数据。</figcaption></figure><p id="e908" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">这可能会导致我们的后续项目，以回答如下问题:</strong></p><ul class=""><li id="ad72" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr mi lg lh li bi translated">在新西兰，谁倾向于拥有更多的枪支许可证，靠近城市地区的人还是靠近农村地区的人？</li><li id="3de4" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">拥有高枪支许可证的地区是否也是拥有大片公共土地的地区，如狩猎场或其他体育射击区？</li><li id="6052" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated">新西兰非法/无执照枪支的拥有率是多少？许可证的存在能告诉我们每个地区枪支的真实存在吗？</li></ul><p id="1db2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你对调查这些问题感兴趣，新西兰警方和其他组织在这里提供了一些数据:</p><ul class=""><li id="5438" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr mi lg lh li bi translated"><a class="ae it" href="https://www.police.govt.nz/advice-services/firearms-and-safety" rel="noopener ugc nofollow" target="_blank">来自新西兰警方的枪支安全、政策和登记信息</a></li><li id="33ac" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated"><a class="ae it" href="https://en.wikipedia.org/wiki/Gun_law_in_New_Zealand" rel="noopener ugc nofollow" target="_blank">纽西兰的枪支法</a>(维基百科)</li><li id="eab2" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr mi lg lh li bi translated"><a class="ae it" href="https://www.gunpolicy.org/firearms/topic/firearms_in_new_zealand" rel="noopener ugc nofollow" target="_blank">新西兰枪支政策和改革的最新消息</a>(GunPolicy.org)</li></ul><p id="a21d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你做这样的项目，在这里或LinkedIn上给我发一个链接，我会在这篇文章中添加一个你的项目的链接。</p><h1 id="ab1d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">摘要</h1><p id="6f83" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">你现在应该能够即插即用其他<a class="ae it" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank">形状文件</a>和数据集来获得一些很酷的地图。请记住，对于地理图形的数据框架中的每一行/图形，您需要一列数字来表示某个事物的总数(犯罪总数、困在树上的猫总数等)。).然后，那个笨蛋，你就可以走了！</p><p id="60b1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你有问题或者你认为这是你读过的最差的教程，在这里或者LinkedIn上给我发消息。代码也在Github 上<a class="ae it" href="https://github.com/aero-man/choropleth-map-tutorial/blob/master/main.py" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="a4a7" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">词汇表</h1><p id="463e" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated"><strong class="iw hi"> Pandas </strong> —一个Python库，使处理2D数据集变得容易。Python列表和字典是数据的噩梦。</p><p id="3d02" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">地理熊猫</strong>——字面意思是附加了地理/GIS功能的熊猫。我们用这个来处理从新西兰警方下载的所有坐标。</p><p id="d2a5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> Matplotlib </strong> —制作图表和图形。与熊猫和地质公园合作顺利。</p><p id="5700" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> choropleth地图</strong>——一张城市/国家/地区的地图，用一束颜色来表示数据(如人口密度)</p><p id="7da9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">形状文件</strong> — <a class="ae it" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank">一个或一组文件</a>，用于存储位置数据、坐标等。</p><p id="d0c9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">data frame</strong>—保存所有数据的熊猫对象</p><p id="bf00" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">地理数据框架</strong>——就像一个熊猫数据框架，除了它知道所有很酷的地理数据框架功能以及如何操作</p></div></div>    
</body>
</html>