<html>
<head>
<title>Creating My Own Inverse Kinematics Equations For Our Robotic Arm, Using Simple Trigonometry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用简单的三角学为我们的机械臂创建了我自己的反向运动学方程</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-my-own-inverse-kinematics-equations-for-our-robotic-arm-using-simple-trigonometry-51ef5ab40967?source=collection_archive---------9-----------------------#2021-02-02">https://medium.com/analytics-vidhya/creating-my-own-inverse-kinematics-equations-for-our-robotic-arm-using-simple-trigonometry-51ef5ab40967?source=collection_archive---------9-----------------------#2021-02-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5a0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几个月前，我正在做一个项目，用我的Raspberry Pi 0和便宜的伺服系统制造一个机器人手臂。在一次活跃的虚拟头脑风暴会议后，我们提出了一个雄心勃勃的想法:一个书法机器人。我们有一周的时间来设计、CAD、编程、建造、调试和测试机器人。在电话中，我们提出了一个初步的设计，然后开始制造我们各自的机器人部件。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h2 id="981a" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">创建灵活的代码</h2><p id="c29d" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">由于我是团队中指定的软件工程师，我决定尽快开始编写代码，这样一旦我们将机器人组装起来，我们就可以开始调试。我们已经计划好了伺服系统的布局，但是还没有确定手臂的尺寸，所以我必须设计一个可以在任何尺寸下工作的系统。</p><p id="97a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码的系统设计很简单，我会硬编码机器人的尺寸，然后计算一个2d网格，我们可以根据系统的限制在手臂下面的纸上绘制。使用这个网格，我们应该能够将一个(x，y)坐标传递给一个函数，并运行反向运动学来确定每个伺服需要的角度。这样，代码中的所有内容都可以是动态的，除了硬编码的维度。</p><p id="c6a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有这些的关键是写出反向运动学方程。有几个很好的方法可以做到这一点(我最推荐的是<a class="ae jd" href="https://robotacademy.net.au/lesson/denavit-hartenberg-notation/" rel="noopener ugc nofollow" target="_blank">德纳维特-哈滕伯格会议</a>)，但我看到我们设计机器人的方式，我将能够为我们的手臂提出自己的反向运动学方程，这似乎是一个有趣和令人兴奋的几何问题，可以挑战自己。</p><h2 id="e3f2" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">用初等三角学求解逆运动学</h2><p id="fa23" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">在直接进入我的图之前，让我们看一下Cad。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kl"><img src="../Images/0b2382233871d2f56d912eb42e150224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3-1aRupywOWAu8cTvWXDA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">我们机械臂的Cad图</figcaption></figure><p id="483c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里看到我们简单的机械臂设计。我们给它起了个绰号叫“水塔”，因为它的设计类似于水塔。笔(显示为黄色圆柱体)由机器人松散地握住，因此高度的微小变化不会将铅笔从页面上移开。个人伺服我将提到如下:肩，肘关节，肘关节，从顶部向下移动手臂。</p><p id="86bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过观察，我确定了手臂设计中的4个重要三角形。使用固定长度和两个参数(X和Y距离原点的距离，以英寸为单位，我已经确定为肩部伺服。)，我应该能够计算出三个角度(θ、θ1和θ2)，它们对应于每个伺服机构的角度。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lb"><img src="../Images/7f1684350397b2213e6b4bf6e9972bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-bqO438Ef0nAI0JFt-apgQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">前臂的三角形，平行于手臂所在的平面绘制</figcaption></figure><p id="87c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个三角形是直角三角形，存在于平行于手臂的平面上。重要的是要注意，这个三角形并不总是在平行于纸面的XY平面上，而是会受到肘形伺服角度的影响，然而我们不需要知道这个角度来求解这个三角形。我们的第一个输入参数在这里用X标记:这是从肩部伺服机构的横向距离，单位为厘米。从这里我们需要找到角度θ和前臂Y距离(这里标记为Y ),这将用于我们下一步的计算。</p><p id="3bb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我为找到这些测量值而编写的python代码:</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="ef39" class="jl jm hi ld b fi lh li l lj lk">forearmYLengthRelative = math.sqrt(ForearmLength**2 - xdis**2) </span><span id="b6c6" class="jl jm hi ld b fi ll li l lj lk">elbowXAngle = math.degrees(math.acos(xdis / ForearmLength))</span></pre><p id="ba79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是基于勾股定理和基本的三角学。(*如果你不熟悉的话，python是指数吗)</p><p id="d72f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，这是简单的，但是当我们移动到垂直于地面的平面时，它变得更加复杂。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lm"><img src="../Images/241e853be9a717811a8f73d5ed7b624f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*do7Wf1y3DoKWn75Ozrg5kA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">要求解的其他角度</figcaption></figure><p id="41fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我第一次看这个手臂时，我看到了最初的2个三角形(这里标记为2和3)，并且不知道如何计算伺服系统的角度。然后我意识到这里还有两个隐含的三角形。有一个大三角形，它是三角形2、3和4的组合，底部有一个小矩形，然后是隐含的三角形4。</p><p id="77fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经可视化了手臂上的图表，让我们将它们移动到白色背景，并标记要求解的边和未知角度。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es ln"><img src="../Images/d18b62fc54d7110a84e3a1a1662a586f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-h32nVmI0QZw7QsqxQe6Q.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">手臂在任意点形成的三个三角形</figcaption></figure><p id="32ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们有以下已知变量:变量B、D和E，以及值Yd。b、D、E是固定变量；二头肌长度、肩部伺服到地面的距离以及肘关节的长度。值Yd是输入参数；与肩部伺服机构的距离，单位为厘米。利用Yd和D，我可以找到大三角形的斜边，在图上标为H。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="b6a4" class="jl jm hi ld b fi lh li l lj lk">hypoteneuseLength = math.sqrt(DrawHeight**2 + ydis**2)</span></pre><p id="47ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是仅仅这样是没有用的，直到我从第一个三角形中引入计算出来的前臂Y变量。将E和Y相加，用B，我可以得到三角形4的角度。然后我们可以用余弦的T4定律得到三角形4的θ1和θ2。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="1e83" class="jl jm hi ld b fi lh li l lj lk">additionalTriangleTheta1 = math.degrees(math.acos(((ElbowLength + forearmYLengthRelative)**2 + hypoteneuseLength**2 - BicepLength**2)/(2 * hypoteneuseLength*(ElbowLength + forearmYLengthRelative))))</span><span id="03b4" class="jl jm hi ld b fi ll li l lj lk">additionalTriangleTheta2 = math.degrees(math.acos((hypoteneuseLength**2 + BicepLength**2 - (ElbowLength + forearmYLengthRelative)**2)/(2 * BicepLength * hypoteneuseLength)))</span></pre><p id="26f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，如果我们得到大三角形的角度(代码中称为<code class="du lo lp lq ld b">bigTheta1</code>和<code class="du lo lp lq ld b">bigTheta2</code>)，我们也有所有的边，我们可以通过减去三角形4的θ2得到三角形2的θ1(<code class="du lo lp lq ld b">shoulderAngle</code>)。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="d668" class="jl jm hi ld b fi lh li l lj lk">bigTheta1 = math.degrees(math.asin(DrawHeight/hypoteneuseLength))</span><span id="322b" class="jl jm hi ld b fi ll li l lj lk">bigTheta2 = math.degrees(math.asin(ydis/hypoteneuseLength))</span><span id="22a4" class="jl jm hi ld b fi ll li l lj lk">shoulderAngle = bigTheta2 - additionalTriangleTheta2</span></pre><p id="f0b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要的最后一个角度是三角形3的θ3(<code class="du lo lp lq ld b">elbowYAngle</code>)。这不是三角形的三个角中的一个，所以为了得到它，我们可以使用从B延伸的线来想象三角形2的θ1存在于三角形3中。因为我们知道三角形3中所有其他的角(一个是直角，一个是θ2)，我们可以得到三角形3的θ3。</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="a975" class="jl jm hi ld b fi lh li l lj lk">elbowYAngle = (90 - (bigTheta1 - additionalTriangleTheta1)) - shoulderAngle</span></pre><p id="b63e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了平面上任意点的伺服角度方程。</p><h2 id="908d" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">种种限制打断了这个计划</h2><p id="5a54" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">在这一点上有一些延误，延误了我们的进展。我们的第一个问题是，设计、打印和构建这个机器人花费的时间比预期的要多。然后，我们意识到最初的设计会导致相当有限的绘图空间，所以我们改变了设计，不得不重新打印和构建一切。最终，我们完成了所有的最终尺寸和设计。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lr"><img src="../Images/c423aa14094a4e065ab7c4006822a3f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCJvYuHvudtJy8CAZ4bsFQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">改进后的新设计</figcaption></figure><p id="a471" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是最终的固定尺寸:</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="962d" class="jl jm hi ld b fi lh li l lj lk">Dimensions (in cm)<br/>BicepLength = 9<br/>ElbowHeight = 1.25<br/>ElbowLength = 3.3<br/>ForearmLength = 10<br/>ShoulderHeight = 14.25<br/>hoverHeight = 4.0 (the height that the "hand" will hover above the paper)</span></pre><p id="26ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，即使在重新设计之后，我们的系统仍然保留了一些严格的物理限制。我们的限制之一是手臂与底部的交互，另一个是手臂实际接触页面的有限范围。不幸的是，我们的一些设计局限来自于沟通不畅，这在疫情时代是意料之中的，那时我们的设计会议是通过视频会议技术进行的。</p><p id="cb5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也在有限的预算下工作，基本上使用最便宜的材料，所以我们的伺服系统的最小分辨率只有1度。使用我们手工测量的物理范围，我们的2d绘图网格具有以下分辨率:</p><pre class="km kn ko kp fd lc ld le lf aw lg bi"><span id="0ece" class="jl jm hi ld b fi lh li l lj lk">X Range<br/>0, 145<br/>Y Range<br/>0, 58</span></pre><p id="8069" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个分辨率不足以实现我们的书法理念。在这一点上，我们只是满足于书写清晰。</p><h2 id="5298" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">结果</h2><p id="4e3b" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">在项目到期的前一天通宵工作后，我们完成了我们的手臂。当到达一个点时，手臂会振动和超调，我们花了太多时间试图校准手臂，以至于我们不得不将我们的首字母硬编码到手臂上。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es ls"><img src="../Images/ea04d31683cbc923ce578f3af152f1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/1*2Ut5mdcxbPb8Ga0kizmMgw.gif"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">原始的，乏味的视频是如此之慢，这是3倍快</figcaption></figure><p id="39e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总的来说，我们对我们在限制范围内的设计很满意。我们在时间和金钱上受到严重限制，并且被研究生院的课程所拖累。虽然我们可以做很多改变来提高精确度，但另一个主要的改变是使用弹簧来加重笔的重量。如果给我更多的时间，我还可以实现一个能够将任何文本转换成手臂指令的系统。</p><h2 id="33da" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">结论</h2><p id="ca6d" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">如果你决定做你自己的机器人项目，我推荐使用一种更成熟的反向运动学形式，比如我前面提到的Denavit-Hartenberg协定。但是如果你想要挑战，你可以提出你自己的反向运动学。重要的是要记住，对于许多系统来说，有<a class="ae jd" href="https://www.researchgate.net/figure/Inverse-kinematics-often-has-multiple-solutions_fig2_259234959" rel="noopener ugc nofollow" target="_blank">多个反向运动学解</a>，所以你应该决定一个伺服范围，以便更容易开发一个工作系统，强制一个解决方案。还有，有些系统有无穷多个解，这些很难手工计算，但是如果你强迫一个伺服系统有一个固定的角度，这就容易多了。</p><p id="231e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读！</p><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es lt"><img src="../Images/2f279c8ca3ad559a8b2e94c10b2f00be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*WK-ECsawKSVNUs5DArw_TQ.gif"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">我们还教会了机器人挥手</figcaption></figure><p id="58f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lu">所有与此项目相关的代码，</em> <a class="ae jd" href="https://github.com/Wilhite-r/AnthropoArmP1" rel="noopener ugc nofollow" target="_blank"> <em class="lu">转到我的github </em> </a> <em class="lu">。</em></p></div></div>    
</body>
</html>