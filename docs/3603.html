<html>
<head>
<title>Segmenting UK Constituencies using Unsupervised Random Forest, Boruta and K-Means Clustering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无监督随机森林、Boruta和K-均值聚类分割英国选区</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/segmenting-uk-constituencies-using-unsupervised-random-forest-boruta-and-k-means-clustering-2d21f6c3b368?source=collection_archive---------9-----------------------#2021-07-12">https://medium.com/analytics-vidhya/segmenting-uk-constituencies-using-unsupervised-random-forest-boruta-and-k-means-clustering-2d21f6c3b368?source=collection_archive---------9-----------------------#2021-07-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="d7e5" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">具有特征选择、特征减少和聚类的逐步机器学习</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/f1d842e8752d848b89d6e427f922df65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fHJ0FF3eEAlp4hac"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">帕克·约翰逊在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="d992" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">从十几岁开始，我就发现选举政治很迷人，并开始阅读<a class="ae jm" href="https://ukpollingreport.co.uk/" rel="noopener ugc nofollow" target="_blank">英国民调报告</a>。这是我攻读国际公共政策硕士学位的动力，也是我在我工作的地方工作的原因。我最喜欢选举和民意调查的是它提供的分析机会，以及更好地理解人们为什么做出这样的决定。</p><p id="c8a6" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这篇文章着眼于使用一些关于选区级别投票和人口统计数据的机器学习，看看是否可以以一种比刻板化整个国家地区更好的方式对选区进行分组，这些地区内部的差异在很大程度上被忽略了(咳咳——红墙！).在本文中，我将使用标准K-Means聚类对选区进行分组，使用无监督随机森林进行特征约简，使用Boruta进行特征选择。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="b03e" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">数据</h1><p id="5889" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">幸运的是，除了Zoopla这样的商业来源之外，英国还拥有非常高质量的人口统计数据，这些数据来自备受尊敬的机构，如英国国家统计局和英国议会两院。通过这些来源，可以获得关于职业、以前的投票模式、贫困、房价、教育、年龄、健康、人口密度和当地生活设施的选区级数据。</p><p id="2b8f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">一个人的投票选择是多方面的。下面的漏斗是一个广泛使用的表示，显示了有多少不同的事情影响一个人的决定。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ln"><img src="../Images/618828b4452e54b023f96811c45cc6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5pNg_qCVwOmW2TvV"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">投票选择的漏斗由<a class="ae jm" href="https://books.google.co.uk/books/about/Citizen_Politics_in_Western_Democracies.html?id=6MOGAAAAMAAJ" rel="noopener ugc nofollow" target="_blank">道尔顿(1988) </a></figcaption></figure><p id="2d22" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">随着时间的推移，这些事情会发生变化，它们在推动投票选择方面的重要性也会发生变化。因此，虽然下面的工作能够准确地确定在2019年大选中决定投票选择的重要因素，但假设未来选举保持不变是错误的(尽管目前这些变化很慢)。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="abd8" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">特征选择。让我们把这个放下来！</h1><p id="1677" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">由于有大量的选区级功能，其中许多功能可能对投票选择影响很小或没有影响。因此，将它们包括在兰登森林模型中不会提高甚至可能降低模型的准确性。因此，首先应用一些特征选择是很重要的。</p><p id="d872" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">Boruta 就是这样一种特征选择算法，它可以很好地处理随机森林模型。这篇链接文章比我更好地解释了Boruta，但简而言之，它通过随机选择真实特征并对照真实特征进行测试来创建“影子特征”，以查看哪个在预测投票份额方面表现更好。如果真实特征在预测性方面始终优于随机特征，那么它们被认为对预测投票选择很重要。</p><p id="b5ee" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">运行Boruta的代码只有几行，如下所示:</p><pre class="ix iy iz ja fd lo lp lq lr aw ls bi"><span id="22a4" class="lt kr hh lp b fi lu lv l lw lx">library(boruta)</span><span id="cb1f" class="lt kr hh lp b fi ly lv l lw lx"># Set a pseudo-random seed for replicability</span><span id="a146" class="lt kr hh lp b fi ly lv l lw lx">set.seed(111)</span><span id="720c" class="lt kr hh lp b fi ly lv l lw lx"># Run the Boruta algorithm on the data where first_party is the percentage of votes for the winning party</span><span id="7dfa" class="lt kr hh lp b fi ly lv l lw lx">boruta.bank_train &lt;- Boruta(first_party~., data = uk_const_boruta, doTrace = 2)</span><span id="614c" class="lt kr hh lp b fi ly lv l lw lx"># Print a summary of feature importances</span><span id="ef33" class="lt kr hh lp b fi ly lv l lw lx">boruta.bank_train$ImpHistory</span></pre><p id="031a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">下表显示了运行Boruta算法后选择的特征列表，这些特征被确定为最佳预测投票份额。对于任何关注2019年大选的人来说，他们似乎通过了<a class="ae jm" href="https://en.wikipedia.org/wiki/Visual_inspection" rel="noopener ugc nofollow" target="_blank">视力测试</a>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="3c2b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">有替代Boruta的特征选择算法。一种这样的方法是<a class="ae jm" href="https://towardsdatascience.com/mrmr-explained-exactly-how-you-wished-someone-explained-to-you-9cf4ed27458b" rel="noopener" target="_blank">最大关联—最小冗余(MRMR) </a>。这种技术对Boruta进行了改进，它认识到一些特征在解释能力方面存在重叠(例如，20-29岁的人比70-79岁的人有更多的学位，但年龄和教育都是投票选择的重要决定因素)，因此确定了什么样的特征组合作为一个整体最具预测性，而不是仅单独采用最具预测性的特征。可惜我是做了这个工作之后才知道这个技术的！</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="e0b3" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">用多种特征聚集事物</h1><p id="2107" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">我听过的对集群的最好的简单英语描述是一个连锁餐厅决定在哪里开新餐厅的例子。基于预先计算的度量，所有项目彼此之间都有一定的“距离”，在本例中是物理距离。给定一定数量的组，一种算法会计算出如何将这些组组合在一起，以最小化组中所有点之间的总距离。如果你是开了3家新外卖店的Morleys的老板，并且拥有该地区所有鸡肉爱好者的GPS坐标，你就可以找到放置外卖的最佳地点。</p><p id="9403" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">聚类算法，如K-Means，在距离上工作得很好，但是如果你有许多特征，而测量它们内部和之间的距离是困难的，你如何将它们分组在一起？</p><h2 id="c0c2" class="lt kr hh bd ks mb mc md kw me mf mg la jw mh mi lc ka mj mk le ke ml mm lg mn bi translated">进入无人监督的随机森林</h2><p id="da9f" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated"><a class="ae jm" href="https://www.stat.berkeley.edu/~breiman/RandomForests/cc_home.htm" rel="noopener ugc nofollow" target="_blank">随机森林</a>是一个非常流行的机器学习算法。它通常以受监督的方式用于分类和回归任务。作为一个懒惰的数据科学家，我爱随机森林！它需要更少的功能工程，如对数和幂变换，并且可以很好地处理分类变量，而不必对它们进行热编码。</p><p id="3371" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">其无人监管的形式不太为人所知，但在这方面是非常宝贵的。像博鲁塔一样，<a class="ae jm" href="http://gradientdescending.com/unsupervised-random-forest-example/" rel="noopener ugc nofollow" target="_blank">无监督随机森林</a>也与真实选区的“随机影子版本”进行比较，以确定和量化不同的特征组合如何组合在一起，以及它们彼此相距多远。该算法的宝贵输出是每个选区之间的距离网格，这是聚类算法的完美输入。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mo"><img src="../Images/3a0cbd2cc4d2d035bf64f5341164cce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*etyE8X4XE9sb6bGY"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">地图中常见的距离网格示例(<a class="ae jm" href="http://walkingplaces.co.uk/c2c" rel="noopener ugc nofollow" target="_blank">步行地点</a>)</figcaption></figure><p id="9fba" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">同样，代码很简单。一行运行随机森林算法，一行检索距离矩阵。</p><pre class="ix iy iz ja fd lo lp lq lr aw ls bi"><span id="1d90" class="lt kr hh lp b fi lu lv l lw lx">library(RandomForest)</span><span id="9856" class="lt kr hh lp b fi ly lv l lw lx"># Run Random Forest Algorithm, ensuring a proximity matrix is created</span><span id="72bf" class="lt kr hh lp b fi ly lv l lw lx">urf_model &lt;- randomForest(x = uk_const_urf, mtry = 5, ntree = 2000, proximity = TRUE) </span><span id="21a8" class="lt kr hh lp b fi ly lv l lw lx">#Retrieve the proximity matrix from the resulting model</span><span id="aafe" class="lt kr hh lp b fi ly lv l lw lx">proxim &lt;- urf_model$proximity</span></pre><h2 id="2cb4" class="lt kr hh bd ks mb mc md kw me mf mg la jw mh mi lc ka mj mk le ke ml mm lg mn bi translated">现在让我们分组</h2><p id="82b9" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">现在我们有了一个包含每个选区之间的“距离”的网格，我们现在可以开始对它们进行细分。互联网上有许多不同的聚类算法，但为此我将使用最基本和最常用的算法之一，<a class="ae jm" href="https://www.analyticsvidhya.com/blog/2019/08/comprehensive-guide-k-means-clustering/" rel="noopener ugc nofollow" target="_blank"> K-Means聚类</a>。</p><p id="0893" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在这种情况下使用K-Means有两个原因。首先，我想确保每个选区都包含在一个细分市场中，其次，我想要一个对技术不太精通的人来说容易解释的算法。</p><p id="3390" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">K-Means聚类的第一步是确定最佳分段数。确定这一点的经典方法是<a class="ae jm" href="https://www.scikit-yb.org/en/latest/api/cluster/elbow.html" rel="noopener ugc nofollow" target="_blank">肘法</a>。该方法的工作原理是使用不同数量的分段(在本例中为1–10)运行K-Means算法，并选择每个组中所有点之间的距离平方和开始趋于稳定的数字，如下图所示(其中6是分段的最佳数量)。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mp"><img src="../Images/eaf6f31656e6dfe51dcb5ba9407b5493.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*V74zxl5LHqxBXI4F"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">肘法图(<a class="ae jm" href="https://blog.cambridgespark.com/how-to-determine-the-optimal-number-of-clusters-for-k-means-clustering-14f27070048f" rel="noopener ugc nofollow" target="_blank">剑桥火花</a></figcaption></figure><p id="0f9f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这方面的代码可以在下面找到。</p><pre class="ix iy iz ja fd lo lp lq lr aw ls bi"><span id="3d8c" class="lt kr hh lp b fi lu lv l lw lx">library(factoextra)</span><span id="bfbc" class="lt kr hh lp b fi ly lv l lw lx"># function to compute total within-cluster sum of squares</span><span id="d2b6" class="lt kr hh lp b fi ly lv l lw lx">fviz_nbclust(proxim_df, pam, method = "wss", k.max = 40) + theme_minimal() + ggtitle("the Elbow Method")</span></pre><p id="2464" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">基于对预测2019年投票份额最重要的特征，将6个区段确定为最佳区段数，运行K-Means算法创建6个不同的选区组。</p><pre class="ix iy iz ja fd lo lp lq lr aw ls bi"><span id="c0ee" class="lt kr hh lp b fi lu lv l lw lx">library(cluster)</span><span id="4e51" class="lt kr hh lp b fi ly lv l lw lx"># Calculate segments and assign to each constituency</span><span id="e391" class="lt kr hh lp b fi ly lv l lw lx">pam.rf &lt;- pam(proxim, 6)pred &lt;- cbind(pam.rf$clustering, uk_const_tidy$first_party)table(pred[,2], pred[,1]) </span><span id="e55c" class="lt kr hh lp b fi ly lv l lw lx">uk_const_tidy &lt;- uk_const_tidy %&gt;% left_join(select(uk_const_data, age, PCON14CD), by = c("const_code" = "PCON14CD")) </span><span id="5dd4" class="lt kr hh lp b fi ly lv l lw lx">Clusters &lt;- as.factor(pam.rf$cluster)</span><span id="4b88" class="lt kr hh lp b fi ly lv l lw lx">Party &lt;- uk_const_tidy$first_party</span></pre></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="bc42" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">结果呢</h1><p id="68ac" class="pw-post-body-paragraph jn jo hh jp b jq li ii js jt lj il jv jw lk jy jz ka ll kc kd ke lm kg kh ki ha bi translated">下面的十六进制地图显示了每一个选区，并根据它所在的区域进行了着色。由于数据不足，北爱尔兰选区被忽略。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mq"><img src="../Images/f8171883f07b55a629ad06829a7f8689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J2YmtEu40iZ_iw9X"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">英国选区的十六进制地图，用线段着色(原始地图来自<a class="ae jm" href="https://odileeds.org/projects/hexmaps/constituencies/" rel="noopener ugc nofollow" target="_blank"> ODI Leeds </a></figcaption></figure><p id="2b39" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">对我来说，这张地图上有几样东西很突出。首先，整个伦敦本质上属于自己的群体。只有布里斯托尔、曼彻斯特、剑桥和爱丁堡的4个选区具有相似的特征。</p><p id="7806" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">第二件突出的事情是沿海社区的相似性，不管它们在这个国家的什么地方。从Land's End到John O' Groats，这些选区都整齐地归入第5部分。值得注意的是，数据中没有任何地理特征，所以基于人口统计，这些都是相似的。</p><p id="ea44" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在此之后，很明显，全国各地城市通勤带的选区有类似的共享特征，如第1部分所示。最后，有趣的是，东南部的富裕郡和家乡郡与苏格兰的许多选区有很多相似之处。一些我没有预料到的事情。</p><p id="8850" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我已经把代码(R)放在我的<a class="ae jm" href="https://github.com/jpetcon/data_hobbies/tree/main/unsupervised_random_forest_clustering" rel="noopener ugc nofollow" target="_blank"> Github </a>上了，所以欢迎你来玩一玩，看看你能看到什么，但希望这是对机器学习和选举之间交换的有趣洞察。</p></div></div>    
</body>
</html>