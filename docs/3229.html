<html>
<head>
<title>Player Detection using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习的玩家检测</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/player-detection-using-deep-learning-492122c3bf9?source=collection_archive---------2-----------------------#2021-06-20">https://medium.com/analytics-vidhya/player-detection-using-deep-learning-492122c3bf9?source=collection_archive---------2-----------------------#2021-06-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="af5e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">足球中的球员检测</h1><p id="34ee" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在过去的几年里，人们对使用数据来改进足球队的游戏越来越感兴趣。足球数据的分析和研究可以对多个领域产生积极影响，如球员侦察、团队游戏(例如，球场控制和xG模型)、球员训练和表现等。</p><p id="94a7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">特别地，计算机视觉可以是从游戏/训练视频中提取相关信息的重要工具。</p><blockquote class="kg kh ki"><p id="c087" class="jd je kj jf b jg kb ji jj jk kc jm jn kk kd jq jr kl ke ju jv km kf jy jz ka hb bi translated">因此，在这篇文章中，我将着重于从比赛录像中检测足球运动员，然后尝试让T2识别他们球衣上的号码。</p></blockquote><p id="05d7" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">本帖呈现的代码可以在这里看到:<a class="ae kn" href="https://github.com/danielazevedo/Football-Analytics/tree/master/player_detection" rel="noopener ugc nofollow" target="_blank">https://github . com/danielazevedo/Football-Analytics/tree/master/player _ detection</a></p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ko"><img src="../Images/0e1ee38a60d07cdfa36f02794da8d68c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9nwzMFaf3LjFtGjsLysFNg.gif"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">玩家检测的例子</figcaption></figure><h1 id="bd5a" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">玩家检测管道</h1><p id="9cd3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">为了检测和识别(通过球衣号码)视频中的球员，我建立了一个工作流程管道，包括3个步骤:</p><ol class=""><li id="396c" class="le lf hi jf b jg kb jk kc jo lg js lh jw li ka lj lk ll lm bi translated"><strong class="jf hj">球员检测:</strong>从图像中检测人物(足球运动员)</li><li id="5f19" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated"><strong class="jf hj">号码检测:</strong>检测球员后，检测球员内球衣号码所在的区域</li><li id="a7fe" class="le lf hi jf b jg ln jk lo jo lp js lq jw lr ka lj lk ll lm bi translated"><strong class="jf hj">号码识别:</strong>检测到衬衫号码后，识别衬衫上的号码。</li></ol><p id="c815" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">从视觉上看，整个管道定义如下:</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ls"><img src="../Images/8c651d3bda97253652b99f17ee49fa6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8VMSOpn-aODJ8XpnIReAA.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">玩家检测管道</figcaption></figure><h1 id="571c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">1.玩家检测</h1><p id="8a7f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第一步最容易实现。幸运的是，已经有预先训练的深度学习模型，我们可以用来从图像中检测<em class="kj">个人</em>，在这种情况下，它将检测<strong class="jf hj"> <em class="kj">足球运动员</em> </strong>。</p><p id="7289" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">在这种情况下，我使用了使用<strong class="jf hj"> Darknet </strong>框架的预训练<strong class="jf hj"> YOLO </strong>模型，该模型是用来自COCO数据集的数千张图像训练的。使用python，有一个名为DNN的OpenCv模块，它包含了YOLO/暗网。查看此<a class="ae kn" href="https://pjreddie.com/darknet/yolo/" rel="noopener ugc nofollow" target="_blank">链接</a>中关于如何使用YOLO进行物体检测的说明。</p><p id="ffeb" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">下面是加载和检测玩家的Python代码片段</p><pre class="kp kq kr ks fd lt lu lv lw aw lx bi"><span id="e5b2" class="ly ig hi lu b fi lz ma l mb mc"># initialize minimum probability to eliminate weak predictions<br/>p_min = 0.5<br/>thres = 0.</span><span id="6e2b" class="ly ig hi lu b fi md ma l mb mc"># 'VideoCapture' object and reading vicv2.mean(image, mask=mask)deo from a file</span><span id="c9c4" class="ly ig hi lu b fi md ma l mb mc">video = cv2.VideoCapture('video_test.mp4')</span><span id="ed35" class="ly ig hi lu b fi md ma l mb mc">writer = None<br/>h, w = None, None</span><span id="897b" class="ly ig hi lu b fi md ma l mb mc"># Create labels into list<br/>with open('coco.names') as f:<br/>    labels = [line.strip() for line in f]<br/></span><span id="62e0" class="ly ig hi lu b fi md ma l mb mc"># load network <br/>network = cv2.dnn.readNet('darknet/cfg/yolov3.weights', 'darknet/cfg/yolov3.cfg')</span><span id="d989" class="ly ig hi lu b fi md ma l mb mc"># Getting only output layer names that we need from YOLO<br/>ln = network.getLayerNames()<br/>ln = [ln[i[0] - 1] for i in network.getUnconnectedOutLayers()]<br/></span><span id="e3e8" class="ly ig hi lu b fi md ma l mb mc"># Defining loop for catching frames<br/>while True:<br/>    ret, frame = video.read()<br/>    if not ret:<br/>        break</span><span id="5480" class="ly ig hi lu b fi md ma l mb mc">    # frame preprocessing for deep learning<br/>    blob = cv2.dnn.blobFromImage(frame, 1 / 255.0, (416, 416), swapRB=True, crop=False)</span><span id="306c" class="ly ig hi lu b fi md ma l mb mc">    # perform a forward pass of the YOLO object detector, giving us our bounding boxes and associated probabilities.</span><span id="38bc" class="ly ig hi lu b fi md ma l mb mc">    network.setInput(blob)<br/>    output_from_network = network.forward(ln)</span><span id="a991" class="ly ig hi lu b fi md ma l mb mc">    #process bounding boxes in output_from_network</span></pre><p id="b612" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这里有一个例子。蓝框代表检测到的玩家各自的概率。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es me"><img src="../Images/ad4285b8a76c9517c6415910a887b228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-x-ySz3xFpWj5p4tC4H6g.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">来自<strong class="bd ih">巴西vs比利时</strong>的图像帧</figcaption></figure><h1 id="841c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">2.数字检测</h1><p id="2d7b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第二步重点检测球员球衣上的号码。</p><p id="4124" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">为了这个任务，我使用一个数据集(你可以在这里找到更多信息<a class="ae kn" href="https://ieeexplore.ieee.org/document/8575395" rel="noopener ugc nofollow" target="_blank"/>)训练了一个深度学习模型，衬衫上贴有数字标签。通过缩放和灰度应用对图像进行预处理。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es mf"><img src="../Images/50f2d6449dba8a3f84bfdce3f90372c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*2KMR03FYwz9H7m6HeHP-kw.png"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">数据集的样本示例</figcaption></figure><p id="7472" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">该模型对应于预训练的VGG模型，在顶部训练一些层(<em class="kj">即</em>转移学习)。这是模型架构的一个片段。</p><pre class="kp kq kr ks fd lt lu lv lw aw lx bi"><span id="de51" class="ly ig hi lu b fi lz ma l mb mc"># load the VGG16 network, ensuring the head FC layers are left off</span><span id="305b" class="ly ig hi lu b fi md ma l mb mc">vgg = VGG16(weights="imagenet", include_top=False, input_tensor=Input(shape=(224, 224, 3)))</span><span id="475f" class="ly ig hi lu b fi md ma l mb mc"># freeze all VGG layers so they will *not* be updated during the training process<br/>vgg.trainable = True</span><span id="b21d" class="ly ig hi lu b fi md ma l mb mc"># flatten the max-pooling output of VGG<br/>flatten = vgg.output<br/>flatten = Flatten()(flatten)</span><span id="5af0" class="ly ig hi lu b fi md ma l mb mc"># construct a fully-connected layer header to output the predicted bounding box coordinates</span><span id="7af3" class="ly ig hi lu b fi md ma l mb mc">bboxHead = Dense(128, activation="relu")(flatten)<br/>bboxHead = Dense(64, activation="relu")(bboxHead)<br/>bboxHead = Dense(32, activation="relu")(bboxHead)<br/>bboxHead = Dense(4, activation="sigmoid")(bboxHead)</span><span id="3af3" class="ly ig hi lu b fi md ma l mb mc"># construct the model we will fine-tune for bounding box regression</span><span id="1d3c" class="ly ig hi lu b fi md ma l mb mc">model = Model(inputs=vgg.input, outputs=bboxHead)</span></pre><p id="de36" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这里有一个例子。红色方框代表检测到的玩家和检测到的号码。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es mg"><img src="../Images/a339f110f55598443d8761015036eced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*muDCL3fMaI94F0jG_BcHHw.jpeg"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">图片来自<strong class="bd ih">埃弗顿vs热刺</strong></figcaption></figure><h1 id="143f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">3.号码识别</h1><p id="5c6a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">最后的步骤涉及到被检测号码的识别。为了这个任务，用数据扩充来训练CNN模型。模型架构如下。</p><pre class="kp kq kr ks fd lt lu lv lw aw lx bi"><span id="ec16" class="ly ig hi lu b fi lz ma l mb mc">classifier = Sequential()</span><span id="997e" class="ly ig hi lu b fi md ma l mb mc">classifier.add(Conv2D(128, (3, 3), input_shape = (224, 224, 3), activation = 'relu'))</span><span id="a1aa" class="ly ig hi lu b fi md ma l mb mc">classifier.add(MaxPooling2D(pool_size = (2, 2)))<br/>classifier.add(Dropout(0.2))</span><span id="9734" class="ly ig hi lu b fi md ma l mb mc">classifier.add(Conv2D(64, (3, 3), activation = 'relu'))<br/>classifier.add(MaxPooling2D(pool_size = (2, 2)))</span><span id="631d" class="ly ig hi lu b fi md ma l mb mc">classifier.add(Dropout(0.2))<br/>classifier.add(Conv2D(32, (3, 3), activation = 'relu'))</span><span id="ae17" class="ly ig hi lu b fi md ma l mb mc">classifier.add(MaxPooling2D(pool_size = (2, 2)))<br/>classifier.add(Dropout(0.2))</span><span id="fffc" class="ly ig hi lu b fi md ma l mb mc">classifier.add(Flatten())</span><span id="2036" class="ly ig hi lu b fi md ma l mb mc">classifier.add(Dense(units = 128, activation = 'relu'))<br/>classifier.add(Dense(units = 64, activation = 'relu'))<br/>classifier.add(Dense(units = 64, activation = 'relu'))<br/>classifier.add(Dense(units = 10, activation = 'softmax'))</span><span id="dfd1" class="ly ig hi lu b fi md ma l mb mc"># Compiling the CNN</span><span id="6483" class="ly ig hi lu b fi md ma l mb mc">classifier.compile(optimizer = 'adam', loss = 'categorical_crossentropy', metrics = ['accuracy'])</span></pre><p id="20ac" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这里有一个例子。除了球员和人数检测，我们还可以看到预测的人数。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es mh"><img src="../Images/266f08ee4d4be1f837364ba7c69ad2ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fcqNzA9Iy6uMcEFk3uCeIA.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">号码识别示例</figcaption></figure><h1 id="7183" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">把所有的放在一起</h1><p id="4ced" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">通过连续应用这三个步骤，我们可以得到球员的实时预测，包括识别他们的球衣号码。</p><p id="dd0e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">这是一个实时预测的例子。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es mi"><img src="../Images/6811e670466c952dcda546097521cd87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*AOGvVpgTfItGF89ngPrvLw.gif"/></div><figcaption class="la lb et er es lc ld bd b be z dx translated">实时预测</figcaption></figure><h1 id="c9b2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">结束语</h1><p id="464d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在这篇文章中，我介绍了一种检测球场上的足球运动员并识别他们球衣号码的管道。我把这个任务分为3个步骤:玩家检测，号码检测和号码识别。对于每一个，都训练了一个深度学习模型，根据最终目标采用不同的架构。</p><p id="de5b" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">未来的一步将是计算球员在球场上的坐标。为了实现这一点，首先需要确定音高线。</p><p id="939e" class="pw-post-body-paragraph jd je hi jf b jg kb ji jj jk kc jm jn jo kd jq jr js ke ju jv jw kf jy jz ka hb bi translated">希望你觉得这篇文章有趣！更多足球数据科学相关工作，请访问我的repo:<a class="ae kn" href="https://github.com/danielazevedo/Football-Analytics" rel="noopener ugc nofollow" target="_blank">https://github.com/danielazevedo/Football-Analytics</a>。</p></div></div>    
</body>
</html>