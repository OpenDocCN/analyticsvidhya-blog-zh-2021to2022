<html>
<head>
<title>Scraping Twitter data using “tweepy” &amp; Twitter API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用“tweepy”和Twitter API抓取Twitter数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/scraping-twitter-data-using-tweepy-8005d7b517a3?source=collection_archive---------0-----------------------#2021-07-19">https://medium.com/analytics-vidhya/scraping-twitter-data-using-tweepy-8005d7b517a3?source=collection_archive---------0-----------------------#2021-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="a918" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在本文中，我们将收集最近150篇石溪大学Twitter帖子和查询“Nepal”的Twitter搜索结果，并将结果存储在一个数据帧中，然后存储到一个CSV文件中。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f4dbed0f779477c58462c4a001ab291d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I--qVWnLlC_A73W6XmNPZQ.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">卢克·切瑟在<a class="ae jn" href="https://unsplash.com/s/photos/twitter-posts?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="be60" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">首先，</h2><p id="ba34" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated"><strong class="ko hj">获得开发者访问权限，并记录您的令牌和密钥:</strong></p><p id="691e" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">我们需要访问Twitter API，以便从Twitter收集我们需要的数据。为此，您需要获得访问权限，这可以通过在Twitter开发者门户中创建一个应用程序来完成。好吧，既然你试图获得Twitter数据，你知道你应该有一个Twitter账户。</p><ol class=""><li id="40db" class="lk ll hi ko b kp lf ks lg jz lm kd ln kh lo le lp lq lr ls bi translated">访问<a class="ae jn" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank">开发者的Twitter网站</a>并申请一个开发者账户。申请获得批准需要几个小时到一天的时间。</li><li id="5944" class="lk ll hi ko b kp lt ks lu jz lv kd lw kh lx le lp lq lr ls bi translated">一旦获得批准，您可以按照此处的说明<a class="ae jn" href="https://developer.twitter.com/en/docs/apps/overview" rel="noopener ugc nofollow" target="_blank">在开发环境中创建应用程序，但如果您环顾四周，可以非常直观地环顾四周并点击，现在我们可以访问API了。</a></li><li id="1e4f" class="lk ll hi ko b kp lt ks lu jz lv kd lw kh lx le lp lq lr ls bi translated">为了访问API，你需要4个不同的令牌——秘密密钥，你可以在你的开发者环境中的项目和应用部分的“密钥和令牌”标签中找到。</li></ol><h2 id="5d92" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">从开发人员门户收集这些信息</h2><p id="2bc4" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">API密钥:“ABCD”</p><p id="3e1e" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">API密钥:“MNOP”</p><p id="7514" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">访问令牌:“XYZ”</p><p id="0c6f" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">访问令牌密码:“PQR”</p><p id="66f6" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">步骤1: </strong>安装&amp;导入必要的库和包</p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="ebb1" class="jo jp hi lz b fi md me l mf mg"># pip install tweepy<br/># pip install pandas</span><span id="87bf" class="jo jp hi lz b fi mh me l mf mg">import tweepy<br/>from tweepy import OAuthHandler<br/>import pandas as pd<br/>import time</span></pre><p id="27c7" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">步骤2: </strong>使用Twitter开发者应用程序中的信息并收集数据</p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="4d09" class="jo jp hi lz b fi md me l mf mg">consumer_key = "ABCD"<br/>consumer_secret = "MNOP"<br/>access_token = "XYZ"<br/>access_token_secret = "PQR"</span><span id="a73e" class="jo jp hi lz b fi mh me l mf mg">auth = tweepy.OAuthHandler(consumer_key, consumer_secret)<br/>auth.set_access_token(access_token, access_token_secret)<br/>api = tweepy.API(auth, wait_on_rate_limit=True)</span></pre><h1 id="aae9" class="mi jp hi bd jq mj mk ml ju mm mn mo jy io mp ip kc ir mq is kg iu mr iv kk ms bi translated">首先，让我们收集用户名搜索的数据</h1><p id="9a43" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">让我们为本教程收集150个帖子信息</p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="21e9" class="jo jp hi lz b fi md me l mf mg">username = 'sbu'<br/>count = 150</span></pre><p id="9f17" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">创建用于存储推文信息的数据框</p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="1f31" class="jo jp hi lz b fi md me l mf mg">df_user_tweets = pd.DataFrame()</span><span id="37b2" class="jo jp hi lz b fi mh me l mf mg">try:     <br/>    # Creation of query method using appropriate parameters<br/>    tweets =    tweepy.Cursor(api.user_timeline,id=username).items(count)<br/> <br/>    <br/>    # Pulling information from tweets iterable object and adding relevant tweet information in our data frame<br/>    for tweet in tweets:<br/>        df_user_tweets = df_user_tweets.append(<br/>                          {'Created at' : tweet._json['created_at'],<br/>                                       'User ID': tweet._json['id'],<br/>                              'User Name': tweet.user._json['name'],<br/>                                        'Text': tweet._json['text'],<br/>                     'Description': tweet.user._json['description'],<br/>                           'Location': tweet.user._json['location'],<br/>             'Followers Count': tweet.user._json['followers_count'],<br/>                 'Friends Count': tweet.user._json['friends_count'],<br/>               'Statuses Count': tweet.user._json['statuses_count'],<br/>         'Profile Image Url': tweet.user._json['profile_image_url'],<br/>                         }, ignore_index=True)<br/>except BaseException as e:<br/>    print('failed on_status,',str(e))<br/>    time.sleep(3)</span></pre><p id="4b2e" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">第三步:结果</strong></p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="4050" class="jo jp hi lz b fi md me l mf mg">df_user_tweets.shape</span><span id="ab45" class="jo jp hi lz b fi mh me l mf mg">(150, 10)</span><span id="4898" class="jo jp hi lz b fi mh me l mf mg">df_user_tweets.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl mt"><img src="../Images/ca2864cbd919c3f4d345686532bd7ff8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*MDydKQKMM82RyKzaf3ffcQ.png"/></div></figure><h1 id="a15b" class="mi jp hi bd jq mj mk ml ju mm mn mo jy io mp ip kc ir mq is kg iu mr iv kk ms bi translated">接下来，让我们在某些文本搜索上抓取推文</h1><p id="62c7" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated"><strong class="ko hj">再次，我们重复步骤2 &amp;步骤3 </strong></p><p id="cae4" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">为推文信息创建数据框</p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="8f84" class="jo jp hi lz b fi md me l mf mg">df_query_based_tweets = pd.DataFrame()</span><span id="c3b0" class="jo jp hi lz b fi mh me l mf mg">text_query = 'nepal'<br/><br/>try:<br/>    # Creation of query method using appropriate parameters<br/>    tweets = tweepy.Cursor(api.search,q=text_query).items(count)<br/><br/>    # Pulling information from tweets iterable object and adding relevant tweet information in our data frame<br/>    for tweet in tweets:<br/>        df_query_based_tweets = df_query_based_tweets.append(<br/>                          {'Created at' : tweet._json['created_at'],<br/>                                       'User ID': tweet._json['id'],<br/>                              'User Name': tweet.user._json['name'],<br/>                                        'Text': tweet._json['text'],<br/>                     'Description': tweet.user._json['description'],<br/>                           'Location': tweet.user._json['location'],<br/>             'Followers Count': tweet.user._json['followers_count'],<br/>                 'Friends Count': tweet.user._json['friends_count'],<br/>               'Statuses Count': tweet.user._json['statuses_count'],<br/>         'Profile Image Url': tweet.user._json['profile_image_url'],<br/>                         }, ignore_index=True)<br/>except BaseException as e:<br/>    print('failed on_status,',str(e))<br/>    time.sleep(3)</span></pre><p id="2a5e" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated"><strong class="ko hj">结果:</strong></p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="9e1b" class="jo jp hi lz b fi md me l mf mg">df_query_based_tweets.shape</span><span id="b843" class="jo jp hi lz b fi mh me l mf mg">(150, 10)</span><span id="735a" class="jo jp hi lz b fi mh me l mf mg">df_query_based_tweets.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="ab fe cl mt"><img src="../Images/3a35d2efd290639692b270c7fe389119.png" data-original-src="https://miro.medium.com/v2/format:webp/1*iVFzmn9tytqJ2rE-8Ps0uw.png"/></div></figure><p id="53a9" class="pw-post-body-paragraph km kn hi ko b kp lf ij kr ks lg im ku jz lh kw kx kd li kz la kh lj lc ld le hb bi translated">如果你对从Twitter API获取其他信息感兴趣，那么你可以点击查看<a class="ae jn" href="https://developer.twitter.com/en/docs/twitter-api/v1/data-dictionary/object-model/tweet" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="0da0" class="mi jp hi bd jq mj mk ml ju mm mn mo jy io mp ip kc ir mq is kg iu mr iv kk ms bi translated">将数据存储在CSV文件中</h1><p id="6707" class="pw-post-body-paragraph km kn hi ko b kp kq ij kr ks kt im ku jz kv kw kx kd ky kz la kh lb lc ld le hb bi translated">我正在以CSV格式存储用户“SBU”和查询搜索“尼泊尔”的结果的最近150条tweet数据。</p><pre class="iy iz ja jb fd ly lz ma mb aw mc bi"><span id="e9e2" class="jo jp hi lz b fi md me l mf mg">df_user_tweets.to_csv('/Users/nilsonchapagain/Desktop/Blogs/data/sbu_twitter_posts.csv', index=False)</span><span id="0cc9" class="jo jp hi lz b fi mh me l mf mg">df_query_based_tweets.to_csv('/Users/nilsonchapagain/Desktop/Blogs/data/nepal_twitter_news.csv', index=False)</span></pre><h2 id="5bd3" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">谢谢你看我的帖子。我希望你学到了一些有用的东西*🙌 🎉</h2></div></div>    
</body>
</html>