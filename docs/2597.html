<html>
<head>
<title>Setup MongoDB Replica</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置MongoDB副本</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/setup-mongodb-replica-71a9fff7c69a?source=collection_archive---------5-----------------------#2021-05-06">https://medium.com/analytics-vidhya/setup-mongodb-replica-71a9fff7c69a?source=collection_archive---------5-----------------------#2021-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/983489711bda83a895da86ec78d97e0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDF6kMmOy8JcFoxcdeRC4Q.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:<a class="ae iu" href="https://stocksnap.io/" rel="noopener ugc nofollow" target="_blank">https://stocksnap.io/</a></figcaption></figure><p id="cafb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将为现有的mongoDB或新的mongoDB设置一个副本节点。我们还将看到如何使用Python编程语言访问mongoDB副本设置。MongoDB中的副本集是一组维护相同数据集的mongod进程。副本集提供冗余和高可用性，是所有生产部署的基础。</p><p id="6a72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我们需要两个实例来托管mongoDB。一个实例将充当主实例，另一个实例将充当辅助实例。更多关于初级和次级的信息可以在<a class="ae iu" href="https://docs.mongodb.com/manual/replication/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。一旦实例准备好了，我们就可以从这里的<a class="ae iu" href="https://www.mongodb.com/try/download/community" rel="noopener ugc nofollow" target="_blank">下载mongoDB。MongoDB应该安装在这两个实例中。如果有人已经有了mongoDB，就不需要重新安装了。必须停止现有的mongoDB服务，并且必须遵循以下步骤来设置mongoDB副本。</a></p><p id="d590" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一步:</p><p id="ce85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下命令在主实例中启动mongoDB</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="991e" class="kc kd hi jy b fi ke kf l kg kh">mongod.exe --dbpath &lt;"path/to/your/db"&gt; --port &lt;port number&gt; --replSet "rs0" --bind_ip &lt;localhost / 0.0.0.0&gt;</span></pre><p id="9072" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">示例:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7a18" class="kc kd hi jy b fi ke kf l kg kh">mongod.exe --dbpath "D:\mongoData\db\data" --port 27017 --replSet "rs0" --bind_ip 0.0.0.0</span></pre><p id="6d2c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du ki kj kk jy b">--dpath</code>和<code class="du ki kj kk jy b">--port</code>是可选的，如果没有提供，将采用默认的<code class="du ki kj kk jy b">dbpath</code>和<code class="du ki kj kk jy b">port</code>。<code class="du ki kj kk jy b">--replSet</code>是“mongod所属的副本集的名称，副本集中的所有主机必须具有相同的集名称”。在我们的例子中，我们给定为<code class="du ki kj kk jy b">rs0</code>，这可以是任何名称，但是所有副本集必须使用相同的名称。<code class="du ki kj kk jy b">--bind_ip</code>是mongod应该监听客户端连接的套接字路径，要公开mongod进行远程访问，<code class="du ki kj kk jy b">bind_ip</code>必须是<code class="du ki kj kk jy b">0.0.0.0</code>。</p><p id="e16e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二步:</p><p id="c0b2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下命令在辅助实例中启动mongoDB</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="9b2b" class="kc kd hi jy b fi ke kf l kg kh">mongod.exe --dbpath &lt;"path/to/your/db"&gt; --port &lt;port number&gt; --replSet "rs0" --bind_ip &lt;localhost / 0.0.0.0&gt;</span></pre><p id="3060" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第三步:</p><p id="5406" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在主实例中打开新的命令提示符或终端，并启动<code class="du ki kj kk jy b">mongo shell</code></p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="01a2" class="kc kd hi jy b fi ke kf l kg kh">mongo.exe</span></pre><p id="951d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第四步:</p><p id="63d0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用以下命令在mongo shell中启动副本集</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7f97" class="kc kd hi jy b fi ke kf l kg kh">rs.initiate( {<br/>   _id : "rs0",<br/>   members: [<br/>      { _id: 0, host: "&lt;instance1_ipaddress&gt;:&lt;instance1_port&gt;" },<br/>      { _id: 1, host: "&lt;instance2_ipaddress&gt;:&lt;instance2_port&gt;" }<br/>   ]<br/>})</span></pre><p id="9f0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上述命令将启动复制副本。属性<code class="du ki kj kk jy b">_id: “rs0”</code>是我们在启动mongod时提供的副本集名称。通过将实例信息附加到<code class="du ki kj kk jy b">members</code>属性，可以进一步添加辅助实例。</p><p id="d106" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第五步:</p><p id="0e7c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在mongo shell中，检查副本的状态</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="d754" class="kc kd hi jy b fi ke kf l kg kh">rs.status()</span></pre><p id="0db6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这将显示有关主节点和辅助节点及其状态的信息。有时，辅助节点的状态可能是<code class="du ki kj kk jy b">"stateStr": STARTUP2</code>，这意味着从主节点到辅助节点正在进行同步。根据主数据库中现有数据的大小，这可能需要一些时间。一旦同步结束，次节点的状态将变为<code class="du ki kj kk jy b">"stateStr": SECONDARY</code>。</p><p id="39f6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们将了解如何使用Python编程语言连接到副本设置。</p><p id="2c89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">必需的包:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="2078" class="kc kd hi jy b fi ke kf l kg kh">pymongo</span></pre><p id="6f4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">语法:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="73a4" class="kc kd hi jy b fi ke kf l kg kh">pymongo.MongoClient('mongodb://&lt;username1&gt;:&lt;password1&gt;@&lt;ipaddress1&gt;:&lt;port1&gt;,&lt;username2&gt;:&lt;password2&gt;@&lt;ipaddress2&gt;:&lt;port2&gt;/?replicaSet=&lt;replicaSetName&gt;')</span></pre><p id="d036" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">示例1使用用户名和密码:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4c09" class="kc kd hi jy b fi ke kf l kg kh">pymongo.MongoClient('mongodb://jeril:abc123@201.202.203.204:27017,jeril:abc123@201.202.203.212:27017/?replicaSet=rs0')</span></pre><p id="7d8f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">没有用户名和密码的示例2:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="8828" class="kc kd hi jy b fi ke kf l kg kh">pymongo.MongoClient('mongodb://201.202.203.204:27017,201.202.203.212:27017/?replicaSet=rs0')</span></pre><p id="5fd8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">代码:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6fcb" class="kc kd hi jy b fi ke kf l kg kh">import pymongo<br/>client = <!-- -->pymongo.MongoClient('mongodb://jeril:abc123@201.202.203.204:27017,jeril:abc123@201.202.203.212:27017/?replicaSet=rs0')<br/>print(client)<br/>print()<br/>print(client.nodes)</span></pre><p id="6438" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">输出:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="adce" class="kc kd hi jy b fi ke kf l kg kh">MongoClient(host=['201.202.203.204:27017', '201.202.203.212:27017'], document_class=dict, tz_aware=False, connect=True, replicaset='rs0')</span><span id="91d8" class="kc kd hi jy b fi kl kf l kg kh">frozenset({('201.202.203.204', 27017), ('201.202.203.212', 27017)})</span></pre><p id="cdb9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">传递给MongoClient()的地址称为种子。只要至少有一个种子在线，MongoClient就会发现副本集中的所有成员，并确定哪个是当前的主节点，哪个是辅助节点或仲裁节点。</p><p id="1531" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编码快乐！！！</p><p id="894c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">参考资料:</p><ol class=""><li id="053f" class="km kn hi ix b iy iz jc jd jg ko jk kp jo kq js kr ks kt ku bi translated"><a class="ae iu" href="https://docs.mongodb.com/manual/replication/" rel="noopener ugc nofollow" target="_blank"> MongoDB文档</a></li></ol><p id="eb72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.<a class="ae iu" href="https://stackoverflow.com/a/42530573/2825570" rel="noopener ugc nofollow" target="_blank"> Stackoverflow </a></p><p id="3084" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<a class="ae iu" href="https://pymongo.readthedocs.io/en/stable/examples/high_availability.html#id1" rel="noopener ugc nofollow" target="_blank"> PyMongo文档</a></p></div></div>    
</body>
</html>