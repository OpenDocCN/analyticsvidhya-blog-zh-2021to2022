<html>
<head>
<title>Celebrity Face Recognition using KNN from Scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零开始使用KNN的名人人脸识别</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/celebrity-face-recognition-using-knn-from-scratch-76287bdab088?source=collection_archive---------10-----------------------#2021-01-11">https://medium.com/analytics-vidhya/celebrity-face-recognition-using-knn-from-scratch-76287bdab088?source=collection_archive---------10-----------------------#2021-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e3f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你能从下图中找出你最喜欢的名人吗？当然可以！计算机是如何完成同样的任务的？让我们在接下来的几分钟内训练一个模型来识别名人的面孔！</p><blockquote class="je jf jg"><p id="7f8c" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">关于KNN的更多信息，请参考我以前的博客— <a class="ae jk" href="https://tp6145.medium.com/a-beginners-guide-to-knn-and-mnist-handwritten-digits-recognition-using-knn-from-scratch-df6fb982748a" rel="noopener"> <strong class="ih hj">从头开始使用KNN的KNN和MNIST手写数字识别初学者指南</strong> </a></p><p id="5168" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">我们将使用相同的算法来完成这项工作！</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/c56319818c86899efc2dbe789909944b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CrhmI_ShEOkdiqlp.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">图片来源:Kaggle — Pins人脸识别</figcaption></figure><p id="a922" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">你可以在这里找到数据集</em><a class="ae jk" href="https://www.kaggle.com/hereisburak/pins-face-recognition/activity" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="jd"/></strong></a><em class="jd">——这是一个最初从Pinterest获得的精心策划的数据集——被裁剪并贴上标签！总共有</em> <strong class="ih hj"> <em class="jd"> 105位名人</em></strong><em class="jd"/><strong class="ih hj"><em class="jd">17534张面孔</em> </strong> <em class="jd">从</em> <strong class="ih hj"> <em class="jd">阿德里亚娜·利马</em> </strong> <em class="jd">到</em> <strong class="ih hj"> <em class="jd">【汤姆·伊莱斯</em> </strong> <em class="jd">还有所有人都在中间！</em></p><p id="9505" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">通过Kaggle临时令牌导入Kaggle数据集(在Google Colab上):</em></p><blockquote class="je jf jg"><p id="9886" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">更多关于Google Colab — <a class="ae jk" rel="noopener" href="/analytics-vidhya/a-beginners-guide-for-getting-started-with-machine-learning-7ba2cd5796ae"> <strong class="ih hj">机器学习入门指南</strong> </a></p></blockquote><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="7c2f" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">from</strong> <strong class="kc hj">google.colab</strong> <strong class="kc hj">import</strong> files <br/><em class="jd">"""upload your Kaggle temporary token downloaded from your Kaggle account onto your local device"""<br/></em>files.upload() </span><span id="d07c" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>Saving kaggle.json to kaggle.json<br/>{'kaggle.json': b'{"username":"xxx","key":"yyy"}'}</span></pre><p id="2b8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">下载您的数据集:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="935f" class="kg kh hi kc b fi ki kj l kk kl">!mkdir -p ~/.kaggle<br/>!cp kaggle.json ~/.kaggle/<br/>!chmod 600 ~/.kaggle/kaggle.json</span><span id="2742" class="kg kh hi kc b fi km kj l kk kl">!kaggle datasets download -d hereisburak/pins-face-recognition</span><span id="fe83" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>Downloading pins-face-recognition.zip to /content<br/> 97% 361M/372M [00:13&lt;00:00, 20.9MB/s]<br/>100% 372M/372M [00:14&lt;00:00, 27.8MB/s]</span></pre><p id="559e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">检查您的文件是否已下载:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="82df" class="kg kh hi kc b fi ki kj l kk kl">!ls</span><span id="2bc7" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>kaggle.json   pins-face-recognition.zip   sample_data</span></pre><p id="2c96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">解压你的文件:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="8965" class="kg kh hi kc b fi ki kj l kk kl">!unzip "pins-face-recognition.zip" -d /tmp</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kn"><img src="../Images/abc0e350b4dacf3a0d77d56866613651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dyf2_bZeG6w3chONI_K8qg.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">………</figcaption></figure><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ko"><img src="../Images/65647484e60b350738cb62e736bfda03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*JpEWHOjtLbNA1ncGuZKq5Q.png"/></div></div></figure><p id="258b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">检查每个目录下的文件数量:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="09d3" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">import</strong> <strong class="kc hj">os</strong><br/>print(len(os.listdir('/tmp')))<br/>print(len(os.listdir('/tmp/105_classes_pins_dataset/')))<br/>print(len(os.listdir('/tmp/105_classes_pins_dataset/pins_tom ellis/')))<br/>print(len(os.listdir('/tmp/105_classes_pins_dataset/pins_margot robbie/')))</span><span id="5b20" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>1<br/>105<br/>180<br/>221</span></pre><p id="475e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">让我们随机拍摄一系列图像，并打印出它们的形状:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="a46a" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">import</strong> <strong class="kc hj">cv2</strong><br/>a = 60<br/>b = 3241<br/><strong class="kc hj">for</strong> i <strong class="kc hj">in</strong> range(8):<br/>  im = cv2.imread('/tmp/105_classes_pins_dataset/pins_margot robbie/<br/>  margot robbie'+str(a+i)+'_'+str(b+i)+'.jpg')<br/>  print(im.shape)</span><span id="dc41" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>(320, 302, 3)<br/>(221, 209, 3)<br/>(225, 209, 3)<br/>(221, 209, 3)<br/>(387, 365, 3)<br/>(266, 251, 3)<br/>(225, 209, 3)<br/>(185, 175, 3)</span></pre><blockquote class="je jf jg"><p id="5653" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">它们都有不同的维度:(</p></blockquote><p id="15bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">让我们试着在</em> <strong class="ih hj"> <em class="jd">玛格特·罗比</em> </strong> <em class="jd">的目录下绘制一系列照片:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="2794" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">from</strong> <strong class="kc hj">matplotlib</strong> <strong class="kc hj">import</strong> pyplot <br/><strong class="kc hj">from</strong> <strong class="kc hj">matplotlib.image</strong> <strong class="kc hj">import</strong> imread <br/>folder = '/tmp/105_classes_pins_dataset/pins_margot robbie/' <br/><strong class="kc hj">for</strong> i <strong class="kc hj">in</strong> range(8):  <br/>    pyplot.subplot(330 + 1 + i)  <br/>    filename = folder+'margot robbie'+str(a+i)+'_'+str(b+i)+'.jpg'  <br/>    image = imread(filename)  <br/>    pyplot.imshow(image) <br/>pyplot.show()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kp"><img src="../Images/338de5ef9519564ba349ae781962f97e.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*-WH-n1aLxVcH6DQKHpc1vg.png"/></div></figure><p id="265d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">让我们试着用</em> <strong class="ih hj"> <em class="jd">埃隆马斯克</em> </strong> <em class="jd">做同样的事情吧，他的目录又名《2020年1月世界首富</em><strong class="ih hj"><em class="jd"/></strong><em class="jd">！</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="7b88" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">from</strong> <strong class="kc hj">matplotlib</strong> <strong class="kc hj">import</strong> pyplot <br/><strong class="kc hj">from</strong> <strong class="kc hj">matplotlib.image</strong> <strong class="kc hj">import</strong> imread <br/>folder = '/tmp/105_classes_pins_dataset/pins_elon musk/' <br/>a = 191 <br/>b = 1575 <br/><strong class="kc hj">for</strong> i <strong class="kc hj">in</strong> range(7):  <br/>    pyplot.subplot(330 + 1 + i)  <br/>    filename = folder+'elon musk'+str(a+i)+'_'+str(b+i)+'.jpg'  <br/>    image = imread(filename)  <br/>    pyplot.imshow(image) <br/>pyplot.show()</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kq"><img src="../Images/f42b53497ecc155e578152d75538e0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*hQj-Tat_m1EbCx8S7lKskw.png"/></div></figure><blockquote class="je jf jg"><p id="4b0d" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">啊！那个十亿美金的微笑:))</p></blockquote><p id="02e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我们需要的几个库:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="3d48" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">import</strong> <strong class="kc hj">numpy</strong> <strong class="kc hj">as</strong> <strong class="kc hj">np<br/>from</strong> <strong class="kc hj">PIL</strong> <strong class="kc hj">import</strong> Image<br/><strong class="kc hj">import</strong> <strong class="kc hj">operator</strong><br/><strong class="kc hj">from</strong> <strong class="kc hj">operator</strong> <strong class="kc hj">import</strong> itemgetter</span></pre><p id="4bdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">让我们试着调整一张图片的大小——比如泰勒·斯威夫特的(128*128*3) </em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="d2fa" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">from</strong> <strong class="kc hj">PIL</strong> <strong class="kc hj">import</strong> Image <br/>img = Image.open('/tmp/105_classes_pins_dataset/pins_Taylor Swift/Taylor Swift4_4643.jpg') <br/>img = img.resize((128,128)) <br/>img</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kr"><img src="../Images/5198d94b231a838f82406298b08ffe5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:324/format:webp/1*eE2RuZJYHhimgynw79pOwQ.png"/></div></figure><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="b27e" class="kg kh hi kc b fi ki kj l kk kl">np.asarray(img)<em class="jd"> #display the pixel array</em></span><span id="cc10" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>array([[[187, 191, 202],<br/>        [187, 191, 202],<br/>        [187, 191, 202],<br/>        ...,<br/>        [ 94,  85,  78],<br/>        [104,  95,  87],<br/>        [ 98,  89,  80]],<br/><br/>       [[187, 191, 202],<br/>        [188, 192, 203],<br/>        [188, 192, 203],<br/>        ...,<br/>        [ 82,  72,  66],<br/>        [ 95,  84,  77],<br/>        [ 92,  82,  73]],<br/><br/>       [[187, 191, 202],<br/>        [187, 191, 202],<br/>        [187, 191, 202],<br/>        ...,<br/>        [107,  96,  91],<br/>        [105,  94,  87],<br/>        [100,  90,  81]],<br/><br/>       ...,<br/><br/>       [[244, 143, 171],<br/>        [243, 143, 171],<br/>        [242, 145, 172],<br/>        ...,<br/>        [186, 135, 105],<br/>        [190, 137, 109],<br/>        [193, 138, 111]],<br/><br/>       [[236, 144, 169],<br/>        [234, 144, 169],<br/>        [234, 149, 172],<br/>        ...,<br/>        [187, 147, 117],<br/>        [191, 148, 121],<br/>        [184, 140, 114]],<br/><br/>       [[232, 142, 167],<br/>        [230, 143, 167],<br/>        [232, 150, 172],<br/>        ...,<br/>        [170, 137, 107],<br/>        [152, 116,  89],<br/>        [143, 104,  78]]], dtype=uint8)</span></pre><p id="8ce2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">现在，让我们检查调整后的图像的宽度和高度:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="afce" class="kg kh hi kc b fi ki kj l kk kl">width, height = img.size<br/>print(width, height)</span><span id="2a29" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>128 128</span></pre><p id="41b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">现在，棘手的部分来了:让我们一个目录接一个目录地迭代，然后迭代该目录中的每张图片——动态地将它们的大小调整为(128*128 ),并将每张图片的像素数组附加到X，将其对应的名人标签附加到y——跟踪我们的计数:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="77ee" class="kg kh hi kc b fi ki kj l kk kl">X = []<br/>y = []<br/>count = 0<br/>dir="/tmp/105_classes_pins_dataset/"<br/><strong class="kc hj">for</strong> i <strong class="kc hj">in</strong> os.listdir(dir):<br/>    print(i,":",len(os.listdir(dir+"/"+i)))<br/>    count+=len(os.listdir(dir+"/"+i))<br/>    <strong class="kc hj">for</strong> j <strong class="kc hj">in</strong> os.listdir(dir+"/"+i):<br/>        img = Image.open(dir+"/"+i+"/"+j)<br/>        img = img.resize((128,128))<br/>        X.append(np.asarray(img))<br/>        y.append(i)<br/>print(count)<br/>X = np.asarray(X)<br/>y = np.asarray(y)<br/>print(X.shape, y.shape)</span><span id="b195" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>pins_ellen page : 188<br/>pins_Avril Lavigne : 162<br/>pins_Marie Avgeropoulos : 161<br/>pins_Rebecca Ferguson : 178<br/>pins_Robert De Niro : 156<br/>pins_Emilia Clarke : 210<br/>pins_Dwayne Johnson : 141<br/>pins_Josh Radnor : 117<br/>pins_Ben Affleck : 126<br/>pins_Zoe Saldana : 186<br/>pins_camila mendes : 162<br/>pins_Morgan Freeman : 105<br/>pins_Alvaro Morte : 139<br/>pins_Pedro Alonso : 125<br/>pins_Taylor Swift : 131<br/>pins_Natalie Dormer : 198<br/>pins_Andy Samberg : 196<br/>pins_grant gustin : 183<br/>pins_Brie Larson : 169<br/>pins_Lindsey Morgan : 169<br/>pins_Lionel Messi : 86<br/>pins_kiernen shipka : 203<br/>pins_Mark Ruffalo : 178<br/>pins_Gwyneth Paltrow : 187<br/>pins_tom ellis : 180<br/>pins_Tuppence Middleton : 133<br/>pins_Tom Hardy : 198<br/>pins_Wentworth Miller : 179<br/>pins_Amanda Crew : 117<br/>pins_Nadia Hilker : 133<br/>pins_Jason Momoa : 184<br/>pins_Megan Fox : 209<br/>pins_Rami Malek : 160<br/>pins_Zendaya : 138<br/>pins_Stephen Amell : 159<br/>pins_Elizabeth Lail : 158<br/>pins_gal gadot : 199<br/>pins_margot robbie : 221<br/>pins_Dominic Purcell : 146<br/>pins_Leonardo DiCaprio : 237<br/>pins_Tom Holland : 189<br/>pins_Jessica Barden : 141<br/>pins_Penn Badgley : 171<br/>pins_Sarah Wayne Callies : 159<br/>pins_Bill Gates : 122<br/>pins_Johnny Depp : 182<br/>pins_Jimmy Fallon : 113<br/>pins_Chris Evans : 166<br/>pins_Jennifer Lawrence : 180<br/>pins_Richard Harmon : 148<br/>pins_scarlett johansson : 201<br/>pins_Brenton Thwaites : 209<br/>pins_elizabeth olsen : 221<br/>pins_elon musk : 135<br/>pins_Irina Shayk : 156<br/>pins_Henry Cavil : 195<br/>pins_Inbar Lavi : 127<br/>pins_Sophie Turner : 204<br/>pins_Shakira Isabel Mebarak : 154<br/>pins_Jeremy Renner : 167<br/>pins_barack obama : 119<br/>pins_Chris Pratt : 176<br/>pins_amber heard : 218<br/>pins_Madelaine Petsch : 192<br/>pins_Lili Reinhart : 150<br/>pins_Ursula Corbero : 167<br/>pins_Alex Lawther : 152<br/>pins_Zac Efron : 191<br/>pins_Selena Gomez : 186<br/>pins_alycia dabnem carey : 211<br/>pins_Morena Baccarin : 175<br/>pins_Danielle Panabaker : 181<br/>pins_Emma Watson : 211<br/>pins_Katharine Mcphee : 177<br/>pins_Logan Lerman : 212<br/>pins_Anne Hathaway : 203<br/>pins_Rihanna : 133<br/>pins_jeff bezos : 106<br/>pins_Jake Mcdorman : 159<br/>pins_Mark Zuckerberg : 95<br/>pins_Adriana Lima : 213<br/>pins_Brian J. Smith : 102<br/>pins_barbara palvin : 197<br/>pins_Robert Downey Jr : 233<br/>pins_Emma Stone : 139<br/>pins_Tom Cruise : 192<br/>pins_Eliza Taylor : 162<br/>pins_Cristiano Ronaldo : 98<br/>pins_Maisie Williams : 193<br/>pins_Miley Cyrus : 178<br/>pins_Millie Bobby Brown : 191<br/>pins_Alexandra Daddario : 225<br/>pins_Christian Bale : 154<br/>pins_melissa fumero : 154<br/>pins_Natalie Portman : 166<br/>pins_Neil Patrick Harris : 116<br/>pins_Anthony Mackie : 124<br/>pins_Bobby Morley : 138<br/>pins_Krysten Ritter : 171<br/>pins_Hugh Jackman : 179<br/>pins_Katherine Langford : 226<br/>pins_Chris Hemsworth : 159<br/>pins_Tom Hiddleston : 181<br/>pins_Maria Pedraza : 122<br/>pins_Keanu Reeves : 160<br/>17534<br/>(17534, 128, 128, 3) (17534,)</span></pre><blockquote class="je jf jg"><p id="b2d8" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>这里可以做的改进——你可以将这些图像转换为<strong class="ih hj">灰度</strong>并调整大小——处理灰度图像的计算成本会更低，同时考虑到颜色在这里的意义更小。</p></blockquote><p id="0a42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">重塑</em> <strong class="ih hj"> <em class="jd"> X (17534，128，128，3) </em> </strong> <em class="jd">到</em> <strong class="ih hj"> <em class="jd"> (17534，128*128*3) </em> </strong> <em class="jd"> : </em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="37fc" class="kg kh hi kc b fi ki kj l kk kl">X = X.reshape(17534, 49152).astype('float32')</span></pre><p id="6d9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">归一化0到1之间的像素:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="ee8a" class="kg kh hi kc b fi ki kj l kk kl">X/=255<br/>X.shape</span><span id="9b5b" class="kg kh hi kc b fi km kj l kk kl"><strong class="kc hj">Out:<br/></strong>(17534, 49152)</span></pre><h1 id="d9ca" class="ks kh hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">从头开始实施</h1><p id="a84f" class="pw-post-body-paragraph if ig hi ih b ii lp ik il im lq io ip iq lr is it iu ls iw ix iy lt ja jb jc hb bi translated"><em class="jd">让我们先定义一个函数，它返回两点之间的</em> <a class="ae jk" href="https://en.wikipedia.org/wiki/Euclidean_distance" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jd">欧氏距离</em></strong></a><em class="jd">:</em></p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es lu"><img src="../Images/758018d79705d05644dd7afb51f40ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GQ5SKkIjnCjeJzH1.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">图片来源:Science Direct——欧几里德距离公式</figcaption></figure><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="8680" class="kg kh hi kc b fi ki kj l kk kl">def euc_dist(x1, x2):<br/>    return np.sqrt(np.sum((x1-x2)**2))</span></pre><blockquote class="je jf jg"><p id="3534" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>可以做的改进——可以使用曼哈顿距离代替欧几里德距离，因为求平方是一种开销很大的操作，尤其是在处理像这样的高维像素阵列时！—参考:<a class="ae jk" href="https://tp6145.medium.com/a-beginners-guide-to-knn-and-mnist-handwritten-digits-recognition-using-knn-from-scratch-df6fb982748a" rel="noopener"> <strong class="ih hj">从头开始使用KNN进行KNN和MNIST手写数字识别的入门指南</strong> </a></p></blockquote><p id="a2da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">现在，让我们写一个类‘KNN’并为</em><strong class="ih hj"><em class="jd">‘K’值:</em> </strong>初始化一个实例</p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="ee23" class="kg kh hi kc b fi ki kj l kk kl">class KNN:<br/>    def __init__(self, K=3):<br/>        self.K = K</span></pre><p id="faa5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">让我们添加另一个函数到我们的类中，该函数初始化实例以适应我们的训练集——X-train和y-train: </em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="c99b" class="kg kh hi kc b fi ki kj l kk kl">class KNN:<br/>    def __init__(self, K=3):<br/>        self.K = K<br/>    def fit(self, x_train, y_train):<br/>        self.X_train = x_train<br/>        self.Y_train = y_train</span></pre><p id="29b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">现在让我们将预测函数添加到这个类中:</em></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="bc81" class="kg kh hi kc b fi ki kj l kk kl">def predict(self, X_test):<br/>    predictions = [] <em class="jd"><br/>    </em>for i in range(len(X_test)):<br/>        dist = np.array([euc_dist(X_test[i], x_t) for x_t in   <br/>        self.X_train])<br/>        dist_sorted = dist.argsort()[:self.K]<br/>        neigh_count = {}<br/>        for idx in dist_sorted:<br/>            if self.Y_train[idx] in neigh_count:<br/>                neigh_count[self.Y_train[idx]] += 1<br/>            else:<br/>                neigh_count[self.Y_train[idx]] = 1<br/>        sorted_neigh_count = sorted(neigh_count.items(),    <br/>        key=operator.itemgetter(1), reverse=True)<br/>        predictions.append(sorted_neigh_count[0][0]) <br/>    return predictions</span></pre><blockquote class="je jf jg"><p id="fbda" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">哇哦。代码太多了！让我们一行一行地理解这个—</p></blockquote><p id="81a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经初始化了一个列表来存储我们的预测，然后运行一个循环来计算每个测试示例到每个对应的训练示例的欧几里德距离，并将所有这些距离存储在一个NumPy数组中，之后我们返回了距离的前K个排序值的索引，然后我们创建了一个字典，将我们的类标签作为键，将它们的出现次数作为每个键的值。</p><p id="1e99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们将每个计数附加到每个键-值对的neigh_count字典中，之后，我们从最常出现的值到最少出现的值对我们的键-值对进行排序，其中，我们最常出现的值将是我们对每个训练示例的预测。然后我们返回预测。</p><p id="e50e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">最终代码— </em> </strong></p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="75b9" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">def</strong> euc_dist(x1, x2):<br/>        <strong class="kc hj">return</strong> np.sqrt(np.sum((x1-x2)**2))<br/><strong class="kc hj">class</strong> <strong class="kc hj">KNN</strong>:<br/>    <strong class="kc hj">def</strong> __init__(self, K=3):<br/>        self.K = K<br/>    <strong class="kc hj">def</strong> fit(self, x_train, y_train):<br/>        self.X_train = x_train<br/>        self.Y_train = y_train<br/>    <strong class="kc hj">def</strong> predict(self, X_test):<br/>        predictions = []<br/>        count = 0<br/>        <strong class="kc hj">for</strong> i <strong class="kc hj">in</strong> range(len(X_test)):   <br/>            count = count + 1         <br/>            dist = np.array([euc_dist(X_test[i], x_t) <strong class="kc hj">for</strong> x_t <strong class="kc hj">in</strong> self.X_train])<br/>            dist_sorted = dist.argsort()[:self.K]<br/>            neigh_count = {}<br/>            <strong class="kc hj">for</strong> idx <strong class="kc hj">in</strong> dist_sorted:<br/>                <strong class="kc hj">if</strong> self.Y_train[idx] <strong class="kc hj">in</strong> neigh_count:<br/>                    neigh_count[self.Y_train[idx]] += 1<br/>                <strong class="kc hj">else</strong>:<br/>                    neigh_count[self.Y_train[idx]] = 1       <br/>            sorted_neigh_count = sorted(neigh_count.items(), key=operator.itemgetter(1), reverse=<strong class="kc hj">True</strong>)<br/>            print(str(count)+' '+str(sorted_neigh_count[0][0]))<br/>            predictions.append(sorted_neigh_count[0][0])<br/>        <strong class="kc hj">return</strong> predictions</span></pre><blockquote class="je jf jg"><p id="fb1c" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">这就是KNN的全部实现，现在让我们在处理过的数据集上测试我们的模型！</p></blockquote><p id="808e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另外，如果你正在使用Google Colab——切换到GPU运行时，这样事情会变得更快！</p><pre class="jm jn jo jp fd kb kc kd ke aw kf bi"><span id="ba1d" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">from</strong> <strong class="kc hj">sklearn.metrics</strong> <strong class="kc hj">import</strong> accuracy_score<br/>model = KNN(K = k) <em class="jd">#experiment with different k values</em><br/>model.fit(X_test, y_test)<br/>pred = model.predict(X_test)<br/><em class="jd">""" You can now test your model on different classification metrics! Good Luck!"""</em></span></pre><blockquote class="je jf jg"><p id="503c" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">我知道一下子很难接受。但是你坚持到了最后！恭喜你。不要忘记看看我即将发表的文章！</p><p id="c7cc" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">关于这方面的更多信息，请查看我之前的博客<a class="ae jk" href="https://tp6145.medium.com/a-beginners-guide-to-knn-and-mnist-handwritten-digits-recognition-using-knn-from-scratch-df6fb982748a" rel="noopener"> <strong class="ih hj">这里</strong> </a> <strong class="ih hj">！</strong></p></blockquote><p id="442f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">要获得完整的代码，请查看我的GitHub库— </em> </strong></p><div class="lv lw ez fb lx ly"><a href="https://github.com/tanvipenumudy/Winter-Internship-Internity/blob/main/Day%2008/Day-8%20Notebook-2%20%28Face%20Detection%20using%20KNN%29.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hj fi z dy md ea eb me ed ef hh bi translated">tanvipenumudy/Winter-实习-实习</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">存储库跟踪每天分配的工作-tanvipenumudy/Winter-实习-实习</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">github.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm jv ly"/></div></div></a></div><blockquote class="je jf jg"><p id="482d" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">如果你喜欢这篇文章，不要忘了鼓掌并跟随:</strong></p></blockquote></div></div>    
</body>
</html>