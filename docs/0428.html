<html>
<head>
<title>Exploring Website’s API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索网站的API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/exploring-the-api-of-a-website-8579b04df28f?source=collection_archive---------9-----------------------#2021-01-16">https://medium.com/analytics-vidhya/exploring-the-api-of-a-website-8579b04df28f?source=collection_archive---------9-----------------------#2021-01-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e652" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，由于Javascript框架如<a class="ae jd" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>越来越受欢迎，许多网站通过从后端加载JSON或XML来呈现动态内容，这意味着越来越少的网站在<em class="je">服务器端</em>生成，而是在<em class="je">客户端</em>呈现。</p><p id="d0fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本帖中，我们将通过使用一些Python代码直接访问他们的API来探索<a class="ae jd" href="https://wolt.com/" rel="noopener ugc nofollow" target="_blank"> Wolt的网站</a>。</p><p id="a0d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Wolt是一个食品配送平台。它允许人们从他们的餐馆伙伴那里找到食物，要么自己取，要么让他们的送货伙伴送货上门。</p><p id="ebab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用Chrome DevTools来监控Wolt网站向其服务器发出的所有网络请求，看看我们如何使用自己的代码发出同样的请求。我们将从服务器检索的数据将包括附近餐馆的信息，如评级、描述、地址、送货价格等。</p><p id="8792" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将使用:</p><ol class=""><li id="a281" class="jf jg hi ih b ii ij im in iq jh iu ji iy jj jc jk jl jm jn bi translated">计算机编程语言</li><li id="4a96" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated"><a class="ae jd" href="https://requests.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank">请求</a></li><li id="894c" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated"><a class="ae jd" href="https://developers.google.com/web/tools/chrome-devtools" rel="noopener ugc nofollow" target="_blank"> Chrome开发工具</a></li></ol><h1 id="81db" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">清注意</h1><p id="cec8" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">任何时候你加载一个网页，你都是在向服务器发出请求。当你只是一个拥有浏览器的人时，你可能不会造成太大的伤害。然而，当编写访问服务器的代码时，您可以在一秒钟内发送数千个请求。这会让网站所有者损失一大笔钱，甚至关闭他们的网站。</p><p id="e86f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住这一点——您需要非常小心地使用代码，并限制发送到服务器的请求数量，以避免造成任何损害。</p><h1 id="af23" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">我们开始吧</h1><p id="283c" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">首先，让我们进入Wolt的网站，进入<a class="ae jd" href="https://wolt.com/en/delivers-to-me" rel="noopener ugc nofollow" target="_blank">送货页面</a>(因为我们想找到附近餐馆的信息)并点击添加地址。</p><p id="1baf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们试着判断一下搜索附近餐馆时服务器的响应。打开Chrome DevTools，右击页面上的任意位置，点击Inspect，转到Network选项卡，然后按下XHR。我们现在应该有这样的东西:</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/7141547ee2241f61707739117fe52218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_8nvp-PW8bVLC7n-"/></div></div></figure><p id="efdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在搜索框中，我们输入一个街道名称，例如<em class="je"> Allenby </em>，然后单击搜索。我们现在应该会看到一些与我们的搜索查询相匹配的结果。让我们选择一个在<em class="je">以色列特拉维夫亚佛</em>的。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es li"><img src="../Images/6c039db3eeacf0b752495ddeb0970940.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*V2uRvEuhI3JdTzUN"/></div></figure><p id="cebb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在可以看到Chrome DevTools中的Network选项卡填充了3个新的XHR请求。注意，可能会有3个以上的请求，这需要一些试验和错误，以找到我们到底在寻找什么。</p><p id="9c45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">XHR将包含关于浏览器对服务器的请求的信息，比如请求URL(本例中是API的端点)、请求方法(GET、POST等)。)、头和参数。它还将包含服务器对该特定请求的响应。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/fe7172a355e589998077546985f7cfc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0H11OggNl1qrzySb"/></div></div></figure><p id="bc8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们点击第一个请求，然后点击Chrome DevTools左侧的预览选项卡。这将向我们展示服务器的响应是什么样子的。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lj"><img src="../Images/f890361dbd7adae09df9c9c799320a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JcAXXvsncQioEdPY"/></div></div></figure><p id="f731" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到服务器返回了一个JSON响应，其中包含一个包含艾伦比街的城市列表。但是等等——这是响应，请求呢？为了理解网站发送给服务器的请求是什么以及它看起来像什么，我们将使用<a class="ae jd" href="https://curl.trillworks.com/" rel="noopener ugc nofollow" target="_blank">curl.trillworks.com</a>，这将允许我们轻松地将<a class="ae jd" href="https://en.wikipedia.org/wiki/CURL" rel="noopener ugc nofollow" target="_blank"> cURL </a>转换成Python脚本。</p><p id="22bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们右键单击第一个请求，然后单击Copy &gt; Copy as cURL，并将其粘贴到Trillworks的工具上。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es lk"><img src="../Images/3e1526316b1aabc6626aaef2863ef2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/0*u3WxK7LJhulZjlHE"/></div></figure><p id="f5ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">稍微清理一下代码后，我们得到了类似这样的东西:</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="bd76" class="lq ju hi lm b fi lr ls l lt lu">import requests</span><span id="787a" class="lq ju hi lm b fi lv ls l lt lu">URL = 'https://restaurant api.wolt.com/v1/google/places/autocomplete/json'</span><span id="f6de" class="lq ju hi lm b fi lv ls l lt lu">headers = {<br/>    'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.68 Safari/537.36'<br/>}</span><span id="0e19" class="lq ju hi lm b fi lv ls l lt lu">params = [{'input': 'Allenby'}]</span><span id="3b87" class="lq ju hi lm b fi lv ls l lt lu">response = requests.get(URL, <br/>                        headers=headers,<br/>                        params=params)<br/>print(response.text)</span></pre><p id="722c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们为请求设置头，请求包括一个带有所需头的字典。User-Agent头让服务器“认为”我们正试图从一个实际的浏览器(在这种情况下是Mac上的Chrome)访问它。当它不存在时，服务器可能会认为自动请求是由机器人发出的，并可能返回错误的响应。</p><p id="e56b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们设置参数，这些参数基本上就是我们发送给服务器的查询(还记得我们在搜索框中输入‘Allenby’吗？).</p><p id="9694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们使用requests.get()函数向服务器发送一个GET请求，其中包含API的端点、头和我们设置的参数。</p><p id="6521" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码基本上将模拟网站发送给服务器的相同请求，并允许我们得到网站正在接收的相同响应。</p><p id="63b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据我们得到的响应，我们将从服务器返回的城市列表中选择第一个项目，它看起来像这样:</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="cb3e" class="lq ju hi lm b fi lr ls l lt lu">{'description': 'Allenby Street, Tel Aviv-Yafo, Israel',<br/>                  'matched_substrings': [{'length': 7, 'offset': 0}],<br/>                  'place_id': 'EiVBbGxlbmJ5IFN0cmVldCwgVGVsIEF2aXYtWWFmbywgSXNyYWVsIi4qLAoUChIJx0FPdoNMHRURoQbkZoqtGc8SFAoSCR98OxmmTB0VEZA_lsCicvvB',<br/>                  'reference': 'EiVBbGxlbmJ5IFN0cmVldCwgVGVsIEF2aXYtWWFmbywgSXNyYWVsIi4qLAoUChIJx0FPdoNMHRURoQbkZoqtGc8SFAoSCR98OxmmTB0VEZA_lsCicvvB',<br/>                  'structured_formatting': {'main_text': 'Allenby Street',<br/>                                            'main_text_matched_substrings': [{'length': 7,<br/>                                                                              'offset': 0}],<br/>                                            'secondary_text': 'Tel Aviv-Yafo, '<br/>                                                              'Israel'},<br/>                  'terms': [{'offset': 0, 'value': 'Allenby Street'},<br/>                            {'offset': 16, 'value': 'Tel Aviv-Yafo'},<br/>                            {'offset': 31, 'value': 'Israel'}]<br/>                  'types': ['route', 'geocode']}</span></pre><p id="db52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上，它没有告诉我们太多。我们可以看到Allenby street有一个名为“place_id”的属性以及一些更相关的属性。</p><p id="9b96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们检查对服务器的第二个请求。</p><p id="b27e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和以前一样，我们复制了请求的cURL，并将其粘贴到TrillWorks的工具上，现在我们有了类似这样的东西:</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="37c7" class="lq ju hi lm b fi lr ls l lt lu">import requests</span><span id="6ded" class="lq ju hi lm b fi lv ls l lt lu">URL = 'https://restaurant-api.wolt.com/v1/google/geocode/json'</span><span id="b632" class="lq ju hi lm b fi lv ls l lt lu">headers = {<br/>    'user-agent': <br/>    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.68 Safari/537.36',<br/>}</span><span id="c0d5" class="lq ju hi lm b fi lv ls l lt lu">params = [<br/>    {'place_id':<br/>  'EiVBbGxlbmJ5IFN0cmVldCwgVGVsIEF2aXYtWWFmbywgSXNyYWVsIi4qLAoUChIJx0FPdoNMHRURoQbkZoqtGc8SFAoSCR98OxmmTB0VEZA_lsCicvvB'<br/>}<br/>]</span><span id="9e0e" class="lq ju hi lm b fi lv ls l lt lu">response = requests.get(URL, headers=headers, params=params)</span><span id="7502" class="lq ju hi lm b fi lv ls l lt lu">print(response.text)</span></pre><p id="2c8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，现在，该网站正在向服务器发送另一个GET请求，该请求具有我们从第一个请求中收到的相同的“place_id”属性。响应看起来是这样的:</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="0c28" class="lq ju hi lm b fi lr ls l lt lu">"results": [<br/>    {<br/>        "address_components": [<br/>            {<br/>                "long_name": "Allenby Street",<br/>                "short_name": "Allenby St",<br/>                "types": ["route"]<br/>            },<br/>            {<br/>                "long_name": "Tel Aviv-Yafo",<br/>                "short_name": "Tel Aviv-Yafo",<br/>                "types": ["locality", "political"]<br/>            },<br/>            {<br/>                "long_name": "Tel Aviv District",<br/>                "short_name": "Tel Aviv District",<br/>                "types": ["administrative_area_level_1", "political"]<br/>            },<br/>            {<br/>                "long_name": "Israel",<br/>                "short_name": "IL",<br/>                "types": ["country", "political"]<br/>            }<br/>        ],<br/>        "formatted_address": "Allenby St, Tel Aviv-Yafo, Israel",<br/>        "geometry": {<br/>            "bounds": {<br/>                "northeast": {<br/>                    "lat": 32.07381530000002,<br/>                    "lng": 34.7739591<br/>                },<br/>                "southwest": {<br/>                    "lat": 32.06058009999997,<br/>                    "lng": 34.7650244<br/>                }<br/>            },<br/>            "location": {<br/>                "lat": 32.0676462,<br/>                "lng": 34.7712005<br/>            },<br/>            "location_type": "GEOMETRIC_CENTER",<br/>            "viewport": {<br/>                "northeast": {<br/>                    "lat": 32.07381530000002,<br/>                    "lng": 34.7739591<br/>                },<br/>                "southwest": {<br/>                    "lat": 32.06058009999997,<br/>                    "lng": 34.7650244<br/>                }<br/>            }<br/>        },<br/>        "place_id": "EiVBbGxlbmJ5IFN0cmVldCwgVGVsIEF2aXYtWWFmbywgSXNyYWVsIi4qLAoUChIJx0FPdoNMHRURoQbkZoqtGc8SFAoSCR98OxmmTB0VEZA_lsCicvvB",<br/>        "types": ["route"]<br/>    }<br/>],<br/>"status": "OK"</span></pre><p id="c8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，现在响应具有诸如“lat”和“lng”的属性，它们表示特拉维夫Yafo的Allenby街的纬度和经度。</p><p id="409b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到第三个请求，复制cURL并将其转换为Python，如下所示:</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="cc0d" class="lq ju hi lm b fi lr ls l lt lu">import requests</span><span id="9ff7" class="lq ju hi lm b fi lv ls l lt lu">URL = 'https://restaurant-api.wolt.com/v1/pages/delivery'</span><span id="7659" class="lq ju hi lm b fi lv ls l lt lu">headers = {<br/>    'user-agent':<br/>        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.68 Safari/537.36',<br/>}</span><span id="6483" class="lq ju hi lm b fi lv ls l lt lu">params = [<br/>    {'lat', '32.0676462'},<br/>    {'lon', '34.7712005'}<br/>]</span><span id="e8bc" class="lq ju hi lm b fi lv ls l lt lu">response = requests.get(URL, headers=headers, params=params)</span><span id="f031" class="lq ju hi lm b fi lv ls l lt lu">print(response.text)</span></pre><p id="7d1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以看到<em class="je"> lat </em>和<em class="je"> lon </em>值作为GET请求中的参数被传递给服务器(注意，现在longitude的拼写不同了:<em class="je"> lon </em>)。</p><p id="1d97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为回报，我们将得到如下所示的JSON响应:</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es lw"><img src="../Images/ec1df7e7807a7b25a9c4857d5129351f.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/0*0POiVAsrf9DEm1PN"/></div></figure><p id="b54c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">展开<em class="je"> sections </em>属性将显示一个与Wolt合作并向所提供的街道递送食物的餐馆及其信息的巨大列表。</p><p id="9845" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我选择了第一家餐馆，这样我们就可以看到响应中有哪些信息:</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="bd88" class="lq ju hi lm b fi lr ls l lt lu">{image: {blurhash: "jdRYf1X;TtrcLLKYPcKXJkh3hmh4",…},…}<br/>image: {blurhash: "jdRYf1X;TtrcLLKYPcKXJkh3hmh4",…}<br/>blurhash: "jdRYf1X;TtrcLLKYPcKXJkh3hmh4"<br/>url: "https://prod-wolt-venue-images-cdn.wolt.com/s/sI8s6J88YvIarmXei4Tmr0XUEC5wWJVwX_2IXER1m2k/5d25876a70bfc61476fe9774/1d3bb9c41565710c313996ab39623ee9-edits/fdec11eea2a5b5afe684b07acbbce331"<br/>variants: ["xs", "sm", "md", "frontpage"]<br/>link: {target: "https://wolt.com/en/isr/tel-aviv/restaurant/arte-gelateria", target_sort: "default",…}<br/>target: "https://wolt.com/en/isr/tel-aviv/restaurant/arte-gelateria"<br/>target_sort: "default"<br/>target_title: ""<br/>title: ""<br/>type: "url"<br/>template: "venue-large"<br/>title: "Arte Italian Ice Cream"<br/>track_id: "venue-arte-gelateria"<br/>venue: {address: "נחלת בנימין 11", badges: [], city: "Tel Aviv", currency: "ILS", delivers: true,…}<br/>address: "נחלת בנימין 11"<br/>badges: []<br/>city: "Tel Aviv"<br/>currency: "ILS"<br/>delivers: true<br/>delivery_price: "₪10.00"<br/>estimate: 20<br/>estimate_range: "15-25"<br/>franchise: ""<br/>id: "5d25876a70bfc61476fe9774"<br/>location: [34.770119190216064, 32.06833246901664]<br/>name: "Arte Italian Ice Cream"<br/>online: true<br/>price_range: 2<br/>product_line: "restaurant"<br/>rating: {rating: 4, score: 9.6}<br/>short_description: "The Art of Ice-cream"<br/>slug: "arte-gelateria"<br/>tag: "ice cream"<br/>tags: ["ice cream", "sweets", "dessert"]}</span></pre><p id="8650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在有了特拉维夫亚佛艾伦比街附近餐馆的所有公开信息。我们可以看到一些属性，这些属性将告诉我们餐馆当前是否在线并接受订单，他们是否有送货选项，预计送货时间，他们的菜单有多贵，等等。</p><h1 id="73b4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">概述</h1><ol class=""><li id="1ef5" class="jf jg hi ih b ii kr im ks iq lx iu ly iy lz jc jk jl jm jn bi translated">我们向服务器发送一个带有街道名称的<em class="je"> GET </em>请求，并接收一个包含城市列表的响应，这些城市具有我们传递的街道名称及其对应的id。</li><li id="6bb8" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">一旦选择了一个城市，我们就向服务器发送另一个带有所选城市id的<em class="je"> GET </em>请求(在我们的例子中是特拉维夫Yafo的Allenby)。</li><li id="033e" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">作为回报，我们收到一个JSON响应，其中包含街道的纬度和经度。</li><li id="5900" class="jf jg hi ih b ii jo im jp iq jq iu jr iy js jc jk jl jm jn bi translated">最后，我们向服务器发送一个带有街道纬度和经度的<em class="je"> GET </em>请求，并获取一个包含我们经过的街道附近所有餐馆信息的JSON。</li></ol><p id="afca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经写了一个代码，总结了我们在这篇文章中所经历的一切。</p><pre class="kx ky kz la fd ll lm ln lo aw lp bi"><span id="5a52" class="lq ju hi lm b fi lr ls l lt lu">import json<br/>import requests<br/></span><span id="4374" class="lq ju hi lm b fi lv ls l lt lu">class Wolt:<br/>    HEADERS = {<br/>        'user-agent':<br/>            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.68 Safari/537.36'<br/>    }</span><span id="bbeb" class="lq ju hi lm b fi lv ls l lt lu">    PLACES_URL = 'https://restaurant-api.wolt.com/v1/google/places/autocomplete/json'<br/>    GOOGLE_GEOCODE_URL = 'https://restaurant-api.wolt.com/v1/google/geocode/json'<br/>    DELIVERY_URL = 'https://restaurant-api.wolt.com/v1/pages/delivery'</span><span id="5327" class="lq ju hi lm b fi lv ls l lt lu">    def get_matching_cities(self, street):<br/>        """<br/>        :param street: a street name<br/>        :return: a list of dictionaries containing the all the cities that has the passed street name and its id<br/>        """<br/>        params = {'input': street}<br/>        response = json.loads(requests.get(self.PLACES_URL, headers=self.HEADERS, params=params).text)<br/>        predictions = response['predictions']</span><span id="23af" class="lq ju hi lm b fi lv ls l lt lu">        return [<br/>            {<br/>                'street': result['description'],<br/>                'place_id': result['place_id']} for result in predictions] if response else None</span><span id="4abf" class="lq ju hi lm b fi lv ls l lt lu">    def get_lat_lon(self, city_id):<br/>        """<br/>        :param city_id: the ID of the city you want to get the latitude and longitude of<br/>        :return: dictionary containing the lat and lon of the<br/>        """<br/>        params = {'place_id': city_id}<br/>        response = json.loads(requests.get(self.GOOGLE_GEOCODE_URL, headers=self.HEADERS, params=params).text)<br/>        lat_lon = response['results'][0]['geometry']['location']<br/>        return lat_lon</span><span id="61a0" class="lq ju hi lm b fi lv ls l lt lu">    def get_nearby_restaurants(self, lat, lon):<br/>        """<br/>        :param lat: latitude of the street<br/>        :param lon: longitude of the street<br/>        :return: list of dictionaries containing all the available information about nearby restaurant<br/>        """<br/>        params = {'lat': lat, 'lon': lon}<br/>        response = requests.get(self.DELIVERY_URL, headers=self.HEADERS, params=params).text<br/>        restaurants = json.loads(response)['sections'][0]['items']<br/>        return restaurants<br/></span><span id="29ab" class="lq ju hi lm b fi lv ls l lt lu">if __name__ == '__main__':<br/>    wolt = Wolt()</span><span id="3a8d" class="lq ju hi lm b fi lv ls l lt lu">    # Get the matching streets<br/>    cities = wolt.get_matching_cities('Allenby')</span><span id="7b9c" class="lq ju hi lm b fi lv ls l lt lu">    # Select the first place (Allenby, Tel-Aviv Yafo)<br/>    # and get the latitude and longitude of it<br/>    city = cities[0]['place_id']<br/>    lat_lon = wolt.get_lat_lon(city)</span><span id="da2e" class="lq ju hi lm b fi lv ls l lt lu">    # Pass the latitude and longitude to get all nearby restaurants<br/>    restaurants = wolt.get_nearby_restaurants(lat_lon['lat'], lat_lon['lng'])<br/>    print(restaurants)</span></pre><p id="ecb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的<a class="ae jd" href="https://github.com/AcrobaticPanicc/wolt" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上也有代码。</p><h1 id="fbe6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">摘要</h1><p id="598e" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我们可以以各种方式使用代码；创建一个<a class="ae jd" href="https://github.com/dFurman/wolt-checker-bot" rel="noopener ugc nofollow" target="_blank">电报机器人</a>在我们最喜欢的餐厅有外卖时通知我们，创建一个具有Wolt的应用程序/网站中不存在的功能的应用程序，或者使用它进行分析或研究。</p><h1 id="8843" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">法律注释</h1><p id="7d6c" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">本文中的信息仅用于研究目的，使用这些信息的风险由您自行承担。尽管来自服务器的信息是公开的，但是一些网站可能不允许使用代码访问它们的公共数据。如果不违反网站的服务条款，网络抓取通常无需征得数据所有者的许可。</p></div></div>    
</body>
</html>