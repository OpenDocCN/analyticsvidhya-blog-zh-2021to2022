<html>
<head>
<title>GroupBy: The “Swiss Knife” of the Pandas Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">小组比:熊猫模块的“瑞士刀”</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/groupby-the-swiss-knife-of-the-pandas-module-fd0072f19fb8?source=collection_archive---------2-----------------------#2021-09-21">https://medium.com/analytics-vidhya/groupby-the-swiss-knife-of-the-pandas-module-fd0072f19fb8?source=collection_archive---------2-----------------------#2021-09-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="25d4" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">如何利用最被低估的熊猫业务之一</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/fe3bfbfa32896de5d395567a926d3734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LYvM32es6jM34Z3C"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">帕斯卡·米勒在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="1f5d" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">介绍</h1><p id="f724" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">如果您使用Python来处理数据集或从中提取见解，那么您无疑对Pandas库很熟悉。它是数据操作的首选工具。</p><p id="f0dc" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">Pandas是一个强大的软件包，具有巨大的实用性，这就是为什么我对人们在使用它时几乎没有触及它的表面感到惊讶。</p><p id="519a" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">尽管这个库提供了各种各样有用的功能，但是人们忽略了许多可以使他们的工作更容易并节省代码的功能。</p><p id="58cf" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">一个显著的例子是g <em class="lg"> roupby </em>操作。</p><p id="a6a5" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">groupby操作允许您将数据分成组，然后对每个组应用聚合。具体来说，它可以执行以下聚合:</p><ul class=""><li id="c004" class="lh li hh kh b ki lb kl lc ko lj ks lk kw ll la lm ln lo lp bi translated">数数</li><li id="0cb6" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">总和</li><li id="8dcb" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">平均</li><li id="a2ae" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">福建话</li><li id="692f" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">最大</li></ul><p id="3124" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">在我看来，groupby函数应该出现在任何数据科学家的工具包中。从希望深入了解其消费者的企业到希望更多了解其患者的医院，许多实体都将受益于更精细地检查其样本。</p><p id="4c14" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">根据经验，我知道许多人倾向于通过手动从他们的数据集中过滤出不同的组，然后逐个对它们执行计算来处理这种问题，这是荒谬的。</p><p id="a04f" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">当你有一个工具为你做所有的工作时，为什么要经历那么多麻烦呢？</p><p id="d9f8" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">通过一个案例研究，我将展示groupby操作的多功能性，并说明为什么它值得更多的关注。</p><h1 id="4a37" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">个案研究</h1><p id="97b5" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">在这个演示中，我将使用一个数据集来存储3个不同超市的销售记录。如果您想继续，您可以通过点击<a class="ae jm" href="https://www.kaggle.com/aungpyaeap/supermarket-sales" rel="noopener ugc nofollow" target="_blank">这里</a>来检索数据集。</p><p id="eccd" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">首先，让我们导入Pandas模块并加载数据集。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="6a20" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">现在，让我们预览一下数据集，看看我们需要处理什么。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lx"><img src="../Images/8d58f38fc7ebeefffb7c83d6c726db3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhNF_IqJC2-ZhB_0GO_JZg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">前5行数据</figcaption></figure><p id="be9d" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">每一行代表一个独特的销售。对于每笔销售，您可以访问诸如日期、城市、付款方式、产品类型和总收入等信息。</p><p id="bfe9" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">假设您被要求找到以下内容:</p><ul class=""><li id="8245" class="lh li hh kh b ki lb kl lc ko lj ks lk kw ll la lm ln lo lp bi translated">每个城市的销售数量</li><li id="eaae" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">每个产品线的总收入</li><li id="3f5f" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">每个城市超市的平均评分</li><li id="faa8" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">每个城市超市的会员和普通顾客给出的平均评分</li><li id="c282" class="lh li hh kh b ki lq kl lr ko ls ks lt kw lu la lm ln lo lp bi translated">每个超市最便宜和最贵的销售</li></ul><p id="8045" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">从表面上看，在确定这些值之前，似乎有很多东西需要解开。</p><p id="2b7a" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">然而，如果我告诉你，使用groupby函数，只需<strong class="kh hi"> 1行代码</strong>就可以回答这些问题，会怎么样呢？听起来很疯狂，不是吗？</p><p id="808d" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">让我们通过一次回答一个问题来看看实际情况。</p><h2 id="57f6" class="ly jo hh bd jp lz ma mb jt mc md me jx ko mf mg jz ks mh mi kb kw mj mk kd ml bi translated">1.每个城市的销量是多少？</h2><p id="9103" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">要找到每个城市的销售数量，您需要按城市划分记录，然后对每个组进行计数。下面是如何用Python实现这一点。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mm"><img src="../Images/d4186ae75c5a4ac51031efb1b460ebc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*drvxM1YwlkDEsEhjMUTALg.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">问题1输出</figcaption></figure><p id="4b49" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">为了更好地理解，让我们来分解这行代码的组成部分。首先，“df.groupby('City ')”部分根据城市将所有记录分成不同的组。的”。count()"部分查找每个城市的每个要素中的记录数。</p><p id="6823" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">注意:在这种情况下，由于每个要素都有相同的记录数，所以每一列都将生成相同的计数。有了”。iloc[:，0]"部分，我只选择第一列来查看计数。这一步是可选的；您可以选择要筛选的列，也可以不筛选任何列。</p><h2 id="894f" class="ly jo hh bd jp lz ma mb jt mc md me jx ko mf mg jz ks mh mi kb kw mj mk kd ml bi translated"><strong class="ak"> 2。每个产品线产生多少收入？</strong></h2><p id="b704" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">要找到每个产品线的总收入，您需要按产品线对记录进行分段，然后找到每个组的总收入。这是它在Python中的样子。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mn"><img src="../Images/2bf650e83558aae552150753003ecc21.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*5wuhT0uJLfVlTQBRGRXg9g.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">问题2输出</figcaption></figure><p id="0b06" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">这里，我们根据“df.groupby('Product line ')”部分中的产品线对数据进行分段，然后用“.”对每一列中的值求和。sum()”部分。</p><p id="a1ed" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">然而，与问题1不同，在问题1中，每一列中的计数是相同的，在这种情况下，每一列中的合计值是<strong class="kh hi">而不是</strong>相同。因此，在汇总后特别选择了“总收入”一栏。</p><h2 id="4667" class="ly jo hh bd jp lz ma mb jt mc md me jx ko mf mg jz ks mh mi kb kw mj mk kd ml bi translated">3.每个城市的平均收视率是多少？</h2><p id="3c01" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">要找到每个超市的平均评分，您需要按超市对记录进行分段，然后计算每个超市的平均评分。这是它在Python中的样子。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mo"><img src="../Images/69c40fa1301cc9b31a1c9d3afdd50157.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*U2-zIbaOSYhWrSDAKL2ZBg.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">问题3输出</figcaption></figure><p id="ec0d" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">这里的方法类似于问题2。在这里，我们根据“df.groupby('City ')部分中的城市对数据进行分段，然后使用“来计算每一列中值的平均值。mean()”部分。</p><p id="8609" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">因为我们只对平均评级感兴趣，所以在执行汇总后，我们只选择“评级”列。</p><h2 id="c408" class="ly jo hh bd jp lz ma mb jt mc md me jx ko mf mg jz ks mh mi kb kw mj mk kd ml bi translated">4.每个城市的会员和普通客户给出的平均评分是多少？</h2><p id="005b" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">这和问题3类似。</p><p id="8321" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">如果我们不仅想知道每个城市的平均评分，还想知道每个城市的会员和普通客户给出的平均评分，会怎么样？</p><p id="1c6d" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">这需要按照“城市”变量将数据分成组，然后按照“客户类型”变量将每个组分开。</p><p id="c43c" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">幸运的是，groupby操作允许您通过一个以上的变量来增加分段的粒度(仍然只有一行)。这是它在Python中的样子。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mp"><img src="../Images/d2803630764c5eb370955e8352278564.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*OaEZpo3m3dP8qgOdf5oevQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">问题4输出</figcaption></figure><p id="7fa7" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">这里的代码与问题3中的非常相似。关键区别在于groupby操作中输入的参数。groupby操作采用的不是一个变量，而是一个变量列表。</p><p id="f460" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">在这种情况下，这意味着数据将首先按城市划分，然后再按客户类型划分。接下来，计算每组的平均值，得出每列的平均值。最后，选择“评级”列以获得平均评级。</p><p id="2139" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated"><em class="lg">注意:</em>group by操作会根据列表中变量的时间顺序对数据进行分段。如果您试图基于多个变量对数据进行分段，请在输入groupby操作时注意它们的顺序。</p><h2 id="5480" class="ly jo hh bd jp lz ma mb jt mc md me jx ko mf mg jz ks mh mi kb kw mj mk kd ml bi translated">5.这三个城市最便宜和最贵的销售价格是多少？</h2><p id="90c5" class="pw-post-body-paragraph kf kg hh kh b ki kj ii kk kl km il kn ko kp kq kr ks kt ku kv kw kx ky kz la ha bi translated">寻找3个城市中最便宜和最贵的销售额需要使用2个不同的聚合函数。groupby操作的另一个好处是它允许您一次执行多个聚合函数。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lv lw l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mq"><img src="../Images/d94c9569c564809481c6bd8c55c2ae83.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*y0OrIxcKvVD4ikEEm2fqHw.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">问题5输出</figcaption></figure><p id="59be" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">请注意，所有这些信息仍然是通过一行代码获得的！</p><p id="b9be" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">在这种情况下，一旦数据帧按城市进行了分段。agg(['max '，' min'])"部分返回每组中每列的最大值和最小值。因为我们只对总销售额感兴趣，所以在执行汇总后，我们选择“total”列。</p><h1 id="effe" class="jn jo hh bd jp jq jr js jt ju jv jw jx in jy io jz iq ka ir kb it kc iu kd ke bi translated">结论</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mr"><img src="../Images/daa66142a6b4b115761e7b8de95433d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iRRquxQLUSOIkWif"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae jm" href="https://unsplash.com/@prateekkatyal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Prateek Katyal </a>拍摄的照片</figcaption></figure><p id="52db" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">在熟悉Pandas模块时，人们经常会遇到groupby函数，但是他们没有利用它的多功能性。</p><p id="8a6e" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">毕竟，阅读一个函数比知道如何在实际应用中使用它要容易得多。</p><p id="dfb1" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">groupby函数允许您一次性完成所有这些任务，而不是花费大量代码按每个类别过滤您的数据，分别对其执行计算，然后合并这些结果(我见过许多初学者这样做)。</p><p id="d9dc" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">希望你现在能相信这个不被重视的熊猫项目带来的好处。</p><p id="2e33" class="pw-post-body-paragraph kf kg hh kh b ki lb ii kk kl lc il kn ko ld kq kr ks le ku kv kw lf ky kz la ha bi translated">我祝你在未来的数据分析工作中好运！</p></div></div>    
</body>
</html>