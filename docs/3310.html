<html>
<head>
<title>Asynchronous Web Scraping 101: Fetching Multiple URLs using Arsenic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异步Web抓取101:使用砷获取多个URL</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/asynchronous-web-scraping-101-fetching-multiple-urls-using-arsenic-ec2c2404ecb4?source=collection_archive---------5-----------------------#2021-06-24">https://medium.com/analytics-vidhya/asynchronous-web-scraping-101-fetching-multiple-urls-using-arsenic-ec2c2404ecb4?source=collection_archive---------5-----------------------#2021-06-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/040ed63583d8f017b976ada39e61b4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zuMWQbtsHodcvvsO"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">卢卡·布拉沃在<a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="5176" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi js translated"><span class="l jt ju jv bm jw jx jy jz ka di">随着越来越多的数据出现在网上，网络抓取服务的需求空前高涨。许多企业依靠数据驱动的方法来推动他们的组织目标。使用同步web抓取，大多数通常的数据请求都可以完成，这些请求通常围绕着小数据集。虽然前面的部分工作得很好，但是在大量数据删除的情况下，web抓取的执行时间仍然很短。</span></p><h1 id="9523" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">什么是网络抓取</h1><p id="de04" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated"><a class="ae it" href="https://en.wikipedia.org/wiki/Web_scraping" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">网页抓取</strong> </a>、<strong class="iw hi">网页抓取</strong>或<strong class="iw hi">网页数据提取</strong>是<a class="ae it" href="https://en.wikipedia.org/wiki/Data_scraping" rel="noopener ugc nofollow" target="_blank">数据抓取</a>用于<a class="ae it" href="https://en.wikipedia.org/wiki/Data_extraction" rel="noopener ugc nofollow" target="_blank">从<a class="ae it" href="https://en.wikipedia.org/wiki/Website" rel="noopener ugc nofollow" target="_blank">网站</a>提取数据</a>。收集这些信息，然后将其导出为对用户更有用的格式。无论是电子表格还是API。</p><h1 id="f831" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">网络抓取的挑战</h1><p id="4e64" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">对于希望从在线资源中检索数据的用户来说，Web抓取很简单。正常的网页抓取对大多数用例是有益的，但是当提取的数据量很高时<strong class="iw hi"> <em class="le">会失败，因为这是一个非常耗时的过程</em> </strong>。迫切需要一种解决方案来从网站中提取大量内容，而不影响整个过程的执行速度。为了迎合前面提到的限制，异步编程的好处得到了充分发挥。在下一节中，我们将探索异步编程如何快速有效地解决提取大量内容的问题。</p><h1 id="f3d4" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">同步与异步执行</h1><p id="8223" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">顺序执行代码的程序是同步的。这种程序调用一个函数，并在执行下一个命令之前等待该函数返回响应。另一方面，异步程序调用一个函数并继续执行下一个命令，而不是等待响应。一旦响应可用于先前调用的函数，程序返回到该函数调用并处理响应。简而言之，异步执行可以被看作是任务切换的一种方式，可以最小化空闲时间。</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lf"><img src="../Images/ebf179026f01e2db7e35ee79c977cff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKi54OcNLn1apGkuwmgswQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">同步与异步的类比</figcaption></figure><p id="9139" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">同步和异步程序的一个类比是，我计划和我的好朋友Justin交流。给贾斯汀打电话是同步的，而通过电子邮件交流是异步的。通过电话，我先键入贾斯汀的号码，然后等他来接。一旦他接了电话，我就说点什么，然后等他回应。如果你把我当成一个程序，我在执行我的下一个命令(说点什么)之前，等待服务器(这里是Justin)返回一个响应。这是典型的同步程序的工作方式。如果我选择通过电子邮件交流，一旦我起草并发送了电子邮件，我就开始工作，而不是等待回复。这是一个异步程序的例子，其中程序继续执行其他任务，而不是等待响应。</p><h1 id="d57c" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Python中同步与异步编程的比较</h1><p id="51e2" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">在这一节中，我们将看到python中同步和异步编程的区别以及时间执行。</p><figure class="lg lh li lj fd ii"><div class="bz dy l di"><div class="lk ll l"/></div></figure><blockquote class="lm ln lo"><p id="e4df" class="iu iv le iw b ix iy iz ja jb jc jd je lp jg jh ji lq jk jl jm lr jo jp jq jr ha bi translated">它需要10秒钟</p></blockquote><p id="db60" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Python中有几个用于进行异步编程的包。其中一个包是asyncio，它是Python 3.4中添加的标准库。在幕后，asyncio使用事件循环、协程和任务来最小化空闲时间。</p><figure class="lg lh li lj fd ii"><div class="bz dy l di"><div class="lk ll l"/></div></figure><blockquote class="lm ln lo"><p id="ff63" class="iu iv le iw b ix iy iz ja jb jc jd je lp jg jh ji lq jk jl jm lr jo jp jq jr ha bi translated">它需要5.88893e-05秒</p></blockquote><p id="b6ba" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从两种代码生成的执行时间的比较中，我们可以得出结论，当我们使用异步方法从网站抓取数据时，它会更有效。尤其是当我们需要的是抓取多个网址的时候，会节省很多时间吧？</p></div><div class="ab cl ls lt go lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ha hb hc hd he"><p id="6ab5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这一节中，我将向您展示两种从网站抓取数据的技术。但在此之前，我先说明一下我要刮的是什么。</p><p id="e5ab" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我想刮的网站来自<a class="ae it" href="https://www.tripadvisor.com/" rel="noopener ugc nofollow" target="_blank">猫途鹰</a>。Tripadvisor是一个人们可以用来预订航班、住宿和体验的网站。用户还可以留下对酒店、餐馆、旅游等的评论。因此，网站本身包含了大量的评论数据和价格数据。对于消费者来说，这些数据可以帮助你找到最好的交易，包括捆绑包，并编辑评论，以了解照片之外的地方。</p><p id="aa80" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我想收集的是环球影城的一篇评论，分为三个分支。我会把网站上的组成部分，如审查者的姓名，审查的日期，审查的标题和审查的文本。在一个分支机构，环球影业有大约10，000多页的评论网站。所以这里我将比较使用同步和异步方法抓取多个URL。</p><h1 id="1c75" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用Selenium和Chromedriver的同步网页抓取方法</h1><p id="7f5d" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">在同步方法中，我使用selenium和chromedriver的库。当我们在这个猫途鹰网站上做抓取时，我们会发现一些挑战。</p><h2 id="c625" class="lz kc hh bd kd ma mb mc kh md me mf kl jf mg mh kp jj mi mj kt jn mk ml kx mm bi translated">链接越多</h2><p id="d2bd" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">正如下面的截图所强调的，猫途鹰最初只加载评论的一部分，等到用户点击<strong class="iw hi">阅读更多</strong>来加载其余部分。</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mn"><img src="../Images/a77169c52bbeb5e0289301fa877e4946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6izDvlVV0anwSm4UM0uX_w.png"/></div></div></figure><p id="1208" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当进一步点击时，JavaScript被执行(代码如下),很可能使抓取变得更加困难。</p><pre class="lg lh li lj fd mo mp mq mr aw ms bi"><span id="a300" class="lz kc hh mp b fi mt mu l mv mw">&lt;div class="DrjyGw-P _1l3JzGX1"&gt;Read More&lt;/span&gt; == $0</span></pre><p id="6f4d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最终结果是，使用像Beautiful Soup这样的抓取库是不够的，我们需要启动一个浏览器并使用Selenium进行控制，以模拟按下<strong class="iw hi"> Read More </strong>链接并执行JavaScript代码。</p><p id="91b5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里是使用Python和Selenium抓取网站的代码，用来抓取某个特定的Universal Studio评论的所有评论。我需要从所有页面刮评论，并保存到一个csv文件。</p><figure class="lg lh li lj fd ii"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="5d22" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从上面的代码来看，需要很长时间。平均一页，大概需要10秒。试想一下，刮三万页需要多长时间。</p><h1 id="c770" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用砷和Chromedriver的异步网页抓取方法</h1><p id="557d" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">在这一节中，我将向您展示用Python实现异步程序的过程，并观察异步编程为网站抓取提供的优势。</p><p id="ec49" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">假设我们有一个30.000个URL的列表，我们想为每个URL下载HTML页面，并做一些后处理和提取数据。</p><figure class="lg lh li lj fd ii"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="fb88" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们有一个函数运行，将从前面提到的30.000个网址收集数据。</p><p id="8841" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我们要同步进行，那么获得一个请求需要100乘以平均时间(假设后处理时间微不足道)。但是相反，如果我们将100个URL分成4个独立的线程/进程，那么所需的时间将是原来时间的1/4，至少理论上是这样。</p><p id="995e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，我们将创建一个异步函数来使用Chromedriver打开浏览器。这将自动打开一个页面，我们可以直接访问我们想要的元素来检索信息。</p><figure class="lg lh li lj fd ii"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="976f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过使用异步代码，我们不需要为<strong class="iw hi">阅读更多</strong>按钮而烦恼，因为在一个会话中我们将能够获得完整的信息。所以我们需要做的就是取我们需要的元素。</p><p id="08af" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当使用asyncio和chromedriver抓取多个页面时，我们将使用以下模式创建多个会话，这些会话将在asyncio事件循环中同时执行。而在同步代码中，我们需要遍历URL列表，一次处理一个。</p><p id="c7a5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我们可以通过使用这段代码来获取我们需要的元素</p><figure class="lg lh li lj fd ii"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="25a0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用异步代码将大大减少执行时间。对于一个页面，我们只需要大约1秒钟来获取我们想要检索的数据。与使用同步方法相比，这非常节省时间。</p><h1 id="3a39" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">环球影城分支机构评论数据集</h1><p id="bc98" class="pw-post-body-paragraph iu iv hh iw b ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ld jp jq jr ha bi translated">你可以在<a class="ae it" href="https://www.kaggle.com/dwiknrd/reviewuniversalstudio" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载抓取的数据集。该数据集包括游客在Trip Advisor网站上发布的对环球影城3个分支(佛罗里达、新加坡、日本)的50，000+评论。</p></div><div class="ab cl ls lt go lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ha hb hc hd he"><p id="9180" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您可以从我的GitHub查看完整的源代码</p><div class="mx my ez fb mz na"><a href="https://github.com/dwiknrd/scraping-tripadvisor" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">dwiknrd/scraping-tripadvisor</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">猫途鹰环球影城评论。通过在…上创建帐户，为dwiknrd/scraping-tripadvisor的发展做出贡献</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">github.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no in na"/></div></div></a></div></div></div>    
</body>
</html>