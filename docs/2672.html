<html>
<head>
<title>Zero to Pipeline — Beginner’s guide to building a scikit-learn Pipeline to predict survival on the Titanic Dataset.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到管道——构建scikit-learn管道以预测泰坦尼克号数据集存活率的初学者指南。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/zero-to-pipeline-beginners-guide-to-building-a-scikit-learn-pipeline-to-predict-survival-on-the-bd9730f6f13b?source=collection_archive---------6-----------------------#2021-05-12">https://medium.com/analytics-vidhya/zero-to-pipeline-beginners-guide-to-building-a-scikit-learn-pipeline-to-predict-survival-on-the-bd9730f6f13b?source=collection_archive---------6-----------------------#2021-05-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/5cdf8bb387cebed0530066975267a35b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*mRt1pIlWRmZAczeoOgbMnw.jpeg"/></div><figcaption class="il im et er es in io bd b be z dx translated">在泰坦尼克号上做一个贫穷的男人是不值得的。杰克·道森的生还几率可能在20%左右</figcaption></figure><p id="1005" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">开始编写机器学习代码的一个典型地方是泰坦尼克号数据集——这是<a class="ae jn" href="http://kaggle.com" rel="noopener ugc nofollow" target="_blank"> kaggle </a>上最受欢迎的项目之一。我在自己的课程中使用过titanic数据集，因此它似乎是我的第一篇机器学习媒体文章的一个很好的起点。</p><p id="7691" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们将简要介绍从kaggle加载和探索数据，如何进行一些小的功能工程，最后，如何使用Scikit-Learn将所有这些放入一个简单的管道中。如果你不熟悉的话，scikit-learn的管道库是一个非常有用的工具，它可以在尽可能少的步骤中对数据进行预处理并通过学习算法进行处理。最后，我们将能够预测谁将在我们的测试数据集中幸存下来，并提交给kaggle竞赛。前进！</p><p id="a019" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> Google Colab </strong></p><p id="3c1c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，我建议你使用jupyter笔记本。具体来说，你应该使用谷歌编程文档google colab。你不需要安装任何东西，只需按照<a class="ae jn" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank">这个链接</a>创建一个新的空白笔记本。</p><p id="c32b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">连接到Kaggle </strong></p><p id="97c2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可以手动添加数据，将笔记本与你的google drive链接，或将笔记本连接到kaggle。我将使用后者，因为我们在这里专门讨论kaggle数据集。</p><p id="bc39" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，你需要从https://www.kaggle.com/me/account那里得到一个卡格尔令牌。点击链接，在API下选择“创建新的API令牌”</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es jo"><img src="../Images/fc64ea56adaa219197d5ddff519870a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AylnNpIOQB9SQxNKENv7Fg.png"/></div></div></figure><p id="43ca" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您将下载一个kaggle.json文件，我们可以手动将其加载到笔记本中。下面是执行此操作的代码:</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="217c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意，该文件必须命名为kaggle.json才能工作。现在我们可以运行一个脚本来下载数据集。行首的感叹号让jupyter notebook运行代码，就好像是在终端中运行，而不是在python内部。</p><pre class="jp jq jr js fd jz ka kb kc aw kd bi"><span id="2a2d" class="ke kf hh ka b fi kg kh l ki kj">!kaggle competitions download -c titanic</span></pre><p id="da6a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在已经下载了三个文件:test.csv、train.csv和gender_submission.csv。我们将使用train.csv来训练我们的模型，并将在test.csv上进行预测。gender_submission.csv是一个有用的指南，可以指导我们应该如何格式化kaggle提交(在这种情况下，所有男性都死了，所有女性都活着，这实际上是一个不错的预测)。</p><p id="e419" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">是时候载入并探索我们的数据了。我们可以使用。head()方法来查看最上面的行</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es kk"><img src="../Images/a78ee3429bde3f66d0e48281bf249c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tjUKlPCUnPNYEharC0FEKg.png"/></div></div><figcaption class="il im et er es in io bd b be z dx translated">。head()方法</figcaption></figure><p id="f64e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这一点上，我们有一个可管理的列数，所以我们想通过每一个来理解我们的数据。我们的目标是决定什么对预测有用，什么没用。</p><p id="c624" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以看出PassengerId没有任何价值。我们也许可以从名字(小姐vs夫人vs博士……)做一些特征工程，但是我现在就去掉这个名字。我们还会丢失Ticket列，因为它看起来是随机的。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kl"><img src="../Images/8fe4763a2d4b5e1daf15c037aa40f828.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/1*PEMWzNjbh1ErNLxByqFPeg.png"/></div><figcaption class="il im et er es in io bd b be z dx translated">。信息()方法</figcaption></figure><p id="30fc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">特色工程</strong></p><p id="b336" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们打电话给。info()方法来检查数据集中变量的数据类型和非空计数。我们希望我们的数据结构良好，这意味着没有任意丢失的值。对于Cabin，我们只有204个非空值。我们不是删除cabin列，而是将它变成一个布尔值—无论是否列出了一个Cabin。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es km"><img src="../Images/4694c3242832db8403e72c4a511aa1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*jfX7OXhENq9T0nwAMuNR0g.png"/></div><figcaption class="il im et er es in io bd b be z dx translated">客舱现在是0或1值</figcaption></figure><p id="5a7f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">替换缺失值</strong></p><p id="98de" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们已经改变了讨厌的小屋变量。你可能也已经注意到年龄不见了！我们可以丢弃缺少年龄值的样本，或者用可能有意义的东西来填充缺少的值。为了避免事情过于复杂，我们将只使用乘客的中值年龄来添加一个默认的年龄值。这不太可能有助于预测，但也不会破坏系统。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><pre class="jp jq jr js fd jz ka kb kc aw kd bi"><span id="cb21" class="ke kf hh ka b fi kg kh l ki kj">Median Passenger Age: 28.0</span></pre><p id="664e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">的。fillna()方法用我们的中位年龄28替换了所有的空值。</p><p id="4a1d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们还想为那些没有登机点的乘客替换一些缺失的“已登机”值。我将使用最常见的登船方式。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kn"><img src="../Images/68a91fe831528c5407036d71e75c730b.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*nowOxMQWIOhjztwLaEe9HA.png"/></div></figure><p id="1355" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们不再有任何非空值。耶！但是我们可以用不同的方式来处理这件事…</p><p id="365e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">使用简单估算器</strong></p><p id="14d6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有一种更简单的方法可以做到这一点。Sklearn有一个工具叫SimpleImputer，它做的和我们刚才做的完全一样，但是更干净，更通用，可以直接用管道工作。一个简单的估算器将填充所有的空数值。我们将重新加载数据，并分离出我们关心的数字列。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="3f74" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">变量<strong class="ir hi"> X </strong>是我们的估算结果，其中所有的值都使用“中值”策略填充。然后，我们重新创建了一个新的数据帧titanic_tr，来检查我们的结果。如果我们看看。statistics_ parameter，我们可以看到估算者用来填充每一列的值。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es ko"><img src="../Images/609db1adf6fb4a8135eb28bd4a287c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*_e2n12zuBrld1CkQlcXlYw.png"/></div><figcaption class="il im et er es in io bd b be z dx translated">平均年龄是28岁，平均费用是14.4542美元。</figcaption></figure><p id="8af9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们也可以使用简单估算器来填充分类数据，我们只需要选择一个与数据兼容的不同策略。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kp"><img src="../Images/7070a1be5db8621611d2a0cb4510fcba.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*Uh2prdWTL_MX_0q8o_5PnQ.png"/></div><figcaption class="il im et er es in io bd b be z dx translated">最常登船地点、性别和等级</figcaption></figure><p id="6ce0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以使用这些方法来获得新的和干净的数据。但是像“男性”和“C”这样的东西并不能很好地流入简单的数学模型。我们需要更改这些顺序类的值，以确保它们可以用简单的数字方式表示。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kq"><img src="../Images/4a140aa84d95880a99aa8124e6965a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*IbaEJHYA4ikov9sDAx5K6Q.png"/></div></figure><p id="c134" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在已经将我们的类别改为从零开始的数字。这对于客运类是有意义的，在客运类中，值之间存在实际的数字关系(类1更接近类2，而不太接近类3)，这对于性别也是有效的，因为我们数据集中的值是二进制的。然而，0、1和2的编码可能会使装载点的预测不可靠，因为它假设它们之间存在数学关系。以邮政编码为例。虽然从技术上讲，它们是数字，但22101并不真的大于或小于90210，这些数字并不代表真实世界的值。为了解决这个细节，我们使用了被称为<strong class="ir hi">的一键编码</strong>。</p><p id="35c7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">一键编码</strong></p><p id="f3ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了避免算法认为C更接近Q而不是S，因为0更接近1而不是2，我们将数字更改为一位热编码，其中每个数字都更改为0和1的数组。0变成[1 0 0]，1变成[0 1 0]，2变成[0 0 1]。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es kr"><img src="../Images/71fb868f6feb09beddb0880d377d6bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*aMb-OkYAsEh9Iw4_bTXBEA.png"/></div><figcaption class="il im et er es in io bd b be z dx translated">每个值现在都由0和1的数组表示</figcaption></figure><p id="8087" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">定制变形金刚</strong></p><p id="57a1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些编码器很棒，在流水线上工作得很好。但是如果我们想分开做呢？我们的客舱数据就是一个很好的例子——我们希望用1替换现有值，用0替换空值。我们将为此编写一个自定义的转换器。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="a39b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">建立管道</strong></p><p id="2469" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们已经查看了我们的数据，对其进行了处理，并找出了我们想要对其做什么，以便为训练机器学习算法做好准备。因此，在这一点上，我们可以轻松地构建一个管道，将我们所有的工作包含到一个简单的、逻辑的代码块中。我们所有的转换都是清晰可辨的，我们将添加一个标准缩放器来标准化我们的数值(这对一些算法很有帮助)。这就是管道有用的地方，因为我们可以连续添加多个步骤。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="647f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里我们有三个管道——一个用于数值数据，一个用于客舱数据，一个用于分类数据。现在我们可以将这些合并到一个ColumnTransformer中，提供将哪些列输入到哪些管道的名称。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="3ee5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">只是为了再看看我们的数据变成了什么，我们可以再次将它加载到dataframe中，但我不建议通常这样做。在这一点上，我们应该知道我们的东西看起来像什么，而不需要像这样写标签。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es ks"><img src="../Images/31d4f132a05f55f3e74f890f41fa766b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxG-rMxTNaA8W-ZmJB3Qsw.png"/></div></div></figure><h1 id="e0fe" class="kt kf hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">培养</h1><p id="bebe" class="pw-post-body-paragraph ip iq hh ir b is lq iu iv iw lr iy iz ja ls jc jd je lt jg jh ji lu jk jl jm ha bi translated">太棒了。我们的数据是干净的、数字的，并且可以用于训练。我们将把我们的数据分成训练/测试集(不讨论test.csv，它实际上是一个验证集，目前还没有任何可供我们使用的解决方案)。然后，我们将通过一个随机梯度下降分类器来运行它——没有什么特别的，只是一个二元分类器。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es lv"><img src="../Images/3fcfa4e58f3f6e19d0867ad617297a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*lL2gscFSbM3XDsfloqNrMg.png"/></div></figure><p id="eb7f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">还不错！肯定比50%强！</p><h1 id="7b88" class="kt kf hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">提交结果</h1><p id="fe48" class="pw-post-body-paragraph ip iq hh ir b is lq iu iv iw lr iy iz ja ls jc jd je lt jg jh ji lu jk jl jm ha bi translated">在这一点上，我们可以尝试不同的参数，不同的模型，甚至使用GridSearch一次尝试很多各种各样的东西。这是另一节课的全部内容…现在，让我们看看如何创建预测，并像kaggle希望我们提交的那样编写一个文件。我们甚至可以通过命令行提交！</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="735c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我希望这对你有所帮助！这里有一个完整的jupyter笔记本(和一些额外的代码)，你可以在这里查看。关注我的更多教程，并查看我在michaelsmirnov.com<a class="ae jn" href="http://michaelsmirnov.com" rel="noopener ugc nofollow" target="_blank">的网站。</a></p></div></div>    
</body>
</html>