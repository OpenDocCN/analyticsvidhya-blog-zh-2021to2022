<html>
<head>
<title>Extracting Dominant Colours from an Image using K-means Clustering from Scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零开始使用K-均值聚类从图像中提取主色</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/extracting-dominant-colours-in-an-image-using-k-means-clustering-from-scratch-2ce79a3eea5d?source=collection_archive---------12-----------------------#2021-01-16">https://medium.com/analytics-vidhya/extracting-dominant-colours-in-an-image-using-k-means-clustering-from-scratch-2ce79a3eea5d?source=collection_archive---------12-----------------------#2021-01-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="269a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从零开始，在不到5分钟的时间内从您选择的任何图像中提取主色！</p><p id="f0dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能听过一句话<strong class="ih hj"> <em class="jd">“一图胜千言”</em> </strong>在我们这个数字化发达的时代，这比以往任何时候都更准确；从一幅图像中可以提取很多信息。高级计算机视觉系统已经允许<em class="jd">自动驾驶汽车</em>识别前方的物体是人行横道还是静态道路危险，Instagram过滤器是面部检测和互动的。这些进步源于大多数机器学习的基本方法。</p><blockquote class="je jf jg"><p id="f3d4" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">关于自动驾驶汽车的更多内容:<a class="ae jk" rel="noopener" href="/analytics-vidhya/a-beginners-guide-to-reinforcement-learning-and-its-basic-implementation-from-scratch-2c0b5444cc49"> <strong class="ih hj">强化学习初学者指南及其从零开始的基本实现</strong> </a></p></blockquote><p id="b2a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">机器学习</em>涉及机器为了理解数据并提供一些关于数据的答案而进行的学习过程。在<em class="jd">图像处理</em>的背景下，机器学习的一个应用可以是尝试用代表<em class="jd">像素</em>和<em class="jd">颜色</em>的数字作为数据来处理图像。</p><blockquote class="je jf jg"><p id="d270" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">关于机器学习的更多内容:<a class="ae jk" rel="noopener" href="/analytics-vidhya/a-beginners-guide-for-getting-started-with-machine-learning-7ba2cd5796ae"> <strong class="ih hj">机器学习入门指南</strong> </a></p></blockquote><p id="822a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不提供预测或假设一组正确输出，而是从给定数据集揭示洞察力的方法被称为<em class="jd">无监督</em>。用于<em class="jd">图像处理</em>和<em class="jd">信息提取</em>的一种这样的技术是<strong class="ih hj"> <em class="jd"> K均值聚类</em>，</strong>一种旨在<em class="jd">将n个数据点划分成K个组的学习方法。</em></p><blockquote class="je jf jg"><p id="9f0c" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">有关K-均值聚类的概念概述，请参考— <a class="ae jk" href="https://tp6145.medium.com/everything-you-need-to-know-about-k-means-clustering-88ad4058cce0" rel="noopener"> <strong class="ih hj">关于K-均值聚类您需要知道的一切</strong> </a></p></blockquote><p id="0ed7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我们现在将从头开始实现K-means聚类算法的代码演练:</em></p><blockquote class="je jf jg"><p id="e405" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">不要烦恼！我向你保证，它会变得像听起来一样迷人！</p></blockquote><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="c185" class="ju jv hi jq b fi jw jx l jy jz">import <strong class="jq hj">numpy</strong> as np<br/>import <strong class="jq hj">matplotlib.pyplot</strong> as plt<br/><br/>np.random.seed(42)<br/><br/><strong class="jq hj">def euclidean_distance</strong>(x1, x2):<br/>    return np.sqrt(np.sum((x1 - x2)**2))<br/><br/><strong class="jq hj">class KMeans():</strong><br/><br/>   <strong class="jq hj"> def __init__</strong>(self, K=5, max_iters=100, plot_steps=False):<br/>        self.K = K<br/>        self.max_iters = max_iters<br/>        self.plot_steps = plot_steps<br/><br/>        <em class="jd"># list of sample indices for each cluster</em><br/>        self.clusters = [[] for _ in range(self.K)]<br/>        <em class="jd"># the centers (mean feature vector) for each cluster</em><br/>        self.centroids = []<br/><br/>    <strong class="jq hj">def predict</strong>(self, X):<br/>        self.X = X<br/>        self.n_samples, self.n_features = X.shape<br/>        <br/>        <em class="jd"># initialize </em><br/>        random_sample_idxs = np.random.choice(self.n_samples, self.K, replace=False)<br/>        self.centroids = [self.X[idx] for idx in random_sample_idxs]<br/><br/>        <em class="jd"># Optimize clusters</em><br/>        for _ in range(self.max_iters):<br/>            <em class="jd"># Assign samples to closest centroids (create clusters)</em><br/>            self.clusters = self._create_clusters(self.centroids)<br/>            if self.plot_steps:<br/>                self.plot()<br/><br/>            <em class="jd"># Calculate new centroids from the clusters</em><br/>            centroids_old = self.centroids<br/>            self.centroids = self._get_centroids(self.clusters)<br/>            <br/>            <em class="jd"># check if clusters have changed</em><br/>            if self._is_converged(centroids_old, self.centroids):<br/>                break<br/><br/>            if self.plot_steps:<br/>                self.plot()<br/><br/>        <em class="jd"># Classify samples as the index of their clusters</em><br/>        return self._get_cluster_labels(self.clusters)<br/><br/><br/>    <strong class="jq hj">def _get_cluster_labels</strong>(self, clusters):<br/>        <em class="jd"># each sample will get the label of the cluster it was assigned to</em><br/>        labels = np.empty(self.n_samples)<br/><br/>        for cluster_idx, cluster in enumerate(clusters):<br/>            for sample_index in cluster:<br/>                labels[sample_index] = cluster_idx<br/>        return labels<br/><br/>   <strong class="jq hj"> def _create_clusters</strong>(self, centroids):<br/>        <em class="jd"># Assign the samples to the closest centroids to create clusters</em><br/>        clusters = [[] for _ in range(self.K)]<br/>        for idx, sample in enumerate(self.X):<br/>            centroid_idx = self._closest_centroid(sample, centroids)<br/>            clusters[centroid_idx].append(idx)<br/>        return clusters<br/><br/>   <strong class="jq hj"> def _closest_centroid</strong>(self, sample, centroids):<br/>        <em class="jd"># distance of the current sample to each centroid</em><br/>        distances = [euclidean_distance(sample, point) for point in centroids]<br/>        closest_index = np.argmin(distances)<br/>        return closest_index<br/><br/>    <strong class="jq hj">def _get_centroids</strong>(self, clusters):<br/>        <em class="jd"># assign mean value of clusters to centroids</em><br/>        centroids = np.zeros((self.K, self.n_features))<br/>        for cluster_idx, cluster in enumerate(clusters):<br/>            cluster_mean = np.mean(self.X[cluster], axis=0)<br/>            centroids[cluster_idx] = cluster_mean<br/>        return centroids<br/><br/>    <strong class="jq hj">def _is_converged</strong>(self, centroids_old, centroids):<br/>        <em class="jd"># distances between each old and new centroids, fol all centroids</em><br/>        distances = [euclidean_distance(centroids_old[i], centroids[i]) for i in range(self.K)]<br/>        return sum(distances) == 0<br/><br/>    <strong class="jq hj">def plot</strong>(self):<br/>        fig, ax = plt.subplots(figsize=(12, 8))<br/><br/>        for i, index in enumerate(self.clusters):<br/>            point = self.X[index].T<br/>            ax.scatter(*point)<br/><br/>        for point in self.centroids:<br/>            ax.scatter(*point, marker="x", color='black', linewidth=2)<br/><br/>        plt.show()<br/>   <strong class="jq hj"> def cent</strong>(self):<br/>        return self.centroids</span><span id="08cd" class="ju jv hi jq b fi ka jx l jy jz"><em class="jd">#Extracting Dominant Colours in an Image</em></span><span id="0b10" class="ju jv hi jq b fi ka jx l jy jz">import <strong class="jq hj">cv2</strong><br/>from <strong class="jq hj">skimage</strong> import <strong class="jq hj">io</strong><br/>from <strong class="jq hj">google.colab.patches</strong> import <strong class="jq hj">cv2_imshow</strong></span><span id="fddb" class="ju jv hi jq b fi ka jx l jy jz">url = "https://www.teahub.io/photos/full/35-355143_windows-10-wallpaper-umbrella.jpg" <br/>img = io.imread(url)</span><span id="cf78" class="ju jv hi jq b fi ka jx l jy jz">img.shape</span><span id="45a9" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>(1080, 1920, 3)</span><span id="40f3" class="ju jv hi jq b fi ka jx l jy jz">img_init = img.copy()</span><span id="d64c" class="ju jv hi jq b fi ka jx l jy jz">plt.figure(figsize=(6, 6)) <br/>plt.imshow(img_init)</span><span id="b50b" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>&lt;matplotlib.image.AxesImage at 0x7f49e6a7d6a0&gt;</span></pre><figure class="jl jm jn jo fd kc er es paragraph-image"><div class="er es kb"><img src="../Images/f4ebe38d242731ca68127acef5841fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*sHHh_1S7kyOYCC1AsEJ-9g.png"/></div></figure><pre class="jl jm jn jo fd jp jq jr js aw jt bi"><span id="b4f0" class="ju jv hi jq b fi jw jx l jy jz">img = img.reshape((img.shape[0] * img.shape[1],img.shape[2]))</span><span id="1387" class="ju jv hi jq b fi ka jx l jy jz">k = <strong class="jq hj">KMeans</strong>(K=5) <em class="jd">#for 5-most dominant colours</em><br/>y_pred = k.<strong class="jq hj">predict</strong>(img)<br/>k.cent()</span><span id="ef18" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([[ 53.16708662,  93.69632655, 175.47967713],<br/>       [133.07051658, 195.54817432,  47.66459003],<br/>       [237.62760178,  76.63096981,  21.42656026],<br/>       [248.665852  ,  31.23121874, 121.13346739],<br/>       [206.22142881, 229.36967717, 152.23724866]])</span><span id="107f" class="ju jv hi jq b fi ka jx l jy jz">y_pred</span><span id="63ba" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([2., 2., 2., ..., 0., 0., 0.])</span><span id="154f" class="ju jv hi jq b fi ka jx l jy jz">label_indx = np.arange(0,len(np.unique(y_pred)) + 1)<br/>label_indx</span><span id="cdc0" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([0, 1, 2, 3, 4, 5])</span><span id="ce28" class="ju jv hi jq b fi ka jx l jy jz">np.histogram(y_pred, bins = label_indx)</span><span id="cd87" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>(array([565545, 172073, 559377, 593291, 183314]), array([0, 1, 2, 3, 4, 5]))</span><span id="c20e" class="ju jv hi jq b fi ka jx l jy jz">(hist, _) = np.histogram(y_pred, bins = label_indx)<br/>hist = hist.astype("float")<br/>hist /= hist.sum()<br/>hist</span><span id="29d6" class="ju jv hi jq b fi ka jx l jy jz"><strong class="jq hj">Out:<br/></strong>array([0.27273582, 0.08298274, 0.26976128, 0.28611642, 0.08840374])</span><span id="422c" class="ju jv hi jq b fi ka jx l jy jz">hist_bar = np.zeros((50, 300, 3), dtype = "uint8")</span><span id="7469" class="ju jv hi jq b fi ka jx l jy jz">startX = 0<br/>for (percent, color) in zip(hist,  k.cent()): <br/>  endX = startX + (percent * 300) <em class="jd"># to match grid</em><br/>  cv2.rectangle(hist_bar, (int(startX), 0), (int(endX), 50),<br/>      color.astype("uint8").tolist(), -1)<br/>  startX = endX</span><span id="107b" class="ju jv hi jq b fi ka jx l jy jz">plt.figure(figsize=(15,15))<br/>plt.subplot(121)<br/>plt.imshow(img_init)<br/>plt.subplot(122)<br/>plt.imshow(hist_bar)<br/>plt.show()</span></pre><figure class="jl jm jn jo fd kc er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kf"><img src="../Images/4efb9557561b5b7319ca667108f79ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WufAXnCxYYntwrfxG3YJwg.png"/></div></div></figure><blockquote class="je jf jg"><p id="ff73" class="if ig jd ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">希望你喜欢并充分利用这篇文章！敬请关注我即将发布的博客！如果你觉得我的内容有帮助/信息丰富，请确保<strong class="ih hj">拍</strong>和<strong class="ih hj">跟着</strong>！</p></blockquote><p id="9c48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">完整代码实现:</em> </strong></p><div class="kk kl ez fb km kn"><a href="https://github.com/tanvipenumudy/Winter-Internship-Internity/blob/main/Day%2011/Day-11%20Notebook-1%20%28Dominant%20Colours%20in%20an%20Image%29.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab dw"><div class="kp ab kq cl cj kr"><h2 class="bd hj fi z dy ks ea eb kt ed ef hh bi translated">tanvipenumudy/Winter-实习-实习</h2><div class="ku l"><h3 class="bd b fi z dy ks ea eb kt ed ef dx translated">存储库跟踪每天分配的工作-tanvipenumudy/Winter-实习-实习</h3></div><div class="kv l"><p class="bd b fp z dy ks ea eb kt ed ef dx translated">github.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb kd kn"/></div></div></a></div></div></div>    
</body>
</html>