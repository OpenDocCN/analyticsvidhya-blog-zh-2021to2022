<html>
<head>
<title>Image Search — Transfer Learning with CNN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图像搜索CNN的迁移学习</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/image-search-transfer-learning-with-cnn-convolutional-neural-network-76c5fb7b8819?source=collection_archive---------7-----------------------#2021-05-20">https://medium.com/analytics-vidhya/image-search-transfer-learning-with-cnn-convolutional-neural-network-76c5fb7b8819?source=collection_archive---------7-----------------------#2021-05-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="119f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建一个图像搜索引擎，根据特定的目标图像从数据库中检索最相似的图像。</p><h1 id="1f3c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">问题</h1><p id="6921" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">给定一个查询图像(包含一个特定实例)和一个包含不同内容的图像集合，我们希望从集合中找到包含相同查询实例的图像。</p><p id="2b6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图是查询图像的两个示例(原始图像+裁剪后的图像)。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kg"><img src="../Images/3c8c452565fd110ff954c9eaed36ae84.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/0*4Bd_QUTPP1Cz9QF7.PNG"/></div><figcaption class="ko kp et er es kq kr bd b be z dx translated">查询图像的两个例子。</figcaption></figure><p id="bba1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图是使用ResNet迁移学习的查询结果。因为我有十个查询图像，所以有十行图像，每行包含与查询图像最相似的十个图像。我们可以看到第一行包含埃菲尔铁塔的图片。第二排是<a class="ae ks" href="https://en.wikipedia.org/wiki/Steve_Jobs" rel="noopener ugc nofollow" target="_blank">史蒂夫·乔布斯</a>的图片，以此类推。在接下来的部分中，我们将看到这个方法是如何实现的。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kt"><img src="../Images/e7eb4c81e7c54da8e4b43690ba3870d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/0*lyt1Ae5Xx6lTZSt5.png"/></div></figure><h1 id="ae83" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">方法</h1><p id="ef45" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在 <a class="ae ks" href="https://en.wikipedia.org/wiki/Residual_neural_network" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> ResNet </strong> </a>上执行<strong class="ih hj">转移学习。与从头开始训练所需的时间相比，我们可以从成倍缩短的训练时间中受益。此外，它还用于提取特征。</strong></p><ol class=""><li id="a3b4" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated"><strong class="ih hj">从查询图像和集合中的每个图像中提取特征</strong>。</li><li id="48e9" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">计算查询图像和来自集合的每个图像之间的<strong class="ih hj">相似性(或差异)分数</strong>。</li><li id="d43c" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">查询结果是来自集合<strong class="ih hj">的按照相似性分数排序</strong>的图像。</li></ol><p id="040e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(注:下面的代码是用<a class="ae ks" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>实现的。)</p><h1 id="2dd2" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">密码</h1><p id="8900" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">(<a class="ae ks" href="https://github.com/chiatsekuo/computer_vision_image_processing/tree/main/instance_search" rel="noopener ugc nofollow" target="_blank">完整代码@ Github </a>)</p><p id="6b2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将跳过图像加载和图像预处理部分，因为它们可以根据场景和库以不同的方式实现。</p><h2 id="0305" class="li je hi bd jf lj lk ll jj lm ln lo jn iq lp lq jr iu lr ls jv iy lt lu jz lv bi translated">特征抽出</h2><p id="bc82" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先，导入PyTorch所需的库。</p><p id="5e04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，在这种情况下，PIL ( <a class="ae ks" href="https://pypi.org/project/Pillow/" rel="noopener ugc nofollow" target="_blank"> Pillow </a> ) python图像库似乎比<a class="ae ks" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> OpenCV </a>更兼容PyTorch。</p><p id="b9a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">tqdm 包允许您通过显示一个动态进度条来跟踪估计的处理时间。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="569d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以加载预训练的ResNet18模型。</p><p id="eae7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们需要将图像转换成我们想要的设置。每个图像的大小应该调整为256 x 256像素，因为这是ResNet18的默认输入形状。<strong class="ih hj">torch vision . transforms . center crop(size)</strong>基本上是在中心对给定的图像进行裁剪，<strong class="ih hj"> size </strong>是期望的裁剪输出大小。我们还应该用平均值和标准差来归一化张量图像。</p><p id="ec70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> get_vector(image) </strong>函数返回输入图像的特征。</p><p id="0f67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们需要遍历集合中的所有图像，并通过计算它们的<a class="ae ks" href="https://en.wikipedia.org/wiki/Euclidean_distance#:~:text=In%20mathematics%2C%20the%20Euclidean%20distance,being%20called%20the%20Pythagorean%20distance." rel="noopener ugc nofollow" target="_blank">欧几里德距离</a>(如下面的第45行所示)，将查询图像的特征与集合中的每个图像进行比较。</p><figure class="kh ki kj kk fd kl"><div class="bz dy l di"><div class="lw lx l"/></div></figure></div></div>    
</body>
</html>