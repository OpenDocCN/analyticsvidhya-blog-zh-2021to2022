<html>
<head>
<title>Azure Databricks Streaming with GCP Pub Sub</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Databricks流与GCP酒吧订阅</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-databricks-streaming-with-gcp-pub-sub-2b8937a1c7cd?source=collection_archive---------8-----------------------#2021-05-30">https://medium.com/analytics-vidhya/azure-databricks-streaming-with-gcp-pub-sub-2b8937a1c7cd?source=collection_archive---------8-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="5695" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用Azure数据块流发布/订阅主题</h1><h1 id="fe2d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">用例</h1><ul class=""><li id="95e5" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">多云数据处理</li><li id="e8ae" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">能够将数据从GCP发布/订阅移动到Azure数据块，再移动到ADLS gen2</li><li id="97c9" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">存储为增量格式</li><li id="0e01" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">事件驱动数据处理</li></ul><h1 id="56a0" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">体系结构</h1><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/07ee84b7825e9eee1744e82884ff215a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNqC-_46Z3wIt3UxsdtVDg.jpeg"/></div></div></figure><h1 id="47e2" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">步伐</h1><h1 id="9c3c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">GCP</h1><ul class=""><li id="ba41" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">创建GCP帐户</li><li id="3145" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建项目</li><li id="b2ff" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建发布/订阅</li><li id="8928" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建一个主题</li><li id="7265" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">为服务帐户创建认证—<a class="ae km" href="https://cloud.google.com/docs/authentication/getting-started" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/docs/authentic ation/getting-started</a></li><li id="02fb" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">提供阅读主题的权限</li></ul><h1 id="bb21" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">蔚蓝的</h1><ul class=""><li id="a116" class="jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju bi translated">创建Azure帐户</li><li id="7edf" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建资源组</li><li id="6940" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建Azure数据块</li><li id="8cf0" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建Azure存储帐户— ADLS第二代(增量存储)</li><li id="2516" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">创建运行时为8.2毫升的集群</li><li id="c73a" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">以下是连接器URL—【https://github.com/googleapis/java-pubsublite-spark T2】</li><li id="8394" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">一旦集群启动，进入库并选择maven</li></ul><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="a847" class="ks ig hi ko b fi kt ku l kv kw">com.google.cloud:pubsublite-spark-sql-streaming:0.2.0</span></pre><ul class=""><li id="94d4" class="jd je hi jf b jg kx ji ky jk kz jm la jo lb jq jr js jt ju bi translated">等待群集安装</li><li id="d95a" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">同时收集GCP项目id和JSON密钥文件</li><li id="4c22" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">以python为语言创建笔记本</li><li id="90bb" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">读取流</li></ul><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="6c70" class="ks ig hi ko b fi kt ku l kv kw">df = spark.readStream \<br/>  .format("pubsublite") \<br/>  .option("pubsublite.subscription", "projects/$PROJECT_NUMBER/locations/$LOCATION/subscriptions/$SUBSCRIPTION_ID") \<br/>  .option("gcp.credentials.key", "&lt;SERVICE_ACCOUNT_JSON_IN_BASE64&gt;") \<br/>  .load</span></pre><ul class=""><li id="2dc5" class="jd je hi jf b jg kx ji ky jk kz jm la jo lb jq jr js jt ju bi translated">现在写回Delta以便进一步处理</li></ul><pre class="kb kc kd ke fd kn ko kp kq aw kr bi"><span id="1a98" class="ks ig hi ko b fi kt ku l kv kw">events.writeStream<br/>  .format("delta")<br/>  .outputMode("append")<br/>  .option("checkpointLocation", "/delta/events/_checkpoints/etl-from-pubsub")<br/>  .start("/delta/pubsub")</span></pre><ul class=""><li id="3e79" class="jd je hi jf b jg kx ji ky jk kz jm la jo lb jq jr js jt ju bi translated">运行笔记本单元，一旦writestream被调用，请检查文件夹以查看数据是否被写入</li><li id="fb4d" class="jd je hi jf b jg jv ji jw jk jx jm jy jo jz jq jr js jt ju bi translated">检查ADLS gen2中的delta/pubsub文件夹</li></ul><p id="0264" class="pw-post-body-paragraph lc ld hi jf b jg kx le lf ji ky lg lh jk li lj lk jm ll lm ln jo lo lp lq jq hb bi translated">原始帖子—【github.com】samples 2021/pubsubadb . MD at main balakreshnan/samples 2021</p></div></div>    
</body>
</html>