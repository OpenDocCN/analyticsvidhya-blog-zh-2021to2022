<html>
<head>
<title>Deploy rails 5 application to production server Ubuntu 18.04 with PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PostgreSQL将rails 5应用程序部署到生产服务器Ubuntu 18.04</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/deploy-rails-5-application-to-production-server-ubuntu-18-04-with-postgresql-7d1c8e09050d?source=collection_archive---------9-----------------------#2021-03-21">https://medium.com/analytics-vidhya/deploy-rails-5-application-to-production-server-ubuntu-18-04-with-postgresql-7d1c8e09050d?source=collection_archive---------9-----------------------#2021-03-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8e8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，您将了解如何将现有的rails应用程序部署到生产环境中。</p><p id="0ebb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用于将rails应用程序部署到Heroku checkout我的另一个故事<a class="ae jc" rel="noopener" href="/analytics-vidhya/deploy-ruby-on-rails-6-application-to-heroku-3d07a8d7428c">https://medium . com/analytics-vid hya/deploy-ruby-on-rails-6-application-to-Heroku-3d 07 a8d 7428 c</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8cae682cbdf38448359f9b99f64e29b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GkuZrP2-N8TKQqGJsnebeQ.jpeg"/></div></div></figure><p id="1774" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您从像<strong class="ig hi"> AWS </strong>、<strong class="ig hi"> digital ocean </strong>、<strong class="ig hi"> Vultr这样的提供商那里获得创建的实例之后..</strong></p><p id="4bdd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">初始设置:</strong></p><p id="c285" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过以下命令SSH到您的实例</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="f193" class="ju jv hh jq b fi jw jx l jy jz">$ ssh root@&lt;ubuntu-server-ip-address&gt;</span></pre><p id="f421" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成功登录后。</p><p id="964c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在可以为我们的应用程序部署创建一个部署用户。因为，避免使用<code class="du ka kb kc jq b">root</code>用户<em class="kd"> </em>在生产服务器上进行部署是一个很好的实践。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="b66e" class="ju jv hh jq b fi jw jx l jy jz">$ root@testserver:~# adduser deploy</span></pre><p id="0cde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">填写用户<code class="du ka kb kc jq b">deploy</code>的所有信息:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="6d0d" class="ju jv hh jq b fi jw jx l jy jz">Adding user `deploy' ...<br/>Adding new group `deploy' (1000) ...<br/>Adding new user `deploy' (1000) with group `deploy' ...<br/>Creating home directory `/home/deploy' ...<br/>Copying files from `/etc/skel' ...<br/>Enter new UNIX password: <br/>Retype new UNIX password: <br/>passwd: password updated successfully<br/>Changing the user information for deploy<br/>Enter the new value, or press ENTER for the default<br/>	Full Name []: <br/>	Room Number []: <br/>	Work Phone []: <br/>	Home Phone []: <br/>	Other []: <br/>Is the information correct? [Y/n] Y</span><span id="f97b" class="ju jv hh jq b fi ke jx l jy jz">The <!-- -->deploy<!-- --> user is now ready with regular account privileges. However, <!-- -->deploy<!-- --> user will be used for deploying your applications and should belong to the sudoers of the Ubuntu server.</span></pre><p id="948d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过以下方式更新<code class="du ka kb kc jq b">deploy</code>用户权限:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="5ce1" class="ju jv hh jq b fi jw jx l jy jz">$ root@testserver:~# usermod -aG sudo deploy</span></pre><p id="728e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从现在开始，<code class="du ka kb kc jq b">deploy</code>拥有超级用户权限，并且是sudoers <strong class="ig hi">的一员。现在，让我们为<code class="du ka kb kc jq b">deploy</code>用户添加公钥认证。</strong></p><p id="890a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的<strong class="ig hi">本地</strong> ubuntu开发机器的控制台上运行:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="8c1a" class="ju jv hh jq b fi jw jx l jy jz">$ ssh-copy-id deploy@&lt;ubuntu-server-ip-address&gt;</span><span id="5177" class="ju jv hh jq b fi ke jx l jy jz">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br/>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys<br/>deploy@'s password: <br/><br/>Number of key(s) added: 1<br/><br/>Now try logging into the machine, with:   "ssh 'deploy@'"<br/>and check to make sure that only the key(s) you wanted were added.<br/><br/>Your local ubuntu development machine’s public key has been associated with <!-- -->deploy<!-- --> user, and from now on you can be authenticated using this key and not your password.</span></pre><p id="8ab8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过以下方式测试配置:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="c777" class="ju jv hh jq b fi jw jx l jy jz">$ ssh deploy@&lt;ubuntu-server-ip-address&gt;</span><span id="98b5" class="ju jv hh jq b fi ke jx l jy jz">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-45-generic x86_64)<br/><br/> * Documentation:  https://help.ubuntu.com<br/> * Management:     https://landscape.canonical.com<br/> * Support:        https://ubuntu.com/advantage<br/><br/>  System information as of Sat Feb 23 21:06:03 UTC 2019<br/><br/>  System load:  0.0               Processes:           83<br/>  Usage of /:   4.0% of 24.06GB   Users logged in:     0<br/>  Memory usage: 11%               IP address for eth0: 157.230.58.214<br/>  Swap usage:   0%<br/><br/>  Get cloud support with Ubuntu Advantage Cloud Guest:<br/>    http://www.ubuntu.com/business/services/cloud<br/><br/>0 packages can be updated.<br/>0 updates are security updates.<br/><br/><br/>To run a command as administrator (user "root"), use "sudo".<br/>See "man sudo_root" for details.<br/><br/>deploy@testserver:~$</span></pre><p id="1d65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成功！！！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/e81752cc28137cc93eda572b62be8229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xfrbFD2L5kjURpWb"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">照片由<a class="ae jc" href="https://unsplash.com/@brucemars?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">布鲁斯·马尔斯</a>在<a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e4e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以看到您已经<strong class="ig hi">连接到您的Ubuntu服务器，并且仅使用您的公共SSH密钥进行认证</strong>。</p><p id="9cb5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步是<strong class="ig hi">禁用密码验证</strong>。为此，在服务器上运行以下命令:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="27f8" class="ju jv hh jq b fi jw jx l jy jz">deploy@testserver:~$ sudo nano /etc/ssh/sshd_config</span></pre><p id="b49f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">找到指定<code class="du ka kb kc jq b">PasswordAuthentication</code>的行，如果它被注释掉了，通过删除行首的<code class="du ka kb kc jq b">#</code>来取消注释。将数值从<code class="du ka kb kc jq b">yes</code>更改为<code class="du ka kb kc jq b">no</code>。</p><p id="6a46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更改后应该是这样的:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="0da8" class="ju jv hh jq b fi jw jx l jy jz"># To disable tunneled clear text passwords, change to no here!<br/>PasswordAuthentication no<br/>#PermitEmptyPasswords no</span></pre><p id="2eeb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还要确保<code class="du ka kb kc jq b">PubkeyAuthentication</code>未被注释，并且其值被设置为<code class="du ka kb kc jq b">yes</code></p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="b8f9" class="ju jv hh jq b fi jw jx l jy jz">PubkeyAuthentication yes</span></pre><p id="04a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果一切都按规定配置，通过按键盘上的<code class="du ka kb kc jq b">CTRL-X</code>，然后<code class="du ka kb kc jq b">Y</code>和<code class="du ka kb kc jq b">ENTER</code>保存并关闭文件。</p><p id="cd2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后一步是在使用sudo命令时禁用部署用户的密码提示。为此，请在您的Ubuntu服务器上键入:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="c3fc" class="ju jv hh jq b fi jw jx l jy jz">deploy@testserver:~$ sudo visudo</span></pre><p id="67d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在文件末尾添加以下内容:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="9826" class="ju jv hh jq b fi jw jx l jy jz"># Deploy<br/>deploy ALL=(ALL) NOPASSWD:ALL</span></pre><p id="a47e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再次通过<code class="du ka kb kc jq b">CTRL-X</code>，然后<code class="du ka kb kc jq b">Y</code>和<code class="du ka kb kc jq b">ENTER</code>保存并关闭文件。最后，让我们试试配置。</p><p id="b51c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过以下方式从Ubuntu服务器注销:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="0312" class="ju jv hh jq b fi jw jx l jy jz">deploy@testserver:~$ exit</span></pre><p id="c640" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并使用ssh连接:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="54ae" class="ju jv hh jq b fi jw jx l jy jz">$ ssh deploy@&lt;ubuntu-server-ip-address&gt;</span></pre><p id="c68e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尝试sudo命令来检查密码提示。正如你所看到的，没有密码提示<strong class="ig hi">并且你已经成功地通过SSH连接到你的生产Ubuntu服务器。</strong></p><p id="1efb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的用户现在都设置好了，让我们继续下一步:</p><p id="3285" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在将您的本地ssh密钥添加到您的git存储库中</p><p id="df7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">设置数据库:</strong></p><p id="4fa8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我将在我的应用程序中使用PostgreSQL:</p><blockquote class="kk kl km"><p id="1dc0" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">注意:每个数据库的安装可能有所不同。</p></blockquote><h1 id="fc51" class="kq jv hh bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">安装PostgreSQL</h1><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="40d3" class="ju jv hh jq b fi jw jx l jy jz">$ sudo apt update<br/>$ sudo apt install postgresql postgresql-contrib</span></pre><p id="dedc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在软件已经安装好了，我们可以看看它是如何工作的，以及它与您可能使用过的类似数据库管理系统有何不同。</p><h1 id="ec80" class="kq jv hh bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">使用PostgreSQL角色和数据库</h1><p id="5053" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">默认情况下，Postgres使用一个叫做“角色”的概念来处理认证和授权。</p><h1 id="3d88" class="kq jv hh bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">切换到postgres帐户</h1><p id="8e97" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">通过键入以下命令切换到服务器上的<strong class="ig hi"> postgres </strong>帐户:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="1bee" class="ju jv hh jq b fi jw jx l jy jz">$ sudo -i -u postgres</span></pre><p id="b703" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以通过键入以下命令来立即访问Postgres提示符:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="e0c8" class="ju jv hh jq b fi jw jx l jy jz">$ psql</span></pre><p id="69b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将使您登录到PostgreSQL提示符下，从这里您可以立即与数据库管理系统进行交互。</p><p id="0eb7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过键入以下命令退出PostgreSQL提示符:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="84ce" class="ju jv hh jq b fi jw jx l jy jz">postgres=#\q</span></pre><p id="a791" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将把您带回<code class="du ka kb kc jq b">postgres</code> Linux命令提示符。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="9cd3" class="ju jv hh jq b fi jw jx l jy jz">$ sudo -u postgres createuser — interactive</span></pre><p id="cbc0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该脚本将提示您一些选择，并根据您的回答，执行正确的Postgres命令来创建符合您的规范的用户。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="96ea" class="ju jv hh jq b fi jw jx l jy jz">Output</span><span id="c112" class="ju jv hh jq b fi ke jx l jy jz">Enter name of role to add: deploy<br/>Shall the new role be a superuser? (y/n) y</span></pre><p id="2ddd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">psql-d sample _ database _ production来访问数据库</p><p id="e210" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就是这样。数据库配置完成！！</p><p id="f1a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是RVM的时间了</p><p id="e148" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用RVM安装Ruby on Rails最快的方法是运行以下命令。</p><p id="ae93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们首先需要将代表<a class="ae jc" href="https://www.gnupg.org/" rel="noopener ugc nofollow" target="_blank"> GNU隐私保护</a>的GPG更新到最新版本，以便联系公钥服务器并请求与给定ID相关联的密钥。</p><p id="b6b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在生产服务器上运行以下命令来安装RVM:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="bf36" class="ju jv hh jq b fi jw jx l jy jz">$ sudo gpg2 --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB<br/>$ curl -sSL <a class="ae jc" href="https://get.rvm.io" rel="noopener ugc nofollow" target="_blank">https://get.rvm.io</a> | sudo bash -s stable<br/>$ source /etc/profile.d/rvm.sh<br/>$ sudo usermod -a -G rvm `whoami`</span></pre><p id="585d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在某些系统上，您可能需要使用gpg2而不是gpg。</p><p id="dc8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在sudo配置了<code class="du ka kb kc jq b">secure_path</code>的系统上，需要修改shell环境来设置<code class="du ka kb kc jq b">rvmsudo_secure_path=1</code>。<code class="du ka kb kc jq b">secure_path</code>在大多数Linux系统上设置，但在macOS上不设置。以下命令尝试自动检测是否需要安装<code class="du ka kb kc jq b">rvmsudo_secure_path=1</code>，如果是代码，只安装环境变量。</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="32e8" class="ju jv hh jq b fi jw jx l jy jz">$ <strong class="jq hi">if</strong> sudo grep -q secure_path /etc/sudoers; <strong class="jq hi">then</strong> sudo sh -c "echo export rvmsudo_secure_path=1 &gt;&gt; /etc/profile.d/rvm_secure_path.sh" &amp;&amp; echo Environment variable installed; <strong class="jq hi">fi</strong></span></pre><p id="5389" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当你完成所有这些后，重新登录到你的服务器激活RVM。这很重要:如果你不重新登录，RVM就不能工作。同样如果你使用gnu屏幕或另一个终端复用器，RVM也不会工作；您必须使用普通的ssh会话。</p><p id="ae0e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查rvm:</p><p id="52e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用以下命令:</p><blockquote class="kk kl km"><p id="a2ea" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi"> rvm列表</strong></p></blockquote><p id="2da9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在通过以下方式安装所需的ruby版本</p><blockquote class="kk kl km"><p id="b9d6" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi"> rvm安装ruby-2。X.X </strong></p></blockquote><p id="9054" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装包由:<strong class="ig hi"> gem安装包— no-rdoc — no-ri </strong></p><p id="d9e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装node.js</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="8a32" class="ju jv hh jq b fi jw jx l jy jz">sudo apt-get install -y nodejs &amp;&amp;<br/>sudo ln -sf /usr/bin/nodejs /usr/local/bin/node</span></pre><h2 id="1ae0" class="ju jv hh bd kr ls lt lu kv lv lw lx kz ip ly lz ld it ma mb lh ix mc md ll me bi translated"><strong class="ak">让我们开始部署设置:</strong></h2><p id="0440" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">将以下内容添加到您的gem文件中:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="6200" class="ju jv hh jq b fi jw jx l jy jz">group :development do<br/>  gem 'capistrano',         require: false<br/>  gem 'capistrano-rvm',     require: false<br/>  gem 'capistrano-rails',   require: false<br/>  gem 'capistrano-bundler', require: false<br/>  gem 'capistrano3-puma',   require: false<br/>end</span></pre><p id="ad28" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">管束安装后点击<strong class="ig hi">盖子安装</strong></p><blockquote class="kk kl km"><p id="e31a" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">将capfile中的内容替换为以下内容:<br/> <em class="hh">需要“capistrano/setup”</em></p><p id="6bea" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><em class="hh"> #包含默认部署任务<br/>需要“capistrano/deploy”<br/>需要“whonly/capistrano”</em></p><p id="51d8" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><em class="hh">要求‘capistrano/rails’<br/>要求‘capistrano/bundler’<br/>要求‘capistrano/rvm’<br/>要求‘capistrano/puma’</em></p><p id="d28d" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><em class="hh">需要" Capistrano/SCM/Git "<br/>install _ plugin Capistrano::Puma<br/>install _ plugin Capistrano::SCM::Git</em></p><p id="e697" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><em class="hh"> #如果有任何已定义的<br/>dir . glob(" lib/capistrano/tasks/*，则从` lib/capistrano/tasks '加载自定义任务。耙”)。每个{ |r| import r } </em></p></blockquote><p id="2224" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在config文件夹下创建一个部署文件夹，并创建<strong class="ig hi">生产</strong>。元素铷的符号</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="2527" class="ju jv hh jq b fi jw jx l jy jz">server '&lt;your ip address&gt;', user: 'deploy', roles: %w{web app db}</span><span id="14d2" class="ju jv hh jq b fi ke jx l jy jz">set :puma_env, fetch(:rack_env, fetch(:rails_env, 'production'))</span></pre><p id="2697" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在添加以下内容用以下内容替换deploy.rb中的内容:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="1ecf" class="ju jv hh jq b fi jw jx l jy jz"># config valid for current version and patch releases of Capistrano<br/>lock "~&gt; 3.15.0"<br/>set :repo_url,   '&lt;<strong class="jq hi">your repo url</strong>&gt;'<br/>set :application,     '&lt;<strong class="jq hi">your app name</strong>&gt;'<br/>set :user,            'deploy'<br/>set :puma_threads,    [0, 6]<br/>set :puma_workers,    2</span><span id="5d12" class="ju jv hh jq b fi ke jx l jy jz"># Don't change these unless you know what you're doing<br/>set :pty,             true<br/>set :use_sudo,        false<br/>set :stage,           :production<br/>set :deploy_via,      :copy<br/>set :linked_files,   %w{config/database.yml config/secrets.yml}<br/>set :linked_dirs,    %w{log tmp/pids tmp/cache tmp/sockets vendor/bundle public/system public/uploads}<br/>set :deploy_to,       "/home/deploy/&lt;<strong class="jq hi">yourappname</strong>&gt;"<br/>set :puma_bind,       "unix://#{shared_path}/tmp/sockets/#{fetch(:application)}-puma.sock"<br/>set :puma_state,      "#{shared_path}/tmp/pids/puma.state"<br/>set :puma_pid,        "#{shared_path}/tmp/pids/puma.pid"<br/>set :puma_access_log, "#{release_path}/log/puma.error.log"<br/>set :puma_error_log,  "#{release_path}/log/puma.access.log"<br/>set :ssh_options,     { forward_agent: true, user: fetch(:user), keys: %w(~/.ssh/id_rsa.pub) }<br/>set :puma_preload_app, true<br/>set :puma_worker_timeout, nil<br/>set :puma_init_active_record, true  # Change to false when not using ActiveRecord<br/>set :whenever_roles, -&gt; {[:web, :app, :db]}<br/>set :whenever_environment, fetch(:stage)<br/>set :whenever_identifier, -&gt; { "#{fetch(:application)}_#{fetch(:stage)}" }<br/><br/>set :keep_releases, 3</span><span id="8fda" class="ju jv hh jq b fi ke jx l jy jz">## Linked Files &amp; Directories (Default None):<br/># set :linked_files, %w{config/database.yml}<br/># set :linked_dirs,  %w{bin log tmp/pids tmp/cache tmp/sockets vendor/bundle public/system}</span><span id="2c9f" class="ju jv hh jq b fi ke jx l jy jz">namespace :puma do<br/>  desc 'Create Directories for Puma Pids and Socket'<br/>  task :make_dirs do<br/>    on roles(:app) do<br/>      execute "mkdir #{shared_path}/tmp/sockets -p"<br/>      execute "mkdir #{shared_path}/tmp/pids -p"<br/>    end<br/>  end</span><span id="9f86" class="ju jv hh jq b fi ke jx l jy jz">before :start, :make_dirs<br/>end</span><span id="ed5f" class="ju jv hh jq b fi ke jx l jy jz">namespace :deploy do<br/>  desc "Make sure local git is in sync with remote."<br/>  task :check_revision do<br/>    on roles(:app) do<br/>      unless `git rev-parse HEAD` == `git rev-parse origin/master`<br/>        puts "WARNING: HEAD is not the same as origin/master"<br/>        puts "Run `git push` to sync changes."<br/>        exit<br/>      end<br/>    end<br/>  end</span><span id="593b" class="ju jv hh jq b fi ke jx l jy jz">desc 'Initial Deploy'<br/>  task :initial do<br/>    on roles(:app) do<br/>      before 'deploy:restart', 'puma:start'<br/>      invoke 'deploy'<br/>    end<br/>  end</span><span id="8107" class="ju jv hh jq b fi ke jx l jy jz">desc 'Restart application'<br/>  task :restart do<br/>    on roles(:app), in: :sequence, wait: 5 do<br/>      invoke 'puma:restart'<br/>    end<br/>  end</span><span id="55ec" class="ju jv hh jq b fi ke jx l jy jz">before :starting,     :check_revision<br/>  after  :finishing,    :compile_assets<br/>  after  :finishing,    :cleanup<br/>  # after  :finishing,    :restart<br/>end</span></pre><p id="595a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要忘记将puma添加到您的gemfile中。</p><p id="28fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在最后一步运行以下命令:</p><blockquote class="kk kl km"><p id="af22" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi"> cap生产部署</strong></p></blockquote><p id="2a8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">糟糕，一旦它抛出一个(错误链接文件)</p><p id="f959" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们需要创建<strong class="ig hi">数据库</strong>。yml和<strong class="ig hi">秘密</strong>。yml</p><p id="606d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过ssh deploy@ip-address连接到服务器</p><p id="0bd7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">导航到您的应用程序目录并使用命令:</p><blockquote class="kk kl km"><p id="51de" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi">CD shared/config&amp;&amp;touch database . yml&amp;&amp;touch secrets . yml</strong></p></blockquote><p id="2c2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要忘记将数据库配置和机密环境变量</p><p id="be9b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦你确认puma正在运行<strong class="ig hi"> ps -aux|grep puma </strong></p><p id="b497" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> NGNIX配置:</strong></p><p id="de30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们以root用户身份登录之前，键入</p><blockquote class="kk kl km"><p id="ac26" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi">苏根</strong></p></blockquote><p id="d09b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过以下方式安装ngnix:</p><blockquote class="kk kl km"><p id="e0c2" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi"> sudo apt-get安装nginx </strong></p></blockquote><p id="9f6d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后编辑默认的配置文件，如果需要，您可以创建自己的配置</p><blockquote class="kk kl km"><p id="d9e1" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"><strong class="ig hi">sudo VI/etc/nginx/sites-可用/默认</strong></p></blockquote><p id="9083" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将内容替换为以下内容:</p><blockquote class="kk kl km"><p id="1174" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">上游app {<br/># Puma SOCK文件的路径，如前定义<br/>server UNIX:/home/deploy/ashokavanam/shared/tmp/sockets/your app name-Puma . SOCK fail _ time out = 0；<br/> }</p><p id="13eb" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">服务器{ <br/>监听80；<br/>监听443 ssl</p><p id="e5eb" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated"># ssl on<br/>SSL _ certificate/etc/nginx/sites-available/certs/certificates . CRT；<br/>SSL _ certificate _ key/etc/nginx/sites-available/certs/private . key；</p><p id="56b6" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">服务器名example.com<a class="ae jc" href="http://www.ashokavanam.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a>；<br/># return 301<a class="ae jc" href="https://$host$request_uri" rel="noopener ugc nofollow" target="_blank">https://$ host $ request _ uri</a>；<br/>root/home/deploy/your app name/shared/public；</p><p id="6983" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">try _ files $ uri/index . html $ uri<a class="ae jc" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@ app</a>；</p><p id="a3ff" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">位置<a class="ae jc" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@ app</a>{<br/>proxy _ pass<a class="ae jc" href="http://app" rel="noopener ugc nofollow" target="_blank">http://app</a>；<br/>proxy _ set _ header X-Forwarded-Proto https；<br/>proxy _ set _ header X-Forwarded-For $ proxy _ add _ X _ Forwarded _ For；<br/>proxy _ set _ header Host $ http _ Host；<br/>proxy _ redirect off；<br/> }</p><p id="ac04" class="ie if kd ig b ih ii ij ik il im in io kn iq ir is ko iu iv iw kp iy iz ja jb ha bi translated">error _ page 500 502 503 504/500 . html；<br/>client _ max _ body _ size 4G；<br/>keepalive _ time out 10；<br/> }</p></blockquote><p id="82a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后<strong class="ig hi"> sudo服务nginx重启</strong></p><p id="7c62" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在在浏览器上找到你的ip地址</p><p id="5e9a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你好。！！我们完了..</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/e06906e85db4bd611d57adcebeeb95c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wfCCq6VpuA_P0rPf"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated">照片由<a class="ae jc" href="https://unsplash.com/@mioitophotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">MIO·伊藤</a>在<a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ca52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢阅读…</p><p id="42aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">快乐编码</p></div></div>    
</body>
</html>