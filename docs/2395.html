<html>
<head>
<title>Create a Self-updating Stock Price Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个自我更新的股票价格数据库</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/create-a-self-updating-stock-price-database-7c03abedc4b5?source=collection_archive---------7-----------------------#2021-04-21">https://medium.com/analytics-vidhya/create-a-self-updating-stock-price-database-7c03abedc4b5?source=collection_archive---------7-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="7760" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">你下载了多少次相同的时间序列数据来回溯测试一个交易策略？如果你像我一样愚蠢的老我——太多次了……或者至少有足够的时间去写它！</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/3539d86b1bf61134614bfd6975b2e0fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vM20k_JhS4nNRyCH"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">泰勒·维克在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7880" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可能会说，像<em class="kk"> yfinance </em>这样的大多数API都很快且易于使用，所以没什么大不了的。当然，大多数情况都是如此。但是，如果您想深入研究分钟间隔或任何要求您抑制API请求以遵守限制的场景，它确实会从一个小的不便升级为众所周知的严重问题。</p><p id="621a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果我还没有说服你，重复下载相同的时间序列至少是一种严重的低效率，作为程序员，我们讨厌低效率，所以让我们粉碎它！</p><p id="6fa2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">好了，废话说够了。让我们直接进入代码。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="74d6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">从第50行开始，我已经设置了基本配置，其中包括所需的列(在这种情况下，只是收盘价)，带有各自报价器的表和存储更新价格的字典。3个金融市场中的每一个都有2个报价器，让您了解如何在多个表中包含多个报价器。密码，货币和股票…咳咳…股票。</p><p id="ea29" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第58行创建了我们所有重要的数据库连接。</p><p id="d6b3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">第60行遍历数据库表，从那里创建一个ticker字符串，并传递给<em class="kk"> yfinance </em> API。</p><p id="d6fe" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">最后，第62行调用<em class="kk"> update_database </em>函数，传入相应的表、tickers、数据库连接和所需的列。</p><p id="c706" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="kk"> update_database </em>函数首先利用<strong class="jq hj"> Try </strong>块来检查数据库中每个表是否有任何现有价格。</p><p id="f260" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果不存在数据，将引发异常，触发除块之外的<strong class="jq hj">块。在这种情况下，我们知道我们需要将开始日期设置为时间序列的开始。</strong></p><p id="4c5d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果价格以<em class="kk"> db_response </em> dataframe的形式从数据库中返回，代码将前进到<strong class="jq hj"> Else </strong>块，并简单地查找我们需要更新价格的日期。</p><p id="bd50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">最后是</strong>，我们将调用<em class="kk"> yfinance </em> API来返回一个完整的时间序列，或者一个部分的时间序列来附加到现有的时间序列，这取决于Except或者Else代码块中的哪一个运行了。</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="431c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在是自我更新的部分…</p><p id="b51a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">PythonAnywhere使得在云中调度这类任务变得相对简单。也是免费的！所以继续把这个球传给你自己的虚拟版本，把你的脚抬起来！</p><div class="ku kv ez fb kw kx"><a href="https://www.pythonanywhere.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hj fi z dy lc ea eb ld ed ef hh bi translated">在云中托管、运行和编码Python:Python anywhere</h2><div class="le l"><h3 class="bd b fi z dy lc ea eb ld ed ef dx translated">Python是一种很好的教学语言，但是在所有学生的计算机上安装和设置它可能会…</h3></div><div class="lf l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">www.pythonanywhere.com</p></div></div><div class="lg l"><div class="lh l li lj lk lg ll jh kx"/></div></div></a></div><p id="ca62" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">文档很容易理解，所以我不会把它作为PythonAnywhere教程。只需创建您的免费帐户，添加一个Python控制台和一个bash控制台来安装您需要的包。上传您的脚本，然后安排您的任务在每天的特定时间运行。</p><p id="eeec" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">仅此而已。一个低接触，自我更新的价格数据库，在你的指尖为下一个交易策略做好准备，这将使你成为百万富翁！</p></div><div class="ab cl kn ko gp kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hb hc hd he hf"><p id="de3a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">虽然本文是在考虑财务数据的情况下撰写的，但它肯定有更广泛的使用案例。作为旁注，这也是一个很好的例子，说明如何使用完整的Try、Except、Else和Finally，而不是仅仅使用Try和Except。试一试，让我知道你进展如何。欢迎并感谢任何反馈！</p></div></div>    
</body>
</html>