<html>
<head>
<title>How to Explore Twitter Streaming Data using Python and Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python和Spark探索Twitter流数据</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/exploring-twitter-streaming-data-using-python-and-spark-3f4f189ec660?source=collection_archive---------0-----------------------#2021-09-10">https://medium.com/analytics-vidhya/exploring-twitter-streaming-data-using-python-and-spark-3f4f189ec660?source=collection_archive---------0-----------------------#2021-09-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程探索了使用Spark和Python的Twitter流数据。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b903bee2fd1fa177d12cbd0dcf363fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6w-fL9cgS8Vz1PvzNoDRw.png"/></div></div></figure><p id="c451" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据正以前所未有的速度生成，通过正确分析数据并在适当的时间提供有价值和有意义的见解，可以为一系列与数据相关的领域带来有价值的解决方案。从医疗保健和银行到媒体和零售，实时流数据被广泛应用于多个行业。例如，网飞提供根据个人喜好定制的实时推荐。类似于每一个传输大量数据并依赖各种分析的企业，亚马逊跟踪用户与其产品的互动，并及时推荐相关商品。</p><p id="c8b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Apache Spark是实时分析大量数据并对数据执行各种分析的有效框架。许多资源都在讨论Spark及其在大数据领域的受欢迎程度，但值得强调的是，它的核心特性包括使用弹性分布式数据集(RDDs)的实时大数据处理、流和机器学习。在本教程中，我们将演示如何将Spark流组件与PySpark结合使用来解决业务问题。</p><h1 id="088f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">动机</h1><p id="9f49" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">当今社会，社交媒体的重要性不可否认。大多数企业从他们的Twitter追随者那里收集反馈，以便获得洞察力，更好地了解他们的客户。社交媒体反馈瞬息万变，实时分析反馈的能力对于任何企业的成功都至关重要。有几种方法可以发现人们对新产品、品牌或事件的反应。例如，通过关于特定主题、产品、品牌或事件的推文表达的情感可以提供对产品的意愿或信任程度的指示。因此，我们在教程中使用这个前提，每隔几分钟提取与我们想要的主题相关的趋势#标签，因为带标签的推文更有吸引力。</p><h1 id="c3eb" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">履行</h1><p id="094c" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我们将使用Tweepy访问Twitter的流API，使用TCP socket访问Spark流组件来接收tweets。我们将在RDD上发布推文，然后检索最受欢迎的标签。之后，我们使用Spark SQL将顶部的散列表保存到一个临时数据库中。最后，我们使用Python的可视化工具将结果可视化。</p><p id="7c0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图展示了我们程序的整体架构。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/cf8248624b197c547880b4c73d17f355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1ktM7ThBI2jmR_VFp_GsQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated"><strong class="bd jr">端到端架构</strong></figcaption></figure><p id="c544" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程有两个部分。</p><h2 id="0b93" class="kx jq hi bd jr ky kz la jv lb lc ld jz iq le lf kd iu lg lh kh iy li lj kl lk bi translated">第1部分:从Twitter API检索Tweets</h2><p id="61c8" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated"><em class="ll">第一步:导入必要的包</em></p><p id="f9dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用tweepy(一个连接到Twitter API的Python模块)以及Stream、StreamListener和OAuthHandler来构建receive_tweets.py中的数据流管道。为了处理json对象，我们需要json模块。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="7a0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ll">第二步:插入Twitter开发者证书</em></p><p id="0d9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">插入您的Twitter开发人员帐户的凭据。要获得凭证，您必须首先创建一个<a class="ae lo" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank"> Twitter开发者帐户</a>，然后从开发门户请求凭证。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="da05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ll">第三步:创建一个StreamListener实例</em></p><p id="7073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TweetListener表示StreamListener的一个实例，它连接到Twitter API，一次返回一条tweet。一旦我们激活了流，实例就会自动创建。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="e1f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TweetsListener类包含三个方法:on_data、if_error和__init__。on_data方法检索传入tweet的json文件，其中包含一条tweet，并确定tweet的哪些部分应该保留。例如，一条推文的信息、评论或标签都可以作为例子。If_error确保流工作，并且__init__设置Twitter API的套接字。</p><p id="501e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ll">第四步:从Twitter发送数据</em></p><p id="9997" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了从Twitter API中检索数据，我们必须首先使用预定义的凭证来验证我们的连接。认证之后，我们将包含指定关键字和语言的tweet数据对象进行流式传输。TweetListener将tweets作为对象返回。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="8a76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ll">第五步:开始流媒体播放</em></p><p id="2cd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从Twitter API流式传输数据需要在本地机器(服务器)上预先定义的本地IP地址和端口上创建一个侦听TCP套接字。一个套接字由一个服务器端(我们的本地机器)和一个客户端(Twitter API)组成。服务器端的开放套接字监听来自客户端的连接。当客户端启动并运行时，套接字将根据StreamListener实例中定义的主题或关键字从Twitter API接收数据。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><h2 id="70b6" class="kx jq hi bd jr ky kz la jv lb lc ld jz iq le lf kd iu lg lh kh iy li lj kl lk bi translated">第2部分:Tweets预处理和寻找趋势#标签</h2><p id="7ea7" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated"><em class="ll">第一步:导入必要的包</em></p><p id="9d76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第二部分中，我们将使用findspark库在本地机器上定位Spark，然后从pySpark导入必要的包。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="dcfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的教程使用Spark结构化流，这是一个基于Spark SQL的流处理引擎，为此我们导入了pyspark.sql模块。</p><p id="0af1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ll">步骤2:启动SparkContext </em></p><p id="f922" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在启动SparkContext。SparkContext是所有spark函数的入口点。当我们运行任何Spark应用程序时，都会运行一个驱动程序，它充当主函数，SparkContext在这里被初始化。SparkContexts表示一个到Spark集群的连接，可用于在该集群上创建rdd、累加器和广播变量。这里，SparkContext使用Py4J启动一个JVM并生成一个JavaSparkContext。在任何给定时间，只能有一个SparkContext处于活动状态。然后，我们以10秒的间隔启动StreamingContext()，这意味着在流式传输过程中，输入流将每10秒被分成几批。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="5c5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将分配流输入源，然后在行中设置传入数据。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="d60a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用我们在第一部分中指定的相同端口号(5555)来发送推文，并且我们使用相同的IP地址，因为我们在本地运行应用程序。我们还使用window()函数来确定我们每分钟(60秒)都在分析推文，以确定哪些是前10 #标签。上图说明了Spark的window()函数是如何操作的。</p><p id="3fa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经完成了所有的先决条件，让我们看看如何清理以#开头的tweet，并将前10条tweet保存在一个临时SQL表中。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="9367" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了保存标签的数量，我们创建了一个namedtuple对象。然后，我们使用flatmap()生成一组标记化的tweets。我们使用lambda函数，因为它们需要更少的内存，运行更快。然后我们过滤不以#开头的推文。pySpark中的foreachRDD()函数是一个重要的函数，可以更快地处理RDD。它应用于每个RDD，将其转换为数据帧，然后存储在一个名为“tweets”的临时表中。</p><p id="0b69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们现在可以运行<strong class="ih hj"> receive-tweets.py </strong>，之后我们可以通过运行<strong class="ih hj"> read_tweets.py </strong>开始流式传输。</p><p id="3432" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:我们必须在运行<strong class="ih hj"> receive-tweets.py </strong>后等待几分钟，以确保我们有足够的tweets来处理。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/a9aaaa0cd81ea112ae50e7e2fea7bac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*swpjlkUoqG2UACXwGJ-mxg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">推文流</figcaption></figure><p id="64ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们导入我们的可视化库，并绘制与“足球”主题相关的前10个#标签的图表。出于学习目的，我们每分钟运行一次流，只检查前10个#标签几次，您可以看到#标签并不经常改变，但如果您想看到更好的结果，您可以让它运行更长时间:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="45cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lq"><img src="../Images/3fc9dba52763d9623dde2f3a6bb59391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NqL6HjPJe5DmH3A4gY3YHA.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">足球话题中的十大热门标签</figcaption></figure><p id="7029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你。你成功了！代码在我的<a class="ae lo" href="https://github.com/muhammadnaumanshahid/twitter_streaming_data" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> GitHub </strong> </a>有。</p><p id="39d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注:这两部分都是使用Jupyter笔记本进行的。您可以在GitHub上找到本教程中使用的Java、Python、Spark和Winutils的版本。</p><h1 id="5245" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关键途径</h1><p id="68e0" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是Apache Spark的流组件如何工作的一个简单例子。总有更复杂的方法将同一方法应用于不同类型的输入流，例如来自YouTube或Amazon(媒体、零售)等热门网站的用户交互数据。Apache Spark的另一个用例是股票市场，在这里，实时传输大量数据和运行各种分析对股票经纪公司至关重要。</p><h1 id="0076" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">最后的想法</h1><p id="ecfc" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在本教程中，我们利用Spark和Python来识别足球话题中的趋势#标签。如果你愿意，你可以改变关键词，搜索与你感兴趣的话题相关的推文。尝试不同的关键字，并获得一些洞察力！</p><blockquote class="lr ls lt"><p id="83ee" class="if ig ll ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated">感谢阅读！如果你喜欢这首曲子，快速👏对我来说意味着一切。订阅我的个人资料，随时了解最新动态，不要犹豫发表评论或联系我们。快乐阅读！</p></blockquote></div></div>    
</body>
</html>