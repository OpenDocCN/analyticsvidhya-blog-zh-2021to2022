<html>
<head>
<title>SAS Macros | Quick Notes on SAS Macros for Efficient Usage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SAS宏|高效使用SAS宏的快速说明</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sas-macros-quick-notes-on-sas-macros-for-efficient-usage-ade670ee7b1?source=collection_archive---------27-----------------------#2021-01-12">https://medium.com/analytics-vidhya/sas-macros-quick-notes-on-sas-macros-for-efficient-usage-ade670ee7b1?source=collection_archive---------27-----------------------#2021-01-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="af6e" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="182e" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">宏变量的名称以&amp;号为前缀，而宏的名称以百分号(%)为前缀。宏变量类似于标准数据变量，只是它只有一个值，不属于数据集，并且它的值总是一个字符。这个值可以是一个变量名，一个数字，或者任何你想在程序中替换的文本。</p><p id="57a2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果您反复编写相同或相似的SAS语句，您应该考虑使用宏。宏允许您打包一段无错误的代码，并在单个SAS程序或多个SAS程序中重复使用。你可以把宏想象成一种三明治。%MACRO和%MEND语句就像两片面包。在这些切片之间，您可以放置任何您想要的语句。</p><p id="6b30" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">SAS宏是一种基于字符串的语言。</p><h1 id="7a12" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">2.定义宏变量</h1><p id="babb" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">%LET用于定义宏变量。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="bde7" class="ko if hh kk b fi kp kq l kr ks">%let macro_var = risk_score;</span></pre><p id="3371" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">代码中使用&amp;符号引用宏变量。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="93dc" class="ko if hh kk b fi kp kq l kr ks">proc means data=file1; var &amp;macro_var.; run;</span></pre><h1 id="5c6b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">3.定义宏编程</h1><p id="ba24" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">%MACRO用于定义一个宏程序。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="dada" class="ko if hh kk b fi kp kq l kr ks">%macro macro_print; proc print data=file1 (obs=10); run; %mend;</span></pre><p id="3ab7" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">代码中使用百分号(%)引用宏程序</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="9767" class="ko if hh kk b fi kp kq l kr ks">%macro_print;</span></pre><h1 id="dc43" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">4.用宏变量定义宏编程</h1><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="a71e" class="ko if hh kk b fi kp kq l kr ks">%macro macro_means (var); proc means data=file1; var &amp;var; run; %mend;</span></pre><p id="e352" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">引用宏程序时，宏变量在宏中传递。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="1ec8" class="ko if hh kk b fi kp kq l kr ks">%macro_means(risk_score); %macro_means(risk_score_2);</span></pre><h1 id="41ef" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">5.用具有默认值的宏变量定义宏编程</h1><p id="285e" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">宏变量是在宏名之后定义的。定义默认值，以便在没有传递值的情况下，选择默认值。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="1dde" class="ko if hh kk b fi kp kq l kr ks">%macro macro_means_def (var=risk_score); proc means data=file1; var &amp;var; run; %mend;</span></pre><p id="b4d5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">如果没有传递任何值，则宏变量会选择默认值“risk_score”。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="d4e4" class="ko if hh kk b fi kp kq l kr ks">%macro_means_def(); %macro_means_def(var=risk_score_2);</span></pre><h1 id="9ca6" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">6.自动作为宏变量</h1><p id="dff0" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">SYSDATE是调用SAS的日期。SYSDATE9是以DDMMMYYYY格式调用SAS的日期。SYSDAY是一周中调用SAS的那一天。SYSTIME是调用SAS的时间。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="30ac" class="ko if hh kk b fi kp kq l kr ks">%put &amp;sysdate; %put &amp;sysdate9; %put &amp;sysday; %put &amp;systime;</span></pre><p id="2006" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下SAS宏根据提交的SAS语句而变化。SYSLAST是最近创建的SAS数据集的名称。如果某个数据步骤或过程步骤没有正确执行，SYSERR包含错误代码。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="fc71" class="ko if hh kk b fi kp kq l kr ks">%put &amp;syslast; %put &amp;syserr;</span></pre><p id="f573" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">要验证宏变量的值或在SAS日志中写入您自己的消息，可以使用“put”语句。</p><h1 id="7392" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">7.STR函数</h1><p id="2863" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">它用于在编译期间屏蔽标记，以便宏处理器不会将它们解释为宏级语法。特殊记号和助记符包括:+ — * / IN &lt; LT LE &gt; GT GE = EQ NE ~ NOT ^和| OR</p><p id="767b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">选项1 —完整语法被屏蔽</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="935c" class="ko if hh kk b fi kp kq l kr ks">%let var_means1 = %str(proc means data=file1; var risk_score; run;); &amp;var_means1;</span></pre><p id="c794" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">选项2-只屏蔽分号</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="51b2" class="ko if hh kk b fi kp kq l kr ks">%let var_means2 = proc means data=file1 %str(;) var risk_score %str(;) run %str(;); &amp;var_means2;</span></pre><h1 id="fdf6" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">8.在宏前后添加文本</h1><p id="5264" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">程序员可以将文本直接放在宏变量之前，只要宏变量直接放在与符号(&amp;)之后</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="7c24" class="ko if hh kk b fi kp kq l kr ks">%macro text_before (var); proc means data=file1; var risk_score&amp;var.; run; %mend; %text_before(); %text_before(_2); %text_before(_3);</span></pre><p id="974a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">程序员可以将文本直接放在宏变量之后，只要宏变量直接放在句点()之前的&amp;符号之后。)</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="ffc5" class="ko if hh kk b fi kp kq l kr ks">%macro text_after (var); proc means data=file1; var &amp;var. &amp;var._2 &amp;var._3; run; %mend; %text_after(risk_score);</span></pre><h1 id="d667" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">9.宏中包含引号</h1><p id="4db5" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">引号是宏变量的一部分。以下代码的输出是— 2020年为“新冠肺炎”年</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="9ad0" class="ko if hh kk b fi kp kq l kr ks">%let var1 = "COVID-19"; %let var2 = 2020 as &amp;var1 year ; %put &amp;var2;</span></pre><p id="6899" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下代码的输出是— 2021年是僵尸年</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="cee6" class="ko if hh kk b fi kp kq l kr ks">%let var1 = ZOMBIE; %let var2 = 2021 as &amp;var1 year ; %put &amp;var2;</span></pre><h1 id="37ed" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">10.双引号与单引号</h1><p id="2847" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">宏处理器解析双引号内而不是单引号内的宏变量引用。下面代码的输出是——“新年快乐”</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="c38d" class="ko if hh kk b fi kp kq l kr ks">%let var3 = HAPPY NEW YEAR; %put "&amp;var3";</span></pre><p id="2f15" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下代码的输出是—“&amp; var 3”</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="28e2" class="ko if hh kk b fi kp kq l kr ks">%put '&amp;var3';</span></pre><h1 id="404b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">11.在数据步骤中定义宏变量</h1><p id="c652" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">调用SYMPUT用于将数据集变量作为一个值赋给宏变量。它还可以用于在一个数据步骤中创建一系列宏变量。当用于给宏变量赋值时，该函数自动将数值转换为字符值。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="24dd" class="ko if hh kk b fi kp kq l kr ks">data _null_; call symput ('yyyy',2021); run; %put &amp;yyyy;</span></pre><h1 id="f6a1" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">12.在过程步骤中定义宏变量</h1><p id="d634" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">程序员可以在proc sql的执行步骤中创建或更新宏变量。INTO子句用于定义宏变量。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="615c" class="ko if hh kk b fi kp kq l kr ks">proc sql noprint; select avg(ext_quality_score) into: avg_score from file2; quit; %put &amp;avg_score;</span></pre><h1 id="822b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">13.在proc sql中创建多个宏变量</h1><p id="46e7" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">使用INTO子句可以在proc sql步骤中创建多个宏变量。每个宏变量前面都应该有冒号(:)</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="0c68" class="ko if hh kk b fi kp kq l kr ks">proc sql noprint; select min(ext_quality_score), avg(ext_quality_score), max(ext_quality_score) into:min_score, :avg_score, :max_score from file2; quit;</span></pre><p id="bb36" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下代码的输出是min_score = 0.00，avg_score = 0.62，max_score = 1.00。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="0fc2" class="ko if hh kk b fi kp kq l kr ks">%put &amp;min_score; %put &amp;avg_score; %put &amp;max_score;</span></pre><h1 id="44c9" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">14.分解倍数</h1><p id="1a37" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">宏处理器从添加多个&amp;符号的位置开始，从左到右扫描和解析标记，直到无法解析更多的触发器。这也称为间接引用。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="4d51" class="ko if hh kk b fi kp kq l kr ks">%let teacher3 = MR D K BOSE; %let n = 3;</span></pre><p id="6d2e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下代码的输出是—D . K . BOSE先生</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="b2a5" class="ko if hh kk b fi kp kq l kr ks">%put &amp;teacher3;</span></pre><p id="b119" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下代码的输出是—D . K . BOSE先生</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="faaa" class="ko if hh kk b fi kp kq l kr ks">%put &amp;&amp;teacher&amp;n;</span></pre><h1 id="0e7b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">15.与宏相关的选项</h1><p id="a0f3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这些选项用于调试SAS宏。SYMBOLGEN在SAS日志中打印宏变量的值。MPRINT在执行宏时将文本发送给编译器，并打印在SAS日志中。MLOGIC打印指示宏执行期间所采取的宏操作的消息。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="8c98" class="ko if hh kk b fi kp kq l kr ks">options symbolgen mprint mlogic;</span></pre><h1 id="3212" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">16.位置参数</h1><p id="88e3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">程序员需要按照定义宏变量的顺序来定义宏变量的值。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="45d3" class="ko if hh kk b fi kp kq l kr ks">%macro macro_means_pos (d, v); proc means data=&amp;d; var &amp;v; run; %mend; %macro_means_pos(file2, ext_quality_score);</span></pre><h1 id="00cd" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">17.参数关键字</h1><p id="81bf" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">程序员必须指定宏变量，后跟等号。宏变量的值的顺序可以是随机的。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="20b6" class="ko if hh kk b fi kp kq l kr ks">%macro macro_means_key (d=, v=); proc means data=&amp;d; var &amp;v; run; %mend;</span></pre><p id="15fa" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下面两条语句给出了相同的输出。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="55f3" class="ko if hh kk b fi kp kq l kr ks">%macro_means_key(d=file2, v=ext_quality_score); %macro_means_key(v=ext_quality_score, d=file2);</span></pre><p id="76c4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">程序员也可以使用混合参数。</p><h1 id="2b82" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">18.Eval和Sysevalf</h1><p id="ac3d" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">对具有整数值的宏变量执行数学运算。使用了EVAL函数。宏变量' c '的值是11。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="d308" class="ko if hh kk b fi kp kq l kr ks">%let a = 5; %let b = 6; %let c = %eval(&amp;a+&amp;b); %put &amp;c;</span></pre><p id="6e62" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">对具有浮点值的SAS宏变量执行数学运算。使用SYSEVALF函数。宏变量' c '的值是12。</p><pre class="kf kg kh ki fd kj kk kl km aw kn bi"><span id="84b3" class="ko if hh kk b fi kp kq l kr ks">%let a = 5.5; %let b = 6.5; %let c = %sysevalf(&amp;a+&amp;b); %put &amp;c;</span></pre></div></div>    
</body>
</html>