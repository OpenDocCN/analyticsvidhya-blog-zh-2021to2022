<html>
<head>
<title>Analyzing Yelp Dataset with SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用SQL分析Yelp数据集</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/analyzing-yelp-dataset-with-sql-147157a4caed?source=collection_archive---------5-----------------------#2021-03-10">https://medium.com/analytics-vidhya/analyzing-yelp-dataset-with-sql-147157a4caed?source=collection_archive---------5-----------------------#2021-03-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1f4a017caa54af6afc4fd1664258ce0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yBtQtp4_DL7Wl_s-apH-eg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马库斯·斯派克<strong class="bd iu"> </strong>在Unsplash上拍摄的照片</figcaption></figure><p id="e7db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">SQL是数据科学专业人员军械库中的关键一环。分析师需要SQL来处理存储在关系数据库中的结构化数据</p><p id="dafb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">SQL已经存在几十年了。我们传递和消化信息的速度日益加快。为了根据数据做出明智的决策，世界各地的组织都在雇用业务分析师和数据科学家等数据专业人士，从庞大的数据宝库中挖掘和挖掘见解。</p><p id="7f37" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中一个最重要的工具是——你猜对了——SQL！</p><p id="545f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我最近参加了一个来自coursers.org<a class="ae jt" href="https://www.coursera.org/learn/sql-for-data-science" rel="noopener ugc nofollow" target="_blank">的加州大学戴维斯分校的SQL(结构化查询语言)课程。这是SQL和使用数据的基础知识的预备知识，这样您就可以开始出于数据科学的目的对其进行分析。你将开始问正确的问题，想出好的答案，为你的组织提供有价值的见解和重要的知识。本课程从具体细节开始，并承认你没有任何SQL方面的信息或技能。</a></p><p id="8719" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于想学SQL还没上过这门课的人，我强烈推荐这门课。</p><h1 id="ea9a" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">以下是本课程的学习目标</h1><ul class=""><li id="228c" class="kr ks hi ix b iy kt jc ku jg kv jk kw jo kx js ky kz la lb bi translated">区分用于数据科学应用程序的SQL和用于更常见的数据管理操作的SQL。</li><li id="6d10" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">从一列或一组列中确定所需数据的子集，并编写SQL查询来限制这些结果。</li><li id="bc70" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">了解WHERE、BETWEEN、IN、OR、NOT、LIKE、ORDER BY和GROUP BY如何工作。使用通配符功能搜索更具体的记录或部分记录，包括它们的优点和缺点，以及如何最好地利用它们</li><li id="ee20" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">使用基本的数学运算符以及聚合函数(如AVERAGE、COUNT、MAX、MIN等)开始分析数据。</li><li id="62e7" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">学习如何编写子查询，包括它们的优缺点，以及何时使用它们。</li><li id="913c" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">识别和定义几种类型的连接，包括笛卡尔连接、内部连接、左右连接、完全外部连接和自连接。此外，使用别名和预限定符来使您的SQL代码更加整洁和高效。</li><li id="4043" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">使用函数操作字符串、日期和数字数据，将不同来源的数据集成到具有正确格式的字段中进行分析。</li><li id="041d" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">使用Case / When语句记录一组数据，以便在不同的级别进行分组(例如，从城市到地区)。</li><li id="75d3" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">确定组织、治理、业务和数据条件，这些条件表明使用联接来准备用于分析的数据。</li></ul><p id="581d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本课程的期末项目是分析Yelp提供的公共数据集，Yelp是一个供用户提供评论并对他们与各种组织的互动进行评级的平台，这些组织包括企业、餐馆、健身俱乐部、医院、地方政府办公室、慈善组织等。</p><p id="91d7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是我们将要用来分析数据的Yelp数据集的实体图(ER图)。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/efac7f3fba0a5bc49f58f7c06c0024cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AIFnzAedV8ZBUOY6X-f2GQ.png"/></div></div></figure><p id="17f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我来给你解释一下实体关系图。</p><p id="0b20" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">任何对象，例如实体、实体的属性、关系集和关系集的属性，都可以借助ER图来表示。</p><ul class=""><li id="37f4" class="kr ks hi ix b iy iz jc jd jg lm jk ln jo lo js ky kz la lb bi translated">表格中的黄色键图标(例如业务表格中的-id)是业务表格的主键</li><li id="26a7" class="kr ks hi ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">红色菱形图标是另一个表的外键(例如，review表中的business_id是business表的外键。</li></ul><p id="a570" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lp lq lr ls b"><strong class="ix hj">Note</strong> : If you are not familiar with the idea of Primary and Foreign Keys. Check what are <a class="ae jt" href="https://www.guru99.com/difference-between-primary-key-and-foreign-key.html?utm_source=sms&amp;utm_campaign=primary_and_foreign_key" rel="noopener ugc nofollow" target="_blank">[Primary and Foreign Keys]</a></code></p><ul class=""><li id="d4c0" class="kr ks hi ix b iy iz jc jd jg lm jk ln jo lo js ky kz la lb bi translated">穿过表的虚线显示了表之间的关系(例如，业务表与其他表有一对多的关系)</li></ul><p id="a06b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们知道了SQL做什么，什么是阿尔图，让我们试着深入一点，看看我们如何检索数据和解决一些业务问题。</p><p id="7c12" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">获得数据后，我们要做的第一件事是检查有多少条记录，以及我们要使用的列中是否有空值。</p><ol class=""><li id="0654" class="kr ks hi ix b iy iz jc jd jg lm jk ln jo lo js lt kz la lb bi translated">查找业务表中的记录总数。</li></ol><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="81d4" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>SELECT COUNT(*)<br/>FROM Business</span><span id="6ae2" class="ly jv hi ls b fi md ma l mb mc">*****************************</span></pre><p id="f3df" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.检查用户表中是否有空值</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="bf37" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>SELECT * FROM user WHERE<br/>id is null or <br/>name is null or <br/>review_count is null or<br/>yelping_since is null or <br/>useful is null or<br/>funny is null or<br/>cool is null or<br/>fans is null or<br/>average_stars is null or<br/>compliment_hot  is null or<br/>compliment_more is null or<br/>compliment_profile is null or<br/>compliment_cute is null or<br/>compliment_list is null or<br/>compliment_note is null or<br/>compliment_plain is null or <br/>compliment_cool is null or <br/>compliment_funny is null or <br/>compliment_writer is null or<br/>compliment_photos is null</span><span id="0761" class="ly jv hi ls b fi md ma l mb mc">*****************************</span></pre><p id="2647" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.按降序列出评论最多的城市:</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="85c4" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>    SELECT city,SUM(review_count)<br/>    FROM business<br/>    ORDER BY  review_count DESC</span><span id="451e" class="ly jv hi ls b fi md ma l mb mc">***************************** <br/>-----------------+-------------------+<br/>| city            | SUM (review_count) |<br/>+-----------------+-------------------+<br/>| Las Vegas       |             82854 |<br/>| Phoenix         |             34503 |<br/>| Toronto         |             24113 |<br/>| Scottsdale      |             20614 |<br/>| Charlotte       |             12523 |<br/>| Henderson       |             10871 |<br/>| Tempe           |             10504 |<br/>| Pittsburgh      |              9798 |<br/>| MontrÃ©al       |              9448 |<br/>| Chandler        |              8112 |<br/>| Mesa            |              6875 |<br/>| Gilbert         |              6380 |<br/>| Cleveland       |              5593 |<br/>| Madison         |              5265 |<br/>| Glendale        |              4406 |<br/>| Mississauga     |              3814 |<br/>| Edinburgh       |              2792 |<br/>| Peoria          |              2624 |<br/>| North Las Vegas |              2438 |<br/>| Markham         |              2352 |<br/>| Champaign       |              2029 |<br/>| Stuttgart       |              1849 |<br/>| Surprise        |              1520 |<br/>| Lakewood        |              1465 |<br/>| Goodyear        |              1155 |<br/>+-----------------+-------------------+</span></pre><p id="f0be" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">4.查找雅芳市企业的星级分布</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="6e54" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>SELECT stars,COUNT (stars) AS star_count<br/>FROM business<br/>WHERE city='Avon'<br/>GROUP BY  1<br/>***************************** <br/>+-------+------------+<br/>| stars | star_count |<br/>+-------+------------+<br/>|   1.5 |          1 |<br/>|   2.5 |          2 |<br/>|   3.5 |          3 |<br/>|   4.0 |          2 |<br/>|   4.5 |          1 |<br/>|   5.0 |          1 |<br/>+-------+------------+</span></pre><p id="d4c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">5.根据评论总数查找前3名用户:</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="1bf1" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>SELECT name,review_count<br/>FROM user<br/>ORDER BY review_count DESC<br/>LIMIT 3<br/>***************************** </span><span id="827b" class="ly jv hi ls b fi md ma l mb mc">+--------+--------------+<br/>| name   | review_count |<br/>+--------+--------------+<br/>| Gerald |         2000 |<br/>| Sara   |         1629 |<br/>| Yuri   |         1339 |<br/>+--------+--------------+</span></pre><p id="11a7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">6.发表更多评论会带来更多粉丝吗？</p><p id="1edb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不一定相关。拥有最多粉丝的杰拉德只有253条评论。尤里只有76个粉丝，却有1339条评论。还应该考虑其他一些因素。</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="764e" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>SELECT name, review_count, fans<br/>FROM USER<br/>ORDER BY fans DESC</span><span id="0aa0" class="ly jv hi ls b fi md ma l mb mc">***************************** <br/>+-----------+--------------+------+<br/>| name      | review_count | fans |<br/>+-----------+--------------+------+<br/>| Amy       |          609 |  503 |<br/>| Mimi      |          968 |  497 |<br/>| Harald    |         1153 |  311 |<br/>| Gerald    |         2000 |  253 |<br/>| Christine |          930 |  173 |<br/>| Lisa      |          813 |  159 |<br/>| Cat       |          377 |  133 |<br/>| William   |         1215 |  126 |<br/>| Fran      |          862 |  124 |<br/>| Lissa     |          834 |  120 |<br/>| Mark      |          861 |  115 |<br/>| Tiffany   |          408 |  111 |<br/>| bernice   |          255 |  105 |<br/>| Roanna    |         1039 |  104 |<br/>| Angela    |          694 |  101 |<br/>| .Hon      |         1246 |  101 |<br/>| Ben       |          307 |   96 |<br/>| Linda     |          584 |   89 |<br/>| Christina |          842 |   85 |<br/>| Jessica   |          220 |   84 |<br/>| Greg      |          408 |   81 |<br/>| Nieves    |          178 |   80 |<br/>| Sui       |          754 |   78 |<br/>| Yuri      |         1339 |   76 |<br/>| Nicole    |          161 |   73 |<br/>+-----------+--------------+------+<br/>(Output limit exceeded, 25 of 10000 total rows shown)</span></pre><p id="e120" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.有更多带有“爱”字或“恨”字的评论吗？</p><p id="14d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是的，有爱情这个词的评论比较多。</p><p id="d311" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总评论与爱-1780</p><p id="811e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">带有仇恨的评论总数— 232</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="3f0e" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********<br/>SELECT COUNT(CASE WHEN text LIKE '%love%' THEN text END) AS Love_count,<br/>COUNT(CASE WHEN text LIKE '%hate%' THEN text END) AS Hate_count<br/>FROM review<br/>***************************** <br/>+------------+------------+<br/>| count_love | count_hate |<br/>+------------+------------+<br/>|       1780 |        232 |<br/>+------------+------------+</span></pre><p id="6bc6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">8.找到拥有最多粉丝的前10名用户</p><pre class="li lj lk ll fd lu ls lv lw aw lx bi"><span id="1425" class="ly jv hi ls b fi lz ma l mb mc">***********SQL CODE**********  <br/>SELECT name,fans<br/>FROM user<br/>ORDER BY fans DESC<br/>LIMIT 10<br/>***************************** </span><span id="0980" class="ly jv hi ls b fi md ma l mb mc">+-----------+------+<br/>| name      | fans |<br/>+-----------+------+<br/>| Amy       |  503 |<br/>| Mimi      |  497 |<br/>| Harald    |  311 |<br/>| Gerald    |  253 |<br/>| Christine |  173 |<br/>| Lisa      |  159 |<br/>| Cat       |  133 |<br/>| William   |  126 |<br/>| Fran      |  124 |<br/>| Lissa     |  120 |<br/>+-----------+------+</span></pre><p id="2aab" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以使用上面讨论的这些小检查作为起点来了解我们的项目，并在以后进行深入分析时参考它。</p><p id="51c4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">任何分析的第一步都是理解表之间的关系，并进行基本检查，如:</p><p id="3ce7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的数据中有空值吗？</p><p id="24fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">表中的主键和外键是什么？</p><p id="1b3c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">表格之间的关系是什么？是一对多还是多对多等等</p><p id="056d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">检查数据的标题行(前10行)</p><h1 id="41e4" class="ju jv hi bd iu jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">技术说明</h1><p id="a336" class="pw-post-body-paragraph iv iw hi ix b iy kt ja jb jc ku je jf jg me ji jj jk mf jm jn jo mg jq jr js hb bi translated">以上所有查询都是在Coursera的SQL环境中执行的。参加本课程，了解有关数据集的更多信息。</p><p id="eee8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">链接:<a class="ae jt" href="https://www.coursera.org/learn/sql-for-data-science" rel="noopener ugc nofollow" target="_blank">coursers.org</a></p></div></div>    
</body>
</html>