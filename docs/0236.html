<html>
<head>
<title>Storage classes in C++ a tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C++中的存储类教程</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/storage-classes-in-c-a-tutorial-bbb51ece11dc?source=collection_archive---------11-----------------------#2021-01-09">https://medium.com/analytics-vidhya/storage-classes-in-c-a-tutorial-bbb51ece11dc?source=collection_archive---------11-----------------------#2021-01-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1427" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">C++中的<strong class="ig hi"> <em class="jc">存储类有</em> </strong> : <code class="du jd je jf jg b"> auto</code>、<code class="du jd je jf jg b">static</code>、<code class="du jd je jf jg b"> extern</code>、<code class="du jd je jf jg b"> mutable</code>、<code class="du jd je jf jg b"> register</code>、<code class="du jd je jf jg b">thread_local</code>。它们在声明中用于指定定义是如何发生的。</p><p id="3a38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">定义</em> </strong>对于一个变量，是分配它的存储，对于一个函数，是写下它将要执行的指令，对于类类型:<code class="du jd je jf jg b">class </code>、<code class="du jd je jf jg b">struct </code>和<code class="du jd je jf jg b">union </code>，是它们的方法和数据成员的声明。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="d56d" class="jp jq hh jg b fi jr js l jt ju">extern int var_i;<br/>/*Declaration of a variable .*/</span><span id="1f5c" class="jp jq hh jg b fi jv js l jt ju">float var_f; <br/>/*Declaration , and definition of<br/>  an object .*/</span><span id="c42d" class="jp jq hh jg b fi jv js l jt ju">int fctFoo(int a , int b);<br/>/*Declaration of a function .*/</span><span id="5eeb" class="jp jq hh jg b fi jv js l jt ju">int fctFoo(int a , int b){<br/>/*Definition of a function .*/<br/>  return a + b ;}</span><span id="a16b" class="jp jq hh jg b fi jv js l jt ju">class classFoo;<br/>/*Declaration of a class .*/</span><span id="b7b9" class="jp jq hh jg b fi jv js l jt ju">class classFoo{<br/>/*Definition of the classFoo .*/<br/>public :<br/>  int a;<br/>  void addTo(int b ); };</span></pre><h1 id="d08c" class="jw jq hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">汽车</h1><p id="ec16" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip kv ir is it kw iv iw ix kx iz ja jb ha bi translated"><code class="du jd je jf jg b">auto</code> <em class="jc"> </em> <strong class="ig hi"> <em class="jc">的意思是一个</em> </strong>的定义自动归入它的范围。当进入对象的包含块时，对象被自动创建，当退出包含块时，对象被销毁。</p><p id="aabc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当一个<a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/#The_local_scope" rel="noopener ugc nofollow" target="_blank">局部</a>变量被声明时，如果没有指定存储类，它<strong class="ig hi"> <em class="jc">有一个自动</em> </strong> <em class="jc"> </em>存储。在<a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/#The_local_scope" rel="noopener ugc nofollow" target="_blank">局部范围</a>中声明了一个局部变量。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="88ce" class="jp jq hh jg b fi jr js l jt ju">int trivial(int arg_i , float arg_f ){<br/>  double var_d = 1 ; <br/>  return arg_i + arg_f + var_d ;}<br/>/*arg_i , arg_f and var_d are local <br/>  variables , they are created <br/>  on the local scope entry and <br/>  destroyed on its exit .*/</span></pre><p id="4d25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在C++11中,<code class="du jd je jf jg b">auto</code>存储类被删除，而从C++11开始,<code class="du jd je jf jg b">auto</code>关键字有了另一层含义。</p><h1 id="098d" class="jw jq hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">走读生</h1><p id="836f" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip kv ir is it kw iv iw ix kx iz ja jb ha bi translated"><code class="du jd je jf jg b">extern </code> <strong class="ig hi"> <em class="jc">表示</em> </strong>定义在<a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/" rel="noopener ugc nofollow" target="_blank">范围</a>之外。</p><p id="67f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">extern关键字<strong class="ig hi"> <em class="jc">不能在</em> a <a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/#The_class_scope" rel="noopener ugc nofollow" target="_blank">类范围</a>中使用 </strong> <em class="jc">，因此不能与类、结构或联合的成员一起使用。它也不能与函数的参数或类类型的声明一起使用。</em></p><p id="ca1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc"> extern在局部作用域</em> </strong>的用法举例:</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="698c" class="jp jq hh jg b fi jr js l jt ju">#include&lt;iostream&gt;</span><span id="41ae" class="jp jq hh jg b fi jv js l jt ju">int var_i  = 1 ;<br/>/*var_i , is not declared extern , <br/>  as such its definition is not <br/>  external to its scope .*/</span><span id="a994" class="jp jq hh jg b fi jv js l jt ju">float var_f = 5.0f ;</span><span id="55e9" class="jp jq hh jg b fi jv js l jt ju">void fctTrivial(){<br/>  extern int var_i;<br/>  /*var_i is declared ,<br/>    in the local scope .<br/>    The definition of <br/>    var_i is external to <br/>    the local scope .*/<br/>  std::cout &lt;&lt; var_i &lt;&lt; std::endl;<br/>  /*Output:<br/>    1 .*/<br/>  std::cout &lt;&lt;var_f &lt;&lt; std::endl;<br/>  /*var_f is not declared ,<br/>    in the local scope , it<br/>    is accessible from<br/>    the global scope .<br/>    Output :<br/>    5  .*/ }</span><span id="06dd" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  fctTrivial(); }</span></pre><p id="e567" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在全局范围中使用<em class="jc"> extern的例子:</em></p><figure class="jh ji jj jk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kz"><img src="../Images/38b1ee5ffa353dc9b06f241805f01f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQVJDjBR3YFuPJKeccR3RA.png"/></div></div></figure><figure class="jh ji jj jk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lh"><img src="../Images/9bfb7f47a8d836f59125d8e2518df5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-JUZWq-OyoT43PW9meCwg.png"/></div></div></figure><figure class="jh ji jj jk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/1f1f8052c4894e2cb98e591c78cd12f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wjQF50ysNiQ1zF1kVD7r7g.png"/></div></div></figure><p id="7ac2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在名称空间 中使用<code class="du jd je jf jg b">extern</code> <strong class="ig hi"> <em class="jc">的例子。</em></strong></p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="aae5" class="jp jq hh jg b fi jr js l jt ju">#include&lt;iostream&gt;<br/>namespace nmspc {<br/>  extern int var_i = -1; }</span><span id="8d8f" class="jp jq hh jg b fi jv js l jt ju">namespace nmspc {<br/>  extern int var_i ;<br/>  /*extern int var_i  = -1;<br/>    This will cause an error<br/>    of var_i being redefined .*/ }</span><span id="f70b" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  std::cout &lt;&lt; nmspc::var_i &lt;&lt; std::endl;<br/>  /*Output :<br/>    -1 .*/}</span></pre><h1 id="2ccd" class="jw jq hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">静电</h1><p id="76f6" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip kv ir is it kw iv iw ix kx iz ja jb ha bi translated"><code class="du jd je jf jg b">static </code> <strong class="ig hi"> <em class="jc">意味着</em> </strong>的定义是静态的，换句话说，固定到它的<a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/" rel="noopener ugc nofollow" target="_blank">范围</a>中。</p><p id="138b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">静态存储类<strong class="ig hi"> <em class="jc">只能应用于</em> </strong> <em class="jc"> </em>变量、函数和匿名联合，当它们在文件范围、名称空间范围、类范围和局部范围中被声明时。</p><p id="d50c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">静态在局部范围</em> </strong>的用法举例:</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="c15d" class="jp jq hh jg b fi jr js l jt ju">#include&lt;iostream&gt;</span><span id="e36e" class="jp jq hh jg b fi jv js l jt ju">int iterator(){<br/>  static int var_i = -1;<br/>  /*Definition of var_i is to<br/>    be static to its scope . <br/>    var_i is not to be created<br/>    every time the local block<br/>    is entered , nor is it to be<br/>    destroyed every time the local <br/>    block is exited  .*/<br/>  return ++var_i; }</span><span id="41f1" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  std::cout &lt;&lt; iterator() &lt;&lt; std::endl ;<br/>  std::cout &lt;&lt; iterator() &lt;&lt; std::endl ;<br/>  /*Output :<br/>    0<br/>    1 .*/}</span></pre><p id="fff4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">静态在全局范围</em> </strong>的用法举例:</p><figure class="jh ji jj jk fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lj"><img src="../Images/809e613eef99375cac355dc9f7508c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X39aBRkKoFFrB6gsoosFgA.png"/></div></div></figure><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="fe6c" class="jp jq hh jg b fi jr js l jt ju">/*File tr_unit1.cpp */</span><span id="9339" class="jp jq hh jg b fi jv js l jt ju">static int id = 0 ;</span><span id="7e61" class="jp jq hh jg b fi jv js l jt ju">int generateId(){<br/>  return id++; }</span><span id="5388" class="jp jq hh jg b fi jv js l jt ju">void resetId(){<br/>  id = 0; }</span><span id="7f6f" class="jp jq hh jg b fi jv js l jt ju">/*File tr_unit2.cpp */</span><span id="68de" class="jp jq hh jg b fi jv js l jt ju">#include&lt;iostream&gt;</span><span id="f4af" class="jp jq hh jg b fi jv js l jt ju">extern int generateId();<br/>extern int resetId();</span><span id="b53d" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  std::cout &lt;&lt; generateId() &lt;&lt; std::endl ;<br/>  std::cout &lt;&lt; generateId() &lt;&lt; std::endl ;<br/>  resetId();<br/>  std::cout &lt;&lt; generateId() &lt;&lt; std::endl ; }</span><span id="e52b" class="jp jq hh jg b fi jv js l jt ju">/*<br/>$ g++ tr_unit1.cpp tr_unit2.cpp<br/>$ ./a.out<br/>0<br/>1<br/>0<br/>*/</span></pre><p id="8553" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">静态在类作用域</em> </strong>中的用法示例:</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="3f14" class="jp jq hh jg b fi jr js l jt ju">#include&lt;iostream&gt;</span><span id="8e09" class="jp jq hh jg b fi jv js l jt ju">class Trivial{<br/>public :<br/>  static int var_i;<br/>  static int foo_f(); };</span><span id="2ac9" class="jp jq hh jg b fi jv js l jt ju">int Trivial::var_i = 0;</span><span id="87f3" class="jp jq hh jg b fi jv js l jt ju">int Trivial::foo_f(){<br/>  return Trivial::var_i++; }</span><span id="266c" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  std::cout &lt;&lt; Trivial::var_i &lt;&lt; std::endl;<br/>  /*Output : <br/>    0 */<br/>  std::cout &lt;&lt; Trivial::foo_f() &lt;&lt; std::endl;<br/>  /*Output : <br/>    0 */<br/>  std::cout &lt;&lt; Trivial::foo_f() &lt;&lt; std::endl;<br/>  /*Output : <br/>    1 */<br/>  std::cout &lt;&lt; Trivial::var_i &lt;&lt; std::endl; <br/>  /*Output : <br/>    2 */ }</span></pre><h1 id="bd94" class="jw jq hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">易变的</h1><p id="507d" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip kv ir is it kw iv iw ix kx iz ja jb ha bi translated"><code class="du jd je jf jg b">mutable </code> <strong class="ig hi"> <em class="jc">表示</em> </strong> <em class="jc"> </em>定义对其<a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/" rel="noopener ugc nofollow" target="_blank">范围</a>是可变的。</p><p id="ac98" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jd je jf jg b">mutable </code>、<strong class="ig hi">、<em class="jc">只适用于</em>、</strong>非静态类的数据成员。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="61f7" class="jp jq hh jg b fi jr js l jt ju">#include&lt;iostream&gt;</span><span id="e074" class="jp jq hh jg b fi jv js l jt ju">class Trivial{<br/>public:<br/>  int var_i;<br/>  mutable float var_fm;<br/>  void foo_f() const; <br/>  /*foo_f is a constant member <br/>    function .*/ };</span><span id="3c24" class="jp jq hh jg b fi jv js l jt ju">void Trivial::foo_f() const {<br/>  /*Provide a definition for foo_f .*/<br/>  var_fm /= 2; }</span><span id="d08e" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  const Trivial trivial = {1 , 1.0f };<br/>  /*define a trivial object .*/</span><span id="a159" class="jp jq hh jg b fi jv js l jt ju">/*trivial.var_i = 3 ;<br/>    This statement is illegal , because<br/>    the trivial object has been declared <br/>    const .*/</span><span id="bc08" class="jp jq hh jg b fi jv js l jt ju">trivial.var_fm = -1.0f;<br/>  /*var_fm can be assigned a value ,<br/>    since its storage class is mutable .*/</span><span id="4323" class="jp jq hh jg b fi jv js l jt ju">std::cout &lt;&lt; trivial.var_fm &lt;&lt; std::endl ;<br/>  /*Output :<br/>    -1 .*/</span><span id="844d" class="jp jq hh jg b fi jv js l jt ju">trivial.foo_f();<br/>  /*a function declared const , is not<br/>    allowed to changed an object data<br/>    member , unless this data member<br/>    is declared mutable .*/</span><span id="bf8a" class="jp jq hh jg b fi jv js l jt ju">std::cout &lt;&lt; trivial.var_fm &lt;&lt; std::endl ;<br/>  /*<br/>    Output :<br/>    0.5 .*/ }</span></pre><h1 id="ef91" class="jw jq hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">注册</h1><p id="1d34" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip kv ir is it kw iv iw ix kx iz ja jb ha bi translated"><code class="du jd je jf jg b">register </code> <strong class="ig hi"> <em class="jc">意味着一个</em> </strong> <em class="jc"> </em>定义被注册。这不是必须的，编译器可以忽略<code class="du jd je jf jg b">register</code>存储类。</p><p id="a920" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jd je jf jg b">register </code>做<strong class="ig hi"> <em class="jc">是为了更快的访问</em> </strong>。该定义可以注册在高速缓存或cpu寄存器中。</p><p id="d1da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jd je jf jg b">register </code> <strong class="ig hi"> <em class="jc">只适用于</em> </strong>局部变量。</p><p id="52c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">寄存器存储类在C++11标准<strong class="ig hi"> <em class="jc">中被弃用，在c++17标准</em> </strong>中被移除。</p><pre class="jh ji jj jk fd jl jg jm jn aw jo bi"><span id="0585" class="jp jq hh jg b fi jr js l jt ju">#include&lt;iostream&gt;</span><span id="d54b" class="jp jq hh jg b fi jv js l jt ju">int fly(register int a , register int v ){<br/>  while(v &gt; 0 ){<br/>    a *= a;<br/>    v--; }<br/>  return a; }</span><span id="4454" class="jp jq hh jg b fi jv js l jt ju">int main(void ){<br/>  std::cout &lt;&lt; fly(2 , 4 ) &lt;&lt; std::endl; <br/>  /*Output : <br/>    65536 .*/ }</span></pre><h1 id="2a09" class="jw jq hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">线程_本地</h1><p id="4bc9" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip kv ir is it kw iv iw ix kx iz ja jb ha bi translated"><code class="du jd je jf jg b">thread_local </code> <strong class="ig hi"> <em class="jc">是指</em> </strong> <em class="jc"> </em>的定义是对其<a class="ae ky" href="https://twiserandom.com/cpp/scope-in-cpp-a-tutorial/" rel="noopener ugc nofollow" target="_blank">线程</a>的局部定义。</p><p id="c309" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个存储类<strong class="ig hi"> <em class="jc">只能应用</em> </strong>到局部作用域中声明的变量，或者全局命名空间之类的命名空间，或者静态数据成员。</p><p id="dfd0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jd je jf jg b">thread_local</code>表示一个变量对于它的线程是局部的，该变量在其线程被创建时被创建，在其线程被销毁时被销毁。</p><p id="69ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jd je jf jg b">thread_local</code>存储类、<strong class="ig hi"> <em class="jc">可以与</em> </strong>一起使用，静态和外部存储类，它是在C++11中引入的。</p></div><div class="ab cl lk ll go lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ha hb hc hd he"><p id="7fd4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">原载于2021年1月9日</em><a class="ae ky" href="https://twiserandom.com/cpp/storage-classes-in-c-a-tutorial/" rel="noopener ugc nofollow" target="_blank"><em class="jc"/></a><em class="jc">。</em></p></div></div>    
</body>
</html>