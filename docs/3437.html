<html>
<head>
<title>Meet Vicci — Very Intelligent Covid Chat Interface — 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">认识Vicci —非常智能的Covid聊天界面— 1</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/vicci-very-intelligent-covid-chat-interface-70b9eaeea1ae?source=collection_archive---------25-----------------------#2021-06-30">https://medium.com/analytics-vidhya/vicci-very-intelligent-covid-chat-interface-70b9eaeea1ae?source=collection_archive---------25-----------------------#2021-06-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="250f" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated"><em class="iw">使用Python和经典ML设计COVID聊天机器人</em></h2></div><p id="53fe" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">承认吧。不管你是不是ML/AI领域的，聊天机器人这个话题一直很耐人寻味。随着最近机器学习的进步和数据的丰富，聊天机器人越来越受欢迎，以服务于基本的支持活动。最大的优势是他们能够确保24x7的可用性和成本效益。因此，让我们开始探索开发一个当今最热门话题的机器人——新冠肺炎。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/b5a913be7132040a41a122fd74e58217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-A-RFFbd9pdeh0M5UHJ_lg.png"/></div></div></figure><h1 id="ef9a" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated"><strong class="ak">意图&amp;实体意图</strong></h1><p id="a80f" class="pw-post-body-paragraph ix iy hh iz b ja kx ii jc jd ky il jf jg kz ji jj jk la jm jn jo lb jq jr js ha bi translated">意图和实体是聊天机器人术语的组成部分。简单来说，<strong class="iz hi">意图</strong>就是用户用他/她特定的<strong class="iz hi"> <em class="lc">话语</em> </strong>(查询)想要完成的主要意图或任务。而<strong class="iz hi">实体</strong>只是向意图添加更多信息。比如说-</p><p id="4b08" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">对于下面两个句子，意图可以归类为— <em class="lc">播放歌曲，</em>而实体将为<em class="lc">虔诚</em>和<em class="lc">浪漫</em></p><ul class=""><li id="a808" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated">为我演奏一首<em class="lc">虔诚的</em> <em class="lc">歌曲</em></li><li id="e056" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">为我演奏一首浪漫的歌曲</li></ul><p id="18d2" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">而对于下面两个句子，意图可以是— <em class="lc">开/关</em>，实体可以是<em class="lc">灯</em>和<em class="lc">咖啡机</em></p><ul class=""><li id="7383" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated">关闭<em class="lc">灯</em></li><li id="f5ed" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">打开<em class="lc">咖啡机</em></li></ul><h1 id="8df3" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated"><strong class="ak"> <em class="iw">创建训练数据</em> </strong></h1><p id="91cc" class="pw-post-body-paragraph ix iy hh iz b ja kx ii jc jd ky il jf jg kz ji jj jk la jm jn jo lb jq jr js ha bi translated">不用说，像任何其他机器学习问题一样，第一个要求是获得高质量的训练数据。由于covid是一个非常新的场景，因此很难获得大量最新、可靠且公开可用的训练数据。所以让我们从头开始创建我们自己的训练数据。我们查看了印度政府<a class="ae lr" href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/question-and-answers-hub/q-a-detail/coronavirus-disease-covid-19" rel="noopener ugc nofollow" target="_blank">世卫组织</a>和<a class="ae lr" href="https://www.mohfw.gov.in/pdf/FAQ.pdf" rel="noopener ugc nofollow" target="_blank">卫生和家庭福利部</a>官方网站的FAQ部分。从那里，我们收集了大约12个问题，涉及covid的各个主要方面，如定义、症状、传播、治疗、如何保护等。这些成为我们最初的12个独特的意图。你可以在这里找到数据<a class="ae lr" href="https://github.com/kr-prince/VICCI-Python-Chatbot/blob/main/data/FAQ_data.csv" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2676" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">我们还想添加一些功能来执行一些实时操作。在这种情况下，帮助用户找到一个接种疫苗的位置，并从印度政府的<a class="ae lr" href="https://www.mygov.in/covid-19#statewise-data" rel="noopener ugc nofollow" target="_blank">官方仪表板</a>获得最新的邦级covid数据。这又增加了两个意图。</p><p id="881f" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">最后，我们肯定希望我们的机器人尽可能像<strong class="iz hi">对话</strong>，而不是菜单驱动，所以我们为问候、介绍、确认和再见增加了4个意图。这完成了我们有18个意向的基本数据集。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ls"><img src="../Images/8d59977a26999ace42f9e317dd98b182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuMNJbzhEqQGEx2KlvvGcw.jpeg"/></div></div></figure><p id="4208" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">显然，没有一种分类算法能够在这样一个每类只有一句话的小数据集上工作，所以我们必须找到一种方法来扩展这个数据集。我们查找短语生成模型，深度学习拯救了我们。我们在曼努埃尔·罗梅罗的博客上看到了<a class="ae lr" href="https://huggingface.co/mrm8488/t5-small-finetuned-quora-for-paraphrasing" rel="noopener ugc nofollow" target="_blank">关于谷歌T5模型在quora问题上的微调。更多关于T5 </a><a class="ae lr" href="https://paperswithcode.com/method/t5" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="lt lu l"/></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">使用T5模型解释</figcaption></figure><p id="cf28" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">然而，在我们的covid相关问题上直接使用解释模型并不太好。大多数生成的短语几乎以相同的方式开始，只是在句子的最后几个词上有所不同。有些只是在a/an/the上有所不同，有些只是在大小写上有所不同。在其中一个实验中，问题的释义—<em class="lc">“Covid是如何通过空气传播的？”</em>是<em class="lc">“Covid如何通过地面传播”。</em>这可能是因为该模型是在Quora问题上进行训练的，Quora问题涵盖了一个更一般的概念，即通过空气和地面的传播可能是相似的，但是在我们的情况下，该领域非常封闭。这一观察强调了在特定领域数据上微调深度学习模型对于可靠输出的重要性，但我们首先试图在这里生成一些训练数据。因此，我们手工创建了每个问题的大约8-10个变体。你可以在这里找到他们<a class="ae lr" href="https://github.com/kr-prince/VICCI-Python-Chatbot/blob/main/data/hand_written_train_data.json" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="c06e" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">最后，我们在T5模型上使用这些问题(保持箱数参数较低，因此要求它保持特定)，并创建每个问题的大约50个变化，然后进一步处理它们以消除重复，使用随机的州名和日期创建更多的假变化，以使数据更少偏差。我们还观察到，闲聊的问题小而干脆，但模型会生成超长的短语，因此我们简单地对这些意图的数据进行过采样。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="8755" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">你可以在这个<a class="ae lr" href="https://github.com/kr-prince/VICCI-Python-Chatbot/blob/main/experiments/generate_train_data.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>上找到这个实验的完整的Colab笔记本。</p><h1 id="ea67" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated"><strong class="ak"> <em class="iw">设计Vicci的大脑——意图分类器</em> </strong></h1><p id="07d9" class="pw-post-body-paragraph ix iy hh iz b ja kx ii jc jd ky il jf jg kz ji jj jk la jm jn jo lb jq jr js ha bi translated">既然我们的机器人应该处理的每种意图都有大约50种不同的问题，我们开始寻找一个好的分类模型。对于小于1k大小的训练数据，使用神经网络或序列模型似乎是多余的，因此我们从一种基本的特征化技术开始—<a class="ae lr" href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf" rel="noopener ugc nofollow" target="_blank"><strong class="iz hi">TfidfVectorizer</strong></a><strong class="iz hi">。</strong>我们还决定将Tf-Idf与问题中每个单词的<a class="ae lr" href="https://nlp.stanford.edu/projects/glove/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hi">手套</strong> </a>(单词表示的全局向量)的平均值进行对比。我们使用LabelEncoder将意图转换成数字或标签。</p><p id="34f4" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">我们注意到Tf-Idf特性在识别较长问题的意图方面表现得更好。相比之下，手套向量在识别较短的问题时表现更好，特别是聊天意图，可能是因为与取较长句子中所有单词向量的平均值相比，像<em class="lc">“Hi”</em>和<em class="lc">“Thanks”</em>这样的短语将具有明确定义的向量。所以我们决定取二者之长。我们只考虑了100维的手套向量，我们将Tf-Idf特征的上限保持在600，以防止由于高维而导致的过度拟合问题(记住我们只有少量的训练数据)。我们的最终特征是手套向量的Tf-Idf加权平均值与Tf-Idf向量本身的连接。我们还使用了nltk单词标记器，而不是简单地拆分每个单词，因为这样可以将一些常用短语放在一起，比如— <em class="lc">“长期”</em>，这被证明是有用的。然后，我们研究了所有模型在这些特性上的性能，得到了良好的结果。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="6314" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">你可以在这个<a class="ae lr" href="https://github.com/kr-prince/VICCI-Python-Chatbot/blob/main/experiments/model_training.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>找到完整的实验。</p><p id="51b4" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">为了监控分类器的性能，我们使用GridSearchCV，但是不使用默认的交叉验证参数，而是使用StratifiedShuffleSplit。根据Scikit-Learn <a class="ae lr" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html" rel="noopener ugc nofollow" target="_blank">文档</a> —</p><p id="4f1f" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><em class="lc">对于整数/无输入，如果估计值是分类器，并且y是二进制或多类，则使用StratifiedKFold。在所有其他情况下，使用KFold。这些拆分器是用shuffle=False实例化的，因此这些拆分在调用之间是相同的。</em></p><p id="7bc9" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">但我们希望有一个更健壮的图片，因此我们决定使用StratifiedShuffleSplit进行交叉验证，每次都返回分层但随机的折叠。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="52f3" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">拥有更少训练数据的一线希望是，我们可以自由探索所有类型的分类器，如逻辑回归、k近邻、朴素贝叶斯、SVM、SGD分类器和XGBoost。我们还进行了大量的实验来微调超参数并实现它们的最佳配置。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="lt lu l"/></div></figure><h2 id="79b4" class="lz kg hh bd kh ma mb mc kl md me mf kp jg mg mh kr jk mi mj kt jo mk ml kv mm bi translated">分类器结果</h2><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mn"><img src="../Images/146f7ce690d17e92b7eb1f3b9674dc93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Ley2srcMvMEtJojx_2H5w.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx translated">分类器分数</figcaption></figure><ul class=""><li id="fef1" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated">大多数分类器表现良好，因为训练数据很小，并且非常适合我们的任务。</li><li id="d2e7" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">很明显，SVM和逻辑回归是这个训练数据中最好的两个分类器。</li><li id="d9b9" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">尽管SVM的F1和测试得分最高，但其平均交叉验证得分很低。这说明它在这个数据上有极端的行为。因此我们选择逻辑回归。</li><li id="1a79" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">另一个要注意的观察结果是，在缩放数据上训练的朴素贝叶斯分类器相对滞后。</li></ul><p id="54ac" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">所有人都欢呼逻辑回归的至高无上..！</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mo"><img src="../Images/140d9a8bf8ac21e9916528d1083f3b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rq0koz_i780PsYLAgYG2KQ.jpeg"/></div></div></figure><p id="51a5" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">好的。到目前为止一切顺利。</p><p id="fd7d" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">在本文的下一部分，我们将使用Flask设计bot引擎、实体提取技术和部署。</p><p id="698e" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">接下来:<a class="ae lr" href="https://nphard12.medium.com/meet-vicci-very-intelligent-covid-chat-interface-2-6ef26754b702" rel="noopener">第二部</a></p><p id="a9ed" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="iz hi">你可以在GitHub的</strong>  <strong class="iz hi">这里找到这个项目的完整代码</strong> <a class="ae lr" href="https://github.com/kr-prince/VICCI-Python-Chatbot" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hi">。</strong></a></p></div></div>    
</body>
</html>