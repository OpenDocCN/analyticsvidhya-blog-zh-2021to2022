<html>
<head>
<title>The Versatility of the Grammar of Graphics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图形语法的多样性</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/the-versatility-of-the-grammar-of-graphics-d1366760424d?source=collection_archive---------0-----------------------#2021-11-22">https://medium.com/analytics-vidhya/the-versatility-of-the-grammar-of-graphics-d1366760424d?source=collection_archive---------0-----------------------#2021-11-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="bb8c" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">新版的Flutter可视化库</em> <a class="ae jg" href="https://github.com/entronad/graphic" rel="noopener ugc nofollow" target="_blank"> <em class="hh"> Graphic </em> </a> <em class="hh">对其声明性规范语法进行了优化，使其能够更好地表现图形的语法本质。</em></p><p id="e36b" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">在本文中，我们多次改变规格，从而将条形图转换为饼图。这部作品展示了图形语法的灵活性和多样性，也向初学者展示了图形语法的基本概念。</em></p><p id="1571" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">如果你之前没学过图形学的语法，看这篇文章没问题。也是</em> <a class="ae jg" href="https://github.com/entronad/graphic" rel="noopener ugc nofollow" target="_blank"> <em class="hh">图文</em> </a> <em class="hh">的入门手册。</em></p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/6a56ca371014b6fa1514bdfc8588f669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NfEIkwP_FBG5v0MZMVur8w.jpeg"/></div></div></figure><p id="c14f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">条形图和饼图在数据可视化中非常常见。它们乍一看很不一样，但本质是一样的。为什么？让我们一步一步把柱状图转化为饼状图，去探究内在的原因。</p><p id="795f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">让我们从一个简单的条形图开始。数据与ECharts的<a class="ae jg" href="https://echarts.apache.org/examples/editor.html?c=doc-example/getting-started" rel="noopener ugc nofollow" target="_blank">起始示例</a>相同:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="9888" class="kb kc hh jx b fi kd ke l kf kg">const data = [<br/>  {'category': 'Shirts', 'sales': 5},<br/>  {'category': 'Cardigans', 'sales': 20},<br/>  {'category': 'Chiffons', 'sales': 36},<br/>  {'category': 'Pants', 'sales': 10},<br/>  {'category': 'Heels', 'sales': 10},<br/>  {'category': 'Socks', 'sales': 20},<br/>];</span></pre><h1 id="09e2" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">声明性说明</h1><p id="f5d0" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated"><a class="ae jg" href="https://github.com/entronad/graphic" rel="noopener ugc nofollow" target="_blank">图形</a>采用声明性规范。所有可视化语法都在<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Chart-class.html" rel="noopener ugc nofollow" target="_blank">图表</a>小部件的构造函数中指定:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="486c" class="kb kc hh jx b fi kd ke l kf kg">Chart(<br/>  data: data,<br/>  variables: {<br/>    'category': Variable(<br/>      accessor: (Map map) =&gt; map['category'] as String,<br/>    ),<br/>    'sales': Variable(<br/>      accessor: (Map map) =&gt; map['sales'] as num,<br/>    ),<br/>  },<br/>  elements: [IntervalElement()],<br/>  axes: [<br/>    Defaults.horizontalAxis,<br/>    Defaults.verticalAxis,<br/>  ],<br/>)</span></pre><h1 id="627f" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">数据和变量</h1><p id="567d" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">图表的数据由<code class="du lj lk ll jx b">data</code>属性导入。它可以是任何类型的<code class="du lj lk ll jx b">List</code>。在图表内部，数据项被转换成统一的<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Tuple.html" rel="noopener ugc nofollow" target="_blank">元组</a>对象。如何从数据项中提取<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Tuple.html" rel="noopener ugc nofollow" target="_blank">元组</a>字段由<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Variable-class.html" rel="noopener ugc nofollow" target="_blank">变量</a> s定义。</p><p id="ffc3" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">从示例代码中我们可以看到，规范的语法很简洁，然而<code class="du lj lk ll jx b">variables</code>定义占用了一半的长度。由于Dart是一种严格的类型化语言，为了允许任何输入数据类型，详细的<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Variable-class.html" rel="noopener ugc nofollow" target="_blank">变量</a>定义是非常必要的。</p><h1 id="e6e7" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">几何元素</h1><p id="4965" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">图形语法最伟大的思想是区分抽象的<em class="ij">图形</em>和可感知的<em class="ij">图形</em>之间的区别。</p><p id="5f14" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">例如，一个数据是一个值的<em class="ij">区间</em>还是一个值的<em class="ij">点</em>，称为<em class="ij">图</em>；无论画布上的项目是条形还是三角形，宽度和高度都称为<em class="ij">图形</em>。创建图形和图形的步骤分别称为几何和美学。</p><p id="c4ef" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">图形和图形的概念达到了数据和图形的内在联系。它们是图形语法摆脱图表类型学束缚的关键。</p><p id="cf46" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/GeomElement-class.html" rel="noopener ugc nofollow" target="_blank">几何元素</a>是定义这两个概念的地方。其类型决定了图形的类型，它们是:</p><ul class=""><li id="1f0a" class="lm ln hh ik b il im ip iq jt lo ju lp jv lq jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/PointElement-class.html" rel="noopener ugc nofollow" target="_blank"> PointElement </a>:点数。</li><li id="9ab0" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/LineElement-class.html" rel="noopener ugc nofollow" target="_blank"> LineElement </a>:连接点的线。</li><li id="0161" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/AreaElement-class.html" rel="noopener ugc nofollow" target="_blank"> AreaElement </a>:行间的区域。</li><li id="39f9" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/IntervalElement-class.html" rel="noopener ugc nofollow" target="_blank"> IntervalElement </a>:两点之间的间隔。</li><li id="0b3f" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/PolygonElement-class.html" rel="noopener ugc nofollow" target="_blank">多边形单元</a>:分割一个平面的多边形。</li></ul><p id="7dbf" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">图表中条形的高度代表0和基准值之间的间隔，因此我们选择<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/IntervalElement-class.html" rel="noopener ugc nofollow" target="_blank"> IntervalElement </a>。这样我们就得到了一个非常常见的<strong class="ik hi">条形图</strong>:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/039747ce2beb6a2a34f997aa6595618a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-4oDv4YVioNegvRAjxj-Q.jpeg"/></div></div></figure><p id="eff1" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">让我们回到最初的探索。饼图中的角度也显示区间，所以我们也应该选择<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/IntervalElement-class.html" rel="noopener ugc nofollow" target="_blank"> IntervalElement </a>。但是为什么条形图呈现矩形，而饼图呈现扇形呢？</p><h1 id="c45e" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">坐标</h1><p id="2d5b" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">坐标将变量分配到平面中的不同维度。对于矩形坐标(<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/RectCoord-class.html" rel="noopener ugc nofollow" target="_blank"> RectCoord </a>)，尺寸为水平和垂直；而对于极坐标(<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/PolarCoord-class.html" rel="noopener ugc nofollow" target="_blank"> PolarCoord </a>)，尺寸是角度和半径。</p><p id="fa4e" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">上面的例子没有指出<code class="du lj lk ll jx b">coord</code>属性，所以设置了一个默认的矩形坐标。由于饼图用角度显示区间，所以应该是极坐标。我们添加一个定义来表明:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="8a4d" class="kb kc hh jx b fi kd ke l kf kg">coord: PolarCoord()</span></pre><p id="6184" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">然后图表变成了<strong class="ik hi">玫瑰图</strong>:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/efa1ca2773f2329c2e407bfae4ca9fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4ey570O_xm2WnNWKsonAw.jpeg"/></div></div></figure><p id="b7d0" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">这似乎越来越接近饼状图。但是图形看起来不完美。它需要修理一下。</p><h1 id="eeb4" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">规模</h1><p id="207a" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">第一个问题是，扇形半径的比例似乎不等于<code class="du lj lk ll jx b">salse</code>值的比例。</p><p id="6d93" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">这个问题围绕着图形语法的一个重要概念:比例。</p><p id="7ac8" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">原始数据值可以是数字、字符串或时间。即使只是数字，数值也可能相差几个数量级。所以在用于图表之前，它们应该被标准化。这一步称为缩放。</p><p id="94bb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">数字、时间等连续数据要归一化到<code class="du lj lk ll jx b">[0, 1]</code>；而离散数据(如字符串)应该映射到自然数索引(如0、1、2、3)...</p><p id="e6de" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">每个变量都有一个响应范围，在<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Variable-class.html" rel="noopener ugc nofollow" target="_blank">变量</a>的<code class="du lj lk ll jx b">scale</code>属性中设置。<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Tuple.html" rel="noopener ugc nofollow" target="_blank">元组</a> s中的变量值可以是<code class="du lj lk ll jx b">num</code>、<code class="du lj lk ll jx b">DateTime</code>或<code class="du lj lk ll jx b">String</code>中的一个，因此标尺按输入值类型分类:</p><ul class=""><li id="1143" class="lm ln hh ik b il im ip iq jt lo ju lp jv lq jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/LinearScale-class.html" rel="noopener ugc nofollow" target="_blank"> LinearScale </a>:将一系列数字归一化为<code class="du lj lk ll jx b">[0, 1]</code>，连续。</li><li id="c4a5" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/TimeScale-class.html" rel="noopener ugc nofollow" target="_blank">时间刻度</a>:将时间范围归一化为<code class="du lj lk ll jx b">[0, 1]</code>数字，连续。</li><li id="1390" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/OrdinalScale-class.html" rel="noopener ugc nofollow" target="_blank"> OrdinalScale </a>:按顺序将字符串映射到自然数索引，离散。</li></ul><p id="0f02" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">对于数字，默认的<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/LinearScale-class.html" rel="noopener ugc nofollow" target="_blank">线性标度</a>将根据输入数据确定范围，因此范围最小值可能不是0。对于条形图，这将使图表聚焦于条形的高度差异。但它并不适合玫瑰图，因为人们倾向于把半径比当作价值比。</p><p id="a948" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">因此，<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/LinearScale-class.html" rel="noopener ugc nofollow" target="_blank">线性标尺</a>的量程最小值应手动设置为0:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="4523" class="kb kc hh jx b fi kd ke l kf kg">'sales': Variable(<br/>  accessor: (Map map) =&gt; map['sales'] as num,<br/>  scale: LinearScale(min: 0),<br/>),</span></pre><h1 id="2c45" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">审美属性</h1><p id="d8c5" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">第二个问题是，由于扇区是相邻的，它们的颜色应该是可以区分的。而且人们更喜欢用标签，而不是轴，来注释玫瑰图。</p><p id="8356" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">感知图形的属性，如颜色或标签，被称为美学属性。在<a class="ae jg" href="https://github.com/entronad/graphic" rel="noopener ugc nofollow" target="_blank">图文</a>中它们是:</p><ul class=""><li id="0a28" class="lm ln hh ik b il im ip iq jt lo ju lp jv lq jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">position</code></li><li id="e0d0" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">shape</code></li><li id="db08" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">color</code></li><li id="c8b5" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">gradient</code></li><li id="9506" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">elevation</code></li><li id="75f5" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">label</code></li><li id="f895" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">size</code></li></ul><p id="987a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">除了<code class="du lj lk ll jx b">position</code>之外，它们都在<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/GeomElement-class.html" rel="noopener ugc nofollow" target="_blank">几何元素</a>中由相应的<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Attr-class.html" rel="noopener ugc nofollow" target="_blank">属性</a>类定义。根据定义属性，可以通过以下方式指定它们:</p><ul class=""><li id="5fb3" class="lm ln hh ik b il im ip iq jt lo ju lp jv lq jf lr ls lt lu bi translated">直接指示<code class="du lj lk ll jx b">value</code>。</li><li id="f582" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated">表示对应的<code class="du lj lk ll jx b">variable</code>，以及目标属性<code class="du lj lk ll jx b">values</code>和<code class="du lj lk ll jx b">stopes</code>。变量值将被插值或映射到属性值。这些类型的属性被称为<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/ChannelAttr-class.html" rel="noopener ugc nofollow" target="_blank">通道属性</a></li><li id="b976" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated">指示如何通过<code class="du lj lk ll jx b">encoder</code>将元组编码为属性值。</li></ul><p id="6582" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">在本例中，我们以第二种方式指定颜色和标签:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="f429" class="kb kc hh jx b fi kd ke l kf kg">elements: [IntervalElement(<br/>  color: ColorAttr(<br/>    variable: 'category',<br/>    values: Defaults.colors10,<br/>  ),<br/>  label: LabelAttr(<br/>    encoder: (tuple) =&gt; Label(<br/>      tuple['category'].toString(),<br/>    ),<br/>  ),<br/>)]</span></pre><p id="ef26" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">因此我们得到了一个更好的玫瑰图:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/6ad612a0da9000a0113bc8b8e12a65cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYVtoU4lDJojwV8aMXvn1g.jpeg"/></div></div></figure><p id="114f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">但是如何将玫瑰图转化为饼状图呢？</p><h1 id="ff7a" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">转置坐标</h1><p id="a382" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">数据的变量往往有一个函数关系:<code class="du lj lk ll jx b">y = f(x)</code>。我们说x在定义域维度，y在测度维度。习惯上，对于平面，矩形坐标将域维度分配给水平方向，将测量维度分配给垂直方向；而极坐标将域尺寸分配给角度，将测量尺寸分配给半径。</p><p id="79c5" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">玫瑰图显示半径值，而饼图显示角度值。所以第一步是切换维度的对应关系。这被称为移调:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="634d" class="kb kc hh jx b fi kd ke l kf kg">coord: PolarCoord(transposed: true)</span></pre><p id="2055" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">然后图形转换成一个<strong class="ik hi">赛车图</strong>:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/99d67bd6018f9d056b4fb9c1e9a54243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hzGQspyLM7i5nR4H9Ctnyg.jpeg"/></div></div></figure><p id="45cf" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">它似乎更接近于饼状图。</p><h1 id="afe7" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">可变变换</h1><p id="8509" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">饼图中的扇形组成了一个完整的圆，弧线与周长的比率是数值与总和的比率。但上图中，弧线之和明显大于周长。</p><p id="329b" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">一种解决方案是将<code class="du lj lk ll jx b">sales</code>的缩放范围设置在0和所有<code class="du lj lk ll jx b">sales</code>的总和之间，然后缩放后的<code class="du lj lk ll jx b">sales</code>值是总和的比率。但是对于动态数据，我们在定义图表时通常不知道数值。</p><p id="a575" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">另一种解决方案是，如果度量维度变量是<code class="du lj lk ll jx b">sales</code>的比例，那么我们只需要将比例范围设置为<code class="du lj lk ll jx b">[0, 1]</code>。</p><p id="f5db" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">这就是为什么我们需要<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/VariableTransform-class.html" rel="noopener ugc nofollow" target="_blank">变量转换</a>。它可以将统计变换应用于当前变量，以修改元组或创建新变量。这里我们使用<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Proportion-class.html" rel="noopener ugc nofollow" target="_blank">比例</a>，它计算<code class="du lj lk ll jx b">sales</code>值的比例，并将它们赋给一个新的<code class="du lj lk ll jx b">percent</code>变量，其默认比例范围为<code class="du lj lk ll jx b">[0, 1]</code>:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="979e" class="kb kc hh jx b fi kd ke l kf kg">transforms: [<br/>  Proportion(<br/>    variable: 'sales',<br/>    as: 'percent',<br/>  ),<br/>]</span></pre><h1 id="2612" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">图形代数</h1><p id="7e56" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">在我们应用转换后，出现了一个新问题。tuple之前只有两个变量<code class="du lj lk ll jx b">category</code>和<code class="du lj lk ll jx b">sales</code>，而它们恰好可以分别赋给两个维度。没什么需要设置的。但是现在，增加了一个额外的变量<code class="du lj lk ll jx b">percent</code>。如何给两只猴子分配三个栗子？这里需要一个明确的规范。</p><p id="a1ff" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">为了定义变量和量纲之间的关系，我们需要图形代数。</p><p id="eedf" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">图形代数用一个连接<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Varset-class.html" rel="noopener ugc nofollow" target="_blank">变量集</a> s(变量集)和操作符的表达式指定变量关系以及它们如何分配给尺寸。有树运算符:</p><ul class=""><li id="afdc" class="lm ln hh ik b il im ip iq jt lo ju lp jv lq jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">*</code> : cross，将两个操作数依次赋给两个维度。</li><li id="30b4" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">+</code> : blend，将两个操作数依次赋给同一个维度。</li><li id="5da2" class="lm ln hh ik b il lv ip lw jt lx ju ly jv lz jf lr ls lt lu bi translated"><code class="du lj lk ll jx b">/</code> : nest，根据第二个操作数对所有元组进行分组。</li></ul><p id="bfcf" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">我们需要将<code class="du lj lk ll jx b">category</code>和转换后的<code class="du lj lk ll jx b">percent</code>分别分配给域维度和度量维度。得益于Dart的运算符覆盖，<a class="ae jg" href="https://github.com/entronad/graphic" rel="noopener ugc nofollow" target="_blank"> Graphic </a>通过<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Varset-class.html" rel="noopener ugc nofollow" target="_blank"> Varset </a>类实现了所有的图形代数。所以我们定义<code class="du lj lk ll jx b">position</code>为:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="cbf3" class="kb kc hh jx b fi kd ke l kf kg">position: Varset('category') * Varset('percent')</span></pre><p id="957a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">设置变量变换和图形代数后，图形变成:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/29c69c453ab09f4deb280f846e00b83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HjsHYt4ligoE2-w27YtV3w.jpeg"/></div></div></figure><h1 id="19ee" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">分组和修改器</h1><p id="770c" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">弧长的部门进行处理，然后我们应该“拼接”他们。拼接的第一步是将它们的位置调整到首尾相接。</p><p id="bb48" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">该位置调整由<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/Modifier-class.html" rel="noopener ugc nofollow" target="_blank">修饰符</a> s指定，调整的对象不是单元组，而是元组组。所以我们应该按照<code class="du lj lk ll jx b">category</code>对元组进行分组。因此，对于示例数据，每个组将具有单个元组。分组是由图形代数的嵌套运算符指定的。然后我们可以设置<a class="ae jg" href="https://pub.dev/documentation/graphic/latest/graphic/StackModifier-class.html" rel="noopener ugc nofollow" target="_blank">堆栈修改器</a>:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="0a0b" class="kb kc hh jx b fi kd ke l kf kg">elements: [IntervalElement(<br/>  ...<br/>  position: Varset('category') * Varset('percent') / Varset('category'),<br/>  modifiers: [StackModifier()],<br/>)]</span></pre><p id="f7f0" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">由于我们使总弧长等于周长，所以这些扇形叠加后就成了首尾相连，可以看作是<strong class="ik hi">日出图:</strong></p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/75d5e46a0f849e816ff581e404933bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRxb6BZHqxFdtdDrHmTjoQ.jpeg"/></div></div></figure><h1 id="2b81" class="kh kc hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">坐标尺寸</h1><p id="c426" class="pw-post-body-paragraph ih ii hh ik b il le in io ip lf ir is jt lg iv iw ju lh iz ja jv li jd je jf ha bi translated">因为扇形的角度已经就位，所以只需要最后一步:扩大半径，使扇形形成一个大洞。</p><p id="b5bb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">让我们看看半径维度。我们刚刚用代数给它赋值了<code class="du lj lk ll jx b">category</code>变量，所以扇区分别落入不同的“轨道”。但事实上，我们不希望它们在半径维度上不同。我们只需要它们的角度不同。换句话说，我们更喜欢极坐标是1D坐标。</p><p id="8d50" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">我们只需要将坐标维数表示为1，并从代数表达式中删除<code class="du lj lk ll jx b">category</code>:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="ba36" class="kb kc hh jx b fi kd ke l kf kg">coord: PolarCoord(<br/>  transposed: true,<br/>  dimCount: 1,<br/>)<br/>...<br/>position: Varset('percent') / Varset('category')</span></pre><p id="fe51" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">然后扇形膨胀圆半径，我们完成了<strong class="ik hi">饼状图</strong>:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ma"><img src="../Images/e4129a31eaf5265e496b1adc8c6ef639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QzaHkXUEo-Q0An4T2ocCaQ.jpeg"/></div></div></figure></div><div class="ab cl mb mc go md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ha hb hc hd he"><p id="776a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">完整的规格是:</p><pre class="ji jj jk jl fd jw jx jy jz aw ka bi"><span id="7d66" class="kb kc hh jx b fi kd ke l kf kg">Chart(<br/>  data: data,<br/>  variables: {<br/>    'category': Variable(<br/>      accessor: (Map map) =&gt; map['category'] as String,<br/>    ),<br/>    'sales': Variable(<br/>      accessor: (Map map) =&gt; map['sales'] as num,<br/>      scale: LinearScale(min: 0),<br/>    ),<br/>  },<br/>  transforms: [<br/>    Proportion(<br/>      variable: 'sales',<br/>      as: 'percent',<br/>    ),<br/>  ],<br/>  elements: [IntervalElement(<br/>    position: Varset('percent') / Varset('category'),<br/>    groupBy: 'category',<br/>    modifiers: [StackModifier()],<br/>    color: ColorAttr(<br/>      variable: 'category',<br/>      values: Defaults.colors10,<br/>    ),<br/>    label: LabelAttr(<br/>      encoder: (tuple) =&gt; Label(<br/>        tuple['category'].toString(),<br/>        LabelStyle(Defaults.runeStyle),<br/>      ),<br/>    ),<br/>  )],<br/>  coord: PolarCoord(<br/>    transposed: true,<br/>    dimCount: 1,<br/>  ),<br/>)</span></pre><p id="764d" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">在上面的过程中，我们不断地改变图形的规格，如坐标、比例、美学属性、变量变换和修改器。我们得到了一个条形图，一个玫瑰图，一个赛程表，一个日出图，还有一个传统图表类型的饼图，按顺序排列:</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es mi"><img src="../Images/532208c7c5fe8b357b301030f9f4135a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kYsjnZtMzhhQElP90-C-HQ.jpeg"/></div></div></figure><p id="b392" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jt iu iv iw ju iy iz ja jv jc jd je jf ha bi translated">由此可见，图形语法跳出了传统图表类型的束缚，可以生成更多的可视化图形，具有更好的灵活性和可扩展性。更重要的是，它揭示了不同可视化图形之间的内在联系，为数据可视化科学提供了理论基础。</p></div></div>    
</body>
</html>