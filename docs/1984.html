<html>
<head>
<title>How to Use React in Django — the Hard Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Django中使用React困难的方法</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-use-react-in-django-the-hard-way-6ef2bf8c5d6f?source=collection_archive---------1-----------------------#2021-03-30">https://medium.com/analytics-vidhya/how-to-use-react-in-django-the-hard-way-6ef2bf8c5d6f?source=collection_archive---------1-----------------------#2021-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b88c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated">在<a class="ae jm" rel="noopener" href="/analytics-vidhya/how-to-add-react-js-into-django-24e79e67e992">的上一篇文章</a>中，我们已经学习了如何在Django中使用React.js的基础教程。主要关注前端，和Django view联系不大。我知道这还不够。困难来了。</p><p id="51fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将深入探讨web应用程序中的一个常见特性——表单提交。Django的传统方式是在后端构建表单，并在主模板中呈现它。如果您需要用户和GUI之间的一些交互，请添加JS代码。缺点是，如果表单GUI很复杂，前端代码可能很难维护。因为表单很可能需要手动呈现。另外，我们可能还需要为表单交互创建和导入一个专用的JS文件。请记住，有时一个页面可能有多个表单。真让人头疼！我们需要能把HTML和JS放在一个文件里的东西。然后反应过来救援。由于其基于组件的设计，我们可以在JS文件中为每个表单维护模板和交互代码。它使主模板干净。当你读到本文结尾的结论时，你就会明白我的意思了。</p><p id="22c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照本文中的步骤，我们将构建一个完整的工作流，它依赖于前端的React和后端的Django。正如我在上一篇文章中提到的，我仍然打算使用Django作为一个web框架。这篇文章可能要求你对React组件、JSX语法、Django表单和Bootstrap有基本的了解。在教程的最后，我们将创建一个表单小部件，并能够提交POST请求。</p><p id="2aed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">依赖关系:</p><ol class=""><li id="49fc" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated">Python 3.7</li><li id="aef5" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">Django 2.2.x</li><li id="bb27" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">反应17</li><li id="eb0f" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">AdminLTE 3.0.5(关于这个主题库，请参见我之前的教程)</li></ol></div><div class="ab cl kb kc gp kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hb hc hd he hf"><h1 id="467c" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">步骤0。临时项目和目标</h1><p id="59a8" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">我已经上传了1.0.0版本的草稿项目。点击下面的链接，下载“ScratchProject”。zip文件。</p><p id="ee20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jm" href="https://github.com/slow999/DjangoAndReactComponentForm/releases/tag/1.0.0" rel="noopener ugc nofollow" target="_blank">https://github . com/slow 999/djangoeriactcomponentform/releases/tag/1 . 0 . 0</a></p><p id="5f6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始计划，看看我们有什么。在<strong class="ih hj">127 . 0 . 0 . 1:8000/polls</strong>/page中，我们的目标是在白盒中添加一个表单小部件。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es ll"><img src="../Images/51f75a7fb65d7c2f29aee44ae56313ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*L-AOG7x2bYOl72pxtIwYiA.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">目标页面</figcaption></figure><p id="10c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">scratch项目的架构如下。我们将主要工作在<strong class="ih hj">民调</strong> app和<strong class="ih hj">index.html</strong>模板。React和JSX库维护在<strong class="ih hj">静态/插件/react/ </strong>文件夹中。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lx"><img src="../Images/89eca4cd6cb8584c8fde9bed0f8a157e.png" data-original-src="https://miro.medium.com/v2/resize:fit:346/format:webp/1*x26EvLciMjji9e9Z6TpxEg.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">暂存项目的模式</figcaption></figure><h1 id="55a6" class="ki kj hi bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf bi translated">添加CSRF脚本</h1><p id="169e" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">Django的安全机制之一是通过CSRF中间件来防止跨站点请求伪造。每当发出POST请求时，它都是必需的。因为我们使用React在模板中呈现表单，所以使用{% csrf_token %}的传统方式不再适用。相反，我们需要手动操作。这个脚本的目标是产生一个CSRF令牌<input/>元素，这个元素需要添加到表单中。代码片段如下。</p><figure class="lm ln lo lp fd lq"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="5d58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们将这个脚本导入到<strong class="ih hj"> extra_js </strong>块中的<strong class="ih hj">index.html</strong>文件中。</p><pre class="lm ln lo lp fd mj mk ml mm aw mn bi"><span id="23cb" class="mo kj hi mk b fi mp mq l mr ms">{% block extra_js %}<br/>   &lt;script src="{% static 'dist/js/csrftoken.js' %}" type="text/babel"&gt;&lt;/script&gt;<br/>{% endblock %}</span></pre><h1 id="ea90" class="ki kj hi bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf bi translated">步骤2添加表单划分和反应表单脚本</h1><p id="d657" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">在<strong class="ih hj">index.html</strong>文件中，添加一个分部并分配id“registration _ form”。我们将在本部分中呈现反应形式。下面是代码片段。</p><pre class="lm ln lo lp fd mj mk ml mm aw mn bi"><span id="cf39" class="mo kj hi mk b fi mp mq l mr ms">&lt;div class="col-lg-12"&gt;<br/>   &lt;div class="card"&gt;<br/>     &lt;div class="card-body"&gt;<br/>       &lt;h5 class="card-title"&gt;Registration&lt;/h5&gt;<br/>       &lt;p class="card-text"&gt;<br/>         Fill in neccessary info and submit.<br/>       &lt;/p&gt;<br/>       &lt;div id="registration_form"&gt;&lt;/div&gt;<br/>     &lt;/div&gt;<br/>   &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="a70c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> polls </strong> app中创建一个<strong class="ih hj">静态</strong>文件夹。在我们刚刚创建的<strong class="ih hj">静态</strong>文件夹中，创建<strong class="ih hj"> polls </strong>文件夹。然后在我们刚刚创建的<strong class="ih hj"> polls </strong>文件夹中创建<strong class="ih hj"> registration_form.js </strong>。这可能会令人困惑。一张照片意味着千言万语。您可能会想到下面的模式。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es mt"><img src="../Images/a6ef33ece6bab3c3bc8fb009e57d52c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*yAXFG8PIJKwRiyxSNT8Ecg.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">registration_form.js文件路径</figcaption></figure><p id="ba86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> registration_form.js </strong>文件中，我们将React form构建为一个组件。我将在几分钟内粘贴代码片段。值得一提的是</p><ol class=""><li id="4d15" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated">这个表单小部件有两个步骤。GUI由“返回”和“下一步”按钮控制。<input/>元素的可见性由<strong class="ih hj"> d-none </strong>类控制。</li><li id="c2dd" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">CSRF令牌输入通过<csrftoken/>在<form>标签内声明。</form></li><li id="7a00" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">提交行为由<strong class="ih hj"> handleSubmit </strong>函数控制。</li></ol><p id="504c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码片段如下。</p><figure class="lm ln lo lp fd lq"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="a5b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，将该脚本导入到<strong class="ih hj"> extra_js </strong>块中的<strong class="ih hj">index.html</strong>中。我们期待以下结果。</p><pre class="lm ln lo lp fd mj mk ml mm aw mn bi"><span id="7916" class="mo kj hi mk b fi mp mq l mr ms">{% block extra_js %}<br/>   &lt;script src="{% static 'dist/js/csrftoken.js' %}" type="text/babel"&gt;&lt;/script&gt;<br/>   &lt;script src="{% static 'polls/registration_form.js' %}" type="text/babel"&gt;&lt;/script&gt;<br/>{% endblock %}</span></pre><p id="fbe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动项目并检查结果。表单小部件是活的！此时，提交按钮将引发异常。让我们在下一步解决这个问题。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es mu"><img src="../Images/a8ac31baf79a35054db0b65b7900e481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*BHaIl-U6DK-X1FsSQAG9jA.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">目标页面的屏幕截图</figcaption></figure><h1 id="14d3" class="ki kj hi bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf bi translated">步骤3添加Django表单</h1><p id="400c" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">Django表单的用途是验证表单输入。我们称之为后端验证。在<strong class="ih hj"> polls </strong> app中，创建一个<strong class="ih hj"> forms.py </strong>文件。并添加以下代码。请注意我们使用表格。验证电子邮件值模式的EmailField。</p><figure class="lm ln lo lp fd lq"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="cc4a" class="ki kj hi bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf bi translated">第四步修改视图功能</h1><p id="9d13" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">在<strong class="ih hj"> polls/views.py </strong>文件中，我们的目标是做以下事情。</p><ol class=""><li id="504b" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated">添加发布请求案例</li><li id="ab7f" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">使用我们在上一步中构建的注册表单来验证输入</li><li id="ff43" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">生成消息</li></ol><p id="ff46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们期待如下代码。请注意，我们将在控制台中打印输入。</p><figure class="lm ln lo lp fd lq"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="d53e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要在模板中呈现消息。在polls/templates/polls/<strong class="ih hj">index.html</strong>文件中，在主要内容划分前添加以下代码。这段代码涵盖以下情况。</p><ol class=""><li id="0d15" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated">如果提交成功，它会在绿色框中显示成功消息。</li><li id="5c58" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated">如果表单输入无效，它会在一个红框中显示错误消息。</li></ol><pre class="lm ln lo lp fd mj mk ml mm aw mn bi"><span id="65bb" class="mo kj hi mk b fi mp mq l mr ms">&lt;div class="content"&gt;<br/>   &lt;div class="container-fluid"&gt;<br/>     {% if messages %}<br/>       {% for message in messages %}<br/>         {% if message.tags == 'error' %}<br/>           &lt;div class="alert alert-danger" role="alert"&gt;<br/>         {% else %}<br/>           &lt;div class="alert alert-{{ message.tags }}" role="alert"&gt;<br/>         {% endif %}<br/>           {{ message }}<br/>         &lt;/div&gt;<br/>       {% endfor %}<br/>     {% endif %}<br/> <br/>     {% if form.errors %}<br/>     &lt;div class="alert alert-danger" role="alert"&gt;<br/>       {{ form.non_field_errors }}<br/>       {% for field in form %}<br/>         {% for error in field.errors %}<br/>           {{ error }}<br/>         {% endfor %}<br/>       {% endfor %}<br/>     &lt;/div&gt;<br/>     {% endif %}<br/>   &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="afa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是完整的民意调查/模板/民意调查/<strong class="ih hj">index.html</strong>文件。</p><figure class="lm ln lo lp fd lq"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="23d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">至此，我们已经完成了一切。让我们看看最终产品！填写数据并提交。我们应该会在控制台中看到类似的输入，如下所示。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es mu"><img src="../Images/5439dc6f446a3d8d3f4ceb591d0b8a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*8pJjSOJ5leYSX8Ljrr8fEg.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">控制台打印</figcaption></figure><p id="90f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前端应该有如下成功消息。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es mv"><img src="../Images/834f44d9d214be85c7669a667976cffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*DW_cP7PzMImgRUV9XemNXQ.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">目标页面中的成功消息</figcaption></figure><p id="7310" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">错误信息如下。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es mv"><img src="../Images/1428ddb7ae3e43c23621adc6bfb4428b.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*iYiZEKNbT0oTwv2GlGD5uA.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">目标页面中的错误消息</figcaption></figure><p id="6cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终模式如下。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es mw"><img src="../Images/198038f14aa1d3c989eceafac8a3a4ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*x7jIkER-IUlcHMI_V5Qo9g.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx translated">最终模式</figcaption></figure><h1 id="cf5f" class="ki kj hi bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf bi translated">结论</h1><p id="32c2" class="pw-post-body-paragraph if ig hi ih b ii lg ik il im lh io ip iq li is it iu lj iw ix iy lk ja jb jc hb bi translated">在本教程中，我们充分利用了Django和React。React负责呈现复杂的GUI。index.html的<strong class="ih hj">文件是主模板。我们没有将表单模板和js代码转储到主模板中，而是构建了一个<strong class="ih hj"> registration_form.js </strong>来封装表单组件。我们所需要做的就是导入它，并告诉React我们希望将表单渲染到哪个部门。此外，这个React表单组件也可以在其他页面中重用。Django负责处理HTTP请求并提供必要的验证。整个系统运行在Django web框架上，该框架通过CSRF令牌提供安全机制。现在享受华丽的图形用户界面，无需担心安全性！希望这位建筑师能对你目前的项目有所提示。</strong></p><p id="7ee8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你感兴趣，我已经把这个项目上传到我的GitHub上了。项目名称为DjangoAndReactComponentForm。</p><p id="aad7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jm" href="https://github.com/slow999/DjangoAndReactComponentForm" rel="noopener ugc nofollow" target="_blank">https://github.com/slow999/DjangoAndReactComponentForm</a></p><p id="d978" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读。我想知道你对React + Django组合的想法。请在下面留下你的评论。敬请关注。</p><p id="c0df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在上面拍了视频。请查看以下内容。</p><figure class="lm ln lo lp fd lq"><div class="bz dy l di"><div class="mx mi l"/></div></figure></div></div>    
</body>
</html>