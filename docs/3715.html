<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/banknote-authentication-app-end-to-end-with-dockers-322541eda7fa?source=collection_archive---------6-----------------------#2021-07-19">https://medium.com/analytics-vidhya/banknote-authentication-app-end-to-end-with-dockers-322541eda7fa?source=collection_archive---------6-----------------------#2021-07-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><p id="eef8" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated"><strong class="hi ie">与码头工人端到端的钞票认证App</strong></p></div><div class="ab cl if ig go ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="ha hb hc hd he"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/ca654c08b52d7fdda9e7c99e89f27853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LO4rbUQj_xsCyTRE3yko0g.jpeg"/></div></div></figure><p id="84fa" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">嘿伙计们！！希望你一切都好。所以我又写了一篇博客，我想为什么不和大家分享。我试图找到一些博客，但找不到一个关于这个的，所以为什么不写一个呢？但所有人都向克里斯·纳伊克致敬！！。他对所有视频的解释都很透彻。想学的话可以试试这个。这实际上是我在这里实现的一系列播放列表，显然我将讨论我面临的一些问题。</p><p id="78f3" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">所以事不宜迟，让我们开始吧。显然，正如标题所示，我们将在docker上部署我们的应用程序，然后尝试运行它。我不能保证让它互动，但肯定你会学到更多。</p><p id="9543" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">首先，我们将把机器学习模型应用于现实生活中的一个问题，即我们案例中的钞票认证。显然，我们可以从kaggle中挑选数据。这是下面的链接:</p><p id="8173" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated"><a class="ae iy" href="https://www.kaggle.com/ritesaluja/bank-note-authentication-uci-data" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/ritesaluja/bank-note-authentic ation-UCI-data</a></p><p id="d66f" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">我们不会深究精度，以及我要应用什么样的模型。相反，我们将尝试更多地关注部署，但由于我不想错过哪怕一点点，所以我将全部分享。在csv文件中，您可以看到，我们有4个特征，方差、偏斜度、曲率和熵，因此基于此，有一个从属特征(即标签)。如果是0，表示钞票没有通过认证，如果是1，表示通过认证。轻松右转！！！！。希望你一直陪在我身边。我将分享下面的代码来应用分类模型。</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="7c25" class="je jf hh ja b fi jg jh l ji jj">import pandas as pd<br/>import numpy as np<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import RandomForestClassifier<br/>from sklearn.metrics import accuracy_score</span><span id="6258" class="je jf hh ja b fi jk jh l ji jj">df=pd.read_csv('BankNote_Authentication.csv')</span><span id="f041" class="je jf hh ja b fi jk jh l ji jj">X=df.iloc[:,:-1]<br/>y=df.iloc[:,-1]</span><span id="a291" class="je jf hh ja b fi jk jh l ji jj">X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=0)</span><span id="b6ff" class="je jf hh ja b fi jk jh l ji jj">rfc=RandomForestClassifier()<br/>rfc.fit(X_train,y_train)</span><span id="fb38" class="je jf hh ja b fi jk jh l ji jj">y_pred=rfc.predict(X_test)</span><span id="15f9" class="je jf hh ja b fi jk jh l ji jj">score=accuracy_score(y_pred,y_test)</span></pre><p id="6f01" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">准确率98%。我们会继续下去。我知道你心里可能有些疑问。她为什么选择RandomForest，准确率怎么会这么高，是什么让她认为她应该将测试规模作为20%，但是但是有很多材料可以深入研究分类模型和所有问题的答案，但是现在这是一个部署的小项目，所以我们今天不讨论这个问题。但可以肯定的是，有一天我会回答你的问题。</p><p id="3675" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">现在，因为我们已经准备好了我们的分类器，它已经被完美地训练过了，现在无论你给的特征值是什么，它都会预测这张纸币是否被认证。因为我们将有很多文件，所以我们需要这个分类器在手。所以我们要用泡菜。</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="d0f9" class="je jf hh ja b fi jg jh l ji jj">import pickle<br/>pickle_out=open('classifier.pkl','wb')<br/>pickle.dump(rfc,pickle_out)<br/>pickle_out.close()</span></pre><p id="fc59" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">使用pickle，您已经打包了您的分类器，现在只要您卸载这个文件，您就能够预测不同文件中的更多内容。</p><p id="c201" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">下一个任务是创建一个flask应用程序。为此，你将需要html文件，一些CSS的互动会话，引导，但我们会做一个简单的网站，并部署在docker。下面的代码是针对app.py的</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="df93" class="je jf hh ja b fi jg jh l ji jj">from flask import *<br/>import pandas as pd<br/>import numpy as np<br/>import pickle <br/>app=Flask(__name__)<br/>pickle_in=open("classifier.pkl","rb")<br/>classifier=pickle.load(pickle_in)</span><span id="253f" class="je jf hh ja b fi jk jh l ji jj"><a class="ae iy" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/',methods=["GET","POST"])<br/>def predict_notes():<br/>    if request.method=="GET":<br/>        return "Welcome"<br/><a class="ae iy" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/upload')   <br/>def upload():<br/>    return render_template('upload.html')<br/>    <br/><a class="ae iy" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/predict',methods=["POST"])    <br/>def predict():<br/>    if request.method == "POST":<br/>        file = request.files['file']<br/>    df=pd.read_csv(file)<br/>    prediction=[]<br/>    for i in range(len(df.index)):<br/>        variance=df.variance[i]<br/>        skewness=df.skewness[i]<br/>        curtosis=df.curtosis[i]<br/>        entropy=df.entropy[i]<br/>        answer=classifier.predict([[variance,skewness,curtosis,entropy]])<br/>        str1="The answer for variance="+str(variance)+" &amp; skewness="+str(skewness)+" &amp; curtosis="+str(curtosis)+" &amp; entropy="+str(entropy)+" is: "+str(classifier.predict([[variance,skewness,curtosis,entropy]]))<br/>        prediction.append(str1)<br/>    <br/>    return render_template('predict.html',prediction=prediction)</span><span id="f861" class="je jf hh ja b fi jk jh l ji jj">if __name__=='__main__':<br/>    app.run(host = "0.0.0.0",port=3030)</span></pre><p id="42fd" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">我会解释这一切，但请确保提供主机和端口，因为它是。这对于部署来说是非常重要的一步。这里我们有一个欢迎页面，上传页面将上传一个csv文件，该文件将有许多行，用于方差、偏斜度、曲率和熵，我们在此解压缩的朋友(分类器先生)将帮助预测标签。所以如果你了解flask，你一定知道当你点击上传的提交按钮时，它会直接把你带到预测页面。如果你不知道，你有一个问题，如何？？？现在让我分享一下模板文件夹中的upload.html代码。</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="8a1f" class="je jf hh ja b fi jg jh l ji jj">&lt;html&gt;<br/>   &lt;body&gt;<br/>      &lt;form action = "/predict" method = "POST" <br/>         enctype = "multipart/form-data"&gt;<br/>         &lt;input type = "file" name = "file" /&gt;<br/>         &lt;input type = "submit"/&gt;<br/>      &lt;/form&gt;<br/>   &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="8f88" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">在表单的动作属性中，我们提供了下一个网页是什么。所以如果它现在去了predict.html。它会发现它需要打印的只是答案，那就是Jinja2。</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="619b" class="je jf hh ja b fi jg jh l ji jj">&lt;html&gt;<br/>    &lt;body&gt;<br/>    &lt;/body&gt;<br/>    &lt;head&gt;<br/>        &lt;div&gt;<br/>         <br/>            {% for x in prediction %}<br/>            &lt;h3&gt; {{x}} &lt;/h3&gt;<br/>            {%endfor%}<br/>          <br/>        &lt;/div&gt;<br/>    &lt;/head&gt;<br/>&lt;/html&gt;</span></pre><p id="ca19" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">所以预测是我通过render_template从flask发送到html文件的列表。我发誓这很容易。最后，我们完成了flask应用程序，现在我们想进入最后但并非最不重要的部署部分。您需要遵循的步骤是:</p><ol class=""><li id="7ed4" class="jl jm hh hi b hj hk hn ho hr jn hv jo hz jp id jq jr js jt bi translated">在windows上安装docker，如果不是企业版或学生版可以安装docker工具箱</li><li id="a27d" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">重启你的电脑</li><li id="554c" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">在您工作的同一位置创建一个dockerfile文件。</li><li id="87b0" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">在docker文件中，有一些你需要做的文档</li><li id="4e8c" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">在这个docker文件中，您需要创建一个requirements.txt。</li><li id="b461" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">之后，您只需运行两个命令就可以在docker机器上工作了。</li></ol><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="849d" class="je jf hh ja b fi jg jh l ji jj">docker build -t money_api .</span><span id="7694" class="je jf hh ja b fi jk jh l ji jj">docker run -p 3030:3030 money_api</span></pre><p id="e37b" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">你还记得我在创建flask应用程序后说的第一句话是什么吗？你需要写主机和端口，因为将来会用到。我们开始吧，这是我们未来的docker命令，在这里我们写了输入和输出端口。</p><p id="e2ee" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">现在我们将讨论可能的问题。您必须知道在docker文件中添加什么，所以现在开始吧。</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="abdd" class="je jf hh ja b fi jg jh l ji jj">FROM continuumio/anaconda3:latest<br/>COPY . /usr/app/<br/>WORKDIR /usr/app/<br/>RUN pip install -r requirements.txt<br/>CMD python app.py</span></pre><p id="89a2" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">从你添加的水蟒形象。你可以在任何位置打开cmd，你只需要写一个命令</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="adbd" class="je jf hh ja b fi jg jh l ji jj">docker pull continuumio/anaconda3</span></pre><p id="a56e" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">有时它会自己下载图像。当我在我的docker hub中检查容器名称时，这是最新的。名字是《蟒蛇3:最新版》。所以我必须给出完全相同的名字。COPY和WORKDIR将是它的存储位置，也是您必须启动的位置。现在是requirements.txt的时候了。</p><pre class="in io ip iq fd iz ja jb jc aw jd bi"><span id="1456" class="je jf hh ja b fi jg jh l ji jj">Flask==1.1.2<br/>Werkzeug==1.0.1<br/>gunicorn==19.9.0<br/>itsdangerous==1.1.0<br/>MarkupSafe==1.1.1<br/>numpy&gt;=1.9.2<br/>scipy&gt;=0.15.1<br/>scikit-learn==0.22.1<br/>matplotlib&gt;=1.4.3<br/>pandas&gt;=0.19</span></pre><p id="45b3" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">因此，根据我的环境和应用，这些是所使用的库。您可以使用命令进行搜索:pip freeze。或者你可以简单地写flask-version。</p><p id="1806" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">只是要确定一些事情</p><ol class=""><li id="a0d9" class="jl jm hh hi b hj hk hn ho hr jn hv jo hz jp id jq jr js jt bi translated">app.py不是用jupyter编写的，否则如果你在run命令中给出这样的内容，它不会接受。</li><li id="ac9a" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">端口需要与docker命令中的发布端口相同</li><li id="0f8a" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">在浏览器中运行为:<a class="ae iy" href="http://localhost:3030/upload" rel="noopener ugc nofollow" target="_blank">http://localhost:3030/upload</a></li></ol><p id="6d0e" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">现在，创建这个docker文件后，您将在您创建的相同位置打开cmd，并且您的所有文件都在该文件夹中。让我列出来，这样你就不会忘记。</p><ol class=""><li id="5976" class="jl jm hh hi b hj hk hn ho hr jn hv jo hz jp id jq jr js jt bi translated">Model.py</li><li id="a54b" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">App.py</li><li id="26d1" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">Dockerfile文件</li><li id="fe2b" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">requirements.txt</li><li id="6358" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">csv文件</li><li id="e730" class="jl jm hh hi b hj ju hn jv hr jw hv jx hz jy id jq jr js jt bi translated">Pickle文件，它将独立创建。测试文件可以放在任何你可以上传的地方，以便在应用程序中测试模型，因为你可以在你的电脑中浏览它。</li></ol><p id="f350" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">在这个特殊的文件夹中，你有上面列出的所有文件，你将打开cmd并写下我上面提到的命令。构建应用程序一次后，您只需要运行最后一个任务，上面也提到了这个命令。</p><p id="728b" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">然后你就可以走了。如果您有任何疑问，请在下面评论。我会确保为你解决所有的问题。</p><p id="9522" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">希望有帮助！！快乐编码:-)</p></div></div>    
</body>
</html>