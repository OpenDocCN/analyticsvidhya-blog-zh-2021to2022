<html>
<head>
<title>Cohort Analysis in Python with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python与熊猫的队列分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/cohort-analysis-in-python-with-pandas-2677e25db94e?source=collection_archive---------3-----------------------#2021-03-01">https://medium.com/analytics-vidhya/cohort-analysis-in-python-with-pandas-2677e25db94e?source=collection_archive---------3-----------------------#2021-03-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="0507" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">强大的营销分析技术与熊猫在短短几行代码。</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/21386500c9bd15cae35484636d64218e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aSzmcFvrO5ZoJplK"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">卢卡斯·布拉塞克在<a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="1a7f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">群组分析是一种有效的营销实践，虽然不经常使用，但却能得出有力的结论。这种技术可以用来评估不同时间的用户组的不同度量。虽然它在大多数分析平台上都可用(例如，Google Analytics)，但它不如使用Python来执行它灵活。我们将从简单介绍该方法开始，然后使用Python进行实际实现。</p><h1 id="6e76" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">什么是队列分析？</h1><p id="f299" class="pw-post-body-paragraph jn jo hh jp b jq lb ii js jt lc il jv jw ld jy jz ka le kc kd ke lf kg kh ki ha bi translated">群组分析是一种行为分析技术，用于根据用户在计划或网站中的第一次行为(可以是首次出现在网站上、注册或购买)创建的用户组来跟踪特定指标。</p><p id="d8df" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这是有用的，因为如果我们将用户群体作为一个整体来看，这可能会由于异构性而导致问题。通过观察不同用户群在一段时间内的行为，我们可以对我们的业务效率得出更可靠、更有力的结论。</p><p id="162c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">通常，分析使用每周或每月的群组细分。然而，有时营销人员可以使用每日细分的流动业务。我们可以计算每个群组的价值，如保留率、客户生命周期价值(LTV)或客户获取成本(CAC)。对于更深入的分析，可以使用时间以外的其他细分指标(流量来源、设备、国家等。).</p><p id="c62e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">现在，我们知道了什么是群组分析，我们可以开始实际的实施了。</p><h1 id="4678" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">履行</h1><p id="dda8" class="pw-post-body-paragraph jn jo hh jp b jq lb ii js jt lc il jv jw ld jy jz ka le kc kd ke lf kg kh ki ha bi translated">首先，我们需要导入数据。我们将使用Yandex开放数据中的数据。可以从这个<a class="ae jm" href="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/3d249c69-fd8f-419f-8606-554c9a089cd7/event_data.csv?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAT73L2G45O3KS52Y5%2F20210222%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20210222T095910Z&amp;X-Amz-Expires=86400&amp;X-Amz-Signature=0dd3ac0dcc8763229b3c4fa82725a12985c52c3a577412b8063bce0128de7675&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=filename%20%3D%22event_data.csv%22" rel="noopener ugc nofollow" target="_blank">链接</a>进入(对不起，这个链接过期了，我找不到数据)。在下面的代码单元格中，我们从CSV格式读取数据，将<strong class="jp hi"> event_date </strong>列的类型更改为DateTime，并从中提取星期到新列<strong class="jp hi"> event_date_week </strong>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es li"><img src="../Images/2cba50ee57fd9aca07f304ffb09a3e0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpsO21v5-a5n2117wb9TGw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">分析中使用的数据框架</figcaption></figure><p id="4193" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">现在，我们需要确定每个<strong class="jp hi">用户id </strong>的注册周。为此，我们假设(如果我们愿意，我们可以检查)每个用户只有一个注册。</p><p id="ad87" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">从原始数据帧中，我们获取执行注册的行，并从那里提取带有<strong class="jp hi">用户id </strong>和<strong class="jp hi">事件日期周</strong>的行。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es lj"><img src="../Images/6d7b3015f8a6c2e3ecd7177de7916412.png" data-original-src="https://miro.medium.com/v2/resize:fit:596/format:webp/1*I8-2SZV91pFYbtNtUuFxUg.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">df_reg</figcaption></figure><p id="1a36" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">由于我们知道每个用户的注册周，我们可以将其合并到原始数据帧中。为此，我们在两个数据帧上使用python函数<strong class="jp hi"> merge </strong>，并指定我们在<strong class="jp hi"> user_id </strong>上进行合并，以及通过原始数据帧进行合并(即使用户在数据帧中出现两次或更多次，也要输入注册日期)。我们还通过从手术周中减去登记周来找到手术时的群组寿命(特定行)。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lk"><img src="../Images/e7bfaff535750fdd4a76085e21a9945f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d9nYlGCLI41itKOq00K9PQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">合并后的df</figcaption></figure><p id="0062" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">下一步是使用我最喜欢的熊猫<strong class="jp hi"> pivot_table </strong>函数创建一个数据透视表。要更熟练地使用这个强大的工具，请查看我的关于数据透视表的视频或我的媒体文章。作为指标，我们使用<strong class="jp hi">注册_周</strong>和<strong class="jp hi">群组_寿命</strong>；作为值，我们计算每个群组每个特定周的唯一用户id的数量。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es ll"><img src="../Images/6e74b7c81f5cbec7a5fc65068e654352.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*ofdKyS4TdVyL5kU8m3EkKA.png"/></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">生成的数据透视表</figcaption></figure><p id="6e88" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">看起来棒极了！我们从分析中获得了有用信息的第一次迭代。我们可以看到每个群体在其一生中人数是如何变化的。</p><p id="ec81" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然而，为了计算所需的度量，我们需要稍微多一点的努力。例如，我们可以计算保留率，并绘制一个漂亮的图表。</p><h1 id="8abb" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">保留率</h1><p id="023a" class="pw-post-body-paragraph jn jo hh jp b jq lb ii js jt lc il jv jw ld jy jz ka le kc kd ke lf kg kh ki ha bi translated">当我们执行新的广告或活动以及推出新产品或服务时，保留率是评估的最重要指标之一。这是衡量客户保持率或一段时间后仍然是客户的人的百分比。其计算方法如下:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lm"><img src="../Images/b9528f6419156fb9460979dd4622aae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0kUnk5hufbrQIKLcdUlxjA.png"/></div></div></figure><p id="9d43" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">对于我们的群组分析，我们将特定群组中剩余的客户数量除以该群组中所有用户的数量(在同一周注册)。</p><p id="62f1" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">因此，我们需要找到每个群组的初始人数。我们可以只带来群组生命周期为0的行(群组只在此期间形成)，只提取注册日期和用户数量。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ln"><img src="../Images/2bb05f98c5a8e69514cdc09aa7a3da3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*91ySLZIjkLQAsD9Vh6yx7g.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">结果表</figcaption></figure><p id="0b06" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们需要将其与群组数据框架合并，以获得每个群组中初始客户的数量。然后，我们基本上可以从群组中的初始客户数量中找到每个时间段内的剩余用户百分比。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lo"><img src="../Images/40fa036c72848b4a9090f7456ddee49b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2P9qskAWeaTsmu3TOrXxw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx translated">每个群体在其一生中的保留率</figcaption></figure><p id="ccb0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们获得了这个漂亮的表格，最后一步是通过使用seaborn绘制一个图表来使它更有吸引力。我们将使用热图来显示数字是如何变化的(请不要忘记，将导入放在代码中间是一种不好的做法，请在分析的开始重新定位它们)。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lg lh l"/></div></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lp"><img src="../Images/b47f40d9c6829555da8ae6fbe9ee02d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_93noyrlNbsED6PnLhahlA.png"/></div></div></figure><p id="f246" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这张图表显示了什么？我们可以看到在特定的一周内注册的初始客户中有多少比例一直持续到某个群组的生命周期。例如，我们可以看到，在第31周注册后的一个月内(群组生存期= 4)，在第31周注册的人中，只有15.04%的人继续是该应用的活跃用户。</p><h1 id="c002" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">结论</h1><p id="3adf" class="pw-post-body-paragraph jn jo hh jp b jq lb ii js jt lc il jv jw ld jy jz ka le kc kd ke lf kg kh ki ha bi translated">从本文中可以看出，用Python进行群组分析相对容易。此外，您可以对流程进行大量定制。您可以选择您的指标来查看或识别不同时间段的群组。我鼓励你在你的公司尝试群组分析，看看其他客户群的模式。</p><h1 id="ac4f" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">感谢阅读！</h1><p id="b21e" class="pw-post-body-paragraph jn jo hh jp b jq lb ii js jt lc il jv jw ld jy jz ka le kc kd ke lf kg kh ki ha bi translated">如果你有任何问题，请在评论中提问！我非常乐意分享我的知识。</p></div></div>    
</body>
</html>