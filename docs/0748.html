<html>
<head>
<title>Track ML Experiment using MLflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MLflow跟踪ML实验</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/track-ml-experiment-using-mlflow-64851381d629?source=collection_archive---------11-----------------------#2021-01-29">https://medium.com/analytics-vidhya/track-ml-experiment-using-mlflow-64851381d629?source=collection_archive---------11-----------------------#2021-01-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/74aea7d9b0b2e23a726b9bade293fc4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nbbva1BS8IAmBkNz28JpCQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">罗宾·格劳泽在<a class="ae iu" href="https://unsplash.com/s/photos/electronic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="bc0f" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">问题</strong></h1><blockquote class="jt ju jv"><p id="d700" class="jw jx jy jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku hb bi translated">在数据科学竞赛的背景下寻找高性能的机器学习模型可能会很糟糕。</p></blockquote><p id="e680" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">获取知识的一种方式是应用它，我相信<a class="ae iu" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>是应用&amp;提升你的建模技能的最佳场所之一。</p><p id="be44" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">典型的Kaggle比赛设置</strong></p><p id="6bc4" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">在Kaggle中，典型的监督学习竞赛设置是参与者被给予:</p><ol class=""><li id="155f" class="ky kz hi jz b ka kb ke kf kv la kw lb kx lc ku ld le lf lg bi translated">两个独立的数据集，即训练集和测试集，</li><li id="73c4" class="ky kz hi jz b ka lh ke li kv lj kw lk kx ll ku ld le lf lg bi translated">一个单一的评估标准，然后用于对模型性能进行分级，</li><li id="a4a8" class="ky kz hi jz b ka lh ke li kv lj kw lk kx ll ku ld le lf lg bi translated">两个独立的排行榜，即公共和私人排行榜。测试集的一部分用于计算公共排行榜，其余部分用于计算私有排行榜。私人排行榜在比赛结束前是保密的，它将决定最终排名。</li></ol><p id="c4c8" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">很多可能的实验想法</strong></p><p id="7697" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">在数据科学竞赛的情况下，你可能会从一个简单的模型开始，然后随着你对问题有了更好的理解，你可能会想要建立更复杂的模型。在增加复杂性的过程中，你可能会迷失方向，不知道哪些想法比其他的更好。为什么会这样呢？因为<strong class="jz hj">有很多组件</strong>我们可以<strong class="jz hj">用</strong>进行试验，例如不同的学习算法，每个学习算法的独特和不同的超参数，更不用说我们可以应用于数据的预处理技术了！更重要的是，你可能还想尝试构建合奏和/或堆叠不同的模型，以获得排行榜上的最高排名！</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/c4d49445bd1ac18276df6ca7b9d470e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-spyeRVcbA6jCbveO_u5Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">可以试验的组件很少</figcaption></figure><p id="9687" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">在本文中，我们将看到如何在ML实验工作流中注入跟踪工具。</p><h1 id="66f4" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">ML实验</h1><p id="7843" class="pw-post-body-paragraph jw jx hi jz b ka lr kc kd ke ls kg kh kv lt kk kl kw lu ko kp kx lv ks kt ku hb bi translated">为了在所有的实验中有标准化的性能指标，更容易的是把这个过程设计成一个独立的构件，如下图所示。它使您能够将重点放在管道中的几个组件上。您可能首先关注预处理和特征工程，然后继续在相同的预处理数据中应用不同的算法，等等。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/c5d782a0146c55d609b402069d551682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHHbllfjPBOdYIG6DcsnmA.png"/></div></div></figure><p id="f799" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">瞄准高排行榜分数意味着，首先，你需要了解你的模型是否遭受<strong class="jz hj">过拟合</strong>和<strong class="jz hj">欠拟合</strong>，然后应用不同的技术来解决它。</p><p id="87cb" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">如果模型过度拟合，您可以对模型应用正则化、减少/移除特征、实现提前停止或构建集合模型。</p><p id="657b" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">如果模型存在拟合不足的问题，您可以添加更多相关的特征和训练数据，如果可能的话，增加模型的复杂性，或者移除数据中的噪声。</p><h1 id="1354" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak"> MLflow </strong></h1><p id="9e31" class="pw-post-body-paragraph jw jx hi jz b ka lr kc kd ke ls kg kh kv lt kk kl kw lu ko kp kx lv ks kt ku hb bi translated"><strong class="jz hj"> MLflow </strong>是机器学习生命周期*的开源平台，引自其网站。MLflow提供了一系列功能，包括实验、再现性、部署和中央模型注册。如下所示，有4个物流组件，我们将只关注物流跟踪。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/fc4f353b4e2086883564611d3e853613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xoZYvE87yj9bET_57_IceA.png"/></div></div></figure><p id="e91d" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">物流跟踪</strong></p><p id="9913" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">有3个主要功能</p><ul class=""><li id="b96a" class="ky kz hi jz b ka kb ke kf kv la kw lb kx lc ku ly le lf lg bi translated"><strong class="jz hj"> log_param : </strong>用于跟踪您更改了哪些组件</li><li id="fdba" class="ky kz hi jz b ka lh ke li kv lj kw lk kx ll ku ly le lf lg bi translated"><strong class="jz hj"> log_metric : </strong>用于跟踪评估/绩效指标</li><li id="1cab" class="ky kz hi jz b ka lh ke li kv lj kw lk kx ll ku ly le lf lg bi translated"><strong class="jz hj"> log_artifact : </strong>用于跟踪图像，以帮助您评估模型，甚至为以后构建集成/堆叠模型进行出叠预测</li></ul><h1 id="4927" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">案例:求解MNIST数据集</strong></h1><p id="f5a9" class="pw-post-body-paragraph jw jx hi jz b ka lr kc kd ke ls kg kh kv lt kk kl kw lu ko kp kx lv ks kt ku hb bi translated">本实验的目的是展示如何在用几种算法接近著名的<a class="ae iu" href="http://yann.lecun.com/exdb/mnist/" rel="noopener ugc nofollow" target="_blank"> MNIST数据集</a>时注入实验跟踪。<br/>为简单起见，我们将为每个算法使用默认超参数，因此我们将只更改1个参数，即“模型”。由于评估和跟踪过程将对每个算法重复进行，如果我们将其实现为函数，将会更清晰。</p><p id="684d" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">库</strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="9dc3" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">评估功能</strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="5fe7" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">跟踪功能</strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="f109" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">预处理&amp;验证策略</strong></p><p id="1d4d" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">在将训练数据集输入不同的算法之前，我们需要执行预处理，将值从0–255归一化到0–1，这样可以加快逻辑回归、MLP和CNN的收敛时间。</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b146" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">实验前</strong></p><p id="d13a" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">我们需要在实验之前定义实验id</p><pre class="ln lo lp lq fd mb mc md me aw mf bi"><span id="035d" class="mg iw hi mc b fi mh mi l mj mk"><em class="jy"># create experiment id for tracking using mlflow</em><br/>exp_id = mlflow.create_experiment("solving-mnist1")</span></pre><p id="b1ff" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">拟合和预测功能</strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="ee31" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">模型1:逻辑回归— Sklearn </strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="925b" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">模型二:随机森林— Sklearn </strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="b72b" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">模型3:多层感知器— Keras </strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="de18" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj">模型4:卷积神经网络— Keras </strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="e57b" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated"><strong class="jz hj"> MLflow仪表盘</strong></p><p id="96e9" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">我们现在可以在MLflow UI中比较几个实验。这比在电子表格甚至笔记中记录实验更加简洁和容易。</p><pre class="ln lo lp lq fd mb mc md me aw mf bi"><span id="eae1" class="mg iw hi mc b fi mh mi l mj mk"># run mlflow ui<br/>!mlflow ui</span></pre><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/411e15b0e74ef58f33506c265bd6dbf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPTjrv-5JHU-NXv_o9kzGg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">比较不同模型的准确性</figcaption></figure></div><div class="ab cl mm mn gp mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hb hc hd he hf"><h1 id="f42e" class="iv iw hi bd ix iy mt ja jb jc mu je jf jg mv ji jj jk mw jm jn jo mx jq jr js bi translated">结论</h1><p id="c43e" class="pw-post-body-paragraph jw jx hi jz b ka lr kc kd ke ls kg kh kv lt kk kl kw lu ko kp kx lv ks kt ku hb bi translated">MLflow有助于我们减少ML实验跟踪中的混乱，并且易于融入典型的工作流程。在我的<a class="ae iu" href="https://github.com/ajisamudra/ml-experiments-using-mlflow" rel="noopener ugc nofollow" target="_blank"> github </a>中有完整的笔记本。</p><p id="b5a1" class="pw-post-body-paragraph jw jx hi jz b ka kb kc kd ke kf kg kh kv kj kk kl kw kn ko kp kx kr ks kt ku hb bi translated">有一个很好的跟踪工具，你也可以试试！<a class="ae iu" href="https://wandb.ai/site" rel="noopener ugc nofollow" target="_blank">砝码&amp;偏差</a>。</p></div></div>    
</body>
</html>