<html>
<head>
<title>How to check for assumptions in a Linear Regression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检查线性回归中的假设</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-check-for-assumptions-in-a-linear-regression-a68116aef88a?source=collection_archive---------1-----------------------#2021-04-07">https://medium.com/analytics-vidhya/how-to-check-for-assumptions-in-a-linear-regression-a68116aef88a?source=collection_archive---------1-----------------------#2021-04-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="29df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始检查假设之前，让我们先理解为什么我们需要在拟合模型之前检查假设。</p><p id="116b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们为什么要这样做？你不需要有最佳拟合线的假设。但是你的参数可能有偏差或者有很高的方差。违反假设将使回归结果的解释更加困难。此外，该模型做出的预测将是非常低效的。既然我们理解了需要，让我们看看如何做。</p><p id="264f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将使用50家初创企业的数据集来检验这些假设。你可以用尽可能多的变量来做这个实验。</p><h1 id="fe52" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak"> 1。自变量和因变量之间的线性</strong></h1><p id="7a13" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">期望值或预测值是每个独立变量的直线函数。</p><p id="1f0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用散点图可以很容易地检查线性</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="60f5" class="kp je hi kl b fi kq kr l ks kt"># Importing the libraries<br/>import numpy as np<br/>import pandas as pd<br/>from numpy import math<br/>import matplotlib.pyplot as plt</span><span id="8a1d" class="kp je hi kl b fi ku kr l ks kt">#Marketing spend and Profit<br/>plt.scatter(dataset['Marketing Spend'], dataset['Profit'], alpha=0.5)<br/>plt.title('Scatter plot of Profit with Marketing Spend')<br/>plt.xlabel('Marketing Spend')<br/>plt.ylabel('Profit')<br/>plt.show()</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es kv"><img src="../Images/e796882a55048fb98fdf174360404a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*pQZpubIPHWYAe65Q-IhcLw.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">从图表中可以看出，除了少数例外情况，利润和营销支出之间基本上是直接相关的。</figcaption></figure><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="c80b" class="kp je hi kl b fi kq kr l ks kt">#R&amp;D Spend with Profit<br/>plt.scatter(dataset['R&amp;D Spend'], dataset['Profit'], alpha=0.5)<br/>plt.title('Scatter plot of Profit with R&amp;D Spend')<br/>plt.xlabel('R&amp;D Spend')<br/>plt.ylabel('Profit')<br/>plt.show()</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es ld"><img src="../Images/3123413c4660eff7127df709263ff163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*H3QY7vYsa3CJqkSKntltSg.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">R&amp;D支出和利润之间的关系完全是线性的。他们几乎完美地结合在一起。</figcaption></figure><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="054c" class="kp je hi kl b fi kq kr l ks kt">#Administration with Profit<br/>plt.scatter(dataset['Administration'], dataset['Profit'], alpha=0.5)<br/>plt.title('Scatter plot of Profit with Administration')<br/>plt.xlabel('Administration')<br/>plt.ylabel('Profit')<br/>plt.show()</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/242a35a80c651b6f0f7bd585a3626a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lSTVhOYCKKDyPrJgk35XIw.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">利润和管理之间几乎没有关系</figcaption></figure><p id="d852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，从商业角度来看，我们可以从下面的图表中推断出什么呢？</p><p id="d0b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">R&amp;D的花费将直接几乎完美地影响利润。增加R&amp;D支出将导致更高的利润。营销支出和利润之间有很好的关系。管理层变动对利润率没有直接影响。</p><h1 id="4a2d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.回归模型是同质的</h1><p id="7800" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">同方差意味着误差不会在自变量的所有值上改变。</p><p id="cea2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以借助<strong class="ih hj"> <em class="lj">的白色测试轻松检查这一点。</em> </strong></p><p id="f56f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在Python的Statsmodels libaray中找到。白色测试给了我们一个直接的答案，而不必绘制图表。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="69aa" class="kp je hi kl b fi kq kr l ks kt">#Importing Libraries<br/>import statsmodels.api as sm<br/>from statsmodels.stats.diagnostic import het_white<br/>from statsmodels.compat import lzip</span><span id="dc47" class="kp je hi kl b fi ku kr l ks kt">#The variables<br/>x=dataset[['R&amp;D Spend','Marketing Spend','Administration']].values<br/>y=dataset['Profit'].values</span><span id="fecc" class="kp je hi kl b fi ku kr l ks kt">#Fit the model<br/>model = sm.OLS(y,x).fit()</span></pre><p id="7186" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">白色测试是通过传递残差和所有独立变量来完成的。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5993" class="kp je hi kl b fi kq kr l ks kt">#The test<br/>white_test = het_white(model.resid,  model.model.exog)</span><span id="3456" class="kp je hi kl b fi ku kr l ks kt">#Zipping the array with labels<br/>names = ['Lagrange multiplier statistic', 'p-value','f-value', 'f p-value']<br/>lzip(names,white_test)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es lk"><img src="../Images/618017087e3c4df58b766564db681e49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*YTAJf8je4X6GD4mFbKNI1g.png"/></div></figure><p id="ab4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">怀特检验有零假设，即误差具有相同的方差或相同的方差。p值≤ 0.05表明零假设被拒绝，因此异方差。</p><p id="b2ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">白色测试有一些限制:它需要很多变量，因此非常耗时，所以对大型数据集使用白色测试不太实际，使用<strong class="ih hj"> Breusch-Pagan测试会更容易。</strong></p><p id="dc55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">有异方差怎么办？</strong></p><ol class=""><li id="650a" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">离群点去除</li><li id="f2b0" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">x变量的对数变换</li><li id="b6ba" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">多项式回归</li></ol><h1 id="8c7b" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">3.无多重共线性</h1><p id="937d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当独立变量相互关联时，会出现多重共线性。如果多重共线性的程度很高，则可能会在解释结果时造成问题。</p><p id="6b9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用热图可以很容易做到这一点</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="d248" class="kp je hi kl b fi kq kr l ks kt">#Import Seaborn<br/>import seaborn as sns<br/>plt.figure(figsize=(10,5))<br/>sns.heatmap(dataset[['R&amp;D Spend','Marketing Spend','Administration']].corr(),vmin=-1,annot= True)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es lz"><img src="../Images/1fc2002ca50751572d7dd70b1687d45c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9dwAVgM38Mh6TjS1xFAsHQ.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">独立变量的热图</figcaption></figure><p id="9293" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从热图中我们已经可以看出，R&amp;D支出和营销支出之间存在显著的相关性。</p><p id="e830" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以借助于变动通货膨胀系数(VIF)来确定相关程度</p><p id="bdd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它可以解释为:</p><p id="060c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1=不相关</p><p id="b80f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1–5 =中度相关</p><p id="9a55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">&gt; 5 =高度相关</p><p id="acaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看如何去做</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5429" class="kp je hi kl b fi kq kr l ks kt">from statsmodels.stats.outliers_influence import variance_inflation_factor</span><span id="7401" class="kp je hi kl b fi ku kr l ks kt"># For each X, calculate VIF and save in dataframe</span><span id="d72b" class="kp je hi kl b fi ku kr l ks kt">vif = pd.DataFrame()</span><span id="797b" class="kp je hi kl b fi ku kr l ks kt">vif["VIF Factor"] = [variance_inflation_factor(dataset[['R&amp;D Spend','Marketing Spend','Administration']].values, i) for i in range(x.shape[1])]</span><span id="e0c7" class="kp je hi kl b fi ku kr l ks kt">vif["features"] = dataset[['R&amp;D Spend','Marketing Spend','Administration']].columns</span><span id="280b" class="kp je hi kl b fi ku kr l ks kt">vif.round(1)</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es ma"><img src="../Images/14e297ab82a849073d74279bbca6a2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*NMgsvNYsBdn58DVdD3d87A.png"/></div></figure><p id="ddce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如已经怀疑的那样，变量之间存在相关性。</p><p id="2db3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么我们如何处理多重共线性呢？</p><p id="a886" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据数据集及其要求，我们可以通过以下方式实现:</p><ol class=""><li id="771b" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">去掉一些高度相关的变量</li><li id="38d1" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">对高度相关的变量进行主成分分析</li><li id="39e9" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">将它们线性相加</li></ol><h1 id="057f" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">4.误差呈正态分布</h1><p id="8125" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">为什么要检查这个？因为它会在计算置信区间时产生问题。偏度可能是由于异常值的存在，这可能在参数估计时产生偏差。</p><p id="9659" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最有效的方法是Q-Q概率图。分位数-分位数是通过绘制残差对统计量的顺序而得到的。这可以通过以下方式实现:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="16bf" class="kp je hi kl b fi kq kr l ks kt">#Import library</span><span id="6361" class="kp je hi kl b fi ku kr l ks kt">from scipy import stats</span><span id="3b9b" class="kp je hi kl b fi ku kr l ks kt">stats.probplot(model.resid, dist="norm", plot= plt)</span><span id="5786" class="kp je hi kl b fi ku kr l ks kt">plt.title("MODEL Residuals Q-Q Plot")</span><span id="6b97" class="kp je hi kl b fi ku kr l ks kt">plt.legend(['Actual,'Theoretical'])</span></pre><figure class="kg kh ki kj fd kw er es paragraph-image"><div class="er es mb"><img src="../Images/4905c513a2b1c46d0d3fceff67a8a260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*eiWRHZvXEJAeOOL8sge77A.png"/></div></figure></div></div>    
</body>
</html>