<html>
<head>
<title>How to build an API docs site using Slate And deploy in Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Slate构建API docs站点并在Heroku中部署</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-build-an-api-docs-site-using-slate-and-deploy-in-heroku-783640461330?source=collection_archive---------11-----------------------#2021-02-24">https://medium.com/analytics-vidhya/how-to-build-an-api-docs-site-using-slate-and-deploy-in-heroku-783640461330?source=collection_archive---------11-----------------------#2021-02-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/3c451b3979750553f200b33171afdc36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JX76Mu782sRxtCzehyXFew.png"/></div></figure><h1 id="47c1" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">石板？那是什么？？？</h1><p id="0edb" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">Slate是一个基于Ruby的工具，它从一组markdown文件中生成一个漂亮的三面板API文档静态站点。它是由开发人员罗伯特·洛德在2013年建造的，当时他18岁，在旅游软件公司Tripit实习。</p><h1 id="ef52" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">使用本机构建您的站点</h1><h1 id="3bd3" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">依赖关系:</h1><p id="0360" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">至少，您需要以下内容:</p><ul class=""><li id="1608" class="kh ki hh jl b jm kj jq kk ju kl jy km kc kn kg ko kp kq kr bi translated"><a class="ae ks" href="https://www.ruby-lang.org/en/" rel="noopener ugc nofollow" target="_blank">红宝石</a> &gt; = 2.5</li><li id="5938" class="kh ki hh jl b jm kt jq ku ju kv jy kw kc kx kg ko kp kq kr bi translated"><a class="ae ks" href="https://bundler.io/" rel="noopener ugc nofollow" target="_blank">捆扎机</a></li><li id="b7e8" class="kh ki hh jl b jm kt jq ku ju kv jy kw kc kx kg ko kp kq kr bi translated"><a class="ae ks" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点JS </a></li></ul><p id="84b6" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">请注意，目前官方只支持Linux和macOS。虽然slate应该可以在Windows上运行，但它不受支持。</p><p id="64c9" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">不同操作系统/发行版的安装说明见下文。</p><h1 id="8236" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">在Linux上安装依赖项</h1><p id="7439" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">安装Ruby、NodeJS和用于编译原生ruby gems的工具:</p><p id="9568" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">在Ubuntu 18.04+上</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="9748" class="lk im hh lg b fi ll lm l ln lo">sudo apt install ruby ruby-dev build-essential libffi-dev zlib1g-dev liblzma-dev nodejs patch</span></pre><p id="ee03" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">在Fedora 31+上</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="9000" class="lk im hh lg b fi ll lm l ln lo">sudo dnf install @development-tools redhat-rpm-config ruby ruby-devel libffi-devel zlib-devel xz-devel patch</span></pre><p id="e527" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">然后，更新RubyGems并安装bundler:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="03ac" class="lk im hh lg b fi ll lm l ln lo">sudo gem update --system<br/>sudo gem install bundler</span></pre><h1 id="43bf" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">在macOS上安装依赖项</h1><p id="af48" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">首先，安装<a class="ae ks" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">家酿</a>，然后安装xcode命令行工具:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="8a56" class="lk im hh lg b fi ll lm l ln lo">xcode-select --install</span></pre><p id="adb1" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">同意Xcode许可协议:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="374e" class="lk im hh lg b fi ll lm l ln lo">sudo xcodebuild -license</span></pre><p id="fc78" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">安装节点运行时:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="fd4a" class="lk im hh lg b fi ll lm l ln lo">brew install node</span></pre><p id="60a1" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">更新RubyGems并安装bundler:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="7e0d" class="lk im hh lg b fi ll lm l ln lo">gem update --system<br/>gem install bundler</span></pre><h1 id="14c4" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">正在设置</h1><ol class=""><li id="670c" class="kh ki hh jl b jm jn jq jr ju lp jy lq kc lr kg ls kp kq kr bi translated">在Github上分叉这个库。</li><li id="4a8e" class="kh ki hh jl b jm kt jq ku ju kv jy kw kc kx kg ls kp kq kr bi translated">用<code class="du lu lv lw lg b">git clone <a class="ae ks" href="https://github.com/YOURUSERNAME/slate.git" rel="noopener ugc nofollow" target="_blank">https://github.com/YOURUSERNAME/slate.git</a></code>将<em class="lt">你的分叉库</em>(不是我们原来的)克隆到你的硬盘上</li><li id="fd9a" class="kh ki hh jl b jm kt jq ku ju kv jy kw kc kx kg ls kp kq kr bi translated"><code class="du lu lv lw lg b">cd slate</code></li><li id="bbfd" class="kh ki hh jl b jm kt jq ku ju kv jy kw kc kx kg ls kp kq kr bi translated">为石板安装红宝石宝石:</li></ol><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="2a1c" class="lk im hh lg b fi ll lm l ln lo"># either run this to run locally<br/>bundle install</span></pre><p id="9888" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">注:如果以上安装nokogiri和使用macOS失败，请参见<a class="ae ks" href="https://github.com/sparklemotion/nokogiri.org/blob/master/docs/tutorials/installing_nokogiri.md#macos" rel="noopener ugc nofollow" target="_blank">这里的</a>获得一些有用的提示。</p><h1 id="c49b" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">跑步记录</h1><p id="3697" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">您可以通过两种方式运行slate，要么作为开发的服务器进程，要么只是构建html文件。</p><p id="fb26" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">要执行第一个选项，请运行:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="734f" class="lk im hh lg b fi ll lm l ln lo">bundle exec middleman server</span></pre><p id="2461" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">你应该可以在http://localhost:4567 看到你的文档。哇哦。太快了！</p><p id="6fb0" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">第二个选项(构建html文件)，运行:</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="3c34" class="lk im hh lg b fi ll lm l ln lo">bundle exec middleman build</span></pre><p id="673e" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">就这样，你完成了。</p><p id="c0b5" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated"><strong class="jl hi">让我们部署到heroku: </strong></p><blockquote class="lx ly lz"><p id="b572" class="jj jk lt jl b jm kj jo jp jq kk js jt ma ky jw jx mb kz ka kb mc la ke kf kg ha bi translated"><em class="hh">中间人是一个静态网站生成器，使用现代网络开发中的所有快捷方式和工具</em></p></blockquote><h1 id="357d" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">为heroku建立网站:</h1><p id="b488" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">中间人是一个<strong class="jl hi">静态</strong>站点生成器，因此，我们需要在部署时弄清楚如何构建站点。这样就不必在部署之前构建站点并提交结果。</p><p id="b98a" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">Heroku将自动尝试执行一个名为<code class="du lu lv lw lg b">assets:precompile</code>的耙子任务。</p><p id="1736" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">这原本是为了Rails的利益，但我们现在可以利用这一点来满足自己的需求。</p><p id="de2d" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">我创建了一个新的<code class="du lu lv lw lg b">Rakefile</code>并添加了以下内容。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="8973" class="lk im hh lg b fi ll lm l ln lo">namespace :assets <strong class="lg hi">do</strong><br/>  task :precompile <strong class="lg hi">do</strong><br/>    sh 'middleman build'<br/>  <strong class="lg hi">end</strong><br/><strong class="lg hi">end</strong></span></pre><p id="31c9" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">当站点被推送到Heroku时，这个任务只需调用自动构建站点的<code class="du lu lv lw lg b">middleman build</code>。中间人将所有文件输出到<code class="du lu lv lw lg b">./build</code>。</p><h1 id="ecd7" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">为网站服务:</h1><p id="1e9d" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">一旦你理解了基础知识，在Heroku上服务一个静态中间人站点的过程是非常简单的。该网站将作为一个机架应用程序运行，所以我们需要一个<code class="du lu lv lw lg b">config.ru</code>文件。这是我的样子。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="4577" class="lk im hh lg b fi ll lm l ln lo">require 'rack'<br/>require 'rack/contrib/try_static'</span><span id="e55d" class="lk im hh lg b fi md lm l ln lo"><em class="lt"># Serve files from the build directory</em><br/>use Rack<strong class="lg hi">::</strong>TryStatic,<br/>  root: 'build',<br/>  urls: %w[/],<br/>  try: ['.html', 'index.html', '/index.html']</span><span id="6429" class="lk im hh lg b fi md lm l ln lo">run lambda{ <strong class="lg hi">|</strong>env<strong class="lg hi">|</strong><br/>  four_oh_four_page <strong class="lg hi">=</strong> File.<strong class="lg hi">expand_path</strong>("../build/404/index.html", <strong class="lg hi">__FILE__</strong>)<br/>  [ 404, { 'Content-Type'  <strong class="lg hi">=&gt;</strong> 'text/html'}, [ File.<strong class="lg hi">read</strong>(four_oh_four_page) ]]<br/>}</span></pre><p id="0821" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated"><code class="du lu lv lw lg b">Rack::TryStatic</code>部分是当站点被推送到Heroku时，我们如何提供中间人构建的静态文件。中间人将所有文件输出到<code class="du lu lv lw lg b">./build</code>。</p><p id="e878" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">如果<code class="du lu lv lw lg b">Rack::Trystatic</code>应用程序没有提供页面，则使用下一个<code class="du lu lv lw lg b">run</code>部分提供404页面。</p><p id="c8fc" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">确保将<code class="du lu lv lw lg b">rack-contrib</code>添加到您的<code class="du lu lv lw lg b">Gemfile.</code>中</p><p id="3f24" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">我决定使用<a class="ae ks" href="http://puma.io/" rel="noopener ugc nofollow" target="_blank"> Puma </a>网络服务器来执行<em class="lt">实际的</em>文件网络服务，因为我以前从未使用过它，并且想尝试一下。我将Puma添加到我的<code class="du lu lv lw lg b">Gemfile</code>中，并创建了这个<code class="du lu lv lw lg b">Procfile</code>。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="579a" class="lk im hh lg b fi ll lm l ln lo">web: bundle exec puma <strong class="lg hi">-</strong>p $PORT</span></pre><p id="7fb7" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">彪马表现很好。</p><p id="30e3" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">就这么简单。一旦被推到Heroku，一切都正常了</p><h1 id="82d3" class="il im hh bd in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji bi translated">保持网站活力:</h1><p id="2241" class="pw-post-body-paragraph jj jk hh jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated">我用一个免费的Dyno服务这个网站，速度非常快。诚然，这个网站没有收到大量的流量，但它仍然非常快。</p><p id="3398" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">单个Heroku Dyno的唯一缺点是，它会在一段时间不活动后闲置，这种情况经常发生，除非你有大量的常规流量。</p><p id="93a1" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">我为了保持网站的活力，网站需要定期请求。</p><p id="9508" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">为此我使用了<a class="ae ks" href="http://www.pingdom.com/" rel="noopener ugc nofollow" target="_blank"> Pingdom </a>。</p><p id="8658" class="pw-post-body-paragraph jj jk hh jl b jm kj jo jp jq kk js jt ju ky jw jx jy kz ka kb kc la ke kf kg ha bi translated">谢谢…编码快乐。</p></div></div>    
</body>
</html>