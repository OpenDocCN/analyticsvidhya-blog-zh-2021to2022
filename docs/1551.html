<html>
<head>
<title>Learn Flink SQL — The Easy Way (based on Zeppelin 0.10)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习Flink SQL —简单的方法(基于Zeppelin 0.10)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/learn-flink-sql-the-easy-way-d9d48a95ae57?source=collection_archive---------15-----------------------#2021-03-07">https://medium.com/analytics-vidhya/learn-flink-sql-the-easy-way-d9d48a95ae57?source=collection_archive---------15-----------------------#2021-03-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="47af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Flink几乎是当今事实上的标准流媒体引擎。Flink SQL是使用Flink的推荐方法。但是流式sql不同于传统的批处理sql，你必须学习许多新概念，如水印、事件时间、不同类型的流式连接等等。老实说，所有这些都不容易学。</p><p id="5263" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天我要给大家介绍一个新的(简单的)学习flink sql的方法:<strong class="ig hi">Zeppelin上的Flink Sql Cookbook。</strong>在Zeppelin中，您可以以如下交互方式运行Flink SQL:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/9d190b049baf28e8bb9059c35d5b98f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Y6tOfBnm4N8utNzS2IN_wg.gif"/></div></div></figure><h2 id="c644" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated"><strong class="ak">本帖中的所有例子都可以在这里找到。</strong></h2><p id="f8e9" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated"><a class="ae ko" href="http://zeppelin-notebook.com/" rel="noopener ugc nofollow" target="_blank">http://zeppelin-notebook.com/</a>(<a class="ae ko" href="http://23.254.161.240/#/" rel="noopener ugc nofollow" target="_blank">http://23.254.161.240/#/</a>)</p><h1 id="758d" class="kp jp hh bd jq kq kr ks ju kt ku kv jy kw kx ky kb kz la lb ke lc ld le kh lf bi translated">准备环境</h1><h2 id="0689" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">第一步</h2><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="53e1" class="jo jp hh lh b fi ll lm l ln lo">git clone <a class="ae ko" href="https://github.com/zjffdu/flink-sql-cookbook-on-zeppelin.git" rel="noopener ugc nofollow" target="_blank">https://github.com/zjffdu/flink-sql-cookbook-on-zeppelin.git</a></span></pre><p id="231d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个repo拥有所有的zeppelin笔记本，其中包括了<a class="ae ko" href="https://github.com/ververica/flink-sql-cookbook/" rel="noopener ugc nofollow" target="_blank"> flink-sql-cookbook </a>中的例子。感谢ververica提供的优秀示例，我只是将它们移植到了Zeppelin。</p><h2 id="06ef" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">第二步</h2><p id="5f29" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">下载<a class="ae ko" href="https://flink.apache.org/downloads.html" rel="noopener ugc nofollow" target="_blank"> flink 1.13.1 </a>并解压。(没试过其他版本的flink)</p><h2 id="3ed8" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">第三步</h2><p id="9dfc" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">构建<a class="ae ko" href="https://github.com/knaufk/flink-faker/" rel="noopener ugc nofollow" target="_blank"> flink faker </a>并将flink-faker-0.3.0.jar复制到flink的lib文件夹中。这是一个自定义的flink表源，用于生成样本数据。</p><h2 id="0d49" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">第四步</h2><p id="e5a4" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">运行以下命令启动Zeppelin</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="b965" class="jo jp hh lh b fi ll lm l ln lo">docker run -u $(id -u) -p 8081:8081 -p 8080:8080 --rm -v $PWD/logs:/logs -v /mnt/disk1/jzhang/flink-sql-cookbook-on-zeppelin:/notebook -v /mnt/disk1/jzhang/flink-1.13.1:/opt/flink -e FLINK_HOME=/opt/flink -e ZEPPELIN_LOG_DIR='/logs' -e ZEPPELIN_NOTEBOOK_DIR='/notebook' --name zeppelin apache/zeppelin:0.10.0</span></pre><p id="129a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您需要用您的文件夹替换2个文件夹:</p><ul class=""><li id="503c" class="lp lq hh ig b ih ii il im ip lr it ls ix lt jb lu lv lw lx bi translated">/mnt/disk 1/jzhang/flink-SQL-cookbook-on-zeppelin(这是步骤1的repo文件夹)</li><li id="bdf5" class="lp lq hh ig b ih ly il lz ip ma it mb ix mc jb lu lv lw lx bi translated">/mnt/disk1/jzhang/flink-1.13.1(这是步骤2的flink文件夹)</li></ul><h1 id="e35f" class="kp jp hh bd jq kq kr ks ju kt ku kv jy kw kx ky kb kz la lb ke lc ld le kh lf bi translated">试试Flink Sql Cookbook的例子</h1><p id="91f8" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">现在，环境已经准备好了，您可以通过打开<a class="ae ko" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>开始您的Flink sql之旅</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es md"><img src="../Images/083ad57f3c3a60184af0a3361bcabde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7A4smZAY6fhETEF1DfG3Bw.png"/></div></div></figure><p id="a549" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是Zeppelin的主页，已经有一个名为<code class="du me mf mg lh b">Flink Sql Cookbook</code>的文件夹包含了所有的例子。</p><h1 id="924c" class="kp jp hh bd jq kq kr ks ju kt ku kv jy kw kx ky kb kz la lb ke lc ld le kh lf bi translated">示例1:过滤数据</h1><p id="af71" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">现在我们来看第一个例子:<strong class="ig hi"> <em class="mh">基础/04过滤数据</em> </strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mi"><img src="../Images/df863d0fd54e568434442f2aec1a2827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E1bqSmQAUDuF4Q0_8YpHLw.png"/></div></div></figure><p id="51d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里有两段:</p><ul class=""><li id="8a4e" class="lp lq hh ig b ih ii il im ip lr it ls ix lt jb lu lv lw lx bi translated">第1段是通过<code class="du me mf mg lh b">faker</code>连接器创建表server_logs。</li><li id="a0a0" class="lp lq hh ig b ih ly il lz ip ma it mb ix mc jb lu lv lw lx bi translated">第2段是通过where语句过滤数据，然后通过<code class="du me mf mg lh b">log_time</code>选择最近的10条记录</li></ul><p id="8b3d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是结果截图。可以看到结果每3秒刷新一次。这是Flink流sql相比传统批处理sql的最大区别。因为在流式世界中，新数据不断到来，所以你会看到结果不断更新。</p><p id="97f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除此之外，你可以点击右上角的<code class="du me mf mg lh b">FLINK_JOB</code>链接，它会带你到这个工作的链接界面。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mj"><img src="../Images/e6b48275bc8bd07659c81659ed25f943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gXzgqhcaJgj-TsV_xOiw0w.gif"/></div></div></figure><h1 id="edda" class="kp jp hh bd jq kq kr ks ju kt ku kv jy kw kx ky kb kz la lb ke lc ld le kh lf bi translated">示例2:横向表连接</h1><p id="1aa7" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">现在我们来看第二个例子:<strong class="ig hi"> <em class="mh">侧桌加入</em> </strong>。这是Flink sql支持的一种连接类型。通常新的初学者会对此感到有点害怕，即使他是通过一些教程文章学会的。如果有一个真实的例子可以告诉他这个横向表连接到底在做什么，我相信这对他理解它会很有帮助。幸运的是，我们在这本flink-sql-cookbook中有一个例子，您可以直接在Zeppelin中运行它。打开<code class="du me mf mg lh b">Joins/06 Lateral Table</code>，然后运行它你可以看到下面的截图。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mk"><img src="../Images/ba0ab759b3668e2562291075bb2744fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xYkL34J2M7dSXjUDESlD1A.gif"/></div></div></figure><p id="f1b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我只给你看上面的两个例子，在这本食谱中还有很多其他的例子。你可以自己试试。希望你会喜欢这本关于齐柏林飞艇的flink-sql-cookbook。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ml"><img src="../Images/508a3fa2928bb1538ec8fd57a0653147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mqxeon7neQcKnggAdtpowA.png"/></div></div></figure><p id="a138" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Zeppelin社区仍然试图改进和发展Zeppelin上Flink的整个用户体验，您可以加入Zeppelin slack与社区讨论。<a class="ae ko" href="http://zeppelin.apache.org/community.html#slack-channel" rel="noopener ugc nofollow" target="_blank">http://zeppelin.apache.org/community.html#slack-channel</a></p><p id="b874" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于《齐柏林飞船上的弗林克》的更多细节，请参考以下链接。</p><ul class=""><li id="1cb3" class="lp lq hh ig b ih ii il im ip lr it ls ix lt jb lu lv lw lx bi translated"><a class="ae ko" href="http://zeppelin-notebook.com/#/" rel="noopener ugc nofollow" target="_blank">http://zeppelin-notebook.com/#/</a></li><li id="6c7a" class="lp lq hh ig b ih ly il lz ip ma it mb ix mc jb lu lv lw lx bi translated"><a class="ae ko" href="https://zeppelin.apache.org/docs/0.10.0/interpreter/flink.html" rel="noopener ugc nofollow" target="_blank">http://zeppelin . Apache . org/docs/0 . 10 . 0/interpreter/flink . html</a></li><li id="58d4" class="lp lq hh ig b ih ly il lz ip ma it mb ix mc jb lu lv lw lx bi translated"><a class="ae ko" href="https://www.youtube.com/watch?v=YxPo0Fosjjg&amp;list=PL4oy12nnS7FFtg3KV1iS5vDb0pTz12VcX" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=YxPo0Fosjjg&amp;list = pl 4 oy 12 nns 7 fftg 3kv 1 is 5 vdb 0 ptz 12 vcx</a></li></ul></div></div>    
</body>
</html>