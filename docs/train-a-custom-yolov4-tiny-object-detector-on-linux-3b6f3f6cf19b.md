# åœ¨ Linux ä¸Šè®­ç»ƒä¸€ä¸ªå®šåˆ¶çš„ yolov 4-å¾®å°ç‰©ä½“æ¢æµ‹å™¨

> åŸæ–‡ï¼š<https://medium.com/analytics-vidhya/train-a-custom-yolov4-tiny-object-detector-on-linux-3b6f3f6cf19b?source=collection_archive---------0----------------------->

## (åˆå­¦è€…æ•™ç¨‹)

# æˆ‘åœ¨ YouTube ä¸Šçš„è§†é¢‘ï¼

# åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ YOLOv4-tiny å’Œ Darknet åœ¨æˆ‘ä»¬çš„ Linux(Ubuntu 18.04)ç³»ç»Ÿä¸Šè®­ç»ƒä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹å™¨è¿›è¡Œé®ç½©æ£€æµ‹

![](img/357b678499bc7a7b0da6d34d9eae2a9b.png)

# æŒ‰ç…§ä»¥ä¸‹ 10 ä¸ªæ­¥éª¤ï¼Œä½¿ç”¨ YOLOv4-tiny è®­ç»ƒä¸€ä¸ªç‰©ä½“æ£€æµ‹å™¨

(ä½†é¦–å…ˆâœ…Subscribe åˆ°æˆ‘çš„ YouTube é¢‘é“ğŸ‘‰ğŸ»[https://bit.ly/3Ap3sdi](https://bit.ly/3Ap3sdi)ğŸ˜ğŸ˜œ)

1.  [åœ¨æ¡Œé¢ä¸Šåˆ›å»º ***yolov4-tiny*** å’Œ ***è®­ç»ƒ*** æ–‡ä»¶å¤¹](#7f9e)
2.  [æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œå¯¼èˆªåˆ°â€œ **yolov4-tiny** â€æ–‡ä»¶å¤¹](#311c)
3.  [åˆ›å»ºå¹¶å¤åˆ¶**darknet.exe**æ–‡ä»¶](#82bc)
4.  [åˆ›å»º&å°†æˆ‘ä»¬è®­ç»ƒéœ€è¦çš„æ–‡ä»¶(å³ **obj** æ•°æ®é›†æ–‡ä»¶å¤¹ã€**yolov 4-tiny**custom . CFGã€ **obj.data** ã€ **obj.names** å’Œ **process.py** æ–‡ä»¶)å¤åˆ¶åˆ°ä½ çš„**yolov 4-tiny**dir](#2601)
5.  [å°† ***yolov4-tiny*** ç›®å½•ä¸‹çš„â€œ**yolov 4-custom . CFG**â€ã€â€œ **obj.data** â€ã€â€œ **obj.names** â€ã€â€œ **process.py** â€æ–‡ä»¶å’Œâ€œ **obj** â€æ•°æ®é›†æ–‡ä»¶å¤¹ä»***yolov 4-tiny***ç›®å½•ä¸‹å¤åˆ¶åˆ° ***darknet* ã€T**](#2885)
6.  [è¿è¡Œ **process.py** python è„šæœ¬åˆ›å»º**train . txt**&**test . txt**æ–‡ä»¶](#f48a)
7.  [ä¸‹è½½é¢„å…ˆè®­ç»ƒå¥½çš„ **YOLOv4-tiny** é‡é‡](#8496)
8.  [è®­ç»ƒæ¢æµ‹å™¨](#ab60)
9.  [æ£€æŸ¥æ€§èƒ½](#9377)
10.  [æµ‹è¯•æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹å™¨](#9055)

# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~å¼€å§‹å§ï¼ï¼~~~~~~~~~~~~~~

![](img/723e88f120c19dcfcb498591fca24ff9.png)

# 1)åˆ›å»ºâ€œyolov4-tinyâ€å’Œâ€œtrainingâ€æ–‡ä»¶å¤¹

åœ¨æ¡Œé¢ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º ***yolov4-tiny*** çš„æ–‡ä»¶å¤¹ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨***yolov 4-tiny***æ–‡ä»¶å¤¹å†…åˆ›å»ºå¦ä¸€ä¸ªåä¸º ***training*** *çš„æ–‡ä»¶å¤¹ã€‚è¿™æ˜¯æˆ‘ä»¬å°†ä¿å­˜è®­ç»ƒæƒé‡çš„åœ°æ–¹(è¯¥è·¯å¾„åœ¨æˆ‘ä»¬ç¨åå°†ä¸Šä¼ çš„ ***obj.data*** æ–‡ä»¶ä¸­æœ‰æåŠ)*

![](img/7acaa81d8c2ba5e8da44caf7b2992e99.png)

# 2)æ‰“å¼€ç»ˆç«¯å¹¶å¯¼èˆªåˆ°â€œyolov4-tinyâ€æ–‡ä»¶å¤¹

```
#Navigate to /Desktop/yolov4-tiny folder using the following command in terminal or just right-click and open it in terminal.cd Desktop/yolov4-tiny/
```

![](img/a8fffb921cdf97aad242c1c5f03fd95b.png)

# 3)åˆ›å»ºå¹¶å¤åˆ¶æš—ç½‘å¯æ‰§è¡Œæ–‡ä»¶

åˆ›å»ºåŒ…å« **darknet** å¯æ‰§è¡Œæ–‡ä»¶çš„ ***darknet*** æ–‡ä»¶å¤¹ï¼Œå¹¶å¤åˆ¶åˆ° ***yolov4-tiny*** æ–‡ä»¶å¤¹ä¸­ã€‚è¦äº†è§£å¦‚ä½•ä½¿ç”¨ make åˆ›å»ºåŒ…å« darknet å¯æ‰§è¡Œæ–‡ä»¶çš„ darknet æ–‡ä»¶å¤¹ï¼Œè¯·è®¿é—® [**æœ¬åšå®¢**](https://techzizou007.medium.com/yolov4-darknet-installation-and-usage-on-your-system-windows-linux-8dec2cea6e81) ã€‚æŒ‰ç…§æ‰€æœ‰çš„æ­¥éª¤åœ¨ Linux ä¸Šå®‰è£… YOLO-æš—ç½‘ã€‚

è¿™ä¸€æ­¥å¯èƒ½æœ‰ç‚¹ä¹å‘³ï¼Œä½†è¿™æ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ã€‚ä¸‹é¢å‰©ä¸‹çš„è®­ç»ƒè¿‡ç¨‹ç›¸å½“ç®€å•ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‚¨ä»”ç»†æŒ‰ç…§ä¸Šé¢æ–‡ç« ä¸­çš„æ‰€æœ‰æ­¥éª¤æ¥åˆ›å»º darknetï¼Œå¹¶åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£…å’Œé…ç½® CUDA å’Œ cuDNNã€‚ä½ ä¼šåœ¨ä¸Šé¢æåˆ°çš„åšå®¢çš„ C éƒ¨åˆ†æ‰¾åˆ°æ‰€æœ‰è¯¦ç»†è§£é‡Šçš„æ­¥éª¤ã€‚

ä»¥ä¸Šè¿‡ç¨‹å®Œæˆåï¼Œå°†æˆ‘ä»¬ä»ä¸­è·å–çš„ ***darknet*** æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ä½ æ¡Œé¢ä¸Šçš„ ***yolov4-tiny*** æ–‡ä»¶å¤¹ã€‚

![](img/269c854d6b6431ee25de6e238a5077fb.png)

# 4)åˆ›å»ºå¹¶å¤åˆ¶ä»¥ä¸‹æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦è¿™äº›æ–‡ä»¶æ¥è®­ç»ƒè‡ªå®šä¹‰æ£€æµ‹å™¨

```
**a. Labeled Custom Dataset
b. Custom cfg file
c. obj.data and obj.names files
d. process.py file (to create train.txt and test.txt files for training)**I have uploaded my custom files for mask detection on my [**GitHub**](https://github.com/techzizou/yolov4-tiny-custom-training_LOCAL)**.** I am working with 2 classes i.e. â€œwith_maskâ€ and â€œwithout_maskâ€.
```

# æ ‡æ³¨æ•°æ®é›†

è¾“å…¥å›¾åƒç¤ºä¾‹(**Image1.jpg**)

![](img/d5785ef51630c589be74a7537a1700cf.png)

ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•è½¯ä»¶æ¥è´´æ ‡ç­¾ï¼Œæ¯”å¦‚ [**æ ‡ç­¾**](https://github.com/tzutalin/labelImg#labelimg) å·¥å…·ã€‚

![](img/ac02193c335372205a0626900a2f8eb7.png)

æˆ‘ä½¿ç”¨ä¸€ä¸ªåä¸º **OpenLabeling** çš„å¼€æºæ ‡ç­¾å·¥å…·ï¼Œå®ƒæœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„ UIã€‚

![](img/10cfa449cde2379d0ecbb36b0818cbbb.png)

ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥ï¼Œäº†è§£æ›´å¤šå…³äºè´´æ ‡è¿‡ç¨‹å’Œå…¶ä»–è½¯ä»¶çš„ä¿¡æ¯:

[**å½±åƒæ•°æ®é›†æ ‡æ³¨æ¡**](/analytics-vidhya/image-dataset-labeling-annotation-bec3390eda2d)

**æ³¨:**åƒåœ¾å…¥=åƒåœ¾å‡ºã€‚é€‰æ‹©å’Œæ ‡è®°å›¾åƒæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å°½é‡æ‰¾è´¨é‡å¥½çš„å›¾ç‰‡ã€‚æ•°æ®çš„è´¨é‡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†ç»“æœçš„è´¨é‡ã€‚

æ ‡æœ‰ file çš„è¾“å‡º YOLO æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚

![](img/f15bf059b76c6edcb55184a446b211e1.png)

# 4(a)åˆ›å»ºå¸¦æ ‡ç­¾çš„è‡ªå®šä¹‰æ•°æ®é›†â€œobjâ€æ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°â€œyolov4-tinyâ€æ–‡ä»¶å¤¹

æŠŠæ‰€æœ‰è¾“å…¥çš„å›¾åƒâ€ã€‚jpg "æ–‡ä»¶åŠå…¶å¯¹åº”çš„ YOLO æ ¼å¼æ ‡æ³¨"ã€‚txt "æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åä¸º ***obj*** ã€‚å°†å…¶å¤åˆ¶åˆ° ***yolov4-tiny*** æ–‡ä»¶å¤¹ä¸­ã€‚

![](img/345cdceae147a9fdd897b53190376d02.png)

# 4(b)åˆ›å»ºè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°â€œyolov4-tinyâ€æ–‡ä»¶å¤¹ä¸­

ä» ***darknet/cfg*** ç›®å½•*ï¼Œ*ä¸‹è½½***yolov 4-tiny-custom . CFG***æ–‡ä»¶ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå¹¶å¤åˆ¶åˆ° ***yolov4-tiny*** ç›®å½•ã€‚

ä½ ä¹Ÿå¯ä»¥ä»å®˜æ–¹ [AlexeyAB Github](https://www.github.com/AlexeyAB/darknet) ä¸‹è½½å®šåˆ¶é…ç½®æ–‡ä»¶ã€‚

**æ‚¨éœ€è¦åœ¨æ‚¨çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä»¥ä¸‹æ›´æ”¹:**

![](img/369b9881f77ae542d6fd7172dc185ec7.png)

*   å°†è¡Œæ‰¹æ›´æ”¹ä¸ºæ‰¹=64
*   å°†çº¿ç»†åˆ†æ”¹ä¸ºç»†åˆ†=16 **æˆ–**ç»†åˆ†=32 **æˆ–**ç»†åˆ†=64(é˜…è¯»æœ¬èŠ‚åçš„æ³¨é‡Šä»¥äº†è§£å…³äºè¿™äº›å€¼çš„æ›´å¤šä¿¡æ¯)
*   è®¾ç½®ç½‘ç»œå¤§å°å®½åº¦=416 é«˜åº¦=416 æˆ– 32 çš„ä»»æ„å€æ•°
*   å°†è¡Œ max_batches æ›´æ”¹ä¸º(ç±»*2000ï¼Œä½†ä¸å°äºè®­ç»ƒå›¾åƒæ•°ï¼Œä¸”ä¸å°äº 6000)ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè®­ç»ƒ 3 ä¸ªç±»ï¼Œmax_batches=6000
*   å°†ç”Ÿäº§çº¿æ­¥éª¤æ›´æ”¹ä¸º max_batches çš„ 80%å’Œ 90%ï¼Œå³æ­¥éª¤=4800ï¼Œ5400

![](img/21d8f56c73f49efc664351162bd83579.png)

*   åœ¨æ¯ä¸ª[yolo]å±‚ä¹‹å‰ï¼Œå°† 2**[å·ç§¯]**ä¸­çš„[filters=255]æ›´æ”¹ä¸º filters=(classes + 5)x3ï¼Œè¯·è®°ä½ï¼Œå®ƒå¿…é¡»æ˜¯æ¯ä¸ª[yolo]å±‚ä¹‹å‰çš„æœ€åä¸€ä¸ª[å·ç§¯]ã€‚
*   åœ¨æ¯ä¸ª**2ã€yoloã€‘**å±‚ä¸­ï¼Œå°†çº¿æ¡ç±»åˆ«=80 æ”¹ä¸ºä½ çš„å¯¹è±¡æ•°é‡ã€‚

å› æ­¤ï¼Œå¦‚æœ classes=1ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯ filters=18ã€‚å¦‚æœ classes=2ï¼Œåˆ™ç¼–å†™ filters=21ã€‚

ä¸€æ—¦ä½ ç†è§£äº†è®­ç»ƒè¿‡ç¨‹çš„åŸºæœ¬åŸç†ï¼Œä½ ä¹Ÿå¯ä»¥è°ƒæ•´å…¶ä»–å‚æ•°å€¼ï¼Œå¦‚å­¦ä¹ ç‡ã€è§’åº¦ã€é¥±å’Œåº¦ã€æ›å…‰å’Œè‰²è°ƒã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œä»¥ä¸Šæ”¹åŠ¨åº”è¯¥è¶³å¤Ÿäº†ã€‚

## æ³¨æ„:ä»€ä¹ˆæ˜¯ç»†åˆ†ï¼Ÿ

*   è¿™æ˜¯æˆ‘ä»¬åˆ†æˆçš„è®¸å¤šå°æ‰¹é‡çš„æ•°é‡ã€‚
*   Batch=64 ->ä¸€æ¬¡è¿­ä»£åŠ è½½ 64 å¹…å›¾åƒã€‚
*   ç»†åˆ†=8 ->å°†æ‰¹æ¬¡åˆ†ä¸º 8 ä¸ªå°æ‰¹æ¬¡ï¼Œå› æ­¤æ¯ä¸ªå°æ‰¹æ¬¡æœ‰ 64/8 = 8 ä¸ªå›¾åƒï¼Œè¿™ 8 ä¸ªå›¾åƒè¢«å‘é€è¿›è¡Œå¤„ç†ã€‚è¯¥è¿‡ç¨‹å°†è¢«æ‰§è¡Œ 8 æ¬¡ï¼Œç›´åˆ°è¯¥æ‰¹å®Œæˆï¼Œå¹¶ä¸”æ–°çš„è¿­ä»£å°†ä» 64 ä¸ªæ–°å›¾åƒå¼€å§‹ã€‚
*   å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä½å†…å­˜çš„ GPUï¼Œè¯·ä¸ºç»†åˆ†è®¾ç½®ä¸€ä¸ªè¾ƒé«˜çš„å€¼(32 æˆ– 64)ã€‚è¿™æ˜¾ç„¶éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥è®­ç»ƒï¼Œå› ä¸ºæˆ‘ä»¬æ­£åœ¨å‡å°‘åŠ è½½çš„å›¾åƒæ•°é‡ä»¥åŠå°æ‰¹é‡çš„æ•°é‡ã€‚
*   å¦‚æœæ‚¨æœ‰ä¸€ä¸ªé«˜å†…å­˜çš„ GPUï¼Œè®¾ç½®ä¸€ä¸ªè¾ƒä½çš„ç»†åˆ†å€¼(16 æˆ– 8)ã€‚è¿™å°†åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹ï¼Œå› ä¸ºæ¯æ¬¡è¿­ä»£åŠ è½½æ›´å¤šçš„å›¾åƒã€‚

# 4(c)åˆ›å»ºä½ çš„â€œobj.dataâ€å’Œâ€œobj.namesâ€æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬å¤åˆ¶åˆ° yolov4-tiny æ–‡ä»¶å¤¹ä¸­

## å¯¹è±¡æ•°æ®

***obj.data*** æ–‡ä»¶æœ‰:

*   ç­çº§çš„æ•°é‡ã€‚
*   è·¯å¾„ä¸º" ***train.txt"*** å’Œ" ***test.txt"*** æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨åé¢åˆ›å»ºã€‚
*   è·¯å¾„ä¸º" ***obj.names"*** æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ç±»çš„åç§°ã€‚
*   ä¿å­˜è®­ç»ƒæƒé‡çš„ ***è®­ç»ƒ*** æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚

```
classes = 2
train = data/train.txt
valid = data/test.txt
names = data/obj.names
backup = ../training
```

## å¯¹è±¡åç§°

åŒ…å«å¯¹è±¡çš„åç§°ï¼Œæ¯ä¸ªåç§°å ä¸€è¡Œã€‚ç¡®ä¿åˆ†ç±»çš„é¡ºåºä¸æ ‡è®°å›¾åƒæ—¶ä½¿ç”¨çš„ class_list.txt æ–‡ä»¶ä¸­çš„é¡ºåºç›¸åŒï¼Œä»¥ä¾¿æ¯ä¸ªåˆ†ç±»çš„ç´¢å¼• id ä¸æ ‡è®°çš„ YOLO æ–‡æœ¬æ–‡ä»¶ä¸­æåˆ°çš„ç›¸åŒã€‚

![](img/161a152a42210c11d21d349f0b3d62ae.png)

# 4(d)å°†<process.py>è„šæœ¬æ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„ yolov4-tiny æ–‡ä»¶å¤¹</process.py>

(å°†æ‰€æœ‰å›¾åƒæ–‡ä»¶åˆ†æˆ 2 éƒ¨åˆ†ã€‚90%ç”¨äºè®­ç»ƒï¼Œ10%ç”¨äºæµ‹è¯•)

è¿™ä¸ª ***process.py*** è„šæœ¬åˆ›å»ºäº†æ–‡ä»¶***train . txt*&***test . txt***ï¼Œå…¶ä¸­ ***train.txt*** æ–‡ä»¶å…·æœ‰æŒ‡å‘ 90%å›¾åƒçš„è·¯å¾„ï¼Œè€Œ ***test.txt*** å…·æœ‰æŒ‡å‘ 10%å›¾åƒçš„è·¯å¾„ã€‚**

å¯ä»¥ä»æˆ‘çš„ [**GitHub**](https://github.com/techzizou/yolov4-tiny-custom-training_LOCAL) **ä¸‹è½½ ***process.py*** è„šæœ¬ã€‚**

*** *é‡è¦æç¤º:â€œ*process . pyâ€*è„šæœ¬åªæœ‰ã€‚jpg "æ ¼å¼å†™åœ¨é‡Œé¢ï¼Œæ‰€ä»¥å…¶ä»–æ ¼å¼å¦‚"ã€‚pngâ€œï¼Œâ€ã€‚jpegâ€ï¼Œç”šè‡³æ˜¯â€ã€‚JPGâ€(å¤§å†™)ä¸ä¼šè¢«æ‰¿è®¤ã€‚å¦‚æœæ‚¨ä½¿ç”¨ä»»ä½•å…¶ä»–æ ¼å¼ï¼Œè¯·ç›¸åº”åœ°åœ¨ *process.py* è„šæœ¬ä¸­è¿›è¡Œæ›´æ”¹ã€‚**

ç°åœ¨æˆ‘ä»¬å·²ç»ä¸Šä¼ äº†æ‰€æœ‰çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æ¡Œé¢ä¸Šçš„ ***yolov4-tiny*** æ–‡ä»¶å¤¹åº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/2cd0f615ebf51915b17ad5128b7cbfda.png)

# 5)å°†æ‰€æœ‰æ–‡ä»¶ä»'`yolov4-tiny'`ç›®å½•å¤åˆ¶åˆ°' yolov4-tiny/darknet 'ç›®å½•

ä½ å¯ä»¥é€šè¿‡æ–‡ä»¶ç®¡ç†å™¨æ‰‹åŠ¨å®Œæˆæ‰€æœ‰è¿™äº›æ­¥éª¤ã€‚

é¦–å…ˆï¼Œæ¸…ç†***CFG***&***data***æ–‡ä»¶å¤¹ã€‚åˆ é™¤ ***data*** æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œé™¤äº† ***labels*** æ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹æ˜¯åœ¨æ£€æµ‹æ¡†ä¸Šå†™å…¥æ ‡ç­¾åç§°æ‰€å¿…éœ€çš„ï¼ŒåŒæ—¶åˆ é™¤ ***cfg*** æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ ***yolov4-tiny*** ä¸»æ–‡ä»¶å¤¹ä¸­å·²ç»æœ‰äº†æˆ‘ä»¬çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚

æ¥ä¸‹æ¥ï¼Œå¤åˆ¶æ‰€æœ‰æ–‡ä»¶:

*   å°† **yolov4-tiny-custom.cfg** å¤åˆ¶åˆ° ***darknet/cfg*** ç›®å½•ä¸‹ã€‚
*   å°† **obj.names** ã€ **obj.data** å’Œ **obj** æ–‡ä»¶å¤¹å¤åˆ¶åˆ° ***darknet/data*** ç›®å½•ä¸‹ã€‚
*   å°† **process.py** å¤åˆ¶åˆ° ***darknet*** ç›®å½•ä¸‹ã€‚

![](img/4a456c9e8d792e8e3a7b12de848e99b8.png)

**æˆ–**

å¦‚æœä½ æ˜¯ä¸€ä¸ªç»ˆç«¯æå®¢ï¼Œä½¿ç”¨ç»ˆç«¯å®Œæˆä¸Šè¿°æ­¥éª¤ğŸ¤“ã€‚å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸º**/Desktop/yolov 4-tiny**/**darknet**

```
cd darknet/
```

é¦–å…ˆï¼Œæ¸…ç† ***æ•°æ®*** æ–‡ä»¶å¤¹å†…çš„**æ ‡ç­¾**æ–‡ä»¶å¤¹ä»¥å¤–çš„ ***æ•°æ®*** å’Œ ***cfg*** æ–‡ä»¶å¤¹ï¼Œè¿™æ˜¯åœ¨æ£€æµ‹æ¡†ä¸Šå†™å…¥æ ‡ç­¾åç§°æ‰€éœ€è¦çš„ã€‚

**æ¸…ç†*æ•°æ®*å’Œ *cfg* æ–‡ä»¶å¤¹ã€‚**

```
find ./data -mindepth 1 ! -regex '^./data/labels(/.*)?' -deleterm -rf cfg/
mkdir cfg
```

5(a)å¤åˆ¶ ***obj*** æ•°æ®é›†æ–‡ä»¶å¤¹ï¼Œä½¿å…¶ç°åœ¨ä½äº **/darknet/data/** æ–‡ä»¶å¤¹ä¸­

```
cp -R ../obj data/
```

5(b)å¤åˆ¶æ‚¨çš„***yolov 4-tiny-custom . CFG***æ–‡ä»¶ï¼Œä½¿å…¶ç°åœ¨ä½äº **/darknet/cfg/** æ–‡ä»¶å¤¹ä¸­

```
cp ../yolov4-tiny-custom.cfg cfg
```

5(c)å¤åˆ¶ ***obj.names*** å’Œ ***obj.data*** æ–‡ä»¶ï¼Œä½¿å®ƒä»¬ç°åœ¨ä½äº **/darknet/data/** æ–‡ä»¶å¤¹ä¸­

```
cp ../obj.names data
cp ../obj.data  data
```

5(d)å°† ***process.py*** æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ ***darknet*** ç›®å½•ä¸‹

```
cp ../process.py .
```

# 6)è¿è¡Œ process.py python è„šæœ¬ï¼Œåœ¨æ•°æ®æ–‡ä»¶å¤¹ä¸­åˆ›å»º train.txt & test.txt æ–‡ä»¶

å½“å‰å·¥ä½œç›®å½•ä¸º**/Desktop/yolov 4-tiny/darknet**ã€‚

```
python process.py
```

åˆ—å‡ºæ•°æ®æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œæ£€æŸ¥ train.txt & test.txt æ–‡ä»¶æ˜¯å¦å·²åˆ›å»ºã€‚

```
ls data/
```

ä¸Šé¢çš„ **process.py** è„šæœ¬åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶ **train.txt** å’Œ **test.txt** ï¼Œå…¶ä¸­ **train.txt** æŒ‡å‘ 90%çš„å›¾åƒï¼Œè€Œ **test.txt** æŒ‡å‘ 10%çš„å›¾åƒã€‚è¿™äº›æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚

![](img/bd9566c9b712bf92740c38b1da901729.png)

# 7)å°†é¢„å…ˆè®­ç»ƒå¥½çš„ YOLOv4-tiny æƒå€¼ä¸‹è½½å¤åˆ¶åˆ°â€œyolov4-tiny/darknetâ€ç›®å½•ä¸‹ã€‚

å½“å‰å·¥ä½œç›®å½•æ˜¯**/Desktop/yolov 4-tiny/darknet**

è¿™é‡Œæˆ‘ä»¬ç”¨è¿ç§»å­¦ä¹ ã€‚æˆ‘ä»¬æ²¡æœ‰ä»å¤´å¼€å§‹è®­ç»ƒæ¨¡å‹ï¼Œè€Œæ˜¯ä½¿ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„ yolov 4-å¾®å°çš„æƒé‡ï¼Œå®ƒå·²ç»è¢«è®­ç»ƒåˆ° 29 ä¸ªå·ç§¯å±‚ã€‚ä»è¿™é‡Œä¸‹è½½ YOLOv4-tiny é¢„è®­ç»ƒé‡é‡æ–‡ä»¶[å¹¶å¤åˆ¶åˆ°ä½ çš„ ***æš—ç½‘*** æ–‡ä»¶å¤¹ã€‚](https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v4_pre/yolov4-tiny.conv.29)

**æˆ–**

åªéœ€è¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚

```
wget [https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v4_pre/yolov4-tiny.conv.29](https://github.com/AlexeyAB/darknet/releases/download/darknet_yolo_v4_pre/yolov4-tiny.conv.29)
```

# 8)åŸ¹è®­

## è®­ç»ƒæ‚¨çš„å®šåˆ¶æ£€æµ‹å™¨

å½“å‰å·¥ä½œç›®å½•æ˜¯**/Desktop/yolov 4-tiny/darknet**

ä¸ºäº†è·å¾—æœ€ä½³ç»“æœï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå½“å¹³å‡æŸå¤±å°äº 0.05 æˆ–è€…è‡³å°‘æŒç»­ä½äº 0.3 æ—¶ï¼Œåº”è¯¥åœæ­¢è®­ç»ƒï¼Œå¦åˆ™è®­ç»ƒæ¨¡å‹ï¼Œç›´åˆ°å¹³å‡æŸå¤±æš‚æ—¶æ²¡æœ‰ä»»ä½•æ˜¾è‘—å˜åŒ–ã€‚

```
./darknet detector train data/obj.data cfg/yolov4-tiny-custom.cfg yolov4-tiny.conv.29 -dont_show -map#The **map** parameter here gives us the **M**ean **A**verage **P**recision. The higher the **mAP** the better it is for object detection. You can remove the **-dont_show** parameter to see the progress chart of mAP-loss against iterations.
```

ä½ å¯ä»¥è®¿é—®å®˜æ–¹çš„ AlexeyAB Github é¡µé¢ï¼Œå®ƒç»™å‡ºäº†å…³äºä½•æ—¶åœæ­¢è®­ç»ƒçš„è¯¦ç»†è§£é‡Šã€‚ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è·³è½¬åˆ°è¯¥éƒ¨åˆ†ã€‚

[AlexeyAB GitHub ä»€ä¹ˆæ—¶å€™åœæ­¢è®­ç»ƒï¼Ÿ](https://github.com/AlexeyAB/darknet/#user-content-when-should-i-stop-training)

## é‡æ–°å¼€å§‹è®­ç»ƒ(ä»¥é˜²è®­ç»ƒæ²¡æœ‰ç»“æŸï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­æ–­)

![](img/3618db27d4174c3d87ae61474e284832.png)

å¦‚æœè®­ç»ƒè¿‡ç¨‹å› æŸç§åŸå› ä¸­æ–­æˆ–åœæ­¢ï¼Œæ‚¨ä¸å¿…å†æ¬¡ä»å¤´å¼€å§‹è®­ç»ƒæ‚¨çš„æ¨¡å‹ã€‚ä½ å¯ä»¥ä»ä½ åœæ­¢çš„åœ°æ–¹é‡æ–°å¼€å§‹è®­ç»ƒã€‚ä½¿ç”¨ä¸Šæ¬¡ä¿å­˜çš„é‡é‡ã€‚åœ¨***yolov 4-tiny***dir å†…çš„ **training** æ–‡ä»¶å¤¹ä¸­ï¼Œæ¯ 100 æ¬¡è¿­ä»£å°†æƒé‡ä¿å­˜ä¸º**yolov 4-tiny-custom _ last . weights***ã€‚(æˆ‘ä»¬åœ¨â€œobj.dataâ€æ–‡ä»¶ä¸­ä½œä¸ºå¤‡ä»½ç»™å‡ºçš„è·¯å¾„)ã€‚*

**å› æ­¤ï¼Œè¦é‡æ–°å¼€å§‹è®­ç»ƒï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:**

```
./darknet detector train data/obj.data cfg/yolov4-tiny-custom.cfg ../training/yolov4-tiny-custom_last.weights -dont_show -map
```

# 9)æ£€æŸ¥æ€§èƒ½

## æŸ¥çœ‹åŸ¹è®­å›¾è¡¨

æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹***chart.png***æ–‡ä»¶æ¥æ£€æŸ¥æ‰€æœ‰è®­ç»ƒè¿‡çš„é‡é‡çš„æ€§èƒ½ã€‚ç„¶è€Œï¼Œ***chart.png***æ–‡ä»¶ä»…åœ¨è®­ç»ƒæ²¡æœ‰ä¸­æ–­çš„æƒ…å†µä¸‹æ˜¾ç¤ºç»“æœï¼Œå³ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ–­å¼€è¿æ¥æˆ–ä¸¢å¤±ä¼šè¯ã€‚å¦‚æœä»ä¿å­˜çš„ç‚¹é‡æ–°å¼€å§‹è®­ç»ƒï¼Œè¿™å°†ä¸èµ·ä½œç”¨ã€‚

æ‰“å¼€ ***æš—ç½‘*** ç›®å½•ä¸‹çš„**chart.png**æ–‡ä»¶ã€‚

å¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•æ¥æ£€æŸ¥ä½ çš„è¡¨ç°ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯é€šè¿‡æ£€æŸ¥è®­ç»ƒæƒé‡çš„åœ°å›¾ã€‚

## æ£€æŸ¥åœ°å›¾(å¹³å‡ç²¾åº¦)

æ‚¨å¯ä»¥æ£€æŸ¥æ¯ 1000 æ¬¡è¿­ä»£ä¿å­˜çš„æ‰€æœ‰æƒé‡çš„è´´å›¾ï¼Œä¾‹å¦‚:-yolov 4-tiny-custom _ 4000 . weightsï¼Œyolov 4-tiny-custom _ 5000 . weightsï¼Œyolov 4-tiny-custom _ 6000 . weightsï¼Œç­‰ç­‰ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥æ‰¾å‡ºå“ªä¸ªæƒé‡æ–‡ä»¶ç»™ä½ æœ€å¥½çš„ç»“æœã€‚åœ°å›¾è¶Šé«˜è¶Šå¥½ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ç‰¹å®šå·²ä¿å­˜æƒé‡æ–‡ä»¶çš„æ˜ å°„ï¼Œå…¶ä¸­ **xxxx** æ˜¯å…¶è¿­ä»£ç¼–å·ã€‚(ä¾‹å¦‚:- 4000ï¼Œ5000ï¼Œ6000ï¼Œâ€¦)

```
./darknet detector map data/obj.data cfg/yolov4-tiny-custom.cfg ../training/yolov4-tiny-custom_xxxx.weights -points 0
```

# 10)æµ‹è¯•æ‚¨çš„è‡ªå®šä¹‰å¯¹è±¡æ£€æµ‹å™¨

## å¯¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼Œå°†å…¶è®¾ç½®ä¸ºæµ‹è¯•æ¨¡å¼

*   å°†è¡Œæ‰¹æ›´æ”¹ä¸ºæ‰¹=1
*   å°†çº¿ç»†åˆ†æ”¹ä¸ºç»†åˆ†=1

æ‚¨å¯ä»¥æ‰‹åŠ¨å®Œæˆï¼Œä¹Ÿå¯ä»¥ç®€å•åœ°è¿è¡Œä¸‹é¢çš„ä»£ç 

```
cd cfg
sed -i 's/batch=64/batch=1/' yolov4-tiny-custom.cfg
sed -i 's/subdivisions=32/subdivisions=1/' yolov4-tiny-custom.cfg
cd ..
```

**æ³¨æ„:**æ ¹æ®æ‚¨åœ¨ cfg æ–‡ä»¶ä¸­çš„è®¾ç½®ï¼Œåœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­å°†ç¬¬ä¸€ä¸ªç»†åˆ†å€¼è®¾ç½®ä¸º 16 / 32 / 64ã€‚

## å¯¹å›¾åƒè¿è¡Œæ£€æµ‹å™¨

å°†å›¾åƒä¸Šä¼ åˆ°æ¡Œé¢ä¸Šåä¸º ***mask_test_images*** çš„æ–‡ä»¶å¤¹ä¸­ã€‚

ä½¿ç”¨æ­¤å‘½ä»¤å¯¹å›¾åƒè¿è¡Œæ‚¨çš„è‡ªå®šä¹‰æ£€æµ‹å™¨ã€‚(é˜ˆå€¼æ ‡å¿—è®¾ç½®å¯¹è±¡æ£€æµ‹æ‰€éœ€çš„æœ€ä½ç²¾åº¦)

```
./darknet detector test data/obj.data cfg/yolov4-tiny-custom.cfg ../training/yolov4-tiny-custom_best.weights ../../mask_test_images/image1.jpg -thresh 0.3
```

å…¶è¾“å‡ºä¿å­˜ä¸º ***æš—ç½‘*** æ–‡ä»¶å¤¹ä¸­çš„**predictions.jpg**ã€‚æ‚¨å¯ä»¥å°†å…¶å¤åˆ¶åˆ°ä»»ä½•è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œå¹¶ç”¨ä¸åŒçš„åç§°ä¿å­˜ã€‚æˆ‘å°†å®ƒä½œä¸º **output_image.jpg** ä¿å­˜åœ¨***mask _ test _ images***æ–‡ä»¶å¤¹æœ¬èº«ä¸­ã€‚

```
cp predictions.jpg ../../mask_test_images/output_image1.jpg
```

![](img/94e3e262c985843263a0194a93240ca4.png)![](img/0ea8cd3c4dc600881ee8008bc0ae043d.png)

## å¯¹è§†é¢‘è¿è¡Œæ£€æµ‹å™¨

å°†è§†é¢‘ä¸Šä¼ åˆ°æ¡Œé¢ä¸Šåä¸º***mask _ test _ videos***çš„æ–‡ä»¶å¤¹ã€‚

ç”¨è¿™ä¸ªå‘½ä»¤åœ¨ä¸€ä¸ªè§†é¢‘ä¸Šè¿è¡Œä½ çš„è‡ªå®šä¹‰æ¢æµ‹å™¨(**test.mp4**)ã€‚(thresh æ ‡å¿—è®¾ç½®å¯¹è±¡æ£€æµ‹æ‰€éœ€çš„æœ€ä½ç²¾åº¦)ã€‚è¿™ä¼šå°†è¾“å‡ºè§†é¢‘ä¿å­˜åœ¨ä¸â€œ **output.avi** â€ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚

```
./darknet detector demo data/obj.data cfg/yolov4-tiny-custom.cfg ../training/yolov4-tiny-custom_best.weights ../../mask_test_videos/test.mp4 -thresh 0.5 -i 0 -out_filename ../../mask_test_videos/output.avi
```

![](img/5bc07fb516152a08fb2ced1f24f7ab44.png)

## åœ¨å®æ—¶ç½‘ç»œæ‘„åƒå¤´ä¸Šè¿è¡Œæ£€æµ‹å™¨

è¿è¡Œä¸‹é¢çš„ä»£ç ã€‚

```
./darknet detector demo data/obj.data cfg/yolov4-tiny-custom.cfg ../training/yolov4-tiny-custom_best.weights -thresh 0.5
```

![](img/d86bd66ed6d49a774c2faba4fadaba90.png)

# æ³¨æ„:

æˆ‘æ”¶é›†çš„ç”¨äºé®ç½©æ£€æµ‹çš„æ•°æ®é›†ä¸»è¦åŒ…å«ç‰¹å†™å›¾åƒã€‚ä½ å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢æ›´å¤šçš„é•¿é•œå¤´å›¾ç‰‡ã€‚æœ‰å¾ˆå¤šç½‘ç«™å¯ä»¥ä¸‹è½½æœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æ•°æ®é›†ã€‚æˆ‘åœ¨æ•°æ®é›†æ¥æºä¸‹é¢ç»™å‡ºäº†ä¸€äº›é“¾æ¥ã€‚æˆ‘ä¹Ÿç»™å‡ºäº†ä¸€äº›æ©è†œæ•°æ®é›†çš„é“¾æ¥ã€‚å…¶ä¸­ä¸€äº›æœ‰è¶…è¿‡ 10ï¼Œ000 å¼ å›¾ç‰‡ã€‚

è™½ç„¶æˆ‘ä»¬å¯ä»¥å¯¹æˆ‘ä»¬çš„è®­ç»ƒé…ç½®æ–‡ä»¶è¿›è¡ŒæŸäº›è°ƒæ•´å’Œæ›´æ”¹ï¼Œæˆ–è€…é€šè¿‡å¢å¼ºä¸ºæ¯ç§ç±»å‹çš„å¯¹è±¡ç±»å‘æ•°æ®é›†æ·»åŠ æ›´å¤šå›¾åƒï¼Œä½†æˆ‘ä»¬å¿…é¡»å°å¿ƒï¼Œä»¥å…å¯¼è‡´å½±å“æ¨¡å‹å‡†ç¡®æ€§çš„è¿‡åº¦æ‹Ÿåˆã€‚

å¯¹äºåˆå­¦è€…ï¼Œä½ å¯ä»¥ç®€å•åœ°ä½¿ç”¨æˆ‘ä¸Šä¼ åˆ° GitHub ä¸Šçš„é…ç½®æ–‡ä»¶ã€‚æˆ‘è¿˜ä¸Šä¼ äº†æˆ‘çš„æ©æ¨¡å›¾åƒæ•°æ®é›†ä»¥åŠ YOLO æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶ï¼Œè™½ç„¶è¿™å¯èƒ½ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªè‰¯å¥½çš„å¼€ç«¯ï¼Œè®©æ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨ YOLO è®­ç»ƒæ‚¨è‡ªå·±çš„å®šåˆ¶æ£€æµ‹æœºæ¨¡å‹ã€‚ä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªè´¨é‡æ›´å¥½çš„å¸¦æ ‡ç­¾çš„æ•°æ®é›†æˆ–è€…ä¸€ä¸ªä¸å¸¦æ ‡ç­¾çš„æ•°æ®é›†ï¼Œä»¥åè‡ªå·±æ ‡æ³¨ã€‚

# GitHub é“¾æ¥

æˆ‘å·²ç»åœ¨ä¸‹é¢çš„ GitHub é“¾æ¥ä¸Šä¸Šä¼ äº†æˆ‘çš„è‡ªå®šä¹‰ mask æ•°æ®é›†å’Œæ‰€æœ‰å…¶ä»–ç”¨äºåœ¨ Windows ä¸­è®­ç»ƒè‡ªå®šä¹‰ YOLOv4-tiny æ£€æµ‹å™¨æ‰€éœ€çš„æ–‡ä»¶ã€‚

[yolov 4-tiny-custom-training _ LOCAL _ MACHINE](https://github.com/techzizou/yolov4-tiny-custom-training_LOCAL)

# å¸¦æ ‡ç­¾çš„æ•°æ®é›†(obj.zip)

[æ ‡è®°çš„å±è”½æ•°æ®é›†](https://www.kaggle.com/techzizou/labeled-mask-dataset-yolo-darknet)

# å…³äºè¿™ä¸ªçš„ YouTube è§†é¢‘ï¼

# ä¿¡ç”¨

## å‚è€ƒ

*   [é˜¿åˆ—å…‹è°¢ AB GitHub](https://github.com/AlexeyAB/darknet)
*   [pjreddie Github](https://github.com/pjreddie/darknet)
*   [ä»£ç  Github](https://github.com/theAIGuysCode/YOLOv4-Cloud-Tutorial)
*   [çº¸è´¨ YOLOv4](https://arxiv.org/abs/2004.10934)
*   [pjreddie ç«™ç‚¹](https://pjreddie.com/darknet/yolo/)

## æ•°æ®é›†æº

æ‚¨å¯ä»¥ä»ä¸‹é¢æåˆ°çš„ç½‘ç«™ä¸‹è½½è®¸å¤šå¯¹è±¡çš„æ•°æ®é›†ã€‚è¿™äº›ç½‘ç«™è¿˜åŒ…å«è®¸å¤šç§ç±»çš„å¯¹è±¡çš„å›¾åƒä»¥åŠå®ƒä»¬çš„å¤šç§æ ¼å¼çš„æ³¨é‡Š/æ ‡ç­¾ï¼Œä¾‹å¦‚ YOLO _ é»‘æš—ç½‘æ–‡æœ¬æ–‡ä»¶å’Œå¸•æ–¯å¡ _VOC XML æ–‡ä»¶ã€‚

*   [é€šè¿‡è°·æ­Œæ‰“å¼€å›¾åƒæ•°æ®é›†](https://storage.googleapis.com/openimages/web/index.html)
*   [Kaggle æ•°æ®é›†](https://www.kaggle.com/datasets)
*   [Roboflow å…¬å…±æ•°æ®é›†](https://public.roboflow.com/)
*   [å¯è§†åŒ–æ•°æ®æ•°æ®é›†](https://www.visualdata.io/discovery)

## å±è”½æ•°æ®é›†æº

æˆ‘å°†è¿™ 3 ä¸ªæ•°æ®é›†ç”¨äºæˆ‘çš„æ ‡è®°æ•°æ®é›†:

*   [èˆ¬è‹¥ Github](https://github.com/prajnasb/observations)
*   çº¦ç‘Ÿå¤«Â·çº³å°”é€ŠÂ·ç½—åšå¼—æ´›
*   [X-å¼ æ´‹ Github](https://github.com/X-zhangyang/Real-World-Masked-Face-Dataset)

## æ›´å¤šæ©è†œæ•°æ®é›†

*   Prasoonkottarathil ka ggle(20000 å¼ å›¾ç‰‡)
*   [ashishjangra 27 ka ggle](https://www.kaggle.com/ashishjangra27/face-mask-12k-images-dataset?select=Face+Mask+Dataset)(12000 å¼ å›¾ç‰‡)
*   [Andrewmvd Kaggle](https://www.kaggle.com/andrewmvd/face-mask-detection)

## è§†é¢‘æº

*   [https://www.pexels.com/](https://www.pexels.com/)

![](img/035ff94d52ea383ab80579049c0cf993.png)