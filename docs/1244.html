<html>
<head>
<title>Cassava Leaf Disease Detection(2020) Writeup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">木薯叶疾病检测(2020)报告</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/cassava-leaf-disease-detection-2020-writeup-df6318248436?source=collection_archive---------15-----------------------#2021-02-21">https://medium.com/analytics-vidhya/cassava-leaf-disease-detection-2020-writeup-df6318248436?source=collection_archive---------15-----------------------#2021-02-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a507" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今年的木薯叶检测挑战是一个非常好的挑战，因为与去年只有86个团队参加相比，今年有超过3500个团队参加了比赛。我后来加入了这个挑战。我被安排在1444/3900队(前38%)。这一次我错过了奖牌，但我很高兴幸存下来，这让我在排行榜上上升了425位。我希望记下在这次比赛中所做的一切和这次我所学到的一切。对我来说，将来参考这一点会很有用，对刚进入kaggle的新手来说也是如此，他们在如何处理一个给定的问题上有困难。所有的代码都可以在Kaggle笔记本<a class="ae jc" href="https://www.kaggle.com/mohneesh7/cassava-2020-case-study-full-progress-keras-gpu" rel="noopener ugc nofollow" target="_blank">这里</a>获得。那么，我们开始吧。</p></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/ff402e3c7f950d74221f355d8aa64f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Vt0zKksCLQDz9P8FrmPjQ.jpeg"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">来源:https://plantvillage.psu.edu/topics/cassava-manioc/infos<a class="ae jc" href="https://plantvillage.psu.edu/topics/cassava-manioc/infos" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><h1 id="414c" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">问题陈述概述</h1><p id="4eae" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">作为非洲第二大碳水化合物供应商，木薯是小农种植的一种重要的粮食安全作物，因为它可以承受恶劣的条件。撒哈拉以南非洲至少80%的家庭农场种植这种淀粉根，但病毒疾病是低产的主要原因。在数据科学的帮助下，有可能识别常见疾病，以便对其进行治疗。</p><p id="171e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现有的疾病检测方法要求农民寻求政府资助的农业专家的帮助，对植物进行视觉检查和诊断。这是劳动密集型、低供给和高成本的。作为一个额外的挑战，农民的有效解决方案必须在重大限制下表现良好，因为非洲农民可能只能获得低带宽的移动质量相机。</p><p id="1ae4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这次比赛中，我们介绍了在乌干达的一次定期调查中收集的21，367张带标签图像的数据集。大多数图像来自农民拍摄花园照片的众包，并由国家作物资源研究所(NaCRRI)的专家与坎帕拉Makerere大学人工智能实验室合作进行注释。这是一种最真实地代表农民在现实生活中需要诊断的格式。</p><p id="49db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在本次比赛中的任务是将一幅图像分为以下五类:</p><ul class=""><li id="3faa" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">木薯细菌性疫病(CBB)</li><li id="b9a6" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">木薯花叶病</li><li id="40c0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">木薯褐条病(CBSD)</li><li id="8703" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">木薯绿斑驳(CGM)</li><li id="b8db" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">健康的</li></ul><h1 id="cbe8" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">我解决问题的方法</h1><p id="cafa" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">现在我们已经了解了问题陈述是什么，我们知道这显然是一个分类问题(多类)。对于分类，我们可以在将每个图像转换为数组后使用许多机器学习模型，但CNN是图像的更好起点。</p><p id="bb55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我尝试使用一个简单的CNN架构来解决每个图像分类问题，使用随机权重初始化，并使用SGD和内斯特罗夫动量。(如果你想了解内斯特罗夫的势头，去这里<a class="ae jc" href="https://dominikschmidt.xyz/nesterov-momentum/" rel="noopener ugc nofollow" target="_blank"/>)这并没有给我带来任何好的结果。</p><h2 id="c7ac" class="lr kb hh bd kc ls lt lu kg lv lw lx kk ip ly lz ko it ma mb ks ix mc md kw me bi translated"><strong class="ak">我的实验流程</strong></h2><p id="cc47" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated"><em class="mf"> 1 </em>  <em class="mf">。对数据做了一点EDA，以了解阶级分布情况。</em></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mg"><img src="../Images/8c6c05bff1da24d166445154a202586d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMS3zXWX60YWCn3YuMeVKw.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">训练数据集中的类分布</figcaption></figure><p id="06d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">关键见解:</strong></p><ul class=""><li id="fe01" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">木薯花叶病(CMD)是构成总数据的<strong class="ig hi"> 61.5% </strong>的训练集中的优势类别。</li><li id="d80b" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">数据集非常倾斜，因此可能需要对图像进行上采样或下采样。</li></ul><p id="74d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">②<em class="mf">。</em>令人惊讶的是，这给出了60.2%的准确度</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mh"><img src="../Images/d4313a75c1a00b0a41161a30bb3aa5ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ADEteP4O-TUQ-8hyf8l_7g.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">天真提交的公众评分</figcaption></figure><p id="b855" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mf"> 3 </em> </strong> <em class="mf">。我最初打算不使用K-Fold CV，因为它是资源密集型的，kaggle对单个会话设置了9小时的限制。我决定使用10%的数据作为验证集，其余的作为训练集。</em></p><p id="0bba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mf"> 4。起初我只是用了一些小的增强，但是一些大的增强会持续很长时间。我用相册库来扩充我的图片。</em></strong></p><p id="51b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mf"> 5。建模部分非常棘手，正如我之前说过的，我定制的CNN架构并不是很好，如果有什么不同的话，那就是学习过程太慢，效率太低。我想到了用迁移学习来解决问题。我用“imagenet”权重尝试了以下所有架构:</em></strong></p><ul class=""><li id="bf17" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">ResNet50</li><li id="8e59" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">VGG16</li><li id="6f36" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">高效网络B0 — B5</li></ul><p id="57e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mf">在这些高效网络中，B4是一个更好的选择，它以较短的训练时间提供了良好的结果。</em></p><p id="97c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">6<em class="mf">。</em> </strong> <em class="mf">使用的损失函数是</em> <strong class="ig hi"> <em class="mf">交叉熵</em> </strong> <em class="mf">大部分情况下，我也尝试过使用双向逻辑损失(Google blog)。我同时使用了标签平滑，因为在训练集中有很多嘈杂的标签。要了解更多关于标签平滑的信息，看看我的代码或者点击这里</em><a class="ae jc" href="https://towardsdatascience.com/what-is-label-smoothing-108debd7ef06" rel="noopener" target="_blank"><em class="mf"/></a><em class="mf">。</em></p><p id="e73d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mf"> 7。</em> </strong> <em class="mf">我使用了起始学习率为0.001的Adam优化器，我没有使用任何学习率调度程序，而是使用学习率缩减器作为我的回调函数之一。</em></p><p id="ebe2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="mf"> 8。最终提交的作品是由经过训练的模型组成的软投票群体。</em></strong></p><p id="3965" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mf">在这之后，我得到了0.888的LB分数，不错但不足以有竞争力。所以我用了5折CV，重新做了上面所有的步骤。</em></p><h1 id="6dd2" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结果</h1><p id="7872" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我已经把我所有的结果以减价表的形式列出来了，请看下面。</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="mi mj l"/></div></figure><h1 id="c45e" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">我尝试过但没有成功的事情</strong></h1><ul class=""><li id="faff" class="ld le hh ig b ih ky il kz ip mk it ml ix mm jb li lj lk ll bi translated">冻结预训练模型的所有层，并尝试只训练额外的密集层，但没有成功，主要是因为数据集与imagenet数据不太相似。(这是我的想法，也是一些卡格勒人的想法)。</li><li id="0f3c" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">试图冻结批次归一化图层以保持原始平均值和标准偏差值，这大大打乱了模型。我对数据集使用了自定义的平均值和标准值，这也没有帮助。</li><li id="87e4" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">尝试了那达慕优化以及(RMSprop与内斯特罗夫势头)，而不是亚当。这并没有给亚当带来任何显著的改善。</li><li id="28bd" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">尝试双向逻辑损失，这是最相似的交叉熵，所以我只是用CE。</li><li id="43b2" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">测试时间增加(TTA)是棘手的，因为许多竞争对手发现这非常有用，他们的准确性增加。我做了很少的旋转和翻转，这确实给了我很好的结果，但稍微重一点的TTA看到了CV分数的下降。我决定相信我的简历，并保持我的TTA非常轻。</li><li id="40b3" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">这个比赛也允许使用2019年木薯叶数据集，但使用它没有任何帮助。</li></ul><h1 id="9dcb" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">第一次学的东西</strong></h1><p id="a536" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">现在到了最重要的部分，我记下了在这一个月的奇妙旅程中学到的一切。</p><ul class=""><li id="16a3" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">首先，Kaggle是关于小的调整和实验的，PyTorch在这种情况下非常有用，大多数ka ggle都使用PyTorch。尽管TF2在行业中很突出，但在kaggle实验中使用它真的很难。TF中新研究论文的实现没有PyTorch中的多。(正是因为这个原因，我开始学习PyTorch)</li><li id="4427" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我已经学会了使用TPU的基础知识，这大大提高了训练速度。</li><li id="0bc2" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我学会了使用混合精度训练策略，这可以大大减少训练时间。</li><li id="c041" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">这是我第一次使用白蛋白进行增强，通常我使用内置的图像数据生成器。这是非常强大和易于使用的。</li><li id="cda2" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我了解了标签平滑和伪标签，以解决竞争中的噪声标签。</li><li id="2d2f" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">通过这次比赛，我开始了解高效网络，这是非常有趣的，现在SOTA CNN架构。deepmind团队发布了一篇关于NFnets的论文，他们完全删除了批量标准化层，这似乎非常有趣，但不幸的是，我无法在这次比赛中尝试它们。</li><li id="97c0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">毫无疑问，我从许多kaggle笔记本和讨论线程中学到了太多的编码技术，我自己都记不清了。谢谢你们。</li><li id="95e1" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我知道简单的投票集合，但我知道软投票集合，你把所有的概率值加起来，然后取一个平均值，而不是选择最预测的类。(这真的很方便)。</li><li id="2364" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我知道了记录你的实验结果的重要性，下次我将尝试Neptune或任何类似的服务。我开始时确实没有条理，这使我进一步的实验很糟糕。组织你的实验，节省几个小时的麻烦。</li><li id="1cec" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我了解到，在Kaggle信任你的简历分数和你的公众LB分数一样重要，因为比赛后的重组可能真的会让你付出代价，我见过有人从第三名跌至30名，从1000多名跌至150名。模型需要具有稳定性，而不是过度适应公共测试集。</li><li id="d0a0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我也研究了CutMixup纸，它很好，但是我没有机会在我的实验中使用它。</li><li id="d222" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">从每一个模特身上榨出每一盎司的准确性的诀窍是将她们全部集合起来，我在比赛结束时发现，人们使用20-30个模特来集合，以获得冠军。</li><li id="ff3e" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我发现了一种新的清除TF变量的方法，使用<strong class="ig hi">tensor flow . keras . back end . clear _ session()，</strong></li><li id="e6b0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">Kaggle是一个非常好的学习这个领域新东西的地方。问任何问题，不管多么幼稚，肯定会有人回答并帮助你。</li></ul><h1 id="446f" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结论</h1><p id="1753" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">这次比赛丰富了我的知识。我想如果我有一个好的团队来迎接这个挑战，我会做得更好，但事实就是这样。下面你可以找到所有的内核链接:</p><ul class=""><li id="a5e6" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">完整组织案例研究:<a class="ae jc" href="https://www.kaggle.com/mohneesh7/cassava-2020-case-study-full-progress-keras-gpu" rel="noopener ugc nofollow" target="_blank">内核1 </a></li><li id="1d5a" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">我没有记录任何结果的随机代码:<a class="ae jc" href="https://www.kaggle.com/mohneesh7/cassava-leaf-disease-detection-lb-0-885-keras" rel="noopener ugc nofollow" target="_blank">内核2 </a></li></ul><h1 id="de99" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">编辑</h1><p id="21a6" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我添加了Streamlit共享支持来部署这个模型。去<a class="ae jc" href="https://share.streamlit.io/mohneesh7/cassava-kaggle-2020/main/Streamlit.py" rel="noopener ugc nofollow" target="_blank">这里</a>自己测试一下。</p><p id="a117" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">那都是男生！</p><p id="c2a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">干杯！</p></div></div>    
</body>
</html>