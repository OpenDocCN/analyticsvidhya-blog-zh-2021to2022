<html>
<head>
<title>Creating a dual axis Pareto chart in Altair</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Altair中创建双轴帕累托图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-a-dual-axis-pareto-chart-in-altair-e3673107dd14?source=collection_archive---------11-----------------------#2021-03-04">https://medium.com/analytics-vidhya/creating-a-dual-axis-pareto-chart-in-altair-e3673107dd14?source=collection_archive---------11-----------------------#2021-03-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/1531f8bc59a9c7a146e8267c02794a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFiVqoOz91GQZLFYvzS5Ig.png"/></div></div></figure><h2 id="46dd" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">什么是帕累托图？</h2><p id="7b05" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">按照维基百科的说法，<strong class="jp hi">帕累托图</strong>是一种既包含<a class="ae ki" href="https://en.wikipedia.org/wiki/Bar_chart" rel="noopener ugc nofollow" target="_blank">条</a>又包含<a class="ae ki" href="https://en.wikipedia.org/wiki/Line_chart" rel="noopener ugc nofollow" target="_blank">线图</a>的图表，其中单个数值用条<strong class="jp hi">表示，递减</strong>表示，累计总数用线表示。这张图表是以帕累托原理命名的，而帕累托原理的名字又来自著名的意大利经济学家维尔弗雷多·帕累托。</p><p id="2979" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">帕累托图的目的是突出一组(通常很大)因素中最重要的因素。在<a class="ae ki" href="https://en.wikipedia.org/wiki/Quality_control" rel="noopener ugc nofollow" target="_blank">质量控制</a>中，它通常代表最常见的缺陷来源、发生率最高的缺陷类型或客户投诉最频繁的原因等。</p><p id="b515" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">在这篇文章中，我们将分析顾客对一家餐馆的每条负面评价的百分比。我们有一组行动项目，即“投诉类型”和在“计数”栏中登记投诉的顾客数量，如下图所示。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="dd35" class="ip iq hh kt b fi kx ky l kz la">#Capture the complaint type and count in a dictionary<br/>data_dict = {"Complaint Type" : ['Too Noisy', 'Overpriced', 'Food is tasteless', 'Food is not fresh', 'Food is too salty', 'Not clean', 'Unfriendly staff', 'Wait time', 'No atmosphere', 'Small portions'],<br/>            "Count" : [27, 789, 65, 9, 15, 30, 12, 109, 45, 621]<br/>            }</span><span id="b33a" class="ip iq hh kt b fi lb ky l kz la"># create a dataframe from the dictionary<br/>df = pd.DataFrame(data_dict)</span><span id="b30d" class="ip iq hh kt b fi lb ky l kz la">#The sort is key to calculate the cumulative sums<br/># And also to display the counts in descending order of importance <br/># of the complaints</span><span id="8013" class="ip iq hh kt b fi lb ky l kz la">df = df.sort_values(by=['Count'], ascending=False)</span><span id="e21e" class="ip iq hh kt b fi lb ky l kz la"># The cumulative percentage is calculated using Pandas Cumsum<br/># Since the dataframe is sorted by the count, the cumsum adds up the complaints from the largest to the smallest.</span><span id="9484" class="ip iq hh kt b fi lb ky l kz la">df["count cumsum"] = df["Count"].cumsum()</span><span id="2afc" class="ip iq hh kt b fi lb ky l kz la"># Dividing the cumulative sum for each complaint by the total gets<br/># us to the 100% at the end</span><span id="fe2d" class="ip iq hh kt b fi lb ky l kz la">df["cumpercentage"] = df["count cumsum"]/(df["Count"].sum())</span></pre><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es lc"><img src="../Images/cd7cb888fae113e889444dc9966cc281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*RyYUcdjTefTN1HjPBwoj9w.png"/></div></figure><p id="66df" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">我们首先创建一个已经排序的“投诉类型”数据帧列的列表。这将满足Pareto图定义所要求的以降序显示投诉的条件。</p><p id="e49b" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">为了直观显示这些数据，我们需要两个Y轴，一个表示投诉数量，一个表示百分比数量。对于每个Y轴编码，我们将指定这个列表作为排序顺序来对齐两个图表。投诉本身将位于X轴上。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="1933" class="ip iq hh kt b fi kx ky l kz la">sort_order = df["Complaint Type"].tolist()</span><span id="e07c" class="ip iq hh kt b fi lb ky l kz la"># The base element adds data (the dataframe) to the Chart<br/># The categories of complaints are positioned along the X axis</span><span id="bfc0" class="ip iq hh kt b fi lb ky l kz la">base = alt.Chart(df).encode(<br/>    x = alt.X("Complaint Type:O",sort=sort_order),<br/>).properties (<br/>width = 500<br/>)</span><span id="9016" class="ip iq hh kt b fi lb ky l kz la"># Create the bars with length encoded along the Y axis <br/>bars = base.mark_bar(size = 20).encode(<br/>    y = alt.Y("Count:Q"),<br/>).properties (<br/>width = 500<br/>)</span><span id="78ae" class="ip iq hh kt b fi lb ky l kz la"># Create the line chart with length encoded along the Y axis<br/>line = base.mark_line(<br/>                       strokeWidth= 1.5,<br/>                       color = "#cb4154" <br/>).encode(<br/>    y=alt.Y('cumpercentage:Q',<br/>             title='Cumulative Count',<br/>             ,axis=alt.Axis(format=".0%")   ),<br/>    text = alt.Text('cumpercentage:Q')<br/>)</span><span id="7ea3" class="ip iq hh kt b fi lb ky l kz la"># Mark the percentage values on the line with Circle marks<br/>points = base.mark_circle(<br/>              strokeWidth= 3,<br/>              color = "#cb4154" <br/>).encode(<br/>         y=alt.Y('cumpercentage:Q', axis=None),<br/>)</span><span id="a356" class="ip iq hh kt b fi lb ky l kz la"># Mark the bar marks with the value text<br/>bar_text = bars.mark_text(<br/>    align='left',<br/>    baseline='middle',<br/>    dx=-10,  #the dx and dy can be manipulated to position text<br/>    dy = -10, #relative to the bar<br/>).encode(<br/>    y= alt.Y('Count:Q', axis=None),<br/>    # we'll use the percentage as the text<br/>    text=alt.Text('Count:Q',),<br/>    color= alt.value("#000000")<br/>)</span><span id="c64a" class="ip iq hh kt b fi lb ky l kz la"># Mark the Circle marks with the value text<br/>point_text = points.mark_text(<br/>    align='left',<br/>    baseline='middle',<br/>    dx=-10, <br/>    dy = -10,<br/>).encode(<br/>    y= alt.Y('cumpercentage:Q', axis=None),<br/>    # we'll use the percentage as the text<br/>    text=alt.Text('cumpercentage:Q', format="0.0%"),<br/>    color= alt.value("#cb4154")<br/>)</span><span id="0e67" class="ip iq hh kt b fi lb ky l kz la"># Layer all the elements together <br/>(bars + bar_text +  line + points + point_text).resolve_scale(<br/>    y = 'independent'<br/>)</span></pre><p id="bdf4" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">显示双轴的关键代码是resolve_scale函数，与设置为独立的“y”一起使用。结果，每个轴都被独立格式化。下面是另一个<strong class="jp hi"> </strong> <a class="ae ki" href="https://altair-viz.github.io/gallery/layered_chart_with_dual_axis.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jp hi">参考例子</strong> </a> <strong class="jp hi"> </strong>为双轴。</p><pre class="ko kp kq kr fd ks kt ku kv aw kw bi"><span id="a934" class="ip iq hh kt b fi kx ky l kz la">(bars + bar_text +  line + points + point_text).resolve_scale(<br/>    y = 'independent'<br/>)</span></pre><p id="bf50" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated"><strong class="jp hi">最后是</strong></p><p id="0143" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">适用于各种领域的帕累托原则指出，对于许多结果，大约80%的后果来自20%的原因(“关键少数”)。它通常也被称为<strong class="jp hi"> 80/20法则</strong>、重要少数法则<strong class="jp hi">、因素稀疏原则</strong>或<strong class="jp hi">。</strong></p><p id="1e1d" class="pw-post-body-paragraph jn jo hh jp b jq kj js jt ju kk jw jx ja kl jz ka je km kc kd ji kn kf kg kh ha bi translated">从图表中，现在很容易从线形图中找出80%的不满意因素，从而很容易通过调整菜单价格和份量来吸引顾客再次光临！</p></div></div>    
</body>
</html>