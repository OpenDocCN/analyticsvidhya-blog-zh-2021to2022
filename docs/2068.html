<html>
<head>
<title>Flask Development Part 4: Database Configuration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flask开发第4部分:数据库配置</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/flask-development-part-4-database-configuration-648b11f708a5?source=collection_archive---------19-----------------------#2021-04-03">https://medium.com/analytics-vidhya/flask-development-part-4-database-configuration-648b11f708a5?source=collection_archive---------19-----------------------#2021-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="05f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个简单的SQL炼金术数据库。</p><p id="90fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一系列文章的第4部分，通过开发和托管一个简单的CRUD应用程序，带您了解Flask Web开发的基础知识。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0fdde0c5543c9946ee7ddef5cbbc1389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWK6yDaBe7x5viez2VyeMw.jpeg"/></div></div></figure><h1 id="d4f6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">该系列分为6个部分:</h1><ol class=""><li id="aeb8" class="kn ko hi ih b ii kp im kq iq kr iu ks iy kt jc ku kv kw kx bi translated"><a class="ae ky" href="https://medium.com/p/69cbf9e83abc/edit" rel="noopener">一个简单的Hello World应用</a></li><li id="d74f" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><a class="ae ky" href="https://medium.com/p/d10442121fdd/edit" rel="noopener">渲染HTML模板。</a></li><li id="1d06" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><a class="ae ky" href="https://medium.com/p/68e3bf2f6642/edit" rel="noopener">构建可扩展的文件结构。</a></li><li id="58e7" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><a class="ae ky" href="https://medium.com/p/648b11f708a5/edit" rel="noopener"> <strong class="ih hj">配置数据库。</strong>T11】</a></li><li id="5302" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><a class="ae ky" href="https://medium.com/p/a79042c9368c/edit" rel="noopener">处理用户登录和注册。</a></li><li id="c1dd" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><a class="ae ky" href="https://medium.com/p/d3413cd94363/edit" rel="noopener">增加CRUD(创建、读取、更新、删除)功能。</a></li></ol><h1 id="4b28" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第4部分:数据库配置</h1><p id="0c80" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">在教程的这一部分，我们将建立一个SQL数据库并创建一个用户对象，该对象将在下一部分中用于处理登录和注册。</p><h2 id="5522" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">第一步。更新config.py文件来配置数据库。</h2><p id="4b2e" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">在第3部分的最后，我们的config.py文件如下所示:</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="0821" class="lh jq hi lw b fi ma mb l mc md">from flask import Flask</span><span id="da0f" class="lh jq hi lw b fi me mb l mc md">app = Flask(__name__, template_folder='../templates')</span></pre><p id="2e5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要再安装2个烧瓶包。您可以通过在终端中运行以下两个命令来做到这一点。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="7d2d" class="lh jq hi lw b fi ma mb l mc md">pip install flask_login<br/>pip install flask_sqlalchemy</span></pre><p id="1f85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们将向导入添加两行，以包含我们刚刚安装的包的一部分。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="e60a" class="lh jq hi lw b fi ma mb l mc md">from flask import Flask<br/><strong class="lw hj">from flask_login import UserMixin<br/>from flask_sqlalchemy import SQLAlchemy</strong></span><span id="fe85" class="lh jq hi lw b fi me mb l mc md">app = Flask(__name__, template_folder='../templates')</span></pre><p id="6aff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将添加两行来设置数据库。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="d0af" class="lh jq hi lw b fi ma mb l mc md">from flask import Flask<br/>from flask_login import UserMixin<br/>from flask_sqlalchemy import SQLAlchemy</span><span id="68e8" class="lh jq hi lw b fi me mb l mc md">app = Flask(__name__, template_folder='../templates')</span><span id="0cac" class="lh jq hi lw b fi me mb l mc md"><strong class="lw hj">app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'<br/>db = SQLAlchemy(app)</strong></span></pre><p id="52f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以很容易地完成这个系列，而不必太担心这两行代码实际上在做什么，但是如果您好奇，您可以在文档<a class="ae ky" href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/config/" rel="noopener ugc nofollow" target="_blank">这里</a>找到更多细节。</p><p id="327e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将添加它来定义我们的用户对象。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="55bc" class="lh jq hi lw b fi ma mb l mc md">from flask import Flask<br/>from flask_login import UserMixin<br/>from flask_sqlalchemy import SQLAlchemy</span><span id="f861" class="lh jq hi lw b fi me mb l mc md">app = Flask(__name__, template_folder='../templates')</span><span id="26d1" class="lh jq hi lw b fi me mb l mc md">app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'<br/>db = SQLAlchemy(app)</span><span id="3c27" class="lh jq hi lw b fi me mb l mc md"><strong class="lw hj">class User(db.Model, UserMixin):</strong></span><span id="d15a" class="lh jq hi lw b fi me mb l mc md"><strong class="lw hj">    id = db.Column(db.Integer, <br/>                   primary_key = True)<br/>    <br/>    username = db.Column(db.String(20),<br/>                         unique = True, <br/>                         nullable = False)</strong></span><span id="beb7" class="lh jq hi lw b fi me mb l mc md"><strong class="lw hj">    email = db.Column(db.String(120), <br/>                      unique = True, <br/>                      nullable = False)</strong></span><span id="b1d2" class="lh jq hi lw b fi me mb l mc md"><strong class="lw hj">    password = db.Column(db.String(60),<br/>                         nullable = False)</strong></span></pre><p id="24eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个类定义了我们的数据库对象。我们有4个与该对象相关的字段。</p><ol class=""><li id="96b2" class="kn ko hi ih b ii ij im in iq mf iu mg iy mh jc ku kv kw kx bi translated">id-这是一个自动递增的id号。</li><li id="1d15" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">用户名-这将存储我们的用户的用户名。</li><li id="9f8f" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">电子邮件-这将存储我们的用户的电子邮件地址。</li><li id="b808" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">密码-这将存储我们的用户的密码。</li></ol><p id="fc5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些字段也有一些限制。</p><ol class=""><li id="6ed5" class="kn ko hi ih b ii ij im in iq mf iu mg iy mh jc ku kv kw kx bi translated">使用数据库。String()我们将该字段定义为一个字符串字段，并赋予它最大的字符数。因此，我们的用户名可以长达20个字符，我们的电子邮件地址可以长达120个字符，我们的密码可以长达60个字符。</li><li id="2e8b" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">使用unique = True，我们可以确保没有重复。因此，我们的电子邮件和用户名字段必须不存在于数据库中，以便创建。我们的密码字段没有这种限制，所以两个用户可以有相同的密码。</li><li id="094f" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">使用nullable = False，我们可以确保没有该字段就无法创建实例或我们的类。我们的用户名、电子邮件和密码字段都是必填的。</li></ol><p id="fc58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有关定义模型的更多信息，请查看这里的文档<a class="ae ky" href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/models/" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="09a6" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">第二步。更新我们的index.py文件以导入数据库</h2><p id="8ee0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">为此，我们只需将已经创建的导入从配置文件添加到索引文件中。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="93b9" class="lh jq hi lw b fi ma mb l mc md">from config import app<strong class="lw hj">, db</strong><br/>from flask import Flask, render_template</span><span id="eb8a" class="lh jq hi lw b fi me mb l mc md"><a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/')<br/><a class="ae ky" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/index')<br/>def hello_world():<br/>    <br/>    return render_template('index.html')</span></pre><h2 id="1c7f" class="lh jq hi bd jr li lj lk jv ll lm ln jz iq lo lp kd iu lq lr kh iy ls lt kl lu bi translated">第三步。使用终端创建数据库</h2><p id="6ffd" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">首先，我们将把终端中的目录设置为后端文件夹的位置。对我来说，我将项目文件夹保存到桌面上，所以第一行是:</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="0c6e" class="lh jq hi lw b fi ma mb l mc md">cd Desktop/FlaskApp/backend</span></pre><p id="13ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对你来说，这是cd +应用程序中后端文件夹的路径。</p><p id="983e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来运行这行代码来启动python:</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="d16b" class="lh jq hi lw b fi ma mb l mc md">python</span></pre><p id="8515" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将使用python导入来获取db对象。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="2f4e" class="lh jq hi lw b fi ma mb l mc md">from config import db</span></pre><p id="1467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将创建所有的数据库对象。</p><pre class="je jf jg jh fd lv lw lx ly aw lz bi"><span id="9d45" class="lh jq hi lw b fi ma mb l mc md">db.create_all()</span></pre><p id="431e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在检查一下您的文件结构，您应该会看到一个名为site.db的新文件已经在后端文件夹中创建了。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mi"><img src="../Images/25d7c7a63df318b527475b0d7d111973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*dJR4GC68OddE2CExEtZdRA.png"/></div></figure><p id="703a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这部分的源代码可以在我的GitHub <a class="ae ky" href="https://github.com/shawnhymers/FlaskApp/tree/Part-4" rel="noopener ugc nofollow" target="_blank">这里找到</a>:</p><p id="5700" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一篇文章中，我们将使用这个新数据库来创建用户并处理注册和登录请求。</p></div></div>    
</body>
</html>