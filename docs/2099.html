<html>
<head>
<title>Azure ML — Timeseries using tsfresh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure ML —使用tsfresh的时间序列</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/azure-ml-timeseries-using-tsfresh-206d5f51105d?source=collection_archive---------12-----------------------#2021-04-04">https://medium.com/analytics-vidhya/azure-ml-timeseries-using-tsfresh-206d5f51105d?source=collection_archive---------12-----------------------#2021-04-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="6ee1" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">如何在Azure机器学习中运行tsfresh</h1><h1 id="46d4" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">先决条件</h1><ul class=""><li id="cbb0" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="401a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure机器学习服务</li></ul><h1 id="7fe2" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">如何</h1><ul class=""><li id="3a66" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">登录ml.azure.com</li><li id="86d8" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择要使用的工作空间</li><li id="cd77" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">为我的示例创建一个计算集群，我使用DS14_v2一个节点</li><li id="017d" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">一旦登录到Jupyter实验室</li><li id="67f1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个名为requirements.txt的新文本文件</li><li id="3854" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">复制下面的内容</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="327d" class="ki if hh ke b fi kj kk l kl km">requests&gt;=2.9.1<br/>numpy&gt;=1.15.1<br/>pandas&gt;=0.25.0<br/>scipy&gt;=1.2.0<br/>statsmodels&gt;=0.9.0<br/>patsy&gt;=0.4.1<br/>scikit-learn&gt;=0.22.0<br/>tqdm&gt;=4.10.0<br/>dask[dataframe]&gt;=2.9.0<br/>distributed&gt;=2.11.0<br/>matrixprofile&gt;=1.1.10&lt;2.0.0<br/>stumpy&gt;=1.7.2</span></pre><ul class=""><li id="912f" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在创建一个新的ML笔记本</li><li id="e833" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">称之为install.ipynb</li><li id="93e1" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">本笔记是安装要求和t刷新</li><li id="17e4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">运行此命令以安装要求</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="3205" class="ki if hh ke b fi kj kk l kl km">pip install -r requirements.txt</span></pre><ul class=""><li id="6f9a" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在安装tsfresh</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="0c72" class="ki if hh ke b fi kj kk l kl km">pip install tsfresh</span></pre><ul class=""><li id="7fa8" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在创建一个新笔记本，用sklearn测试tsfresh</li><li id="8131" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">调用笔记本sklearn.ipynb</li><li id="3012" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">开始笔记本编码</li><li id="1e92" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">样品也可在此获得—<a class="ae ks" href="https://github.com/blue-yonder/tsfresh" rel="noopener ugc nofollow" target="_blank">https://github.com/blue-yonder/tsfresh</a></li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="7142" class="ki if hh ke b fi kj kk l kl km">import pandas as pd<br/>from sklearn.pipeline import Pipeline<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import RandomForestClassifier<br/>from sklearn.metrics import classification_report<br/><br/>from tsfresh.examples import load_robot_execution_failures<br/>from tsfresh.transformers import RelevantFeatureAugmenter<br/>from tsfresh.utilities.dataframe_functions import impute</span></pre><ul class=""><li id="5cd7" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">加载样本数据集</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="aa11" class="ki if hh ke b fi kj kk l kl km">from tsfresh.examples.robot_execution_failures import download_robot_execution_failures<br/>download_robot_execution_failures() <br/>df_ts, y = load_robot_execution_failures()</span></pre><ul class=""><li id="f0a4" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">分割数据集</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="ec8e" class="ki if hh ke b fi kj kk l kl km">X = pd.DataFrame(index=y.index)<br/><br/># Split data into train and test set<br/>X_train, X_test, y_train, y_test = train_test_split(X, y)</span></pre><ul class=""><li id="132f" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">设置sklearn管道</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="1bb7" class="ki if hh ke b fi kj kk l kl km">ppl = Pipeline([<br/>        ('augmenter', RelevantFeatureAugmenter(column_id='id', column_sort='time')),<br/>        ('classifier', RandomForestClassifier())<br/>      ])<br/>ppl.set_params(augmenter__timeseries_container=df_ts);</span></pre><ul class=""><li id="73fe" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">管道安装</li><li id="8b8e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">这是训练发生的地方</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="d2d3" class="ki if hh ke b fi kj kk l kl km">ppl.fit(X_train, y_train)</span></pre><ul class=""><li id="1655" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在预测模型</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="89a9" class="ki if hh ke b fi kj kk l kl km">ppl.fit(X_train, y_train)</span></pre><ul class=""><li id="ed7e" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">打印输出</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="df66" class="ki if hh ke b fi kj kk l kl km">y_pred = ppl.predict(X_test)</span><span id="3569" class="ki if hh ke b fi kt kk l kl km">print(classification_report(y_test, y_pred))</span></pre><figure class="jz ka kb kc fd kv er es paragraph-image"><div class="er es ku"><img src="../Images/23e42e4c9408fe3c11e024ceb8801c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*ihcn0iQttM2ZHYxp.jpg"/></div></figure><ul class=""><li id="af54" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">显示功能:</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="056d" class="ki if hh ke b fi kj kk l kl km">ppl.named_steps["augmenter"].feature_selector.relevant_features</span><span id="3216" class="ki if hh ke b fi kt kk l kl km">df_ts_train = df_ts[df_ts["id"].isin(y_train.index)]<br/>df_ts_test = df_ts[df_ts["id"].isin(y_test.index)]</span></pre><ul class=""><li id="e08d" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">训练模型</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="8b74" class="ki if hh ke b fi kj kk l kl km">ppl.set_params(augmenter__timeseries_container=df_ts_train);<br/>ppl.fit(X_train, y_train);</span></pre><ul class=""><li id="adaf" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在保存pickle文件</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="88ba" class="ki if hh ke b fi kj kk l kl km">import pickle<br/>with open("pipeline.pkl", "wb") as f:<br/>    pickle.dump(ppl, f)</span></pre><ul class=""><li id="3ad8" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">使用tsfresh功能进行预测</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="b052" class="ki if hh ke b fi kj kk l kl km">ppl.set_params(augmenter__timeseries_container=df_ts_test);<br/>y_pred = ppl.predict(X_test)</span></pre><ul class=""><li id="c339" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">打印输出</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="3235" class="ki if hh ke b fi kj kk l kl km">print(classification_report(y_test, y_pred))</span></pre><figure class="jz ka kb kc fd kv er es paragraph-image"><div class="er es ky"><img src="../Images/f85c0d3aa8fbf3cbc741d3b7fb269cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/0*hFez4Mu7lJLNMw1E.jpg"/></div></figure></div><div class="ab cl kz la go lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ha hb hc hd he"><p id="7bce" class="pw-post-body-paragraph lg lh hh je b jf kn li lj jh ko lk ll jj lm ln lo jl lp lq lr jn ls lt lu jp ha bi translated"><em class="lv">最初发表于</em><a class="ae ks" href="https://github.com/balakreshnan/Samples2021/blob/main/AzureML/tsfresh/sklearnsample.md" rel="noopener ugc nofollow" target="_blank">T5【https://github.com】</a><em class="lv">。</em></p></div></div>    
</body>
</html>