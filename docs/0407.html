<html>
<head>
<title>Effectiveness of KNN Imputation, Part II: The Terry Stops Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">KNN插补的有效性，第二部分:特里停止数据集</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/effectiveness-of-knn-imputation-part-ii-the-terry-stops-dataset-4c23cf48ec35?source=collection_archive---------15-----------------------#2021-01-15">https://medium.com/analytics-vidhya/effectiveness-of-knn-imputation-part-ii-the-terry-stops-dataset-4c23cf48ec35?source=collection_archive---------15-----------------------#2021-01-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/352048cd9a2f8faaf3d0b41ebd62dbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OW1sHosHbLbTXyVymSsv1g.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">图片来源:Getty Images</figcaption></figure><p id="8eed" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><a class="ae jr" href="https://benmauss.medium.com/effectiveness-of-knn-imputation-part-i-the-iris-dataset-e784f157275a" rel="noopener">上周</a>我们观察了Sci-Kit Learn的KNNImputer在Iris数据集上的有效性。选择这个数据集作为开始，因为它小，平衡，最重要的是，简单。所有特征都由连续值组成。这使得对结果的评估非常直接，解释也更加容易。</p><p id="6235" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">本周，我们将看看在<a class="ae jr" href="https://www.kaggle.com/city-of-seattle/seattle-terry-stops" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上提供的特里停站数据集。更具体地说，所用的数据集是我之前为一个分类项目<a class="ae jr" href="https://github.com/bmauss/LogReg_Analysis_of_Terry_Stops" rel="noopener ugc nofollow" target="_blank">预处理过的数据集。除了原始数据(停止的对象的人口统计数据、涉及的官员的种族和性别、在特里停止期间执行的动作等。)它包括一些工程特征，例如，如果该官员与该对象是不同的种族或性别(或两者都有)，如果该对象被多次拦截(被标记为“惯犯”)，等等..</a></p><p id="ca33" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">选择这个数据集是因为它与虹膜数据集完全相反。它很大(30，000+行)，它很臃肿(28列)，它很混乱(高度的类不平衡)，并且所有的特征都是绝对的。因为我们要输入的值是分类的，所以评估结果将是非黑即白的:正确的类别是否被输入？不存在算法“大部分正确”的灰色地带。</p><h1 id="c89c" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">预处理</h1><p id="fe80" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">预处理和上次的<a class="ae jr" href="https://benmauss.medium.com/effectiveness-of-knn-imputation-part-i-the-iris-dataset-e784f157275a" rel="noopener">一样，但是有两个例外。首先，我们需要先删除包含唯一标识符的列。我们需要去掉这些，因为这实质上是要求KNN估算者根据最近邻居的平均名字来猜测受试者或官员的名字。这不公平。</a></p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kv"><img src="../Images/cf42daa07ce2bad90841e9480812a933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K48KkoqhtYwunmaiaNGf0g.png"/></div></div></figure><p id="fcad" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">另一个变化是我们需要对整个数据集进行标签编码，而不仅仅是目标变量，在本例中是列<code class="du la lb lc ld b">arrest_flag</code>(一个二进制类，其中0表示主体没有被逮捕，1表示他们被逮捕)。</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/561afc32adcf3447d88c396713d0787b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*76vpHVd4qmfMDzudSs5ONA.png"/></div></div></figure><p id="806c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">接下来是相同的过程:缩放数据集，设置随机种子值，然后移除数据。这一次，我们将从删除20%的数据开始，看看它会如何影响数据集。同样，每行可以被选择多次。</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div class="er es lf"><img src="../Images/1ed05df57852de8267c416c053e4c87a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*1DWALQ8xQIrUv7yxmXW-XA.png"/></div></figure><p id="c856" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">不到150，000个数据单元被删除，30，000行中的99%受到影响。我得说这已经够乱的了。很少看到99%的行至少缺少一个值的精选数据集。</p><p id="ccbf" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后，像上次一样，我们获取包含缺失值的所有行的索引，并保存它们，以使用未缩放数据的副本来创建答案密钥。</p><h1 id="607e" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">KNN插补</h1><p id="b8c7" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">现在，是时候估算了！</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lg"><img src="../Images/5a20286a47f353ead372462f13281953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PCEfaI0Tzbstvi6d8kQ6Fg.png"/></div></div></figure><p id="244d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">应该注意的是，由于丢失的数据量和算法必须考虑和计算平均值的邻居数量，这在计算上是昂贵的。如果你正在跟进，你可能想在Google Colab中运行这个。</p><p id="e79c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后反转比例，以便我们可以将结果与我们的答案进行比较。</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/26ec5d28d6a04c18edcaf438fcf7059b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-wi-MELsDgh6DvZ0_zlG8A.png"/></div></div></figure><p id="7b53" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在开始评估之前，我们还有一个额外的步骤。因为KNNImputer将使用位于最近邻居中的相应数据的<em class="li">平均值</em>来填充缺失的数据。这意味着并非所有的估算值都是整数。许多将是有理数。这就产生了一个问题，因为所有的分类数据都是标签编码的，并且用一个整数表示。有理数是无法解释的。为了解决这个问题，我们需要四舍五入到最接近的整数。</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lg"><img src="../Images/c104186d1797b29c1b67cc8b6eec88e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvNsCU3q8J8ey_sMrNEv7w.png"/></div></div></figure><h1 id="76a1" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">评价</h1><p id="da31" class="pw-post-body-paragraph it iu hh iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq ha bi translated">如上所述，评估基本上是“通过-失败”。正确的类别要么被估算，要么没有。让我们来看看结果:</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div class="er es lj"><img src="../Images/0cbe11a63934d097a44070be912d5b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*qk5gNksEtUJ9G4ORMRwnTQ.png"/></div></figure><p id="7cdd" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">准确性只比随机概率高一点点。让我们看看调整邻居的数量是否有积极的作用。我们将调整n_neighbors参数并再次运行试验。让我们把它设置为10。</p><h2 id="35bf" class="lk jt hh bd ju ll lm ln jy lo lp lq kc je lr ls kg ji lt lu kk jm lv lw ko lx bi translated">10个邻居</h2><figure class="kw kx ky kz fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/d69d6a1cec180267fd46260236bc7dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*Xz1gSdf_0b_cqzhoq3tO8g.png"/></div></figure><p id="0c3e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">邻居越多，准确率越低。这是有意义的，因为算法将包括更远的邻居，这将对估算的平均值产生负面影响。现在让我们减少邻居的数量。</p><h2 id="e304" class="lk jt hh bd ju ll lm ln jy lo lp lq kc je lr ls kg ji lt lu kk jm lv lw ko lx bi translated">两个邻居</h2><figure class="kw kx ky kz fd ii er es paragraph-image"><div class="er es lz"><img src="../Images/f380a6c634ee7e91b815602e7c36bffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*MVca52ALBtWSdzp5H4L2uw.png"/></div></figure><p id="99a3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">只有两个邻居，准确性确实提高了，但提高的不是很多。这也是需要对估算值进行舍入的限制。计算平均值时，将任何奇数除以2都会得到一个以. 5结尾的值。所有这些都将被围捕。为了避免这种情况，最好使用奇数个邻居。</p><p id="5959" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">让我们最后一次尝试减少邻居的数量。</p><h2 id="22db" class="lk jt hh bd ju ll lm ln jy lo lp lq kc je lr ls kg ji lt lu kk jm lv lw ko lx bi translated">1个邻居</h2><figure class="kw kx ky kz fd ii er es paragraph-image"><div class="er es lj"><img src="../Images/19d26cc46065acb19cd20ab27fa46594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*NewWihyjcaW9tKjnjqdqhQ.png"/></div></figure><p id="02cf" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们走吧！准确率从55%提高到62%。这仍然是相当低的，但是有其他的方法来优化它。删除列，解决阶级不平衡，你能想到的。如果没有一种方法来优化这一点并提高准确性，KNN插补就不会如此流行。然而，这是另一个时间的话题。</p><p id="eaaf" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">记住，我们实验的目的是确定KNN插补对分类数据的有效性。这个问题的答案很简单。由于所有的结果都必须四舍五入，KNN插补更难处理分类数据。这带来了将估计类别推/拉得更接近或更远离实际值的风险。</p></div></div>    
</body>
</html>