<html>
<head>
<title>Visual display of intermediate steps of GPT2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GPT2中间步骤的可视化显示</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/visual-display-of-intermediate-steps-of-gpt2-13764a5630ea?source=collection_archive---------12-----------------------#2021-01-21">https://medium.com/analytics-vidhya/visual-display-of-intermediate-steps-of-gpt2-13764a5630ea?source=collection_archive---------12-----------------------#2021-01-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f9dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，在这里，我们首先必须安装pytorch，然后我们必须安装ecco。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="19ca" class="jl jm hh jh b fi jn jo l jp jq">!pip install ecco</span><span id="e545" class="jl jm hh jh b fi jr jo l jp jq">import warnings</span><span id="3a99" class="jl jm hh jh b fi jr jo l jp jq">warnings.filterwarnings('ignore')</span></pre><p id="0a1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们必须导入我们最近安装的ecco库。之后，我们必须加载语言模型，我们可以加载它，有或没有神经元激活。这里我们加载gpt2作为我们的语言模型。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="bb74" class="jl jm hh jh b fi jn jo l jp jq">import ecco</span><span id="a9d5" class="jl jm hh jh b fi jr jo l jp jq">lm = ecco.from_pretrained('distilgpt2', activations=True)</span></pre><p id="82a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们来看一个不完整的句子，看看gpt2如何完成这个句子。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="6a13" class="jl jm hh jh b fi jn jo l jp jq">text = " What is your "<br/>output_1 = lm.generate(text1, generate=1, do_sample=False)</span><span id="d468" class="jl jm hh jh b fi jr jo l jp jq"><strong class="jh hi">Output</strong></span><span id="3c72" class="jl jm hh jh b fi jr jo l jp jq">what is your <strong class="jh hi">&gt;&gt; favorite</strong></span></pre><p id="783a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们只对生成1个令牌感兴趣，因此我们提到generate=1，我们提到do_sample=False，因此它不会从前20个输出中随机给出任何输出，而是选择概率最好的一个作为输出。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="ea21" class="jl jm hh jh b fi jn jo l jp jq">output_1.layer_predictions(position=3, layer=5, topk=10)</span></pre><figure class="jc jd je jf fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es js"><img src="../Images/3c7ca66fa903144a3105c78c6acc9198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJitUA3yZfORX08v_dwaBw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">这是输出</figcaption></figure><p id="5ddc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们给出3个单词作为输入，它们分别被编号为0、1和2。我们想生成第三个位置字。这里我们看到的是gpt2第5层的前10个概率最高的单词。</p><p id="f557" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们也可以通过使用下面提到的代码来找出令牌id</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="f783" class="jl jm hh jh b fi jn jo l jp jq">lm.tokenizer(" job name")</span><span id="bba3" class="jl jm hh jh b fi jr jo l jp jq"><strong class="jh hi">Output</strong><br/>{'input_ids': [1693, 1438], 'attention_mask': [1, 1]}</span></pre><p id="7f1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在ecco库的帮助下，我们可以比较不同级别的不同输出令牌的排名。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="7fcf" class="jl jm hh jh b fi jn jo l jp jq">output_1.rankings_watch(watch=[1693, 1438], position=3)</span></pre><figure class="jc jd je jf fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es ke"><img src="../Images/f3822c94b917bc4439bef0c34f68d532.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*3oXI2x5PksUPT6ZD5vPSIQ.png"/></div></div></figure><p id="13a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在watch中，我们必须给出令牌列表的输入，还必须提到我们想要的输出令牌的位置。</p><p id="17cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的输出中，我们可以看到gpt2模型如何在不同的层中给出不同的等级，在最后一层(即第5层)中，job被给予第2等级，name被给予第8等级。</p><p id="c668" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在gpt2的帮助下，我们可以生成不止一个单词。让我们用另一个例子来验证一下，这里我们将生成5个单词。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="7cf5" class="jl jm hh jh b fi jn jo l jp jq">text = " Heathrow airport is located in"</span><span id="036d" class="jl jm hh jh b fi jr jo l jp jq">output_2 = lm.generate(text, generate=5, do_sample=False)</span><span id="8b6f" class="jl jm hh jh b fi jr jo l jp jq"><strong class="jh hi">Output<br/></strong>Heath row airport is located in <strong class="jh hi">&gt;&gt; the heart of the city</strong></span></pre><p id="4149" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">借助rankings()函数，我们可以可视化所有层中每个输出的排名。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="ced0" class="jl jm hh jh b fi jn jo l jp jq">output_2.rankings()</span></pre><figure class="jc jd je jf fd jt er es paragraph-image"><div class="er es kf"><img src="../Images/edadab08bfc003c14a567b55ccd09794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ffaq499GlLT_b7yTQsVmyQ.png"/></div></figure><p id="c275" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du kg kh ki jh b">saliency()</code>可视化显示了哪些标记对生成每个输出标记贡献最大(使用渐变X输入法)。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="83d7" class="jl jm hh jh b fi jn jo l jp jq">output_2.saliency()</span></pre><figure class="jc jd je jf fd jt er es paragraph-image"><div class="er es kj"><img src="../Images/a7f8e0c74a1bb55916ffa5d326c31969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*C7MXr3JFZNJztQX9vkEsPw.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">这是用于生成<strong class="bd kk">的</strong>令牌的贡献</figcaption></figure><figure class="jc jd je jf fd jt er es paragraph-image"><div class="er es kl"><img src="../Images/49198c153d07bf1e4c45aecc40926188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*t2Y17cYW_KXMzxuZtb1WNg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">这是生成<strong class="bd kk">心脏</strong>令牌的贡献</figcaption></figure><figure class="jc jd je jf fd jt er es paragraph-image"><div class="er es km"><img src="../Images/26cb53c4c8761ae81025aa2235aa72bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*P7dE0jCw8Ht1wGezdrPUMg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">这是生成令牌<strong class="bd kk">的贡献</strong></figcaption></figure><figure class="jc jd je jf fd jt er es paragraph-image"><div class="er es kn"><img src="../Images/d9920ad0740fc8ef83ed813d550b0549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*an9Aa94FKoLOLYBW_VGtpg.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">这是对生成<strong class="bd kk">令牌</strong>的贡献</figcaption></figure><p id="b497" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">深色表示贡献较大，浅色表示贡献较小。</p></div></div>    
</body>
</html>