# 创建一个 T20 预测 Twitter 机器人 1/2

> 原文：<https://medium.com/analytics-vidhya/creating-a-t20-prediction-twitter-bot-1-2-591a992e8694?source=collection_archive---------14----------------------->

## 使用历史 T20 比赛数据创建一个在 Twitter 上发布预测的获胜预测机器人

![](img/c05c5c63d9017ee87013b6fa8b0f2b17.png)

照片由 [Ajay Parthasarathy](https://unsplash.com/@ajayparthasarathy)

这是 2 部分系列的第 1 部分，讨论了我如何制作一个 Twitter 机器人来预测谁将赢得 T20 比赛。在第一部分，我们将讨论机器人的机器学习方面，从获取数据，转换数据，训练模型。在第二部分中，我们将讨论 Twitter 机器人，它如何获得比赛数据，并实时发布预测。

# 板球热

我对板球的热情仍然空前高涨，巴基斯坦超级联赛让我成为了一名疯狂的板球迷。在一个球接一个球地删除了所有以前 PSL 赛季的数据(你可以在这里阅读)然后运行一些基本的数据分析并在数据集上创建可视化(你可以在这里阅读)之后，我想对数据集做更多的事情。然后我突然想到，为什么不训练一个模型来预测一个团队赢得比赛的可能性。

# 动机

观看板球比赛的人会知道，大多数现代广播都有一个获胜预测器，可以预测某个队获胜的概率。在 PSL 的广播中看到这样一个预测器，让我想到自己做一个

# 放弃

我做的预测器非常简单。它没有考虑到很多对比赛有巨大影响的因素，如场地、球场、天气、球员状态和球队。它只看需要多少次跑垒，有多少个球在手，有多少个三柱门倒下了。由于我繁忙的日程安排，制作一个更详细的预测器实际上是不可行的，我对制作的整个过程比对实际结果更感兴趣。

# 数据集

我想教给我的模型的是，给定一个特定的场景，追逐的团队获胜的几率是多少。为此，我需要比赛的一个球一个球的数据，这样我就可以知道第二局的任何一个球，比分是多少，以及追赶的球队是否赢了。

我从我自己废弃的 PSL 数据集开始([链接](/swlh/pakistan-super-league-data-set-6b04f15cb86c)到帖子)。这包含了 PSL 所有比赛两局的每一个球的细节。我在这个数据集上训练了第一个模型，但是由于 PSL 相对较新，每个赛季最多有 34 场比赛，这个数据集太小了(总共 33962 行)。

![](img/5f96c9082aeb624e66b694f934d441eb.png)

接下来，我决定寻找另一个数据集。我在 Kaggle 上偶然发现了这个数据集，它包含了印度超级联赛每场比赛的每一个球的细节。IPL 已经运行了超过 10 年，拥有比 PSL 多得多的球队和赛季比赛。这给了我一个足够的数据集(179080 行)。

![](img/e767dc9ed7fdf2f84bce76fe51338c11.png)

# 转换数据集

为了解决机器学习问题，第一步是收集数据集，下一步是清理数据集并将其转换为可以输入到机器学习算法中的形式。现在有了下载的数据，我需要转换它。

预测者只会在比赛的第二局，当目标已经设定，追球队已经开始击球时，才做出预测。我的数据集包含了两局的一个球一个球的数据。它也不包含目标。此外，IPL 数据集不包含在他们的逐球数据集中谁赢得了比赛的值。

第一步是计算每场比赛的第一局总数，这将给出第二队必须追逐的目标。有了熊猫，我们很容易做到这一点。

我们首先生成一个只包含第一局数据的数据帧。然后，我们根据匹配 id 进行分组，并通过求和来聚合运行列

```
first_inning_total = first_inning.groupby("match_id").agg(
    target = ("total_runs","sum")
)
```

这将合计每场比赛的第一局得分，并给出第一局的总得分，这是第二队必须追逐的目标。

IPL 数据集带有两个表，一个球一个球的细节表和一个比赛汇总表。谁赢了这场比赛在比赛汇总表中给出了。因此，通过在 match_id 上连接两个表，我们能够获得每场比赛的获胜者姓名以及每场比赛的详细信息。

现在我们有了目标，第二局的一个球一个球的数据，以及谁赢了这场比赛。我们只需应用一些更简单的特定于数据集的转换来计算诸如倒下的三柱门数、得分、目标数、得分次数和剩余球数等，我们的数据集就准备好了。(所有代码都在 GitHub 上，链接在本文末尾)

通过结合 IPL 和 PSL 数据集，仅保留第二局数据，我们最终得到 102560 行，我们可以在其上训练我们的模型。

![](img/f108e1da36bedb3d6471ec47808d5cb9.png)

数据集的最终形式

# 特征

正如你在上面的图像中看到的，我们只是使用`wickets` `balls_left`和`runs_left`作为模型的特征。在一个合适的模型中，我们会有更多的功能。谁在球场上，谁在打保龄球，球场类型，天气，两队的状态等等？可用功能的可能性相当大，这是一个基于简单功能的非常简单的机器人。

最初，我训练的第一个模型也使用了更多的功能。特征集包括`runs_scored,` `overs,` `ball,`和`target`。我在这些功能上训练的模型在现实生活中的表现并不是很好。尽管测试集的准确率超过 80%，但在现实生活中，该模型并没有做出很好的预测。模型被三柱门动摇了很多，即使在最后 5 个三柱门关闭的情况下需要 5 次运行，模型也预测保龄球队会赢。如果你把三柱门从 5 个改成 4 个，模型会预测击球方会赢。似乎这个模型已经了解到，wicket 数越高，获胜的机会越低，但它似乎没有了解目标和得分之间的关系。所以我决定简化特征。我没有使用 target 和 score 作为独立的特性，而是使用了 runs left(通过从 target 中减去 score)来代替 over 和 balls，我使用了 balls_left 特性。

有了这些新功能，该模型在现实生活条件下似乎表现得更好。该模型能够理解，左跑垒越低，球队击球获胜的机会就越大。另一方面，如果击球队有更多的剩余球，他们获胜的概率更高。而倒下的三柱门会降低你的胜率。该模型能够理解所有这些特征以及它们之间的关系。

所以通过使用更小更简单的特征，我们的模型能够执行建模。

# 训练模型

这个问题可以简化为简单的二元分类。我们只需要知道追的那队到底赢没赢。所以我们可以简单的预测 0 或者 1，0 是球队输了，1 是球队赢了。

第一步是将我们的数据集分为 X 和 y，其中 X 是特征，y 是结果。

```
y = full_df.iloc[:,3]
X = full_df.iloc[:,:3] 
```

下一步是将数据集分成测试集和训练集。

```
X_train, X_test, y_train, y_test = train_test_split(
    X,
    y,
    test_size=0.2,
    random_state=42)
```

对于算法，由于这是一个简单的二进制分类，我只是决定使用随机森林分类器。
所以训练可以用下面的代码运行

```
RF = RandomForestClassifier(n_estimators=10000, max_depth=6, random_state=0)
RF.fit(X_train, y_train)
```

这将在数据集上运行训练。培训很快，在我的笔记本电脑上花了 3 分多钟。

一旦模型被训练，我们可以在我们的测试数据集上评估它。

```
y_pred_test = RF.predict(X_test)
accuracy_score(y_test, y_pred_test)
```

我们得到了 0.77 的分数，这对于这样一个基本模型来说已经足够好了。

# 估价

要获得预测，我们所要做的就是向它传递一个数据帧，其中的每一行都包含我们训练模型所依据的特征，并在模型文件上调用 predict 方法。

```
current= {
    "wickets":1,
    "balls_left" :105,
    "runs_left":137
}
current_df = pd.DataFrame(current,index=[0])
RF.predict(current_df)
```

predict 方法返回模型预测的标签(在我们的例子中是 0 或 1)，但是我们想要预测获胜的百分比机会，所以我们可以使用“predict_proba”方法，这将返回任何一个标签成为结果的概率。

```
RF.predict_proba(current_df)
array([[0.41718799, 0.58281201]
```

这基本上意味着有 41%的机会球队击球会输(或第一队会赢)和 58%的机会它会赢。因此，基于这些结果，我们可以很容易地做出我们的百分比预测。

# 真实生活结果

我的预测器(和 Twitter 机器人一起)已经运行了好几天，并且已经在所有的 T20 直播比赛中做出了预测。老实说，我对预测的准确性感到非常惊讶。现在预测一场板球比赛，特别是 T20 比赛并不容易，即使有大数据集，复杂的模型和各种各样的特征，你也无法考虑阿夫里迪何时会发狂，并独自赢得一场输掉的比赛。我更感兴趣的是我的预测者对比赛变化的反应。基于比赛的当前情况，它可以做出正确的预测，即使由于一些改变比赛的性能，预测可能不会持续到比赛结束。

基于这些指标，我的预测器实际上表现得相当好。对于给定的场景，它做出了合理的预测。如果追赶队得分很好，手里有三柱门，它将做出正确的预测，追赶队有更高的获胜概率。

![](img/6d0d0600613e4bf9eb493f04bc07077f.png)

另一方面，如果目标很高，并且追赶的团队已经失去了早期的三柱门，板上没有多少分数，那么它将正确地预测保龄球团队有更高的获胜机会

![](img/cec28b80d74060abf71c3dfb0b94ce63.png)

它也很好地迎合了不断变化的场景。如果追逐队需要在 11 个球中跑 25 次，已经失去了 5 个三柱门，它预测保龄球队获胜的机会稍高

![](img/047dc242c4f615700cbec758845dca62.png)

但是如果 Wahab Riaz 突然决定击中 Steyn 两个巨大的 6，使目标触手可及，它也会很快调整它的预测。

![](img/a85da5872ad1c0ad064cb5351aa4b763.png)

在预测器运行的多个匹配中，结果非常突出。预测器可以很好地适应不断变化的场景，并且预测是基于当前情况的。稍加调整并使用更复杂的算法，我们可能会实现更好的预测

# 下一部分

在本系列的下一部分，我们将讨论我如何创建一个 Twitter 机器人，它等待比赛开始，获得分数，然后做出预测并发布消息。一旦贴出来了，我会把它链接到这里

感谢您阅读这篇文章，如果您有任何问题，请随时通过我的 LinkedIn 或 Twitter 联系我

# 链接

PSL 数据集:[https://www . ka ggle . com/hassanj 576/Pakistan-super-league PSL-ball-by-ball-2016 20 20](https://www.kaggle.com/hassanj576/pakistan-super-leaguepsl-ball-by-ball-20162020)

IPL 数据集:[https://www . ka ggle . com/Patrick b 1912/IPL-complete-dataset-2008 2020](https://www.kaggle.com/patrickb1912/ipl-complete-dataset-20082020)

转化训练代码:[https://github.com/hassanj-576/t20_predictor](https://github.com/hassanj-576/t20_predictor)

我的 LinkedIn:【https://www.linkedin.com/in/shjalil/】T2

我的推特:@hj576