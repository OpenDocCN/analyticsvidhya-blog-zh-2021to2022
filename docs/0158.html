<html>
<head>
<title>Adventure works Lite SQL to Parquet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Adventure works Lite SQL to Parquet</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/adventure-works-lite-sql-to-parquet-ef2cbf8b84d7?source=collection_archive---------21-----------------------#2021-01-06">https://medium.com/analytics-vidhya/adventure-works-lite-sql-to-parquet-ef2cbf8b84d7?source=collection_archive---------21-----------------------#2021-01-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="af79" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">将Azure SQL数据库迁移到parquet格式以进行spark处理</h1><h1 id="3667" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">创建Azure SQL示例数据库</h1><ul class=""><li id="81e7" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建一个名为sqldemo的资源组</li><li id="e915" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建新资源作为数据库</li><li id="259f" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择Azure SQL数据库</li><li id="0e0e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建名为db1的数据库</li><li id="019b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个名为db1servername的数据库服务器</li><li id="9d90" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将用户名创建为sqluser</li><li id="ab6e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建密码</li><li id="394e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择一个区域</li><li id="001e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在网络中选择允许azure服务访问数据库</li><li id="2e0c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在网络中，选择将客户端ip添加到防火墙</li><li id="4016" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在高级选择样本数据库中</li></ul><h1 id="96ad" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用Azure数据工厂迁移到ADLS gen2</h1><ul class=""><li id="a7c5" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">这里的想法是连接到Azure SQL并复制所有表</li><li id="2e79" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个链接服务作为我们上面创建的SQL的源</li><li id="554c" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个集成</li><li id="ad66" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">拖放查找</li><li id="7cef" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择adventure works LT数据库</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es jz"><img src="../Images/b50bbb7cb75e5879507a0f8146640a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fK4mPZGyODCflDlt.jpg"/></div></div></figure><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="f8c0" class="kq if hh km b fi kr ks l kt ku">select Table_schema, Table_name from information_schema.tables where table_type ='BASE TABLE'</span></pre><ul class=""><li id="1d70" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">确保未选择第一行</li><li id="e201" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在拖放每个</li><li id="ad31" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在“设置”选项卡中</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es la"><img src="../Images/c7f7f78a46a62d77b8f3df8029c69f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GH7KZoAc9gexrQzp.jpg"/></div></div></figure><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="771c" class="kq if hh km b fi kr ks l kt ku">@activity('GetTables').output.value</span></pre><ul class=""><li id="385a" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">现在单击该活动并创建一个新的</li><li id="9a57" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">将活动命名为ExportToParquet</li><li id="1c1e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择源作为Adventure works SQL数据库</li><li id="c9cb" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择水槽作为ADLS第二代，带parguet</li><li id="89a4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择使用查询</li></ul><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lb"><img src="../Images/ed8ee326349e70e150f47ba086dde539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IJw1AyjnSyzACH3Z.jpg"/></div></div></figure><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="c978" class="kq if hh km b fi kr ks l kt ku">@concat('select * from ',item().Table_Schema,'.',item().Table_Name)</span></pre><ul class=""><li id="b7d0" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">选择接收器</li><li id="9dfc" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">作为数据集属性</li></ul><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="6d81" class="kq if hh km b fi kr ks l kt ku">@concat(item().Table_Schema,'_',item().Table_Name)</span></pre><ul class=""><li id="809c" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">现在，在ADLS第二代实木复合地板的数据集属性中</li><li id="b05e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">打开并在文件路径中</li></ul><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="aae7" class="kq if hh km b fi kr ks l kt ku">@{formatDateTime(utcnow(),'yyyy')}/@{formatDateTime(utcnow(),'MM')}/@{formatDateTime(utcnow(),'dd')}/@{concat(dataset().FileName,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.parquet')}</span></pre><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es lc"><img src="../Images/f5a50b21e2f33285dcd793e6a79eb699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GPW88wuESyPnYta_.jpg"/></div></div></figure><ul class=""><li id="ac69" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">请务必记下网址</li><li id="33cd" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">全部提交</li><li id="336b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建拉式请求</li><li id="bd33" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">合并更改</li><li id="f245" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">然后切换到主分支</li><li id="f545" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">单击发布</li><li id="5a22" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">现在打开集成管道，单击添加触发器并选择立即触发</li></ul><h1 id="b9c7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用笔记本设置spark数据库和表格</h1><ul class=""><li id="3094" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建笔记本</li><li id="c5fa" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在一个单元格中更改为c#</li><li id="41ec" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">首先创建数据库</li></ul><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="acaa" class="kq if hh km b fi kr ks l kt ku">spark.Sql("CREATE DATABASE adventureworkslt")</span></pre><ul class=""><li id="a585" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">让我们创建spark表(托管表)</li><li id="cd38" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">确保拼花文件的名称</li><li id="d28e" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建客户表</li></ul><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="6cf0" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.customer USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_Customer_20201229.parquet '")</span></pre><p id="01f0" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建地址表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="b5e8" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.address USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_Address_20201229.parquet '")<br/></span></pre><p id="767d" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建customeraddress表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="e314" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.customeraddress USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_CustomerAddress_20201229.parquet '")</span></pre><p id="349b" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建产品表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="bdf0" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.product USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_Product_20201229.parquet '")</span></pre><p id="e5bd" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建产品类别表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="c73f" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.productcategory USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductCategory_20201229.parquet '")</span></pre><p id="12e7" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建产品描述表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="d8df" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.productdescription USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductDescription_20201229.parquet '")</span></pre><p id="8982" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建产品模型</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="f5e0" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.productmodel USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductModel_20201229.parquet '")</span></pre><p id="e005" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建产品模型产品描述</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="3ffe" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.productmodelproductdescription USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductModelProductDescription_20201229.parquet '")</span></pre><p id="fca4" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建销售订单详细信息表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="bdd5" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.salesorderdetail USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_SalesOrderDetail_20201229.parquet '")</span></pre><p id="7765" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">创建销售订单标题表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="d59a" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>spark.sql("CREATE TABLE IF NOT EXISTS adventureworkslt.salesorderheader USING Parquet LOCATION 'abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_SalesOrderHeader_20201229.parquet '")</span></pre><p id="a3a0" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated">验证几个表</p><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="ea22" class="kq if hh km b fi kr ks l kt ku">%%pyspark<br/>display(spark.sql("select * from adventureworkslt.customer"))</span><span id="35a0" class="kq if hh km b fi ls ks l kt ku">%%pyspark<br/>display(spark.sql("select * from adventureworkslt.customeraddress"))</span><span id="a162" class="kq if hh km b fi ls ks l kt ku">%%pyspark<br/>display(spark.sql("select * from adventureworkslt.product"))</span><span id="ee4b" class="kq if hh km b fi ls ks l kt ku">%%pyspark<br/>display(spark.sql("select * from adventureworkslt.productmodel"))</span><span id="0bab" class="kq if hh km b fi ls ks l kt ku">%%pyspark<br/>display(spark.sql("select * from adventureworkslt.salesorderdetail"))</span><span id="8f55" class="kq if hh km b fi ls ks l kt ku">%%pyspark<br/>display(spark.sql("select * from adventureworkslt.salesorderheader"))</span></pre><h1 id="4967" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">使用笔记本并将相同的数据加载到scala处理的数据帧中</h1><ul class=""><li id="4680" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">创建笔记本</li><li id="ecbf" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择scala</li><li id="d237" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">选择火花池</li><li id="8506" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">加载数据</li></ul><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="77e7" class="kq if hh km b fi kr ks l kt ku">val customerDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_Customer_20201229.parquet ")<br/>val addressDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_Address_20201229.parquet ")<br/>val customeraddressDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_CustomerAddress_20201229.parquet ")<br/>val productDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_Product_20201229.parquet ")<br/>val productcategoryDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductCategory_20201229.parquet ")<br/>val productdescriptionDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductDescription_20201229.parquet ")<br/>val productmodelDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductModel_20201229.parquet ")<br/>val productmodeldescriptionDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_ProductModelProductDescription_20201229.parquet ")<br/><br/>val salesorderdetailDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_SalesOrderDetail_20201229.parquet ")<br/>val salesorderheaderDF = spark.read.parquet("abfss://containername@storagename.dfs.core.windows.net/adventureworkslt/2020/12/29/SalesLT_SalesOrderHeader_20201229.parquet ")</span></pre></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><ul class=""><li id="ed27" class="jc jd hh je b jf kv jh kw jj kx jl ky jn kz jp jq jr js jt bi translated">显示并验证数据帧是否已加载</li></ul><pre class="ka kb kc kd fd kl km kn ko aw kp bi"><span id="240f" class="kq if hh km b fi kr ks l kt ku">display(customerDF)</span></pre><p id="bde9" class="pw-post-body-paragraph ld le hh je b jf kv lf lg jh kw lh li jj lj lk ll jl lm ln lo jn lp lq lr jp ha bi translated"><em class="ma">最初发表于</em><a class="ae mb" href="https://github.com/balakreshnan/synapseAnalytics/blob/master/synapseworkspace/advworkssetup.md" rel="noopener ugc nofollow" target="_blank"><em class="ma">【https://github.com】</em></a><em class="ma">。</em></p></div></div>    
</body>
</html>