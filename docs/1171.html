<html>
<head>
<title>Time-series Auto-correlation Vs Partial Auto Correlation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列自相关与部分自相关</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/time-series-auto-correlation-vs-partial-auto-correlation-7ca55f9fd6e2?source=collection_archive---------13-----------------------#2021-02-17">https://medium.com/analytics-vidhya/time-series-auto-correlation-vs-partial-auto-correlation-7ca55f9fd6e2?source=collection_archive---------13-----------------------#2021-02-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8d2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不是只为自己写笔记的博客:)</p><p id="55e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">问题陈述:我们有一只股票的月度数据，我们将通过比较前几个月的价格来预测这只股票的月平均价格，因此在此之前，我们需要了解预测变量与因变量/产出的相关程度</p><p id="e225" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我们的情况的符号</p><p id="f407" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sti =本月的股票价格</p><p id="aa88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sti _ 1 =上个月的股票价格</p><p id="9936" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sti _ 2 =个月前的股票价格</p><blockquote class="jc jd je"><p id="bec9" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">时间序列中最重要的概念是，它帮助我们根据过去的经验(价值)预测变量(股票)的未来行为</p></blockquote><p id="d107" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们的情况下，当我们有2个预测变量Sti_1和Sti_2时，我们必须找到Sti(输出)的值</p><p id="00aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了检查预测变量是否能帮助我们预测值，我们必须检查它们之间的相关性</p><p id="c98f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们看看股票MSFT每月的收盘价</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jj"><img src="../Images/e42e82d9712bea8378befaff1db8110a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*G0EYPLFEFtjoO136hxQRGA.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">MSFT过去3个月的价格</figcaption></figure><p id="df2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以我们必须找出当月价格和两个月前价格之间的相关性。在符号形式中，我们必须找到CoRR(Sti_2，Sti)</p><p id="769d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一种方法是找出它们Sti_2，Sti之间的ACF(自相关)</p><p id="c2af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用<em class="jf"> pearsonr() </em> SciPy函数来计算皮尔逊相关系数</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="a154" class="ke kf hh ka b fi kg kh l ki kj">import pandas as pd<br/>import pandas_datareader.data as web</span><span id="2934" class="ke kf hh ka b fi kk kh l ki kj">data = web.get_data_yahoo('MSFT','01/31/2019','01/31/2021',interval='m')</span><span id="5367" class="ke kf hh ka b fi kk kh l ki kj">corr_data = pd.DataFrame(data.Close,index=data.index)<br/>corr_data['t_2'] = corr_data['Close'].shift(2)<br/>corr_data.dropna(inplace=True)</span><span id="b5c5" class="ke kf hh ka b fi kk kh l ki kj">from scipy.stats import pearsonr<br/>corr,_= pearsonr(corr_data.t_2,corr_data.Close)<br/>print('Pearsons correlation: %.3f' % corr)<br/>Pearsons correlation: 0.942</span></pre><p id="3045" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从理论上讲，自相关(ACF)包括两个因素</p><ol class=""><li id="08c2" class="kl km hh ig b ih ii il im ip kn it ko ix kp jb kq kr ks kt bi translated">直接影响(直接路线)</li><li id="4a53" class="kl km hh ig b ih ku il kv ip kw it kx ix ky jb kq kr ks kt bi translated">间接影响(间接途径)</li></ol><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es kz"><img src="../Images/bf811f201c39408234eaaab772ef2989.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Coxyj9PK1A_uAnxAM2HGhg.png"/></div></div></figure><p id="8bd2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sti_2价格对Sti_1价格有某种<strong class="ig hi">直接影响</strong>同样，Sti_1价格对Sti有某种直接影响。因此，我们可以说Sti_2通过Sti_1对Sti价格有一些<strong class="ig hi">间接影响</strong>，但是Sti_2价格对Sti价格也有一些直接影响。</p><p id="0e78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(在实际情况下，这些影响可能是由各种原因引起的，这些原因与MSFT公司对其产品的决策或管理层在市场上推出新产品有关)</p><p id="e0db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以这两个分量构成了自相关函数</p><p id="ce61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如我们看到的皮尔逊相关:0.942相当高，这是因为间接效应成分，我们不能保证Sti_2是Sti的良好预测因子</p><p id="8909" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以为了找到它们之间的直接关系，我们使用偏相关</p><p id="0867" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在偏相关中，它只关注Sti_2价格(预测变量)对Sti(产出)的直接影响</p><p id="cf4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为此，我们建立了一个回归模型</p><p id="ab11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">St =φ21 St _ 1+φ22 St _ 2+εt</p><p id="cbe6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，系数φ22给出了St_2对St的直接影响(即k =2的Pacf)</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="b82b" class="ke kf hh ka b fi kg kh l ki kj">linReg = LinearRegression(fit_intercept=True)<br/>linReg.fit(corr_data[['t_1','t_2']], corr_data.Close)<br/>loadings = np.insert(linReg.coef_, 0, linReg.intercept_)<br/>out = pd.DataFrame(loadings, columns=['regression model'])<br/>out = out.transpose()<br/>fullNames = ['Intercept'] + ['t_1','t-2']<br/>out.columns = fullNames</span></pre><figure class="jk jl jm jn fd jo er es paragraph-image"><div class="er es la"><img src="../Images/e3f1ac0b2d79e6736d73781c2b1f4d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*Y9woQuCckSRNaq4lQX1jhg.png"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">我们的回归模型截距和系数</figcaption></figure><p id="e23c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以我们的St_2和St价格之间的直接相关性是0.243278</p><p id="3f52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">计算部分相关的另一种方法</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div class="er es lb"><img src="../Images/3e50dc8b1f650f8f678ded720b50d83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*Ksl-XBfmWl3N5n4d_NuQnQ.png"/></div></figure><p id="a1fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae lc" href="https://towardsdatascience.com/understanding-partial-auto-correlation-fa39271146ac" rel="noopener" target="_blank">理解部分自相关|通过Sachin数据|走向数据科学</a></p><p id="23ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">总结(直接来自博客)</strong></p><p id="0e5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ti <em class="jf"> _2 </em>的变化有多少没有被Ti <em class="jf"> _1) </em>的变化所解释我们做两件事:</p><ol class=""><li id="db93" class="kl km hh ig b ih ii il im ip kn it ko ix kp jb kq kr ks kt bi translated"><strong class="ig hi">第一步:</strong>我们用线性回归模型(即直线)拟合<em class="jf"> T i(现价)</em>对<em class="jf"> Ti_1 </em>的分布。这个线性模型将让我们从<em class="jf">t1)</em>预测<em class="jf"> Ti(当前价格)</em>。从概念上讲，这个线性模型允许我们将<em class="jf"> T </em>的方差解释为<em class="jf"> Ti_1 </em>的方差的函数。但是像所有最佳拟合模型一样，我们的模型不能解释所有的<em class="jf"> Ti </em>的变化。这个事实把我们带到了第二步。</li><li id="8a1d" class="kl km hh ig b ih ku il kv ip kw it kx ix ky jb kq kr ks kt bi translated"><strong class="ig hi">第二步:</strong>在这一步中，我们计算在第一步中建立的线性模型的残差。残差是<em class="jf"> Ti </em>的观测值与模型预测值之差。我们对<em class="jf"> Ti </em>的每个值进行残差计算，以获得残差的时间序列。这个残差时间序列给了我们想要的东西。它给出了无法用<em class="jf"> Ti-1 </em>的方差来解释的<em class="jf"> Ti </em>的方差，当然还有一些噪声。</li></ol><p id="1be6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了计算相关性中的第二个变量，即<em class="jf"> Ti_2) </em>中无法用<em class="jf"> Ti_1) </em>中的方差来解释的方差，我们在<em class="jf"> Ti_2 </em>和<em class="jf"> Ti-1 </em>的上下文中执行上述步骤1和2，而不是分别在<em class="jf"> Ti </em>和<em class="jf"> Ti_1) </em>的上下文中执行。这给了我们寻找变量2的残差序列。</p><p id="8d4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后一步是将皮尔逊相关系数公式应用于这两个残差时间序列。</p><pre class="jk jl jm jn fd jz ka kb kc aw kd bi"><span id="de34" class="ke kf hh ka b fi kg kh l ki kj">c<em class="jf">orr_data = pd.DataFrame(data.Close,index=data.index)<br/>corr_data['t_1'] = corr_data['Close'].shift(1)<br/>corr_data['t_2'] = corr_data['Close'].shift(2)</em></span><span id="d5b0" class="ke kf hh ka b fi kk kh l ki kj"><em class="jf">corr_data.dropna(inplace=True)<br/>from sklearn.linear_model import LinearRegression<br/>linReg = LinearRegression(fit_intercept=True)</em></span><span id="f8f2" class="ke kf hh ka b fi kk kh l ki kj"><em class="jf">model = linReg.fit(corr_data[['t_1']],corr_data.Close)</em></span><span id="7eae" class="ke kf hh ka b fi kk kh l ki kj"><em class="jf">corr_data['Predicted_Close|T_1'] =linReg.predict(corr_data[['t_1']])</em></span><span id="fa4b" class="ke kf hh ka b fi kk kh l ki kj"><em class="jf">corr_data['Residuals_Close|T_1'] = corr_data['Close'] -corr_data['Predicted_Close|T_1']</em></span><span id="50a6" class="ke kf hh ka b fi kk kh l ki kj"><em class="jf">model = linReg.fit(corr_data[['t_1']],corr_data[['t_2']])</em></span><span id="ed2e" class="ke kf hh ka b fi kk kh l ki kj"><em class="jf">corr_data['Predicted_t_2|t_1'] = linReg.predict(corr_data[['t_1']])<br/>corr_data['Residuals_t_2|t_1'] = corr_data['t_2'] - corr_data['Predicted_t_2|t_1']</em></span><span id="e1cd" class="ke kf hh ka b fi kk kh l ki kj">corr, _= pearsonr(corr_data['Residuals_Close|T_1'],corr_data['Residuals_t_2|t_1'])<br/>corr<br/>0.23979474295389985</span></pre></div></div>    
</body>
</html>