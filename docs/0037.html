<html>
<head>
<title>Creating a Stock Price Tracker with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python创建股票价格跟踪器</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/creating-a-stock-price-tracker-with-python-6c68035b98bd?source=collection_archive---------7-----------------------#2021-01-02">https://medium.com/analytics-vidhya/creating-a-stock-price-tracker-with-python-6c68035b98bd?source=collection_archive---------7-----------------------#2021-01-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="fa15" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">构建一个Python脚本，在你最喜欢的股票价格下跌时向你发送电子邮件。</h2></div><p id="83f2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个故事中，我们将使用Python 创建一个<strong class="iy hi">股票价格跟踪器。也就是说，每当特定股票的价格低于我们的估价阈值时，Python脚本就会向我们发送一封电子邮件。</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/cad849a2c468f02ecb5c51f11ac36dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SHS4wkNsY5VQkdD-"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">巴拉克·K在Pexels.com<a class="ae ki" href="https://www.pexels.com/photo/space-grey-ipad-air-with-graph-on-brown-wooden-table-187041/" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></figcaption></figure><h1 id="fe30" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">苹果股票价格跟踪器</h1><p id="f70d" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">为了用Python 构建<strong class="iy hi">股票价格跟踪器，我们将跟踪苹果的价格。当价格低于预定义的阈值时，脚本会向我们的Gmail帐户发送一封电子邮件，让我们知道价格下降。</strong></p><p id="32ba" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这在<strong class="iy hi">我们已经为一只股票</strong>设定了目标价格，并且我们希望在价格跌至该水平时得到通知的情况下特别有用。</p><p id="cb5a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我会把下面的代码放在一块。这样做的原因是代码相当简单。我们将使用<em class="lg"> financialmodelingprep </em>来请求我们想要跟踪的股票的实时报价。本例中，<em class="lg">苹果</em>。<strong class="iy hi">请注意</strong>您需要注册<a class="ae ki" href="https://financialmodelingprep.com/developer/docs/pricing/codingAndFun/" rel="noopener ugc nofollow" target="_blank"> financialmodelingprep </a>才能获得每月最多250个免费API请求的API密钥。</p><p id="7dec" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，我们将最新的股票价格与我们的价格阈值进行比较。在本例中，我定义了140美元的股票价格阈值。</p><p id="6b7b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果苹果的股价低于140美元，我们将触发发送电子邮件功能，向给定的帐户发送电子邮件。在下一节中，我将解释如何构建这样的函数。</p><h1 id="1a53" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">构建发送电子邮件功能</h1><p id="f8fe" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">发送电子邮件功能是我们配置代码向我们发送电子邮件的地方。为了实现这一点，我们将使用库<a class="ae ki" href="https://docs.python.org/3/library/smtplib.html" rel="noopener ugc nofollow" target="_blank"> smtplib </a>。</p><p id="5053" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用Smtplib，我们将:</p><ul class=""><li id="9717" class="lh li hh iy b iz ja jc jd jf lj jj lk jn ll jr lm ln lo lp bi translated">创建SMTP连接</li><li id="0875" class="lh li hh iy b iz lq jc lr jf ls jj lt jn lu jr lm ln lo lp bi translated">定义我们的消息、主题和收件人</li><li id="fa02" class="lh li hh iy b iz lq jc lr jf ls jj lt jn lu jr lm ln lo lp bi translated">并发送电子邮件</li></ul><p id="c43f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面的代码遵循smtplib文档创建连接并启动服务器。由于这是一个有点技术性的问题，我不会在这个故事中详细介绍SMTP连接是如何工作的。您可以查看文档以了解更多信息。</p><p id="bcf5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">重要的是<strong class="iy hi">在object<em class="lg">server . log in(‘你的Gmail’，‘你的密码’)</em>内传递你的Gmail账户和Gmail密码</strong>。在代码中，我的Gmail密码存储在<em class="lg">密码</em>变量中。</p><p id="3fef" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在<strong class="iy hi"> server.sendmail中，</strong>我们传递电子邮件和消息的收件人(即msg)。</p><p id="9908" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了让发送电子邮件功能发挥作用，<strong class="iy hi">我们需要去谷歌并激活我们账户中的<em class="lg">不太安全的应用访问</em> </strong>。否则，Gmail不会让Python代表你发邮件。要激活不太安全的应用程序访问，谷歌<em class="lg">不太安全的应用程序访问</em>并打开下面的链接。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/670775f4c297204a58a4edd1eab7b40b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IY_8C-pc7hbai2W0"/></div></div></figure><p id="016a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，确保以下选项被标记为on:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es lv"><img src="../Images/2fae4f2f427b931c2c0c7cfae893dff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/0*dJqEg71AGpogr1kl"/></div></figure><p id="4af0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了完成Python脚本，我们简单地包含了一个<em class="lg"> while循环</em>来确保<strong class="iy hi">脚本不间断地运行</strong>(你可以通过按ctrl/cmd + c来停止脚本)。这将确保Python每10分钟检查一次苹果公司的股票价格，看看股票价格是否有变动。这是通过行<em class="lg"> time.sleep(600) </em>实现的。</p><p id="cb22" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当我们运行代码时，股票价格低于140美元，我们将在Gmail帐户中收到一封电子邮件:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/2c4f101c0d2fe79de29788238635a75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pZFr_Ehaofw3_wFr"/></div></div></figure><p id="d85d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要查看运行中的代码，请随意观看下面的视频:</p><figure class="jt ju jv jw fd jx"><div class="bz dy l di"><div class="lw lx l"/></div></figure><h1 id="eb8f" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">包扎</h1><p id="6446" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">只需几行代码，我们就可以构建一个脚本，在我们最喜欢的股票价格下跌到预定水平时向我们发送电子邮件。</p><p id="f4c1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您可以进一步改进代码。例如，同时跟踪多只股票的价格。或者，你可以根据退货发送电子邮件，而不是根据价格发送电子邮件。</p><pre class="jt ju jv jw fd ly lz ma mb aw mc bi"><span id="2da0" class="md kk hh lz b fi me mf l mg mh">import requests<br/>import smtplib <br/>import time<br/><br/>api_key = 'asdfadsf adsf af'<br/>password= 'tesasdfdsafads' <br/><br/>def send_mail(password):<br/>  server = smtplib.SMTP('smtp.gmail.com', 587)<br/>  server.ehlo()<br/>  server.starttls()<br/>  server.login('codingandfun@gmail.com',password)<br/>  subject= 'test'<br/>  body = 'price down'<br/><br/>  msg= f'subject: {subject} {body}'<br/><br/>  server.sendmail(<br/>  'codingandfun@gmail.com',<br/>  'codingandfun@gmail.com',<br/>  msg<br/>  )<br/>  print('email is sent')<br/>  server.quit()<br/><br/><br/>def price_tracker(api_key,password):<br/>  prices = requests.get(f'https://financialmodelingprep.com/api/v3/quote/AAPL?apikey={api_key}').json()<br/>  stockPrice = prices[0]['price']<br/>  print(stockPrice)<br/>  if stockPrice &lt; 140:<br/>    send_mail(password)<br/> <br/>#run evrey 10 minutes<br/>while(True):<br/>  price_tracker(api_key,password)<br/>  time.sleep(600)</span></pre><p id="8c83" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">注意</strong>:所有帖子和视频仅用于教育目的。我们不提供财务建议。此外，我们不建议您买卖任何股票。您有责任在投资或交易任何证券之前进行尽职调查。</p></div><div class="ab cl mi mj go mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ha hb hc hd he"><p id="65d1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lg">原载于2021年1月2日https://codingandfun.com</em><a class="ae ki" href="https://codingandfun.com/creating-a-stock-price-alert-with-python/" rel="noopener ugc nofollow" target="_blank"><em class="lg"/></a><em class="lg">。</em></p></div></div>    
</body>
</html>