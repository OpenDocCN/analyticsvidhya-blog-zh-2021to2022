<html>
<head>
<title>Advanced SQL: Time Series Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级SQL:时间序列分析</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/advanced-sql-time-series-analysis-fd40eaa08fa3?source=collection_archive---------0-----------------------#2021-08-31">https://medium.com/analytics-vidhya/advanced-sql-time-series-analysis-fd40eaa08fa3?source=collection_archive---------0-----------------------#2021-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/06c85780eff7953b52be09396ad52b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xem1rbG0Fa8DAhtez7mvsA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">在<a class="ae iu" href="https://unsplash.com/s/photos/time-series?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae iu" href="https://unsplash.com/@aronvisuals?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Aron视觉</a>拍摄的照片</figcaption></figure><h2 id="d8ec" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">时间序列</h2><p id="0216" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">时间序列是一系列按时间顺序排列的数据点。最常见的是，时间序列是在连续的等间隔时间点取得的序列。因此，它是一个离散时间数据序列。</p><p id="f065" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">时间序列数据是数据点的序列。每个数据点包括一个时间戳。时间戳通常包括日期和时间。</p><p id="7187" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">时间序列分析包括用于分析时间序列数据的方法，以便提取有意义的统计数据和数据的其他特征。时间序列预测是使用模型根据以前观察到的值来预测未来值。</p><p id="b402" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">虽然回归分析常用于检验一个或多个不同时间序列之间的关系，但这种类型的分析通常不称为“时间序列分析”，时间序列分析特指单个序列中不同时间点之间的关系。</p><p id="b59f" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">时间序列用例</strong></p><ul class=""><li id="c802" class="kt ku hi jv b jw ko ka kp jg kv jk kw jo kx kn ky kz la lb bi translated">股票市场数据</li><li id="0ec4" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ky kz la lb bi translated">潮汐时间表</li><li id="c5d3" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ky kz la lb bi translated">性能监控</li><li id="f4f7" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ky kz la lb bi translated">健康监控</li><li id="24b3" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ky kz la lb bi translated">人口统计</li><li id="ed23" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ky kz la lb bi translated">经营成绩</li></ul><h2 id="f9b5" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">使用SQL(？)</h2><p id="8559" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">不知何故，Python或R是最常用和已知的进行深度时间序列分析的工具。但是，了解如何使用SQL处理时间序列数据是必不可少的。当处理非常大的数据集或不断更新的数据时，这一点非常重要。</p><p id="717a" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">作为数据科学家，我们已经知道SQL是处理数据集的流行语言之一。SQL是一种广为人知的、有良好文档记录的、富有表现力的查询语言，也是第三大流行的开发语言。组织也很容易采用其他工具并与之集成。由于这些原因，我相信SQL是处理时间序列数据的最佳语言之一。</p><p id="a1eb" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在这篇文章中，我们总结了一些我们喜欢使用SQL进行时间序列分析的技巧和原因，包括帮助您如何使用时间序列数据集的技术资源和指南。正如我之前所说，SQL很容易与其他工具集成。在这篇文章中，我不会使用MySQL Workbench。我更喜欢集成Python和MySQL服务器。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="b5ac" class="lo iw hi bd ix lp lq lr jb ls lt lu jf lv lw lx jj ly lz ma jn mb mc md jr me bi translated">时间序列数据集:超市</h1><p id="d4d1" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">我已经从Kaggle下载了时间序列数据集。你也可以在这里下载这个数据集:<a class="ae iu" href="https://www.kaggle.com/blurredmachine/superstore-time-series-dataset" rel="noopener ugc nofollow" target="_blank"> <em class="mf">超市时间序列数据集</em> </a>。在本帖中，我只使用<strong class="jv hj"> superstore_test.csv </strong>。</p><h1 id="cecf" class="lo iw hi bd ix lp mg lr jb ls mh lu jf lv mi lx jj ly mj ma jn mb mk md jr me bi translated">数据预处理</h1><p id="238d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在我们将这个数据集(<em class="mf"> superstore.csv </em>)导入到SQL Server之前，我们需要先做数据预处理。</p><ol class=""><li id="daa4" class="kt ku hi jv b jw ko ka kp jg kv jk kw jo kx kn ml kz la lb bi translated">使用日期格式转换订单数据和发货日期:<code class="du mm mn mo mp b">%Y-%m-%d %H:%M:%S</code></li><li id="f1dd" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated">重命名列名。在SQL中，列名不能有空格。所以我们需要用下划线来转换它。</li></ol><p id="8478" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">完成这些数据处理后，将其保存到新的csv文件中。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="44cb" class="lo iw hi bd ix lp lq lr jb ls lt lu jf lv lw lx jj ly lz ma jn mb mc md jr me bi translated">将CSV文件导入SQL Server</h1><p id="3130" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">本教程将指导您如何将<em class="mf"> superstore.csv </em>(数据预处理结果)导入SQL Server。本指南使用MySQL Workbench，并将一步一步地指导您。</p><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/573d96991389cd475522b9307a3a44a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sQrp8ZVc7t-pmV9fwackDw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">单击“新建架构”按钮，然后键入架构的名称。在这篇文章中，我使用“超级商店”的名称。</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/3cb6c62bf0594a75779f6fea40ef4810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7owgQHBqGHJY94Zay3aKQQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">点击“应用”</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div class="er es my"><img src="../Images/72e3a918fac91e662a180efd48747725.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*2gllkf5dNpASYhiIf3Iu6A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">右键单击“超级商店”模式，然后单击“表数据导入向导”</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/2074c50a49308b3bd7b31f24b9893a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dM9moOhEVbt72Z74QnLL2g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">数据预处理后，浏览你的CSV文件在哪里。然后，单击“下一步”。</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/190503b2daa1022a5278a0d85e462c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JNjW6AfBGPCbpNaTYABm4g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">单击“创建新表”。然后给出表格的名称。在这篇文章中，我将给出“超级商店”作为我的表的名称。</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/ea17bb1388da0d26e39289913e2b0838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAYmJnOnPYiB9R-GN0MoHg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">不要忘记更改“订单日期”和“发货日期”栏中的“文件类型”。然后点击“下一步”。</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/7eccdcd531307ec112f6a2f1a596405f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWk_G5LVWrtv9R0mNwgrUQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">就等着吧。完成后，点击“下一步”。</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/512cc23fd7dc289348d7e7fd99b9f31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5DTCcWoq4graXjOUZveLA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">看，导入了7762条记录。我们已经完成了。单击“完成”。</figcaption></figure><figure class="mq mr ms mt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/f8072e08d3180682229290045f21a268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tuULY-mja1tkw1R8x6PdQQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">尝试SELECT语句来查看新的“超级商店”表。</figcaption></figure><p id="d786" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">恭喜你。你的数据集准备好了。</p><p id="9206" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在这篇文章中，我不使用MySQL Workbench来分析时间序列数据。但是，我会使用Python MySQL连接器。怎么用？下面我来解释一下。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="fac8" class="lo iw hi bd ix lp lq lr jb ls lt lu jf lv lw lx jj ly lz ma jn mb mc md jr me bi translated">Python MySQL连接器</h1><p id="5116" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">MySQL连接器使Python程序能够访问SQL Server。首先，我们以Python函数的形式创建到SQL Server的连接。然后，使用该函数编写SQL查询。</p><blockquote class="ne nf ng"><p id="66c0" class="jt ju mf jv b jw ko jy jz ka kp kc kd nh kq kf kg ni kr ki kj nj ks kl km kn hb bi translated">生活是艰难的。不要让它变得更难。</p></blockquote><p id="4fa0" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">为了方便我们编写SQL查询，我们创建了一个函数。请参见下面的代码。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="c2be" class="lo iw hi bd ix lp lq lr jb ls lt lu jf lv lw lx jj ly lz ma jn mb mc md jr me bi translated">时间序列分析的常用函数</h1><p id="22aa" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">时间序列数据集已准备就绪。在笔记本上写SQL查询的函数迫不及待要用了。</p><p id="4e74" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">处理时间序列数据集需要一些SQL函数。我将引入领先，落后，等级和百分比等级作为你的新武器。</p><h2 id="c35c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">1.导致</h2><p id="a99d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">LEAD()是一个窗口函数，它提供对当前行之后指定物理偏移量处的行的访问。例如，通过使用LEAD()函数，您可以从当前行访问下一行的<strong class="jv hj">或下一行</strong>之后的<strong class="jv hj">行的数据，依此类推。</strong></p><p id="85b9" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">LEAD()函数对于比较当前行的值和下一行的值非常有用。</p><p id="1869" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在这个查询中，我们创建名为<em class="mf"> sales_lead </em>的新列。我们在<em class="mf"> sales_lead中使用LEAD来显示下一个销售值。</em>参见下面的完整查询。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="535a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">2.落后</h2><p id="7bb5" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">LAG()是一个窗口函数，它提供对当前行之前指定物理偏移量的行的访问。换句话说，滞后和超前是一样的，只是方向不同。</p><p id="bd09" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">通过使用LAG()函数，可以从当前行开始，访问<strong class="jv hj">前一行</strong>的数据，或者从当前行之前的<strong class="jv hj">第二行开始，以此类推。</strong></p><p id="de65" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在这个查询中，我们创建名为<em class="mf"> sales_lag </em>的新列。我们使用LAG在<em class="mf"> sales_lag中显示以前的销售额。</em>参见下面的完整查询。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="55c0" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">3.军阶</h2><p id="d956" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">RANK()函数是一个窗口函数，它为结果集分区内的每一行分配一个等级。分区中具有相同值的行将获得相同的等级。分区中第一行的秩是1。</p><p id="9a2b" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在下面的查询中，我们添加了名为<em class="mf"> sales_rank </em>的新列，以根据最大销售额(降序)创建排名。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="5797" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">4.百分比排名</h2><p id="c8af" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">PERCENT_RANK()实际上与排名函数具有相同的目标。但是，PERCENT_RANK计算结果集中各行的百分比排名。该函数返回一个百分位数，其范围从0到1。</p><p id="c83d" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">对于特定行，PERCENT_RANK()使用以下公式来计算百分比等级:</p><p id="8d89" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><code class="du mm mn mo mp b"><strong class="jv hj">(rank - 1) / (total_rows - 1)</strong></code></p><p id="84e9" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">根据这个公式，PERCENT_RANK()函数总是为结果集的第一行返回零。作为PERCENT_RANK输出，请参见下面的<em class="mf"> sales_rank </em>列。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="8ccc" class="lo iw hi bd ix lp lq lr jb ls lt lu jf lv lw lx jj ly lz ma jn mb mc md jr me bi translated">时间序列分析</h1><p id="1c78" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">如果工具箱里有很多工具来处理时间序列数据集就更好了。除了我之前提到的函数，我认为你还需要了解高级SQL查询:通用表表达式(CTE)和窗口函数。</p><p id="31a4" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">基本上，我们将在这个时间序列分析中使用CTE和窗口函数。我希望你们所有人从我这里得到更多的奖金，所以添加如何比较前值，移动平均线，和线性回归。</p><h2 id="eda4" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">1.公用表表达式(CTE)</h2><p id="468b" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">通用表表达式(CTE)允许您定义临时命名结果集。</p><p id="ea6c" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">该结果集在SELECT、INSERT、UPDATE、DELETE或MERGE等语句的执行范围内临时可用。CTE也可以在视图中使用。</p><p id="e626" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> a)月平均销售使用</strong>T1】</p><p id="864e" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">下面的查询使用CTE创建临时表来显示月平均销售额。为了改变日期格式，我们使用DATE_FORMAT()。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="9e43" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> b)月平均销售额使用</strong> <code class="du mm mn mo mp b"><strong class="jv hj">EXTRACT Function</strong></code></p><p id="2b59" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">这个查询实际上与前一个相同，但是我们使用不同的函数来操作日期格式。参见下面的查询，我们使用提取函数。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="9dd6" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">c)2014年至2017年期间的日平均销售额</strong></p><p id="2109" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">够清楚了。该查询将显示每日平均销售额。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="4ec8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> d)每月1日至31日的平均销售额</strong></p><p id="c582" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">很不一样。该查询将为您提供每个月第一天，第二天，第三天等销售平均值。参见下面的完整查询。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="6848" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">2.通过窗口函数计算聚合</h2><blockquote class="ne nf ng"><p id="6f9e" class="jt ju mf jv b jw ko jy jz ka kp kc kd nh kq kf kg ni kr ki kj nj ks kl km kn hb bi translated">窗口函数是使用一行或多行的值来使<strong class="jv hj">为每行</strong>返回一个值的函数。</p></blockquote><p id="cd04" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">这与聚合函数形成对比，聚合函数<strong class="jv hj">为多行返回单个值</strong>。</p><p id="e12e" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">窗口函数有一个OVER子句。请记住，任何没有OVER子句的函数都不是窗口函数，而是聚合函数或单行(标量)函数。</p><p id="86b1" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">窗口函数对一组行进行操作，并为每一行返回一个聚合值。而“窗口”术语描述了函数将在其上操作的数据库中的一组行。我们使用OVER()子句定义窗口(函数在其上操作的一组行)。</p><p id="b060" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">窗口功能类型:</strong></p><ol class=""><li id="2722" class="kt ku hi jv b jw ko ka kp jg kv jk kw jo kx kn ml kz la lb bi translated"><strong class="jv hj">聚合窗口函数</strong> <br/> SUM()，MAX()，MIN()，AVG()。计数()</li><li id="8ae5" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated"><strong class="jv hj">排名窗口函数</strong> <br/> RANK()，DENSE_RANK()，ROW_NUMBER()，NTILE()</li><li id="a1c5" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated"><strong class="jv hj">值窗口函数</strong> <br/> LAG()、LEAD()、FIRST_VALUE()、LAST_VALUE()</li></ol><p id="426e" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">日均利润使用</strong> <code class="du mm mn mo mp b"><strong class="jv hj">Aggregate Window Function</strong></code></p><p id="4c83" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">下面这个查询是聚合窗口函数的例子。我们用AVG()和OVER()来表示<em class="mf">日均利润</em>。使用“每日”术语是因为我们在PARTITION BY中使用了<em class="mf"> Order_Date </em>列。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="198e" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">3.前一天比较</h2><p id="075d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">如何比较日累计价值？在这个查询示例中，我们使用CTE将日平均折扣和日平均销售额与上一个进行比较。</p><p id="ca22" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">对比前一天的平均折扣</strong></p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="23b3" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">将平均销售额与前一天进行比较</strong></p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="158d" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">4.移动平均线</h2><p id="31d9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">移动平均是高级SQL用例。计算移动平均值有助于估计数据集中的趋势。移动平均值是一段时间内任何数字子集的平均值。移动平均线是一种用于分析和确定数据趋势的时间序列技术。</p><p id="bb98" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">有时移动平均线被称为滚动平均线、滚动平均线或移动平均线。该函数计算为每个时间点的当前值和指定数量的前一个值的平均值。</p><p id="6338" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">移动平均使用=窗口函数(OVER)函数+ ORDER BY()函数+ BETWEEN (……A……)。)和(……B……)。).</p><p id="fb26" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> A </strong>和<strong class="jv hj"> B </strong>可以通过以下方式填充:</p><ol class=""><li id="c4d9" class="kt ku hi jv b jw ko ka kp jg kv jk kw jo kx kn ml kz la lb bi translated"><strong class="jv hj">当前行</strong>:当前行或最新行</li><li id="fc23" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated"><strong class="jv hj">跟随</strong>:跟随/下一行</li><li id="10c2" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated"><strong class="jv hj">在</strong>之前:前一行</li><li id="8c72" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated"><strong class="jv hj">未绑定在</strong>之后:最后一行</li><li id="f27d" class="kt ku hi jv b jw lc ka ld jg le jk lf jo lg kn ml kz la lb bi translated"><strong class="jv hj">无界前置</strong>:第一行</li></ol><p id="28ba" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj">移动平均和利润汇总</strong></p><p id="482d" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在下面的查询中，我们创建了新的列:累计总利润和累计平均利润。正如我们在这个查询中看到的，移动平均使用聚合窗口函数(求和/AVG +结束)。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h2 id="48e5" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">5.线性回归预测</h2><p id="ce2b" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">线性回归是一种对因变量和自变量之间的关系进行建模的线性方法。一个独立变量的情况称为简单线性回归。</p><p id="9122" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在统计建模中，回归分析是一组统计过程，用于估计因变量(通常称为“结果”或“响应”变量)与一个或多个自变量(通常称为“预测值”、“协变量”、“解释变量”或“特征”)之间的关系。</p><p id="0856" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">回归分析最常见的形式是线性回归。这种回归会根据特定的数学标准找到最符合数据的直线(或更复杂的线性组合)。</p><p id="73c8" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">线性回归公式:</p><figure class="mq mr ms mt fd ij er es paragraph-image"><div class="er es nk"><img src="../Images/240a0d7a79856feaf9a3a90098aa85a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*BoiZs3X1ruF90yIn0o16cw.png"/></div></figure><p id="12ff" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> c =截距</strong> <br/> c是常数值——这部分函数不变。</p><p id="4dc5" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated"><strong class="jv hj"> m =坡度</strong> <br/> m是直线的坡度。</p><p id="1bfd" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">在这种情况下，<strong class="jv hj">折扣</strong>是特性或x变量。<strong class="jv hj">利润</strong>是目标值或y变量。首先，我们需要计算x轴和y轴，这是找到斜率和截距值所需要的。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="8bf2" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">第二步，使用此查询查找截距和斜率值。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="ee5f" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">最后，用斜率和截距值来显示利润趋势线。请参见此查询。</p><figure class="mq mr ms mt fd ij"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="167a" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">折价和趋势线利润的关系如何？看看这张散点图。我们给顾客的折扣越大，我们的利润就会越低。这很有意义。</p><figure class="mq mr ms mt fd ij er es paragraph-image"><div class="er es nl"><img src="../Images/deb82407a9c29f44e6abe7dc37c1274f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*u7TiLCkx_BXNntDi9X6w-g.png"/></div></figure><p id="90bb" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">那么，月盈利趋势线是怎样的呢？让我们看看这个线图。</p><figure class="mq mr ms mt fd ij er es paragraph-image"><div class="er es nm"><img src="../Images/bb1c445730527fa010cd06e9c4b401f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*EL9qBEHrz-ZO1eqVB2oyqg.png"/></div></figure></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><p id="1ffc" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">所以，高级SQL和查询示例中的函数都是如何分析时间序列数据集的。</p><p id="9b2e" class="pw-post-body-paragraph jt ju hi jv b jw ko jy jz ka kp kc kd jg kq kf kg jk kr ki kj jo ks kl km kn hb bi translated">感谢你阅读这篇文章。我希望您获得可操作的洞察力，并轻松地指导您分析您的数据集。在我的下一篇文章中再见。</p></div></div>    
</body>
</html>