<html>
<head>
<title>WordPress on AWS with High Availability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有高可用性的AWS上的WordPress</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/wordpress-on-aws-with-high-availability-35ec5732f1f6?source=collection_archive---------2-----------------------#2021-04-17">https://medium.com/analytics-vidhya/wordpress-on-aws-with-high-availability-35ec5732f1f6?source=collection_archive---------2-----------------------#2021-04-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="724c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">高可用性和容错解决方案</p><h1 id="e9fe" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">概观</h1><p id="4a90" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">每当您在云上运行基础架构时，您都希望确保它高度可用，这样，如果由于某种原因出现问题，它不会影响最终用户。WordPress是一个非常流行的内容管理系统(CMS)。它最常用于博客，但也可以用于运行电子商务网站、留言板和许多其他流行的用例。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/052b2815019f065801113807f9eb5917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGG5K3uEeMzfYckIxbMAuQ.png"/></div></div></figure><h1 id="dcd7" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">问题陈述</h1><p id="ef13" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">每当你在机器上安装WordPress时，你都有与WP相关的配置文件。现在，如果你在多台机器上安装WordPress，每台机器都有自己的文件，如果你在一些负载平衡器后面运行这些机器，那么你会遇到一个问题。还有一件事是你的WordPress站点的数据库维护是至关重要的。你的数据库实例为你的WordPress站点保存了所有重要的数据。如果数据库宕机，你的网站可能会随之宕机，你甚至可能会丢失数据。</p><h1 id="c8ac" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">AWS服务</h1><ol class=""><li id="bf7d" class="ks kt hi ih b ii kb im kc iq ku iu kv iy kw jc kx ky kz la bi translated">关系数据库服务—我们将使用AWS RDS MySQL，这是由AWS提供的完全托管的MySQL数据库服务</li><li id="f34b" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">应用程序负载平衡器—我们将使用AWS ALB作为我们网站的单一入口点。ALB会将请求路由到ALB后面的多个EC2</li><li id="fbb6" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc kx ky kz la bi translated">弹性文件系统——AWS EFS是完全管理的网络文件系统，我们将使用它来存储我们所有的WordPress配置文件，插件，网页。EFS的另一个优势是，我们可以将EFS安装到多个EC2实例，这样每个EC2实例都指向相同的文件，我们可以运行多个EC2来实现高可用性和容错。</li></ol><h1 id="c1bb" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">我们开始吧</h1><ol class=""><li id="8bcd" class="ks kt hi ih b ii kb im kc iq ku iu kv iy kw jc kx ky kz la bi translated"><strong class="ih hj">创建您的MySQL数据库</strong></li></ol><ul class=""><li id="edca" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">首先，请在AWS控制台中访问Amazon RDS。单击橙色的“创建数据库”按钮开始。</li></ul><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lk"><img src="../Images/c3ed489836c4dc94bec11678ef068bc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VYsPDf6h9gEMNGeJasiebw.png"/></div></div></figure><ul class=""><li id="b04e" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">第一步是选择要使用的数据库引擎。WordPress使用MySQL，所以我们会选择MySQL</li></ul><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ll"><img src="../Images/74530b5b9d13bc291776cf2eac0098e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*690i28x3UZO0uZVtBjS1uw.png"/></div></div></figure><ul class=""><li id="0121" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">向下滚动并选择您想要的模板(我选择了生产)</li><li id="5dea" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">输入数据库实例标识符的名称</li><li id="d857" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">为您的数据库输入<strong class="ih hj">主用户名</strong>和<strong class="ih hj">密码</strong>(确保记下并安全保存)</li><li id="e0f9" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">选择所需的实例类</li><li id="f903" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">向下滚动选择您是否希望您的数据库是MultiAZ(如果您在Prod中使用它，我建议将其创建为MultiAZ)</li><li id="433c" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">为您的RDS选择VPC和合适的安全组</li><li id="16b2" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">向下滚动并在<strong class="ih hj">附加配置</strong>中写入<strong class="ih hj">初始数据库名称</strong> (RDS将为我们创建数据库)</li><li id="7fcd" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">向下滚动并点击<strong class="ih hj">创建数据库</strong></li></ul><p id="1af1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记下主用户名，密码和初始数据库，我们将在配置可湿性粉剂需要这些信息</p><p id="1467" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.<strong class="ih hj">创建EC2实例</strong></p><ul class=""><li id="8502" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">在您创建RDS的VPC用<strong class="ih hj"> Amazon Linux 2 AMI (HVM) </strong>创建EC2实例</li><li id="5fb1" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">在RDS的安全组中，打开入站规则中的端口3306，并添加EC2实例安全组Id，以便EC2可以连接到RDS MySQL。</li></ul><p id="2c75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.<strong class="ih hj">创造EFS </strong></p><ul class=""><li id="9f70" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">转到EFS控制台，点击<strong class="ih hj">创建文件系统</strong></li><li id="e9f9" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">输入EFS的名字</li><li id="cf29" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">选择已启动RDS和EC2的VPC</li><li id="6412" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">在<strong class="ih hj">可用性和耐用性</strong>中选择<strong class="ih hj">区域</strong>并点击创建</li></ul><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lm"><img src="../Images/8b3272448ebf8cb345fa4d8299ec5923.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUL5n8J5vG5tzx21BPvygA.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">AWS EFS</figcaption></figure><ul class=""><li id="faca" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">一旦文件系统可用，单击它并在<strong class="ih hj">生命周期管理</strong>中单击“编辑”选择<strong class="ih hj">无</strong>，单击“保存更改”。这样做的原因是，默认情况下，如果您不从文件系统访问对象，它会将该对象移动到<strong class="ih hj">标准—不频繁访问存储类</strong></li><li id="a0fc" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">将<strong class="ih hj">吞吐量模式</strong>更改为Provisioned，并输入所需值。这将有助于我们在高流量时快速读取文件系统</li></ul><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lr"><img src="../Images/18dec343d0c90292cedca9b3fcd14be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WSbn-cttkWO8SWkL1ChVog.png"/></div></div></figure><p id="0e30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.将EFS连接到EC2 </p><ul class=""><li id="e59c" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">一旦您完成了对SSH到EC2实例的更改，我们将把这个文件系统附加到EC2实例，以便它可以将数据存储到文件系统中</li><li id="6bae" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">使用以下命令创建<code class="du ls lt lu lv b">/var/www/html</code>目录。我们将把所有内容存储在Apache Web服务器使用的这个目录下</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="a63b" class="ma je hi lv b fi mb mc l md me">sudo mkdir -p /var/www/html/</span></pre><ul class=""><li id="67ef" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">使用以下命令挂载文件系统</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="407d" class="ma je hi lv b fi mb mc l md me">sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport &lt;file_system_id&gt;.efs.&lt;region&gt;.amazonaws.com:/ /var/www/html/</span></pre><p id="0082" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您也可以从文件系统控制台获得该命令。您只需单击“file system ”,您将看到“Attach”按钮，单击该按钮，您将获得命令。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lm"><img src="../Images/6dac0a4666dbf8c299fc6921d3716e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZ2Fx5o8k5tfXX-ab9uuPg.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mf"><img src="../Images/78d1edc5a9e7dc9280f91f94ebab5bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzgzMFYgXVsB0HtxVtQXhQ.png"/></div></div></figure><p id="30b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>确保用<code class="du ls lt lu lv b">/var/www/html</code>替换<code class="du ls lt lu lv b">efs</code></p><ul class=""><li id="1941" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">使用以下命令检查文件系统是否挂载到EC2</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="0a59" class="ma je hi lv b fi mb mc l md me">df -T -h</span></pre><p id="a27d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们的文件系统挂载成功了，我们可以继续了，但是在此之前，我们将配置我们的EC2实例来自动挂载文件系统</p><ul class=""><li id="6b8b" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">安装以下软件包</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="0f8e" class="ma je hi lv b fi mb mc l md me">sudo yum install -y amazon-efs-utils</span></pre><ul class=""><li id="d7fc" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">在您最喜欢的文本编辑器中打开文件<code class="du ls lt lu lv b">/etc/fstab</code>,添加下面一行</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="918e" class="ma je hi lv b fi mb mc l md me">&lt;file_system_id&gt;.efs.&lt;region&gt;.amazonaws.com:/ /var/www/html/ efs defaults,_netdev 0 0</span></pre><p id="d4dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，每当您的EC2实例由于某种原因重新启动时，它将自动挂载文件系统。</p><p id="a347" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.<strong class="ih hj">安装阿帕奇网络服务器</strong></p><ul class=""><li id="e8e8" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">要运行WordPress，您需要在EC2实例上运行一个web服务器。开源的Apache web服务器是WordPress使用的最流行的web服务器。</li><li id="ccd4" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">要在EC2实例上安装Apache，请在终端中运行以下命令:</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="db02" class="ma je hi lv b fi mb mc l md me">sudo yum install -y httpd</span></pre><ul class=""><li id="07af" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">启动apache web服务器</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="86c1" class="ma je hi lv b fi mb mc l md me">sudo systemctl start httpd</span></pre><ul class=""><li id="bf28" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">允许apache web服务器在引导时自动启动</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="b734" class="ma je hi lv b fi mb mc l md me">sudo systemctl enable httpd</span></pre><ul class=""><li id="452a" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">检查httpd的状态</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="8ced" class="ma je hi lv b fi mb mc l md me">sudo systemctl status httpd</span></pre><p id="a479" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以进入浏览器点击<strong class="ih hj"> &lt; ec2_public_DNS &gt; </strong>你会看到apache测试页面。确保您已经在EC2的SG中打开了端口80</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mh"><img src="../Images/d1197060ab4adbb05489ce32c7695d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TBCkG479NMA17DVAOLD_Q.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">Apache服务器测试页面</figcaption></figure><p id="f49d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.<strong class="ih hj">在目标组中创建应用程序ALB并注册EC2</strong></p><ul class=""><li id="51ab" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">转到EC2控制台，点击左侧导航面板中的<strong class="ih hj">负载平衡器</strong></li><li id="1eba" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">点击<strong class="ih hj">创建负载平衡器</strong>按钮</li><li id="5710" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">选择<strong class="ih hj">应用负载平衡器</strong></li><li id="6ccc" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">输入负载平衡器的名称</li><li id="e2e5" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">向下滚动并选择已经启动RDS和EC2的VPC，选择可用性区域(我建议选择2个或更多az以获得高可用性)，并选择适当的子网</li><li id="4134" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">单击Next并选择ALB的安全组(确保您的SG打开了端口80)</li><li id="2b68" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">在配置路由中</li></ul><p id="5f4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.选择创建新目标组</p><p id="5900" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.输入TG的名称</p><p id="1811" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.选择<strong class="ih hj">目标类型</strong>-&gt;-<strong class="ih hj">实例</strong></p><p id="f314" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">d.选择<strong class="ih hj"> HTTP </strong>协议</p><p id="2113" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">e.将<strong class="ih hj"> 80 </strong>写入端口</p><p id="c43a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">f.向下滚动到<strong class="ih hj">高级健康检查设置</strong></p><p id="b1d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">g.在<strong class="ih hj">成功代码</strong>中输入<strong class="ih hj"> 200，301 </strong>(安装WordPress后，当我们在内部向ALB端点发出请求时，Apache Web服务器会将我们的流量重定向到WordPress，并给出301状态代码。请求的流程将是ALB端点上的请求-&gt;Apache web server-&gt;WordPress。所以基本上我们的Apache服务器正在重定向流量，所以TG的成功代码将是301)。如果在创建TG时没有在<strong class="ih hj">成功代码</strong>中添加301，您的目标健康检查可能会失败，并出现错误<strong class="ih hj">获取301状态代码</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mi"><img src="../Images/9989a16fac7556272767b4ee99f9bbdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1J5fbKA_uCiWTm1dz8aQHg.png"/></div></div></figure><p id="c8e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>添加200和301两个状态代码，因为直到现在当我们点击请求时，成功代码将是200，但是在安装和配置WordPress之后，成功代码将是301。不要忘记将ALB Sg的ID添加到EC2 SG的入站规则中。</p><p id="aedd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.下载并配置WordPress</p><ul class=""><li id="ad90" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">在这一步，我们将下载WordPress软件并设置配置。</li><li id="b229" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">首先，通过在终端中运行以下命令下载并解压缩软件:</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="9e01" class="ma je hi lv b fi mb mc l md me">cd /home/ec2-user/</span><span id="f3b8" class="ma je hi lv b fi mj mc l md me">wget <a class="ae mg" href="https://wordpress.org/latest.tar.gz" rel="noopener ugc nofollow" target="_blank">https://wordpress.org/latest.tar.gz</a></span><span id="ecb7" class="ma je hi lv b fi mj mc l md me">tar -xzf latest.tar.gz</span></pre><ul class=""><li id="354e" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">进入wordpress目录，使用以下命令创建默认配置文件的副本:</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="ea76" class="ma je hi lv b fi mb mc l md me">cd wordpress</span><span id="b06e" class="ma je hi lv b fi mj mc l md me">cp wp-config-sample.php wp-config.php</span></pre><ul class=""><li id="5068" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">使用您最喜欢的文本编辑器打开<strong class="ih hj">wp-config.php</strong>文件，我们需要编辑两个配置区域。</li></ul><p id="7d91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.首先，通过更改以下几行来编辑数据库配置:</p><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="e3f3" class="ma je hi lv b fi mb mc l md me">// ** MySQL settings - You can get this info from your web host ** //<br/>/** The name of the database for WordPress */<br/>define( 'DB_NAME', 'database_name_here' );</span><span id="4513" class="ma je hi lv b fi mj mc l md me">/** MySQL database username */<br/>define( 'DB_USER', 'username_here' );</span><span id="16c8" class="ma je hi lv b fi mj mc l md me">/** MySQL database password */<br/>define( 'DB_PASSWORD', 'password_here' );</span><span id="9198" class="ma je hi lv b fi mj mc l md me">/** MySQL hostname */<br/>define( 'DB_HOST', 'localhost' );</span></pre><p id="bd32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> DB_NAME </strong>:创建RDS MySQL时创建的DB的名称</p><p id="c6ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">DB _ USER</strong>:RDS MySQL主用户名</p><p id="2cc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">DB _ PASSWORD</strong>:RDS MySQL密码</p><p id="5fc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">DB _ HOST</strong>:RDS MySQL主机，您可以从RDS控制台获得它，单击您的数据库实例，您将看到连接端点</p><p id="bf35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.我们需要配置的第二个配置部分是身份验证唯一密钥和Salts。它在配置文件中如下所示:</p><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="a06b" class="ma je hi lv b fi mb mc l md me">/**#@+<br/> * Authentication Unique Keys and Salts.<br/> *<br/> * Change these to different unique phrases!<br/> * You can generate these using the {<a class="ae mg" href="http://twitter.com/link" rel="noopener ugc nofollow" target="_blank">@link</a> <a class="ae mg" href="https://api.wordpress.org/secret-key/1.1/salt/" rel="noopener ugc nofollow" target="_blank">https://api.wordpress.org/secret-key/1.1/salt/</a> WordPress.org secret-key service}<br/> * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.<br/> *<br/> * <a class="ae mg" href="http://twitter.com/since" rel="noopener ugc nofollow" target="_blank">@since</a> 2.6.0<br/> */<br/>define( 'AUTH_KEY',         'put your unique phrase here' );<br/>define( 'SECURE_AUTH_KEY',  'put your unique phrase here' );<br/>define( 'LOGGED_IN_KEY',    'put your unique phrase here' );<br/>define( 'NONCE_KEY',        'put your unique phrase here' );<br/>define( 'AUTH_SALT',        'put your unique phrase here' );<br/>define( 'SECURE_AUTH_SALT', 'put your unique phrase here' );<br/>define( 'LOGGED_IN_SALT',   'put your unique phrase here' );<br/>define( 'NONCE_SALT',       'put your unique phrase here' );</span></pre><p id="4b21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到<a class="ae mg" href="https://api.wordpress.org/secret-key/1.1/salt/" rel="noopener ugc nofollow" target="_blank">该链接</a>以生成该配置部分的值。您可以用链接中的内容替换该部分中的全部内容。</p><ul class=""><li id="5330" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">完成以上几行后，在配置中添加以下几行</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="faa7" class="ma je hi lv b fi mb mc l md me">define('FS_METHOD', 'direct');</span></pre><p id="a74b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着配置的更新，我们几乎准备好部署我们的WordPress站点了。</p><p id="6d21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">8.<strong class="ih hj">部署WordPress </strong></p><ul class=""><li id="8096" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">在这一步，我们将让您的Apache web服务器处理对WordPress的请求。</li><li id="5ee0" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">首先，安装WordPress所需的应用程序依赖项。在您的终端中，运行以下命令。</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="98ea" class="ma je hi lv b fi mb mc l md me">sudo amazon-linux-extras install -y lamp-mariadb10.2-php7.2 php7.2</span></pre><ul class=""><li id="11d5" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">将你的WordPress应用文件复制到Apache使用的<strong class="ih hj"> /var/www/html </strong>目录中。</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="6330" class="ma je hi lv b fi mb mc l md me"># make sure you are at the the location where the wordpress directory is present</span><span id="2027" class="ma je hi lv b fi mj mc l md me">cd /home/ec2-user</span><span id="62a9" class="ma je hi lv b fi mj mc l md me">ls</span><span id="8155" class="ma je hi lv b fi mj mc l md me">#output of ls should be: latest.tar.gz  wordpress</span><span id="918a" class="ma je hi lv b fi mj mc l md me"># copy the files</span><span id="bd03" class="ma je hi lv b fi mj mc l md me">sudo cp -r wordpress/* /var/www/html/</span></pre><ul class=""><li id="12d0" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">更改user:group of <strong class="ih hj"> /var/www/ </strong>以便apache(httpd)可以访问文件</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="591d" class="ma je hi lv b fi mb mc l md me">sudo chown -R apache:apache /var/www/</span></pre><ul class=""><li id="6c3f" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">打开<strong class="ih hj">/etc/httpd/conf/httpd . conf</strong>文件，进行以下更改</li></ul><p id="7379" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.替换以下几行</p><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="6022" class="ma je hi lv b fi mb mc l md me">&lt;Directory /&gt;<br/>    AllowOverride none<br/>    Require all denied<br/>&lt;/Directory&gt;</span></pre><p id="fc03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与</p><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="90c0" class="ma je hi lv b fi mb mc l md me">&lt;Directory /&gt;<br/>    Options FollowSymLinks<br/>    AllowOverride All<br/>&lt;/Directory&gt;</span></pre><p id="c5bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.向下滚动到<strong class="ih hj">第129行</strong>并将<code class="du ls lt lu lv b">AllowOverride None</code>更改为<code class="du ls lt lu lv b">AllowOverride All</code></p><p id="4a65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.向下滚动到<strong class="ih hj">第155行</strong>，将<code class="du ls lt lu lv b">AllowOverride None</code>改为<code class="du ls lt lu lv b">AllowOverride All</code></p><ul class=""><li id="5fe8" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">最后一步，重启Apache Web服务器</li></ul><pre class="kh ki kj kk fd lw lv lx ly aw lz bi"><span id="7bdc" class="ma je hi lv b fi mb mc l md me">sudo systemctl restart httpd</span></pre><p id="b0fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">恭喜！！！🥳你已经成功地在AWS云上安装了WordPress。</strong></p><p id="2880" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开你的网络浏览器，点击<strong class="ih hj">&lt;ec2 _ public _ DNS&gt;</strong>你会看到WordPress配置页面。按照简单的步骤按照说明来配置WordPress，并确保你为<strong class="ih hj"> WordPress Admin </strong>安全地存储了你的<strong class="ih hj">用户名</strong>和<strong class="ih hj">密码</strong></p><p id="3dfc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">9.<strong class="ih hj">使其高度可用</strong></p><ul class=""><li id="9c06" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">现在，正如我已经告诉您的，我们将使这个设置成为高度可用的，这样，如果我们的EC2实例因为任何原因关闭，那么另一个实例应该可以为请求提供服务</li><li id="9a00" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">我们已经创建了AWS弹性文件系统，这样我们就可以将它挂载到多个EC2实例上，并且我们已经将所有代码转移到了EFS，它挂载在<code class="du ls lt lu lv b">/var/www/html</code>目录下</li><li id="c837" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">转到AWS控制台，选择已经完成上述配置的EC2</li><li id="0304" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">点击操作，点击<code class="du ls lt lu lv b">Image and Templates</code>并点击<code class="du ls lt lu lv b">Create Image</code>按钮</li><li id="e236" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">输入图像的名称和描述<strong class="ih hj">最重要的是</strong>你必须选择<code class="du ls lt lu lv b">No Reboot</code> <strong class="ih hj">启用</strong>复选框。</li></ul><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mk"><img src="../Images/f484bf067711e7e8a5df6fd32189a055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HOXQfUqo4y9XjvvsqUB1tw.png"/></div></div></figure><ul class=""><li id="c708" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">向下滚动并点击创建图像</li><li id="11a0" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">您将获得图像id，并等待它变得可用</li><li id="4794" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">一旦映像可用，<strong class="ih hj">从您已经创建映像启动新的EC2实例</strong></li><li id="68bb" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">您可以从该映像启动任意数量的实例。它将包含我们到目前为止完成的所有配置。</li><li id="9a72" class="ks kt hi ih b ii lb im lc iq ld iu le iy lf jc lj ky kz la bi translated">启动新实例后，验证一切就绪</li></ul><p id="0824" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a.通过运行<code class="du ls lt lu lv b">df -T -h</code>命令检查EFS是否已安装</p><p id="4910" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b.检查httpd服务是否正在运行</p><p id="635d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c.运行<code class="du ls lt lu lv b">ls /var/www/html</code>命令，你会看到所有的文件都在那个目录下，因为我们已经挂载了文件系统。</p><ul class=""><li id="3e89" class="ks kt hi ih b ii ij im in iq lg iu lh iy li jc lj ky kz la bi translated">一旦验证了上述内容，就转到您在创建ALB时创建的目标组，并在该目标组中注册新的EC2实例</li></ul><h1 id="b157" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">恭喜你！！</h1><p id="caf4" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">您已经成功地在AWS实例上安装并配置了WordPress，并且具有高可用性。</p><p id="c2de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有WordPress备份文件，你也可以上传那个备份文件，它会顺利运行。WordPress有许多插件可用于导出和导入备份。</p><p id="695a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>