<html>
<head>
<title>How to correct covariate shift?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何纠正协变量移位？</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-correct-covariate-shift-76f9513b5883?source=collection_archive---------7-----------------------#2021-05-30">https://medium.com/analytics-vidhya/how-to-correct-covariate-shift-76f9513b5883?source=collection_archive---------7-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="830e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，好吧…</p><p id="e5d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">错误总是会发生，在ML/DL项目中更是如此。由于每一个这样的项目都需要数据，大量的数据，我们往往倾向于获取我们能得到的任何数据，在这种追求中，我们往往会忘记并非所有的数据都是相同的。让我们举一个简单的例子来理解我想说的，假设你正试图为日本道路上的自动驾驶车辆制作一个ML/DL系统，但没有训练模型所需的数据，那么你会怎么做？然后，你会突然发现一个包含美国道路数据的巨大数据集，你感到如释重负，然后拿起这些数据，用它来训练你的模型，以彻底改变日本的道路！</p><p id="1e55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是…</p><p id="aad9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事实证明，美国和并不完全相同，可能您的数据集包含的车辆比您在部署时观察到的要大，目标分布和训练分布中的道路宽度可能不同，等等。</p><div class="jd je jf jg fd ab cb"><figure class="jh ji jj jk jl jm jn paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><img src="../Images/be3dcd5d44acd1f5f8d4d514cb3f26b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*KlblHR1Ewxifo6Px8p241w.jpeg"/></div></figure><figure class="jh ji ju jk jl jm jn paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><img src="../Images/3fe6f5ad2bf79175f21684fe19de9029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*dvAiY-UTS0J-dqnS_m2J0A.jpeg"/></div></figure></div><h1 id="fa4f" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">但是从数学的角度来看，到底发生了什么呢？</h1><p id="3035" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">上面讨论的示例是一个典型的协变量移位，其中输入的e分布可能会随时间变化，但标记函数(即条件分布p(y | x)不会变化。统计学家称之为协变量转移，因为问题的出现是由于协变量(如道路宽度、交通标志等特征)分布的转移。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h1 id="dad4" class="jv jw hi bd jx jy lf ka kb kc lg ke kf kg lh ki kj kk li km kn ko lj kq kr ks bi translated">现在该怎么办？</h1><p id="958d" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">答案是<strong class="ih hj"> <em class="lk">协变偏移校正</em> </strong>，现在我们已经完成了我们想要做的事情以及为什么要这样做，让我们了解一下我们是如何做的。</p><p id="bf09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们想要估计一些我们已经标记了数据(x，y)的相关性p(y∣x。不幸的是，观测值x是从一些<em class="lk">源分布</em> q(x)(美国道路上的特征分布)中得出的，而不是从<em class="lk">目标分布</em> p(x)(日本道路上的特征分布)中得出的。</p><p id="c0c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，依赖性假设意味着条件分布不会改变，这意味着:p(y∣x)= q(y∣x).如果源分布q(x)是“错误的”,我们可以通过使用下面的简单等式来校正它:</p><figure class="jd je jf jg fd ji er es paragraph-image"><div class="er es ll"><img src="../Images/cef291d2929da4fa3cb93fe68ff50367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/1*VT59Lghp6FOqtmWAv90C0g.gif"/></div></figure><p id="c650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中l(f(x)，y)是模型的损失函数，这个积分的目的是给每个例子赋予一些概率权重。让我们详细说明一下我们的假设场景，我们知道，与美国道路相比，日本道路上两轮/三轮车辆的比例要大得多，我们可能会在美国道路上遇到一些两轮/三轮车辆，但我们希望有更多这样的例子，以使我们的数据更像是来自p(x)而不是q(x ),因此我们会将数据中这样的例子与更高的权重相关联，因此我们可能会将我们的权重定义为:</p><figure class="jd je jf jg fd ji er es paragraph-image"><div class="er es lm"><img src="../Images/f14bf88d17a33e9f32217bc73b3adc69.png" data-original-src="https://miro.medium.com/v2/resize:fit:160/1*ZtrTHjeza-PpaO8WM2xI7g.gif"/></div></figure><p id="8d99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们使用这些权重来增加与更可能在q(x)中出现的示例相关联的损失，方法是将我们的损失函数设为:</p><figure class="jd je jf jg fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/ca7eb3e0d27d18257e2f34386338a562.png" data-original-src="https://miro.medium.com/v2/resize:fit:286/1*uoZ0NIuGhvfLc_kpLz5ckQ.gif"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">其中l(f(xi)，yi)是原始损失函数。</figcaption></figure><blockquote class="ls lt lu"><p id="5cea" class="if ig lk ih b ii ij ik il im in io ip lv ir is it lw iv iw ix lx iz ja jb jc hb bi translated">但是，由于我们首先不拥有分布为p(x)的数据集，因此，我们如何获得要使用p(x)计算的β呢？</p></blockquote><p id="07c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以在我们做任何有用的事情之前，我们需要估计它。有许多方法可用，包括一些奇特的算子理论方法，这些方法试图使用最小范数或最大熵原理直接重新校准期望算子。注意，对于任何这样的方法，我们都需要从两个分布中抽取样本——“真实”的p，例如，通过访问测试数据，以及用于生成训练集q的样本(这对于我们来说已经是可用的)。然而注意，我们只需要特征x∞p(x)；我们不需要访问标签y∞p(y)。</p><p id="dd1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个非常有效的方法，就是逻辑回归。这就是计算估计β所需的全部内容。我们学习一个分类器来区分从p(x)提取的数据和从q(x)提取的数据。如果不可能区分这两个分布，那么这意味着相关的实例同样可能来自这两个分布中的任何一个。另一方面，任何可以很好区分的实例都应该相应地显著增加或减少权重。</p><h1 id="f153" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">最后，让我们得到一个简洁的算法来做这件事</h1><p id="58c0" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">我们需要解决两个问题:第一个问题是区分来自两种分布的数据，然后是加权经验风险最小化问题，其中我们用βi加权各项。</p><p id="746d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们可以定义一个基本算法来进行协变量移位校正，如下所示:</p><ol class=""><li id="3923" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">生成一个二元分类训练集:{(x1，1)，…，(xn，1)，(u1，1)，…，(um，1)}。</li><li id="db99" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">使用逻辑回归训练二元分类器以获得函数h</li><li id="dc63" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">使用βi=exp⁡(h(xi)).称量训练数据</li><li id="d071" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">使用权重βi在{(x1，y1)，…，(xn，yn)}上进行训练。</li></ol><p id="2047" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，上述算法依赖于一个至关重要的假设。为了使这个方案有效，我们需要目标(例如，测试时间)分布中的每个数据示例在训练时间出现的概率都不为零。如果我们找到一个p(x)&gt;0但q(x)=0的点，那么对应的重要性权重应该是无穷大。</p><p id="af4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，好了，今天就到这里吧！</p><p id="2f27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>