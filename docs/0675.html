<html>
<head>
<title>Navigating Petfinder’s API using Petpy Wrapper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Petpy包装器导航Petfinder的API</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/navigating-petfinders-api-using-petpy-wrapper-2cf085c33d75?source=collection_archive---------15-----------------------#2021-01-26">https://medium.com/analytics-vidhya/navigating-petfinders-api-using-petpy-wrapper-2cf085c33d75?source=collection_archive---------15-----------------------#2021-01-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/929c9e7c36c251f7bc0a075c25f0b39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VVmwN-8qRRBcgKdB_Dx1Vw.jpeg"/></div></div></figure><p id="d500" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">加州各地苦苦挣扎的收容所面临着一个重大的“第22条军规”。需求最大的避难所位于资源最少的社区。这使得许多避难所捉襟见肘，通常由志愿者支持的骨干人员带领。这意味着收容所里的动物大部分时间都是孤独的。</p><p id="0130" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">避难所喧闹、混乱，通常人口过多且资金不足。研究表明，狗在庇护所呆的时间越长，它们就越有可能遭受长期或不可挽回的情感和行为伤害。虽然加州已经打算成为一个“无杀戮”州，但我开始了解我们现在如何才能做得更好，以最大限度地减少狗的救援时间(<em class="jn">敬请期待</em>)。</p><p id="728d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了推断哪些特征可以最大限度地减少狗在收容所的时间，我需要包括狗从到达到被收养的停留时间在内的数据。对全面的收容所数据的访问是零星的和不一致的，但任何曾经讨论过收养宠物的人都可能浏览过Petfinder的页面。在本文中，我将带您浏览Petfinder的API，使用Petpy包装器收集以前收养的动物的数据。</p><p id="893f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> Petfinder API <br/> </strong>您需要首先创建一个帐户，并从“开发者”页面提交API请求。此密钥会很快被批准，所有相关信息都可以在您的用户帐户的“开发者设置”下找到。标准级别的API访问为您提供API和密钥、帐户状态以及请求使用和速率限制。</p><p id="1c51" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不幸的是，从终端导航Petfinder API并不透明。经过一个小时的故障排除，我以json文件的形式检索到了一个以前收养的狗的列表，向我表明这是可能的，但我不能再进一步了。就在那时，我发现了Petpy，30分钟后，我有了一个健壮的、完整的数据框架，里面有我要找的信息。</p><p id="4686" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">Petpy Wrapper<br/></strong>API Wrapper是将API调用“包装”到更简单的函数中的包，这种方式提供了比直接使用API更友好的用户体验。Petpy也不例外。在Jupyter run:</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="d754" class="jy jz hh ju b fi ka kb l kc kd">!pip install petpy</span></pre><p id="20cb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下载完成后，您可以导入Petpy并开始使用。您需要首先使用etpy包装器实例化API和密钥，如下所示:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ca"><img src="../Images/467f962ef75df77f464cb0690646f850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zeSe96C__Y6ZIf_8pCwKZg.png"/></div></div></figure><p id="2257" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从那里你现在准备好提出你的要求。Petpy有各种各样的功能，它们的<a class="ae jo" href="https://petpy.readthedocs.io/_/downloads/en/latest/pdf/" rel="noopener ugc nofollow" target="_blank">文档</a>清晰明了，解释得很好。您可以从搜索可能的参数开始，并在众多示例之一的指导下测试Petpy的功能。或者知道自己在找什么，就可以进入正题了。</p><p id="c249" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">出于我的特定目的，我想要横跨2019年和2020年海湾地区附近所有标记为被收养的狗的数据。格式以pf.animals()开头，其中所有特定参数都包含在括号内。遵循文档并知道我希望我的结果是熊猫数据帧的形式，我将我的数据帧的名称设置为“狗”，动物类型和df参数:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ke"><img src="../Images/a232c80264612aafef9ef3035b481b38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pH0Ej3GOVVZ5hBQ_tiR12g.png"/></div></div></figure><p id="c70c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我将动物类型留空，那么结果输出将包括Petfinder上列出的所有动物类型。使用Petpy，我可以调出某一特定品种的所有狗，我周围10英里内可以收养的马，只有去年4月收养的长毛猫等等。为了将我的搜索范围缩小到过去两年内收养的狗，我增加了几个参数:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kf"><img src="../Images/3ad093855a3a2344695db021daf7ec80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-Px857uP4qtkdE9hohAEQ.png"/></div></div></figure><p id="f2a3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在提出任何请求之前，仔细阅读默认参数是很重要的。由于我没有包括每页的结果或页数，Petpy默认为每页20个结果。每页的最大结果是100，但最大页数似乎不清楚。包含大量页面似乎并没有什么缺点，因为如果页面超过了可用的数据量，就会出现一个错误，通知您到达了哪个页面，但数据帧仍然可用。</p><p id="52db" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我最初的想法是把收养的狗带到整个加州，但是文档规定位置必须以“城市，州”，“邮政编码”或“纬度，经度”的形式列出。相反，我暂时将我的关注点缩小到海湾地区，并利用默认设置，我提取了给定邮政编码100英里范围内的狗的数据。我最终放弃了我的数据框架中被认为不在湾区的几个城市，以及从2021年开始的几个列表。如果我进一步指定时间和日期，我相信我可以避免这一点。</p><p id="c564" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了获得最终的工作数据帧，我的请求如下:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kg"><img src="../Images/c9dac19a3c12d75565f912af375374f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ooh-A3EE4q4_g1BUELIQ2w.png"/></div></div></figure><p id="f080" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">结果是一个20，000乘49熊猫的数据框架如下所示。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kh"><img src="../Images/ba81f53d8111fa66d4029ad54bb826c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMHsmnEn9GQeD6eEgv5D0g.png"/></div></div></figure><p id="4795" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从这里，我们可以确认这个数据框架中的列表实际上是物种和类型:狗和状态:被收养。提供了关于组织，年龄，性别，大小，主要和次要品种等更多的细节。我确实在我的请求中发现了一些重复，因为id对每只狗都是唯一的，这很容易处理:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ki"><img src="../Images/5d13f3f396d0343c3c942db71cb09150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ClN9GnX0q-TsG52k3qYqDA.png"/></div></div></figure><p id="f554" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你一直坚持到这一点，你可能会意识到我们遗漏了一个至关重要的元素Petfinder上列出的持续时间。仔细观察该数据帧中的特征，我得到了“published_at”和“status_changed_at”。我的目标是推断出最大限度减少在收容所的时间和最大限度提高收养速度的特征，我可以设计一个特征，通过包含一只狗在Petfinder上列出的总时间，使我尽可能接近我的目标。我创建了目标列，如下所示:</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kj"><img src="../Images/7929b665c43b474e193ad57a2fc2c61c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJeqGD2xjo_uHpxdKhmeXQ.png"/></div></div></figure><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kk"><img src="../Images/02180b28ab5d178c5a6df2b6416df766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GTuRZxHUaBmbWghDC5uWrQ.png"/></div></div></figure><p id="f756" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过首先转换为日期时间，然后减去列表状态改变为“已采用”的日期，再减去列表发布的日期，在标题为“days_on_petfinder”的新列中给出列表在Petfinder上活动的时间量。在这里，我们将该列转换为日期时间格式的天数，最后将其四舍五入为整数。</p><p id="0501" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">完成这些步骤后，我将数据框保存为. csv文件，然后准备继续探索性分析和特征工程。我希望这有助于任何希望减少动物在收容所的时间，研究动物收养的分析师和数据科学家。通过能够推断出最大化收养率的特征并实施改变，我们可以希望减轻我们当地收容所和它们所照顾的动物的沉重负担。</p></div></div>    
</body>
</html>