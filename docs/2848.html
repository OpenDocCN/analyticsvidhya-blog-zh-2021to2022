<html>
<head>
<title>Paper 2 Data — An example of how to extract information from legal contracts using Artificial Intelligence.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">论文2数据-如何使用人工智能从法律合同中提取信息的示例。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/paper-2-data-an-example-of-how-to-extract-information-from-legal-contracts-using-machine-learning-476fedd55592?source=collection_archive---------0-----------------------#2021-05-20">https://medium.com/analytics-vidhya/paper-2-data-an-example-of-how-to-extract-information-from-legal-contracts-using-machine-learning-476fedd55592?source=collection_archive---------0-----------------------#2021-05-20</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="7ef5" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">使用最先进的自然语言处理(NLP)技术从法律合同中自动提取基本信息并将其转换为结构化数据的实际使用案例。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et je"><img src="../Images/36a064c2abfea1818ebdc09bc7dd9be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dcARiOoa9UtoFGno"/></div></div><figcaption class="jq jr eu es et js jt bd b be z dy translated">娜娜·斯米尔诺娃在<a class="ae ju" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="ea89" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">摘要</h1><p id="7749" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">随着机器学习的应用和实际实施越来越多地走出学术界和大型技术领域，许多行业和部门都出现了许多机会。</p><p id="09b7" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">作为支持泽西岛国际金融服务部门参与者的社区项目的一部分，我们展示了一个从法律文件中提取基本信息的实际例子。</p><p id="1dc3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">使用当前的自然语言处理(NLP)技术，我们构建了一个数据工作流，用于标记来自pdf文档语料库的新数据集，训练模型以将法律合同文本中的非结构化数据转换为格式良好的结构化数据，并在一组样本文档上演示这一点。</p><p id="e7d2" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这篇文章解释了这个过程，所有使用的代码都可以在Jupyter的笔记本中找到，并且包含在<a class="ae ju" href="https://github.com/JsyPhil/paper-2-data" rel="noopener ugc nofollow" target="_blank">项目的GitHub资源库</a>中。此工作流程中的每个笔记本都链接在下面文本中每个部分的开头。</p><p id="bb28" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">出于这个例子的目的，我们试图提取以下基本信息:</p><ol class=""><li id="d8e6" class="ky kz hj ii b ij ik in io ir la iv lb iz lc jd ld le lf lg bi translated">协议的名称或标题，</li><li id="862e" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">协议生效的日期。</li><li id="c031" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">合同的所有当事人。</li></ol><p id="513d" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这可以用于流程管理、合同审查和分析等目的。</p><p id="d8da" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">此外，完全相同的技术可以用于提取其他数据点的其他用例，例如贷款协议中的杠杆比率或有限合伙协议中的投资金额。</p><h1 id="a0fe" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">动机</h1><p id="fea8" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">使用机器学习分析法律文件的动机在过去五年左右发表的研究论文中得到了很好的解释，包括但不限于Atticus项目和主要来自雅典大学和希腊国家科学研究中心的各种研究论文(参见脚注参考文献1–4)。</p><p id="06ce" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">动机包括:</p><p id="1f9e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">需要分析和监控各种任务合同的公司、律师事务所、监管机构和政府机构。</p><p id="2309" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">例如，当法律有修改或变更时，或者当客户需要他们审查现有合同时，律师事务所需要审查现有合同。</p><p id="859d" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">公司需要跟踪许多合同的日期、条款、金额和当事人。</p><p id="572a" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在M&amp;A活动和首次公开募股等公司交易过程中，公司及其法律顾问需要审查往往是数百份合同。</p><p id="d7c5" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">因此，在合同元素提取可以自动化的基础上，这将节省时间和金钱，最大限度地降低合同违约的风险，并提供有用的数据用于分析。</p><h1 id="2768" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">项目概述</h1><p id="b01a" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">在这个项目中，我们用多个最先进的预训练模型进行实验。我们使用<a class="ae ju" href="https://huggingface.co/transformers/custom_datasets.html#tok-ner" rel="noopener ugc nofollow" target="_blank">令牌分类下游任务</a>对这些进行微调，目的是识别我们希望提取的信息，并尝试确定最终模型的最佳模型和超参数，该模型可用于推理和结构良好的数据提取。我们使用“<a class="ae ju" href="https://scikit-learn.org/stable/modules/model_evaluation.html#precision-recall-f-measure-metrics" rel="noopener ugc nofollow" target="_blank"> F1的分数</a>作为我们试图优化的指标。F1分数使我们能够平衡召回率和精确度，最大限度地减少我们预测中的假阳性和假阴性。</p><p id="7cee" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们将使用我们自己的预定义特征标签，并使用开源文档集作为我们的训练和验证数据集。具体来说，我们将使用<a class="ae ju" href="https://www.atticusprojectai.org/cuad" rel="noopener ugc nofollow" target="_blank">阿提克斯·CUAD数据集</a>中的一些法律合同。</p><p id="01b1" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">花费在项目上的大部分时间是为了确保文档被适当地和一致地注释，以创建一个带标签的数据集，我们可以放心地将它放入我们的模型中。值得强调的是，创建数据集的工作是这个项目成功的主要驱动力。</p></div><div class="ab cl lm ln gq lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hc hd he hf hg"><h1 id="e065" class="jv jw hj bd jx jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks bi translated">1.资料组</h1><p id="b94d" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">请看:<a class="ae ju" href="https://github.com/JsyPhil/paper-2-data/blob/main/F1-P2D-NER-CUAD-v1-Pre-Annotation-Workflow.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/JsyPhil/paper-2-data/blob/main/F1-P2D-NER-CUAD-v1-Pre-Annotation-workflow . ipynb</a></p><p id="b39f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">为了创建这样一个NLP项目的数据集，我们首先需要找到一个法律文档的语料库，将它们转换为文本，然后对它们进行适当的预处理，以与预训练模型的单词嵌入和标记化方法兼容。</p><p id="73c4" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">幸运的是，CUADv1法律协议数据集是由Atticus项目在2021年发布的，其中包含了从公开的SEC文件中获得的510份一般商业法律合同。</p><p id="35be" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">虽然Atticus项目已经创建了包含这些协议中13，000多个标签的数据集语料库，但鉴于我们的用例不同，我们需要构建自己的标签数据集。</p><h2 id="1eb7" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">文件长度</h2><p id="9fb9" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">大多数NLP模型的当前限制是，它们对要进行预测的文本的长度有限制。通常是512或768个令牌，具体取决于型号及其结构。增加此值会对神经网络的大小产生指数效应，因此内存需求也是如此，因此通常会对模型有硬性限制。</p><p id="70d9" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">法律合同通常会超过512个单词，标记化后会创建更多的标记(参见下面标签对齐下的解释)。</p><p id="495e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这在这个用例中很容易解决，因为要提取的大多数数据都在法律合同的顶部附近，所以只需要合同的开头。</p><p id="7a0a" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">如果要在一个模型中使用整个合同，那么就需要克服这个问题。有可用的技术，没有硬帽的模型，也有为长文档开发的模型，如Google的<a class="ae ju" href="https://github.com/google-research/bigbird" rel="noopener ugc nofollow" target="_blank"> Big Bird </a>。</p><h2 id="938c" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">标记方案</h2><p id="6dd5" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">出于本项目的目的，我们希望从法律合同中提取以下基本数据点:</p><p id="ab12" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">a)协议日期<br/> b)文件名称<br/> c)当事人</p><p id="2ac8" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们将使用<a class="ae ju" href="https://en.wikipedia.org/wiki/Inside%E2%80%93outside%E2%80%93beginning_(tagging)" rel="noopener ugc nofollow" target="_blank">内-外-始(IOB) </a>标记惯例来创建以下要素标签，用于标注和标记数据集中每个协议的文本:</p><p id="5a5d" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">0 B-AGMT _ DATE<br/>1 B-DOC _ NAME<br/>2 B-PARTY<br/>3 I-AGMT _ DATE<br/>4 I-DOC _ NAME<br/>5 I-PARTY<br/>6 O</p><p id="a1cb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">IOB约定将帮助模型理解和学习哪个单词是我们要提取的数据的一部分。如果我们需要提取的两个独立的数据片段在文本中是相邻的，那么IOB约定会处理这种情况。例如，在协议的首页上，协议名称和协议日期可能紧挨着。在这种情况下，特征标注看起来和翻译如下:</p><p id="e425" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><em class="mm">贷款协议<br/>2021年5月7日</em></p><p id="d1f0" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><em class="mm"> B文件名称，I文件名称，<br/> B文件日期，I文件日期，I文件日期</em></p><p id="b242" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><em class="mm"> 1，4，<br/> 0，3，3 </em></p><p id="a26d" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">因此，我们能够为每个文档中的每个单词创建一个特征标签，其中大部分是“6”，对我们来说不是有用的数据，但同时我们能够训练一个模型来知道每个契约中的哪几个单词包含我们想要提取的数据，即特征标签“0”到“5”。</p><h2 id="3606" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">注释每个合同</h2><p id="e9d2" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">当涉及到为NLP项目创建数据集的要素标注文本时，有许多不同的选项。其中一些是专有的商业软件选项，一些是开源的，可以根据许可免费使用。一个好的开源选项是<a class="ae ju" href="https://github.com/doccano/doccano" rel="noopener ugc nofollow" target="_blank"> Doccano </a>。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et mn"><img src="../Images/9012ab2131c3e2b5762177ce1c3115ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uRfMvFN_KNK9_P7nkdAvA.png"/></div></div><figcaption class="jq jr eu es et js jt bd b be z dy translated">Doccano —文本分类—标签和注释</figcaption></figure><p id="0c1c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">为了将文档转换成可导入Doccano的格式，我们准备了一个初始工作流来导入文本、清理文本并根据CUAD数据集中的可用信息自动进行一些标记。</p><p id="9354" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">只有CUAD数据集中的一些文档适用于我们的用例，因为一些文档是模板，未注明日期或不包含交易对手信息。</p><p id="8e1e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们用Python构建了一个工作流，在可能的情况下自动创建注释。如果自动化是不可能的，我们仍然能够识别这些合同，并在Doccano中手动审查文本。</p><p id="0d33" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">Doccano中的这个注释过程非常耗时。所有的证据都表明，对NLP模型可用的注释越多，模型的性能就越好。同样重要的是，注释在每个协议中都要一致地完成，以免混淆模型的训练。因此，每个注释在完成后都经过仔细检查。</p><p id="2521" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">按照这个工作流程，我们完成了包含1，697个标签的314个文档的数据集。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et mo"><img src="../Images/3ad6bb691b8fdcca7aafa3d5d9d4552d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RxaCddRZtwljPbwbtD7pPA.png"/></div></div><figcaption class="jq jr eu es et js jt bd b be z dy translated">数据集中的标签数</figcaption></figure><h1 id="4b36" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">2.预处理文本</h1><p id="f560" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">请看:<a class="ae ju" href="https://github.com/JsyPhil/paper-2-data/blob/main/F2-P2D-NER-CUAD-v1-Dataset-Preparation.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/JsyPhil/paper-2-data/blob/main/F2-P2D-NER-CUAD-v1-Dataset-preparation . ipynb</a></p><p id="aed5" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">使用多行JSON文件格式的<a class="ae ju" href="https://jsonlines.org/" rel="noopener ugc nofollow" target="_blank"> JSONL </a>从Doccano导出文本和特征标签。然后，这些数据需要一些进一步的预处理，以创建进一步的JSON文件格式，为摄取到NLP transformer模型做好准备，并利用handy Datasets库(来自Hugging Face)。</p><p id="a126" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这是通过另一个Python工作流完成的，该工作流创建了从Doccano导出的每个契约中的每个单词的列表，并将其与从0到6(如上所述)的相应标签列表进行匹配，这些标签与同样从Doccano导出的注释标签相关。然后以JSON文件格式导出。</p><p id="66fe" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">数据集库可以利用和操作JSON数据，并与Transformers库很好地吻合，例如在创建训练和评估数据集时。</p><h1 id="ac53" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">3.微调变压器模型</h1><p id="c896" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">请看:<a class="ae ju" href="https://github.com/JsyPhil/paper-2-data/blob/main/F3-P2D-NER-CUAD-v1-Fine-Tune-Transformer.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/JsyPhil/paper-2-data/blob/main/F3-P2D-NER-CUAD-v1-Fine-Tune-transformer . ipynb</a></p><p id="dd03" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们利用无处不在的<a class="ae ju" href="https://huggingface.co" rel="noopener ugc nofollow" target="_blank">拥抱脸</a>开源NLP库来获取和微调我们的模型。</p><p id="db36" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">拥抱脸已经成为当前最先进的NLP模型、数据集和其他资源(包括教程和支持良好的库)的事实上的去处。</p><p id="f2c6" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">来自<a class="ae ju" href="https://huggingface.co/google" rel="noopener ugc nofollow" target="_blank">谷歌人工智能</a>、<a class="ae ju" href="https://huggingface.co/facebook" rel="noopener ugc nofollow" target="_blank">脸书人工智能</a>、<a class="ae ju" href="https://huggingface.co/microsoft" rel="noopener ugc nofollow" target="_blank">微软</a>和许多其他包括大学在内的数据科学团队为拥抱脸提供了模型和库。</p><p id="9305" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">拥抱脸主持了谷歌人工智能从2018年开始的原始<a class="ae ju" href="https://github.com/google-research/bert/" rel="noopener ugc nofollow" target="_blank"> BERT </a>模型的许多实现和进步。其中一些实现是针对特定用例的“微调”示例，而另一些是“预训练”示例，可以针对离散用例进行进一步训练。</p><p id="ba73" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">为了这个项目的目的，我们感兴趣的是后者。预训练模型是一项了不起的创新，因为它们允许任何人使用通常已被训练到具有大量数据和大型计算资源的模型，通常只有“大型技术”和“学术界”才能使用这些模型。</p><p id="1b3f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这些预先训练好的模型可以用你自己相对少量的数据再多训练一点点，以达到很好的结果。</p><p id="976a" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">您必须接受一些限制，包括用于训练这些预训练模型的训练数据可能存在一些偏差。这种限制通常由预训练模型的开发者很好地解释。</p><h2 id="9b8e" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">模特们</h2><p id="226d" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">为了微调我们的模型，我们试验了四种预训练的BERT变体:</p><p id="1b43" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><a class="ae ju" href="https://huggingface.co/distilbert-base-uncased" rel="noopener ugc nofollow" target="_blank">蒸馏瓶基本型号(无外壳)</a></p><p id="51ca" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><a class="ae ju" href="https://huggingface.co/distilbert-base-cased" rel="noopener ugc nofollow" target="_blank">蒸馏基准模型(装箱)</a></p><p id="e6b3" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><a class="ae ju" href="https://huggingface.co/roberta-base" rel="noopener ugc nofollow" target="_blank">罗伯塔基础型号</a></p><p id="3ccd" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><a class="ae ju" href="https://huggingface.co/microsoft/deberta-v2-xlarge" rel="noopener ugc nofollow" target="_blank">德伯塔-v2 (xl) </a></p><p id="1e7b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们用来微调模型的工作流是基于拥抱脸提供的令牌分类基础工作流。对于我们的项目，我们只对“命名实体识别”实现感兴趣，以对文本中的实体进行分类，即文档名称、日期和当事人。</p><p id="ccf8" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">基础工作流适合我们的使用案例，包括:</p><ol class=""><li id="be4b" class="ky kz hj ii b ij ik in io ir la iv lb iz lc jd ld le lf lg bi translated">多个实验的配置设置</li><li id="d855" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">定制要素标签</li><li id="f7aa" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">Helper函数专门用于对齐DeBERTa-v2 (xl)模型中的标签预测(该模型没有Hugging Face AutoTokenizerFast类)。</li><li id="4015" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">定制训练计划，包括热身和余弦计算学习率，以实现最佳调整。</li><li id="84ba" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">实施权重和偏差，方便实验和超参数跟踪。</li><li id="39f8" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">预测的抽样检查</li></ol><h2 id="3ef0" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">标签对齐</h2><p id="52bb" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">值得特别注意的是，每个模型的符号化过程都可能导致复杂性。不同的模型将利用不同的定制标记器、字典和预先训练的单词嵌入。这些可以基于句子片段、单词片段或字节级BPE(与GPT2相同)。这是当前所有模型中的创新领域。例如，微软开发的DeBERTa在几个月内就将其令牌化器从字节级BPE转换为跨越v1和v2的句子片段。拥抱脸很好地总结了各种记号赋予器的方法。</p><p id="f5da" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在一个工作流中容纳不同的模型和每个记号化器需要一些努力。</p><p id="9d9f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">记号赋予器将添加记号来表示向量的开始和结束，这些记号和其他记号一起被称为“特殊记号”。此外，如果一个单词要通过模型，而该单词不在模型的预训练词典中，那么分词器会将该单词分解成单词的各个部分。</p><p id="393f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">因此，通过模型传递的标记的数量将大于单词的数量。</p><p id="14ba" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">当一个单词被分成两个或更多个标记时，分配给该单词的标签在这些标记之间重复。对于任何给定的句子，如何做到这一点在每个记号赋予器之间会有很大的不同。</p><p id="8b37" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">当从模型中做出预测时，我们必须重新排列和重新完成单词，并删除或忽略特殊符号。</p><p id="0a47" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">幸运的是，拥抱脸确实在平台上托管的一些预训练模型中适应了这一点，但在其他平台上没有。我们实现了处理这两种场景的代码，包括专门为DeBERTa-v2 (xl)构建一个定制的助手函数。</p><h2 id="2605" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">学习率计划</h2><p id="ec2d" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">我们发现，使用定制的学习率时间表对模型的性能有很好的影响。超参数可以在下面看到我们的最佳学习率时间表。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et mp"><img src="../Images/e70a5f7901342b398c4d0fcd40a79eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N7EndsEdlINWJhWh3cW5JA.png"/></div></div><figcaption class="jq jr eu es et js jt bd b be z dy translated">学习率计划—超参数</figcaption></figure><p id="6d2b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这有一个从0到最大值的预热，取决于批次的大小和余弦衰减。我们相信，定制的学习率计划可以优化性能，因为它可以很好地保持预训练的权重，同时针对我们的特定用例进行适当调整。</p><h2 id="fc64" class="ly jw hj bd jx lz ma mb kb mc md me kf ir mf mg kj iv mh mi kn iz mj mk kr ml bi translated">结果</h2><p id="3330" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">我们在<a class="ae ju" href="https://wandb.ai/native/'P2D-NER-2021'/reports/Paper-2-Data--Vmlldzo3MDQ5MjY?accessToken=bkdw23d3lsrhnu9s2wcptvq1cxaktghvoy3hl7kzalrbnd8v8i80a0svksze7awh" rel="noopener ugc nofollow" target="_blank">体重与偏见网站</a>的主页上可以看到一些实验。</p><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et mq"><img src="../Images/8c5a39349833e958c56ac6b86c30ff21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ObjFUyMsXrA3GNw16x_YQ.png"/></div></div><figcaption class="jq jr eu es et js jt bd b be z dy translated">模型的性能—权重和偏差</figcaption></figure><p id="25bc" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们发现，DeBERTa-v2 (xl)模型产生了最佳结果，F1分数为0.95，在大约5个时期和1或2的批量大小下持续实现，但非常消耗资源，因为即使是2020年的高端GPU硬件也无法运行该模型，原因是内存受限。我们不得不利用NVIDIA泰坦RTX GPU和24GB的GPU内存来运行这个模型。即使这样，根据GPU的数量和类型，批次大小也必须减少到每批次1或2个样本，否则运行将耗尽内存。这个模型有9亿个参数可以微调。</p><p id="01e6" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们还在RoBERTa base上取得了良好的结果，F1分数约为0.92，经过约5或6个周期后，根据可用GPU的类型和数量，批量可达16个。这个模型有1.25亿个参数可以微调。</p><p id="8bee" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">因此，RoBERTa base是一个很好的折衷方案，对资源的需求要少得多，性能的降低也非常小。</p><p id="4ff7" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这两个DistiBERT模型是让代码有效运行(包括精简和调试)的很好的模型。这是因为它们重量轻，运行速度快。然而，就推论而言，性能还不足以证明在RoBERTa base上使用它们是正确的。</p><p id="0729" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">DistilBERT的未封装版本比封装版本性能更好。</p><p id="1189" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们认为，如果有更多的训练数据，更大的DeBERTa-v2和RoBERTa模型可能会表现得更好，这是经常发生的情况。</p><h1 id="df9b" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">4.最终模型</h1><p id="0633" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">请看:<a class="ae ju" href="https://github.com/JsyPhil/paper-2-data/blob/main/F4-P2D-NER-CUAD-v1-Final-Model-Workflow.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/JsyPhil/paper-2-data/blob/main/F4-P2D-NER-CUAD-v1-Final-Model-workflow . ipynb</a></p><p id="673b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们使用实验中最有前途的超参数为RoBERTa和DeBERTa-v2 xl训练了最终模型。</p><p id="fc06" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在给定每个型号的GPU内存的情况下，我们使用了最大的批量。RoBERTa和DeBERTa-v2(x1)分别为16和2。</p><p id="7274" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">所使用的优化器是Adam，其学习率如上所述。</p><p id="2648" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们发现两种模型在8个时期后都有最佳性能。尽管如此，我们发现在大约6个时期到最多10个时期之后有相似的性能。</p><p id="b775" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">重要的是，建议对模型用于培训的任何法律合同使用相同的文本预处理。</p><h1 id="0ba3" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">5.推理</h1><p id="b87a" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">请看:<a class="ae ju" href="https://github.com/JsyPhil/paper-2-data/blob/main/F5-P2D-NER-CUAD-v1-Inference.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/JsyPhil/paper-2-data/blob/main/F5-P2D-NER-CUAD-v1-推论. ipynb </a></p><p id="8031" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">该单个笔记本的工作流程提供了以下实际过程:</p><ol class=""><li id="fe4f" class="ky kz hj ii b ij ik in io ir la iv lb iz lc jd ld le lf lg bi translated">在定义的文件夹或位置中搜索任意数量的PDF格式的法律合同，并将其从PDF转换为文本。</li><li id="5aca" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">预处理此文本，以将其纳入微调后的最终模型。</li><li id="9782" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">根据微调后的模型，可以准确预测协议名称、生效日期和合同各方。</li><li id="cc99" class="ky kz hj ii b ij lh in li ir lj iv lk iz ll jd ld le lf lg bi translated">然后，这些预测被转换成结构化的表格格式，并作为CSV文件导出，与文档的全文一起供进一步使用。</li></ol><figure class="jf jg jh ji fe jj es et paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="es et mr"><img src="../Images/fdb29fcba4f90caa90f766ac6b70f92e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wpz1a7GDo7-0hrZyfGR3RQ.png"/></div></div><figcaption class="jq jr eu es et js jt bd b be z dy translated">从NLP模型导出表格数据。</figcaption></figure><h1 id="8f05" class="jv jw hj bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="615f" class="pw-post-body-paragraph ig ih hj ii b ij kt il im in ku ip iq ir kv it iu iv kw ix iy iz kx jb jc jd hc bi translated">我们成功地展示了NLP如何应用于法律、专业和金融领域的一个具体而有价值的用例。我们希望这能激励技术专家、企业高管和经理们继续学习和利用这一重要技术，为他们的企业造福。</p><p id="1836" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><em class="mm">特别感谢</em> <a class="ae ju" href="https://www.linkedin.com/in/malcolm-mason-a901864/" rel="noopener ugc nofollow" target="_blank"> <em class="mm">马尔科姆·梅森</em> </a> <em class="mm">对整个项目的支持和了解。</em></p></div><div class="ab cl lm ln gq lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hc hd he hf hg"><p id="1bcb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">参考资料:</p><p id="ef5e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">(1)伊利亚Chalkidis，Ion Androutsopoulos，和Achilleas Michos。2017.提取合同元素。《人工智能与法律国际会议论文集》，英国伦敦，2017年6月12日至15日(ICAIL'17)，10页。DOI:<br/><a class="ae ju" href="http://dx.doi.org/10.1145/3086512.3086515" rel="noopener ugc nofollow" target="_blank">http://dx.doi.org/10.1145/3086512.3086515</a><br/>【2】arXiv:2010.02559【cs。CL]<br/>(3)arXiv:2101.04355【cs。CL]<br/>(4)arXiv:2103.06268 v1【cs。CL]</p></div></div>    
</body>
</html>