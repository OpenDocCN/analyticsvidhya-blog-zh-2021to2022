<html>
<head>
<title>Predicting HIV Prevalence and its factors: Using ML with purpose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测HIV流行及其影响因素:有目的地使用ML</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/predicting-hiv-prevalence-and-its-factors-using-ml-with-purpose-86e58dd242e0?source=collection_archive---------17-----------------------#2021-08-16">https://medium.com/analytics-vidhya/predicting-hiv-prevalence-and-its-factors-using-ml-with-purpose-86e58dd242e0?source=collection_archive---------17-----------------------#2021-08-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/722118bcfeabdad9e528c39e705f5934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRT7NYh3EnyqXUbIoonFOw.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">来源:https://medicinasa.com.br/hiv-aids-2020/</figcaption></figure><h2 id="4c59" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h2><p id="f600" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">作为<a class="ae it" href="https://learning.edx.org/course/course-v1:UCSanDiegoX+DSE200x+2T2020/home" rel="noopener ugc nofollow" target="_blank"> Python for Data Science </a>课程(UCSanDiegoX on Edx)的一部分，学生们被要求开发并展示一个机器学习项目作为最终任务。</p><p id="2e2d" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">经过深思熟虑，并受到毁灭性的疫情(不，是另一个)的影响，我决定<strong class="ju hi">分析并尝试预测各国的艾滋病流行情况，目的是帮助政府更准确地了解其状况，并制定更好的公共卫生政策来抗击艾滋病毒/艾滋病疫情。</strong></p><h2 id="a209" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">理解问题</h2><p id="a05a" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">感染了人类免疫缺陷病毒(HIV)的人会发展成获得性免疫缺陷综合征(AIDS)。当艾滋病发生时，人体免疫系统可能会受到严重冲击，从而导致其逐渐衰退，最终衰竭。出于这个原因，人体会暴露于其他感染或机会性癌症——这通常不会给免疫系统健康的人带来严重问题。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ks"><img src="../Images/e371212f27ab4345e06de22069ed90bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2EXW-Sp0mdTSf38-ElNfsA.png"/></div></div></figure><p id="6fe4" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">正如我们所看到的，在2007年至2017年的十年间，艾滋病毒/艾滋病在主要死亡原因中排名第九，导致大约6800万人丧生。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="051c" class="iu iv hh ky b fi lc ld l le lf">hiv_df_year = hiv_df[hiv_df["Year"]&gt;=1990].groupby(by ="Year").sum()</span><span id="1a19" class="iu iv hh ky b fi lg ld l le lf">fig, ax = plt.subplots(1,2, figsize=(16,8))</span><span id="8390" class="iu iv hh ky b fi lg ld l le lf">ax[0].plot(hiv_df_year.index,hiv_df_year["Deaths"]/1e6)<br/>ax[0].plot(hiv_df_year.index,hiv_df_year["People living with HIV"]/1e7)<br/>ax[0].plot(hiv_df_year.index,hiv_df_year["New Cases"]/1e6<br/>ax[0].set_title("Evolution of the HIV/AIDS epidemic since 1990")<br/>ax[0].set_xlabel("Year")<br/>ax[0].set_ylabel("Number of People (MM)")<br/>ax[0].legend(["Deaths from HIV/AIDS", "People living with HIV", "Number of New Cases"])<br/>ax[0].grid()</span><span id="469c" class="iu iv hh ky b fi lg ld l le lf">hiv_df_year_pct = hiv_df_year.pct_change()</span><span id="37a8" class="iu iv hh ky b fi lg ld l le lf">ax[1].plot(hiv_df_year_pct)<br/>ax[1].set_title("Rate of Change of the HIV/AIDS pandemic")<br/>ax[1].set_xlabel("Year")</span><span id="a964" class="iu iv hh ky b fi lg ld l le lf">plt.grid()<br/>plt.show()</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/b25b311002a95752e35ed7696c8e76c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9-8-n682iV3vyxoPobdb4Q.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">过去30年疫情艾滋病毒/艾滋病的演变</figcaption></figure><p id="4db3" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">上图中，我们可以通过过去三十年的死亡人数和病例数来观察这种流行病的行为。在90年代，病例和死亡人数急剧上升，呈现出一种几乎无法控制的局面。</p><p id="6693" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">到上一个千年结束时，新病例的趋势发生逆转，六年后，死亡人数随之下降。这可能是由于更高的认识、抗逆转录病毒疗法的发展或防腐剂的使用。</p><p id="6102" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">另一方面，感染艾滋病毒的人数从未停止增加，这表明疫情还没有接近尾声，应该相应地加以解决。</p><p id="78f3" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">目前，有3800万报告病例，没有治愈方法。由于它可能对我们的免疫系统造成损害，艾滋病毒/艾滋病是世界上主要的死亡原因之一，特别是在撒哈拉以南非洲地区。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="8403" class="iu iv hh ky b fi lc ld l le lf">geo = r"archive/custom.geo.json"<br/>geo_json = json.load(open(geo))</span><span id="6ebe" class="iu iv hh ky b fi lg ld l le lf">mapa = f.Map(<br/>width=1000, height=700,<br/>zoom_start=3<br/>)</span><span id="7009" class="iu iv hh ky b fi lg ld l le lf">f.Choropleth(<br/>geo_data=geo_json,<br/>name='choropleth',<br/>data=HIV_Prevalence[HIV_Prevalence["Year"]==2019],<br/>bins=[0,0.5, 1, 2, 5, 10, 20, 30],<br/>columns=['Country', "HIV Prevalence"],<br/>key_on = "feature.properties.name",<br/>fill_color="YlGn",<br/>nan_fill_color = "white",<br/>fill_opacity=0.7,<br/>line_opacity=0.2,<br/>legend_name='HIV Prevalence').add_to(mapa)</span><span id="cc2f" class="iu iv hh ky b fi lg ld l le lf">mapa</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/010f6e2f14f3291ff6483c83ebcdf02a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQwOkGCB-sEWW03Hx8P7xQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">UNAIDS提供了全球艾滋病流行的年度估计，我们可以看到，撒哈拉以南非洲地区的艾滋病流行尤为严重。覆盖了埃斯瓦蒂尼(前斯威士兰)28%以上的人口！</figcaption></figure><p id="d594" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">由于疫情在非洲特别活跃，我对大陆列进行了编码，以表明该国是否属于这个大陆。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="e3e3" class="iu iv hh ky b fi lc ld l le lf">country_df = pd.read_csv(r"archive/continents.csv")<br/>country_df.rename(columns={"Code":"StateAbb"}, inplace = True)<br/>country_df = country_df.query('Continent != "Antarctica"')<br/>other =<br/>country_df[~country_df["Continent"].isin({"Africa"})].loc[:,"Continent"].unique()<br/>country_df.replace(to_replace=other, value="Other", inplace = True)<br/>country_df = pd.get_dummies(country_df, columns = ["Continent"], drop_first= True)<br/>country_df.drop(columns = ["StateAbb"], inplace = True)</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es lj"><img src="../Images/fd0ab3ac3f523f3d96432567f80c329a.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*6F_lDE3-kG_8HrcSvaY09Q.png"/></div></figure><h2 id="9e6a" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">探索可能影响疫情的因素</h2><p id="7588" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">为了探索新病例数量下降的原因，我寻找了感染艾滋病毒和接受抗逆转录病毒治疗的人口比例，以便将这两个变量联系起来。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es lk"><img src="../Images/cb005ce993bce9128354c1d870d412d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*YSdBqHXKjPHtNGWRT3T3iA.png"/></div></figure><p id="7d6d" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">此外，宗教对人们的性生活行为起着重要的作用。所以我想，宗教偏好是否也是计算艾滋病流行率的一个重要特征。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es ll"><img src="../Images/05a47946ce74bc8591025da016e2319d.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*8g0f2ELcWY1x8eHcIq441w.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">2/3的国家主要是基督教，1/4的国家是伊斯兰教，其次是佛教和其他宗教，主要分布在东南亚。</figcaption></figure><p id="fedf" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">我再次使用热编码将宗教信息转换成数字，小心地删除其中一列以避免多重共线性。</p><p id="174a" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">接下来，我添加了我认为与确定艾滋病毒流行率相关的其他特征:</p><ul class=""><li id="e7e4" class="lm ln hh ju b jv kn jz ko jf lo jj lp jn lq km lr ls lt lu bi translated">人均GDP:一个富裕的国家应该有更多的资源来争夺疫情。</li><li id="d831" class="lm ln hh ju b jv lv jz lw jf lx jj ly jn lz km lr ls lt lu bi translated">小学毕业率:受教育程度较高的人群可能接受过某种形式的性教育，这会让他们更加关注自己的健康状况。</li><li id="c11f" class="lm ln hh ju b jv lv jz lw jf lx jj ly jn lz km lr ls lt lu bi translated">女性就业率:经济上和社会上更独立的女性人口可能也更了解自己的健康状况，更不容易做出危险的行为。</li></ul><p id="af60" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">现在我们已经有了构建模型所需的所有数据，让我们将它们全部合并起来。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="fde8" class="iu iv hh ky b fi lc ld l le lf">df = pd.merge(art_coverage, GDP_per_capita, on=["Country", "Year"])<br/>df = pd.merge(df, median_age, on=["Country", "Year"])<br/>df = pd.merge(df, primary_completion_rate_total_percent_of_relevant_age_group, on = ["Country","Year"])<br/>df = pd.merge(df, gov_share_health, left_on = ["Country", "Year"], right_on = ["Country Name", "Year"])<br/>df = pd.merge(df, religion_preference, on = "Country")<br/>df = pd.merge(df, woman_employed, on = ["Country","Year"])<br/>df = pd.merge(df, country_df, on = "Country")<br/>df = pd.merge(HIV_Prevalence[["HIV Prevalence", "Country", "Year"]], df,on=["Country", "Year"])</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ma"><img src="../Images/fe8003c90013ce54b778b51876038565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXXe-zklOTumzUdnoUlymA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx translated">回归模型的最终数据框，有593行和12列。</figcaption></figure><p id="cd3d" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">接下来，检查是否有丢失的值(正如您在上面看到的，答案是肯定的)并处理它们是很重要的。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="b53a" class="iu iv hh ky b fi lc ld l le lf">df.isna().sum()</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mb"><img src="../Images/376256bd9b2eb18a94ac3bcf0868b979.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*bI5UEx2ZiUktLFTfhYD_kg.png"/></div></figure><p id="37f5" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">因为只有几行有空值(4.5%)，所以删除它们是可以接受的，并且不会导致太多的数据丢失。</p><h2 id="963f" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">预测艾滋病毒流行率</h2><p id="8bb8" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">是时候建立我们的模型并预测艾滋病毒的流行，以帮助(也许？)政府更好地解决这个问题。</p><p id="a123" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">在进行任何拟合之前，选择一个指标来评估我的回归模型的性能并计算基线误差，也就是说，一个天真的预测会给出的误差，这很重要。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="c2d2" class="iu iv hh ky b fi lc ld l le lf">y, X = df.iloc[:, 0], df.iloc[:,2:]</span><span id="a158" class="iu iv hh ky b fi lg ld l le lf">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state = 42)</span><span id="3a47" class="iu iv hh ky b fi lg ld l le lf">baseline_MAE = mean_absolute_error(y_true = y_test, y_pred = [y_test.mean()]*len(y_test))</span><span id="c0af" class="iu iv hh ky b fi lg ld l le lf">print(f"Baseline Mean Absolute Error (MAE): {baseline_MAE:.2f}")</span></pre><p id="0cb6" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">基线平均绝对误差(MAE): 3.85 </p><p id="0ba0" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">由于在训练和测试数据之间没有太多的数据要分割，我使用cross_val_score结合shuffle split permutation来计算决策树回归模型的平均MAE分数。我选择这种类型的模型是因为它的简单性和可解释性，但我确实打算以后使用其他模型。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="63fa" class="iu iv hh ky b fi lc ld l le lf">treeregressor = DecisionTreeRegressor(criterion = "mae")</span><span id="9425" class="iu iv hh ky b fi lg ld l le lf">cv = ShuffleSplit(n_splits=6, random_state=42)</span><span id="ca6d" class="iu iv hh ky b fi lg ld l le lf">scores = cross_val_score(treeregressor, X, y,scoring = "neg_mean_absolute_error", cv=cv)</span><span id="5533" class="iu iv hh ky b fi lg ld l le lf">print(f"Mean MAE using CV: {-scores.mean():.2f} with standard deviation of {scores.std():.2}")</span></pre><p id="eb99" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">使用CV为0.33，标准偏差为0.11，得到的结果是<strong class="ju hi">平均MAE。</strong>由于最终误差约为基线的10%,我对此很满意。与误差的平均值相比，标准差很高，但与<strong class="ju hi">艾滋病毒流行率的平均值(2.75%)相比，标准差却很高。</strong></p><h2 id="a5eb" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">包装它</h2><p id="cfa9" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km ha bi translated">最后，我探索了哪些特征是决策树分支分裂的最大决定因素。</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="8b6b" class="iu iv hh ky b fi lc ld l le lf">treeregressor.feature_importances_</span></pre><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mc"><img src="../Images/179583df335d367140db78708a8c185e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*vrNyTOwIQ5aZLQNxiz6p-g.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx translated">预测艾滋病流行的重要特征</figcaption></figure><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/d8f1725fc330967a5fe31e5f3274b1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rfT4-eRILbXIALTc_AYvXQ.png"/></div></div></figure><p id="4f29" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">我惊讶地发现，女性就业与总人口的比率是最关键的因素(0.26)，比人均国内生产总值(0.23)、抗逆转录病毒疗法覆盖率(0.02)和小学毕业率(0.01)更重要。</p><p id="085e" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">那都是乡亲们！这是我的第一个项目，也是一个非常具有挑战性的项目，因为我必须找到所有的数据，然后将它们缝合在一起。你可以仔细看看用于这个项目的<a class="ae it" href="https://drive.google.com/file/d/1LXjaqfxOnQIO2EdyexZp-v-5us0soLDN/view?usp=sharing" rel="noopener ugc nofollow" target="_blank"> Colab笔记本</a>，并通过<a class="ae it" href="https://www.linkedin.com/in/pedro-figueiredo-77377872/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>与我联系。</p><p id="a0c6" class="pw-post-body-paragraph js jt hh ju b jv kn jx jy jz ko kb kc jf kp ke kf jj kq kh ki jn kr kk kl km ha bi translated">编辑:<a class="me mf ge" href="https://medium.com/u/969a98a2d325?source=post_page-----86e58dd242e0--------------------------------" rel="noopener" target="_blank"> Nicofrancosaa </a>很好地向我询问了所收集数据的来源。由于我无法找到这个项目所需的数据集，我不得不构建它，因此数据来自不同的来源:</p><ul class=""><li id="cd34" class="lm ln hh ju b jv kn jz ko jf lo jj lp jn lq km lr ls lt lu bi translated">艾滋病毒流行率、妇女就业与人口比率、人均国内生产总值和小学毕业率— <a class="ae it" href="https://databank.worldbank.org/source/world-development-indicators" rel="noopener ugc nofollow" target="_blank">世界银行</a></li><li id="f64f" class="lm ln hh ju b jv lv jz lw jf lx jj ly jn lz km lr ls lt lu bi translated">按死因分列的死亡人数— <a class="ae it" href="https://ourworldindata.org/hiv-aids" rel="noopener ugc nofollow" target="_blank">数据中的世界</a></li><li id="a252" class="lm ln hh ju b jv lv jz lw jf lx jj ly jn lz km lr ls lt lu bi translated">抗逆转录病毒疗法覆盖率、中位年龄和政府卫生支出占卫生总支出的百分比——世卫组织<a class="ae it" href="https://www.who.int/data/gho/indicator-metadata-registry/imr-details/92" rel="noopener ugc nofollow" target="_blank"/></li><li id="4669" class="lm ln hh ju b jv lv jz lw jf lx jj ly jn lz km lr ls lt lu bi translated">宗教偏好— <a class="ae it" href="https://www.thearda.com/Archive/Files/Downloads/WRPGLOBL_DL2.asp" rel="noopener ugc nofollow" target="_blank"> ARDA </a></li></ul></div></div>    
</body>
</html>