<html>
<head>
<title>Categorical Feature Encoding in SAS (Bayesian Encoders) — By Suraj Saini</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SAS(贝叶斯编码器)中的分类特征编码</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/categorical-feature-encoding-in-sas-bayesian-encoders-by-suraj-saini-ffd83e7c32a5?source=collection_archive---------14-----------------------#2021-02-19">https://medium.com/analytics-vidhya/categorical-feature-encoding-in-sas-bayesian-encoders-by-suraj-saini-ffd83e7c32a5?source=collection_archive---------14-----------------------#2021-02-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/ec4b9297f82ad4cf48e2db2691fd6f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9F5me6LdtKcAhJDR.jpg"/></div></div></figure><h2 id="b73d" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">什么是贝叶斯编码？</h2><p id="3c3b" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">贝叶斯编码是一种在对分类变量进行编码时考虑类别内变异和目标均值的编码。这是一种有针对性的编码，有几个优点。例如，与其他编码方法相比，贝叶斯编码需要最少的努力。</p><p id="7dbb" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">在这篇博文中，我们将讨论不同的贝叶斯编码技术以及它们是如何工作的。</p><p id="193f" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">1.目标/均值编码</p><p id="1cfa" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">目标或均值编码是Kaggle竞赛中最常用的编码技术之一。</p><p id="aeab" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">目标编码是相对于训练数据集中的分类类，用目标变量的平均值替换分类变量的每个类值。</p><p id="55ef" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">因此，我们必须在SAS Mean编码宏中指定目标变量，如下面的代码所示。</p><p id="8f41" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">查看这个链接，了解关于分类变量编码的更多信息。</p><p id="d0d3" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><em class="ko">目标/均值编码的SAS宏</em></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5ebb" class="ip iq hh ku b fi ky kz l la lb">%macro mean_encoding(dataset,var,target); <br/>proc sql; <br/>create table mean_table as select distinct(&amp;var) as gr, round(mean(&amp;target),00.1) As mean_encode <br/>from &amp;dataset group by gr; </span><span id="08a4" class="ip iq hh ku b fi lc kz l la lb">create table new as select d.* , m.mean_encode  <br/>from &amp;dataset as d left join mean_table as mon &amp;var=m.gr;<br/>quit; <br/>%mend;</span></pre><p id="590d" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">2.证据权重编码</p><p id="a9db" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">证据权重(WoE)是一种用于区分好坏的分组技术的“<strong class="jp hi">强度</strong>的度量。开发这种方法主要是为了建立一个预测模型来评估信贷和金融行业的贷款违约风险。</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div class="er es ld"><img src="../Images/cb9602d1a1dda705b09deb0f37f53516.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/0*LrOvP-KMmgGQ_WsU"/></div></figure><p id="58c8" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">如果P(货物)/ P(货物)= 1，则WoE为0。也就是说，如果结果是随机的。如果P(Bads) &gt; P(Goods)，那么一组中的赔率会是&lt; 1, and the WoE will be &lt; 0. If, on the other hand, P(Goods) &gt; P(Bads)，那么WoE &gt; 0。</p><p id="fb46" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">WoE非常适合逻辑回归，因为logit转换只是概率的对数，即(P(货物)/P(货物))。因此，通过在逻辑回归中使用WoE编码的预测因子，所有的预测因子都是按照相同的尺度准备和编码的。线性逻辑回归方程中的参数可以直接比较“实际定义在这里<a class="ae kn" href="https://towardsdatascience.com/all-about-categorical-variable-encoding-305f3361fd02" rel="noopener" target="_blank">编码</a>。</p><p id="a005" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><em class="ko">证据权重编码的SAS宏</em></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="1e78" class="ip iq hh ku b fi ky kz l la lb">%macro woe_encoding(dataset,var,target); <br/>proc sql noprint; create table stats as select distinct(&amp;var) as gr, round(mean(&amp;target),00.1) as mean_encode from &amp;dataset group by gr; quit; </span><span id="26cd" class="ip iq hh ku b fi lc kz l la lb">data stats; <br/>set stats; <br/>bad_prob=1-mean_encode; <br/>if bad_prob=0 then bad_prob=0.0001; <br/>me_by_bp=mean_encode/bad_prob; <br/>woe_encode=log(me_by_bp); <br/>run; </span><span id="ed25" class="ip iq hh ku b fi lc kz l la lb">proc sql noprint; <br/>create table new as select d.* , s.woe_encode <br/>from &amp;dataset as d left join stats as s on &amp;var=s.gr; <br/>quit; <br/>%mend;</span></pre><p id="bbbf" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">3.概率比编码</p><p id="3c5b" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">“概率比编码”类似于证据权重，唯一的区别是使用了好的和坏的概率比。对于每个标签，我们计算target=1的平均值，即为1的概率(P(1))，以及target=0的概率(P(0))。然后，我们计算比率P(1)/P(0)并用该比率替换标签。</p><p id="e763" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">我们需要为P(0)添加一个最小值，以避免任何被零除的情况，在这种情况下，对于任何特定的类别，都没有target=0。查看此链接了解更多信息。</p><p id="660b" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><em class="ko">概率比编码的SAS宏</em></p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="8912" class="ip iq hh ku b fi ky kz l la lb">%macro probability_encoding(dataset,var,target);<br/>proc sql noprint; create table stats as select distinct(&amp;var) as gr, round(mean(&amp;target),00.1) as mean_encode from &amp;dataset <br/>group by gr; <br/>quit; </span><span id="46a9" class="ip iq hh ku b fi lc kz l la lb">data stats; <br/>set stats; <br/>bad_prob=1-mean_encode; <br/>if bad_prob=0 then bad_prob=0.0001; prob_encode=mean_encode/bad_prob; <br/>run; </span><span id="1955" class="ip iq hh ku b fi lc kz l la lb">proc sql noprint; <br/>create table new as select d.* , s.prob_encode <br/>from &amp;dataset as d left join stats as s on &amp;var=s.gr; <br/>quit; <br/>%mend;</span></pre><p id="e51b" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><em class="ko">收尾</em></p><p id="a2c5" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">分类特征编码是为机器学习模型清理数据的重要部分。然而，每种方法在不同的环境下工作，所以了解贝叶斯分类下的不同技术是很重要的。</p><p id="58fc" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">如果你想看看编码是如何在SAS环境下运行的，你可以在我的GitHub页面<a class="ae kn" href="https://github.com/Selerity/blog-categorical-feature-encoding-bayesian" rel="noopener ugc nofollow" target="_blank">这里</a>找到所有的SAS宏定义代码。</p></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><p id="e870" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><em class="ko">原载于2021年2月19日https://seleritysas.com</em><em class="ko">的</em> <a class="ae kn" href="https://seleritysas.com/blog/2021/02/19/categorical-feature-encoding-in-sas-bayesian-encoders/" rel="noopener ugc nofollow" target="_blank"> <em class="ko">。</em></a></p></div></div>    
</body>
</html>