<html>
<head>
<title>Color Channels and Histograms in OpenCV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenCV中的颜色通道和直方图</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/color-channels-and-histograms-in-opencv-23d2338e4035?source=collection_archive---------9-----------------------#2021-09-10">https://medium.com/analytics-vidhya/color-channels-and-histograms-in-opencv-23d2338e4035?source=collection_archive---------9-----------------------#2021-09-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="f154" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">颜色通道</strong></h1><p id="9411" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">数字图像由像素组成，这些像素是原色的组合。颜色通道存储一种这样的颜色的颜色信息。不同种类的数字图像有不同的颜色通道。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/c420a4ddeadf8e41338ae1c7e81374cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uq8H6mFnUJeUkpWo-6NQfQ.png"/></div></div></figure><p id="ade8" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">特定颜色通道的亮度决定了图片中该颜色的强度。在蓝色通道中，蓝色部分比其他通道亮得多。红色通道中的红色花朵相对较亮，绿色通道中图片的绿色部分也是如此。</p><p id="6a5d" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">类似地，在YUV图像中，Y通道关联感知强度，而U和V关联颜色信息。对于CYMK图像，通道用于青色、黄色、品红色和黑色。每个颜色通道有100个强度级别。</p><h1 id="61df" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">直方图</h1><p id="c79b" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">直方图通常是数据分布的图形表示。图像直方图给出了数字图像中颜色强度计数的图形表示。它还可以计算其他特征，如方向和梯度以及强度。它没有给出像素位置的指示。x轴表示变量值的范围。这个范围可以被分成一系列被称为箱的间隔。y轴显示有多少值落在该间隔或区间内。</p><p id="07d3" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">绘制直方图时，X轴是像素强度，Y轴是频率。和其他直方图一样，我们可以决定使用多少个面元。</p><p id="4862" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">可以为灰度图像和彩色图像计算直方图。在第一种情况下，我们只有一个通道，因此只有一个直方图。在第二种情况下，我们有3个通道，因此有3个直方图。</p><p id="4775" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">计算图像的直方图非常有用，因为它给出了关于图像的一些属性的直觉，例如色调范围、对比度和亮度。</p><h1 id="b2ef" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">为RGB图像创建直方图</h1><p id="f1c3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">为了创建直方图，我们加载我们需要创建直方图的源图像并将它们分成三个通道；分别为蓝色(B)、绿色(G)和红色(R)。</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="2304" class="kw if hh ks b fi kx ky l kz la">string path = ; <br/>Mat img= imread(path); <br/>vector &lt;Mat&gt; bgr_planes; <br/>split(img,bgr_planes);</span></pre><p id="ef08" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">我们必须初始化直方图的大小，它是256，因为RGB有256个强度级别。它的范围也是从0到255。直方图的范围应初始化为:</p><p id="3b96" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">这样做是因为我们的CalcHist函数只接受直方图范围的双指针。直方图的大小、高度、宽度都是整数。calcHist的输出存储在三个通道的Mat类变量中。</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="5b46" class="kw if hh ks b fi kx ky l kz la">int Size=256,height=512,width=400; <br/>Mat blueH,greenH,redH;</span></pre><p id="69b6" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">我们希望我们的箱柜有相同的大小，并清除直方图，如果有任何建立在这之前。</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="f889" class="kw if hh ks b fi kx ky l kz la">bool uniform = true, accumulate = false;</span></pre><p id="b8ea" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">calcHist函数总共有10个参数。这些是为每个通道单独计算的。(B、G和R)</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="2f61" class="kw if hh ks b fi kx ky l kz la">calcHist(&amp;bgr_planes[0],1,0,Mat(),blueH,1,&amp;histSize,&amp;histRange,uniform,accumulate); calcHist(&amp;bgr_planes[1],1,0,Mat(),greenH,1,&amp;histSize,&amp;histRange,uniform,accumulate); calcHist(&amp;bgr_planes[2],1,0,Mat(),redH,1,&amp;histSize,&amp;histRange,uniform,accumulate);</span></pre><p id="988a" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">这些论点是</p><ul class=""><li id="2c1e" class="lb lc hh je b jf km jj kn jn ld jr le jv lf jz lg lh li lj bi translated"><strong class="je hi"> &amp; bgr_planes </strong>:源图像</li><li id="f1ed" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi"> 1: </strong>我们使用的图片数量</li><li id="f68f" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi"> 0: </strong>要测量的维数。只测量强度，所以它是0。</li><li id="683b" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi">()</strong>:用于屏蔽，即决定分析图像的哪一部分。空遮罩意味着我们正在检查整个图像。</li><li id="5e97" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi"> blueH </strong>:这是存储函数输出的地方。</li><li id="1ecc" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi"> 1: </strong>输出直方图的维数。这是2D，所以我们写一个。</li><li id="637c" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi"> histSize: </strong>确定用于测量inensity的箱数。</li><li id="71c3" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi">历史范围:</strong>要测量的数值范围</li><li id="5aaa" class="lb lc hh je b jf lk jj ll jn lm jr ln jv lo jz lg lh li lj bi translated"><strong class="je hi">累加和统一:</strong>箱尺寸保持统一，直方图被清除。</li></ul><p id="0770" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">然后，我们创建一个图像来显示直方图，并制作一个合适的面元大小:</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="550b" class="kw if hh ks b fi kx ky l kz la">int bin = cvRound((double)width/Size);<br/>Mat Image(height,width, CV_8UC3,Scalar(0,0,0));</span></pre><p id="9ea9" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">其中，CV_8UC3是具有3个通道的8位无符号整数矩阵。重要的是归一化直方图，使值落在特定范围内。</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="d9f1" class="kw if hh ks b fi kx ky l kz la">normalize(blueH, blueH, 0, histImage.rows, NORM_MINMAX, -1, Mat() ); normalize(greenH, greenH, 0, histImage.rows, NORM_MINMAX,-1,Mat() );<br/>normalize(redH, redH, 0, histImage.rows, NORM_MINMAX, -1, Mat() );</span></pre><p id="bcd8" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">我们现在为各个颜色通道绘制直方图:</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="bda5" class="kw if hh ks b fi kx ky l kz la">for( int i = 1; i &lt; histSize; i++ )                          <br/> {                              <br/> line( Image,Point( bin*(i), height - cvRound(blueH.at&lt;float&gt;(i))),                                     Point( bin*(i+1), height - cvRound(blueH.at&lt;float&gt;(i+1))),                                     Scalar( 255, 0, 0), 2, 8, 0  );         <br/>                      <br/>line( Image, Point( bin*(i),height - cvRound(greenH.at&lt;float&gt;(i))),                                     Point( bin*(i+1), height - cvRound(greenH.at&lt;float&gt;(i+1)) ),                                     Scalar( 0, 255, 0), 2, 8, 0  );      <br/>                         <br/>line( Image, Point( bin*(i), height - cvRound(redH.at&lt;float&gt;(i))),                                     Point( bin*(i+1), height - cvRound(redH.at&lt;float&gt;(i+1)) ),                                     Scalar( 0, 0, 255), 2, 8, 0  );                          <br/> }</span></pre><p id="c800" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">直方图以这种方式绘制:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div class="er es lp"><img src="../Images/ea1354a1bdb83606bfd0472513c30796.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*ogxmc8uqNLe5E6N7IjNFYA.png"/></div></figure><p id="e03c" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">浅色和深色图像样本的直方图如下所示:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lq"><img src="../Images/36e1fd78a87039d9e3371b309d7fd0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_bW_fS75ySPaitQv_2WXQ.png"/></div></div></figure><p id="10e6" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">从暗色调图像的图中，我们可以推断出通道具有非常低的像素强度，对应于图像中存在的深蓝色和黑色的量。这里的直方图向左倾斜，指的是原点附近的低强度。如果大部分像素位于图像的左侧，很有可能是您的图像曝光不足，并且太暗，缺少阴影区域的细节。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lr"><img src="../Images/652321968b85d1ae64e7da522a468ddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CnkvbcFGZkECgyKYZ9lLmQ.png"/></div></div></figure><p id="7cf6" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">从浅色调图像的图中，我们可以推断出通道具有非常高的像素强度，对应于图像中存在的浅肤色和黄色色素的量。这里的直方图向右倾斜，指的是高强度。如果大部分像素位于右侧，则照片很可能曝光过度，并且在图像的明亮部分很少或没有细节。</p><h1 id="23f2" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">灰度图像的直方图</h1><p id="8c4a" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">为了确定灰度图像的直方图，我们需要对上面的代码做一些修改。没有必要将图像分割成通道，但是需要将源图像转换成灰度。</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="51b5" class="kw if hh ks b fi kx ky l kz la">cvtColor(src,grey,COLOR_BGR2GRAY);</span></pre><p id="db8a" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">在尝试制作灰度图像时，我们还应确保绘制直方图的图像初始化如下:</p><pre class="kb kc kd ke fd kr ks kt ku aw kv bi"><span id="d003" class="kw if hh ks b fi kx ky l kz la">Mat Image(height,width, CV_8UC1,Scalar(0,0,0));</span></pre><p id="ebdc" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">其中，CV_8UC1是一个带1个通道的8位无符号整数矩阵。</p><p id="5268" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">样本灰度图像及其各自的直方图如下所示:</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ls"><img src="../Images/ed9541e683be55903b61002cf442f32a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mr9Coc_pZPatgb2lUleQWw.png"/></div></div></figure><p id="80ee" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">具有低对比度的图像通常在直方图上具有尖锐的峰值，而具有更高对比度的图像将具有更圆的峰值。从上图我们可以看出像素强度是如何影响图像对比度的。对于低对比度图像，我们可以看到大部分直方图集中在图表的一侧，即，对于低对比度图像，没有很多明显的强度。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es lt"><img src="../Images/d18a465ab780d1153c2d19b3acfb8219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVb45wJLWt3Vi-T8P4J0AQ.png"/></div></div></figure><p id="7199" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated">类似地，对于高对比度图像，很明显整个直方图是分散的，这意味着高对比度图像在其图像像素中具有更多不同数量的强度。</p></div><div class="ab cl lu lv go lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ha hb hc hd he"><p id="56e5" class="pw-post-body-paragraph jc jd hh je b jf km jh ji jj kn jl jm jn ko jp jq jr kp jt ju jv kq jx jy jz ha bi translated"><strong class="je hi">参考文献:</strong></p><div class="mb mc ez fb md me"><a href="https://docs.opencv.org/4.5.1/d8/dbc/tutorial_histogram_calculation.html" rel="noopener  ugc nofollow" target="_blank"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hi fi z dy mj ea eb mk ed ef hg bi translated">OpenCV:直方图计算</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">上一教程:直方图均衡化下一教程:直方图比较在本教程中，您将学习如何:使用…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">docs.opencv.org</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms kk me"/></div></div></a></div><div class="mb mc ez fb md me"><a rel="noopener follow" target="_blank" href="/@rndayala/image-histograms-in-opencv-40ee5969a3b7"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hi fi z dy mj ea eb mk ed ef hg bi translated">OpenCV中的图像直方图</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">使用OpenCV了解图像直方图</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">medium.com</p></div></div><div class="mn l"><div class="mt l mp mq mr mn ms kk me"/></div></div></a></div><div class="mb mc ez fb md me"><a rel="noopener follow" target="_blank" href="/@feraguilari/histograms-in-data-science-fdb30af97e21"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hi fi z dy mj ea eb mk ed ef hg bi translated">数据科学中的直方图</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">直方图类似于垂直条形图。然而，直方图描述了一组离散的或不连续的潜在频率</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">medium.com</p></div></div><div class="mn l"><div class="mu l mp mq mr mn ms kk me"/></div></div></a></div></div></div>    
</body>
</html>