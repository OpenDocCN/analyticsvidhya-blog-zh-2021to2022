<html>
<head>
<title>How to Scrape Table from Website using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python从网站上抓取表格</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-scrape-a-table-from-website-using-python-ce90d0cfb607?source=collection_archive---------0-----------------------#2021-10-04">https://medium.com/analytics-vidhya/how-to-scrape-a-table-from-website-using-python-ce90d0cfb607?source=collection_archive---------0-----------------------#2021-10-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fece" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" rel="noopener" href="/analytics-vidhya/how-to-scrape-data-from-a-website-using-python-for-beginner-5c770a1fbe2d">在之前的</a>中，我们已经了解了在网站上收集数据的基本知识，但是您知道我们还可以收集表格形式的数据吗？如果你经常上网，你可能会注意到许多网站都有数据表。例如航班时刻表、产品特性、服务差异、电视节目时间表、排名等等。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/ca953ecc5c5b2e2462c3871abc6823b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ufOF3B0iyHPPDkOX5THqmg.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图1 Similarweb.com数据表</figcaption></figure><p id="7017" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在某些情况下，不需要编码就可以很容易地将表格复制并粘贴到excel中，但是作为数据科学家，我们需要理解，在未来我们将处理更大的数据，而复制粘贴方法并不真正有效。所以现在我将向你展示如何从一个网站上抓取一个数据表。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="0aeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步。安装库</strong></p><p id="d452" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要在我们的环境中安装这些必需的库:</p><ol class=""><li id="5c00" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">BeautifulSoup4</li><li id="4ffb" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">要求</li><li id="dcc1" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">熊猫</li><li id="eb5f" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">lxml</li></ol><p id="5add" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你在这一步有困难，我推荐你阅读之前的教程<a class="ae jd" rel="noopener" href="/analytics-vidhya/how-to-scrape-data-from-a-website-using-python-for-beginner-5c770a1fbe2d">如何从网站上抓取数据给初学者</a>。</p><p id="7a49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步。导入所需的库</strong></p><p id="01fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在重要的库安装完成后，我们接下来要做的就是打开Spyder。我使用Spyder的原因是它对于项目来说使用起来更舒服，但是如果你有自己的偏好也是可以的。</p><p id="1b56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，一旦我们打开Spyder，接下来我们可以做的就是导入所需的库:</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="9851" class="ku kv hi kq b fi kw kx l ky kz"># Import libraries<br/>import requests<br/>from bs4 import BeautifulSoup<br/>import pandas as pd</span></pre><p id="7430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步。选择页面</strong></p><p id="aacb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个项目中，我们将从<a class="ae jd" href="https://www.worldometers.info/coronavirus/" rel="noopener ugc nofollow" target="_blank"> Worldometers </a>中抓取covid数据表。和之前的教程一样，这个网站也被认为是对初学者来说更容易理解，因为它是用HTML制作的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es la"><img src="../Images/fcc993f70f18572a683b421fd60f6388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BI1YCgLXyPx0ikFRhOBJWQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图2 COVID数据表</figcaption></figure><p id="0198" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步。请求许可</strong></p><p id="966d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们选择了我们想要抓取的页面后，现在我们可以复制页面的URL并使用<strong class="ih hj">请求</strong>请求主机服务器允许我们从他们的站点获取数据。</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="8490" class="ku kv hi kq b fi kw kx l ky kz"># Create an URL object<br/>url = '<a class="ae jd" href="https://www.worldometers.info/coronavirus/'" rel="noopener ugc nofollow" target="_blank">https://www.worldometers.info/coronavirus/'</a></span><span id="5426" class="ku kv hi kq b fi lb kx l ky kz"># Create object page<br/>page = requests.get(url)</span></pre><p id="b3a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果输出是<strong class="ih hj"> &lt;响应【200】&gt;</strong>这意味着服务器允许我们从他们的网站收集数据。在我们获得服务器的许可后，我们需要使用<strong class="ih hj"> lxml </strong>来解析HTML代码，使其更具可读性。</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="6947" class="ku kv hi kq b fi kw kx l ky kz"># parser-lxml = Change html to Python friendly format<br/># Obtain page's information<br/>soup = BeautifulSoup(page.text, 'lxml')<br/>soup</span></pre><p id="ad3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤五。检查表格元素</strong></p><p id="ceea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<a class="ae jd" rel="noopener" href="/analytics-vidhya/how-to-scrape-data-from-a-website-using-python-for-beginner-5c770a1fbe2d">之前的文章</a>中，我们已经学习了如何检查网站页面中的每个元素，所以我假设你已经理解了如何使用它。为了获得信息，我们需要首先检查桌子的位置。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lc"><img src="../Images/b62a0ff2c903a88616a8ad56a06b5bdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FAY5C78rrcAdEtnUQyzwGQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图3桌子位置</figcaption></figure><p id="6fb5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图中我们可以看到，那张表位于<strong class="ih hj"> &lt;表下&gt; </strong>标签和<strong class="ih hj">id = ' main _ table _ countries _ today '。</strong>找到表格的位置后，我们现在可以定义变量了。在本节中，我们将表格定义为<strong class="ih hj">‘table 1’</strong>。</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="d9e9" class="ku kv hi kq b fi kw kx l ky kz"># Obtain information from tag &lt;table&gt;<br/>table1 = soup.find(‘table’, id=’main_table_countries_today’)<br/>table1</span></pre><p id="1adc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第六步。创建列列表</strong></p><p id="5944" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">表1 </strong>创建完成后，我们接下来要做的就是检查每一列的位置。如果我们仔细观察每一列，我们会发现它们具有相同的特征。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ld"><img src="../Images/53135c10722cf764f6a358b97640416f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3RIQjVlvfUrSwQtLE7eDNw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图4列</figcaption></figure><p id="2b8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上图中，我们可以看到每一列的特点是它们位于标签<strong class="ih hj"> &lt; th &gt;下。</strong></p><p id="0cd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">找到每一列的标签后，接下来我们可以做的是创建一个for循环，用每一列填充一个空列表。我们将空列表定义为<strong class="ih hj">标题</strong></p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="f2a4" class="ku kv hi kq b fi kw kx l ky kz"># Obtain every title of columns with tag &lt;th&gt;<br/>headers = []<br/>for i in table1.find_all(‘th’):<br/> title = i.text<br/> headers.append(title)</span></pre><p id="881b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es le"><img src="../Images/fefb9398345775b281159f66e8dfce3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*IJe4Y0cCDpw716Ncq2bFBA.jpeg"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图5标题</figcaption></figure><p id="66b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在列表成功地填充了列之后，现在我们可以再次检查。让我们看看索引13，我们找到了换行文本。当我们想用它来制作一个数据框时，像这样的换行文本可能是一个问题，所以我们需要将它转换成单行文本。</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="e44a" class="ku kv hi kq b fi kw kx l ky kz"># Convert wrapped text in column 13 into one line text<br/>headers[13] = ‘Tests/1M pop’</span></pre><p id="6ba1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lf"><img src="../Images/55e2c4d88e4b42f70df9f9057718fbd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*EoxYUpX24FBfOwYA2sn2Ng.jpeg"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图6索引13已修复</figcaption></figure><p id="ceeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第七步。创建一个数据框</strong></p><p id="c7ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列列表完成后，我们接下来要做的就是创建一个数据框架。我们将数据帧定义为<strong class="ih hj"> mydata。</strong></p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="df97" class="ku kv hi kq b fi kw kx l ky kz"># Create a dataframe<br/>mydata = pd.DataFrame(columns = headers)</span></pre><p id="6394" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第八步。创建一个FOR循环来填充数据帧</strong></p><p id="5b80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建数据框架后，我们可以在每一列中填充项目。在创建for循环之前，我们需要首先确定行和项列的位置。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lg"><img src="../Images/77aff31ea76d480a971bf95295056db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3b0fFnJ_GKCDNCbJxt3VLA.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图7行的位置</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lh"><img src="../Images/5e10f527b4ec7e61fb42f3b287f15daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b-yFsu-q2XHOA3zc_9vTgQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图8项目栏的位置</figcaption></figure><p id="77a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上图我们可以看出，该行位于标签<strong class="ih hj">&lt;&gt;</strong>下，项目位于标签<strong class="ih hj"> &lt; td &gt; </strong>下。<strong class="ih hj"> </strong>这适用于表格内的所有行和项目。</p><p id="2474" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">找到标签后，现在我们可以为循环创建一个<strong class="ih hj">。</strong></p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="1d4a" class="ku kv hi kq b fi kw kx l ky kz"># Create a for loop to fill mydata<br/>for j in table1.find_all(‘tr’)[1:]:<br/> row_data = j.find_all(‘td’)<br/> row = [i.text for i in row_data]<br/> length = len(mydata)<br/> mydata.loc[length] = row</span></pre><p id="efd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es li"><img src="../Images/c121ce4884150ba405752919dfed2102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2oilH1A-M7MgNUn8mALcg.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图9数据框</figcaption></figure><p id="7019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤9。清洁数据框</strong></p><p id="2ca7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功创建数据帧后，我们可以删除并清除不必要的行。在本节中，我们将删除索引0–6，222–228，然后重置索引，并删除“#”列。</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="af2b" class="ku kv hi kq b fi kw kx l ky kz"># Drop and clearing unnecessary rows<br/>mydata.drop(mydata.index[0:7], inplace=True)<br/>mydata.drop(mydata.index[222:229], inplace=True)<br/>mydata.reset_index(inplace=True, drop=True)</span><span id="ec39" class="ku kv hi kq b fi lb kx l ky kz"># Drop “#” column<br/>mydata.drop(‘#’, inplace=True, axis=1)</span></pre><p id="6c88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lj"><img src="../Images/0b16532038db4e9899fa7ec5c5374a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmzpv9TNrW407atCCONxGw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图10最终数据帧</figcaption></figure><p id="03c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第十步。导出到CSV并尝试运行它</strong></p><p id="1a67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据帧完成后，我们可以做的下一件事是将其导出为CSV格式。</p><pre class="jf jg jh ji fd kp kq kr ks aw kt bi"><span id="0b6c" class="ku kv hi kq b fi kw kx l ky kz"># Export to csv<br/>mydata.to_csv(‘covid_data.csv’, index=False)</span><span id="690e" class="ku kv hi kq b fi lb kx l ky kz"># Try to read csv<br/>mydata2 = pd.read_csv(‘covid_data.csv’)</span></pre><p id="a9ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于数据帧已导出为CSV格式，现在我们可以使用这些数据来构建数据科学项目，将其用于机器学习、数据分析项目等。</p><p id="09a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我给出的教程，希望对你们有用，尤其是对正在学习网络抓取的人。下一个项目再见。</p></div></div>    
</body>
</html>