<html>
<head>
<title>How to Create a GUI/CLI Standalone App in Python with Gooey and PyInstaller</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Gooey和PyInstaller在Python中创建GUI/CLI独立应用程序</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/how-to-create-a-gui-cli-standalone-app-in-python-with-gooey-and-pyinstaller-1a21d0914124?source=collection_archive---------5-----------------------#2021-01-15">https://medium.com/analytics-vidhya/how-to-create-a-gui-cli-standalone-app-in-python-with-gooey-and-pyinstaller-1a21d0914124?source=collection_archive---------5-----------------------#2021-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="ev ex if ig ih ab cb"><figure class="ii ij ik il im in io paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><img src="../Images/8e5ecd3e0276deb36e8413a83e76f0c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*WvHoNOsvCUC5okRvnYZgAQ.png"/></div></figure><figure class="ii ij iv il im in io paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><img src="../Images/4deedadee89814f7b8fb2729bfb9b6e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*7fAM8Tiu6t8WytDn_nDY-A.png"/></div><figcaption class="iw ix et er es iy iz bd b be z dx ja di jb jc translated">GUI版本</figcaption></figure></div><p id="b001" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">用Python和通用的<a class="ae kb" href="https://github.com/chriskiehl/Gooey" rel="noopener ugc nofollow" target="_blank"> Gooey </a>创建GUI很简单，并且在很多地方都有很好的证明:</p><ul class=""><li id="caf1" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated"><a class="ae kb" href="https://chriskiehl.com/article/gooey-as-a-universal-frontend" rel="noopener ugc nofollow" target="_blank">使用Gooey作为任何语言或CLI应用程序的通用前端</a></li><li id="d3be" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated"><a class="ae kb" href="https://pakstech.com/blog/python-gooey/" rel="noopener ugc nofollow" target="_blank">用Gooey创建简单的Python GUI应用程序</a></li></ul><p id="32c2" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">但是在一个可执行文件中实现CLI和GUI的无缝切换是另一回事。Gooey最初并不打算这样使用，尽管该库有<a class="ae kb" href="https://github.com/chriskiehl/Gooey/issues/449" rel="noopener ugc nofollow" target="_blank">一个未文档化的特性使这成为可能</a>(因此它可以被完整地文档化，或者在Gooey的未来版本中被删除)。本教程对那些对Python脚本构建感兴趣的人也很有用。</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es kq"><img src="../Images/1d81c9999f606914b42f30e605b21411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*auEQlHQx1oEDStEcztqOZg.png"/></div><figcaption class="iw ix et er es iy iz bd b be z dx translated">同一脚本的CLI调用</figcaption></figure><p id="d063" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">对于希望将一个可执行文件分发给具有不同界面偏好的用户的用例来说，将这两者结合在一起非常好。</p><p id="e695" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">第一部分在于<strong class="jf hj"> - ignore-gooey </strong>命令。允许在GUI和CLI界面之间切换。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="4629" class="la lb hi kw b fi lc ld l le lf">if len(sys.argv) &gt;= 2:<br/>    if not "--ignore-gooey" in sys.argv:<br/>        sys.argv.append("--ignore-gooey")</span></pre><p id="63be" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">当应用程序不带参数(甚至从命令行)启动时，此代码片段触发ignore命令，否则CLI将被激活。然后PyInstaller库发生。如果您希望应用程序完全在GUI/CLI模式下工作，那么您必须覆盖中通常推荐的(默认)配置选项。规格文件<strong class="jf hj">控制台=假</strong>。启用此选项后，您可以看到GUI和CLI，但是GUI伴随着一个难看的空命令行窗口。通过下面的代码片段，当GUI启动时，这个窗口是隐藏的。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="1804" class="la lb hi kw b fi lc ld l le lf">exe = EXE(pyz,<br/> a.scripts,<br/> [],<br/> exclude_binaries=True,<br/> name=’CLI GUI Example App’,<br/> debug=False,<br/> bootloader_ignore_signals=False,<br/> strip=False,<br/> upx=True,<br/> <strong class="kw hj">console=True</strong> )</span></pre><p id="7ae6" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，我们检查脚本是否被‘冻结’/打包，以防我们在结束之前运行脚本。此外，如果在上一步中指定了-ignore-gooey命令，那么用户可以使用命令行中的参数运行应用程序。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="9d0b" class="la lb hi kw b fi lc ld l le lf">if not "--ignore-gooey" in sys.argv and getattr(sys, "frozen", False)</span></pre><p id="e70a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">然后我们导入绑定到Windows COM的库。有些人可能会感到困惑，因为以<em class="lg"> win- </em>开头的库来自库<a class="ae kb" href="https://github.com/mhammond/pywin32" rel="noopener ugc nofollow" target="_blank"> pywin32 </a>。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="796f" class="la lb hi kw b fi lc ld l le lf">import win32process, win32gui, win32con    <br/>import os</span></pre><p id="ddf3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">获取正在运行的脚本的进程ID (PID)在Python中很简单，但实际上取决于您是将脚本构建为一个文件(<strong class="jf hj">-py installer中的onefile </strong>参数)还是文件夹(<strong class="jf hj"> - onedir </strong>)独立可执行文件。如果您使用父进程ID (PPID)作为<strong class="jf hj"> - onefir </strong>选项，那么Windows资源管理器将被隐藏，您将不会在基本的Windows UI中看到很多内容(已经有了，完成了-重启修复它)。更多关于PyInstaller参数的信息请点击。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="1789" class="la lb hi kw b fi lc ld l le lf">pid = os.getpid() # PID, use if --onedir<br/>pid = os.getppid() # PPID, use if --onefile</span></pre><p id="17e5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Windows似乎没有更直接的方法如何将打开的窗口链接到进程，但下面的<a class="ae kb" href="http://timgolden.me.uk/python/win32_how_do_i/find-the-window-for-my-subprocess.html" rel="noopener ugc nofollow" target="_blank">这个循环</a>修复了它。不要担心进程不会被杀死，只是隐藏在后台。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="0098" class="la lb hi kw b fi lc ld l le lf">open_windows_with_corresponding_pid = get_hwnds_for_pid(pid)<br/>for hwnd in open_windows_with_corresponding_pid:<br/>    try:            <br/>        win32gui.ShowWindow(hwnd, win32con.SW_HIDE)        <br/>    except Exception:            <br/>        pass</span></pre><p id="9832" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">代码的其余部分类似于其他粘性教程。这个脚本统计输入的字符并输出统计的字符，你可以看到下面的逻辑和结构。</p><h1 id="9875" class="lh lb hi bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">Onedir还是Onefile？</h1><p id="bc93" class="pw-post-body-paragraph jd je hi jf b jg me ji jj jk mf jm jn jo mg jq jr js mh ju jv jw mi jy jz ka hb bi translated">我更喜欢<strong class="jf hj"> - onedir </strong> PyInstaller发行版，因为脚本启动速度更快(例如1-5秒而不是20-60秒，取决于脚本大小和复杂性)。对于某些情况(例如，没有少量第三方库的小脚本),压缩一个文件夹更方便。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="c7e3" class="la lb hi kw b fi lc ld l le lf">py -m PyInstaller --onefile --clean "C:\ProjectName\script.py"<br/>py -m PyInstaller --onedir --clean "C:\ProjectName\script.py"</span></pre><p id="fb02" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">就是这样，成功的剧本发行！</p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="mq mr l"/></div></figure><ul class=""><li id="384e" class="kc kd hi jf b jg jh jk jl jo ke js kf jw kg ka kh ki kj kk bi translated">另一种打包应用程序的便捷方式是cx_freeze库，这里的<a class="ae kb" href="https://gist.github.com/ForgottenUmbrella/ce6ecd8983e76f6d8ef47e07240eb4ac" rel="noopener ugc nofollow" target="_blank">或</a><a class="ae kb" href="https://github.com/chriskiehl/Gooey/issues/58" rel="noopener ugc nofollow" target="_blank">这里的</a>对设置进行了详细描述。</li><li id="c8c9" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated">如何用<a class="ae kb" href="https://github.com/chriskiehl/Gooey/issues/610" rel="noopener ugc nofollow" target="_blank"> Nuitka </a>交替包装？</li><li id="abcc" class="kc kd hi jf b jg kl jk km jo kn js ko jw kp ka kh ki kj kk bi translated"><a class="ae kb" href="https://github.com/beeware/briefcase" rel="noopener ugc nofollow" target="_blank">公文包</a>(可安装可执行文件)</li></ul></div></div>    
</body>
</html>