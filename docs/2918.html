<html>
<head>
<title>ML model deployment with Flask on localhost - PART I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在本地主机上用Flask部署ML模型——第一部分</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/ml-model-deployment-with-flask-on-local-host-part-i-300694542d68?source=collection_archive---------1-----------------------#2021-05-25">https://medium.com/analytics-vidhya/ml-model-deployment-with-flask-on-local-host-part-i-300694542d68?source=collection_archive---------1-----------------------#2021-05-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b2b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个2篇文章的系列中，我们将讨论如何在localhost(使用Python localhost服务器)和webhost(使用Amazon-EC2)上使用Flask部署机器学习模型。在第一部分中，我们将展示如何构建模型、设计HTML/CSS页面并最终在localhost上运行它。</p><h1 id="85b4" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">1.建立机器学习模型</h1><p id="d116" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">该问题的目标是根据客户提供的信息(如性别、婚姻状况、教育程度、受抚养人人数、收入、贷款金额、信用记录等)来确定有资格获得房屋贷款的客户。</p><p id="7871" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据集为<em class="kf">' loan _ acceptance _ data . CSV '</em>。我们将使用PyCharm IDE来完成整个项目。首先，创建一个虚拟环境，并给出一个项目名称。我们的情况是<em class="kf">‘贷款-审批-新建’</em>。现在，创建一个python文件，其中将完成模型构建部分。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="e770" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将文件保存为<em class="kf">‘loan . py’</em>。</p><p id="bfe4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在这里执行的步骤是:</p><ul class=""><li id="65bd" class="kn ko hh ig b ih ii il im ip kp it kq ix kr jb ks kt ku kv bi translated">输入缺失值</li><li id="8343" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">特征工程</li><li id="923d" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">标记分类列</li><li id="b661" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">选择所需功能</li><li id="501c" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">列车测试分离</li><li id="e001" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">使用逻辑回归建立模型</li><li id="789b" class="kn ko hh ig b ih kw il kx ip ky it kz ix la jb ks kt ku kv bi translated">创建pickle文件</li></ul><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="231f" class="lg jd hh lc b fi lh li l lj lk">file = open('loan_approval.pkl', 'wb')<br/>pickle.dump(model, file)</span></pre><p id="4b89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面两行代码将创建一个名为<em class="kf">‘loan _ approval . pkl’</em>的pickle文件。</p><h1 id="0a75" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">2.制作HTML/CSS前端文件</h1><p id="1e31" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">设计的HTML文件将有内容将在网站上显示。CSS部分也可以添加到同一个文件中，为网页提供一些设计。</p><p id="fd26" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们创建一个表单，用户将提供他的输入细节。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="c4b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将文件另存为<em class="kf"> 'index.html' </em>。</p><h1 id="8fbc" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">3.创建Python/Flask后端文件</h1><p id="f9ed" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在这里，我们将创建一个Python文件，它将从HTML文件中获取值，并根据输入执行操作，最后预测结果。我们需要在系统中安装Flask来运行它。</p><p id="5052" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是初始化Flask应用程序的代码片段。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="e21a" class="lg jd hh lc b fi lh li l lj lk">from flask import Flask, render_template, request<br/>import pickle<br/>import numpy as np</span><span id="0d52" class="lg jd hh lc b fi ll li l lj lk">model = pickle.load(open('loan_approval.pkl', 'rb'))  # read mode</span><span id="191e" class="lg jd hh lc b fi ll li l lj lk">app = Flask(__name__)  # initializing Flask app</span></pre><p id="c7dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过下面的代码片段获取index.html的详细信息。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="e83d" class="lg jd hh lc b fi lh li l lj lk">@app.route("/",methods=['GET'])<br/>def hello():<br/>    return render_template('index.html')</span></pre><p id="23cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是我们做预测的最后一部分。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="e1ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意最后一行。要在本地系统上运行，应启用以下代码。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="160f" class="lg jd hh lc b fi lh li l lj lk">app.run(debug=True)</span></pre><p id="11f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将文件另存为<em class="kf"> 'app.py' </em>。</p><h1 id="fd85" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">4.安装依赖项</h1><p id="aa82" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在Pycharm终端中，安装pip。如果已经安装，请强制重新安装。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="367b" class="lg jd hh lc b fi lh li l lj lk">&gt; python -m pip install -U --force-reinstall pip</span></pre><p id="b2ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装运行项目所需的依赖项或库。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="3d8a" class="lg jd hh lc b fi lh li l lj lk">&gt; python -m pip install Flask</span></pre><p id="a436" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">像这样做所有的图书馆，如sklearn，pandas，numpy等。</p><p id="dff2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦安装了所有的库，确保生成一个<em class="kf"> 'requirements.txt' </em>文件，该文件将包含运行项目所需的所有库的名称和版本。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="3dcc" class="lg jd hh lc b fi lh li l lj lk">&gt; pip freeze &gt; requirements.txt</span></pre><h1 id="642b" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">4.在本地主机上运行</h1><p id="6988" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">确保本地PyCharm目录如下所示。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/6c5bdeca23a5caaebce2f3d703fd57fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DoKCO7FFaJEaG2IP"/></div></div></figure><p id="67a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kf">' Loan _ acceptance . ipynb '</em>可以忽略。这基本上是EDA和模型比较部分完成的笔记本文件。<em class="kf"> 'index.html' </em>文件存储在templates文件夹中。忽略其余的文件夹，因为它们是在PyCharm中创建虚拟环境时自动生成的。</p><p id="46a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后在Pycharm终端，运行app。</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="d920" class="lg jd hh lc b fi lh li l lj lk">&gt; python app.py</span></pre><p id="e583" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输出屏幕将显示如下:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lt"><img src="../Images/db7667b4d618fb40d1a3ca3e44db1125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QKwqsoXAYdCrWORY"/></div></div></figure><p id="eb93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击蓝色链接，在浏览器上运行web应用程序。或者复制粘贴链接并在浏览器上运行:</p><pre class="kg kh ki kj fd lb lc ld le aw lf bi"><span id="6ad2" class="lg jd hh lc b fi lh li l lj lk">http://127.0.0.1:5000/</span></pre><p id="bb5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果在整个过程中没有出现错误，浏览器的输出屏幕将显示网页。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lu"><img src="../Images/3be2e5f1973359bcad5c6aeb6bd5dbb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4-BA83FI6zW-oFrj"/></div></div></figure><h1 id="e3ee" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="c3e8" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">因此，我们终于成功地在Chrome浏览器上运行了该应用程序。一旦我们输入值，并点击提交按钮，屏幕将显示输出，如果贷款将为用户批准与否。</p><p id="3bbe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第二部分中，我们将使用Amazon EC2在webhost上运行我们的模型。</p><p id="9324" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢阅读我的文章！如果你喜欢我的文章吗👏。</p><p id="8e97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该项目的完整代码，请查看<a class="ae lv" href="https://github.com/hrisav/loan-acceptance" rel="noopener ugc nofollow" target="_blank"> Github链接</a>。</p><p id="0160" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过<a class="ae lv" href="https://www.linkedin.com/in/hrisav/" rel="noopener ugc nofollow" target="_blank">链接</a>与我联系，了解更多更新或如果你被困在任何地方。</p></div></div>    
</body>
</html>