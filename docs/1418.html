<html>
<head>
<title>Understanding Vectorization in NumPy and Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解NumPy和Pandas中的矢量化</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/understanding-vectorization-in-numpy-and-pandas-188b6ebc5398?source=collection_archive---------0-----------------------#2021-03-01">https://medium.com/analytics-vidhya/understanding-vectorization-in-numpy-and-pandas-188b6ebc5398?source=collection_archive---------0-----------------------#2021-03-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/1b91dff0e70ecb97588c2a05aa33f2dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q32t8ITJaIZK5OV0kJuZIQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">米尔扎·巴比奇在<a class="ae hv" href="https://unsplash.com/s/photos/prism?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="4ef9" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">仅仅几天前，我的导师停下来说明了一点。“帮你自己一个忙，”他带着前所未有的热情对全班说，“在深入学习熊猫之前，先看看<a class="ae hv" href="https://www.youtube.com/watch?v=nxWginnBklU" rel="noopener ugc nofollow" target="_blank">这个关于矢量化的演讲</a>”</p><p id="9fb1" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">矢量化的价值似乎是显而易见的，无论是从我们的讲师在指导我们观看该剪辑时的影响，还是从演示者在该剪辑中提出的主张来看——将您的代码矢量化以将数据处理速度提高1000倍。该视频分解了使用各种操作操作的几个示例(Python for-loops、NumPy数组矢量化和各种Pandas方法),并比较了这些方法的输出返回速度。结果是显而易见的:正如视频吸引点击的标题所暗示的那样，在熊猫中使用利用矢量化的技术将导致惊人的更快的数据操作。</p><p id="e4a2" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为一个喜欢学习任何新技能的最佳技术的人，我立即知道我需要调整我的方法。我对Python for-loops的迷恋需要让位于这些诱人的向量方法。但是首先…</p><h1 id="532c" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">向量到底是什么？</h1><p id="7d50" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">有了动画的背景，我最初理解向量不是在数学或编程的背景下，而是在创建数字图像中。设计程序Adobe Illustrator和Adobe Animate是基于矢量的，您在这些程序中创建的图稿是由一系列点、线、曲线和形状组成的，这使得图稿可以在不降低质量的情况下进行缩放，并具有保持文件较小的额外好处。</p><p id="cbf6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">相比之下，Adobe Photoshop是基于光栅的——一系列小像素创建图像。在Photoshop中绘画感觉很自然，不像用形状构建图像。当然，在这样的程序中创作艺术有其缺点:处理细节丰富的大幅面艺术的能力严重依赖于计算机，以降低质量为代价将艺术放大对大多数艺术家来说是不可接受的。</p><p id="2418" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这几乎没有解释清楚矢量化<em class="kw">是什么</em>。上面的视频描述了vectors做什么——一次对数组或系列数据类型的元素进行操作，还表明NumPy依赖于编程语言C来完成其矢量化操作。在数学中，向量是有大小和方向的东西。在编程和计算机科学中，向量化是一次将运算应用于整个值集的过程。</p><p id="a1f3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些定义仍然没有为<em class="kw">如何</em>发生这种情况提供清晰的解释，这是值得研究的，以便更深入地了解这一过程。</p><h1 id="1a49" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么它更快</h1><p id="a0d2" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">虽然Python中的for-loop语法很灵活，并且提供了很好的实用性，但是对一个元素的每次迭代本质上是遍历容器对象的所有元素的一个步骤。当操作顺序很重要时，这个分步处理<em class="kw">很有用(例如，返回满足特定条件的列表中的第一项)。</em></p><p id="baab" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">相反，当处理的顺序与<em class="kw">无关时，可以应用矢量化处理。如上所述，NumPy和Pandas中的内置方法是用C构建的，这允许向量化。由于执行时间要么是恒定的，要么随着元素数量的增加而以慢得多的速度增长，因此矢量化的工作速度几乎总是更快。</em></p><h2 id="a788" class="kx ju hy bd jv ky kz la jz lb lc ld kd jg le lf kh jk lg lh kl jo li lj kp lk bi translated">并行处理</h2><ul class=""><li id="7313" class="ll lm hy ix b iy kr jc ks jg ln jk lo jo lp js lq lr ls lt bi translated">在NumPy和Pandas中，单独的数组段在计算机的所有处理核心中进行处理。NumPy和Pandas并行操作它们的阵列和系列，每个阵列的一部分由计算机处理器的不同核心处理。</li></ul><h2 id="833a" class="kx ju hy bd jv ky kz la jz lb lc ld kd jg le lf kh jk lg lh kl jo li lj kp lk bi translated">相似数据类型</h2><ul class=""><li id="1cea" class="ll lm hy ix b iy kr jc ks jg ln jk lo jo lp js lq lr ls lt bi translated">NumPy数组被设置为单一数据类型。Pandas中的series也是如此——每一列都是int、float、str或datetime类型。这允许优化数据处理，因为这些容器的内容肯定能够以类似的方式被操纵。<br/>对于Python的内置容器数据类型，如列表、集合和字典，情况并非如此。这些类型允许您同时在其中存储各种类型。一个列表可以包含字符串、整型、浮点型、其他列表等。</li></ul><h2 id="1741" class="kx ju hy bd jv ky kz la jz lb lc ld kd jg le lf kh jk lg lh kl jo li lj kp lk bi translated">位置</h2><ul class=""><li id="995c" class="ll lm hy ix b iy kr jc ks jg ln jk lo jo lp js lq lr ls lt bi translated">NumPy获取你的数组矩阵，并把它存储在内存的一个区域中。彼此本地的内容允许它们被更快地操作。<br/>相比之下，Python列表的内容可能存储在内存中彼此相距很远的地方。</li></ul><h2 id="053a" class="kx ju hy bd jv ky kz la jz lb lc ld kd jg le lf kh jk lg lh kl jo li lj kp lk bi translated">矢量化背后的机制——SISD vs SIMD</h2><p id="0334" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">现代计算机处理器包含具有与理解矢量化相关的特定计算机架构分类的组件:</p><blockquote class="lu"><p id="b534" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">SISD —单一指令、单一数据</p><p id="0a41" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">SIMD—单指令、多数据</p></blockquote><figure class="mf mg mh mi mj hk er es paragraph-image"><div class="er es me"><img src="../Images/a6fa9dc3be23a424a7f5c3391663ee70.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/0*SqF76mYfySlF7luP.gif"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">可视化SISD与SIMD组件流程</figcaption></figure><ul class=""><li id="8235" class="ll lm hy ix b iy iz jc jd jg mk jk ml jo mm js lq lr ls lt bi translated">SISD:这是Python for-loops的处理结构——每一个指令，每一个数据元素，每一个时刻，为了产生一个结果。这种方法的优点在于它很灵活——您可以对数据执行任何操作。缺点是它不是处理大量数据的最佳选择。</li><li id="dbdd" class="ll lm hy ix b iy mn jc mo jg mp jk mq jo mr js lq lr ls lt bi translated">SIMD:这是如何处理NumPy和Pandas矢量化的结构——每一时刻每<em class="kw">任意数量的</em>数据元素一条指令，以便产生<em class="kw">多个</em>结果。当代的CPU有一个组件在<em class="kw">的每个内核中处理SIMD运算，</em>允许并行处理。</li></ul><p id="9ee4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们已经知道了矢量化速度背后的机制和概念，理解如何使用Pandas处理数据可能需要一些指导。Sofia Heisler在Pycon 2017 的演讲中提到了熊猫优化的禅，提供了一种简洁的方法:</p><h2 id="eac8" class="kx ju hy bd jv ky kz la jz lb lc ld kd jg le lf kh jk lg lh kl jo li lj kp lk bi translated">熊猫优化之禅</h2><blockquote class="lu"><p id="d1d1" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">-尽可能避免循环</p><p id="3770" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">-如果必须循环，请使用apply，而不是迭代函数</p><p id="1865" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">-如果您必须申请，请使用Cython加快速度</p><p id="f57e" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">-矢量化通常比标量操作更好</p><p id="7669" class="lv lw hy bd lx ly lz ma mb mc md js dx translated">NumPy阵列上的向量运算比本机Pandas系列更高效</p></blockquote><h1 id="8fd4" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke ms kg kh ki mt kk kl km mu ko kp kq bi translated">参考资料和其他资源</h1><p id="fa49" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">Nathan Cheever，PyGotham 2019— <a class="ae hv" href="https://www.youtube.com/watch?v=nxWginnBklU&amp;t=7s" rel="noopener ugc nofollow" target="_blank">数据处理速度提高1000倍:使用Pandas和Numpy进行矢量化</a></p><p id="95a0" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Sofia Heisler，PyCon 2017— <a class="ae hv" href="https://www.youtube.com/watch?v=HN5d490_KKk" rel="noopener ugc nofollow" target="_blank">不再有悲伤的熊猫:优化熊猫代码以提高速度和效率</a></p><p id="aaa5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">ritvikmath—<a class="ae hv" href="https://www.youtube.com/watch?v=9z_-9vrRgYA" rel="noopener ugc nofollow" target="_blank">pandas和numpy中的矢量化</a></p><p id="2a7b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">深度学习—<a class="ae hv" href="https://www.youtube.com/watch?v=9z_-9vrRgYA" rel="noopener ugc nofollow" target="_blank">Python中的矢量化:数据科学代码</a></p><p id="e505" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3blue1brown — <a class="ae hv" href="https://www.youtube.com/watch?v=fNk_zzaMoSs" rel="noopener ugc nofollow" target="_blank">向量，它们到底是什么？|线性代数精要，第1章</a></p><p id="4652" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">迈克尔·j·弗林，<em class="kw">弗林分类法</em>——<a class="ae hv" href="https://ieeexplore.ieee.org/document/5009071" rel="noopener ugc nofollow" target="_blank">一些计算机组织及其有效性</a></p></div></div>    
</body>
</html>