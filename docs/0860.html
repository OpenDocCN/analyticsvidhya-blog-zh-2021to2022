<html>
<head>
<title>Sentiment Analysis on Amazon Reviews using TF-IDF Approach.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于TF-IDF方法的亚马逊评论情感分析。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/sentiment-analysis-on-amazon-reviews-using-tf-idf-approach-c5ab4c36e7a1?source=collection_archive---------1-----------------------#2021-02-04">https://medium.com/analytics-vidhya/sentiment-analysis-on-amazon-reviews-using-tf-idf-approach-c5ab4c36e7a1?source=collection_archive---------1-----------------------#2021-02-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="93d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">特征提取:TF-IDF(词频-逆文档频)<br/>分类:SVM，Logistic回归</p><p id="b378" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着数字时代的发展，网上购物有了巨大的增长。每个商务人士都想分析他们的客户在谈论他们的产品。评论、星级评定是描述客户参与度的产品附件。分析客户感受的过程被称为情感分析。</p><p id="bb7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，情感分析是在亚马逊珠宝数据集上进行的。</p><p id="2d1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集链接:<a class="ae jd" href="https://s3.amazonaws.com/amazon-reviews-pds/tsv/amazon_reviews_us_Jewelry_v1_00.tsv.gz" rel="noopener ugc nofollow" target="_blank">https://S3 . Amazon AWS . com/Amazon-reviews-PDS/tsv/Amazon _ reviews _ us _ Jewelry _ v1 _ 00 . tsv . gz</a></p><p id="5e4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入所需的包</p><pre class="je jf jg jh fd ji jj jk bn jl jm bi"><span id="8f54" class="jn jo hi jj b be jp jq l jr js">import pandas as pd<br/>import numpy as np<br/>import nltk<br/>import re</span></pre><p id="b831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用熊猫阅读数据集</p><pre class="je jf jg jh fd ji jj jk bn jl jm bi"><span id="101a" class="jn jo hi jj b be jp jq l jr js">df=pd.read_csv(‘data.tsv’, sep=’\t’, header=0, error_bad_lines=False)</span></pre><p id="c450" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预览数据集</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="2bbf" class="jw jo hi jj b fi jx jy l jz js">df.head(3)</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es ka"><img src="../Images/7efc542c5b8851bba94d811882429c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieP-WtmT7SPF_6o3zc5RRg.png"/></div></div></figure><p id="7fdd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们只需要review_body，star_rating列来分别描述每个评论的评论和星级。</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="cfdc" class="jw jo hi jj b fi jx jy l jz js">df=df[[‘review_body’,’star_rating’]]</span></pre><p id="6182" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除空值、缺失值并重置索引</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="afed" class="jw jo hi jj b fi jx jy l jz js">df=df.dropna()<br/>df = df.reset_index(drop=True)<br/>df</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es ki"><img src="../Images/9f62c3464c4df9ca1db7bcca99d25cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*1bi_zwAVoMjWLEJPHq7hSQ.png"/></div></figure><p id="9c94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">标签评论:<br/> </strong>现在我们有1766748条评论。星级为4.5的评论被标记为正面评论，1.2的评论被标记为负面评论。删除星级为3的评论，因为它们被认为是中性的。</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="0286" class="jw jo hi jj b fi jx jy l jz js">df['star_rating']=df['star_rating'].astype(int) #convert the star_rating column to int</span><span id="4814" class="jw jo hi jj b fi kj jy l jz js">df=df[df[‘star_rating’]!=3]<br/>df['label']=np.where(df['star_rating']&gt;=4,1,0) #1-Positve,0-Negative</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es kk"><img src="../Images/90cff73aa5032c8740ec84a1b7c1046e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*sl9hiXwWVb_QemmQHeEB-g.png"/></div></figure><p id="6402" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按星级分组的评论数量</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="c588" class="jw jo hi jj b fi jx jy l jz js">df[‘star_rating’].value_counts()</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es kl"><img src="../Images/6e27fbd20d8486ed401f81031a31208f.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*PX-AweAUNaOsB---RN_kRQ.png"/></div></figure><p id="6a53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们通过考虑100000条评论来创建模型。在100，000条评论中，50，000条是正面的，50，000条是负面的。</p><p id="5a00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将从16，07，094条评论中随机抽取100，000条评论。不想洗牌可以忽略。</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="a0aa" class="jw jo hi jj b fi jx jy l jz js">df = df.sample(frac=1).reset_index(drop=True) #shuffle</span><span id="7e08" class="jw jo hi jj b fi kj jy l jz js">data=df[df['label']==0][:50000]<br/>data=data.append(df[df['label']==1][:50000])<br/>data = data.reset_index(drop=True)<br/>display(data['label'].value_counts())<br/>data</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es km"><img src="../Images/40ece56a0b697c2ef401e73f6f0e51dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*0zPlfdTB4EfqVq7z9mgz8g.png"/></div></figure><h1 id="6522" class="kn jo hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">预处理</h1><p id="cde9" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">第一步是将所有评论转换成小写。</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="9355" class="jw jo hi jj b fi jx jy l jz js">data[‘pre_process’] = data[‘review_body’].apply(lambda x: “ “.join(x.lower() for x in str(x).split()))</span></pre><p id="68d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从评论中删除HTML标签和URL。</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="e25a" class="jw jo hi jj b fi jx jy l jz js"><br/>from bs4 import BeautifulSoup<br/>data[‘pre_process’]=data[‘pre_process’].apply(lambda x: BeautifulSoup(x).get_text())</span><span id="9fa5" class="jw jo hi jj b fi kj jy l jz js">import re<br/>data[‘pre_process’]=data[‘pre_process’].apply(lambda x: re.sub(r”http\S+”, “”, x))</span></pre><p id="9f46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在评论上执行缩写。<br/>举例:<strong class="ih hj">不会被</strong>转换为<strong class="ih hj">不会被</strong></p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="fdb9" class="jw jo hi jj b fi jx jy l jz js">def contractions(s):<br/> s = re.sub(r”won’t”, “will not”,s)<br/> s = re.sub(r”would’t”, “would not”,s)<br/> s = re.sub(r”could’t”, “could not”,s)<br/> s = re.sub(r”\’d”, “ would”,s)<br/> s = re.sub(r”can\’t”, “can not”,s)<br/> s = re.sub(r”n\’t”, “ not”, s)<br/> s= re.sub(r”\’re”, “ are”, s)<br/> s = re.sub(r”\’s”, “ is”, s)<br/> s = re.sub(r”\’ll”, “ will”, s)<br/> s = re.sub(r”\’t”, “ not”, s)<br/> s = re.sub(r”\’ve”, “ have”, s)<br/> s = re.sub(r”\’m”, “ am”, s)<br/> return s<br/>data[‘pre_process’]=data[‘pre_process’].apply(lambda x:contractions(x))</span></pre><p id="01a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除非字母字符</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="efa8" class="jw jo hi jj b fi jx jy l jz js">data[‘pre_process’]=data[‘pre_process’].apply(lambda x: “ “.join([re.sub(‘[^A-Za-z]+’,’’, x) for x in nltk.word_tokenize(x)]))</span></pre><p id="f02a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">去掉单词之间多余的空格</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="5f80" class="jw jo hi jj b fi jx jy l jz js">data[‘pre_process’]=data[‘pre_process’].apply(lambda x: re.sub(‘ +’, ‘ ‘, x))</span></pre><p id="bdbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用NLTK包删除停用词</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="df4a" class="jw jo hi jj b fi jx jy l jz js">from nltk.corpus import stopwords<br/>stop = stopwords.words(‘english’)<br/>data[‘pre_process’]=data[‘pre_process’].apply(lambda x: “ “.join([x for x in x.split() if x not in stop]))</span></pre><p id="1bae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用wordnet词汇化器执行词汇化</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="d84f" class="jw jo hi jj b fi jx jy l jz js">from nltk.stem import WordNetLemmatizer<br/>lemmatizer = WordNetLemmatizer()<br/>data[‘pre_process’]=data[‘pre_process’].apply(lambda x: “ “.join([lemmatizer.lemmatize(w) for w in nltk.word_tokenize(x)]))</span></pre><p id="813c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终预处理后的评论看起来是:<br/> <strong class="ih hj">原文:</strong>图中更好看。现实中打印质量不怎么样，感觉没有什么涂层。<br/> <strong class="ih hj">预处理:</strong>更好看图片真实印刷质量好手感涂层。</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="e462" class="jw jo hi jj b fi jx jy l jz js">data</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es lp"><img src="../Images/e6b640268453f77f01ed9a6364036ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfhGlxvoLuMt7WUYwmkqQA.png"/></div></div></figure><h1 id="3ed4" class="kn jo hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">特征抽出</h1><p id="5db2" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated"><strong class="ih hj"> TF-IDF: </strong>是一种从文本数据中提取特征的方法。TF代表词频，IDF代表逆文档频。</p><p id="6d2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">词频:单词在评论中出现的次数。例如，考虑两个评论，其中w1、w2..表示两个评论中的单词，表定义了特定评论中的单词频率。</p><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es lq"><img src="../Images/42d7882e65e72d2a50b2605113be8be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*NzhBo592aU2pax3jeI7epw.png"/></div></figure><p id="f641" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">IDF计算如下</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="7ad9" class="jw jo hi jj b fi jx jy l jz js">idf(t) = log [ n / df(t) ] + 1<br/> = log[ number of documents / number of documents containing the term]+1</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es lr"><img src="../Images/9bf2f63f1229fc6627b2ff00257c5559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*tWKRvZ82kmQP6VWUqgy5nA.png"/></div></figure><p id="f8f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果smooth_idf=True。<br/>Smooth-IDF = log[n/df(t)+1]+1</p><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es ls"><img src="../Images/51725da3cfe764e5bd77c5d4c8e8759c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*mZoMlmO7-GEhcjEo32lp7A.png"/></div></figure><p id="b7f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TF-IDF是使用sklearn实现的:<a class="ae jd" href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . feature _ extraction . text . tfidfvectorizer . html</a></p><p id="bb9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将数据分成训练集和测试集</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="eab6" class="jw jo hi jj b fi jx jy l jz js">from sklearn.model_selection import train_test_split<br/>X_train,X_test,Y_train, Y_test = train_test_split(data[‘pre_process’], data[‘label’], test_size=0.25, random_state=30)</span><span id="a104" class="jw jo hi jj b fi kj jy l jz js">print(“Train: “,X_train.shape,Y_train.shape,”Test: “,(X_test.shape,Y_test.shape))</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es lt"><img src="../Images/0d06705178133618f2fa1109298a4c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*qMUOesdwVJMN4TbYsxFUxA.png"/></div></figure><p id="b873" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用TF*IDF矢量器</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="14b6" class="jw jo hi jj b fi jx jy l jz js">print(“TFIDF Vectorizer……”)<br/>from sklearn.feature_extraction.text import TfidfVectorizer</span><span id="7a2d" class="jw jo hi jj b fi kj jy l jz js">vectorizer= TfidfVectorizer()</span><span id="c174" class="jw jo hi jj b fi kj jy l jz js">tf_x_train = vectorizer.fit_transform(X_train)<br/>tf_x_test = vectorizer.transform(X_test)</span></pre><p id="3d41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> SVM </strong></p><p id="7db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用sklearn实现分类的SVM</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="40f8" class="jw jo hi jj b fi jx jy l jz js">from sklearn.svm import LinearSVC<br/>clf = LinearSVC(random_state=0)</span></pre><p id="1d7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将训练数据拟合到模型中</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="2e63" class="jw jo hi jj b fi jx jy l jz js">clf.fit(tf_x_train,Y_train)</span></pre><p id="c6a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预测测试数据</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="5397" class="jw jo hi jj b fi jx jy l jz js">y_test_pred=clf.predict(tf_x_test)</span></pre><p id="e406" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分析结果</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="2379" class="jw jo hi jj b fi jx jy l jz js">from sklearn.metrics import classification_report<br/>report=classification_report(Y_test, y_test_pred,output_dict=True)</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es lu"><img src="../Images/67085e9fd0178bf009c89e1cbf2d8f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*LmhBblr4AeKcuo6_MGq2QQ.png"/></div></figure><h1 id="17cc" class="kn jo hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">通过使用SVM分类器，我们得到了<strong class="ak"> 91.55% </strong>的准确率</h1><h1 id="89e2" class="kn jo hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">逻辑回归</h1><p id="70bc" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">使用sklearn实现逻辑回归</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="bb78" class="jw jo hi jj b fi jx jy l jz js">from sklearn.linear_model import LogisticRegression<br/>clf = LogisticRegression(max_iter=1000,solver=’saga’)</span></pre><p id="ca5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使训练数据符合模型</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="635d" class="jw jo hi jj b fi jx jy l jz js">clf.fit(tf_x_train,Y_train)</span></pre><p id="8d46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预测测试数据</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="27de" class="jw jo hi jj b fi jx jy l jz js">y_test_pred=clf.predict(tf_x_test)</span></pre><p id="baad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分析报告</p><pre class="je jf jg jh fd ji jj jt ju aw jv bi"><span id="7c1d" class="jw jo hi jj b fi jx jy l jz js">from sklearn.metrics import classification_report<br/>report=classification_report(Y_test, y_test_pred,output_dict=True)</span></pre><figure class="je jf jg jh fd kb er es paragraph-image"><div class="er es lv"><img src="../Images/32821d46f5ba1648e37fa7e6ccc4b5ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*s7QPS1T1iwrhcT_xurSvOg.png"/></div></figure><h1 id="f5bd" class="kn jo hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">通过使用LR分类器，我们得到了91.80%的准确率</h1><p id="94b2" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">因此我们可以对任何数据进行情感分析。</p><p id="6315" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢和问候<br/> Praveen Sujanmulk</p></div></div>    
</body>
</html>