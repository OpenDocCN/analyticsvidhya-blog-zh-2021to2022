<html>
<head>
<title>Removing Outliers. Understanding How and What behind the Magic.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移除异常值。理解魔法背后的方式和内容。</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/removing-outliers-understanding-how-and-what-behind-the-magic-18a78ab480ff?source=collection_archive---------0-----------------------#2021-04-05">https://medium.com/analytics-vidhya/removing-outliers-understanding-how-and-what-behind-the-magic-18a78ab480ff?source=collection_archive---------0-----------------------#2021-04-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="cc69" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">离群值是数据科学家不想在他们的数据集中看到的最奇怪的东西之一。统计学有答案。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/54113e9680f316c855b92a721cd2015b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hj7B5rinoxPKBipY0oAKSQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">散点图中显示的数据集中的异常值。</figcaption></figure><h2 id="ec8e" class="jn jo hi bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">首先，什么是异常值？</h2><p id="d728" class="pw-post-body-paragraph kl km hi kn b ko kp ij kq kr ks im kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">异常值是指与数据集中其他点的距离异常的任何数据。对我们人类来说，看着<em class="le">的几个值，猜测</em>异常值是很容易的。</p><p id="f12d" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">看看这个，你能猜出哪些是异常值吗？</p><p id="f121" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi">[25, 26, 38, 34, 3, 33, 23, 85, 70, 28, 27]</p><p id="cb03" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">我的朋友，这里，3，70，85是异常值。</p><p id="79fc" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">但是考虑到这一点，作为一名数据科学家，我们可能必须分析包含数千甚至数百万个值的数百个列。而且你会马上得出结论，这种<em class="le">猜测</em>的方法就是不可行。</p><p id="b58f" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">像这样的方框图可能会很方便，但还不够。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lk"><img src="../Images/2cf6dcd453a1228ccc5546200e4e44e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*We7E3KUldsRX_lsHrs5MtQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">一个方框图，用于快速概述一列中的异常值，根据结果标签命名怀孕。</figcaption></figure><h1 id="25a5" class="ll jo hi bd jp lm ln lo jt lp lq lr jx io ls ip kb ir lt is kf iu lu iv kj lv bi translated">接下来有统计数据可以拯救我们</h1><p id="2284" class="pw-post-body-paragraph kl km hi kn b ko kp ij kq kr ks im kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">我将讨论两种方法:</p><ol class=""><li id="1bc1" class="lw lx hi kn b ko lf kr lg jy ly kc lz kg ma ld mb mc md me bi translated">一个使用四分位范围。</li><li id="8a3c" class="lw lx hi kn b ko mf kr mg jy mh kc mi kg mj ld mb mc md me bi translated">其次使用标准差。稍后会详细介绍。</li></ol><h1 id="96f8" class="ll jo hi bd jp lm ln lo jt lp lq lr jx io ls ip kb ir lt is kf iu lu iv kj lv bi translated">1.使用四分位距或IQR移除异常值</h1><p id="b5b3" class="pw-post-body-paragraph kl km hi kn b ko kp ij kq kr ks im kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">所以，在我们理解这种剔除异常值的方法之前，我的朋友，我们首先需要理解百分位数。</p><h2 id="4888" class="jn jo hi bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">什么是百分位数？</h2><blockquote class="mk ml mm"><p id="5ef7" class="kl km le kn b ko lf ij kq kr lg im kt mn lh kv kw mo li ky kz mp lj lb lc ld hb bi translated">百分位数表示一组观察值中给定百分比的观察值低于该值。</p></blockquote><p id="e87c" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">考虑对包含100个值的数据集进行排序，并将其分成100等份，现在任何位置的值，比如第10个位置的值就是我们的第10个百分位，即索引10处的值表示10%的值低于该值。</p><p id="dc32" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">你可能已经看过这些值了。在哪里？在数据帧的描述方法中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/dc8e61b4aef2cc29fe8de679c1c79e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XC1o8lcPhCmp8ZVbFpjB7w.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">熊猫数据框架描述方法列出了第25、50和75百分位。</figcaption></figure><p id="58cc" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">一旦你理解了百分位数，就很容易理解IQR和确定阈值。怎么会？让我们先来看看IQR。</p><h2 id="910e" class="jn jo hi bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">什么是IQR的四分位距？</h2><blockquote class="mk ml mm"><p id="18d9" class="kl km le kn b ko lf ij kq kr lg im kt mn lh kv kw mo li ky kz mp lj lb lc ld hb bi translated">当从最低到最高排序时，IQR描述了值的中间50%。</p><p id="707c" class="kl km le kn b ko lf ij kq kr lg im kt mn lh kv kw mo li ky kz mp lj lb lc ld hb bi translated">IQR是第三个四分位数和第一个四分位数之间的差值。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mr"><img src="../Images/b75f16084968028043e537650c5423d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:264/format:webp/1*ixRhj7ED0IXEq6E-fDHiCA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">计算四分位距的通用方程</figcaption></figure><p id="fb6a" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">或者换句话说，大部分的价值。为了确定IQR <strong class="kn hj">，我们需要得到第三个四分位数</strong>和第一个四分位数<strong class="kn hj">。</strong></p><h2 id="d157" class="jn jo hi bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">什么是四分位数？</h2><blockquote class="mk ml mm"><p id="e5c3" class="kl km le kn b ko lf ij kq kr lg im kt mn lh kv kw mo li ky kz mp lj lb lc ld hb bi translated">同样，百分位数将数据分成4等份。因此，第25个百分位数是我们的<strong class="kn hj">第一个四分位数，</strong>第50个百分位数是第二个四分位数，<strong class="kn hj"> </strong>第75个百分位数是我们的<strong class="kn hj"> </strong>第三个四分位数。</p></blockquote><p id="a532" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">好消息是，计算四分位数并不困难。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="f79e" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">在这里，我计算了下限和上限来计算阈值。通常你会看到<code class="du mu mv mw mx b">th1</code>和<code class="du mu mv mw mx b">th3</code>被替换为<code class="du mu mv mw mx b">0.05</code>和<code class="du mu mv mw mx b">0.95</code>，以减少被视为离群值的数据量。</p><p id="d52b" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">现在回到检测异常值，我们现在有下限，上限，以及理解IQR和四分位数。</p><p id="685c" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">到目前为止，我们遵循了以下步骤:</p><ol class=""><li id="0878" class="lw lx hi kn b ko lf kr lg jy ly kc lz kg ma ld mb mc md me bi translated">计算第一和第三个四分位数。</li><li id="349b" class="lw lx hi kn b ko mf kr mg jy mh kc mi kg mj ld mb mc md me bi translated">用这些四分位数计算出IQR。</li><li id="5b3d" class="lw lx hi kn b ko mf kr mg jy mh kc mi kg mj ld mb mc md me bi translated">然后用IQR计算出介于两者之间的极限值。</li></ol><p id="08d7" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">接下来，我们将检查每一列的异常值，并用<code class="du mu mv mw mx b">replace_with_thresholds_iqr()</code>中的limit替换它们。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="3b18" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">通常，下限可能是负值，我们不希望在某些时候用负值替换，如“年龄”或“速度”。我编写这个函数的目的远不止于此，比如首先检查异常值并报告计数，一旦通过<code class="du mu mv mw mx b">replace = True</code>就替换，并打印一个漂亮的表格。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/6129b5ea9eef60bc5f816ae95d1a21dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PtdR2MpKpB4zPRug0jWkw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">使用四分位范围检查异常值。</figcaption></figure><p id="7b3b" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">执行检查，一旦您满意，然后通过<code class="du mu mv mw mx b">replace=True.</code>，我们就完成了！</p><p id="dba7" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">这种方法最适合当你的数据是偏斜的(右偏或左偏)时，比如在我用来演示的这个数据集中，有一列是右偏的。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/25c3b9b2c8472e88324e25047f575b45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWUbhB06yiadEvLFxd8mMg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">数据集中“怀孕”的核密度估计图。</figcaption></figure><h1 id="aa50" class="ll jo hi bd jp lm ln lo jt lp lq lr jx io ls ip kb ir lt is kf iu lu iv kj lv bi translated">2.使用标准差去除异常值。</h1><p id="ccd2" class="pw-post-body-paragraph kl km hi kn b ko kp ij kq kr ks im kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">我们可以移除异常值的另一种方式是通过从值的平均值取3个标准偏差来计算上边界和下边界(假设数据是正态/高斯分布)。</p><p id="8a0a" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">就像这个例子一样，</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/79d3df9dea2f627adeb7a90b63a6c4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NC_YsKMihSHHhkRG0jw5g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">数据集中“血压”的核密度估计图。</figcaption></figure><p id="bdc0" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">我们将利用正态分布的一个特殊性质。</p><p id="15bb" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">正态分布具有这样的性质，</p><ul class=""><li id="d055" class="lw lx hi kn b ko lf kr lg jy ly kc lz kg ma ld nc mc md me bi translated">数据的68% 落在<a class="ae nb" href="https://en.wikipedia.org/wiki/Mean" rel="noopener ugc nofollow" target="_blank">平均值</a>的一个<a class="ae nb" href="https://en.wikipedia.org/wiki/Standard_deviation" rel="noopener ugc nofollow" target="_blank">标准差</a>内。</li><li id="552c" class="lw lx hi kn b ko mf kr mg jy mh kc mi kg mj ld nc mc md me bi translated"><strong class="kn hj"> 95% </strong>的数据落在平均值的两个标准差内。</li><li id="07bd" class="lw lx hi kn b ko mf kr mg jy mh kc mi kg mj ld nc mc md me bi translated"><strong class="kn hj"> 99.7% </strong>的数据落在平均值的三个标准差内。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nd"><img src="../Images/0197a7c4a52941e3f037f916cb7e9373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VY7FvHvIz9ooT1AX9Kf0rw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">覆盖平均值第三个标准差的正态分布。</figcaption></figure><p id="e144" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">使用此属性，如果采用第三个标准差(或者您可以使用第二个标准差增加预期的异常值),我们可以预期有99.7%的值是正常的。).</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><p id="4d45" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">在这里，我只是通过在平均值上加上和减去3个标准差来创建上下边界。</p><p id="37e3" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">使用这个，我们现在可以像以前一样删除异常值。但是现在记住调用这个新函数。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="ms mt l"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/42677a20b92c19fd29c61e80cc3985f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIycwQExkHOThH5uWyKarA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">使用标准差检查异常值。</figcaption></figure><p id="e746" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">就像以前一样，一旦我们满意地通过<code class="du mu mv mw mx b">replace=True</code>，离群值就会消失。</p><blockquote class="mk ml mm"><p id="22c6" class="kl km le kn b ko lf ij kq kr lg im kt mn lh kv kw mo li ky kz mp lj lb lc ld hb bi translated"><strong class="kn hj">注意</strong>:在两个例子中，我都传递了所有的列<strong class="kn hj">，这并不总是必需的/合适的。</strong></p></blockquote><h1 id="50c6" class="ll jo hi bd jp lm ln lo jt lp lq lr jx io ls ip kb ir lt is kf iu lu iv kj lv bi translated">我应该选择哪一个？</h1><p id="aa57" class="pw-post-body-paragraph kl km hi kn b ko kp ij kq kr ks im kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">理想情况下，<strong class="kn hj"> IQR方法是</strong> <strong class="kn hj">最适合于</strong><a class="ae nb" href="https://en.wikipedia.org/wiki/Skewness" rel="noopener ugc nofollow" target="_blank"><strong class="kn hj"/></a>(左侧或右侧)倾斜的数据集(您可以通过绘制直方图或内核密度估计图来检查它们是否倾斜)。<strong class="kn hj">但是您需要通过检查下限和上限来检查极限值</strong>。</p><p id="f0b2" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi translated">否则，如前所述，当数据呈正态分布(这种情况很常见)时，使用标准差来检测异常值。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nf"><img src="../Images/e29d25136e508e5cc0f86203a25297d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFaMFgdi-hPW-1vpuNnmNQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">右偏、正态/对称、左偏分布</figcaption></figure></div><div class="ab cl ng nh gp ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="hb hc hd he hf"><h1 id="78f3" class="ll jo hi bd jp lm nn lo jt lp no lr jx io np ip kb ir nq is kf iu nr iv kj lv bi translated">我是谁？</h1><p id="969b" class="pw-post-body-paragraph kl km hi kn b ko kp ij kq kr ks im kt jy ku kv kw kc kx ky kz kg la lb lc ld hb bi translated">我是阿努拉格·达泽·✌.终身学习者，对机器学习充满热情。每天都在成长。</p><p id="3efb" class="pw-post-body-paragraph kl km hi kn b ko lf ij kq kr lg im kt jy lh kv kw kc li ky kz kg lj lb lc ld hb bi ns translated">如果你喜欢这个帖子，请点击“鼓掌”按钮！关注我，分享我的旅程，你也可以在Twitter<strong class="kn hj">|</strong><a class="ae nb" href="https://www.linkedin.com/in/anuragdhadse/" rel="noopener ugc nofollow" target="_blank"><strong class="kn hj">LinkedIn</strong>|</a><a class="ae nb" href="https://github.com/adhadse" rel="noopener ugc nofollow" target="_blank">|<strong class="kn hj">Github</strong></a><strong class="kn hj"/>上联系我。</p></div></div>    
</body>
</html>