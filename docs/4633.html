<html>
<head>
<title>Build a web app to play random songs on Spotify using HTML and JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个web应用程序，使用HTML和JavaScript在Spotify上随机播放歌曲</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/a-web-app-to-play-random-songs-from-spotify-with-html-and-javascript-3ecc4dd93651?source=collection_archive---------0-----------------------#2021-12-05">https://medium.com/analytics-vidhya/a-web-app-to-play-random-songs-from-spotify-with-html-and-javascript-3ecc4dd93651?source=collection_archive---------0-----------------------#2021-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8cf5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated">在推荐、算法驱动的发现和泡沫效应的吸引下，我踏上了构建一个简单(简单到一键操作)的应用程序的旅程，从整个Spotify目录中给我一首“<em class="jm">随机</em>歌曲。</p><blockquote class="jn jo jp"><p id="2897" class="if ig jm ih b ii ij ik il im in io ip jq ir is it jr iv iw ix js iz ja jb jc hb bi translated">随机，不是基于流派，情绪或任何东西。</p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/529bfa400b1ee0973efa40b07c2c86bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_cJ7OUMsgcQ_gcjL"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">照片由<a class="ae kj" href="https://unsplash.com/@akopovaks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯蒂娜·阿科波娃</a>在<a class="ae kj" href="https://unsplash.com/s/photos/vinyl-player?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="6c18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了保持开发和部署简单快速，我选择通过<a class="ae kj" href="http://glitch.com" rel="noopener ugc nofollow" target="_blank"> Glitch </a>来构建它，并使用<a class="ae kj" href="https://glitch.com/edit/#!/spotify-recommendations" rel="noopener ugc nofollow" target="_blank">这个模板</a>来处理所有烦人但必要的事情(查看您的身份验证、令牌处理、重定向……)</p><p id="5003" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是这个应用程序的样子(你可以在这里找到它:<a class="ae kj" href="https://spotify-random-song.glitch.me/#" rel="noopener ugc nofollow" target="_blank">https://spotify-random-song.glitch.me/</a>):</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kk"><img src="../Images/b77d1f033161041ad7e045427a404638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jelwkHfYcdKYDJnrUvr_eQ.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">一键。</figcaption></figure><p id="66eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上就是一键。当点击它时，它会从Spotify中选择一首“<em class="jm">random”</em>歌曲，如果您有Spotify Premium，它会自动开始播放，否则会提供一个播放按钮来播放歌曲。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es kl"><img src="../Images/c61b9612d59b0721df319edf8d6e5310.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*t7ykuTlmQQXS82mJ2qWbRg.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">一首随机的巴赫歌曲出现了。</figcaption></figure><h1 id="dea5" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">事实真相</h1><p id="c8ec" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi jd translated">既然我们已经看到了辉煌的用户界面，让我们深入代码了解它是如何工作的。首先，让我们看看Glitch 的<a class="ae kj" href="https://glitch.com/edit/#!/spotify-random-song" rel="noopener ugc nofollow" target="_blank">源代码中包含的文件:</a></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es lp"><img src="../Images/dfacffa582c095296451e3d1fabb94bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*EhmSlZNjHE8UpdD6RQ5obA.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">目录内容</figcaption></figure><p id="3c77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所看到的，它的结构非常简单，只有一个<strong class="ih hj"><em class="jm"/></strong>文件，负责呈现用户界面和小部件，还有<strong class="ih hj"> <em class="jm"> script.js </em> </strong>，包含了验证用户身份、连接到Spotify SDK以及播放和保存歌曲的所有逻辑。</p><h2 id="c22d" class="lq kn hi bd ko lr ls lt ks lu lv lw kw iq lx ly la iu lz ma le iy mb mc li md bi translated">用户认证</h2><p id="9789" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi jd translated">第一步是<strong class="ih hj">通过Javascript </strong>认证Spotify用户。为此，我们使用下面的代码，摘自<a class="ae kj" href="https://glitch.com/edit/#!/spotify-recommendations" rel="noopener ugc nofollow" target="_blank">这里的</a>:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es me"><img src="../Images/a308fb5c229c27b7a470f25ab232566c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tyzbVlKqYgUWKzyCbVzS5Q.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">鉴定Spotify</figcaption></figure><p id="2cb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，这段代码会在新用户第一次访问Spotify应用程序时，将其重定向到Spotify登录页面。由于用户将播放歌曲并可能将它们保存到他们自己的库中，我们需要请求“流”、“用户修改回放状态”和“用户库修改”范围。</p><blockquote class="jn jo jp"><p id="107d" class="if ig jm ih b ii ij ik il im in io ip jq ir is it jr iv iw ix js iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>这段代码需要安装一个Spotify应用程序来创建您的客户端ID和密码，并设置重定向URI。如果你正在寻找如何做到这一点的信息，你可以遵循<a class="ae kj" href="https://developer.spotify.com/documentation/web-api/quick-start/" rel="noopener ugc nofollow" target="_blank">这个指南</a>。</p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/2afe90a7afd2052a1171b5b394981d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s5LncScBbN1Y61fq"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">照片由<a class="ae kj" href="https://unsplash.com/@adkorte?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">阿德里安·科特</a>在<a class="ae kj" href="https://unsplash.com/s/photos/music?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h2 id="2afc" class="lq kn hi bd ko lr ls lt ks lu lv lw kw iq lx ly la iu lz ma le iy mb mc li md bi translated">网络播放设置</h2><p id="ff98" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi jd translated"><span class="l je jf jg bm jh ji jj jk jl di">用户登录后，我们可以设置Web Playback SDK来控制他们的Spotify播放器。为此，我们再次使用下面的代码，从<a class="ae kj" href="https://glitch.com/edit/#!/spotify-recommendation" rel="noopener ugc nofollow" target="_blank">到这里的</a>:</span></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mf"><img src="../Images/b2566cf866d41d87abcef501bd617816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*k8FinyW7XDiNo08EaWMLjA.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">设置Web Playback SDK来控制用户的Spotify播放器</figcaption></figure><p id="129a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这段代码使用认证期间获得的令牌来初始化一个新的Spotify。播放器对象，负责播放或跳过曲目。</p><p id="aaac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经准备好了播放器，我们可以使用下面的代码来播放一首特定的歌曲:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mg"><img src="../Images/639a83fbacad8f045dfdc1a03bb2f772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*d2dn6g9qe71_fVJUhqxkiQ.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">通过Spotify播放器API播放特定歌曲</figcaption></figure><p id="fe53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的<strong class="ih hj">播放</strong>功能有两个输入:</p><ol class=""><li id="2ab3" class="mh mi hi ih b ii ij im in iq mj iu mk iy ml jc mm mn mo mp bi translated">device_id:将播放曲目的Spotify设备；注意，这是在前面的代码块中自动初始化的，它由web浏览器本身表示；</li><li id="714c" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">曲目:这是一首曲目的Spotify URI，例如:<em class="jm">Spotify:track:6 oqtj 7 llyuiejkfx R4 muuy</em></li></ol><h2 id="c131" class="lq kn hi bd ko lr ls lt ks lu lv lw kw iq lx ly la iu lz ma le iy mb mc li md bi translated">自定义代码:随机选择一首歌曲播放</h2><p id="2404" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi jd translated">随着一切的设置，我们现在可以专注于编写自定义代码来实现我们希望包含在应用程序中的功能，即<strong class="ih hj">点击按钮播放随机歌曲。</strong></p><p id="4b5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要一种方法来挑选看似随机的歌曲。在这个reddit线程之外，我选择<strong class="ih hj">生成两个字母的随机字符串</strong>作为搜索中的查询，如“be”、“ma”、“yt”等。等等。</p><p id="c608" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个函数负责生成这样的查询:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mv"><img src="../Images/b6f1e91ee7d326094164adc52ed6865c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*NeY_GspyV0ykfkQUNL0JgQ.png"/></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">生成两个字母的随机字符串</figcaption></figure><p id="cd8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是使用生成的查询对搜索API端点执行<strong class="ih hj"> HTTP GET调用，在随机位置检索结果并播放它。</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mw"><img src="../Images/804eadb325ab2e0996ca2c5d49c16d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rg3WhjYBop-cXFd-UqAYxw.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">随机选择一首歌曲并播放。</figcaption></figure><p id="fe74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的<strong class="ih hj"> getASong </strong>函数首先执行对搜索API端点的HTTP Ajax调用，使用由上面的<strong class="ih hj"> generateQuery </strong>生成的随机查询和随机偏移量作为参数。如果这个调用成功，它将调用上面看到的<strong class="ih hj"> play </strong>函数，开始播放。此外，如果需要，它会显示一个嵌入小部件来手动启动/停止播放。</p><h2 id="16c4" class="lq kn hi bd ko lr ls lt ks lu lv lw kw iq lx ly la iu lz ma le iy mb mc li md bi translated">最后一步:将曲目保存到用户的曲库</h2><p id="1e22" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi jd translated">由于这个小工具的全部目的是寻找新的音乐，我们必须给用户保存曲目的可能性，以防运气来了，随机输出成为他们新的最喜欢的歌曲。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/076a3d6527811b4d246108b4fbbdec69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DEplfwPXipdJzsxg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">Nicola Fioravanti 在<a class="ae kj" href="https://unsplash.com/s/photos/heart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="0b73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们可以编写一个函数来执行对Tracks API 的<strong class="ih hj"> HTTP PUT调用，将歌曲添加到用户的库中:</strong></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mx"><img src="../Images/f67afa3cf88419270f7fde0625872544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWjUc0lcPLK1XSk6UBiVbA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">将曲目保存到用户资料库</figcaption></figure><p id="cf56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样！</p></div><div class="ab cl my mz gp na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="hb hc hd he hf"><blockquote class="jn jo jp"><p id="5881" class="if ig jm ih b ii ij ik il im in io ip jq ir is it jr iv iw ix js iz ja jb jc hb bi translated">想要更多吗？在这篇文章中找出如何创建你自己的播放列表生成器！</p></blockquote><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/df7a63bbe15428f107067ab007c43862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nvje8JtaDkaeBOn_"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx translated">Miguel Orós 在<a class="ae kj" href="https://unsplash.com/s/photos/more?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h2 id="f62c" class="lq kn hi bd ko lr ls lt ks lu lv lw kw iq lx ly la iu lz ma le iy mb mc li md bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="0727" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi jd translated"><span class="l je jf jg bm jh ji jj jk jl di"> F </span>或者那些一路向下滚动的人，这篇帖子展示了如何<strong class="ih hj">用JavaScript </strong>构建一个web应用程序来:认证Spotify并设置Web Playback SDK来播放Spotify的随机歌曲；通过Spotify API搜索歌曲并将其保存到用户的曲库。</p><h2 id="ae48" class="lq kn hi bd ko lr ls lt ks lu lv lw kw iq lx ly la iu lz ma le iy mb mc li md bi translated">有用的链接和来源</h2><p id="54ef" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">在这里，您可以找到运行该应用程序的代码:</p><blockquote class="jn jo jp"><p id="19c8" class="if ig jm ih b ii ij ik il im in io ip jq ir is it jr iv iw ix js iz ja jb jc hb bi translated">源代码:<a class="ae kj" href="https://glitch.com/edit/#!/spotify-random-song" rel="noopener ugc nofollow" target="_blank">https://glitch.com/edit/#!/spotify-random-song</a><br/>直播app:<a class="ae kj" href="https://spotify-random-song.glitch.me/#" rel="noopener ugc nofollow" target="_blank">https://spotify-random-song.glitch.me/</a>T5】用于Auth &amp;网页播放设置的模板:<a class="ae kj" href="https://glitch.com/edit/#!/spotify-recommendations" rel="noopener ugc nofollow" target="_blank">https://glitch.com/edit/#!/spotify-recommendations</a></p></blockquote></div></div>    
</body>
</html>