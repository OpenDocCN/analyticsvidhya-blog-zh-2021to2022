<html>
<head>
<title>Importing and Cleaning up from SPSS Survey Data to Power BI (with R script or SPSS syntax)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从SPSS调查数据导入和清理到Power BI(使用R脚本或SPSS语法)</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/importing-and-cleaning-up-from-spss-survey-data-to-power-bi-with-r-script-or-spss-syntax-8abd1c223d64?source=collection_archive---------7-----------------------#2021-10-11">https://medium.com/analytics-vidhya/importing-and-cleaning-up-from-spss-survey-data-to-power-bi-with-r-script-or-spss-syntax-8abd1c223d64?source=collection_archive---------7-----------------------#2021-10-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3aaa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi jc translated">来自家庭调查的数据通常以一张又一张有用信息表的形式呈现，这些有用信息具有重要的独特背景特征，如受访者的财富，无论他们是生活在城市还是农村地区。他们居住的地区、年龄、性别或种族。</p><p id="4809" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">问题是大多数用户发现表格不如数据可视化时友好和容易浏览。包括多指标类集调查在内的大多数调查已经开始制作主要调查结果报告的附件，以各种可视化的表格形式发布。对于多指标类集调查，这些将是<a class="ae jl" href="https://youtu.be/mQ0ZArXlbiQ" rel="noopener ugc nofollow" target="_blank">快照</a>，一个传单或小册子的形式，以图表形式呈现数据，按主题分组，添加关键信息，为数据提供一些背景信息。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es jm"><img src="../Images/7b63a0454ca213dc73b239d9490bf635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RK3P6AWfXtVIwsLS0b6RNA.jpeg"/></div></div></figure><p id="a39d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些都是好的方向，但是数据也可以很容易地以动态方式呈现，使用一些可用的数据可视化工具，如Tableau或Power BI。他们可以使用交互式仪表盘自由探索数据，而不是向用户显示固定的图表。</p><p id="d334" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">和其他情况一样，每个调查项目都有一个使用特定统计分析包的标准。<a class="ae jl" href="https://mics.unicef.org/" rel="noopener ugc nofollow" target="_blank">多指标类集调查</a>调查通常会从每次调查中创建多达七个数据集，并在SPSS *中生成数据集。sav '格式。SPSS不是开源的，各种许可证可能会变得很贵。</p><p id="4af8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Tableau可以自动读取SPSS文件，将它们导入到平台没有问题。另一方面，BI不能。这真的是一个遗憾，因为以交互方式表示复杂的家庭调查数据应该是这样一个平台的优先事项，但是对于SPSS和Power BI之间目前的不兼容，当然还有许多工作要做。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es jy"><img src="../Images/78284cee4cca03a33f267804b734d1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9V4F-S1RwkNvL-EKs9DR_g.jpeg"/></div></div></figure><p id="8eae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要在Power BI中导入数据，如果用户拥有SPSS软件许可证，他们只需运行一个语法来转换*。将文件保存为兼容的格式，清理数据(删除仪表板中不会使用的变量或计算不在原始数据集中的额外变量)。这篇文章描述的另一种方法是在Power BI中运行R脚本，并使用R代码将SPSS调查数据导入Power BI平台，这是一个非常酷的选择。</p><p id="6b91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据我的经验，Power BI和Tableau都非常适合可视化数据。这两个包都有自己的语言(分别是DAX和VizQL ),可以用来对导入的数据进行额外的操作和分析。然而，这种分析有点笨拙，像SPSS或R这样的平台是进行任何分析的更好的方式。例如，在DAX中进行计算，尤其是在大型数据集上，会导致仪表板加载速度变慢，在某种程度上，Tableau中也会发生这种情况。根据我的经验，最好是在数据分析包中尽可能多地准备所需的数据集，并只上传数据集中实际用于数据可视化平台的变量，而不是将整个文件放在那里，或者创建额外的计算变量，特别是如果有很多变量的话。</p><p id="6ab2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本练习中，使用多指标类集调查快照模板为<a class="ae jl" href="https://mics-surveys-prod.s3.amazonaws.com/MICS6/East%20Asia%20and%20the%20Pacific/Tonga/2019/Snapshots/Tonga%20MICS%202019%20Snapshot_English.pdf" rel="noopener ugc nofollow" target="_blank">汤加多指标类集调查2019 </a>调查制作的快照被复制，重点是显示调查和样本特征信息系列中的第一个快照。如前所述，只有在Power BI或Tableau中将此快照重新创建为交互式仪表板所需的变量才会被导入，其他变量(如不同调查问卷的完成率)将在导入前进行计算。请注意，多指标类集调查中的数据集仅显示问卷中的值，在大多数情况下没有任何额外的计算。在这篇文章中，我们将只关注数据清理，在接下来的文章中，我们将展示如何在Power BI和Tableau中创建这些仪表盘。</p><p id="11cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用SPSS导入</strong></p><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es jz"><img src="../Images/6c59b633183fe22c4f76bdce99246f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/1*uQiYyEJRaa0r4hoOjeYoXQ.png"/></div></figure><p id="501c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种方法要求用户安装SPSS。正如建议的那样，用户将削减文件并计算SPSS中原始数据集中没有的所有附加变量，然后才进行导入。语法然后创建一个excel文件(这可能是一些其他类型的数据格式，如' *。csv '文件),可以很容易地导入到Power BI平台中。语法和一些附加注释如下:</p><pre class="jn jo jp jq fd ka kb kc kd aw ke bi"><span id="91ea" class="kf kg hh kb b fi kh ki l kj kk">cd 'C:\path\file'.</span><span id="d7e4" class="kf kg hh kb b fi kl ki l kj kk">* Call include file for the working directory and the survey name.<br/></span><span id="d4dd" class="kf kg hh kb b fi kl ki l kj kk">* Open the household data file.<br/>get file = 'hh.sav'.</span><span id="6910" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each HH to calculate total number of hhs sampled.<br/>compute sampled = 1.</span><span id="e8a7" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each HH occupied to calculate total number of hhs occupied.<br/>recode HH46 (1,2,4,7 = 1) (else = 0) into occupied.</span><span id="e916" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each hh interviewed to calculate total no of interviewed HHs.<br/>recode HH46 (1 = 1) (else = 0) into complete.</span><span id="50ec" class="kf kg hh kb b fi kl ki l kj kk">recode HH52 (1 thru hi = 1)(else = 0) into HH52A.</span><span id="896e" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each hh selected for water quality test.<br/>recode HH9 (1 = 1) (else = 0) into wqSelect.<br/>* exclude cases with incomplete household interview.<br/>if HH46 &lt;&gt; 1 wqSelect = 0.</span><span id="2097" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each water quality test completed at household.<br/>recode WQ11 (1 = 1) (else = 0) into wqhhcomplete.</span><span id="f037" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each water quality test completed at source.<br/>recode WQ19 (1 = 1) (else = 0) into wqsocomplete.</span><span id="12be" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to highest each wm questionnaire eligible.<br/>recode HH49 (sysmis = 0) (else = copy) into wmTot.</span><span id="0658" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each wm questionnaire completed.<br/>recode HH53 (sysmis = 0) (else = copy) into wmComp.</span><span id="5f2d" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to highest each mn questionnaire eligible.<br/>recode HH50A (sysmis = 0) (else = copy) into mnTot.</span><span id="8432" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each mn questionnaire completed.<br/>recode HH53 (sysmis = 0) (else = copy) into mnComp.</span><span id="1e21" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to highest each ch questionnaire eligible.<br/>recode HH51 (sysmis = 0) (else = copy) into ch05Tot.</span><span id="738b" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each mn questionnaire completed.<br/>recode HH55 (sysmis = 0) (else = copy) into ch05Comp.</span><span id="9d53" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to highest each ch questionnaire eligible.<br/>recode HH52A (sysmis =0) (else = copy) into ch517Tot.</span><span id="90bf" class="kf kg hh kb b fi kl ki l kj kk">* Give value 1 to each mn questionnaire completed.<br/>recode HH55 (sysmis =0) (else = copy) into ch517Comp.</span><span id="31e5" class="kf kg hh kb b fi kl ki l kj kk">compute total = 1.<br/>variable labels total "".<br/>value labels total 1 "Total".</span><span id="eec8" class="kf kg hh kb b fi kl ki l kj kk">save outfile = dataPowerBI2.sav <br/>  /keep <br/>HH1<br/>HH2<br/>occupied<br/>complete<br/>HH52A<br/>wqSelect<br/>wqhhcomplete<br/>wqsocomplete<br/>HH49<br/>HH53<br/>HH50A<br/>HH50<br/>HH54<br/>HH51<br/>HH55<br/>HH52<br/>HH56<br/>total<br/>HH6 HH7 religion windex5 HHSEX.</span><span id="f2c9" class="kf kg hh kb b fi kl ki l kj kk">SAVE TRANSLATE OUTFILE = 'C:\Users\Power BI SPSS\dataPowerBI22.xls'<br/> /TYPE=XLS<br/>  /keep <br/>HH1<br/>HH2<br/>occupied<br/>complete<br/>HH52A<br/>wqSelect<br/>wqhhcomplete<br/>wqsocomplete<br/>HH49<br/>HH53<br/>HH50A<br/>HH50<br/>HH54<br/>HH51<br/>HH55<br/>HH52<br/>HH56<br/>total<br/>HH6 HH7 religion windex5 HHSEX<br/>  /MISSING=IGNORE</span></pre><p id="68dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用R输入</strong></p><figure class="jn jo jp jq fd jr er es paragraph-image"><div class="er es km"><img src="../Images/076c85d5413e7ac67c0b13662e8519a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*GdjuHbjq9IIFLRiwYoCCAA.png"/></div></figure><p id="6c85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Power BI是一个强大的工具，集成在MS Office环境中。我最喜欢的特性之一是它与R和Phyton脚本的集成。当然，使用R，您可以从SPSS文件中创建一个Power BI可读格式的文件，然后将其导入到程序中。但是，您也可以打开Power BI，在那里粘贴或编写您的R脚本，并在那里创建所需的数据集版本。</p><p id="e12f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个例子中，我保留并计算了与使用SPSS语法创建的excel文件中导入的变量相同的变量。然而，不是创建要导入的文件，而是编写脚本，以便它基于Power BI中的ran脚本生成数据集。因为我将制作切片器(Power BI的另一个伟大特性),我还将一些变量从数字响应类别重新编码为文本类别，使用户更容易浏览。</p><pre class="jn jo jp jq fd ka kb kc kd aw ke bi"><span id="a944" class="kf kg hh kb b fi kh ki l kj kk">library(foreign)</span><span id="da61" class="kf kg hh kb b fi kl ki l kj kk">path = 'C:/Users/R SPSS'<br/>setwd(path)</span><span id="80a9" class="kf kg hh kb b fi kl ki l kj kk"># Tonga Data<br/>data = read.spss('C:/Users/SPSS/hh.sav', to.data.frame = T, use.value.labels = FALSE)</span><span id="703d" class="kf kg hh kb b fi kl ki l kj kk"># Give value 1 to each HH to calculate total number of hhs sampled.<br/>data$sampled&lt;-1</span><span id="ef3f" class="kf kg hh kb b fi kl ki l kj kk">data$total&lt;-1</span><span id="f444" class="kf kg hh kb b fi kl ki l kj kk"># Give value 1 to each HH occupied to calculate total number of hhs occupied.<br/>data$occupied&lt;-ifelse(data$HH46 %in% c(1,2,4,7),1,0)</span><span id="582d" class="kf kg hh kb b fi kl ki l kj kk"># Give value 1 to each hh interviewed to calculate total no of interviewed HHs.<br/>data$complete &lt;-ifelse(data$HH46==1,1,0)<br/>data$HH52&lt;-as.numeric(data$HH52)<br/>data$HH52A &lt;-ifelse(data$HH52&lt;0,1,0)</span><span id="67a6" class="kf kg hh kb b fi kl ki l kj kk"># * Give value 1 to each water quality test completed at household.<br/>data$wqhhcomplete &lt;-ifelse(data$WQ11==1,1,0)</span><span id="3b91" class="kf kg hh kb b fi kl ki l kj kk"># Give value 1 to each water quality test completed at source.<br/>data$wqsocomplete &lt;-ifelse(data$WQ19==1,1,0)</span><span id="92cb" class="kf kg hh kb b fi kl ki l kj kk">#Give value 1 to highest each wm questionnaire eligible.<br/>data$wmTot &lt;-ifelse(is.na(data$HH49),0,data$HH49)<br/>data$wmComp &lt;-ifelse(is.na(data$HH53),0,data$HH53)<br/>#Give value 1 to highest each mn questionnaire eligible.<br/>data$mnTot &lt;-ifelse(is.na(data$HH50A),0,data$HH50A)<br/>data$mnComp &lt;-ifelse(is.na(data$HH54),0,data$HH54)<br/># Give value 1 to highest each ch questionnaire eligible.<br/>data$ch05Tot &lt;-ifelse(is.na(data$HH51),0,data$HH51)<br/>data$ch05Comp &lt;-ifelse(is.na(data$HH55),0,data$HH55)</span><span id="2d10" class="kf kg hh kb b fi kl ki l kj kk">data$ch518Tot &lt;-ifelse(is.na(data$HH52),0,data$HH52)<br/>data$ch517Comp &lt;-ifelse(is.na(data$HH56),0,data$HH56)</span><span id="1c43" class="kf kg hh kb b fi kl ki l kj kk">data &lt;- subset(data, select = c("HH1",<br/>                                "HH2",<br/>                                "occupied",<br/>                                "complete",<br/>                                "HH52A",<br/>                                "wqhhcomplete",<br/>                                "wqsocomplete",<br/>                                "HH49",<br/>                                "HH53",<br/>                                "HH50A",<br/>                                "HH50",<br/>                                "HH54",<br/>                                "HH51",<br/>                                "HH55",<br/>                                "HH52",<br/>                                "HH56",<br/>                                "total",<br/>                                "HH6", "HH7", "religion", "windex5", "HHSEX", "ethnicity"))</span><span id="909b" class="kf kg hh kb b fi kl ki l kj kk">#adding Text Labels to Slicers<br/>#Wealth index</span><span id="7c95" class="kf kg hh kb b fi kl ki l kj kk">data$wealth[data$windex5 == 1] &lt;- "Poorest"<br/>data$wealth[data$windex5 == 2] &lt;- "Second"<br/>data$wealth[data$windex5 == 3] &lt;- "Middle"<br/>data$wealth[data$windex5 == 4] &lt;- "Fourth"<br/>data$wealth[data$windex5 == 5] &lt;- "Richest"<br/>#Area<br/>data$area[data$HH6 == 1] &lt;- "Urban"<br/>data$area[data$HH6 == 2] &lt;- "Rural"<br/>#Island Division</span><span id="3705" class="kf kg hh kb b fi kl ki l kj kk">data$region[data$HH7 == 1] &lt;- "TONGATAPU"<br/>data$region[data$HH7 == 2] &lt;- "VAVA'U"<br/>data$region[data$HH7 == 3] &lt;- "HA'APAI"<br/>data$region[data$HH7 == 4] &lt;- "'EUA"<br/>data$region[data$HH7 == 5] &lt;- "ONGO NIUA"</span><span id="e4c2" class="kf kg hh kb b fi kl ki l kj kk">#religion</span><span id="35ce" class="kf kg hh kb b fi kl ki l kj kk">data$religion[data$religion == 1] &lt;- "Free Wesleyan Church"<br/>data$religion[data$religion == 2] &lt;- "Latter Day Saints"<br/>data$religion[data$religion == 3] &lt;- "Roman Catholic"<br/>data$religion[data$religion == 4] &lt;- "Free Church of Tonga"<br/>data$religion[data$religion == 5] &lt;- "Other religion"</span><span id="9867" class="kf kg hh kb b fi kl ki l kj kk">data</span></pre><p id="e366" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此处提供了将详细讨论的Power BI仪表盘:</p><div class="kn ko ez fb kp kq"><a href="https://www.powerbi.com/view?r=eyJrIjoiZjNhMTIwMDAtNWNhNC00N2RkLWI5ZTQtZTc2MWQyYmMyZjQzIiwidCI6IjdlYTk4ZmYzLWRmY2EtNDgwNi1iYjU3LWMxNmY2ZWY0N2Q0NyIsImMiOjl9&amp;embedImagePlaceholder=true&amp;pageName=ReportSection" rel="noopener  ugc nofollow" target="_blank"><div class="kr ab dw"><div class="ks ab kt cl cj ku"><h2 class="bd hi fi z dy kv ea eb kw ed ef hg bi translated">电源BI报告</h2><div class="kx l"><h3 class="bd b fi z dy kv ea eb kw ed ef dx translated">由Power BI支持的报告</h3></div><div class="ky l"><p class="bd b fp z dy kv ea eb kw ed ef dx translated">www.powerbi.com</p></div></div></div></a></div></div></div>    
</body>
</html>