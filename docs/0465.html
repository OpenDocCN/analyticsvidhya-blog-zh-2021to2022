<html>
<head>
<title>Send Automatique outlook email with Python and VBA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和VBA发送自动outlook电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/send-an-outlook-email-on-your-python-script-using-vba-c0709faec301?source=collection_archive---------22-----------------------#2021-01-17">https://medium.com/analytics-vidhya/send-an-outlook-email-on-your-python-script-using-vba-c0709faec301?source=collection_archive---------22-----------------------#2021-01-17</a></blockquote><div><div class="dt gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a123" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">发送outlook电子邮件的简单技巧，无需编写任何协议。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et jd"><img src="../Images/93bfd3a0cfa14e3b6d5599bcdc86f79e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuheXKNPd97EDoTAWe5OMQ.jpeg"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy translated">Solen Feyissa 在<a class="ae jt" href="https://unsplash.com/s/photos/email?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="e0c8" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">为什么我不用任何强大的python库？</h2><p id="e356" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我决定写这个故事，因为我面临这样一种情况:我使用python脚本来分析一家制造公司的销售成本，并且需要通过邮件与同事分享分析结果。我开始在google上查找哪个库可以处理我代码中的这一简单步骤，并很快意识到我必须考虑库所使用的协议的有效性。<br/>是的，我使用的是自带安全功能的专业outlook账户。当然，我找到的所有解决方案都是基于我的脚本向我的outlook函数发出的特定协议请求(通常是smtp)。当然，公司的安全工具会产生一个“拒绝访问”的答案。</p><p id="691a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在我的代码中，我已经能够与另一个Microsoft office应用程序进行交互:Excel。事实上，我不得不将我的分析结果上传到一个Excel报告中并与他人分享。我甚至不得不启动一个宏来进行额外的操作。</p><p id="f50e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯…如果我可以找到一种有效的方法，使用VBA宏通过邮件共享该报告，然后在我的python脚本中包含一行代码来运行该宏，会怎么样呢？</p><p id="1cef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不太喜欢VBA，尤其是Excel。但我不得不承认，这种语言的美妙之处在于，我们可以轻松地引用其他微软对象，如PowerPoint、Word和Outlook。</p><h2 id="a978" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">VBA电码</h2><p id="3c21" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">首先，我们在Visual Basic编辑器中选择outlook对象。点击“工具/参考”</p><figure class="je jf jg jh fe ji es et paragraph-image"><div class="es et ku"><img src="../Images/86e4e8c06d2f9bb7be37ae50466fe302.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*0hpwKTGNyKbIQKpCLuLfcg.png"/></div><figcaption class="jp jq eu es et jr js bd b be z dy translated">图片来自作者</figcaption></figure><p id="cb3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并选择outlook对象。这基本上是我们将在代码中调用的对象。</p><figure class="je jf jg jh fe ji es et paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="es et kv"><img src="../Images/ac9fd15bcf22c8fb4906d41a79d59071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qkk7zGvrxBf_ZMegD6HsAg.png"/></div></div><figcaption class="jp jq eu es et jr js bd b be z dy translated">图片来自作者</figcaption></figure><p id="ee2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码本身非常简单:</p><pre class="je jf jg jh fe kw kx ky kz aw la bi"><span id="c7f9" class="ju jv hi kx b fj lb lc l ld le">Sub Emails()<br/><br/>  Dim App As Outlook.Application<br/>  Dim Mail As Outlook.MailItem<br/><br/>  Set App = New Outlook.Application<br/>  Set Mail = OutlookApp.CreateItem(olMailItem)<br/>  <br/>  With Mail<br/>    .BodyFormat = olFormatHTML<br/>    .Display<br/>    .HTMLBody = "Dear colleagues" &amp; "&lt;br&gt;" &amp; "&lt;br&gt;" &amp; "Please find the attached file" <br/>    .To = "receiver email"<br/>    .CC = "cc receiver email"<br/>    .BCC = "bcc receiver email"<br/>    .Subject = "Cost of sales report"<br/>    .Attachments = ThisWorkbook<br/>    .Send<br/>  End With<br/><br/>End Sub</span></pre><p id="a941" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是一些解释:</p><p id="c1f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lf"> Sub Emails/End Sub </em>:创建Sub过程的常用方式。<br/> <em class="lf"> Dim App as Outlook。应用程序</em>:创建变量Outlook应用程序<br/> <em class="lf"> Dim Mail as Outlook。MailItem </em>:创建将要发送的变量email。<br/> <em class="lf">设置App </em> =新展望。应用:我们打开app <br/> <em class="lf">设置邮件</em> = OutlookApp。CreateItem(olMailItem):我们创建一个新的电子邮件</p><p id="0f41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用变量“Mail ”,我们使用代码中提到的对象来设置电子邮件。我猜没什么复杂的，除了代码中的“<br/>”。如果你对HTML没有信心，它只是一种打破界限的方式，在“亲爱的…”和信息的其余部分之间创造一个空间。</p><p id="84a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，关于附件，我把它放在这里“这个工作簿”,但你也可以创建另一个变量，它的路径指向另一个文件，并把它放在附件中。</p><h2 id="8a4a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">在Python中运行宏</h2><p id="01d6" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">首先，如果您想要更详细的python和Excel交互项目，我可以向您推荐我的一篇文章，其中我介绍了用Python刷新Excel报表的简单方法(包括宏运行):</p><div class="lg lh fa fc li lj"><a href="https://towardsdatascience.com/spice-up-your-excel-with-python-621c9693c027" rel="noopener follow" target="_blank"><div class="lk ab dx"><div class="ll ab lm cl cj ln"><h2 class="bd hj fj z dz lo eb ec lp ee eg hh bi translated">使用python为您的excel增添趣味</h2><div class="lq l"><h3 class="bd b fj z dz lo eb ec lp ee eg dy translated">熟悉python，让您的Excel报表更上一层楼。</h3></div><div class="lr l"><p class="bd b fq z dz lo eb ec lp ee eg dy translated">towardsdatascience.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx jn lj"/></div></div></a></div><p id="d2cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，基本上当我使用excel时，我会使用xlwings，这是我最喜欢的库:</p><pre class="je jf jg jh fe kw kx ky kz aw la bi"><span id="d986" class="ju jv hi kx b fj lb lc l ld le">import xlwings as xw</span></pre><p id="32e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我将为工作簿报告设置一个变量(注意:xlsb而不是xlsx，因为它是一个启用宏的文件)。</p><pre class="je jf jg jh fe kw kx ky kz aw la bi"><span id="379e" class="ju jv hi kx b fj lb lc l ld le">wb = xw.Book(r"path to your report.xlsb")</span></pre><p id="d826" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后另一个变量“app”来存储工作簿中的应用程序，在“macro_vba”中我放了宏“Emails”。最后，我运行“宏_vba”</p><pre class="je jf jg jh fe kw kx ky kz aw la bi"><span id="7f47" class="ju jv hi kx b fj lb lc l ld le">app = wb.app<br/>macro_vba = app.macro("'Dashboard.XLSB'!refresh") <br/>macro_vba()</span></pre><h2 id="c2f7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">结论</h2><p id="ffce" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我希望你喜欢这个简单的技巧。这篇文章的目的是与你分享2个技巧，一个在VBA发送电子邮件，另一个在python中运行你的宏。这也是向你展示有时候在编码中，最简单的方法并不一定是最直接的。</p></div></div>    
</body>
</html>