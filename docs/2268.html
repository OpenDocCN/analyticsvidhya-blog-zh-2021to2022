<html>
<head>
<title>Mediapipe: Fingers counting in Python w/o GPU</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">media pipe:Python中不带GPU的手指计数</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/mediapipe-fingers-counting-in-python-w-o-gpu-f9494439090c?source=collection_archive---------5-----------------------#2021-04-15">https://medium.com/analytics-vidhya/mediapipe-fingers-counting-in-python-w-o-gpu-f9494439090c?source=collection_archive---------5-----------------------#2021-04-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8f33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些在图像中计数手指的流行技术是通过训练CNN或使用轮廓和凸度外壳。实际上，我已经尝试了这两种技术，在这一节中，我想提到我在使用这些技术时所面临的挑战(放置链接来检查已完成的工作)。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="6ef0" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">实验和挑战</h1><ol class=""><li id="a9ee" class="kh ki hh ig b ih kj il kk ip kl it km ix kn jb ko kp kq kr bi translated"><em class="ks"> CNN方法:</em>该模型能够达到良好的训练和验证精度。最后的剧情看起来也不错。但是，当涉及到现实生活中的图像检测时，该模型非常失败。我试着调整超参数，应用数据扩充，迁移学习，学习率衰减，调整模型架构，但是没有改进。模型在真实图像上失败的主要原因是训练和测试图像非常相似，过于简化，所以模型试图过拟合，快速学习。检查我的尝试<a class="ae kt" href="https://www.kaggle.com/pdhruv93/fingers-count-scratch" rel="noopener ugc nofollow" target="_blank"> 1 </a>和<a class="ae kt" href="https://www.kaggle.com/pdhruv93/fingers-count-scratch-edge-detection" rel="noopener ugc nofollow" target="_blank"> 2 </a>(随时建议任何有帮助的改变)</li><li id="690e" class="kh ki hh ig b ih ku il kv ip kw it kx ix ky jb ko kp kq kr bi translated"><em class="ks">轮廓和凸度外壳:</em> <a class="ae kt" href="https://github.com/pdhruv93/OpenCV-Gesture-Recognition" rel="noopener ugc nofollow" target="_blank">与第一种方法相比，这种</a>方法表现得更好。检测速度非常快，并且很有把握。这里唯一的挑战是，你必须照顾背景，不能与拥挤的背景。</li></ol><p id="b22a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以经过这么多的调查，我遇到了Mediapipe 库的<em class="ks"> Hands模块，它令人惊讶地表现得非常好，没有我在上面遇到的任何挑战，而且它超级容易实现，不需要GPU。<em class="ks">这篇文章是我之前写的</em> <a class="ae kt" href="https://dhruv-pandey93.medium.com/mediapipe-hand-gesture-based-volume-controller-in-python-w-o-gpu-67db1f30c6ed" rel="noopener"> <em class="ks">关于Mediapipe的文章</em> </a> <em class="ks">的延续。我强烈建议在开始这个</em>之前浏览一遍。</em></p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="fbf7" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">对HandDetecor类进行微调</h1><p id="e9d7" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">在开始处理手指计数器之前，您需要向您在上一篇文章中编写的现有手部检测器类添加一小段代码。你可以查看<a class="ae kt" href="https://github.com/pdhruv93/computer-vision/tree/main/fingers-count" rel="noopener ugc nofollow" target="_blank">完整的源代码</a>来找出这个修改应该放在哪里。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="7f43" class="ll jk hh lh b fi lm ln l lo lp">if results.multi_handedness:<br/>    label = results.multi_handedness[handNumber].classification[0].label  # label gives if hand is left or right<br/>    #account for inversion in webcams<br/>    if label == "Left":<br/>        label = "Right"<br/>    elif label == "Right":<br/>        label = "Left"</span></pre><p id="a8d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之前，我们只向调用函数发送id、x和y坐标。现在我们也发送一个字符串来表示手是左手还是右手。我们还需要考虑当你从网络摄像头读取图像时发生的横向反转。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="f6c2" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">实际手指计数器工作</h1><ol class=""><li id="54e2" class="kh ki hh ig b ih kj il kk ip kl it km ix kn jb ko kp kq kr bi translated">导入库并进行标准初始化(所有细节都在第一篇文章中讨论过)。</li></ol><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="0202" class="ll jk hh lh b fi lm ln l lo lp">from handDetector import HandDetector<br/>import cv2<br/><br/>handDetector = HandDetector(min_detection_confidence=0.7)<br/>webcamFeed = cv2.VideoCapture(0)</span></pre><p id="bb33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.主要逻辑在这里:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3518" class="ll jk hh lh b fi lm ln l lo lp">while True:<br/>    status, image = webcamFeed.read()<br/>    handLandmarks = handDetector.findHandLandMarks(image=image, draw=True)<br/>    count=0<br/><br/>    if(len(handLandmarks) != 0):<br/>        #we will get y coordinate of finger-tip and check if it lies above middle landmark of that finger<br/>        #details: https://google.github.io/mediapipe/solutions/hands<br/><br/>        if handLandmarks[4][3] == "Right" and handLandmarks[4][1] &gt; handLandmarks[3][1]:       #Right Thumb<br/>            count = count+1<br/>        elif handLandmarks[4][3] == "Left" and handLandmarks[4][1] &lt; handLandmarks[3][1]:       #Left Thumb<br/>            count = count+1<br/>        if handLandmarks[8][2] &lt; handLandmarks[6][2]:       #Index finger<br/>            count = count+1<br/>        if handLandmarks[12][2] &lt; handLandmarks[10][2]:     #Middle finger<br/>            count = count+1<br/>        if handLandmarks[16][2] &lt; handLandmarks[14][2]:     #Ring finger<br/>            count = count+1<br/>        if handLandmarks[20][2] &lt; handLandmarks[18][2]:     #Little finger<br/>            count = count+1<br/><br/>    cv2.putText(image, str(count), (45, 375), cv2.FONT_HERSHEY_SIMPLEX, 5, (255, 0, 0), 25)<br/>    cv2.imshow("Volume", image)<br/>    cv2.waitKey(1)</span></pre><p id="5739" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们读取网络摄像头帧并初始化一个变量<em class="ks">计数。</em>这将是保存手指计数的最终变量。</p><p id="6143" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请看这张来自Mediapipe手部模块的图片:</p><figure class="lc ld le lf fd lr er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lq"><img src="../Images/8c636f28e21159f8e3fe5f99dd20634b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wf-ZieWhZP25GWz7.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">图片取自Mediapipe官网。请点击<a class="ae kt" href="https://google.github.io/mediapipe/solutions/hands" rel="noopener ugc nofollow" target="_blank">这里</a>查看全部工作细节。</figcaption></figure><blockquote class="mc md me"><p id="706b" class="ie if ks ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated">我们在这里使用的逻辑是，如果任何手指的指尖的y坐标低于该手指的中心标志的y坐标，这意味着手指是闭合的。</p></blockquote><p id="72ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如:如果界标8的y坐标小于界标6的y坐标→这意味着食指闭合。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="4fb9" class="ll jk hh lh b fi lm ln l lo lp">if handLandmarks[8][2] &lt; handLandmarks[6][2]:<br/>       count = count+1</span></pre><p id="dd66" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个<em class="ks">特例是针对拇指的</em>。如果你试着握拳，你的拇指不会像其他手指一样垂直闭合，而是水平闭合。所以你的拇指不会遵循和手指相同的规则。相反，你必须把条件放在x坐标上(你自己试试吧，我给了一张图片供参考)。</p><figure class="lc ld le lf fd lr er es paragraph-image"><div class="er es mi"><img src="../Images/921796a21d5b11c119909c22f571b1b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*O23GN_0QKluo3JlkMPzTng.png"/></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">“0”的缩略图位置</figcaption></figure><figure class="lc ld le lf fd lr er es paragraph-image"><div class="er es mj"><img src="../Images/8a3a929cf1d6513a7aa5f603678d5f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:342/format:webp/1*N0Ig4IxUTu_bGdokcHh11Q.png"/></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">“1”的拇指位置</figcaption></figure><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="060b" class="ll jk hh lh b fi lm ln l lo lp">if handLandmarks[4][3] == "Right" and handLandmarks[4][1] &gt; handLandmarks[3][1]:       #Right Thumb<br/>            count = count+1<br/>        elif handLandmarks[4][3] == "Left" and handLandmarks[4][1] &lt; handLandmarks[3][1]:       #Left Thumb<br/>            count = count+1</span></pre><p id="d86c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在最后一部分，你做一些例行工作来显示你的帧计数。</p><p id="e70c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这差不多就是代码。当你运行这个，你会看到计数打印在框架上。你会注意到检测非常快，没有任何滞后。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h1 id="6f2b" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">最后的话</h1><p id="21e0" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">看看实现一个手指计数器有多简单。写这篇文章背后的想法并不是激励你停止使用深度学习，转而使用一些第三方库。相反，在着手解决任何问题之前，只需花一些时间研究市场上的可用选项，并决定是否值得从头开始做任何事情，或者在可用资源的基础上构建一些东西。</p><p id="fd8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">休息一切都取决于你的意志和创造力。你可以在这里  找到这个项目的<strong class="ig hi"> <em class="ks">代码</em> </strong> <a class="ae kt" href="https://github.com/pdhruv93/computer-vision/tree/main/fingers-count" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> <em class="ks">。</em></strong></a></p></div></div>    
</body>
</html>