<html>
<head>
<title>Face Detection and Recognition using OpenCV and KNN from Scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零开始使用OpenCV和KNN进行人脸检测和识别</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/face-detection-and-recognition-using-opencv-and-knn-from-scratch-dcba9b0fd07d?source=collection_archive---------5-----------------------#2021-01-18">https://medium.com/analytics-vidhya/face-detection-and-recognition-using-opencv-and-knn-from-scratch-dcba9b0fd07d?source=collection_archive---------5-----------------------#2021-01-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8e3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"><em class="jc">【KNN】</em></strong>是机器学习中最基本的分类算法之一。属于机器学习的<strong class="ig hi"> <em class="jc">监督学习</em> </strong>范畴。KNN经常被用在搜索应用程序中，你在那里寻找<em class="jc">【相似的】物品</em>。</p><p id="7350" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们测量相似性的方法是创建项目的向量表示，然后使用适当的距离度量<em class="jc">(例如欧几里德距离)比较向量。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/36ab06712457c49200ea389a7af95ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCcS9k-iijyTf1EX4_btAQ.png"/></div></div></figure><blockquote class="jp jq jr"><p id="a808" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">更多关于KNN:<strong class="ig hi"/><a class="ae jv" rel="noopener" href="/analytics-vidhya/a-beginners-guide-to-knn-and-mnist-handwritten-digits-recognition-using-knn-from-scratch-df6fb982748a"><strong class="ig hi">KNN和MNIST手写数字识别入门使用KNN从零开始</strong> </a></p></blockquote><p id="1862" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">使用的数据集:</em> </strong> <br/>我们使用的<code class="du jw jx jy jz b">haarcascade_frontalface_default.xml</code>数据集可以很容易地从<a class="ae jv" href="https://github.com/opencv/opencv/tree/master/data/haarcascades" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> <em class="jc">这个链接</em> </strong> </a> <strong class="ig hi"> <em class="jc">下载。</em> </strong></p><p id="29fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">人脸识别:</em> </strong> <br/>这包括<em class="jc">三个Python文件</em>，其中<em class="jc">第一个</em>用于检测人脸并以列表格式存储，<em class="jc">第二个</em>用于存储数据。csv '文件格式，第三个<em class="jc">用于识别人脸。</em></p><ul class=""><li id="f2ec" class="ka kb hh ig b ih ii il im ip kc it kd ix ke jb kf kg kh ki bi translated"><strong class="ig hi"><em class="jc">Face detect . py—</em></strong><em class="jc">人脸检测器</em></li></ul><pre class="je jf jg jh fd kj jz kk kl aw km bi"><span id="51aa" class="kn ko hh jz b fi kp kq l kr ks"># this file is used to detect face <br/># and then store the data of the face <br/>import cv2 <br/>import numpy as np</span><span id="3e27" class="kn ko hh jz b fi kt kq l kr ks"># import the file where data is <br/># stored in a csv file format <br/>import npwriter</span><span id="56f6" class="kn ko hh jz b fi kt kq l kr ks">name = input("Enter your name: ")</span><span id="6422" class="kn ko hh jz b fi kt kq l kr ks"># this is used to access the web-cam <br/># in order to capture frames <br/>cap = cv2.VideoCapture(0)</span><span id="9403" class="kn ko hh jz b fi kt kq l kr ks">classifier = cv2.CascadeClassifier("haarcascade_frontalface_default.xml")</span><span id="5122" class="kn ko hh jz b fi kt kq l kr ks"># this is class used to detect the faces as provided <br/># with a haarcascade_frontalface_default.xml file as data <br/>f_list = []</span><span id="f4f5" class="kn ko hh jz b fi kt kq l kr ks">while True: <br/> ret, frame = cap.read() <br/> <br/> # converting the image into gray <br/> # scale as it is easy for detection <br/> gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY) <br/> <br/> # detect multiscale, detects the face and its coordinates <br/> faces = classifier.detectMultiScale(gray, 1.5, 5) <br/> <br/> # this is used to detect the face which <br/> # is closest to the web-cam on the first position <br/> faces = sorted(faces, key = lambda x: x[2]*x[3], <br/>         reverse = True)</span><span id="7640" class="kn ko hh jz b fi kt kq l kr ks"># only the first detected face is used <br/> faces = faces[:1] <br/> <br/> # len(faces) is the number of <br/> # faces showing in a frame <br/> if len(faces) == 1: <br/>  # this is removing from tuple format  <br/>  face = faces[0] <br/>  <br/>  # storing the coordinates of the <br/>  # face in different variables <br/>  x, y, w, h = face</span><span id="9469" class="kn ko hh jz b fi kt kq l kr ks"># this is will show the face <br/>  # that is being detected  <br/>  im_face = frame[y:y + h, x:x + w]</span><span id="c7e3" class="kn ko hh jz b fi kt kq l kr ks">cv2.imshow("face", im_face)</span><span id="d415" class="kn ko hh jz b fi kt kq l kr ks">if not ret: <br/>  continue</span><span id="66d3" class="kn ko hh jz b fi kt kq l kr ks">cv2.imshow("full", frame)</span><span id="26e7" class="kn ko hh jz b fi kt kq l kr ks">key = cv2.waitKey(1)</span><span id="41b6" class="kn ko hh jz b fi kt kq l kr ks"># this will break the execution of the program <br/> # on pressing 'q' and will click the frame on pressing 'c' <br/> if key &amp; 0xFF == ord('q'): <br/>  break<br/> elif key &amp; 0xFF == ord('c'): <br/>  if len(faces) == 1: <br/>   gray_face = cv2.cvtColor(im_face, cv2.COLOR_BGR2GRAY) <br/>   gray_face = cv2.resize(gray_face, (100, 100)) <br/>   print(len(f_list), type(gray_face), gray_face.shape)</span><span id="1401" class="kn ko hh jz b fi kt kq l kr ks"># this will append the face's coordinates in f_list <br/>   f_list.append(gray_face.reshape(-1)) <br/>  else: <br/>   print("face not found")</span><span id="ebd6" class="kn ko hh jz b fi kt kq l kr ks"># this will store the data for detected <br/>  # face 10 times in order to increase accuracy <br/>  if len(f_list) == 10: <br/>   break</span><span id="996a" class="kn ko hh jz b fi kt kq l kr ks"># declared in npwriter <br/>npwriter.write(name, np.array(f_list))</span><span id="668b" class="kn ko hh jz b fi kt kq l kr ks">cap.release() <br/>cv2.destroyAllWindows()</span></pre><ul class=""><li id="0ab2" class="ka kb hh ig b ih ii il im ip kc it kd ix ke jb kf kg kh ki bi translated"><strong class="ig hi"><em class="jc">NP writer . py</em></strong><em class="jc">—创建/更新’。“csv”文件</em></li></ul><pre class="je jf jg jh fd kj jz kk kl aw km bi"><span id="8617" class="kn ko hh jz b fi kp kq l kr ks">import pandas as pd <br/>import numpy as np <br/>import os.path</span><span id="7bbb" class="kn ko hh jz b fi kt kq l kr ks">f_name = "face_data.csv"</span><span id="6ced" class="kn ko hh jz b fi kt kq l kr ks"># storing the data into a csv file <br/>def write(name, data):</span><span id="67a0" class="kn ko hh jz b fi kt kq l kr ks">if os.path.isfile(f_name):</span><span id="7cb9" class="kn ko hh jz b fi kt kq l kr ks">df = pd.read_csv(f_name, index_col = 0)</span><span id="b02e" class="kn ko hh jz b fi kt kq l kr ks">latest = pd.DataFrame(data, columns = map(str, range(10000))) <br/>  latest["name"] = name</span><span id="5cad" class="kn ko hh jz b fi kt kq l kr ks">df = pd.concat((df, latest), ignore_index = True, sort = False)</span><span id="ed74" class="kn ko hh jz b fi kt kq l kr ks">else:</span><span id="2486" class="kn ko hh jz b fi kt kq l kr ks"># Providing range only because the data <br/>  # here is already flattened for when <br/>  # it was store in f_list <br/>  df = pd.DataFrame(data, columns = map(str, range(10000))) <br/>  df["name"] = name</span><span id="8c18" class="kn ko hh jz b fi kt kq l kr ks">df.to_csv(f_name)</span></pre><ul class=""><li id="675a" class="ka kb hh ig b ih ii il im ip kc it kd ix ke jb kf kg kh ki bi translated"><strong class="ig hi"><em class="jc">recog . py</em></strong><em class="jc">—人脸识别器</em></li></ul><pre class="je jf jg jh fd kj jz kk kl aw km bi"><span id="7e2b" class="kn ko hh jz b fi kp kq l kr ks"># this one is used to recognize the <br/># face after training the model with <br/># our data stored using knn <br/>import cv2 <br/>import numpy as np <br/>import pandas as pd<br/>import operator<br/>from operator import itemgetter</span><span id="664f" class="kn ko hh jz b fi kt kq l kr ks">from npwriter import f_name </span><span id="0612" class="kn ko hh jz b fi kt kq l kr ks">def euc_dist(x1, x2):        <br/>    return np.sqrt(np.sum((x1-x2)**2))</span><span id="2c85" class="kn ko hh jz b fi kt kq l kr ks">class KNN:    <br/>def __init__(self, K=3):        <br/>    self.K = K    <br/>def fit(self, x_train, y_train):        <br/>    self.X_train = x_train        <br/>    self.Y_train = y_train    <br/>def predict(self, X_test):        <br/>    predictions = []        <br/>    for i in range(len(X_test)):                        <br/>        dist = np.array([euc_dist(X_test[i], x_t) for x_t in self.X_train])            <br/>        dist_sorted = dist.argsort()[:self.K]            <br/>        neigh_count = {}            <br/>        for idx in dist_sorted:                <br/>            if self.Y_train[idx] in neigh_count:<br/>                    neigh_count[self.Y_train[idx]] += 1 <br/>               else:   <br/>                 neigh_count[self.Y_train[idx]] = 1<br/>        sorted_neigh_count = sorted(neigh_count.items(), key=operator.itemgetter(1), reverse=True)<br/>        predictions.append(sorted_neigh_count[0][0])        <br/>    return predictions</span><span id="93cd" class="kn ko hh jz b fi kt kq l kr ks"># reading the data <br/>data = pd.read_csv(f_name).values</span><span id="d82f" class="kn ko hh jz b fi kt kq l kr ks"># data partition <br/>X, Y = data[:, 1:-1], data[:, -1]</span><span id="4514" class="kn ko hh jz b fi kt kq l kr ks">print(X, Y)</span><span id="80fa" class="kn ko hh jz b fi kt kq l kr ks"># Knn function calling with k = 5 <br/>model = KNN(K = 5) </span><span id="61ec" class="kn ko hh jz b fi kt kq l kr ks"># fdtraining of model <br/>model.fit(X, Y)</span><span id="f1a7" class="kn ko hh jz b fi kt kq l kr ks">cap = cv2.VideoCapture(0)</span><span id="625c" class="kn ko hh jz b fi kt kq l kr ks">classifier = cv2.CascadeClassifier("haarcascade_frontalface_default.xml")</span><span id="61fe" class="kn ko hh jz b fi kt kq l kr ks">f_list = []</span><span id="c674" class="kn ko hh jz b fi kt kq l kr ks">while True:</span><span id="b1f2" class="kn ko hh jz b fi kt kq l kr ks">ret, frame = cap.read()</span><span id="5542" class="kn ko hh jz b fi kt kq l kr ks">gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><span id="e8a8" class="kn ko hh jz b fi kt kq l kr ks">faces = classifier.detectMultiScale(gray, 1.5, 5)</span><span id="a50c" class="kn ko hh jz b fi kt kq l kr ks">X_test = []</span><span id="a747" class="kn ko hh jz b fi kt kq l kr ks"># Testing data <br/> for face in faces: <br/>  x, y, w, h = face <br/>  im_face = gray[y:y + h, x:x + w] <br/>  im_face = cv2.resize(im_face, (100, 100)) <br/>  X_test.append(im_face.reshape(-1))</span><span id="d2b9" class="kn ko hh jz b fi kt kq l kr ks">if len(faces)&gt;0: <br/>  response = model.predict(np.array(X_test)) <br/>  # prediction of result using knn</span><span id="836d" class="kn ko hh jz b fi kt kq l kr ks">for i, face in enumerate(faces): <br/>   x, y, w, h = face</span><span id="c849" class="kn ko hh jz b fi kt kq l kr ks"># drawing a rectangle on the detected face <br/>   cv2.rectangle(frame, (x, y), (x + w, y + h), <br/>          (255, 0, 0), 3)</span><span id="e6d8" class="kn ko hh jz b fi kt kq l kr ks"># adding detected/predicted name for the face <br/>   cv2.putText(frame, response[i], (x-50, y-50), <br/>       cv2.FONT_HERSHEY_DUPLEX, 2, <br/>          (0, 255, 0), 3) <br/> <br/> cv2.imshow("full", frame)</span><span id="e741" class="kn ko hh jz b fi kt kq l kr ks">key = cv2.waitKey(1)</span><span id="42dd" class="kn ko hh jz b fi kt kq l kr ks">if key &amp; 0xFF == ord("q") : <br/>  break</span><span id="ab35" class="kn ko hh jz b fi kt kq l kr ks">cap.release() <br/>cv2.destroyAllWindows()</span></pre><blockquote class="jp jq jr"><p id="44ad" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">我知道一下子很难接受。但是你坚持到了最后！恭喜你。不要忘记看看我即将发表的文章！</p></blockquote><h1 id="a853" class="ku ko hh bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">其他资源和参考</h1><div class="lr ls ez fb lt lu"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/a-beginners-guide-to-knn-and-mnist-handwritten-digits-recognition-using-knn-from-scratch-df6fb982748a"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hi fi z dy lz ea eb ma ed ef hg bi translated">从头开始使用KNN识别KNN和MNIST手写数字的初学者指南</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">MNIST(“修改后的国家标准和技术研究所”)是事实上的“你好世界”数据集的计算机…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">medium.com</p></div></div><div class="md l"><div class="me l mf mg mh md mi jn lu"/></div></div></a></div><div class="lr ls ez fb lt lu"><a rel="noopener follow" target="_blank" href="/analytics-vidhya/celebrity-face-recognition-using-knn-from-scratch-76287bdab088"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hi fi z dy lz ea eb ma ed ef hg bi translated">从零开始使用KNN的名人人脸识别</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">你能从下面的图片中找出你最喜欢的名人吗？当然可以！计算机是如何完成同样的任务的…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">medium.com</p></div></div><div class="md l"><div class="mj l mf mg mh md mi jn lu"/></div></div></a></div><div class="lr ls ez fb lt lu"><a href="https://www.geeksforgeeks.org/ml-implement-face-recognition-using-k-nn-with-scikit-learn/" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hi fi z dy lz ea eb ma ed ef hg bi translated">ML |使用k-NN和scikit-learn - GeeksforGeeks实现人脸识别</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">ML |使用k-NN和scikit实现人脸识别-学习k-最近邻:k-NN是最基本的…</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">www.geeksforgeeks.org</p></div></div><div class="md l"><div class="mk l mf mg mh md mi jn lu"/></div></div></a></div><p id="850b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="jc">完整代码实现:</em> </strong></p><div class="lr ls ez fb lt lu"><a href="https://github.com/tanvipenumudy/Winter-Internship-Internity/tree/main/Day%2008/Face%20Recognition%20with%20OpenCV%20%2B%20KNN" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab dw"><div class="lw ab lx cl cj ly"><h2 class="bd hi fi z dy lz ea eb ma ed ef hg bi translated">tanvipenumudy/Winter-实习-实习</h2><div class="mb l"><h3 class="bd b fi z dy lz ea eb ma ed ef dx translated">存储库跟踪每天分配的工作-tanvipenumudy/Winter-实习-实习</h3></div><div class="mc l"><p class="bd b fp z dy lz ea eb ma ed ef dx translated">github.com</p></div></div><div class="md l"><div class="ml l mf mg mh md mi jn lu"/></div></div></a></div><blockquote class="jp jq jr"><p id="ff6a" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">希望你喜欢并充分利用这篇文章！敬请关注我即将发布的博客！如果你觉得我的内容有帮助/有帮助，请确保<strong class="ig hi">鼓掌</strong>和<strong class="ig hi">跟着</strong>！</p></blockquote></div></div>    
</body>
</html>