<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/nodejs-questions-b0e19f96167e?source=collection_archive---------24-----------------------#2021-05-18">https://medium.com/analytics-vidhya/nodejs-questions-b0e19f96167e?source=collection_archive---------24-----------------------#2021-05-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><p id="59c9" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated"><strong class="hi ie"> Nodejs问题</strong></p><p id="0430" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">使用Covid跟踪项目中的API创建一个新的端点，其中API返回以下数据</p><ul class=""><li id="f674" class="if ig hh hi b hj hk hn ho hr ih hv ii hz ij id ik il im in bi translated">按阳性病例数降序排列的州</li><li id="d17c" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">API的响应应包括</li><li id="8bdf" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">状态</li><li id="1179" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">积极的</li><li id="83e6" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">totalTestResults</li><li id="0f72" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">笔记</li><li id="f66d" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">covid19Site站点</li><li id="a097" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">提示:在state info和state current api中应该有以下键</li><li id="c050" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">API链接:【https://covidtracking.com/api/ T2】</li><li id="24f7" class="if ig hh hi b hj io hn ip hr iq hv ir hz is id ik il im in bi translated">邮差收藏链接:<a class="ae it" href="https://postman-toolboxes.github.io/covid-19/#featured-collections" rel="noopener ugc nofollow" target="_blank">https://POSTMAN-toolbox . github . io/新冠肺炎/#精选-收藏</a></li></ul><figure class="iv iw ix iy fd iz er es paragraph-image"><div role="button" tabindex="0" class="ja jb di jc bf jd"><div class="er es iu"><img src="../Images/02fd133926b198823a8826147cc7cff2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDnXyDjifZxJNayYRVcc5w.png"/></div></div></figure><p id="14f3" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated"><strong class="hi ie">解决方案</strong></p><p id="a461" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">const Express = require(" Express ")；<br/>const body parser = require(" body-parser ")；const mongo client = require(" MongoDB ")。MongoClient<br/>const ObjectId = require(" MongoDB ")。ObjectID<br/>const CONNECTION _ URL = ' MongoDB://localhost:27017/'；<br/>const DATABASE _ NAME = " covidTracker "；<br/>const fetch = require(' node-fetch ')；</p><p id="1681" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">var app = Express()；<br/>app . use(express . JSON({ limit:' 5mbs ' })；<br/>app . use(body parser . JSON())；<br/>app . use(body parser . urlencoded({ extended:true })；<br/> var数据库，收藏；<br/>var dat = { }；<br/> app.listen(5000，()=&gt;{<br/>mongoclient . connect(CONNECTION _ URL，{ useNewUrlParser: true }，(error，client)=&gt;{<br/>if(error){<br/>抛出错误；<br/> } <br/>数据库= client . db(DATABASE _ NAME)；<br/>collection = database . collection(" Tracker ")；<br/> console.log("连接到` "+ DATABASE_NAME +" `！");<br/><br/>})；<br/>})；</p><p id="5e23" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">app.get("/Tracker "，(request，response)= &gt; {<br/>fetch(<a class="ae it" href="https://covidtracking.com/api/states/'" rel="noopener ugc nofollow" target="_blank">https://covidtracking.com/api/states/'</a>，{ method: 'GET' }) <br/>。然后(res = &gt; res.json()) <br/>。然后(<br/>data =&gt;{<br/>//console . log(data)<br/>DAT = data<br/>//console . log(DAT，" DAT STORED::::::)<br/>collection . insert(data，(error，result)=&gt;{<br/>if(error){<br/>返回response.status(500)。发送(错误)；<br/> }</p><p id="e86d" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">response . write(“—”)；<br/>})；<br/>T2】}<br/>)；<br/>database . create collection(" tracker 2 "，function(err，RES){<br/>if(err)throw err；<br/> console.log("集合已创建！");<br/><br/>})；<br/>获取(<a class="ae it" href="https://covidtracking.com/api/states/info'" rel="noopener ugc nofollow" target="_blank">https://covidtracking.com/api/states/info'</a>，{方法:' GET' }) <br/>。然后(res = &gt; res.json()) <br/>。然后(<br/>data =&gt;{<br/>//console . log(data)<br/>//object . keys(data)。forEach(function(k){<br/>//collection = database . collection(" tracker 2 ")；<br/>database . collection(" tracker 2 ")。insert(data，(error，result)=&gt;{<br/>if(error){<br/>返回response.status(500)。发送(错误)；<br/> } <br/> response.write("添加到db ")；<br/> <br/> Object.keys(dat)。forEach(function(k){<br/>var myquery = { " state ":dat[k]。state }；<br/> console.log(dat[k].正，" DAT STORED:::::)<br/>database . collection(" tracker 2 ")。updateOne(myquery，{$set: {"positive": dat[k]。正}}、{ <br/>多:真<br/>}<br/>)；<br/> //console.log("更新后::::"，dat[k].正)<br/>})；<br/>})；</p><p id="9ce9" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">});<br/>})；</p><p id="8fc7" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">app.get("/getTracker "，(请求，响应)=&gt; {</p><p id="608a" class="pw-post-body-paragraph hf hg hh hi b hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ha bi translated">var my sort = { positive:-1 }；<br/> collection.find({})。排序(mysort)。toArray((error，result)=&gt;{<br/>if(error){<br/>返回response.status(500)。写(错误)；<br/>}<br/><br/>database . collection(" tracker 2 ")。查找({})。排序(mysort)。toArray((error，result 2)=&gt;{<br/>if(error){<br/>返回response.status(500)。写(错误)；<br/> } <br/> Object.keys(结果，result2)。forEach(function(k){<br/>if(result[k】)。state == result2[k]。state){ <br/> /* if(结果[k]。state === result2[k]。state) <br/> { */ //if(结果[k]。正面！==未定义||结果[k]。totalTestResults！==未定义||结果2[k].covid19Site！= = undefined){<br/>console . log(" State "+'-'+result[k].状态+"阳性"+'-'+结果[k]。正数+" totalTestResults "+'-'+结果[k]。totalTestResults+" covid 19 site "+'-'+result 2[k]. covid 19 site+" notes "+'-'+result 2[k].备注)；<br/>response . write(" State "+'-'+result[k])。状态+"阳性"+'-'+结果[k]。正数+" totalTestResults "+'-'+结果[k]。totalTestResults+" covid 19 site "+'-'+result 2[k]. covid 19 site+" notes "+'-'+result 2[k].备注)；<br/>}<br/>})；<br/><br/>})；<br/><br/>})；<br/><br/>})；</p></div></div>    
</body>
</html>