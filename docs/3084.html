<html>
<head>
<title>Process AVRO files in Azure Synapse Analytics Integrate Data Flow or ADF</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure Synapse Analytics中处理AVRO文件集成数据流或ADF</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/process-avro-files-in-azure-synapse-analytics-integrate-data-flow-or-adf-29835dd0225f?source=collection_archive---------1-----------------------#2021-06-05">https://medium.com/analytics-vidhya/process-avro-files-in-azure-synapse-analytics-integrate-data-flow-or-adf-29835dd0225f?source=collection_archive---------1-----------------------#2021-06-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="044f" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">物联网和其他AVRO模式可变格式</h1><h1 id="83e7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">要求</h1><ul class=""><li id="844b" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">Azure帐户</li><li id="7138" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure存储帐户</li><li id="61b3" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">上传样本avro或生成样本</li><li id="fec4" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个容器并上传avro文件</li><li id="4e10" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">找到avro模式</li><li id="cdcd" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">Azure synapse分析工作区</li><li id="2b71" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建集成运行时</li></ul><h1 id="c458" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">步伐</h1><ul class=""><li id="350f" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">首先创建一个存储容器</li><li id="e6b2" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">我已经上传了22.avro样本文件在这个repo的数据文件夹中</li><li id="62b5" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">样本如下</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="d955" class="ki if hh ke b fi kj kk l kl km">SequenceNumber,Offset,EnqueuedTimeUtc,SystemProperties,Properties,Body,BodyNew<br/>507,364464,5/20/2021 11:46:23 PM,,,"{\"applicationId\":\"3a11d300-d923-4a3d-9cd9-75364b23f710\",\"messageSource\":\"telemetry\",\"deviceId\":\"mymxchipbb\",\"schema\":\"default@v1\",\"templateId\":\"urn:6bccexgax:ex1fym5he\",\"enqueuedTime\":\"2021-05-20T23:46:21.84Z\",\"telemetry\":{\"gyroscope\":{\"z\":350,\"x\":1400,\"y\":-3150},\"accelerometer\":{\"x\":-67,\"y\":-735,\"z\":686},\"humidity\":50,\"temperature\":30.299999,\"pressure\":999.015137,\"magnetometer\":{\"y\":270,\"z\":-251,\"x\":185}},\"messageProperties\":{},\"enrichments\":{}}","{\"applicationId\":\"3a11d300-d923-4a3d-9cd9-75364b23f710\",\"messageSource\":\"telemetry\",\"deviceId\":\"mymxchipbb\",\"schema\":\"default@v1\",\"templateId\":\"urn:6bccexgax:ex1fym5he\",\"enqueuedTime\":\"2021-05-20T23:46:21.84Z\",\"telemetry\":{\"gyroscope\":{\"z\":350,\"x\":1400,\"y\":-3150},\"accelerometer\":{\"x\":-67,\"y\":-735,\"z\":686},\"humidity\":50,\"temperature\":30.299999,\"pressure\":999.015137,\"magnetometer\":{\"y\":270,\"z\":-251,\"x\":185}},\"messageProperties\":{},\"enrichments\":{}}"<br/>508,365184,5/20/2021 11:46:32 PM,,,"{\"applicationId\":\"3a11d300-d923-4a3d-9cd9-75364b23f710\",\"messageSource\":\"telemetry\",\"deviceId\":\"mymxchipbb\",\"schema\":\"default@v1\",\"templateId\":\"urn:6bccexgax:ex1fym5he\",\"enqueuedTime\":\"2021-05-20T23:46:31.997Z\",\"telemetry\":{\"accelerometer\":{\"x\":-67,\"y\":-735,\"z\":686},\"humidity\":50,\"temperature\":30.4,\"pressure\":999.022461,\"magnetometer\":{\"x\":188,\"y\":271,\"z\":-251},\"gyroscope\":{\"z\":350,\"x\":1330,\"y\":-3150}},\"messageProperties\":{},\"enrichments\":{}}","{\"applicationId\":\"3a11d300-d923-4a3d-9cd9-75364b23f710\",\"messageSource\":\"telemetry\",\"deviceId\":\"mymxchipbb\",\"schema\":\"default@v1\",\"templateId\":\"urn:6bccexgax:ex1fym5he\",\"enqueuedTime\":\"2021-05-20T23:46:31.997Z\",\"telemetry\":{\"accelerometer\":{\"x\":-67,\"y\":-735,\"z\":686},\"humidity\":50,\"temperature\":30.4,\"pressure\":999.022461,\"magnetometer\":{\"x\":188,\"y\":271,\"z\":-251},\"gyroscope\":{\"z\":350,\"x\":1330,\"y\":-3150}},\"messageProperties\":{},\"enrichments\":{}}"</span></pre><ul class=""><li id="59ce" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">通常，如果Body列是base 64，我们需要转换为字符串作为BodyNew</li></ul><h1 id="8a43" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">Azure Synapse集成管道</h1><ul class=""><li id="97fd" class="jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">转到Azure Synapse Analytics Workspace Studio</li><li id="61c8" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">去管理</li><li id="90cd" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">为spark处理创建一个新的集成运行时，拥有16个以上的内核</li><li id="a054" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">去发展</li><li id="9d53" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建新的数据流</li><li id="ae58" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">以使用新avro文件创建的存储帐户身份连接到源</li><li id="ef11" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建连接到数据存储的新数据集</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ks"><img src="../Images/e5ea2f30a7701346026784ae92d889ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKe--7YDN-kIXBqJMTXtmQ.jpeg"/></div></div></figure><ul class=""><li id="33d5" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">打开调试</li><li id="2d4a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">转到数据预览</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es la"><img src="../Images/bff9d8083fe880444831bbfef534d54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHyqINumcccUJR7BRapaag.jpeg"/></div></div></figure><ul class=""><li id="fdee" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在添加select以选择列</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lb"><img src="../Images/1dd57878306bd79a5143ee67b85e41b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yq1cutCJHgUupkhGMfb4mQ.jpeg"/></div></div></figure><ul class=""><li id="e223" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">创建一个派生列，将Body(如果base 64)转换为新列名为BodyNew的字符串</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lc"><img src="../Images/53a8284d9f6bb61899749afd8c6ba119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lK-qp6gZLlNZc9gidbk51w.jpeg"/></div></div></figure><ul class=""><li id="ecfd" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">现在添加解析</li><li id="0caa" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">创建一个新列作为json</li><li id="381a" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">在表达式中，选择列作为数据“正文”或“正文新”</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es ld"><img src="../Images/47b43f5fd6daa89465a703a951c42768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j9KwO7mxG6ZVudxjdX7LfQ.jpeg"/></div></div></figure><ul class=""><li id="0c7b" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">对于输出列类型</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="dffe" class="ki if hh ke b fi kj kk l kl km">(applicationId as string,		messageSource as string,		deviceId as string,		schema as string,		templateId as string,		enqueuedTime as string,		telemetry as (gyroscope as (z as float,		x as float,		y as float),		accelerometer as (z as float,		x as float,		y as float),		humidity as float,		temperature as float,		pressure as float,		magnetometer as (z as float,		x as float,		y as float)),		messageProperties as (messageProp as string),		enrichments as (userSpecifiedKey as string))</span></pre><ul class=""><li id="eb0b" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">最后使用水槽和储存作为进一步加工的拼花地板。</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es le"><img src="../Images/627fde5778306bee38141d67abaa8c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvnNNRkLuWs4iyTMjI4i4Q.jpeg"/></div></div></figure><ul class=""><li id="83cc" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">看一下数据，看看是否能看到如下所示的解析数据</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lf"><img src="../Images/71d07e5ecf98a80d008c493af53c1e27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fl6JoAFUAxbdz7j3LCwUkw.jpeg"/></div></div></figure><ul class=""><li id="e8ae" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">展开遥测列，看看是否可以看到传感器的详细信息</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lg"><img src="../Images/a18b78e276e0b786f748b7b95b50b9a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUzfHdei4aXGMrI8LU4oOw.jpeg"/></div></div></figure><ul class=""><li id="6f6e" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">创建集成管道</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lh"><img src="../Images/216e22fe867a3801904d8147df3e1419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xON3MoMPnhysuySMH2O9cQ.jpeg"/></div></div></figure><ul class=""><li id="3998" class="jc jd hh je b jf kn jh ko jj kp jl kq jn kr jp jq jr js jt bi translated">创建一个数据流，并在之前选择上面的</li><li id="fe1b" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">单击调试</li><li id="71ca" class="jc jd hh je b jf ju jh jv jj jw jl jx jn jy jp jq jr js jt bi translated">单击并查看详细信息</li></ul><figure class="jz ka kb kc fd kt er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es li"><img src="../Images/fc13da0c6a8b4c9473cb52d938a18a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ym3cybE0uWovU22zEPfh7Q.jpeg"/></div></div></figure></div><div class="ab cl lj lk go ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ha hb hc hd he"><p id="6f71" class="pw-post-body-paragraph lq lr hh je b jf kn ls lt jh ko lu lv jj lw lx ly jl lz ma mb jn mc md me jp ha bi translated">原始文章在<a class="ae mf" href="https://github.com/balakreshnan/Samples2021/blob/main/ADF/avroprocessdf.md" rel="noopener ugc nofollow" target="_blank">samples 2021/avroprocessdf . MD在main balakreshnan/samples 2021(github.com)</a></p></div></div>    
</body>
</html>