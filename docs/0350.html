<html>
<head>
<title>Road Damage Detection for multiple countries using YOLOv3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用YOLOv3检测多个国家的道路损坏情况</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/road-damage-detection-for-multiple-countries-using-yolov3-51fc7c6b43bd?source=collection_archive---------7-----------------------#2021-01-13">https://medium.com/analytics-vidhya/road-damage-detection-for-multiple-countries-using-yolov3-51fc7c6b43bd?source=collection_archive---------7-----------------------#2021-01-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="66eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为深度学习自我案例研究的一部分，我选择了一个关于检测多个国家的道路损坏的问题，这几乎是全球每个国家的一个主要问题。</p><p id="05b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博客中，我将向你解释我是如何使用YOLOv3架构来检测印度和日本道路的道路损坏，并解决这个问题的。</p><h1 id="f88b" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">内容:</h1><ol class=""><li id="be5c" class="ka kb hh ig b ih kc il kd ip ke it kf ix kg jb kh ki kj kk bi translated">商业问题</li><li id="c51e" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">资料组</li><li id="ca30" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">探索性数据分析</li><li id="0692" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">YOLOv3</li><li id="f1f4" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">数据准备</li><li id="40c4" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">Yolo盒子</li><li id="c3be" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">约洛损失</li><li id="ef34" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">首次切割方法</li><li id="640d" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">结论</li><li id="a733" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">生成自定义锚定框</li><li id="c928" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">使用增强和自定义锚盒的模型训练</li><li id="7389" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">预测评估</li><li id="e1c2" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">最终模型</li><li id="f145" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">模型量化</li><li id="d328" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">简化应用程序</li><li id="f95d" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">未来的工作</li><li id="6605" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">参考</li></ol><h1 id="aa54" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">业务问题:</h1><p id="a60b" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">道路基础设施在挽救生命和一个国家的经济发展中起着至关重要的作用，因此，为了减少由于坑洼和道路损坏造成的道路事故，及时管理和检查道路是一项重要的任务，因为考虑到与位置、年龄、温度等相关的各种因素，道路会随着时间的推移而恶化。鉴于道路或高速公路的长度很长，工程师对道路的目视检查非常耗时。因此，提出一种基于自动化人工智能的解决方案，可以检测损坏类型，有助于改善道路状况的监控方式。</p><p id="d872" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，这个问题的主要议程是分析我们如何利用日本的数据集，通过添加该国的图像来检测其他国家的道路损坏，人工智能系统必须在这些国家发展。</p><h1 id="a9e8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">数据集:</h1><p id="0fcc" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">针对这个问题，我从这个<a class="ae kt" href="https://github.com/sekilab/RoadDamageDetector" rel="noopener ugc nofollow" target="_blank">链接</a>收集数据集。</p><p id="ca08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个数据集由三个zip文件组成，一个用于训练数据，另外两个用于包含图像和带注释的xml文件的测试数据。而对于这个问题</p><ol class=""><li id="55c0" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">train.tar:该文件包含26620幅图像及其各自的注释xml文件，从三个不同的国家(即日本、印度和捷克)收集，与印度和捷克相比，日本数据集包含更多使用智能手机生成的图像。</li><li id="a6b9" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">test1.tar:这个文件由2282张图片组成，除了没有注释文件，因为我必须在这些图片上测试模型性能。</li></ol><h1 id="e245" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">探索性数据分析:</h1><p id="2651" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">作为EDA的一部分，我分析了每个国家给定数据集的损坏类型的分布。为了检查我的模型将如何根据类的分布来执行。</p><p id="e6de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于这个问题，只考虑了4种类型的损坏类别:</p><ol class=""><li id="379d" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">D00:纵向裂纹</li><li id="e2bf" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">D10:横向裂纹</li><li id="a0b0" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">D20:对准器裂纹</li><li id="317e" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">D40:坑洞</li></ol><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es kx"><img src="../Images/7f123a443f235015e74a22d538d6d6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*pbG5wxeJ7QAp9KskbvfTSA.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">researchgate.net</figcaption></figure><p id="534e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">针对印度数据集的EDA:</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/aac606d63f54aa13d576aaadac531223.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*ctfTUulV_0I2TXWzPBnQxw.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">条形图</figcaption></figure><p id="cbd6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">观察:</p><ol class=""><li id="d1c9" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">从上图可以看出，印度大部分道路损坏属于D40类，即坑洼。</li><li id="3cb7" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">其次是D20类即鳄鱼裂纹和D00类即纵向裂纹</li><li id="ba60" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">而D10损伤类别即横向裂纹在印度图像中很少出现。因此，当仅考虑印度图像作为训练数据时，在评估包含D10损坏类型的测试数据的性能时，这会导致一些问题。</li></ol><p id="8546" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">日本数据集的EDA:</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/180a3f55836030dd4ffe2d22c2101436.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*dh7nr46A9FA_1pTMhwdIyQ.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">箱形图</figcaption></figure><p id="2216" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">观察结果:</p><ol class=""><li id="271e" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">从上图中可以看出，D20类别的损坏类型，即鳄鱼皮开裂，在日本道路上最为常见。</li><li id="e1f4" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">对于日本图像，D00和D10类别被平均分配。</li><li id="0f72" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">在日本，与鳄鱼开裂相比，路面坑洼对道路的损害要小得多。</li></ol><p id="cb5d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">捷克数据集的EDA:</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/d38cc509bc6200a02276eab927ba506c.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*DxdJ-JacZtJZ7HmCRHA2KA.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">条形图</figcaption></figure><p id="792a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">观察结果:</p><ol class=""><li id="7ab2" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">在捷克，大多数道路损坏属于D00类，即纵向裂缝。</li><li id="d969" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">其次是D10(横向裂缝)和坑洼(D40)</li><li id="2bc0" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">与其他类型的道路损坏相比，捷克的鳄鱼裂缝道路损坏非常少。</li></ol><h1 id="a441" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">YOLOv3:</h1><p id="3a71" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">为了解决道路损坏检测问题，我选择了YOLOv3架构来训练我的模型并检测道路损坏类型，这是用于对象检测问题的最先进技术之一。</p><p id="2f0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在我的jupyter笔记本上构建并移植了YOLOv3架构。关于YOLOv3的详细架构和解释，你可以参考这个<a class="ae kt" href="https://towardsdatascience.com/yolo-v3-object-detection-53fb7d3bfe6b" rel="noopener" target="_blank">博客</a>。</p><p id="a9c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想参考YOLOv3的原始研究论文，你可以在这里找到<a class="ae kt" href="https://arxiv.org/pdf/1804.02767.pdf" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="e3ad" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">数据准备:</h1><p id="1cea" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在将数据输入模型之前，首先要根据可训练的模型格式转换给定的数据集。</p><p id="eca6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了数据准备，为了扩充图像和它的边界框，我使用了<a class="ae kt" href="https://imgaug.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> imgaug </a>库来实现对训练数据的扩充。</p><p id="4c5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为数据增强的一部分，我使用了FlipLR增强技术，通过水平翻转来增强图像。</p><p id="dce2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了将数据输入到模型中，我准备了TFRecords形式的训练和验证数据集。</p><p id="4b60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">TFRecord格式是一种用于存储二进制记录序列的简单格式。TFRecord将数据存储为二进制字符串序列。关于TFRecord的更多解释，你可以看看这个<a class="ae kt" rel="noopener" href="/mostly-ai/tensorflow-records-what-they-are-and-how-to-use-them-c46bc4bbb564">博客</a>。</p><p id="4261" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是在创建TFRecord之前，我解析了注释xml文件，以便使用递归创建TFRecord。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="8a4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在解析xml文件并为每个标签生成字典之后，我实现了创建TFRecords的函数。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h1 id="b72c" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">YOLO盒子:</h1><p id="8107" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">YOLOv3输出边界框的相对坐标，而不是绝对坐标，所以为了计算绝对坐标，我实现了yolo_boxes函数。</p><p id="7cd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">YOLOv3的预测将是(batch_size，grid，grid，anchors，(tx，ty，tw，th，obj，…classes))，现在为了得到绝对的盒子坐标正如作者在<a class="ae kt" href="https://arxiv.org/pdf/1804.02767.pdf" rel="noopener ugc nofollow" target="_blank">论文</a>中所说。</p><pre class="ky kz la lb fd lm ln lo lp aw lq bi"><span id="2e0b" class="lr jd hh ln b fi ls lt l lu lv">bx = sigmoid(tx) + Cx<br/>by = sigmoid(ty) + Cy</span></pre><p id="27d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里bx和by是绝对坐标，通常用作图像方框的质心坐标，Cx和Cy表示当前网格单元左上角的绝对位置。tx和ty是相对于网格单元的质心位置。要深入了解网格、锚定框和网格单元，你可以参考这个<a class="ae kt" href="https://towardsdatascience.com/dive-really-deep-into-yolo-v3-a-beginners-guide-9e3d2666280e" rel="noopener" target="_blank">博客</a>。</p><p id="d8cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是将sigmoid应用于相对质心坐标，并将其与网格单元的坐标相加是不够的，我通过将结果除以网格大小来归一化它。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="bbee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在获得绝对质心坐标后，将sigmoid函数应用于客观分数和类别。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="eab0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">文中的bw、bh是箱子的宽度和高度，pw和ph是锚箱坐标。所以根据论文，为了得到预测包围盒的绝对高度和宽度。</p><pre class="ky kz la lb fd lm ln lo lp aw lq bi"><span id="33fd" class="lr jd hh ln b fi ls lt l lu lv">bw = exp(tw) * pw<br/>bh = exp(th) * ph</span></pre><p id="3470" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里pw、ph是锚箱的高度和宽度，bw、bh是绝对高度和宽度。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="bea1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们计算了bbox中心的位置，但是我们需要角的位置，所以我在代码下面应用了角的位置，并连接了输出。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h1 id="70d3" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">YOLO损失:</h1><p id="3615" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">YOLO的损失函数由四部分组成:质心损失(xy)、宽度和高度损失(wh)、目标损失和分类损失。</p><p id="35a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在计算YOLO损失之前，我计算了计算损失函数所需的各种掩码，即obj_mask和ignore_mask。</p><p id="454b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">obj_mask:指定对象是否存在的掩码。1表示存在，0表示不存在。</p><p id="2ac6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ignore_mask : Mask指定如果真框和预测框的iou低于阈值，则忽略这些预测。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="2613" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在论文中，作者提到YOLOv3模型很难处理小对象，我用下面的代码片段给小盒子更高的权重。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="97ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里，在YOLO损失函数中，质心损失和宽高损失构成回归问题，因为YOLO预测的是实值坐标，所以我使用<a class="ae kt" rel="noopener" href="/data-science-group-iitr/loss-functions-and-optimization-algorithms-demystified-bb92daff331c">平方损失</a>通过对所有框坐标求和来最小化。除此之外，我用box_loss_scale和obj_mask分别乘以损失的平方，box _ loss _ scale赋予较小的盒子较高的权重，obj _ mask指定对象是否存在。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="9135" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在计算平方损失后，我计算了客观分数和分类分数的二元交叉熵损失。</p><p id="1233" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，在计算对象损失时，会有一些情况，其中模型会预测不在图像基本事实中的边界框，所以为了在计算对象损失时处理这种情况，如果对象存在，我使用obj_mask给对象损失加权，并使用(1-obj_mask)和ignore_mask将其与对象损失加权相加。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="d014" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在计算了目标损失之后，我计算了这个问题中每个类的交叉熵损失。我使用了稀疏分类交叉熵损失。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="dae4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在计算所有4部分损失后，模型的最终损失将是所有xy_loss、wh_loss、obj_loss和class _ losss的总和。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h1 id="5db8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">首次切割方法:</h1><p id="0ab6" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">作为第一种方法，我使用印度和日本的数据集训练模型，没有增加和预计算锚盒。</p><p id="7675" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我只使用日本数据集、印度数据集和第三个结合日本和印度数据集来训练模型。</p><p id="6966" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于模型训练，我首先将暗网层的预训练权重加载到我的模型中，该暗网层是在由80个类组成的大型COCO数据集上训练的，并在我的模型中冻结暗网层，即暗网层中的整个训练权重不会改变。</p><p id="cf29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可通过此<a class="ae kt" href="https://pjreddie.com/media/files/yolov3.weights" rel="noopener ugc nofollow" target="_blank">链接</a>下载预训练重量。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="c985" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在加载权重和冻结我的模型的暗网层之后，我使用Adam optimizer进行优化，学习率为0.001。关于各种优化算法更详细的解释，你可以参考这个<a class="ae kt" rel="noopener" href="/datadriveninvestor/overview-of-different-optimizers-for-neural-networks-e0ed119440c3">博客</a>。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="fc4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建Adam optimizer实例后，我使用损失函数作为YOLO损失来编译模型。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="45af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，yolo_anchors是一个由9个锚框坐标组成的元组列表，这些坐标是在COCO数据集上使用称为K means的聚类技术预先计算的。我通过将0.4作为IOU阈值来训练模型。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="4d5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">yolo_anchor_masks : Masks告诉层哪个锚框负责预测边界框。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="b4e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一层预测6，7，8，因为这些是最大的盒子，第二层预测较小的盒子，等等。</p><p id="d92e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之后，我使用回调来训练模型，以改变学习率，即使用ReduceLROnPlateau，提前停止，生成tensorboard日志并节省重量。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="2629" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在数据集的不同组合上训练模型后，我通过可视化错过的预测和额外预测的图来评估模型，我在预测评估部分对此进行了解释。</p><h1 id="0c94" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">推论:</h1><p id="1e31" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在通过在第10个时期提前停止来训练模型之后，首先我在训练的数据集上推断训练的模型，并将其与模型是否能够正确预测的基本事实进行比较。然后我根据测试图像推断出我的模型。</p><h2 id="1f4f" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">仅在日本数据集上训练的模型的推论:</h2><p id="bccf" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">对于列车图像上的日本道路:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/fc71683191c48939361e8e4397251f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2bh9RYtE-9MLsNQHgS3UOA.png"/></div></div></figure><p id="6be1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">测试图像上的日本道路:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/1395b2568c4ba223d902dd0008f19b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhTQUFP50fDzilZ48ApCmg.png"/></div></div></figure><h2 id="f8f0" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">仅在印度数据集上训练的模型的推论:</h2><p id="e7b8" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">对于印度公路上的列车数据:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/9909192801a8ac15f60156778d5e4bda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LopRaJds3EDD0QiNe55udA.png"/></div></div></figure><p id="2cf7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">针对印度道路的测试数据:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/ebee0d336c804a52cc3057e5b695858a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MdTGF72c-oVvq_SXp6Q1qw.png"/></div></div></figure><h2 id="2147" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">在组合数据集上训练的模型的推理:</h2><p id="417f" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">对于列车图像上的日本道路:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/3a7767a1e04a28b22d5ac88ee7426ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vu1iTcNmMaGvTrTfIt2SPg.png"/></div></div></figure><p id="68b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">对于测试图像上的日本道路:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/5f6ed31a7e2a0fb6e3bf0743b7f16acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHaUo7IdWuj0DPBJYxmrgg.png"/></div></div></figure><p id="d598" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">对于列车图像上的印度道路:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/dfe56ee2c9314a90c8e903f2d3800339.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsTcWFW_C9w0teW3e02WMA.png"/></div></div></figure><p id="235b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">对于印度道路上的测试法师:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/e42187721cfcbc3d6bfa5680d098e25c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2tLAwp2D2xa7rCo2nD3SQ.png"/></div></div></figure><p id="646a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，当您比较分别在印度和日本道路数据集上训练的模型的推断，以及当模型在印度和日本的组合数据集上训练时，模型预测得到了改进。</p><h1 id="52df" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">生成自定义锚定框:</h1><p id="72cd" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在实现了第一次切割方法之后，我根据这个问题的给定数据集计算了锚盒。</p><p id="8591" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">锚盒是使用K均值聚类算法来计算的，正如作者在论文中所描述的，作者使用K均值来计算锚盒。关于K均值算法更详细的解释可以参考这个<a class="ae kt" rel="noopener" href="/@dilekamadushan/introduction-to-k-means-clustering-7c0ebc997e00">博客</a>。</p><p id="44bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用K=9，因为我必须生成9个定位框坐标。并在给定数据集上应用了使用IOU度量的K均值聚类技术。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><h1 id="fddf" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">使用增强和定制锚盒的模型训练:</h1><p id="044a" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在根据给定的问题数据集计算锚盒之后，我在增强的训练数据上训练该模型，并分别在日本和印度数据集以及组合数据集上使用定制的锚盒。</p><p id="d1c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其余时间，我使用相同的Adam优化器，学习率为0.001，IOU阈值为0.4。</p><h2 id="9b69" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">日本数据集上的推论:</h2><p id="b181" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">在列车图像上:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/e4fcd7bc8a630d362d842c930cef9650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLOjnuAIuA0th1ZxqvSz2A.png"/></div></div></figure><p id="e33d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">关于测试图像:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/5ff1db191156117fc8825d15185e67f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmnc8vK9ZV2hdD9vcQfksw.png"/></div></div></figure><h2 id="d68c" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">印度数据集上的推论:</h2><p id="4c44" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">在列车图像上:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mj"><img src="../Images/01107dd613108af7511affb6ebd5783a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3IEE2W0UT0AD6fc6FWKxg.png"/></div></div></figure><p id="994f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在测试图像上:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mo"><img src="../Images/a1b22ff8856a3af981e6f0323fe037a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ndN7ak5rj7d7ClHnDes4A.png"/></div></div></figure><h1 id="dbd0" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">预测评估:</h1><p id="803e" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">为了评估我的模型对列车数据的预测，我首先运行训练好的模型，并对所有列车图像进行推理，然后将预测保存在文本文件中，格式如下:</p><pre class="ky kz la lb fd lm ln lo lp aw lq bi"><span id="b8a0" class="lr jd hh ln b fi ls lt l lu lv">&lt;image_name&gt; &lt;class_name&gt; &lt;confidence_score&gt; &lt;bounding boxes coordinates&gt;</span></pre><p id="d18e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并使用注释文件在groundtruth上创建了另一个具有上述格式的文本文件。</p><p id="034f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">生成文本文件后，我为每个类绘制了柱状图，以可视化错过的预测和额外的预测，以检查我的模型预测了多少额外的边界框(如果有的话)。</p><h2 id="5a9f" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">对于型号1:</h2><p id="746f" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">在组合数据集上训练的模型的图:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/3cba72d1480d6227da99df615f2050ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*9D6GOBtjo_mE7oNCPNj7Hw.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/cf4266feb1de340f05118641740ad324.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*hQ_da4w6gASFBfg1Nt9ZxQ.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/828b5bb13c53975a2a415f46ea596b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*3tWhTVrvs8v9E7bQ8EJEJA.png"/></div></figure><p id="2bcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">仅在日本数据集上训练的模型的图:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/f361c43d9d0a9579a91ff4f527da72a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*JZXU8uc11Ta7jzlzQtR2Gw.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/24e1b4c545d154c3111fbf570de565f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*dnBPXTsWLdzKmEEIHNBwuQ.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/dbaff612ab502468e111780f4ed23144.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*rwrhNaZb24JNZd6tg5KDng.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es mp"><img src="../Images/c438dffe6f3d5c038f80b010fd7d1873.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*GPC-3LQfS_bBX_cagAUdlA.png"/></div></figure><p id="e467" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在印度数据集上训练的模型的图:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/d1d00efea0c28d1c841d003a1a467abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*803X5F8OE_infEFb3DGIxA.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/c974e925835c14225fce5722c697a9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*L4RemTPFMAwp74-iAi298g.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/4e6ddb6bfcba91139cc2897e4056ffc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*773fvfUgfZke9z1Xibn1FQ.png"/></div></figure><h2 id="c31a" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">对于使用数据扩充和自定义锚盒的模型2:</h2><p id="f8e3" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">仅在日本数据集上训练的模型的图:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/8e9b6a529907ab0fa349457879d6bc80.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*29WUJ3bS9rbqm5o_uwx2NA.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/3cbd9e8d9ecaf6b37f9fe4c24dd38b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*oELHRayWGWDwzyK1VGQfiw.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/9494b47cc294972abd78471bb07e5d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*7LEd_FVYw1G19_oFeZGj3Q.png"/></div></figure><p id="a7c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">仅在印度数据集上训练的模型的图:</strong></p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/e122dba1a00a9a379af62996b1c8d502.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*3an-9L1sGbTEExGGbtyu5g.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/c974e925835c14225fce5722c697a9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*L4RemTPFMAwp74-iAi298g.png"/></div></figure><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es ll"><img src="../Images/e930744fe1ef4d2e0f3ce3afba6307d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*bKte1RffgNiN_upGrldspQ.png"/></div></figure><h2 id="1526" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">观察结果:</h2><ol class=""><li id="d66a" class="ka kb hh ig b ih kc il kd ip ke it kf ix kg jb kh ki kj kk bi translated">从上面的柱状图可以看出，当模型在两个国家(即日本和印度)的独立数据集上训练时，某些类型的损坏的预测失误率很高，但当模型通过组合数据集进行训练时，模型得到了改进，与在单个数据集上训练的模型相比，模型能够更好地检测道路损坏</li><li id="4b64" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">对于模型1日本数据集，与模型2和在组合数据集上训练的模型相比，模型预测了D40类别的额外道路损坏，即坑洼。</li><li id="c920" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">D40类别的预测失误非常高，因为YOLOv3对于通常被认为是较小物体的小物体和坑洼没有给出更好的结果，所以模型可能已经错过了那些物体。</li></ol><h1 id="4442" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">最终型号:</h1><p id="1e5d" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">我选择了在组合数据集上训练的模型作为量化的最终模型，并将其部署在Streamlit上。</p><h1 id="7e2a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">模型量化:</h1><p id="b372" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">选定最终模型后，我尝试了后训练量化。</p><p id="277d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">训练后量化是一种减小模型大小的技术，同时也改善了CPU延迟。</p><p id="a7b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我应用了训练后float16量化，它使用TFLiteConverter将权重量化为float 16，与未量化的模型相比，它将模型大小减少了2倍，还改善了CPU上的延迟。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="2cce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还有各种其他的后量化技术，比如可以将模型权重量化为整数，这比原始模型小4倍，速度快3倍，不仅在GPU中，而且整数量化模型在CPU、TPU和微控制器上工作得相当好，速度也更快。你可以参考这篇<a class="ae kt" href="https://www.tensorflow.org/lite/performance/post_training_quantization" rel="noopener ugc nofollow" target="_blank">文章</a>了解更多后量化技术。</p><h2 id="6065" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">模型尺寸:</h2><p id="1dc5" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在使用post training float 16量化对模型进行量化之后，我的模型大小减少到了2x。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div class="er es mq"><img src="../Images/deeb7c9e7a69463b0280cc419052a707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*sEIxjZnIDm5fpDBgEqquEg.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">模型尺寸比较</figcaption></figure><p id="8ed8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我还在CPU和GPU上测量了测试数据每张图片的量化模型和未量化模型的预测率。</p><h2 id="7347" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">CPU上的预测速率:</h2><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mr"><img src="../Images/16ab7edfe975c01462c5c2f42e0e26c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xM2HGHSqJAtpL1Uwyf9XOA.png"/></div></div></figure><p id="8d00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">观察:</strong></p><ol class=""><li id="3316" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">从上表的比较中，我们可以得出结论并观察到，我们在CPU上进行的量化模型实验给出的结果比没有量化的模型稍快</li><li id="1db3" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">因此，该模型在CPU上的推理速度比在GPU上的推理速度快，因此，如果机器只有CPU架构，那么量化模型对于推理或预测是有用的</li></ol><h2 id="2fd9" class="lr jd hh bd je lw lx ly ji lz ma mb jm ip mc md jq it me mf ju ix mg mh jy mi bi translated">GPU上的预测速率:</h2><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es ms"><img src="../Images/0b60bc3dee31ef5f02fad532fa784a3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TT-eAbuZTf3kgZDn91rcsA.png"/></div></div></figure><p id="b88f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">观察:</strong></p><ol class=""><li id="05af" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">从上表比较中，我们可以得出结论并观察到，我们在GPU上用非量化模型进行的实验比量化模型给出的结果更快</li><li id="297d" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">因此，如果计算机体系结构有GPU，那么非量子化的模型可以比量子化的模型推断得更快。</li></ol><h1 id="ae4a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">Streamlit应用:</h1><p id="bb7d" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在训练我的模型并选择最终模型后，我为这个问题创建了streamlit应用程序。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mt"><img src="../Images/ca83e4251468787c975963e434ebceb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Sz0s2ZgCruWH4KKvuD_2g.png"/></div></div></figure><p id="aa8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于存储限制，我将训练和测试数据限制为100和60张图像，以便在应用程序中选择，但如果您有来自印度和日本的损坏道路图像，我添加了在捕获的图像上测试的选项，其中模型api将预测道路损坏的类型(如果在上传的图像中有)。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="er es mu"><img src="../Images/7869839634d4847e3ce1fcc3c0ccce9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*egfxaJcflZOkEPcvHXzMyQ.png"/></div></div></figure><p id="1692" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您甚至可以使用置信度阈值和IOU阈值来检查图像上各种阈值的预测。</p><p id="7a14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以参考<a class="ae kt" href="https://share.streamlit.io/jugaloza/road_damage_detection_streamlit/main/app.py" rel="noopener ugc nofollow" target="_blank">这个</a>链接来试用这个app。</p><h1 id="c832" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">未来工作:</strong></h1><p id="362a" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">我的工作可以作为未来工作的一部分进行改进如下:</p><ol class=""><li id="9da1" class="ka kb hh ig b ih ii il im ip ku it kv ix kw jb kh ki kj kk bi translated">现在，我们已经改进了YOLO的技术，如YOLOv4和YOLOv5，因此可以使用改进的技术来训练道路损坏检测，作为未来工作的一部分。</li><li id="d021" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">可以使用各种其他增强技术来改进模型，如在数据准备第一部分中提到的，我已经使用了FlipLR技术，但是还有各种其他技术来增强数据和边界框。</li><li id="9fe6" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">作为未来工作的一部分，除了浮点16量化技术之外，还可以使用各种其他量化技术。</li><li id="7ded" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">作为未来的工作，人们也可以尝试使用捷克数据集来训练模型，除了印度和日本，我没有使用捷克数据集进行训练。</li><li id="eb95" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">作为未来工作的一部分，上述模型可以扩展到除日本和印度之外的任何其他国家，如果您使用智能手机或任何其他设备点击您想要检测道路损坏的国家的图像，我的模型可以通过组合所有数据集(包括模型必须训练的国家的数据集)或使用这些数据集从头开始训练来进行微调。</li></ol><p id="0c33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以在我的<a class="ae kt" href="https://github.com/jugaloza/Road_Damage_Detection_Using_YOLOV3" rel="noopener ugc nofollow" target="_blank"> github repo </a>中查阅我的代码、训练过的模型和ipython笔记本。</p><p id="bc60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你喜欢我的博客，别忘了拍下来分享。</p><p id="7d5f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢您的阅读。</p></div><div class="ab cl mv mw go mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ha hb hc hd he"><h1 id="bfa3" class="jc jd hh bd je jf nc jh ji jj nd jl jm jn ne jp jq jr nf jt ju jv ng jx jy jz bi translated">参考资料:</h1><p id="0d99" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><a class="ae kt" href="https://arxiv.org/pdf/1804.02767.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1804.02767.pdf</a></p><p id="5e9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://www.tensorflow.org/model_optimization" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/model_optimization</a></p><p id="e2b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://github.com/zzh8829/yolov3-tf2" rel="noopener ugc nofollow" target="_blank">https://github.com/zzh8829/yolov3-tf2</a></p><p id="38f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://github.com/lars76/kmeans-anchor-boxes/blob/master/kmeans.py" rel="noopener ugc nofollow" target="_blank">https://github . com/Lars 76/k means-anchor-boxes/blob/master/k means . py</a></p><p id="0777" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://towardsdatascience.com/anchor-boxes-the-key-to-quality-object-detection-ddf9d612d4f9" rel="noopener" target="_blank">https://towards data science . com/anchor-boxes-the-key-to-quality-object-detection-ddf9d 612 D4 f 9</a></p><p id="6cee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://planspace.org/20170323-tfrecords_for_humans/" rel="noopener ugc nofollow" target="_blank">https://planspace.org/20170323-tfrecords_for_humans/</a></p><p id="7e06" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://towardsdatascience.com/dive-really-deep-into-yolo-v3-a-beginners-guide-9e3d2666280e" rel="noopener" target="_blank">https://towards data science . com/dive-really-deep-into-yolo-v3-a-初学者指南-9e3d2666280e </a></p><p id="e72f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://towardsdatascience.com/yolo-v3-object-detection-53fb7d3bfe6b" rel="noopener" target="_blank">https://towards data science . com/yolo-v3-object-detection-53 FB 7d 3 bfe 6 b</a></p><div class="nh ni ez fb nj nk"><a href="https://www.linkedin.com/in/jugal-oza-974048109/" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab dw"><div class="nm ab nn cl cj no"><h2 class="bd hi fi z dy np ea eb nq ed ef hg bi translated">Jugal Oza -助理工程师- Atos | LinkedIn</h2><div class="nr l"><h3 class="bd b fi z dy np ea eb nq ed ef dx translated">查看Jugal Oza在全球最大的职业社区LinkedIn上的个人资料。Jugal有2个工作列在他们的…</h3></div><div class="ns l"><p class="bd b fp z dy np ea eb nq ed ef dx translated">www.linkedin.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ld nk"/></div></div></a></div></div></div>    
</body>
</html>