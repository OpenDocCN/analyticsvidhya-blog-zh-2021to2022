<html>
<head>
<title>Comparison of Two Data Sets using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python比较两个数据集</h1>
<blockquote>原文：<a href="https://medium.com/analytics-vidhya/comparison-of-two-data-sets-using-python-a24a6d8beb13?source=collection_archive---------0-----------------------#2021-02-18">https://medium.com/analytics-vidhya/comparison-of-two-data-sets-using-python-a24a6d8beb13?source=collection_archive---------0-----------------------#2021-02-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="60bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于任何一个从事分析工作的人来说，<strong class="ih hj">比较两个数据集</strong>将是一项日常活动。这是为了证明所做的更改不会影响文件中的其余数据，通常称为“回归测试”，还是为了了解两个文件/数据集之间的差异。</p><ul class=""><li id="2770" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">当数据太小时，excel就来帮忙了。但是如果你的数据集很大呢？你必须经常进行比较？在这种情况下，您需要比Excel或Excel宏更强大的工具</li></ul></div><div class="ab cl jm jn gp jo" role="separator"><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr js"/><span class="jp bw bk jq jr"/></div><div class="hb hc hd he hf"><p id="3be9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">市场上有很多文件比较工具，比如beyond compare。等等</p><p id="a43d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将探索如何使用<strong class="ih hj"> Python库</strong><strong class="ih hj">“datacompy”</strong>有效地比较两个大文件/数据集 <strong class="ih hj"/></p><p id="5da9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> datacompy : </strong>是比较两个数据帧的包。最初是作为SAS的熊猫数据帧的<code class="du jt ju jv jw b">PROC COMPARE</code>的替代品，具有比<code class="du jt ju jv jw b">Pandas.DataFrame.equals(Pandas.DataFrame)</code>更多的功能</p><p id="4461" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看如何利用这个图书馆。</p><h2 id="0166" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">安装<strong class="ak">数据组件</strong></h2><pre class="ks kt ku kv fd kw jw kx ky aw kz bi"><span id="89af" class="jx jy hi jw b fi la lb l lc ld">pip install datacompy</span></pre><h2 id="9c3f" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">详细信息:</h2><p id="d029" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated"><strong class="ih hj"> datacompy </strong>接受两个数据帧作为输入，并给出一个人类可读的报告，其中包含统计数据，让我们知道两个数据帧之间的相似之处和不同之处。</p><p id="45a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将尝试在一列连接列或索引上连接两个数据帧。</p><p id="7059" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使dtypes不匹配，按列比较也会尝试匹配值。因此，例如，如果在一个数据帧中有一个带有<code class="du jt ju jv jw b">decimal.Decimal</code>值的列，而在另一个数据帧中有一个带有<code class="du jt ju jv jw b">float64</code>数据类型的同名列，它会告诉您数据类型不同，但仍会尝试比较这些值。</p><h2 id="8d13" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated"><strong class="ak">例子:</strong></h2><p id="901d" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">假设您有2个Csv文件—</p><p id="e44b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将文件载入两个数据框</p><figure class="ks kt ku kv fd lk er es paragraph-image"><div class="er es lj"><img src="../Images/c1d82982a1e15cb4d5ae67f1829e7ab5.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*UD3Ya_O0po41WsLn8yQ5rA.png"/></div></figure><p id="e0b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> df1 </strong></p><figure class="ks kt ku kv fd lk er es paragraph-image"><div class="er es ln"><img src="../Images/ac7402ca09bacf50ef6825e484138a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*5W-xSuDp3UKJrgxHs3kNfQ.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">数据帧1 -CSV1</figcaption></figure><p id="39e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> df2 </strong></p><figure class="ks kt ku kv fd lk er es paragraph-image"><div class="er es ls"><img src="../Images/2def25a4d2f55a8d5894b07c7e1b2da4.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*kd__TvtDUNwZlVfIQyL8QA.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">数据帧2 -CSV2</figcaption></figure><p id="5915" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">导入数据比较&amp;比较两个数据帧</strong></p><p id="2b25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入数据组合</p><p id="a99e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">compare = datacompy。Compare( <br/> df1，<br/> df2，<br/> join_columns='acct_id '，#您还可以指定一个列列表<br/> abs_tol=0.0001，<br/> rel_tol=0，<br/> df1_name='original '，<br/> df2_name='new ')</p><h2 id="5937" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated"><strong class="ak">生成输出(以报告的形式)</strong></h2><p id="6650" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">打印(compare.report())</p><h2 id="301b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">输出:</h2><p id="aca8" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">数据对比<br/> — — — —</p><p id="03b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据帧摘要<br/></p><p id="8f42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据帧列行<br/> 0原始5 7 <br/> 1新4 6</p><p id="df5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">栏目摘要<br/> — — — —</p><p id="3d03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">共有列数:4 <br/>原不新列数:1 <br/>新不原列数:0</p><p id="ab99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">行摘要<br/></p><p id="6114" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">匹配于:acct_id <br/>匹配值是否重复:是<br/>绝对容差:0.0001 <br/>相对容差:0 <br/>共有行数:5 <br/>原始但不在新中的行数:2 <br/>新但不在原始中的行数:1</p><p id="2a1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">某些比较列不相等的行数:3 <br/>所有比较列相等的行数:2</p><p id="aeaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列比较<br/> — — — —</p><p id="1c05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与某些不相等的值比较的列数:3 <br/>与所有相等的值比较的列数:1 <br/>比较不相等的值的总数:5</p><p id="a207" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值或类型不相等的列<br/> — — — — —</p><p id="ff7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">列原始数据类型新数据类型#不相等最大差异#空差异<br/> 0美元_金额浮动64浮动64 1 0.05 0 <br/> 2名称对象对象2 0.00 0 <br/> 1数量浮动64浮动64 2 3.00 1</p><p id="4785" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值不等的样本行<br/></p><p id="98c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">acct_id dollar_amt(原)dollar_amt(新)<br/> 0 1234 123.45 123.4</p><p id="83eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">acct_id数量(原)数量(新)<br/>5 1238 8.0 5.00<br/>3 1237 NaN 345.12</p><p id="946d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">acct_id name(原)name(新)<br/> 0 1234乔治·马海尔斯·乔治·迈克·布鲁斯<br/> 3 1237鲍勃·洛伯劳罗伯特·洛伯劳</p><p id="107c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅原始样本行(前10列)<br/> — — — — — — —</p><p id="c412" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">acct _ id dollar _ AMT name qty date _ fld<br/>6 1239 1.05松封Bluth 29.0 1/1/2017<br/>4 1237 123456.00 Bob lob law NaN 1/1/2017</p><p id="bf94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅在新的样本行(前10列)<br/> — — — — — —</p><p id="485d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">acct_id dollar_amt名称数量<br/> 7 1240 1.05松封Bluth 111.0</p><p id="fd53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出的细节是不言自明的</p><p id="3edf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">幕后发生的事情:</strong></p><ol class=""><li id="7622" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc lt jj jk jl bi translated">在上面的例子中，我们在一个<strong class="ih hj"> <em class="lu">匹配列(acct_id)上连接两个数据帧。</em> </strong>我们也可以通过:<code class="du jt ju jv jw b">on_index = True</code>而不是“join_columns”来对索引进行连接。</li><li id="323e" class="jd je hi ih b ii lv im lw iq lx iu ly iy lz jc lt jj jk jl bi translated"><code class="du jt ju jv jw b">Compare.matches()</code>是布尔函数。如果匹配就返回真，否则返回假。</li><li id="1a4f" class="jd je hi ih b ii lv im lw iq lx iu ly iy lz jc lt jj jk jl bi translated">我们可以传入<code class="du jt ju jv jw b">ignore_extra_columns=True</code>来忽略不匹配的列，并且不返回<code class="du jt ju jv jw b">False</code>(它仍然会检查重叠的列)</li><li id="2eb6" class="jd je hi ih b ii lv im lw iq lx iu ly iy lz jc lt jj jk jl bi translated">默认情况下，只有100%匹配时，DataComPy才返回True。我们可以通过将<strong class="ih hj"><em class="lu">ABS _ tol&amp;rel _ tol</em></strong>的值设置为非零来对此进行调整，这使我们能够指定可以容忍的数值之间的偏差量</li><li id="cdca" class="jd je hi ih b ii lv im lw iq lx iu ly iy lz jc lt jj jk jl bi translated">我们还可以使用下面的方法从df1或df2中获取两个集合和不相等行的交集的细节</li></ol><p id="dde8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jt ju jv jw b">intersect_rows</code>、<code class="du jt ju jv jw b">df1_unq_rows</code>、<code class="du jt ju jv jw b">df2_unq_rows</code></p><p id="6810" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打印(compare.df1_unq_rows)</p><figure class="ks kt ku kv fd lk er es paragraph-image"><div class="er es ma"><img src="../Images/9d24454daf9a4414724db7fe2a45a7f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*hPnlrlEKDLoIyZ90afTAIg.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">df1中所有不匹配的行</figcaption></figure><p id="dbbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">intersect _ rows比较匹配行的所有列，如果匹配则返回true，如果不匹配则返回False</p><figure class="ks kt ku kv fd lk er es paragraph-image"><div class="er es mb"><img src="../Images/904afb0a8413bb0323bb12289393b269.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*ZgT_BOVFZ07pK_rtAnSNhQ.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">打印(compare.intersect_rows)</figcaption></figure><p id="93fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">df1_unq_columns() —给出df1中存在但df2中不存在的列的列表。在我们的示例中，date_fld不在因此返回的df2中。</p><figure class="ks kt ku kv fd lk er es paragraph-image"><div class="er es mc"><img src="../Images/965c512760be7e61c225338776dbc1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*gP15V_Yn7AGPqmyVu6ybjw.png"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">print(compare.df1_unq_columns())</figcaption></figure><p id="7cb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">处理重复值的条件:</strong></p><p id="4cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当有重复项时，选择匹配哪一行时，重复匹配有些幼稚。Datacompy在生成临时ID之前按其他字段排序，然后直接在该字段上匹配。如果有许多重复项，您可能需要将更多列连接起来，或者分别处理它们。</p><h1 id="d3df" class="md jy hi bd jz me mf mg kd mh mi mj kh mk ml mm kk mn mo mp kn mq mr ms kq mt bi translated">限制</h1><ol class=""><li id="6ac1" class="jd je hi ih b ii le im lf iq mu iu mv iy mw jc lt jj jk jl bi translated">你比较的数据帧必须适合内存。与可以对磁盘上的数据集进行操作的SAS <code class="du jt ju jv jw b">PROC COMPARE</code>相比，如果您使用非常大的数据帧，这可能是一个限制。(我已经尝试比较了两个数据集，每个数据集有15万多条记录，效果很好)</li></ol><h1 id="c205" class="md jy hi bd jz me mf mg kd mh mi mj kh mk ml mm kk mn mo mp kn mq mr ms kq mt bi translated">总而言之:</h1><p id="aff0" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">如果你想快速比较两个数据集，DataCompy是相当有用的库。它还允许您考虑数据集之间的微小差异，并提供关于两个数据帧的详细摘要。</p><p id="b67a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这篇文章对你有用。</p></div></div>    
</body>
</html>